/*! For license information please see 8.9404974747519484cf5d.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"+/R+":function(t,e,i){"use strict";var n=i("2EI4");i.n(n).a},"+7zK":function(t,e,i){"use strict";var n=i("bl1U");i.n(n).a},"+EJ4":function(t,e,i){},"+Xeu":function(t,e,i){"use strict";var n=i("cx/9");i.n(n).a},"+teE":function(module,exports){module.exports={"template-constructor-control-text_typography":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Typography" data-alt-pos="left" data-alt-offset="9"></div>\n\t<div class="panel">\n\n\t\t<div class="font-size-wrapper">\n\t\t\t<div class="multiple-layer">&bull;&bull;&bull;</div>\n\t\t\t<input class="font-size" title="Font Size" spellcheck="false" data-class="font-size" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="line-height-wrapper">\n\t\t\t<div class="multiple-layer">&bull;&bull;&bull;</div>\n\t\t\t<input class="line-height" title="Line Height" spellcheck="false" data-class="line-height" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="gauge">\n\t\t\t<div class="font-size-gauge"></div>\n\t\t\t<div class="line-height-gauge"></div>\n\t\t</div>\n\n\t\t<div class="pictograms">\n\t\t\t<div class="linked active" title="Unbind Font Size and Line Height"></div>\n\t\t</div>\n\n\t\t<div class="letter-spacing-wrapper">\n\t\t\t<div class="block-layer"></div>\n\t\t\t<div class="multiple-layer"><span>&bull;&bull;&bull;</span></div>\n\t\t\t<input class="letter-spacing"  title="Tracking" spellcheck="false" type="text" value=""/>\n\t\t</div>\n\n\t\t<div class="font-style-popup">\n\t\t\t<div class="popup-caption"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="font-family-popup">\n\t\t\t<div class="popup-caption"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="font-style">\n\t\t\t<div class="font-style-wrapper">\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},"+uCx":function(module,exports){module.exports={"template-constructor-control-text_bius":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Font Style" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="all-caps" title="All Caps"></div>\n\t\t<div class="bold" title="Bold"></div>\n\t\t<div class="italic" title="Italic"></div>\n\t\t<div class="underline" title="Underline"></div>\n\t\t<div class="strike" title="Strike"></div>\n\t</div>\n';return __p}}},"/0Qt":function(t,e,i){"use strict";var n=i("etQA");i.n(n).a},"/Czx":function(t,e,i){},"0DSZ":function(t,e,i){"use strict";var n=i("xi34"),o=i("rFsW"),a={props:{onPanelScroll:{type:Function,default:function(){}},onScrollRecalc:{type:Function,default:function(){}},scrollGapStart:{type:Number,default:16},scrollGapEnd:{type:Number,default:16},systemScroll:{type:Boolean,default:!1},savedScrollPosition:{type:Number,default:void 0}},mounted:function(){this.resizableScroll=Object(n.a)(this.$refs.scrollWrapper).RMScroll({$container:Object(n.a)(this.$refs.contentWrapper),$content:Object(n.a)(this.$refs.content),$handle:Object(n.a)(this.$refs.scroll),wheelScrollSpeed:.4,gap_start:this.scrollGapStart,gap_end:this.scrollGapEnd,systemScroll:this.systemScroll,onScroll:this.onPanelScroll,savedScrollPosition:this.savedScrollPosition}).data("scroll"),this.__scrollRecalc_debounced=o.a.debounce(o.a.bind((function(){this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")}),this),300)},beforeUpdate:function(){0===this.savedScrollPosition&&this.resizableScroll.clearScroll()},methods:{recalcScroll:function(){this.__scrollRecalc_debounced()}}},s=i("KHd+"),r=Object(s.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{ref:"scrollWrapper",staticClass:"resizable-scroll-wrapper"},[e("div",{ref:"contentWrapper",staticClass:"resizable-content-wrapper"},[e("div",{ref:"content",staticClass:"resizable-content"},[this._t("default")],2)]),this._v(" "),e("div",{ref:"scroll",staticClass:"resizable-scroll"})])}),[],!1,null,null,null);e.a=r.exports},"0KJJ":function(t,e,i){},"0NDv":function(t,e,i){"use strict";function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var r=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,i){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,o({headers:{"Content-Type":"application/json"}},i)).then((function(t){return t.text()})).then((function(t){try{return JSON.parse(t)}catch(e){return t}}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function r(t){s(a,n,o,r,l,"next",t)}function l(t){s(a,n,o,r,l,"throw",t)}r(void 0)}))});return function(t,i){return e.apply(this,arguments)}}();e.a={get:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r(t,e)},post:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(t,o({method:"POST",body:JSON.stringify(e)},i))},patch:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(t,o({method:"PATCH",body:JSON.stringify(e)},i))},put:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(t,o({method:"PUT",body:JSON.stringify(e)},i))},delete:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r(t,o({method:"DELETE",body:e?JSON.stringify(e):void 0},i))}}},"0SXY":function(module,exports){module.exports={"template-constructor-control-gmaps_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Edit map" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},"0zSa":function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("i7aS"),l=a.a.View.extend({pictures:[],domPictures:[],preloadPictures:[],currentSlide:null,nextSlide:null,selectedSlide:null,defaultDelay:4,defaultCrossfade:.5,isAnimationRunning:!1,cursor:0,rendered:!1,lastSlideshowAnimationStart:null,initialize:function(t){this.initSlideshowData(t.data),this.$container=t.container,this.$preloadContainer=t.preloadContainer},initSlideshowData:function(t){this.pictures=t&&t.pictures?s.a.sortBy(t.pictures,"num"):[],this.delay=t&&"number"==typeof t.delay?t.delay:this.defaultDelay,this.crossfade=t&&"number"==typeof t.crossfade?t.crossfade:this.defaultCrossfade,this.name=t&&t.name?t.name:"slideshow"+(new Date).getTime(),this.domPictures=[],this.preloadPictures=[],this.currentSlide=null,this.nextSlide=null,this.selectedSlide=null,this.isAnimationRunning=!1,this.cursor=0},render:function(t){RM.screenshot?this.pictures.length?this.addPicture(this.pictures[0]):this.trigger("loaded"):this.loadPictures(),this.isAnimationRunning||t||this.startAnimationLoop(),this.rendered=!0},rerender:function(t){this.stopAnimationLoop(),this.initSlideshowData(t),this.removePictures(),this.render(!0)},runAnimation:function(){this.isAnimationRunning||(this.rendered?this.startAnimationLoop():this.render())},setDelay:function(t){t<this.crossfade?console.error("delay mast be longer than crossfade"):this.delay=t},setCrossfade:function(t){t>this.delay?console.error("delay mast be longer than crossfade"):(this.crossfade=t,this.updateCrossfade())},updateCrossfade:function(){this.domPictures.forEach(function(t){t.css({"transition-duration":this.crossfade+"s"})}.bind(this))},updatePicture:function(t){var e=s.a.findIndex(this.pictures,(function(e){return e.uuid===t.uuid}));this.pictures[e]=t,this.domPictures[e].css({"background-image":'url("'.concat(this.getPoorUrl(t),'")')}),r.a.useLqipUrl(t)&&this.domPictures[e].addClass("lqip"),this.loadFullSizePicture(t)},updatePicturePosition:function(t){this.destroy(),this.initSlideshowData({pictures:t,delay:this.delay,crossfade:this.crossfade}),this.render()},addPicture:function(t){var e=this.domPictures.length===this.cursor+1,i=0===this.domPictures.length?2:e?1:0,o=0===this.domPictures.length||e?"block":"none";this.pictures.push(t),this.domPictures.push(Object(n.a)("<div>").addClass("slideshow-image fade-in".concat(r.a.useLqipUrl(t)?" lqip":"")).css({"z-index":i,display:o,"background-image":'url("'.concat(this.getPoorUrl(t),'")'),"transition-property":"opacity","transition-duration":this.crossfade+"s","transition-timing-function":"linear"}).appendTo(this.$container)),this.loadFullSizePicture(t)},selectSlide:function(t){if(t){var e=this.pictures.findIndex((function(e){return e.uuid===t}));if(-1!==e){if(this.currentSlide&&this.selectedSlide!==this.domPictures[e]&&(this.isAnimationRunning&&this.stopAnimationLoop(),this.currentSlide!==this.domPictures[e])){var i=this.cursor;this.nextSlide&&this.nextSlide.css({"z-index":0,display:"none"}),this.domPictures[e].css({"z-index":1,display:"block"}),this.currentSlide=this.domPictures[e],this.cursor=e,this.selectedSlide=this.domPictures[e],this.domPictures.length>1?this.domPictures[e+1]?this.nextSlide=this.domPictures[e+1]:this.nextSlide=this.domPictures[0]:this.nextSlide=null,this.domPictures[i].css({"transition-duration":"0.3s"}),this.domPictures[i].removeClass("fade-in").addClass("fade-out"),setTimeout(function(){this.domPictures[i].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.currentSlide.css({"z-index":2}),this.nextSlide&&this.nextSlide.css({"z-index":1,display:"block"})}.bind(this),310)}}else console.warn("Did't find slide for uuid:",t)}},removePictures:function(){this.domPictures=[],this.preloadPictures=[],this.$container.empty(),this.$preloadContainer.empty()},removePicture:function(t){if(t){var e=this.pictures.findIndex((function(e){return e.uuid===t}));if(this.domPictures[e]===this.currentSlide&&1!==this.domPictures.length&&this.selectedSlide!==this.domPictures[e]){var i=1e3*this.crossfade+1e3*this.delay+50;i=this.lastSlideshowAnimationStart?Math.abs(i-((new Date).getTime()-this.lastSlideshowAnimationStart.getTime())):i,setTimeout(function(){this.cursor&&(this.cursor-=1);var e=this.pictures.findIndex((function(e){return e.uuid===t}));this.domPictures[e].remove(),this.domPictures.splice(e,1),this.pictures.splice(e,1)}.bind(this),i)}else{if(this.domPictures[e]===this.nextSlide&&1!==this.domPictures.length&&(this.domPictures[e+1]?(this.domPictures[e+1].css({"z-index":1,display:"block"}),this.nextSlide=this.domPictures[e+1]):(this.domPictures[0].css({"z-index":1,display:"block"}),this.nextSlide=this.domPictures[0])),this.selectedSlide===this.domPictures[e]&&this.nextSlide){var n=this.domPictures.findIndex(function(t){return t===this.nextSlide}.bind(this));this.currentSlide=this.domPictures[n],this.cursor=n,this.selectedSlide=null,this.currentSlide.css({"z-index":2}),this.domPictures.length>2?this.domPictures[this.cursor+1]?this.nextSlide=this.domPictures[this.cursor+1]:this.nextSlide=this.domPictures[0]:this.nextSlide=null,this.nextSlide&&this.nextSlide.css({"z-index":1,display:"block"}),setTimeout(function(){this.startAnimationLoop()}.bind(this),0)}this.domPictures[e].remove(),this.domPictures.splice(e,1),this.pictures.splice(e,1)}}},getThumbnailUrl:function(t){return t?r.a.useLambdaUrl(t)?r.a.getThumbnailUrl(t):t.thumbUrl:""},getPictureUrl:function(t){return r.a.useLambdaUrl(t)||r.a.useLambdaUrlOldProjects(t,"background")?r.a.getLambdaUrl(t):t.url},getPoorUrl:function(t){return r.a.useLqipUrl(t)?r.a.getLqipUrl(t):t.poorUrl},loadPictures:function(){this.pictures.forEach(function(t,e){this.domPictures[e]=Object(n.a)("<div>").addClass("slideshow-image fade-in".concat(r.a.useLqipUrl(t)?" lqip":"")).css({"z-index":0===e?2:1===e?1:0,display:0===e||1===e?"block":"none","background-image":'url("'.concat(this.getPoorUrl(t),'")'),"transition-property":"opacity","transition-duration":this.crossfade+"s","transition-timing-function":"linear"}).appendTo(this.$container)}.bind(this)),this.loadFullSizePictures()},loadFullSizePictures:function(){function t(t,e,i){this.domPictures[e].css({"background-image":'url("'.concat(t,'")')}),this.domPictures[e].removeClass("lqip"),this.preloadPictures[e].remove(),0===e&&this.trigger("loaded")}function e(t,e){this.domPictures[t].removeClass("lqip"),0===t&&this.trigger("loaded"),RM.screenshot||this.preloadPictures[t].remove()}this.preloadPictures=[],this.pictures.forEach(function(i,o){var a=this.getPictureUrl(i);this.preloadPictures[o]=Object(n.a)("<img>").addClass("preload-slideshow-image").appendTo(this.$preloadContainer).attr("src",a).on("load",t.bind(this,a,o)).on("error",e.bind(this,o))}.bind(this))},loadFullSizePicture:function(t){var e=Object(n.a)("<img>").addClass("preload-slideshow-image").appendTo(this.$preloadContainer).attr("src",this.getPictureUrl(t)).on("load",function(i){var n=s.a.findIndex(this.pictures,(function(e){return t.uuid===e.uuid}));this.domPictures[n].css({"background-image":'url("'.concat(this.getPictureUrl(t),'")')}),this.domPictures[n].removeClass("lqip"),e.remove(),this.trigger("loaded")}.bind(this)).on("error",function(i){var n=s.a.findIndex(this.pictures,(function(e){return t.uuid===e.uuid}));this.domPictures[n].removeClass("lqip"),e.remove(),this.trigger("loaded"),RM.screenshot||e.remove()}.bind(this))},initCursor:function(){this.cursor=0,this.currentSlide=this.domPictures[this.cursor],this.domPictures[this.cursor+1]&&(this.nextSlide=this.domPictures[this.cursor+1])},startAnimationLoop:function(){this.isAnimationRunning=!0,this.selectedSlide=null,this.currentSlide||this.initCursor(),this.slideshowLouncher=setTimeout(function t(){this.fadeAnimation(),this.slideshowLouncher=setTimeout(t.bind(this),1e3*this.delay)}.bind(this),1e3*this.delay)},fadeAnimation:function(){var t;this.lastSlideshowAnimationStart=new Date,this.domPictures.length<2||(this.currentSlide&&this.nextSlide||this.initCursor(),this.cursor+1<this.domPictures.length?(this.currentSlide.removeClass("fade-in").addClass("fade-out"),t=this.cursor,setTimeout(function(){this.domPictures[t]&&this.domPictures[t].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.domPictures[t+1].css({"z-index":2}),this.domPictures[t+2]?this.domPictures[t+2].css({"z-index":1,display:"block"}):this.domPictures[0].css({"z-index":1,display:"block"})}.bind(this),1e3*this.crossfade),this.cursor+=1,this.currentSlide=this.domPictures[this.cursor],this.domPictures[this.cursor+1]?this.nextSlide=this.domPictures[this.cursor+1]:this.nextSlide=this.domPictures[0]):(this.currentSlide.removeClass("fade-in").addClass("fade-out"),t=this.cursor,setTimeout(function(){this.domPictures[t]&&this.domPictures[t].css({"z-index":0,"transition-duration":"0s",display:"none"}).removeClass("fade-out").addClass("fade-in").css({"transition-duration":this.crossfade+"s"}),this.domPictures[0].css({"z-index":2}),this.domPictures[1].css({"z-index":1,display:"block"})}.bind(this),1e3*this.crossfade),this.cursor=0,this.currentSlide=this.domPictures[this.cursor],this.nextSlide=this.domPictures[this.cursor+1]))},stopAnimationLoop:function(t){this.isAnimationRunning=!1,clearTimeout(this.slideshowLouncher),t&&"function"==typeof t&&t()},destroy:function(){this.rendered=!1,this.stopAnimationLoop(this.removePictures.bind(this))}});e.a=l},"10Cz":function(t,e,i){"use strict";var n=i("pv3P");i.n(n).a},"1cLU":function(t,e,i){"use strict";var n=i("vOnD"),o=i("q1tI"),a=i.n(o),s=i("iC7s"),r=i("lU33"),l=i("8AXF"),c=i("tZHv"),d=i("za5s");function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var u,p,g=(u=s.Qb,p=1,function(t){if(Array.isArray(t))return t}(u)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}}(u,p)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}(u,p)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],m=Object(n.e)(s.zb).withConfig({displayName:"RmFooter___StyledText"})(["display:inline-block;text-decoration:none;font-style:normal;&:hover{color:",";}"],(function(t){return t._css})),f=function(t){var e=t.label,i=t.url,n=t.showComma,o=t.isMobile;return(a.a.createElement(a.a.Fragment,null,a.a.createElement(m,{as:"a",fontFamily:"Graphik",color:"darkGray",fontWeight:400,fontSize:12,letterSpacing:-.04,lineHeight:o?"1":"24px",href:i,_css:Object(d.themeGet)("colors.orange")},e),n&&a.a.createElement(s.zb,{fontFamily:"Graphik",color:"darkGray",fontWeight:400,fontSize:12,letterSpacing:-.04,lineHeight:o?"1":"24px"},","," ")))},v=Object(n.e)(s.zb).withConfig({displayName:"RmFooter___StyledText2"})(["font-style:normal;"]),b=Object(n.e)(s.m).withConfig({displayName:"RmFooter___StyledBox"})(["",""],(function(t){return t._css2})),_=Object(n.e)(s.zb).withConfig({displayName:"RmFooter___StyledText3"})(["display:inline-block;text-decoration:none;font-style:normal;&:hover{color:",";}"],(function(t){return t._css3})),y=function(t){var e=t.items,i=t.width,n=t.title,o=t.isMobile;return(a.a.createElement(s.m,{width:i},a.a.createElement(s.m,{borderBottom:"1px solid rgba(128, 128, 128, 0.24)",pb:"6px",mb:"16px"},a.a.createElement(v,{fontFamily:"Graphik",fontWeight:400,fontSize:16,letterSpacing:-.04,lineHeight:"24px",color:"darkGray"},n)),a.a.createElement(b,{_css2:e.length>1&&!o?"display: flex; align-items: flex-start; justify-content: space-between;":""},e.map((function(t,i){return a.a.createElement(s.m,{key:"ul-".concat(i),mb:o&&t.mobileSeparator?36:void 0},t.items.map((function(t,n){return a.a.createElement(s.m,{mr:e.length-1!==i||o?void 0:30,key:"ul-".concat(i,"-li-").concat(n)},a.a.createElement(_,{as:"a",href:t.url,color:"white",fontFamily:"Graphik",fontWeight:400,fontSize:16,letterSpacing:-.04,lineHeight:"24px",_css3:Object(d.themeGet)("colors.orange")},t.label))})))})))))},w=Object(n.e)(s.m).withConfig({displayName:"RmFooter___StyledBox2"})([""," ",""],(function(t){return t._css4}),(function(t){return t._css5})),k=Object(n.e)(s.C).withConfig({displayName:"RmFooter___StyledFlex"})(["",""],(function(t){return t._css6})),S=Object(n.e)(s.C).withConfig({displayName:"RmFooter___StyledFlex2"})(["",""],(function(t){return t._css7}));e.a=function(){var t=c.a.readymag_host,e=Object(o.useContext)(l.BackboneContext).model;return a.a.createElement(r.a,{query:"(min-width: ".concat(g,")")},(function(i){var n=e&&e.isMobileViewport||!i;return(a.a.createElement(w,{bg:"rgb(40, 40, 40)",height:"100%",width:"100%",_css4:e&&e.transform?"padding: 0 !important; transform: ".concat(e.transform,";"):"",_css5:e&&e.zoom?"zoom: ".concat(e.zoom,";"):""},a.a.createElement(s.m,{m:"0 auto",width:n?"100%":1024,height:"100%",p:"58px 20px 16px"},a.a.createElement(k,{alignItems:"flex-start",justifyContent:"space-between",mb:n?76:38,_css6:n?"display: block":""},a.a.createElement(y,{title:"Company",isMobile:n,width:n?"100%":230,items:[{items:[{label:"About",url:"".concat(t,"/about/")},{label:"R/masters",url:"".concat(t,"/examples/r-masters")}]}]}),a.a.createElement(y,{title:"News",isMobile:n,width:n?"100%":482,items:[{mobileSeparator:!0,items:[{label:"Product updates",url:"".concat(t,"/readymag/product-updates/")},{label:"Subscribe to newsletter",url:"http://subscribe.readymag.com/"},{label:"Medium",url:"https://medium.com/@readymag"}]},{mobileSeparator:!1,items:[{label:"Facebook",url:"https://www.facebook.com/readymag"},{label:"Twitter",url:"https://twitter.com/readymag"},{label:"Are.na",url:"https://www.are.na/readymag"}]},{mobileSeparator:!0,items:[{label:"Dribbble",url:"https://dribbble.com/readymag"},{label:"Instagram",url:"https://www.instagram.com/readymag/"},{label:"Pinterest",url:"https://www.pinterest.ru/readymagpins/boards/"}]}]}),a.a.createElement(y,{title:"Support",isMobile:n,width:n?"100%":230,items:[{items:[{label:"Templates",url:"".concat(t,"/templates")},{label:"Help",url:"https://help.readymag.com/"},{label:"support@readymag.com",url:"mailto:support@readymag.com"}]}]})),a.a.createElement(S,{alignItems:"flex-start",_css7:n?"display: block;":""},a.a.createElement(s.m,{width:n?"100%":252},a.a.createElement(s.zb,{fontFamily:"Graphik",color:"darkGray",fontWeight:400,fontSize:12,letterSpacing:-.04,lineHeight:n?"1":"24px"},"© ",(new Date).getFullYear()," Readymag Inc.")),a.a.createElement(s.m,{width:n?"100%":""},a.a.createElement(f,{label:"Terms of service",url:"".concat(t,"/readymag/terms-and-privacy/"),showComma:!0,isMobile:n}),a.a.createElement(f,{label:"Privacy policy",url:"".concat(t,"/readymag/terms-and-privacy/2/"),isMobile:n}))))))}))}},"1ljF":function(module,exports){module.exports={"template-constructor-workspace-inside-block-widget-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="widget-selector">\n\n        <div class="widget" data-block-type="picture">\n\t    \t<div class="icon"></div>\n\t        <div class="caption">Image</div>\n        </div>\n\n\n\t    <div class="widget" data-block-type="text">\n\t\t    <div class="icon"></div>\n\t\t    <div class="caption">Text</div>\n\t    </div>\n\n    </div>\n\n';return __p}}},"2EI4":function(t,e,i){},"2d4q":function(module,exports){module.exports={"template-constructor-control-shape_1x1":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Equilateral" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},"2r+I":function(t,e,i){"use strict";var n=i("Hp7M");i.n(n).a},"38JW":function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("secl"),l=i.n(r),c=i("Zuws"),d=i.n(c),h=i("OTSC"),u=i("i7aS"),p=i("gobI"),g=i("roQd"),m=i("HwMs"),f=i("DqjY"),v=i("WoDZ"),b=i("v92f"),_=i("rVpV"),y=i("G3+Z"),w=i("gdoY"),k=i("QNiq");function S(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function x(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function C(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?x(Object(i),!0).forEach((function(e){O(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function O(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var P=C(C({},l.a),d.a),j=a.a.View.extend({template:P["template-viewer-page"],initialize:function(t){return s.a.bindAll(this),this.mag=t.mag,this.router=t.router,this.$container=t.$container,this.viewerType=t.viewerType,this.totalPages=t.totalPages,this.isStickyVerticalViewer=t.isStickyVerticalViewer,this.widgetsData=t.pageData.wids,s.a.defaults(t.pageData,{title:"",width:this.mag.getViewportSetting("width"),height:this.mag.getViewportSetting("min_height")}),s.a.extend(this,s.a.omit(t.pageData,["wids","widgets"])),this.contentPosition={left:0,top:0},this},render:function(){return this.setElement(this.template({isStickyVerticalViewer:this.isStickyVerticalViewer})),this.$el.appendTo(this.$container),RM.screenshot||Modernizr.csspositionsticky||Object(n.a)(".polyfill-sticky").Stickyfill(),this.zIndex=this.totalPages-this.num+2,"vertical"==this.viewerType&&this.$el.css("z-index",this.zIndex),this.$content=this.$(".page-content-container"),this.$scrollWrapper=this.$(".content-scroll-wrapper"),this.$scrollWrapper.one("scroll",this.fixSafariScroll),this.$fixedBgContainer=this.$(".page-fixed-bg-container"),this.$fixedPositionContainer=this.$(".fixed-position-container"),this.$fixedPositionContainerTop=this.$(".fixed-position-container-top"),this.$contentBounds=this.$(".content-bounds"),this.pageViewport=this.getPageViewport(),"horizontal"==this.viewerType&&this.$scrollWrapper.bind("scroll",this.onScroll),this.createLQBackground(),RM.screenshot==this._id&&(this.$el.css({overflow:"hidden",height:Math.max(this.height,672),width:1024,position:"relative"}),"true"===h.default.queryUrlGetParam("pdf")&&(this.$fixedPositionContainer.css({height:"100%"}),this.$fixedPositionContainerTop.css({height:"100%"})),this.onResize(),this.on("pageLoaded",(function(){this.mag.router.sendReadyEvent({page:this})}),this)),this},show:function(){return this.shown||(this.$el.removeClass("hidden"),this.shown=!0,"horizontal"==this.viewerType&&this.onResize(),this.widgets&&this.lastViewportUsedForWidgetsCreation==this.pageViewport||this.createWidgetsForCurrentViewport()),this},start:function(t){if(!this.started||t&&t.forceStart)return this.started=!0,this.trigger("started"),t=t||{},s.a.each(this.widgets,(function(e){(!t||!t.widgetTypes||s.a.indexOf(t.widgetTypes,e.type)>=0)&&e.start()})),this.focusPage(),this.$scrollWrapper.addClass("accelerated-scroll"),this.animations&&this.animations.start(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.start(),this},stop:function(t){if(this.started)return t=t||{},this.started=!1,this.trigger("stopped"),this.$scrollWrapper.removeClass("accelerated-scroll"),s.a.each(this.widgets,(function(e){(!t||!t.widgetTypes||s.a.indexOf(t.widgetTypes,e.type)>=0)&&e.stop()})),this.animations&&this.animations.stop(),this.mag.aboveGlobalAnimations&&this.mag.aboveGlobalAnimations.stop(),this},getUrl:function(){return window.location.protocol+"//"+window.location.hostname+"/p"+this.num_id+"/"},setPosition:function(t,e){this.lastPosition==t&&this.lastNeighbour==e||(this.$el.removeClass("center-page prev-page next-page neighbour").addClass(t+"-page "+(e?"neighbour":"")),this.lastPosition=t,this.lastNeighbour=e)},getScroll:function(){return this.visibleWidgetsCoords.scrollTop},scrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode=!0;var e,i,n=this.pageHeight-this.pageBgHeight;t<0?(e=-t,i=0):n>=t?(e=0,i=-t):(e=n-t,i=-n),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=-i,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.trigger("page scroll",this.getScroll()),this.isStickyVerticalViewer||(this.$el.css("top",0),h.default.applyTransform(this.$el,e?"translateY("+e+"px) translateZ(0)":""),this.hasFixedWidgets?this.$contentBounds.css("top",i):h.default.applyTransform(this.$contentBounds,i?"translateY("+i+"px)":""))},resetScrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=0,this.animations&&this.animations.onScroll({forceApply:!this.isStickyVerticalViewer}),this.isStickyVerticalViewer||(this.$el.css("top",""),h.default.applyTransform(this.$el,""),this.hasFixedWidgets?this.$contentBounds.css("top",0):h.default.applyTransform(this.$contentBounds,"")))},hide:function(){return this.shown&&(this.$el.addClass("hidden"),this.shown=!1),this},destroyAllWidgets:function(t){this.loaded=!1,this.videoBGStarted=!1,s.a.each(this.widgets,function(e,i){var n=this.widgetsData.some((function(t){var i=g.a.normalizeAnimations(t.animation),n=t._id===e._id&&Boolean(i.find((function(t){return!g.a.isEmpty(t)}))),o=t._id===e._id&&(t.viewport_default&&t.viewport_default.hidden||t.viewport_tablet_portrait&&t.viewport_tablet_portrait.hidden||t.viewport_phone_portrait&&t.viewport_phone_portrait.hidden||t.hidden);return n||o}));t&&t.includes(e.type)&&!n||(e.destroy(),e.off(),delete this.widgets[i])}.bind(this)),this.animations&&this.animations.destroy(),delete this.animations,clearTimeout(this.fireReadyTimeout)},destroy:function(){return this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.resetWaitForAnimationEnd(),this.destroyLQBackground({animate:!1}),this.destroyAllWidgets(),this.remove()},onFormFocus:function(t){!Modernizr.safari&&k.a.isDesktop||(t=s.a.isUndefined(t)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():t,this.$fixedBgContainer.css({top:t}))},onFormBlur:function(){!Modernizr.safari&&k.a.isDesktop||this.$fixedBgContainer.css({top:0})},onScrollWithFormInFocus:function(t){!Modernizr.safari&&k.a.isDesktop||(t=s.a.isUndefined(t)?this.$scrollWrapper&&this.$scrollWrapper.scrollTop():t,this.$fixedBgContainer.css({top:t}))},isSwipeInProgress:function(){return this.$el.hasClass("swiping")},getPageZIndex:function(){return this.zIndex||1},getImmediatePack:function(){return s.a.filter(this.widgets,(function(t){return t.canRenderImmediately()&&!t.rendered}))},getWidgetsPacks:function(){if(!this.widgets)return[];var t,e,i,n=this.visibleWidgetsCoords,o=(n.top+(n.scrollTop||0))/n.scale,a=(n.bottom+(n.scrollTop||0))/n.scale-o,s=[],r=[];if(!this.BGWidget||this.BGWidget.rendered||this.BGWidget.loaded||r.push(this.BGWidget),this.fixedWidgets&&this.fixedWidgets.length)for(t=0;t<this.fixedWidgets.length;t++)(i=this.fixedWidgets[t]).rendered||i.loaded||i.canRenderImmediately()||r.push(i);var l,c,d=[],h=99999,u=-99999,p=!1;for(t=0;t<this.widgets.length;t++)(e=this.widgets[t]).rendered||e.loaded||"background"==e.type||e.fixed_position||(l=(c=j.getScreenIndex(e,o,a,!0)).index,h=Math.min(c.start,h),u=Math.max(c.end,u),e.screenIndex=l,l!==1/0&&(d[l]=d[l]||[],d[l].push(e)),p=!0);if(p){for(d[0]&&s.push(d[0]),d[1]&&s.push(d[1]),d[-1]&&s.push(d[-1]),t=2;t<=u;t++)d[t]&&s.push(d[t]);for(t=-2;t>=h;t--)d[t]&&s.push(d[t])}return r.length&&(s.length?s[0]=r.concat(s[0]):s=[r]),s},loadWidgetsPack:function(t,e){var i,n=0,o=0,a=0;for(i=0;i<t.length;i++){var s=t[i];s.rendered||s.loaded||s.destroyed||(s.canRenderImmediately()||(n++,s.on("loaded destroyed",r,s)),a++,s.render())}function r(){o++,n==o&&e()}a||e(),n==o&&e()},loadForScreenshotMode:function(){s.a.each(this.widgets,function(){var t,e=(t=regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:t.sent.start();case 4:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){S(a,n,o,s,r,"next",t)}function r(t){S(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(t){return e.apply(this,arguments)}}())},createWidgetsForCurrentViewport:function(){this.destroyAllWidgets(["video"]),this.BGWidget=null,this.fixedWidgets=[];var t=this.pageViewport,e=[],i=[],n=99999,o=this,a=this;s.a.each(this.widgetsData,function(e){var o=a.getWidgetViewportData(e,t),s=!this.mag.isPreview&&g.a.hasExpired(o);!w.a[o.type]||o.hidden||s||(!o.fixed_position&&o.z&&"background"!=o.type&&(n=Math.min(n,o.z)),i.push(o))}.bind(this)),99999==n&&(n=0),s.a.each(i,function(t){var i=p.a.isAllowed()&&p.a.isTransform();t.fixed_position&&(t.z<n||k.a.isDesktop&&!this.mag.isStickyVerticalViewer&&!i)?t.$fixedContainer=a.$fixedPositionContainer:t.$fixedContainer=a.$fixedPositionContainerTop;var s=null;this.widgets&&this.widgets.length&&(s=this.widgets.find((function(e){return!!e&&e._id===t._id})));var r=s||new w.a[t.type](t,o);"video"===r.type&&(r.updateWidgetData(t,o),r.applyBoxStyle(),r.updateVideoFrameSize(t.w,t.h)),"background"==r.type&&(a.BGWidget=r,a.hasVideoBG=r.hasVideoBG()),r.isValid()&&(r.fixed_position&&a.fixedWidgets.push(r),e.push(r))}.bind(this)),this.animations=new m.a({page:this,widgets:e}),this.widgets=s.a.sortBy(e,"y"),this.signalOnLoading(),this._onFontsLoad=[],this._widgetsWithFontsToLoad=[],this._fontLoaderCalled=0,this._widgetsWithFontsCount=s.a.reduce(this.widgets,(function(t,e){return t+(e.hasFontsToLoad()?1:0)}),0),this._widgetsWithLoadAnimation=s.a.reduce(this.widgets,(function(t,e){return t+(e.hasLoadAnimation()?1:0)}),0),this.hasFixedWidgets=!!this.fixedWidgets.length;var r=p.a.isAllowed()&&p.a.isTransform();this.$el.removeClass("page-with-fixeds-desktop page-with-fixeds-sticky-or-mobile").toggleClass("page-with-fixeds-desktop",this.hasFixedWidgets&&k.a.isDesktop).toggleClass("page-with-fixeds-sticky-or-mobile",!(!this.hasFixedWidgets||!this.isStickyVerticalViewer&&k.a.isDesktop&&!r)),this.hasFixedWidgets&&!this.retargetScroll&&"horizontal"==this.viewerType&&k.a.isDesktop&&(this.retargetScroll=y.a&&Object(y.a)(this.$fixedPositionContainerTop.get(0),this.$scrollWrapper.get(0)),y.a&&Object(y.a)(this.$fixedPositionContainer.get(0),this.$scrollWrapper.get(0))),this.lastViewportUsedForWidgetsCreation=t},getWidgetViewportData:function(t,e){var i=s.a.clone(t),n={},o=["text_w","text_h","em_w","anchor_link_pos","font-size","font-style","font-weight","font-family","color","color-opacity","letter-spacing","hover-color","hover-color-opacity","current-font-size","current-font-style","current-font-weight","current-font-family","current-color","current-color-opacity","current-letter-spacing","background-color","background-color-opacity","hover-background-color","hover-background-color-opacity","current-background-color","current-background-color-opacity","border-radius","border-width","border-color","border-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity"];return"default"!=e&&t["viewport_"+e]&&(s.a.each(b.b.viewport_fields[t.type]||b.b.viewport_fields_common,(function(i){if(("shape"!=t.type||"borders"!=i&&"weight"!=i&&"bg_color"!=i)&&("background"!=t.type||"picture"!=i)){if(n[i]=void 0,_.a.isGlobalKey(i)){var a=_.a.getGlobalPrefixedKey(i);n[a]=void 0}n[i]="button"===t.type&&!s.a.has(t["viewport_"+e],i)&&o.includes(i)?t[i]:void 0}})),s.a.extend(i,n,s.a.omit(t["viewport_"+e],["_id","modelType"]))),t.is_global&&_.a.fillUniqueValues(i,this._id,{}),i},getWidgetById:function(t){return s.a.findWhere(this.widgets,{_id:t})},getWidgetDataById:function(t){return s.a.findWhere(this.widgetsData,{_id:t})},signalOnLoading:function(){var t=this.widgets.length,e=this,i={};function n(){t--,clearTimeout(i[this._id]),"background"==this.type&&e.destroyLQBackground({animate:!0}),this.hasLoadAnimation()&&(e._widgetsWithLoadAnimation--,e._widgetsWithLoadAnimation||(e.loadAnimationsReady=!0,e.trigger("loadAnimationsReady"))),t||(e.fireReadyTimeout=setTimeout(o,200)),e.trigger("loaded"+this._id)}function o(){e.loaded=!0,e.trigger("pageLoaded")}s.a.each(this.widgets,(function(t){RM.screenshot&&(i[t._id]=setTimeout((function(){t.widgetIsLoaded()}),2e4)),t.on("loaded",n,t)}),this),this.BGWidget&&this.hasVideoBG&&this.BGWidget.on("videoBGStarted",(function(){e.videoBGStarted=!0,s.a.delay((function(){e.trigger("videoBGStarted")}),1300)}),this.BGWidget),0==t&&(this.fireReadyTimeout=setTimeout(o,200))},getFontsVariations:function(t,e){var i=f.a.getUsedFontsFromWidgetsModels({includeCustom:!0,customList:s.a.filter(this.mag.edit_params.fonts,{provider:"custom"}),models:t,excludeUnusedDefault:e,activeViewports:[this.getPageViewport()]}),n=[];return s.a.each(i,(function(t){for(var e=0;e<t.used_variations.length;e++)n.push({fontFamily:t.css_name,fontWeight:100*(t.used_variations[e].substr(1,1)-0),fontStyle:"n"==t.used_variations[e].substr(0,1)?"normal":"italic"})})),n},addFontsToLoad:function(t,e){if(this._widgetsWithFontsToLoad.push(t),this._onFontsLoad.push(e),this._fontLoaderCalled++,this._fontLoaderCalled==this._widgetsWithFontsCount){var i=this.getFontsVariations(this._widgetsWithFontsToLoad);if(s.a.isEmpty(i))return void this.onAllFontsLoad();this._fontsToLoadLeft=i.length,s.a.each(i,s.a.bind((function(t){f.a.exactWaitForFontLoad(t.fontFamily,t.fontWeight,t.fontStyle,this.onOneFontLoad)}),this))}},onOneFontLoad:function(t,e,i,n){this._fontsToLoadLeft--,0==this._fontsToLoadLeft&&s.a.delay(this.onAllFontsLoad,500)},onAllFontsLoad:function(){s.a.each(this._onFontsLoad,(function(t){t&&t()}))},updateViewport:function(){var t=this.getPageViewport();t!=this.pageViewport&&(this.pageViewport=t,this.createLQBackground(),this.shown&&(this.createWidgetsForCurrentViewport(),this.started&&(this.started=!1,this.start())))},waitForAnimationEnd:function(t){this.resetWaitHook=h.default.waitForTransitionEnd(this.$el,this.mag.getPageTransitionTime()+1e3,"transform",t)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},backToTop:function(){this.scrollTo(0)},scrollTo:function(t){this.$scrollWrapper.finish(),this.$scrollWrapper&&this.$scrollWrapper.animate({scrollTop:t},500)},focusPage:function(){k.a.isDesktop&&"vertical"!=this.viewerType&&0==this.$el[0].getBoundingClientRect().left&&(this.$content.focus(),this.mag.$el.scrollTop(0))},markAsLast:function(){this.lastPage=!0,this.$el.addClass("last")},isLastPage:function(){return!!this.lastPage},isBottomArrowVisible:function(){return!this.wasScrolled&&this.scrollable},scrollPageALittle:function(){this.$scrollWrapper.animate({scrollTop:Object(n.a)(window).height()/2},500)},getPageViewport:function(){var t=this.mag.viewport,e=this;if("default"==t||RM.screenshot)return"default";if(this["viewport_"+t]&&this["viewport_"+t].enabled)return t;var i=s.a.findWhere(b.b.viewports,{name:t}).width,n=s.a.reduce(b.b.viewports,(function(t,n,o){return("default"==n.name||e["viewport_"+n.name]&&e["viewport_"+n.name].enabled)&&Math.abs(n.width-i)<=Math.abs(b.b.viewports[t].width-i)?o:t}),0);return b.b.viewports[n].name},onResize:function(t){if(t=t||{},this.shown||"horizontal"!=this.viewerType){var e=this.mag.getContainerSizeCached(),i=this.mag.getViewportSetting("width",this.pageViewport),n=this.mag.getScale(this.pageViewport),o=this["viewport_"+this.pageViewport]&&this["viewport_"+this.pageViewport].height||this.height,a={width:i,height:o,scaledWidth:Math.round(i*n),scaledHeight:Math.round(o*n),scale:n},s=Math.min(a.scaledWidth,e.width),r=a.scaledHeight,l=Math.max(((RM.screenshot?672:e.height)-r)/2,0),c=Math.max(((RM.screenshot?1024:e.width)-s)/2,0),d={width:a.width,height:a.height,top:l/(p.a.isZoom()&&p.a.isDesktopDefault()?Math.max(n,1):1),left:c};return n>=1&&p.a.isAllowed()&&p.a.isZoom()&&(d.zoom=n,d.left=0),this.$content.removeAttr("style"),this.$content.css(d),this.contentPosition={left:c,top:l},1===p.a.normalize(n,"transform")?(h.default.applyTransform(this.$content,""),a.scale=1):h.default.applyTransform(this.$content,"scale("+a.scale+")"),this.contentHeight=a.height,this.pageHeight=Math.max(e.height,a.scaledHeight),this.pageBgHeight=e.height,this.pageWidth=a.width,"vertical"==this.viewerType&&this.isStickyVerticalViewer&&this.$el.css({height:this.pageHeight,top:t.absolutePosition}),this.scale=n,this.$contentBounds.css({width:e.width,height:this.pageHeight}),null!=this.prevScale&&this.prevScale!=this.scale&&(this.animations&&this.animations.updateTimelines(),p.a.isOn(this.scale)&&this.animations&&(this.animations.resetStarted(),this.animations.start.__debounced())),this.animations&&this.animations.onResize(),this.trigger("resize",{containerSize:e,contentPosition:this.contentPosition}),this.scrollable=r-this.mag.SCROLLABLE_TRESHOLD>e.height,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.top=-l,this.visibleWidgetsCoords.bottom=-l+e.height,this.visibleWidgetsCoords.scale=n,this.resizeLQBackground(),this.prevScale=this.scale,this.pageHeight}},onScroll:function(){this.wasScrolled=!0,this.mag.recalcBottomArrowState(this),this.visibleWidgetsCoords=this.visibleWidgetsCoords||{},this.visibleWidgetsCoords.scrollTop=this.$scrollWrapper.scrollTop(),this.mag.onCurrentPageScroll(this,this.visibleWidgetsCoords.scrollTop),this.animations&&this.animations.onScroll(),this.trigger("page scroll",this.visibleWidgetsCoords.scrollTop)},isCurrent:function(){return this.num===this.mag.currentPage.num},createLQBackground:function(){if(!RM.screenshot){var t=this.getWidgetViewportData(s.a.findWhere(this.widgetsData,{type:"background"}),this.pageViewport);if(this.LQBG){if("picture"===t.selectedType&&"picture"===this.LQBG.selectedType&&t.picture&&this.LQBG.picture&&t.picture.poorUrl===this.LQBG.picture.poorUrl||"video"===t.selectedType&&"video"===this.LQBG.selectedType&&t.video&&this.LQBG.video&&t.video.thumbnail_url===this.LQBG.video.thumbnail_url)return void this.resizeLQBackground();this.destroyLQBackground({animate:!1})}if(this.$fixedBgContainer.css("background-color","#"+t.color),t.picture&&"picture"===t.selectedType&&(t.picture.poorUrl||u.a.useLambdaUrl(t.picture))||t.video&&"video"===t.selectedType&&t.video.thumbnail_url){this.LQBG=s.a.extend({},t);var e=P["template-viewer-widget-background"];if(this.LQBG.$el=Object(n.a)(e({data:t})),this.LQBG.$el.addClass("low-quality").appendTo(this.$fixedBgContainer),"picture"===this.LQBG.selectedType){var i=this.LQBG.picture.poorUrl;u.a.useLqipUrl(t.picture)&&(i=u.a.getLqipUrl(this.LQBG.picture),this.LQBG.$el.addClass("lqip").appendTo(this.$fixedBgContainer)),Object(n.a)("<img/>").on("load",s.a.bind((function(){this.LQBG&&this.LQBG.$el.find(".picture-background").css({"background-image":"url(".concat(i,")")})}),this)).attr("src",i)}if("video"===this.LQBG.selectedType){var o=this.LQBG.video.thumbnail_url.replace("http://","https://"),a=Object(n.a)("<img/>").addClass("poster").css("opacity",0).appendTo(this.LQBG.$el.find(".video-background .video-container"));a.on("load",s.a.bind((function(){a.css({width:"",height:""}).css("opacity",1);var t=a[0].width,e=a[0].height;this.LQBG&&!this.LQBG.video.aspect_poster&&(this.LQBG.video.aspect_poster=t/e),this.resizeLQBackground()}),this)).attr("src",o)}}}},resizeLQBackground:function(){!RM.screenshot&&this.LQBG&&"video"===this.LQBG.selectedType&&v.a.setVideoPosition({mag:this.mag,$container:this.LQBG.$el.find(".video-background .video-container"),$media:this.LQBG.$el.find(".video-background .video-container .poster"),provider:this.LQBG.video.provider_name,aspect_poster:this.LQBG.video.aspect_poster,aspect_real:this.LQBG.video.aspect_real,controls_remove:!0})},destroyLQBackground:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!RM.screenshot&&this.LQBG){t.animate=t.animate&&"picture"===this.LQBG.selectedType&&this.started;var e=this.LQBG.$el;this.LQBG=null,t.animate?(e.css("opacity",0),setTimeout((function(){e.remove()}),400)):e.remove()}},fixSafariScroll:function(t){Modernizr.safari&&k.a.isDesktop&&(0!==this.$scrollWrapper.scrollTop()&&this.$scrollWrapper.scrollTop(0))}},{getScreenIndex:function(t,e,i,n){var o,a=Math.floor((t.y-e)/i),s=Math.ceil((t.y+t.h-e)/i)-1;return n&&t.canRenderImmediately()?o=1/0:t.hasLoadAnimation()||a<=0&&s>=0?o=0:a>0?o=a:s<0&&(o=s),{start:a,end:s!==1/0?s:0,index:o}}});e.a=j},"38uW":function(t,e,i){"use strict";i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){return s})),i.d(e,"d",(function(){return r})),i.d(e,"b",(function(){return l}));var n=i("9Juw"),o=i("w5C2"),a="lineHeight",s=function(t){var e=t.editorState,i=t.block,o=Object(n.h)({editorState:e,block:i,key:a});return"number"==typeof o?o:void 0},r=function(t){var e=t.block,i=t.editorState,o=t.lineHeight;return Object(n.u)({editorState:i,block:e,key:a,value:o})},l=function(t){var e=t.editorState,i=t.method,n=s({editorState:e}),a="number"==typeof n?n:o.b.lineHeight;if(8!==n)return"increase"===i?r({editorState:e,lineHeight:a+1}):"decrease"===i?r({editorState:e,lineHeight:Math.max(8,a-1)}):void 0}},"3Qzt":function(t,e,i){"use strict";e.a={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}}},"3TY3":function(t,e,i){"use strict";i.r(e);var n=i("vOnD"),o=i("q1tI"),a=i.n(o),s=i("iC7s"),r=i("zn5y"),l=i.n(r),c=i("8AXF"),d=i("xG9w");function h(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var p=window.requestIdleCallback||function(t){Object(d.defer)(t)},g=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.imageInstances=[],this.imagesLoaded=0,this.isLoading=!1,this.areAllImagesLoaded=!1,this.seekCallbackData=void 0,Object(d.range)(1,i+1).map((function(t){return function(t,e){return"".concat(t,"/").concat(e.toString().padStart(6,"0"),".jpg")}(e,t)})).forEach((function(t){n.imageInstances.push({image:new Image,isLoaded:!1,url:t})}))}var e,i,n,o,a;return e=t,(i=[{key:"preloadFirstImage",value:function(){this.loadImage(0)}},{key:"loadImage",value:function(t){var e=this,i=this.imageInstances[t];i&&!i.isLoaded&&(i.image.onload=function(){i.isLoaded=!0,e.imagesLoaded++,e.imageInstances.length===e.imagesLoaded&&(e.areAllImagesLoaded=!0,e.isLoading=!1,console.log("All ".concat(e.imageInstances.length," images loaded."))),e.seekCallbackData&&e.seekCallbackData.index===t&&(e.seekCallbackData.callback(i.image),e.seekCallbackData=void 0)},p((function(){i.image.src=i.url})))}},{key:"startLoad",value:function(){var t=this;if(!this.isLoading){this.areAllImagesLoaded=!1,this.isLoading=!0;for(var e=[0],i=Math.ceil(Math.log(this.imageInstances.length)/Math.log(2)),n=1;n<=i;n++)for(var o=Math.pow(2,n),a=Math.ceil(this.imageInstances.length/o),s=1;s<=o;s++){var r=s*a;e.push(r)}(e=Object(d.uniq)(e).filter((function(e){return e<t.imageInstances.length}))).forEach((function(e){return t.loadImage(e)}))}}},{key:"stopLoad",value:function(){this.isLoading&&(this.imageInstances.forEach((function(t){t.isLoaded||p((function(){t.image.onload=null,t.image.src=""}))})),this.isLoading=!1)}},{key:"seekImageByIndex",value:(o=regeneratorRuntime.mark((function t(e){var i,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.seekCallbackData&&(this.seekCallbackData.callback(void 0),this.seekCallbackData=void 0),i=e,t.abrupt("return",new Promise((function(t){e>n.imageInstances.length-1&&(i=n.imageInstances.length-1),e<0&&(i=0);var o=n.imageInstances[i];if(o.isLoaded)return t(o.image);n.seekCallbackData={index:i,callback:t}})));case 3:case"end":return t.stop()}}),t,this)})),a=function(){var t=this,e=arguments;return new Promise((function(i,n){var a=o.apply(t,e);function s(t){h(a,i,n,s,r,"next",t)}function r(t){h(a,i,n,s,r,"throw",t)}s(void 0)}))},function(t){return a.apply(this,arguments)})},{key:"getImageIndexByTimelinePercent",value:function(t){return Math.floor(this.imageInstances.length*t)}},{key:"getNumberOfImages",value:function(){return this.imageInstances.length}}])&&u(e.prototype,i),n&&u(e,n),t}(),m=i("fEUr"),f=i("LDvm"),v=i("tZHv"),b=i("tf3M"),_=i("3Qzt");function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w,k=Math.floor(25);!function(t){t[t.Precise=0]="Precise",t[t.Lazy=1]="Lazy"}(w||(w={}));var S=window.requestAnimationFrame||function(t){Object(d.defer)(t)},x=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.easingType=w.Lazy,this.lastEasingCallTime=0,this.lastTargetIndex=0,this.canvas=e,this.imageLoader=i,this.easingType=n}var e,i,n;return e=t,(i=[{key:"drawImageByIndex",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i?this.startEasingSequence(t):this.imageLoader.seekImageByIndex(t).then((function(i){return e.drawImage(i,t)}))}},{key:"drawImageByTimelinePercent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.imageLoader.getImageIndexByTimelinePercent(t);return this.drawImageByIndex(i,e)}},{key:"drawImage",value:function(t,e){var i=this;return new Promise((function(n,o){if(!t||e===i.lastDrawnFrameIndex)return n();var a,s,r=i.canvas.getContext("2d");if(!r)return o(new Error("Cannot find context to paint on"));var l=0,c=0,d=t.height/t.width;i.canvas.height/i.canvas.width>d?(a=i.canvas.height/d,s=i.canvas.height,l=(i.canvas.width-a)/2):(a=i.canvas.width,s=i.canvas.width*d,c=(i.canvas.height-s)/2),S((function(){r.drawImage(t,0,0,t.width,t.height,l,c,a,s),i.lastDrawnFrameIndex=e,n()}))}))}},{key:"startEasingSequence",value:function(t){var e=this;clearInterval(this.easingSequenceId);var i=this.lastDrawnFrameIndex||0;return new Promise((function(n){var o=Date.now(),a=o-e.lastEasingCallTime,s=Math.abs(e.lastTargetIndex-t)/a,r=Math.round(s/a*e.imageLoader.getNumberOfImages()*2),l=Math.min(Math.round(.05*e.imageLoader.getNumberOfImages()),k,e.easingType===w.Precise?r:Math.ceil(400/a));e.lastEasingCallTime=o,e.lastTargetIndex=t;var c=t-i,d=t-Math.sign(c)*Math.min(l,Math.abs(t-i)),h=t-d,u=o,p=u+400;e.drawImageByIndex(d),e.easingSequenceId=setInterval((function(){var t=Date.now();if(t>p)return clearInterval(e.easingSequenceId),e.easingSequenceId=void 0,n();var i=(t-u)/400,o=_.a.easeOutCubic(i),a=Math.round(h*o)+d;e.drawImageByIndex(a)}),16)}))}}])&&y(e.prototype,i),n&&y(e,n),t}();function C(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function O(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var T=window.devicePixelRatio||1,I={top:1,center:.5,bottom:0},E=a.a.createContext({model:{pageScale:1,pageContentTop:0,magContainerHeight:0,widgetBoxTop:0,isStarted:!1,canBeUsed:!0,isSelected:!1}}),M=[{},function(){}],R=Object(n.e)(s.v).withConfig({displayName:"Shots___StyledCover"})(["background-repeat:no-repeat;label{position:absolute;cursor:default;z-index:1001;width:100%;height:100%;}"]),A=Object(n.e)(s.B).withConfig({displayName:"Shots___StyledFileInput"})(["position:absolute;z-index:1001;"]),D=Object(n.e)(s.C).withConfig({displayName:"Shots___StyledFlex"})(["transform:translate(-50%,-50%);"]),z=n.e.canvas.withConfig({displayName:"Shots___StyledCanvas"})({objectFit:"cover"}),L=Object(n.e)(s.zb).withConfig({displayName:"Shots___StyledText"})({whiteSpace:"nowrap"}),B=function(t){var e=Object(o.useContext)(c.BackboneContext),i=e.model,n=i._id,r=i.w,d=i.h,h=i.basePath,u=i.numberOfImages,p=i.scrollSpeed,_=void 0===p?1:p,y=i.imageWidth,k=void 0===y?0:y,S=i.imageHeight,$=void 0===S?0:S,B=i.fixed_position,F=i.scrollStartPoint,N=void 0===F?m.c.bottom:F,U=i.playbackType,H=i.startPointOffset,V=i.scrollDelay,W=i.is_full_width,G=i.is_full_height,q=i.useEasing,K=void 0!==q&&q,X=e.modelSave,Y=Object(o.useContext)(E),Z=Y.model,J=Z.currentScrollOffset,Q=Z.hoverPercent,tt=Z.pageScale,et=void 0===tt?1:tt,it=Z.viewport,nt=Z.pageContentTop,ot=void 0===nt?0:nt,at=Z.magContainerHeight,st=void 0===at?0:at,rt=Z.widgetBoxTop,lt=void 0===rt?0:rt,ct=Z.isStarted,dt=void 0!==ct&&ct,ht=Z.canBeUsed,ut=void 0===ht||ht,pt=Z.isSelected,gt=void 0!==pt&&pt,mt=Y.model,ft=j(t.useSharedState?t.useSharedState():M,2),vt=ft[0],bt=vt.isUploading,_t=vt.videoFile,yt=ft[1],wt="viewer"===t.mode,kt=j(Object(o.useState)(!1),2),St=kt[0],xt=kt[1],Ct=Object(o.useRef)(null),Ot=Object(o.useRef)(null),Pt=Ot.current,jt=Object(o.useRef)(null),$t=jt.current,Tt=Object(o.useRef)(null),It=Object(s.Vb)(Tt),Et=It.width,Mt=It.height;Object(o.useEffect)((function(){h&&u&&(Ot.current=new g(h,wt?u:1),Ot.current.preloadFirstImage(),jt.current=new x(Ct.current,Ot.current,U===m.b.hover?w.Lazy:w.Precise),jt.current.drawImageByIndex(0).then((function(){t.onFirstFrameLoaded&&t.onFirstFrameLoaded()})))}),[h]);var Rt=j(Object(o.useState)(null),2),At=Rt[0],Dt=Rt[1];return Object(o.useEffect)((function(){if(At){X(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?O(Object(i),!0).forEach((function(e){P(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):O(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({basePath:At.basePath,imageWidth:At.imageWidth,imageHeight:At.imageHeight,numberOfImages:At.numberOfImages,totalSize:At.totalSize},function(t,e){return t===b.default.prototype.defaults.w&&e===b.default.prototype.defaults.h}(r,d)?function(t,e){if(W||G)return{w:r,h:d};var i=t<=480?t:Math.round(480*t/t);return{w:i,h:e*i/t}}(At.imageWidth||r,At.imageHeight||r):{}))}}),[At]),Object(o.useEffect)((function(){var t=function(){var t,e=(t=regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(f.O)(_t,n);case 3:(e=t.sent)&&e.basePath&&e.imageHeight&&e.imageWidth&&e.numberOfImages&&e.totalSize&&!mt.isDestroyed&&!St?(Dt({basePath:e.basePath,imageWidth:e.imageWidth,imageHeight:e.imageHeight,numberOfImages:e.numberOfImages,totalSize:e.totalSize}),yt({isUploading:!1})):yt({isUploading:!1,uploadError:"Error uploading video"}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),yt({isUploading:!1,uploadError:"Error uploading video"});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){C(a,n,o,s,r,"next",t)}function r(t){C(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(){return e.apply(this,arguments)}}();bt&&!mt.isDestroyed&&t()}),[bt]),Object(o.useEffect)((function(){wt&&Ot.current&&(dt?Ot.current.startLoad():Ot.current.stopLoad())}),[dt]),Object(o.useEffect)((function(){var t;if(Pt)if(wt)if(void 0!==J)t=function(t){var e=t.currentScrollOffset,i=t.pageContentTop,n=t.pageScale,o=t.magContainerHeight,a=t.widgetBoxTop,s=t.scrollStartPoint,r=t.startPointOffset,l=t.scrollSpeed,c=t.scrollDelay,d=i/n,h=o/n,u=e/n;if(t.isFixed)return Math.round((u-c)*l/10);var p=a+d,g=p-h,m=I[s]*(p-g)+g+r;return Math.round((u-m)*l/10)}({currentScrollOffset:J,pageContentTop:ot,pageScale:et,magContainerHeight:st,widgetBoxTop:lt,scrollStartPoint:N,startPointOffset:H,scrollSpeed:_,scrollDelay:V,isFixed:!!B}),null==$t||$t.drawImageByIndex(t,K);else{if(void 0===Q)return;null==$t||$t.drawImageByTimelinePercent(Q,K)}else null==$t||$t.drawImageByIndex(0)}),[J,it,r,d,Q]),Object(o.useEffect)((function(){return t.onFirstRender&&t.onFirstRender(),function(){xt(!0)}}),[]),a.a.createElement(R,{alignItems:"center",justifyContent:"center",bg:"constructor"!==t.mode||h?"transparent":"lightGray",backgroundImage:h?"":"constructor"===t.mode?"url(".concat(l.a,")"):"",width:"100%",height:"100%",backgroundPosition:"center",ref:Tt},"constructor"===t.mode&&a.a.createElement(A,{id:"rm-shots-widget-file-upload-".concat(n),onClick:function(t){t.preventDefault()},readFileData:!1,onChange:function(t){t.size<=v.a.UPLOAD_SHOTS_SIZE_LIMIT&&yt({videoFile:t,isUploading:!0})},dropFile:!bt,accept:"video/*,.mkv"}),bt&&a.a.createElement(D,{position:"absolute",top:"50%",left:"50%",cursor:"default"},a.a.createElement(s.R,{bgColor:"gray",size:"big"})),a.a.createElement(z,{id:n,width:"constructor"===t.mode?k:Math.min(k,Math.floor(r*T)),height:"constructor"===t.mode?$:Math.min($,Math.floor(d*T)),ref:Ct,style:{userSelect:"none",width:"100%",height:"100%"}},"Your browser does not support Canvas element"),"constructor"===t.mode&&!ut&&gt&&Et>476&&Mt>140&&a.a.createElement(s.m,{textAlign:"center",position:"absolute",bottom:"0px",width:"100%",bg:h?"rgba(184,184,184,0.5)":"transparent",p:24},a.a.createElement(L,{color:h?"white":"gray",textStyle:"small"},"Upgrade your account to make the widget work after you publish the project"))," ")};i.d(e,"Shots",(function(){return B})),i.d(e,"ShotsStateContext",(function(){return E}))},"3XvJ":function(module,exports){module.exports={"template-viewer-widget-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           disabled\n           readonly\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"\n           role="button"\n           name="'+(null==(__t=data.text)?"":_.escape(__t))+'"/>\n\n';return __p}}},"3dGj":function(t,e,i){"use strict";var n=i("rH4x");i.n(n).a},"3uGt":function(t,e,i){"use strict";var n=i("vOnD"),o=i("q1tI"),a=i.n(o),s=i("xi34"),r=i("iC7s"),l=i("za5s"),c=i("lU33"),d=i("T6+y"),h=i.n(d),u=i("OTSC"),p=i("tZHv"),g=function(t){var e=t.activeLink,i=t.size;return(a.a.createElement("svg",{width:"80",height:"80",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 80 80",preserveAspectRatio:"xMidYMid meet",style:{height:"".concat(i,"px"),width:"".concat(i,"px")}},a.a.createElement("g",{fill:"none",fillRule:"evenodd"},a.a.createElement("circle",{fill:e?"#000000":"#ec520b",fillRule:"nonzero",cx:"40",cy:"40",r:"40"}),a.a.createElement("path",{d:"M57.746 59.179v-6.216c0-1.24-.678-1.863-1.801-1.863-1.334 0-2.433.99-2.48 2.191v5.88h-2.254v-6.215c0-1.24-.678-1.864-1.801-1.864-1.334 0-2.433.99-2.48 2.191v5.88h-2.254v-9.717h2.028l.226.827.11.101.108-.101c.453-.624 1.576-1.037 2.48-1.037 1.622 0 2.792.64 3.385 1.653l.561-.624c.562-.624 1.692-1.037 2.59-1.037 2.48 0 3.836 1.45 3.836 3.517v6.418h-2.254v.016zM23.442 28.913h-.414v6.707h-2.215V20h5.381c2.418 0 4.539 1.606 4.539 4.383 0 2.674-2.262 4.382-4.68 4.382l4.976 6.418v.43h-2.526l-5.061-6.7zm2.877-2.214c1.217 0 2.332-.85 2.332-2.23s-1.115-2.23-2.332-2.23h-3.244v4.46h3.244z",stroke:"#FFF",strokeWidth:".2",fill:"#FFF"}),a.a.createElement("path",{d:"M20.116 58.672l38.23-38.23 1.213 1.211-38.23 38.23-1.213-1.211z",stroke:"#FFF",strokeWidth:".6",fill:"#FFF"}))))},m=i("8AXF"),f=i("Kf/z");function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var _=v(r.Qb,1)[0],y=p.a.readymag_host,w=p.a.readymag_auth_host,k=Object(n.e)(r.m).withConfig({displayName:"HeaderMobile___StyledBox"})(["display:block;text-decoration:none;pointer-events:",";"],(function(t){return t._css})),S=Object(n.e)(r.zb).withConfig({displayName:"HeaderMobile___StyledText"})(["&:hover{color:",";}"],(function(t){return t._css2})),x=function(t){var e=t.label,i=t.url,n=t.active;return(a.a.createElement(k,{as:"a",mb:40,href:i,_css:n?"none":"all"},a.a.createElement(S,{lineHeight:"1",letterSpacing:"-2.4px",fontFamily:"Graphik",fontWeight:400,fontSize:32,color:n?"tomato":"#000",_css2:Object(l.themeGet)("colors.tomato")},e)))},C=Object(n.e)(r.m).withConfig({displayName:"HeaderMobile___StyledBox2"})([".constructor:not(.preview) &{display:none !important;}"]),O=Object(n.e)(r.C).withConfig({displayName:"HeaderMobile___StyledFlex"})(["transform:translateX(",");transition:transform 0.3s ease-in-out;overflow:scroll;-webkit-overflow-scrolling:touch;"],(function(t){return t._css3})),P=function(t){var e=t.activeLink,i=t.isAuthorized,n=v(Object(o.useState)(!1),2),s=n[0],l=n[1];return a.a.createElement(c.a,{query:"(min-width: ".concat(_,")")},(function(t){return t?a.a.createElement(a.a.Fragment,null):a.a.createElement(C,null,a.a.createElement(r.m,{position:"fixed",top:"0",right:"0",m:"6px 6px",zIndex:99999999},a.a.createElement(r.m,{as:"button",width:48,height:48,bg:"#fff",borderRadius:"50%",border:"none",p:"0",display:"inline-block",onClick:function(){return l(!s)}},a.a.createElement(r.C,{justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},a.a.createElement(r.Eb,null)))),a.a.createElement(O,{alignItems:"center",width:"100vw",height:"100vh",position:"fixed",zIndex:9999999,top:"0",left:"0",bg:"#fff",_css3:s?"0":"100%"},a.a.createElement(r.m,{width:"100%",p:"68px 20px"},a.a.createElement(x,{label:"Features",url:"".concat(y,"/features"),active:e===T.features}),a.a.createElement(x,{label:"Pricing",url:"".concat(y,"/pricing"),active:e===T.pricing}),a.a.createElement(x,{label:"Examples",url:"".concat(y,"/examples"),active:e===T.examples||e===T.explore}),a.a.createElement(x,{label:"Learn",url:"".concat(y,"/learn"),active:e===T.learn}),i?a.a.createElement(x,{label:"Log out",url:Object(f.a)("authorization.newFlow")?"".concat(w,"/auth/logout"):"".concat(w,"/logout")}):a.a.createElement(x,{label:"Join or Log in",url:"".concat(y,"/join")}))))}))};function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}i.d(e,"b",(function(){return I})),i.d(e,"a",(function(){return T}));var T,I=a.a.createContext({}),E=Object(n.e)(r.zb).withConfig({displayName:"Header___StyledText"})(["text-decoration:none;&:hover{color:",";}.text-on-dark &{color:#fff;&:hover,&.active{color:",";}}.white-theme.scrolled &{color:#000 !important;&:hover,&.active{color:"," !important;}}"],(function(t){return t._css}),(function(t){return t._css2}),(function(t){return t._css3})),M=function(t){var e=t.label,i=t.url,n=t.active,o=t.last;return(a.a.createElement(r.m,{mr:o?void 0:16,display:"inline-block"},a.a.createElement(E,{as:"a",href:i,fontFamily:"Graphik",fontWeight:400,fontSize:16,lineHeight:"24px",letterSpacing:"-0.1px",color:n?"tomato":"#000",onClick:function(t){window.location.href.replace(/\/$/,"")===i.replace(/\/$/,"")&&(t.preventDefault(),Object(s.a)("html").animate({scrollTop:0},300))},_css:Object(l.themeGet)("colors.tomato"),_css2:Object(l.themeGet)("colors.tomato"),_css3:Object(l.themeGet)("colors.tomato")},e)))},R=Object(n.e)(r.C).withConfig({displayName:"Header___StyledFlex"})(["display:inline-flex;outline:none;text-decoration:none;&:hover{color:#fff;background-color:",";}"],(function(t){return t._css4})),A=function(t){var e=t.label,i=t.url;return(a.a.createElement(R,{as:"a",bg:"rgba(244, 244, 244, 0.96)",borderRadius:200,href:i,width:100,height:40,textAlign:"center",color:"#000",alignItems:"center",justifyContent:"center",_css4:Object(l.themeGet)("colors.tomato")},a.a.createElement(r.zb,{fontFamily:"Graphik",fontSize:16,fontWeight:400,letterSpacing:"-0.1px"},e)))},D=[64,96,128,192,256],z=function(t,e){var i=t.split(".").pop(),n=function(t){var e=2*t;return D.reduce((function(t,i){return e<=i&&e>t?i:t}),D[0])}(e);return t&&n?t.replace(".".concat(i),"_".concat(n,".").concat(i)):""},L=j(r.Qb,1)[0];!function(t){t.features="features",t.pricing="pricing",t.explore="explore",t.examples="examples",t.learn="learn"}(T||(T={}));var B=Object(n.e)(r.C).withConfig({displayName:"Header___StyledFlex2"})(["cursor:default;"]),F=Object(n.e)(r.v).withConfig({displayName:"Header___StyledCover"})(["background-repeat:no-repeat;text-decoration:none;"]),N=Object(n.e)(r.zb).withConfig({displayName:"Header___StyledText2"})(["text-transform:uppercase;"]),U=Object(n.e)(r.m).withConfig({displayName:"Header___StyledBox"})(["font-size:0;"]);e.c=function(t){var e=t.activeLink,i=p.a.readymag_host,n=p.a.readymag_auth_host,s=Object(o.useContext)(m.BackboneContext).model,l=Object(o.useContext)(I).model,d=s?s.activeLink:e,v=h()({bindTo:document&&document.getElementById("rm-header-mobile-portal")}).Portal,b=j(Object(o.useState)(!1),2),_=b[0],y=b[1],w=j(Object(o.useState)(""),2),k=w[0],S=w[1],x=j(Object(o.useState)(""),2),C=x[0],O=x[1];Object(o.useEffect)((function(){u.default.loadLoggedUser((function(t){t&&Object.keys(t).length&&(y(!0),S(t.name),t.pic&&O(z(t.pic,48)))}))}),[]);return a.a.createElement(a.a.Fragment,null,a.a.createElement(c.a,{query:"(min-width: ".concat(L,")")},(function(t){var e=l?l.isDesktop:t;return(a.a.createElement(r.m,{position:"fixed",width:"100%",zIndex:99999},a.a.createElement(B,{height:"100%",width:"100%",alignItems:"center",justifyContent:"space-between",p:e?16:"6px 6px"},_?a.a.createElement(r.m,{height:e?40:48,width:e?"100%":"auto",display:"inline-block"},a.a.createElement(F,{as:"a",href:n,alignItems:"center",justifyContent:"center",bg:C?"transparent":"lightGray",height:e?40:48,width:e?40:48,backgroundImage:C?"url(".concat(C,")"):void 0,borderRadius:"50%",backgroundSize:"cover",backgroundPosition:"center","aria-label":"Profile"},a.a.createElement(N,{fontWeight:400,fontSize:16,lineHeight:1.25,letterSpacing:"-0.04px",fontFamily:"Graphik"},C?"":function(){if(!k)return"";var t=j(k.split(" "),2),e=t[0],i=t[1];return i?e[0]+i[0]:e[0]}()))):a.a.createElement(r.m,{height:e?40:48,width:"100%"},a.a.createElement(r.m,{as:"a",href:i,height:e?40:48,display:"inline-block"},a.a.createElement(g,{size:e?40:48,activeLink:!!d}))),e&&a.a.createElement(a.a.Fragment,null,a.a.createElement(r.m,{textAlign:"center",width:"100%"},a.a.createElement(M,{label:"Features",url:"".concat(i,"/features"),active:d===T.features}),a.a.createElement(M,{label:"Pricing",url:"".concat(i,"/pricing"),active:d===T.pricing}),a.a.createElement(M,{label:"Examples",url:"".concat(i,"/examples"),active:d===T.explore||d===T.examples}),a.a.createElement(M,{label:"Learn",url:"".concat(i,"/learn"),active:d===T.learn,last:!0})),a.a.createElement(U,{textAlign:"right",width:"100%"},_?a.a.createElement(A,{label:"Log out",url:Object(f.a)("authorization.newFlow")?"".concat(n,"/auth/logout"):"".concat(n,"/logout")}):a.a.createElement(a.a.Fragment,null,a.a.createElement(A,{label:"Join",url:"".concat(i,"/join")}),a.a.createElement(A,{label:"Log in",url:"".concat(i,"/login")})))))))})),a.a.createElement(v,null,a.a.createElement(P,{activeLink:d,isAuthorized:_})))}},"4BoS":function(t,e,i){},"4hiF":function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return a}));var n=i("9Juw"),o="baseFontSize",a=function(t){var e=t.editorState,i=t.block,a=Object(n.h)({editorState:e,block:i,key:o});return"number"==typeof a?a:void 0}},"4m+J":function(module,exports){module.exports={"template-viewer-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget" data-id="'+(null==(__t=id)?"":_.escape(__t))+'"></div>\n';return __p}}},"4nGE":function(t,e,i){},"4rJ8":function(t,e,i){"use strict";var n=i("QNiq"),o={data:function(){return{clicked:!1}},computed:{cookiesAccepted:function(){var t=!!JSON.parse(localStorage.getItem("cookiesAccepted")),e=this.clicked||!this.isConstructor&&t;return e&&this.removeWrapper(),e},isConstructor:function(){return!!RM.constructorRouter},isMobileLoginPage:function(){return n.a.isPhone&&("login"===RM.pageType||"join"===RM.pageType)}},methods:{removeWrapper:function(){var t=document.getElementById("rm-cookies-wrapper");t&&t.parentNode.removeChild(t)},btnClick:function(){this.isConstructor||(localStorage.setItem("cookiesAccepted","true"),this.removeWrapper()),this.clicked=!0}}},a=(i("10Cz"),i("KHd+")),s=Object(a.a)(o,(function(){var t=this.$createElement,e=this._self._c||t;return this.isMobileLoginPage||this.cookiesAccepted?this._e():e("div",{staticClass:"rm-cookies-alert"},[this._m(0),this._v(" "),e("button",{on:{click:this.btnClick}},[e("svg",{staticStyle:{width:"100%",height:"100%"},attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.2",baseProfile:"tiny",x:"0px",y:"0px",viewBox:"0.125 0.22499990463256836 127.75 127.74999237060547","xml:space":"preserve",preserveAspectRatio:"xMidYMid meet",fill:"rgb(40,40,40)","fill-opacity":"1"}},[e("g",[e("path",{attrs:{"fill-rule":"evenodd",d:"M77.5,64.1l47.6-47.6c3.7-3.7,3.7-9.8,0-13.5c-3.7-3.7-9.8-3.7-13.5,0L64,50.6L16.4,3   C12.7-0.7,6.6-0.7,2.9,3c-3.7,3.7-3.7,9.8,0,13.5l47.6,47.6L2.9,111.7c-3.7,3.7-3.7,9.8,0,13.5c3.7,3.7,9.8,3.7,13.5,0L64,77.6   l47.6,47.6c3.7,3.7,9.8,3.7,13.5,0c3.7-3.7,3.7-9.8,0-13.5L77.5,64.1z"}})])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("span",[this._v("\n    We use cookies.\n    "),e("a",{attrs:{href:"https://readymag.com/readymag/terms-and-privacy/5/",target:"_blank"}},[this._v("Learn more")])])}],!1,null,null,null);e.a=s.exports},"5BZr":function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("Fi5S"),c=a.a.View.extend({saveOnDeselect:!1,saveOnDestroy:!1,disabled:!1,initialize:function(t){this.initControl(t)},initControl:function(t){s.a.extend(this,t),s.a.bindAll(this),this.blocks&&(this.block=this.blocks[0])},render:function(){if(!this.rendered){if(this.rendered=!0,this.$container.append(this.$el),this.appearanceAnimation&&r.default.vueTransitionsShow(this.$el,"control"),this.$el.css("top",this.y),this.fromY!==this.y&&(this.$el.css({top:this.fromY}),window.requestAnimationFrame(s.a.bind((function(){this.$el.css({top:this.y})}),this))),this.template){var t=this.template({options:this.options});this.$el.append(t),this.$icon=this.$(".icon"),this.$panel=this.$(".panel"),this.$icon.on("click",this.onClick.bind(this))}return this.bindLogic(),Object(n.a)(window).on("keyup",this.onWindowKeyUp),this.setControlsStatusByBlockData(),this.block&&this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this}},moveToNewPos:function(t){this.$el.css("top",t)},bindLogic:function(){},unBindLogic:function(){},onClick:function(){this.isOnClickDisabled()||(this.selected?this.master.deselect():this.$el.hasClass("disabled")||this.master.select(this))},makeModelSnapshot:function(){this._oldAttrs&&this._oldAttrs._id===this.model.attributes._id||(this._oldAttrs=this.model&&s.a.cloneWithObjects(this.model.attributes))},clearModelSnapshot:function(t){this.saveOnDeselect&&t&&this.canSave()&&this.save(),delete this._oldAttrs},select:function(){this.selected||(this.makeModelSnapshot(),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls")})),this.selected=!0,this.faded=!1,this.$el.removeClass("fade"),this.$el.addClass("checked"),this.showPanel(),this.$icon.addClass("rmalttext-disable"))},showPanel:function(){r.default.vueTransitionsShow(this.$panel,"panel"),l.a.trigger("panel:showed",this.name)},hidePanel:function(){var t=this;return r.default.vueTransitionsHide(this.$panel,"panel").then((function(){l.a.trigger("panel:hidden",t.name)}))},setEnabled:function(){this.$el.removeClass("disabled"),this.disabled=!1},setDisabled:function(){this.$el.addClass("disabled"),this.disabled=!0,this.selected&&this.master.deselect()},onDisabledControlsChanged:function(){this.setControlsStatusByBlockData()},setControlsStatusByBlockData:function(){this.block&&this.block.disabledControls&&(-1!==this.block.disabledControls.indexOf(this.name)?this.setDisabled():this.setEnabled())},isOnClickDisabled:function(){return this.disabled},fade:function(){this.deselect(),this.faded=!0,this.$el.addClass("fade")},removeFade:function(){this.faded=!1,this.$el.removeClass("fade")},deselect:function(){var t=this.selected;this.selected=!1,this.faded=!1,this.$el.removeClass("fade"),this.$panel&&(this.hidePanel().then(function(){this.$el.removeClass("checked")}.bind(this)),this.$icon.removeClass("rmalttext-disable"),this.clearModelSnapshot(t))},canSave:function(){return this.model&&this._oldAttrs&&!s.a.isEqual(this.model.attributes,this._oldAttrs)&&this.block&&(this.model.isGlobal()||!this.block.destroyed)},onEscKey:function(){this.selected&&this.master.deselect()},onEnterKey:function(){},onWindowKeyUp:function(t){t.keyCode===n.a.keycodes.esc&&this.onEscKey(),t.keyCode===n.a.keycodes.enter&&this.onEnterKey()},destroy:function(t){this.saveOnDestroy&&this.canSave()&&this.save(),this.unBindLogic(),Object(n.a)(window).off("keyup",this.onWindowKeyUp),this.block&&this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.$panel&&this.$panel.remove(),t?r.default.vueTransitionsHide(this.$el,"control").then(function(){this.$el.remove()}.bind(this)):this.$el.remove(),this.destroyed=!0},canControlBeClosed:function(){return!!this.selected&&(this.master.deselect(),!0)},getControlParam:function(t){var e=RM.constructorRouter.mag.edit_params.get("controls");if(e)return e[this.name]&&e[this.name][t]},saveControlParam:function(t){var e=RM.constructorRouter.mag.edit_params.get("controls"),i={};i[this.name]=t,e&&s.a.isEqual(e[this.name],t)||(this.paramsSaveXHR=RM.constructorRouter.mag.edit_params.save("controls",s.a.extend({},e,i)))},updatePanelVerticalPosition:function(){if(this.$panel||!this.$panel.length){var t=this.master.getControlsHeight(),e=this.$panel.height(),i=this.master.getControlRelativePosition(this),n=this.$el.height(),o="";e>=t?o=-Math.ceil((e-t)/2)-i:e/2>i?o=-i:e/2>t-i+n/2&&(o=t-i-e),this.$panel.css("top",o)}},save:function(){}});e.a=c},"5DNN":function(module,exports){module.exports={"template-constructor-block-text":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margins-wrapper">\n\t\t<div class="margins-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<div class="columns-wrapper">\n\t\t<div class="columns-wrapper-inner">\n\t\t</div>\n\t</div>\n\n\t<textarea id="textarea_'+(null==(__t=_id)?"":__t)+'" style="display: none; width:'+(null==(__t=w)?"":__t)+"px;height:"+(null==(__t=h)?"":__t)+'px">'+(null==(__t=text)?"":_.escape(__t))+'</textarea>\n\t<div class="text-preview" style="-webkit-nbsp-mode:normal; -webkit-line-break:after-white-space;">'+(null==(__t=text)?"":__t)+'</div>\n\t<div class="text-mask"></div>\n\n';return __p},"template-constructor-block-text-margins":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="margin-handle hidden inactive">\n\t\t<div class="margin-handle-label-wrapper">\n\t\t\t<div class="margin-handle-label">\n\t\t\t\t<input class="margin-input" type="text"  spellcheck="false" value="0" data-mouseSpeed="2" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p},"template-constructor-block-text-bg":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="bg"></div>\n';return __p}}},"5EAR":function(t,e,i){"use strict";var n=i("n1zk");i.n(n).a},"5IDT":function(t,e,i){},"5Rpd":function(t,e,i){"use strict";i.r(e);var n=i("xi34"),o=i("rFsW"),a=i("tZHv"),s=i("BVsp"),r=i("YqYG"),l=i("QNiq"),c=function(t){if(o.a.bindAll(this),o.a.extend(this,t),!RM.common.magCreationInProgress)if(this.analytics=this.router&&this.router.analytics,this.router?this.router==RM.viewerRouter?this.routerName="viewer":this.router==RM.collectorRouter?this.routerName="collector":this.router==RM.homepageRouter?this.routerName="homepage":this.router==RM.constructorRouter?this.routerName="constructor":this.routerName="unknown":this.routerName="error",this.analytics&&!this.noCreateRequestTracking&&this.analytics.sendEvent("Create Mag Request",{_tp:this.tp+"_"+(this.templateID?"template":"blank")+"_"+this.routerName+"_"+(this.me?"has-me":"no-me"),_template_id:this.templateID}),l.a.isDesktop)if(Modernizr.msie||Modernizr.msie11)this.showIEPopupWarning();else if(this.me){var e="function"==typeof this.me.get?this.me.get("permissions"):this.me.permissions;e&&e.can_create_mag?this.innerCreateMag():this.showCreatePopupWarning()}else this.showJoinForm();else this.showMobilePopupWarning()};c.prototype.innerCreateMag=function(){var t={};this.analytics&&this.analytics.sendEvent("Create Mag",{_tp:this.tp+"_"+(this.templateID?"template":"blank")+"_"+this.routerName,_template_id:this.templateID}),this.currentFolderId&&(t.folder=this.currentFolderId),this.sharedUser&&(t.user=this.sharedUser),RM.common.magCreationInProgress=!0,n.a.ajax({url:a.a.readymag_auth_host+(this.templateID?"/api/magFromTemplate/"+this.templateID:"/api/mag/"),type:"POST",data:t,success:o.a.bind((function(t){"function"==typeof this.success&&this.success(),RM.common.magCreationInProgress=!1,window.location.href=a.a.readymag_auth_host+"/edit/"+t.num_id+"/contents/"}),this),error:o.a.bind((function(){if("function"==typeof this.error&&this.error(),RM.common.magCreationInProgress=!1,console.log(arguments),alert("Creating project problem. Contact tech support, please: "+a.a.SUPPORT_MAIL),this.me){var t="function"==typeof this.me.get?this.me.get("uri"):this.me.uri;t&&(window.location.href=a.a.readymag_auth_host+"/"+t)}}),this)})},c.prototype.showCreatePopupWarning=function(){r.default&&new r.default({$parent:Object(n.a)("body > .popups"),router:this.router,opts:{type:"type-create"},alert_source:"create mag"}).render()},c.prototype.showMobilePopupWarning=function(){r.default&&new r.default({$parent:Object(n.a)("body > .popups"),router:this.router,opts:{type:"type-switch-desktop-create"},alert_source:"create mag mobile"}).render()},c.prototype.showIEPopupWarning=function(){r.default&&new r.default({$parent:Object(n.a)("body > .popups"),router:this.router,opts:{type:"type-browsers"}}).render()},c.prototype.showJoinForm=function(){var t=new s.default({router:this.router,useNavigate:!1,$container:Object(n.a)("body")});t.render(),t.$el.css("z-index",9999),t.createMagParams={templateID:this.templateID,tp:this.tp,noCreateRequestTracking:!0},o.a.delay(o.a.bind((function(){t.switchTo("join"),t.show()}),this),100)},e.default=c},"5bt+":function(t,e,i){t.exports=i.p+"img/constructor/controls/add_to_cart_settings/layout-vertical.svg"},"5jX/":function(module,exports){module.exports={"template-constructor-control-picture_fwpos":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Crop" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},"5ta/":function(t,e,i){(function(t){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=i("xG9w"),o=void 0!==e(t)&&t.exports;function a(t,e){var i=t.split(".");return i.length>1?(i[i.length-2]+="_"+e,i.join(".")):t+"_"+e}var s="Built with Readymag—a tool to design anything on the web.";function r(t,e){return t?e&&-1===t.indexOf("://")?e+t:t:""}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=o?e.host:window.location.protocol+"//"+window.location.host,n=t&&t.screenshot;return n?r(a(n,1024),i):""}function c(t){var e=t.prefix+t.val+t.suffix;if(t.minLength=t.minLength||1,e.length>116){var i=Math.max(t.val.length-(e.length-116+1),t.minLength);e=t.prefix+t.val.substring(0,i)+"…"+t.suffix}return e}function d(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.isEmpty(e)||!n.isObject(e))return{};var o=e.emptyTitle?"":e.title,a="",r=e.description||(i.customDomain?"":s),d="";i.customDomain?a=i.forProject?o||"Project":(o?o+" — ":"")+(t.title||"Page "+t.num):(i.forProject||(a=(t.title?"‘"+t.title+"’":"Page "+t.num)+" from "),a+=(o?"‘"+o+"’":"Project")+" by "+e.user.name,i.forProject&&e.description&&(a+=" | Readymag")),d=i.forProject?l(n.findWhere(e.pages,{num:1}),i):l(t,i);var h="";return i.customDomain?i.forProject?h=o?c({prefix:"",val:o,suffix:""}):"Project":o||t.title?!o&&t.title?h=c({prefix:"",val:t.title,suffix:""}):o&&!t.title?h=c({prefix:"",val:o,suffix:" — Page "+t.num}):o&&t.title&&(h=c({prefix:"",val:o,suffix:" — "+t.title,minLength:20})).length>116&&(h=t.title).length>116&&(h=c({prefix:"",val:t.title,suffix:""})):h="Page "+t.num:i.forProject?h=o?c({prefix:"‘",val:o,suffix:"’ by "+e.user.name}):"Project by "+e.user.name:o||t.title?!o&&t.title?h=c({prefix:"‘",val:t.title,suffix:"’ from Project by "+e.user.name}):o&&!t.title?h=c({prefix:"Page "+t.num+" from ‘",val:o,suffix:"’ by "+e.user.name}):o&&t.title&&(h=c({prefix:"‘"+t.title+"’ from ‘",val:o,suffix:"’ by "+e.user.name,minLength:20})).length>116&&(h="‘"+t.title+"’ by "+e.user.name).length>116&&(h=c({prefix:"‘",val:t.title,suffix:"’ by "+e.user.name})):h="Page "+t.num+" from Project by "+e.user.name,{image:d,title:a||"",description:r||"",tweet:h}}function h(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.isEmpty(e)||!n.isObject(e))return{};var o=d(t,e,i),a=e.master_share_pid&&n.find(e.pages,(function(t){return t._id.toString()===e.master_share_pid.toString()})),s=i.forProject?n.findWhere(e.pages,{num:1}):t,r=a||s,c=r.custom_shares;return n.isEmpty(c)||(o.title=c.title||"",o.description=c.description||"",o.tweet=c.tweet||"",c.image?o.image=c.image:r.screenshot?o.image=l(r,i):o.image=""),o}function u(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.isEmpty(e)||!n.isObject(e))return{};var o=e.emptyTitle?"":e.title,a="",r="";return i.customDomain?t&&t.num>1?a=(o?o+" — ":"")+(t.title||"Page "+t.num):(a=o||"Project",r=e.description||""):(t&&t.num>1?a=(t.title?"‘"+t.title+"’":"Page "+t.num)+" from ":r=e.description||s,a=o||"Project"),{title:a||"",description:r||"",keywords:""}}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:626,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:436;window.open(t,"sharer","width="+e+",height="+i+",toolbar=0,status=0")}t.exports={SUPPORT_MAIL:"support@readymag.com",addFilenameComponent:a,defaultDescription:s,maxTweetLen:116,addOrigin:r,removeFilenameComponent:function(t){var e=t.split(".");if(e.length>1){var i=e[e.length-2].split("_");if(i.length>1&&!isNaN(Number(i[i.length-1]))){i.pop();var n=i.join("_");return e[e.length-2]=n,e.join(".")}}return t},getPageScreenshot:l,getDefaultShare:d,getDefaultSEO:u,getFinalShare:h,getFinalSEO:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.isEmpty(e)||!n.isObject(e))return{};var o=u(t,e,i);return o.title=t.seo&&t.seo.title||o.title,o.description=t.seo&&t.seo.description||o.description,o.keywords=t.seo&&t.seo.keywords||o.keywords,o},share:function(t){var e,i=h(t.page,t.mag,{forProject:t.forProject,customDomain:t.customDomain}),n=t.mag.emptyTitle?"":t.mag.title;if(/^https?:\/\//i.test(t.host)||(t.host="http://"+t.host),t.exportBasePath&&(t.host+=t.exportBasePath),/\/$/i.test(t.host)||(t.host+="/"),e=t.forProject?"".concat(t.host).concat(t.customDomain&&!t.customDomainProfile?"":"".concat(t.mag.num_id,"/")):t.exportBasePath?"".concat(t.host).concat(t.page.uri||t.page.num,"/"):"".concat(t.host,"p").concat(t.page.num_id,"/"),t.publishedVersion){var o;if("facebook"===t.tp&&p("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)),"twitter"===t.tp)o=n?c({prefix:"I’ve just published a project ‘",val:n,suffix:"’"}):"I’ve just published a Project",p("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(o));if("email"===t.tp){var a=encodeURIComponent((t.mag.is_private?"private ":"")+(n?"project ‘"+n+"’":"Project")),s="Check out my "+a,r="Hey, check out my new "+a+": "+e+(t.mag.is_private?encodeURIComponent("\n")+"Password: "+t.mag.pass:"");window.location.href="mailto:?subject="+s+"&body="+r}}else{if("facebook"===t.tp&&p("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)),"twitter"===t.tp&&p("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(i.tweet)),"gplus"===t.tp&&p("https://plus.google.com/share?url="+encodeURIComponent(e)),"pinterest"===t.tp&&p("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(e)+"&media="+encodeURIComponent(i.image)+"&description="+encodeURIComponent(i.title)),"linkedin"===t.tp&&p("http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(i.title)+(i.description?"&summary="+encodeURIComponent(i.description):""),552,460),"email"===t.tp){var l="Check out "+encodeURIComponent(i.title),d=l+encodeURIComponent("\n\n")+e+(t.mag.is_private?encodeURIComponent("\n")+"Password: "+t.mag.pass:"");window.location.href="mailto:?subject="+l+"&body="+d}if("report"===t.tp){var u="Report "+encodeURIComponent(e),g=encodeURIComponent("Please tell us why are you reporting this: ");window.location.href="mailto:support@readymag.com?subject="+u+"&body="+g}}if("report"!==t.tp){var m=t.source+" / "+t.tp+" ("+(t.forProject?"project":"page")+") / "+i.title+" ("+e+")";t.analytics&&t.analytics.sendEvent("Share",m)}}}}).call(this,i("YuTi")(t))},"60Nw":function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("tZHv"),c=i("3eHG"),d=i("WoDZ"),h=i("H3/6"),u=i("8CCW"),p=i.n(u);function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var m={},f={findPlugin:function(t){var e=h.a.matchCode(t.code,t);return s.a.find(m,(function(t,i){return i.toLowerCase()===e}))}},v=a.a.View.extend({embed_type:null,containerSelector:null,resizable:!0,proportional:!1,forceFrameSize:!1,initialize:function(t){this.block=t.block,this.widget=t.widget,s.a.bindAll(this),this.isInViewer=RM.viewerRouter||RM.constructorRouter&&RM.constructorRouter.preview},parse:function(t,e){return e(t)},sanitize:function(t){return Object(n.a)(t)},draw:function(t){t()}});function b(t,e){if(t){var i=["allow-top-navigation","allow-top-navigation-by-user-activation","allow-modals","allow-popups","allow-popups-to-escape-sandbox"],n=e&&Array.isArray(e)?e.filter((function(t){return!s.a.contains(i,t.toLowerCase())})):["allow-scripts","allow-forms","allow-same-origin"];t.attr("sandbox",n.join(" "))}}f.instagramEmbedCallbacks=[],f.initInstagram=function(t){if(window.instgrm&&window.instgrm.Embeds&&s.a.isFunction(window.instgrm.Embeds.process))return instgrm.Embeds.process(),t();f.instagramEmbedCallbacks.push(t),f.instagramInitXhr&&f.instagramInitXhr.abort(),Object(n.a)('body > script[src^="//platform.instagram.com"]').remove(),f.instagramInitXhr=n.a.ajax({url:r.default.selectProtocol("//platform.instagram.com/en_US/embeds.js"),dataType:"script",cache:!0,success:function(){s.a.each(f.instagramEmbedCallbacks,(function(t){s.a.isFunction(t)&&t()}))}})},m.Instagram=v.extend({embed_type:"instagram",containerSelector:"iframe",resizable:!0,initialize:function(t){v.prototype.initialize.apply(this,arguments),this.block&&s.a.extend(this.block.frame,{minwidth:164,minheight:264})},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){var n,o,a,s,r,l=0,c=!1;e.html(t),f.initInstagram(function(){r=setInterval(function(){if(l++,n=e.children(this.containerSelector),(o=n.height())||l>20){if(o||l>50)return o&&"constructor"===RM.common.mode&&(a=n.width(),s=n.height()),clearInterval(r),void i(a,s);if(c)return;c=!0,i()}}.bind(this),100)}.bind(this))},customResizeHandler:function(t,e,i){return t}}),f.pinterestEmbedCallbacks=[],f.initPinterest=function(t){var e,i=0;if(s.a.isFunction(window.parsePinBtns))return t();f.pinterestEmbedCallbacks.push(t),Object(n.a)('body > script[src^="assets.pinterest.com/js/pinit.js"]').remove(),Object(n.a)("body").prepend(Object(n.a)('<script defer src="//assets.pinterest.com/js/pinit.js" data-pin-build="parsePinBtns"><\/script>')),e=setInterval((function(){i++,(s.a.isFunction(window.parsePinBtns)||i>20)&&(clearInterval(e),t())}),100)},m.Pinterest=v.extend({embed_type:"pinterest",containerSelector:"a",resizable:!1,forceFrameSize:!0,containerSelectors:{buttonPin:"span",buttonFollow:"span",embedPin:"span",embedUser:"span",embedBoard:"span"},parse:function(t,e){var i=t.match(/data-pin-do=\"(\S+)\"/);return s.a.isArray(i)&&i[1]&&(this.pinterestType=i[1],this.containerSelector=this.containerSelectors[this.pinterestType]||this.containerSelector),e&&e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){f.initPinterest(function(){var n,o,a,s,r,l,c=0,d=!1;e.html(t),this.pinterestType||this.parse(t[0].outerHTML),this.pinterestType&&e.addClass(this.pinterestType),window.parsePinBtns(e.get(0)),r=setInterval(function(){if(c++,n=e.children(this.containerSelector).filter((function(){return/PIN_\d+/.test(this.className)})),(o=n.height())||c>20){if(o||c>50)return o&&"constructor"===RM.common.mode&&(a=n.outerWidth(!0),s=n.outerHeight(!0),"buttonFollow"==this.pinterestType&&(l=n.children("i")).length&&(a+=(l.outerWidth()||1)-1)),clearInterval(r),void i(a,s);if(d)return;d=!0,i()}}.bind(this),100)}.bind(this))}}),m.FacebookVideo=v.extend({embed_type:"fbvideo",containerSelector:"iframe",resizable:!0,proportional:!0,forceFrameSize:!0,initialize:function(t){v.prototype.initialize.apply(this,arguments),this.block&&s.a.extend(this.block.frame,{minwidth:220,minheight:124})},parse:function(t,e){return e(t.replace(/<script.*script>/gi,"").replace(/<div\s+id=(\'|\")fb-root(\'|\")><\/div>/gi,""))},draw:function(t,e,i){var n,o,a;e.html(t),c.a.initFacebookAPI(function(){window.FB.XFBML.parse(e.get(0),function(){n=e.find(this.containerSelector),o=n.width(),a=n.height(),i(o,a)}.bind(this))}.bind(this))}}),f.readymagEmbedCallbacks=[],f.initReadymag=function(t){if(RM.common.isReadymagEmbedInited&&s.a.isFunction(window.RM_EMBED_parse))return t();f.readymagEmbedCallbacks.push(t),window.RM_EMBED_initAsync=function(){RM.common.isReadymagEmbedInited=!0,s.a.each(f.readymagEmbedCallbacks,(function(t,e){s.a.isFunction(t)&&t()})),f.readymagEmbedCallbacks=[]},f.readymagInitXhr||(Object(n.a)('body > script[src~="RM_EMBED_"]').remove(),f.readymagInitXhr=n.a.ajax({url:l.a.EMBED_SCRIPT_MAIN,dataType:"script"}))},m.Readymag=v.extend({embed_type:"readymag",containerSelector:"iframe",resizable:!0,initialize:function(t){v.prototype.initialize.apply(this,arguments),this.block&&this.block.frame&&s.a.extend(this.block.frame,{minwidth:288,minheight:236,maxwidth:512,maxheight:383})},parse:function(t,e){return e(t.replace(/<script.*script>/i,""))},draw:function(t,e,i){e.html(t),f.initReadymag(function(){window.RM_EMBED_parse(function(){var t=e.find(this.containerSelector),n=t.width(),o=t.height();i(n+2,o)}.bind(this))}.bind(this))}}),m.IFrame=v.extend({embed_type:"simple-iframe",containerSelector:"iframe",resizable:!0,parse:function(t,e){var i;return(i=t.match(/[\s\S]*?(\<iframe[\s\S]*?\>)[\s\S]*?(\<\/iframe\>)[\s\S]*?/i))&&i[1]&&i[2]?e(i[1]+i[2]):e(null)},sanitize:function(t){var e=Object(n.a)(t);if("object"!==g(e)||!e.length)return e;var i,o=Object(n.a)("<iframe></iframe>"),a=e.get(0).attributes,r=["allowtransparency","height","name","sandbox","scrolling","seamless","src","width","allow"];return Object(s.a)(a).each((function(t){if("object"===g(t)&&t.specified&&s.a.contains(r,t.name.toLowerCase())){var e=t.name.toLowerCase(),n=t.value;"src"==e&&"https:"==window.location.protocol&&(n=n.replace(/^http(s?):\/\//i,"//")),"sandbox"===e&&(i=n.split(" ")),o.attr(e,n)}})),this.isInViewer||b(o,i),o},draw:function(t,e,i){var n=t[0].src;if(n&&n.trim())if(RM.screenshot&&d.a.getVideoProvider(n))this.setPosterInsteadOfVideo(n,e,i);else{e.html(t);var o,a,s,r,l,c=0,h=!1;l=setInterval(function(){if(c++,o=e.children(this.containerSelector),(a=o.height())||c>20){if(a||c>50)return a&&"constructor"===RM.common.mode&&(s=o.width(),r=o.height()),clearInterval(l),void i(s,r);if(h)return;h=!0,i()}}.bind(this),100)}else i()},setPosterInsteadOfVideo:function(t,e,i){var o=d.a.getVideoProvider(t),a=Object(n.a)("<img/>");d.a.getEmbedData(t,(function(t){d.a.getHighResVideoThumbnail({provider:o,thumbnail_url:t.thumbnail_url}).then(s.a.bind((function(t){!function(t){a[0].src=t,e.css({"background-color":"#000"}),a.css({position:"absolute",top:0,bottom:0,margin:"auto",width:"100%",height:"auto"}),e.append(a)}(t)}),this))}),(function(){"function"==typeof i&&i()}))}}),m.CodeInjection=v.extend({embed_type:"code-injection",containerSelector:"rm-code-injection",resizable:!0,HEAD_PASSTHROUGH_SELECTOR:"",parse:function(t,e){return e(t)},sanitize:function(t){return n.a.parseHTML(t,document,!0)},draw:function(t,e,i){var o=Object(n.a)(document).find("head"),a="<head>",s='<body style="padding:0; margin: 0; width: 100%; height: 100%; min-width: initial; min-height: auto;">',r=o.find(this.HEAD_PASSTHROUGH_SELECTOR),l=Object(n.a)('<iframe seamless style="width: 100%; height: 100%;"></iframe>'),c=Object(n.a)("<div></div>");if(!this.isInViewer||this.block&&this.block.model.get("use_iframe")||this.widget&&this.widget.use_iframe){this.isInViewer||b(l),r.each((function(){a+=this.outerHTML})),a+='<script src="https://unpkg.com/jquery@2.2.3/dist/jquery.min.js"><\/script>',a+="</head>",c.html(t),s+=c[0].innerHTML+"</body>";var d='<!DOCTYPE html><html style="width: 100%; height: 100%; min-width: initial; min-height: auto;">'+a+s+"</html>";return e.html(l),l[0].contentWindow.document.open(),l[0].contentWindow.document.write(d),l[0].contentWindow.document.close(),i(l.width(),l.height())}t=Object(n.a)(t),c.html(t),c.find("script").each((function(){var t;this.src&&this.text&&((t=document.createElement("script")).text=this.text,this.text="",Object(n.a)(t).insertAfter(Object(n.a)(this)))})),p()(e,c[0].innerHTML,{done:function(){return i(null,null)}}),e.css({"font-family":"initial","font-weight":"initial"})},loadNodeWithScripts:function(t,e,i){var o,a=Object(n.a)('<div id="fake"></div>'),r=[];a.html(e),(o=a.find("script")).each((function(){this.src&&this.text?(r.push({src:this.src}),r.push({text:this.text})):r.push({src:this.src,text:this.text})}));var l=s.a.find(r,(function(t){return!!t.src}));if(!r.length||!l||r<2)t.html(a[0].innerHTML);else{o.remove();var c=0;t.html(a[0].innerHTML),function e(){var n,o,a,s=r[c];if(!s)return i();c++,n=document.createElement("script"),s.src&&(n.src=s.src);s.text&&(n.text=s.text);if(!s.src)return t[0].appendChild(n),e();s.src&&(n.onload=function(){clearInterval(o),e()},a=0,o=setInterval((function(){++a>10&&(n.onload=null,e())}),1e3),t[0].appendChild(n))}()}}}),m.Ecommerce=m.CodeInjection.extend({embed_type:"ecommerce"}),e.a=f},"6ouf":function(t,e,i){"use strict";var n=i("0KJJ");i.n(n).a},"6z1P":function(t,e,i){"use strict";var n=i("skB9");i.n(n).a},"7E8S":function(module,exports){module.exports={"template-constructor-control-text_autosize":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon text_autosize-icon" data-alt="Auto-size" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},"7OA4":function(t,e,i){},"7TSX":function(module,exports){module.exports={"template-constructor-control-hotspot_add":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow"\n\t     data-alt="Add Pin"\n\t     data-alt-pos="left"\n\t     data-alt-offset="9"></div>\n\n';return __p}}},"896M":function(t,e,i){"use strict";var n=i("TxgR");i.n(n).a},"8AXF":function(t,e,i){"use strict";i.r(e),i.d(e,"BackboneContext",(function(){return p})),i.d(e,"BackboneContextProvider",(function(){return g})),i.d(e,"BackboneCollectionContextProvider",(function(){return m})),i.d(e,"CreateContextProvider",(function(){return f})),i.d(e,"renderReact",(function(){return v}));var n=i("q1tI"),o=i.n(n),a=i("i8i4"),s=i.n(a),r=i("iC7s");function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var p=o.a.createContext({}),g=function(t){var e=t.domElement,i=t.model,a=t.children,r=t.context,l={modelSet:function(t,e){return i.set(t,e)},modelUnset:function(t,e){return i.unset(t,e)},modelSave:function(t,e){return i.save(t,e)},destroy:function(){e&&(s.a.unmountComponentAtNode(e),e&&e.parentNode&&e.parentNode.removeChild(e))}},d=h(Object(n.useState)({model:i.attributes}),2),u=d[0],p=d[1],g=function(t){p(c(c({},u),{},{model:t.attributes}))};return Object(n.useEffect)((function(){return i.on("change",g),function(){i.off("change",g)}}),[i]),o.a.createElement(r.Provider,{value:c(c({},u),l)},a)},m=function(t){var e=t.domElement,i=t.collection,a=t.children,r=t.context,l={elementSet:function(t,e,n){var o=i.get(t);if(!o)throw new Error("Element not found");return o.set(e,n)},elementUnset:function(t,e,n){var o=i.get(t);if(!o)throw new Error("Element not found");return o.unset(e,n)},elementSave:function(t,e,n){var o=i.get(t);if(!o)throw new Error("Element not found");return o.save(e,n)},destroy:function(){e&&(s.a.unmountComponentAtNode(e),e&&e.parentNode&&e.parentNode.removeChild(e))}},d=h(Object(n.useState)({collection:i.map((function(t){return t.attributes}))}),2),u=d[0],p=d[1],g=function(t){var e=t.get("_id");p((function(i){var n=i.collection.findIndex((function(t){return t._id===e}));if(-1===n)return{collection:i.collection};var o=i.collection.splice(0);return o[n]=t.attributes,{collection:o}}))},m=function(t){p((function(e){var i=e.collection.splice(0);return i.push(t.attributes),{collection:i}}))},f=function(t){var e=t.get("_id");p((function(t){var i=t.collection.findIndex((function(t){return t._id===e}));if(-1===i)return{collection:t.collection};var n=t.collection.splice(0);return n.splice(i,1),{collection:n}}))};return Object(n.useEffect)((function(){return i.on("change",g),i.on("add",m),i.on("remove",f),function(){i.off("change",g),i.off("add",m),i.on("off",f)}}),[i]),o.a.createElement(r.Provider,{value:c(c({},u),l)},a)},f=function(t){var e=t.model,i=t.collection,n=t.domElement,a=t.context,s=t.children;return e?o.a.createElement(g,{model:e,domElement:n,context:a},s):i?o.a.createElement(m,{collection:i,domElement:n,context:a},s):o.a.createElement(o.a.Fragment,null,s)},v=function(t){var e=t.component,i=t.domElement,n=t.model;n?s.a.render(o.a.createElement(r.Ab,null,o.a.createElement(f,{model:n,domElement:i,context:p},o.a.createElement(e,null))),i):s.a.render(o.a.createElement(e,null),i)}},"8RDp":function(t,e,i){"use strict";i.d(e,"b",(function(){return d}));var n=i("q1tI"),o=i.n(n),a=i("ICos"),s=i("8Tds");function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var d=function(t){var e=t.type,i=void 0===e?s.a.None:e,n=t.color,o=void 0===n?"00000064":n,r=t.size,c=void 0===r?1:r,d=t.padding,h=void 0===d?0:d,u=Object(a.e)(o),p=u.r,g=u.g,m=u.b,f=u.a,v="rgba(".concat(p,", ").concat(g,", ").concat(m,", ").concat(f,")"),b={textDecoration:"none",paddingBottom:c+h};switch(i){case s.a.Solid:return l(l({},b),{},{background:"linear-gradient(to right, ".concat(v," 0%, ").concat(v," 100%) ").concat("0 100%","/1px ").concat(c,"px ").concat("repeat-x")});case s.a.Dotted:return l(l({},b),{},{background:"linear-gradient(to right, ".concat(v," 0%, ").concat(v," 50%, transparent 50%, transparent 100%) ").concat("0 100%","/").concat(2*c,"px ").concat(c,"px ").concat("repeat-x")});case s.a.Dashed:return l(l({},b),{},{background:"linear-gradient(to right, ".concat(v," 0%, ").concat(v," 66.6666%, transparent 66.6666%, transparent 100%) ").concat("0 100%","/").concat(3*c,"px ").concat(c,"px ").concat("repeat-x")});default:return l(l({},b),{},{background:"none"})}};e.a=function(t){var e=Object(n.useMemo)((function(){return d(t)}),[t.type,t.size,t.color,t.padding]);return(o.a.createElement("div",{style:l(l({},e),{},{width:"100%"})}))}},"8Tds":function(t,e,i){"use strict";var n,o,a,s,r,l;i.d(e,"f",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"b",(function(){return a})),i.d(e,"e",(function(){return s})),i.d(e,"d",(function(){return r})),i.d(e,"a",(function(){return l})),function(t){t.top="top",t.bottom="bottom"}(n||(n={})),function(t){t.LTR="LTR",t.RTL="RTL"}(o||(o={})),function(t){t.Hidden="Hidden",t.Visible="Visible"}(a||(a={})),function(t){t.H1="style-h1",t.H2="style-h2",t.Text="style-text",t.Caption="style-caption"}(s||(s={})),function(t){t.global="global",t.project="project"}(r||(r={})),function(t){t.None="None",t.Solid="Solid",t.Dotted="Dotted",t.Dashed="Dashed"}(l||(l={}))},"9GTV":function(t,e,i){!function(t,e){var n={update_playing_element:function(t,e,i){var n="rgba("+i.r+", "+i.g+", "+i.b+", "+.2*i.a+")",o="rgba("+i.r+", "+i.g+", "+i.b+", "+.1*i.a+")";t.style.cssText+="background: -webkit-linear-gradient(left, "+n+e+"%, "+o+(e+.1)+"%);background: linear-gradient(to right, "+n+e+"%, "+o+(e+.1)+"%);"}};for(var o in t.SOUNDCITE_CONFIG)n[o]=t.SOUNDCITE_CONFIG[o];var a=t.soundcite={};/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?a.mobile=!0:a.mobile=!1;var s,r,l=e.head||e.getElementsByTagName("head").item(0)||e.documentElement.childNodes[0],c=[],d="none",h="none",u=[],p=[];function g(t){var i={r:0,g:0,b:0,a:1};if(e.defaultView&&e.defaultView.getComputedStyle){var n=e.defaultView.getComputedStyle(t,null);if(n){var o=n.getPropertyValue("color").toLowerCase(),a=o.match(/\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*/)||o.match(/\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d+|\d*\.\d+)\s*\)\s*/);a?i={r:a[1]-0,g:a[2]-0,b:a[3]-0,a:void 0!==a[4]?a[4]-0:1}:(o=o.replace("#",""),i={r:parseInt(o.substring(0,2),16),g:parseInt(o.substring(2,4),16),b:parseInt(o.substring(4,6),16),a:1})}}return i}var m=function(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}};function f(i,n){var o,a=t.SC;if(d="loading",!a||!a.Dialog||function(t,e){for(var i=t.split("."),n=e.split("."),o=0;o<Math.min(i.length,n.length);o++){var a=parseInt(i[o])-parseInt(n[o]);if(a)return a}return i.length-n.length}(i,a._version)>0||n(a,d="loaded")){var s=e.createElement("script");s.type="text/javascript",s.src="//connect.soundcloud.com/sdk-2.0.0.js",s.onload=s.onreadystatechange=function(){"loading"!=d||(o=this.readyState)&&"loaded"!=o&&"complete"!=o||(n(t.SC,d="loaded"),l.removeChild(s))},l.appendChild(s)}}function v(t,e){for(var i=t.className,n=0,o=e.match(/\S+/g);n<o.length;n++)i=i.replace(new RegExp("(?:^|\\s)"+o[n]+"(?!\\S)"),"");t.className=i}function b(t,e){for(var i=t.className,n=0,o=e.match(/\S+/g);n<o.length;n++)i.match(new RegExp("(?:^|\\s)"+o[n]+"(?!\\S)"))||(i+=" "+o[n]);t.className=i}function _(t){this.el=t,this.start=t.hasAttribute("data-start")?t.getAttribute("data-start"):0,this.end=t.hasAttribute("data-end")?t.getAttribute("data-end"):null,this.plays=t.hasAttribute("data-plays")?parseInt(t.getAttribute("data-plays")):1,this.plays_left=this.plays,this.playing=!1,this.sound=null,this.click_handler_binded=m(this.click_handler,this),c.push(this)}function y(t){_.apply(this,Array.prototype.slice.call(arguments)),this.id=t.getAttribute("data-id"),"initialized"!==d&&(s.initialize({client_id:"5ba7fd66044a60db41a97cb9d924996a"}),d="initialized"),s.stream(this.id,m((function(t){this.destroyed?t._player.kill&&t._player.kill():(this.sound=t,this.sound._player.on("positionChange",m((function(t){this.track_progress(),this.playing&&(t<this.start&&this.sound.seek(this.start),t>=this.end&&(this.plays?(this.plays_left--,this.plays_left>0?this.play():this.stop()):this.play(),this.track_progress()),this.prevPos=t)}),this)),null===this.end&&(this.end=this.sound.getDuration()),this.sound_loaded())}),this))}function w(t){_.apply(this,Array.prototype.slice.call(arguments)),this.id="soundcite-audio-"+this.generateUUID(),this.url=t.getAttribute("data-url"),this.start=Math.floor(this.start/1e3),null!==this.end&&(this.end=Math.floor(this.end/1e3)),"initialized"!=h&&(a.audio_container=e.createElement("div"),b(a.audio_container,"soundcite-audio"),e.getElementsByTagName("body")[0].appendChild(a.audio_container),h="initialized"),this.audio=e.createElement("audio"),this.audio.id=this.id,this.audio.setAttribute("src",this.url),this.audio.setAttribute("preload","none"),a.mobile=!0,a.audio_container.appendChild(this.audio),this.sound=r("#"+this.id,{frameAnimation:!0}),this.sound.on("loadeddata",m((function(){null===this.end&&(this.end=this.sound.duration()),a.mobile||this.sound_loaded()}),this)),(a.mobile||this.sound.readyState()>1)&&this.sound_loaded()}_.prototype.generateUUID=function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))},_.prototype.sound_loaded=function(){this.el.addEventListener("click",this.click_handler_binded),v(this.el,"soundcite-initializing"),this.el.style.display="none",this.el.offsetHeight,this.el.style.display="",b(this.el,"soundcite-loaded soundcite-play")},_.prototype.pause=function(){v(this.el,"soundcite-pause"),b(this.el,"soundcite-play"),this.playing=!1,this.pause_sound()},_.prototype.stop=function(){v(this.el,"soundcite-pause"),b(this.el,"soundcite-play"),this.playing=!1,this.plays_left=this.plays,this.stop_sound()},_.prototype.track_progress=function(){var t=this.end-this.start,e=100*(this.sound_position()-this.start)/t;this.color||(this.color=g(this.el)),n.update_playing_element(this.el,e,this.color)},_.prototype.click_handler=function(t){t.preventDefault(),function(t){for(var e=0;e<c.length;e++)c[e].playing&&(t&&t.el===c[e].el||c[e].pause())}(this),this.playing?this.pause():this.play()},_.prototype.destroy=function(t){this.destroyed=!0,this.playing&&this.pause(),this.el&&v(this.el,"soundcite-loaded soundcite-initializing soundcite-loading soundcite-play soundcite-pause"),this.el&&this.el.removeEventListener("click",this.click_handler_binded)},y.prototype=Object.create(_.prototype),y.prototype.sound_position=function(){return this.sound.getCurrentPosition()},y.prototype.pause_sound=function(){this.sound.pause()},y.prototype.stop_sound=function(){this.sound.stop()},y.prototype.play=function(){var t=this.sound_position();(t<this.start||t>=this.end)&&this.sound.seek(this.start),v(this.el,"soundcite-play"),b(this.el,"soundcite-pause"),this.sound.play(),this.playing=!0,this.prevPos=-1},y.prototype.destroy=function(){this.sound&&this.sound._player.kill&&this.sound._player.kill(),_.prototype.destroy.apply(this,arguments)},w.prototype=Object.create(_.prototype),w.prototype.sound_position=function(){return this.sound.currentTime()},w.prototype.pause_sound=function(){this.sound.pause(),this.sound.off("timeupdate")},w.prototype.stop_sound=function(){this.sound.off("timeupdate"),this.sound.pause()},w.prototype._play_sound=function(){v(this.el,"soundcite-loading soundcite-play"),b(this.el,"soundcite-pause"),this.sound.play(),this.playing=!0,this.sound.on("timeupdate",m((function(){this.track_progress(),this.playing&&this.sound.currentTime()>=this.end&&(this.plays?(this.plays_left--,this.plays_left>0?this.play_sound():this.stop()):this.play_sound(),this.track_progress())}),this))},w.prototype.play_sound=function(){var t=this.sound.currentTime();t<this.start||t>=this.end?(this.sound.on("seeked",m((function(){this.sound.off("seeked"),this._play_sound()}),this)),this.sound.currentTime(this.start)):this._play_sound()},w.prototype.play=function(){/soundcite\-loading/.test(this.el.className)||(a.mobile?(v(this.el,"soundcite-play"),b(this.el,"soundcite-loading"),this.startedLoading?this.play_sound():(this.sound.on("canplaythrough",m((function(){this.play_sound()}),this)),e.getElementById(this.id).load()),this.startedLoading=!0):this.play_sound())},w.prototype.destroy=function(){this.sound&&r.destroy(this.sound),this.audio&&a.audio_container.removeChild(this.audio),_.prototype.destroy.apply(this,arguments)},a.createPlayer=function(e){b(e,"soundcite-initializing"),b(e,"soundcite-force-bg-color"),n.update_playing_element(e,0,g(e)),e.getAttribute("data-url")&&("none"==h?(p.push(e),i.e(19).then(i.bind(null,"+qCX")).then((function(e){(0,e.default)(t,t.document),r=t.Popcorn;for(var i=0;i<p.length;i++)new w(p[i])}))):"loading"==h?p.push(e):new w(e)),e.getAttribute("data-id")&&("none"==d?(u.push(e),f("2.0.0",(function(t){s=t;for(var e=0;e<u.length;e++)new y(u[e])}))):"loading"==d?u.push(e):new y(e))},a.destroyPlayer=function(t){for(var e=c.length-1;e>=0;e--)c[e].el==t&&(c[e].destroy(),c.splice(e,1));for(e=p.length-1;e>=0;e--)p[e]==t&&p.splice(e,1);for(e=u.length-1;e>=0;e--)u[e]==t&&u.splice(e,1)},a.pausePlayer=function(t){for(var e=0;e<c.length;e++)t==c[e].el&&c[e].playing&&c[e].pause()},a.setElementsColor=function(t){n.update_playing_element(t,0,g(t))}}(window,document)},"9Juw":function(t,e,i){"use strict";i.d(e,"g",(function(){return y})),i.d(e,"w",(function(){return w})),i.d(e,"k",(function(){return k})),i.d(e,"i",(function(){return S})),i.d(e,"j",(function(){return x})),i.d(e,"v",(function(){return C})),i.d(e,"o",(function(){return O})),i.d(e,"e",(function(){return P})),i.d(e,"c",(function(){return j})),i.d(e,"a",(function(){return $})),i.d(e,"b",(function(){return T})),i.d(e,"m",(function(){return I})),i.d(e,"h",(function(){return E})),i.d(e,"u",(function(){return M})),i.d(e,"r",(function(){return R})),i.d(e,"l",(function(){return A})),i.d(e,"q",(function(){return D})),i.d(e,"p",(function(){return z})),i.d(e,"n",(function(){return L})),i.d(e,"f",(function(){return B})),i.d(e,"s",(function(){return F})),i.d(e,"d",(function(){return U})),i.d(e,"t",(function(){return H}));var n=i("q1tI"),o=i.n(n),a=i("Mpt7"),s=i("v83y"),r=i("mIwl"),l=i("w5C2"),c=i("A9VP"),d=i("L2iM"),h=i("a68n"),u=i("HjzJ"),p=i("IrH7"),g=i("zjto"),m=i("Pgkd");function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function v(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach((function(e){b(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var _=Object(m.a)({styleToHTML:function(){return o.a.createElement("span",null)},blockToHTML:function(){return o.a.createElement("p",null)},entityToHTML:function(t,e){return e}}),y=function(t,e){return s.EditorState.forceSelection(t,e||t.getSelection())},w=function(t,e){return s.RichUtils.toggleInlineStyle(t,e)},k=function(t){return t.getCurrentInlineStyle()},S=function(t){return t.getCurrentContent().getBlockForKey(t.getSelection().getStartKey())},x=function(t){return t.getCurrentContent().getBlockForKey(t.getSelection().getStartKey()).getType()},C=function(t,e){return s.RichUtils.toggleBlockType(t,e)},O=function(t){return{blocks:(t.blocks||[]).map((function(e){var i=(t.styles||[]).find((function(t){return t.key===e.key}));return v(v({},e),{},{type:i?i.type:l.a.Unstyled,inlineStyleRanges:i?i.inlineStyles:[]})})),entityMap:t.entityMap||{}}},P=function(t){return{blocks:t.blocks.map((function(t){return{key:t.key,text:t.text,entityRanges:t.entityRanges,data:t.data,depth:t.depth}})),styles:t.blocks.map((function(t){return{key:t.key,type:t.type,inlineStyles:t.inlineStyleRanges}})),entityMap:t.entityMap}},j=function(){var t=s.ContentState.createFromText(Object(r.a)()),e=Object(s.convertToRaw)(t);return P(e)},$=function(t){var e=s.EditorState.moveSelectionToEnd(t).getSelection();return s.EditorState.forceSelection(t,e)},T=function(t){var e=t.editorState,i=t.block,n=e.getCurrentContent().getBlockMap(),o=i,a="";o?a=o.getKey():(a=e.getSelection().getAnchorKey(),o=n.get(a));var r=o.getCharacterList().map((function(t){return t?t.set("style",t.get("style").clear()):t})),l=o.set("characterList",r),c=n.set(a,l);return s.EditorState.push(e,s.ContentState.createFromBlockArray(c.toArray()),"change-inline-style")},I=function(t){var e=t.getCurrentInlineStyle();return Object(c.g)(e)};function E(t){var e,i=t.editorState,n=t.block,o=t.key;if(n)e=n;else if(i){var a=i.getSelection().getAnchorKey();e=i.getCurrentContent().getBlockMap().get(a)}if(!e)return"";var s=e.getData().toObject();return o?s&&s[o]||void 0:s}var M=function(t){var e=t.editorState,i=t.block,n=t.key,o=t.value,r=E({editorState:e,block:i}),l=s.Modifier.setBlockData(e.getCurrentContent(),e.getSelection(),a.a.Map(v(v({},r),{},b({},n,o))));return s.EditorState.push(e,l,"change-block-data")},R=function(t){var e=Object(d.b)().toJS(),i=v({},e),n=t.getCurrentContent().getBlockMap();return n.forEach((function(t){if(t){var o=t.getType(),a=Object(h.b)({block:t}),s=Object(p.c)({block:t});if(Object(u.c)(o))return;var r=[o,a,s].join(" ");e[a]&&(i[r]=e[a]),n=n.set(t.getKey(),t.set("type",r))}})),{editorState:s.EditorState.push(t,s.ContentState.createFromBlockArray(n.toArray()),"change-block-type"),blockRenderMap:s.DefaultDraftBlockRenderMap.merge(a.a.Map(i))}},A=function(t){var e=t.getSelection(),i=e.getIsBackward(),n=i?e.getFocusKey():e.getAnchorKey(),o=i?e.getAnchorKey():e.getFocusKey(),a=0===e.getFocusOffset()&&0===e.getAnchorOffset()&&n!==o,s=t.getCurrentContent().getBlockMap().toIndexedSeq().map((function(t){return t&&t.getKey()})).toJS(),r=[],l=s.indexOf(n),c=s.indexOf(o);return l>-1&&c>-1&&(r=s.slice(l,c+1)),a&&r.pop(),r},D=function(t,e){return A(t).includes(e)},z=function(t,e){var i=t.getCurrentInlineStyle(),n=s.Modifier.insertText(t.getCurrentContent(),t.getSelection(),e,i);return s.EditorState.push(t,n,1===e.length?"insert-characters":"insert-fragment")},L=function(t){if(t.get("version")===g.version){var e=Object(s.convertFromRaw)(O(t.attributes)),i=_(e);if(i){var n=document.createElement("span");return n.innerHTML=i,n.textContent||n.innerText}}return""},B=function(t,e){var i=t.getText();return Array.from(i.matchAll(RegExp(e,"g")),(function(t){return t.index})).filter((function(t){return"number"==typeof t}))},F=function(t){return t.getIsBackward()?t.merge({isBackward:!1,anchorKey:t.getFocusKey(),anchorOffset:t.getFocusOffset(),focusKey:t.getAnchorKey(),focusOffset:t.getAnchorOffset()}):t},N=function(t){return t.some((function(t){return t&&t.style.length}))},U=function(t){if(t.getSelection().isCollapsed()){var e=I(t);return Boolean(e&&Object.keys(e).length)}var i=t.getCurrentContent(),n=function(t){var e=t.getSelection(),i=e.getIsBackward(),n=i?e.getFocusKey():e.getAnchorKey(),o=i?e.getAnchorKey():e.getFocusKey(),a=i?e.getEndOffset():e.getStartOffset(),s=i?e.getStartOffset():e.getEndOffset();if(0===a&&0===s){var r=i?o:n;return{startKey:r,endKey:r,startOffset:0,endOffset:t.getCurrentContent().getBlockForKey(r).getCharacterList().size}}return{startKey:n,endKey:o,startOffset:a,endOffset:s}}(t),o=n.startKey,a=n.endKey,s=n.startOffset,r=n.endOffset;if(o===a){var l=i.getBlockForKey(o).getCharacterList().slice(s,r).toJS();return N(l)}return A(t).some((function(t){var e=i.getBlockForKey(t).getCharacterList(),n=o===t?s:0,l=a===t?r:e.size,c=e.slice(n,l).toJS();return N(c)}))},H=function(t){var e=t.getSelection(),i=e.getStartKey();if(i===e.getEndKey()){var n=t.getCurrentContent(),o=e.merge({anchorKey:i,anchorOffset:0,focusOffset:n.getBlockForKey(i).getText().length,focusKey:i});return s.EditorState.forceSelection(t,o)}return t}},"9Tqx":function(t,e,i){},A9VP:function(t,e,i){"use strict";var n,o,a=i("9Juw"),s=i("ICos");function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}!function(t){t.LetterSpacing="LETTER_SPACING",t.Color="COLOR",t.FontFeature="FONT_FEATURE",t.Stroke="STROKE",t.FontSize="FONT_SIZE",t.FontFamily="FONT_FAMILY",t.FontWeight="FONT_WEIGHT",t.FontStyle="FONT_STYLE",t.FontVariable="FONT_VARIABLE",t.IsLinkedFontSize="IS_LINKED_FONT_SIZE",t.IsLinkedLetterSpacing="IS_LINKED_LETTER_SPACING",t.Decoration="DECORATION",t.Transform="TRANSFORM",t.Features="FEATURES",t.FontKerning="FONT_KERNING"}(o||(o={}));var d=(r(n={},o.LetterSpacing,{name:"letterSpacing",value:function(t){return"".concat(t,"px")}}),r(n,o.FontFamily,{name:"fontFamily",value:function(t){return t}}),r(n,o.FontStyle,{name:"fontStyle",value:function(t){return t}}),r(n,o.FontWeight,{name:"fontWeight",value:function(t){return t}}),r(n,o.FontSize,{name:"fontSize",value:function(t){return"".concat(t,"px")}}),r(n,o.Color,{name:"color",value:function(t){var e=Object(s.e)(t),i=e.r,n=e.g,o=e.b,a=e.a;return"rgba(".concat(i,", ").concat(n,", ").concat(o,", ").concat(a,")")}}),r(n,o.FontFeature,{name:"fontFeatureSettings",value:function(t){return t.split(g).filter((function(t){return t})).map((function(t){return'"'.concat(t,'"')})).join(", ")}}),r(n,o.FontVariable,{name:"fontVariationSettings",value:function(t){return t.split(g).filter((function(t){return t})).map((function(t){var e=l(t.split("|"),2),i=e[0],n=e[1];return"'".concat(i,"' ").concat(n)})).join(", ")}}),r(n,o.Stroke,{name:"WebkitTextStroke",value:function(t){var e=l(t.split(g),2),i=e[0],n=e[1],o=Object(s.e)(n),a=o.r,r=o.g,c=o.b,d=o.a,h="rgba(".concat(a,", ").concat(r,", ").concat(c,", ").concat(d,")");return"".concat(i,"px ").concat(h)}}),r(n,o.Decoration,{name:"textDecoration",value:function(t){return t}}),r(n,o.Transform,{name:"textTransform",value:function(t){return t}}),r(n,o.Features,{styleFn:function(t){switch(t){case"superscript":return{verticalAlign:"baseline",position:"relative",top:"-0.4em"};case"subscript":return{verticalAlign:"baseline",position:"relative",top:"0.4em"};default:return{}}}}),r(n,o.FontKerning,{styleFn:function(t){return"none"===t?{}:{fontKerning:"auto",WebkitFontKerning:"auto"}}}),n);function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function u(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach((function(e){p(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return g})),i.d(e,"f",(function(){return m})),i.d(e,"c",(function(){return f})),i.d(e,"e",(function(){return v})),i.d(e,"d",(function(){return b})),i.d(e,"g",(function(){return _})),i.d(e,"b",(function(){return o}));var g=";",m=function(t,e){return"".concat(t).concat(g).concat(e)},f=function(t){var e=t.key,i=t.value,n=t.editorState,o=n.getCurrentInlineStyle().toJS().reduce((function(t,i){return i.startsWith(e)?Object(a.w)(t,i):t}),n);if(!i)return o;var s=Array.isArray(i)?i.filter((function(t){return t})).length?i.filter((function(t){return t})).join(g):null:i;return s?Object(a.w)(o,m(e,s)):o},v=function(t,e){return t.replace("".concat(e).concat(g),"").split(g)},b=function(t,e){var i=t.getCurrentInlineStyle().toJS().find((function(t){return t.startsWith(e)}));return i?v(i,e):[]},_=function(t){return Object.keys(d).reduce((function(e,i){var n=t.filter((function(t){return!!t&&t.startsWith(i)})).first();if(n){var o=n.replace("".concat(i).concat(g),""),a=d[i];if(a.styleFn)return u(u({},e),a.styleFn(o));if(a.name&&a.value)return u(u({},e),{},p({},a.name,a.value(o)))}return e}),{})}},BVsp:function(t,e,i){"use strict";i.r(e);var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("aCH8"),l=i.n(r),c=i("OTSC"),d=i("tZHv"),h=i("MgHC"),u=i.n(h),p=i("5Rpd"),g=i("QNiq"),m=i("Kf/z"),f=a.a.View.extend({events:{"click .link":"link","click .close-popup":"closePopup","input .login.ljr-panel input.password-input":"onPasswordInput","keydown .login.ljr-panel input":"loginInputKey","click .login.ljr-panel .go":"tryLogin","submit .login.ljr-panel #login_form":"onLoginFormSubmit","click .login.ljr-panel .social-auth":"socialAuth","input .join.ljr-panel input.password-input":"onPasswordInput","keydown .join.ljr-panel input":"joinInputKey","click .join.ljr-panel .go":"createAccount","click .join.ljr-panel .social-auth":"socialAuth","click .join.ljr-panel label .checkmark":"changeCheckboxState","keyup .join.ljr-panel input.for-validate":"validateForm","click .recover.ljr-panel .go":"sendRecoverRequest","click .recover.ljr-panel .go-back":"backFromRecover","input .reset.ljr-panel input":"onPasswordInput","click .reset.ljr-panel .go":"resetPassword","click .login-popup-wrapper":"closeOutsideClick",touchstart:"onTouchStart",touchmove:"onTouchMove"},ERROR_MESSAGES:{invalid_email:"Not a valid email",min:"At least 8 characters long",letters:"Password must include letters",oneOf:"The same as email",password_dont_match:"Passwords don't match"},defaultErrorMessageHTML:'An error has occured. Please contact our support: <a href="mailto:'.concat(d.a.SUPPORT_MAIL,'">').concat(d.a.SUPPORT_MAIL,"</a>."),initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),s.a.extend(this.ERROR_MESSAGES,this.errorMessages),this.template=u.a["template-common-login"],this.template_button_preloader=u.a["template-common-login-preloader"],this.logged=!1,this.animationSpeed=0,this.disableAnimations||s.a.delay(s.a.bind((function(){this.animationSpeed=300}),this),100),this.enableCors(),Object(n.a)(window).on("message",this.processLoginMessages)},render:function(){this.setElement(this.$node||Object(n.a)(this.template({})).appendTo(this.$container)),this.disableScrollWatcher=!!this.$node,this.setElement(this.$el),this.rendered=!0,this.$nameInput=this.$(".join.ljr-panel .fullname-input"),this.$emailInput=this.$(".join.ljr-panel .email-input"),this.$pswInput=this.$(".join.ljr-panel .password-input"),this.$termsCheckbox=this.$(".join.ljr-panel .terms-checkbox"),this.$joinButton=this.$(".join.ljr-panel .go");var t=c.default.queryUrlGetParam("email");t&&this.$(".email-input").val(t)},showError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultErrorMessageHTML;this.$(".join.ljr-panel .error").html(t)},clearErrors:function(){this.$(".join.ljr-panel .error").html("")},link:function(t){if(t.stopPropagation(),2!==t.which&&!t.metaKey&&!t.ctrlKey){var e=Object(n.a)(t.currentTarget).attr("href");if(!e)return!1;if(!this.useNavigate)return/login/i.test(e)&&this.switchTo("login"),/join/i.test(e)&&this.switchTo("join"),/recover/i.test(e)&&this.switchTo("recover"),!1;this.router.navigate(e,{trigger:!0}),t.preventDefault()}},closePopup:function(){Object(n.a)("#homepage-main-project__root-link")&&Object(n.a)("#homepage-main-project__root-link")[0]&&Object(n.a)("#homepage-main-project__root-link")[0].click()},changeCheckboxState:function(t){var e=Object(n.a)(t.target).siblings("input[type='checkbox']");e.is(":checked")?e.prop("checked",!1):e.prop("checked",!0),Object(n.a)(t.target).toggleClass("checked"),Object(n.a)(t.target).parent().siblings("p").toggleClass("checked"),this.validateForm(),t.preventDefault()},validateForm:function(){""!==this.$nameInput.val()&&this.$pswInput.is(":valid")&&this.$emailInput.is(":valid")&&this.$termsCheckbox.is(":checked")?this.$joinButton.addClass("active"):this.$joinButton.removeClass("active")},closeOutsideClick:function(t){g.a.isDesktop&&Object(n.a)(t.target).hasClass("login-popup-wrapper")&&this.closePopup()},show:function(t){this.shown||(Object(n.a)("body").addClass("disable-scroll"),this.urlToBack=t,0===this.animationSpeed&&this.$el.flashClass("no-animation",15),this.$el.removeClass("hidden"),this.trigger("shown"),this.shown=!0,Object(n.a)("body").on("keyup",this.onBodyKeyUp),this.onResize())},hide:function(t){this.shown&&(this.$el.addClass("hidden"),s.a.delay((function(){Object(n.a)("body").removeClass("disable-scroll")}),this.animationSpeed),this.trigger("hidden",t),this.shown=!1,Object(n.a)("body").off("keyup",this.onBodyKeyUp),this.onResize())},onBodyKeyUp:function(t){27===t.keyCode&&this.closePopup()},switchTo:function(t){var e=this.$(".ljr-panel."+t),i=window.matchMedia("(max-width: 768px)").matches,n=e.siblings(".ljr-panel"),o=("recover"===t||"login"===t)&&".dop-container-join"===this.$el.selector&&i;"recover"===t&&this.$(".recover.ljr-panel .email-input").val(this.$(".login.ljr-panel .email-input").val()),e.removeClass("hidden"),g.a.isDesktop&&setTimeout((function(){e.find("input").eq(0).focus()}),0),this.disableAnimations?(n.addClass("hidden"),o&&RM.viewerRouter.mag.onResize()):s.a.delay((function(){n.addClass("hidden"),o&&RM.viewerRouter.mag.onResize()}),this.animationSpeed/4),this.onResize()},onResize:function(){Object(n.a)(window).width()<=768&&this.$(".login").hasClass("hidden")&&this.$(".login-popup-wrapper").css("height",652),Object(n.a)(window).width()<=768&&this.$(".join").hasClass("hidden")&&this.$(".login-popup-wrapper").css("height",466)},showButtonPreloader:function(t){var e,i,o,a=t.width(),s=t.height();e=Object(n.a)(this.template_button_preloader()),t.append(e),t.css({color:"transparent","background-image":"none"}),t.addClass("processing"),i=e.width(),o=e.height(),e.css({left:Math.floor((a-i)/2),top:Math.floor((s-o)/2)})},hideButtonPreloader:function(t){t.find(".rmpreloader").remove(),t.css({color:"","background-image":""}),t.removeClass("processing")},loginInputKey:function(t){13===t.keyCode&&this.tryLogin()},tryLogin:function(){var t=n.a.trim(this.$(".login.ljr-panel .email-input").val()),e=this.$(".login.ljr-panel .password-input").val(),i=this.$(".login.ljr-panel .go"),o=c.default.queryUrlGetParam("redirect");i.hasClass("processing")||""!==t&&""!==e&&(this.showButtonPreloader(i),this.requestLogin(t,e,s.a.bind((function(t){if(t&&t.redirect)return window.location.href=t.redirect;if(t){if(o)return window.location.href=d.a.readymag_auth_host+o;if(this.logged=!0,this.createMagParams)return this.redirectAfterJoin(t.uri);var e=Modernizr.sessionstorage&&window.sessionStorage.getItem("rm.loginReturnUrl",window.location.pathname);Modernizr.sessionstorage&&window.sessionStorage.removeItem("rm.loginReturnUrl"),this.$('.login.ljr-panel #login_form input[name="url"]').val(d.a.readymag_auth_host+(e||"/"+t.uri)),this.$(".login.ljr-panel #login_form").submit()}else this.hideButtonPreloader(i),clearTimeout(this.wrongTimeout),this.$(".login.ljr-panel").addClass("wrong-login"),this.$(".login.ljr-panel .error").html("Please check that you have entered your login and password correctly."),this.wrongTimeout=setTimeout(s.a.bind((function(){this.$(".login.ljr-panel").removeClass("wrong-login")}),this),3500),this.isdesktop||this.$el.scrollTop(9999)}),this)))},requestLogin:function(t,e,i){var o,a={pass:Object(m.a)("authorization.newFlow")?e:l()(e)};return a[t.match(/@/)?"email":"uri"]=t,this.clearErrors(),o=Object(m.a)("authorization.newFlow")?d.a.readymag_auth_host+"/auth/login":d.a.readymag_auth_host+"/api/user/?timestamp="+(new Date).getTime(),n.a.post(o,a,(function(t){i&&i(t)})).error((function(t){404===t.status?i&&i():this.showError()})),!1},onLoginFormSubmit:function(){return this.logged},showErrors:function(t){clearTimeout(this.wrongTimeout),this.$(".join.ljr-panel").addClass("wrong-join"),this.showError(Array.isArray(t)?t.join(" <br/>"):t),this.wrongTimeout=setTimeout(s.a.bind((function(){this.$(".join.ljr-panel").removeClass("wrong-join")}),this),2e3)},redirectHandler:function(t,e,i){if(t)return window.location.href=t,!0;this.redirectAfterJoin(e.uri,i)},createAccount:function(){var t=this;if(!this.$(".join.ljr-panel input").hasClass("err")&&this.$joinButton.hasClass("active")){var e,i,o,a,r={email:this.$emailInput.val(),name:n.a.trim(this.$(".join.ljr-panel .fullname-input").val()),pass:this.$pswInput.val(),page:window.location.pathname,subscribe:this.$(".join.ljr-panel .subscribe-checkbox").is(":checked")},h=this.$joinButton,u=c.default.queryUrlGetParam("redirect");if(this.clearErrors(),!h.hasClass("processing")&&""!==r.name&&""!==r.email&&""!==r.pass){c.default.isValidEmail(r.email)||(e=!0,o=r.email,this.$emailInput.prop("type","text").addClass("err").val(this.ERROR_MESSAGES.invalid_email));var p,g=this.getPasswordErrors(r.pass,[r.email]);if(g.length&&(i=!0,a=r.pass,this.$pswInput.prop("type","text").addClass("err").val(this.ERROR_MESSAGES[g[0]])),(e||i)&&(clearTimeout(this.showErrorTimeout),this.showErrorTimeout=setTimeout(s.a.bind((function(){e&&this.$emailInput.removeClass("err").prop("type","email").val(o),i&&this.$pswInput.removeClass("err").prop("type","password").val(a)}),this),3e3)),!e&&!i)this.showButtonPreloader(h),this.router.analytics.sendEvent("Join","General"),r.pass=Object(m.a)("authorization.newFlow")?r.pass:l()(r.pass),p=Object(m.a)("authorization.newFlow")?d.a.readymag_auth_host+"/auth/register":d.a.readymag_auth_host+"/api/register",n.a.ajax({type:"POST",data:r,url:p,success:function(e){t.putStorageData("native"),t.redirectHandler(u,e,h)},error:function(e){var i;t.hideButtonPreloader(h),403===e.status?i="User with email ".concat(r.email," already exists. Forgot your password?"):406===e.status&&(i="Name must not contain links."),t.showError(i)}})}}},joinInputKey:function(t){13===t.keyCode&&this.createAccount()},sendRecoverRequest:function(){var t=this.$(".recover.ljr-panel .email-input").val(),e=this.$(".recover.ljr-panel .go");e.hasClass("processing")||c.default.isValidEmail(t)&&(this.showButtonPreloader(e),this.requestRecover(t,s.a.bind((function(t){this.hideButtonPreloader(e),this.$(".recover.ljr-panel").addClass("request-sended")}),this)))},requestRecover:function(t,e){var i;this.clearErrors(),i=Object(m.a)("authorization.newFlow")?d.a.readymag_auth_host+"/auth/recoverypass":d.a.readymag_auth_host+"/api/recoverypass",n.a.post(i,{email:t},e).error((function(t){404===t.status?e&&e():this.showError()}))},backFromRecover:function(){this.useNavigate?this.router.navigate("login/",{trigger:!0}):this.switchTo("login")},resetPassword:function(){var t=this,e=n.a.trim(this.$(".reset.ljr-panel .new-password-input").val()),i=n.a.trim(this.$(".reset.ljr-panel .verify-password-input").val()),o=window.ServerData.recover,a=[],r=this.$(".reset.ljr-panel .go");if(!r.hasClass("processing")&&""!==e&&""!==i){if(e!==i&&a.push(this.ERROR_MESSAGES.password_dont_match),this.getPasswordErrors(e).forEach((function(e){return a.push(t.ERROR_MESSAGES[e])})),a.length)return clearTimeout(this.wrongTimeout),this.$(".reset.ljr-panel").addClass("wrong-reset"),this.$(".reset.ljr-panel .error").html(a.join(" <br/>")),void(this.wrongTimeout=setTimeout(s.a.bind((function(){this.$(".reset.ljr-panel").removeClass("wrong-reset")}),this),2e3));o&&o.recover_code&&o.email&&(this.showButtonPreloader(r),n.a.ajax({type:"POST",data:{email:o.email,pass:l()(e),code:o.recover_code},url:d.a.readymag_auth_host+"/api/changepass",success:function(){window.location.href="/login/"},error:s.a.bind((function(){this.hideButtonPreloader(r),this.showError()}),this)}))}},onPasswordInput:function(t){var e=Object(n.a)(t.currentTarget);c.default.filterNonAscii(e)&&(e.addClass("error-input"),s.a.defer(s.a.bind((function(){e.removeClass("error-input")}),this)))},socialAuth:function(t){var e=this;this.$button=Object(n.a)(t.currentTarget);var i=this.$button.attr("data-provider"),o=d.a.readymag_auth_host+"/api/auth/"+i;if(!this.$button.hasClass("processing")){this.showButtonPreloader(this.$button),this.$button.closest(".join.ljr-panel").length&&this.router.analytics&&this.router.analytics.sendEvent("Join","General ".concat(i));var a=screen.width,s=screen.height,r=Math.min(1e3,a),l=Math.min(700,s-40),c=Math.ceil((a-r)/2),h=Math.ceil((s-l)/2);this.socialAuthWindow=window.open(o,"_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+r,"height="+l,"top="+h,"left="+c].join()),this.authInProgress=!0,this.popupCheckInterval=setInterval((function(){e.socialAuthWindow&&!e.socialAuthWindow.closed||(e.authInProgress=!1,clearInterval(e.popupCheckInterval),e.hideButtonPreloader(e.$button))}),100)}},handleSocialAuthResult:function(t){var e,i=this;if(this.authInProgress=!1,!t||t.error||!t.user||!t.user.uri)return this.hideButtonPreloader(this.$button),t.error&&(this.$el.scrollTop(this.$el[0].scrollHeight-this.$el.outerHeight()),this.showErrors(["Something went wrong"]),clearTimeout(this.showSocialErrorTimeout),this.showSocialErrorTimeout=setTimeout((function(){i.clearErrors()}),4e3)),void(t.user&&t.user.name&&(this.switchTo("join"),this.$(".join.ljr-panel .fullname-input").val(t.user.name),this.$(".join.ljr-panel .email-input").focus()));if(t.user.createdViaFacebook&&(e="facebook"),t.user.createdViaGoogle&&(e="google"),e)this.putStorageData(e),this.redirectAfterJoin(t.user.uri,this.$button);else{var n=c.default.queryUrlGetParam("redirect");if(n)return window.location.href=d.a.readymag_auth_host+n;window.location.href=d.a.readymag_auth_host+"/"+t.user.uri}},processLoginMessages:function(t){if(this.authInProgress){var e=t.originalEvent||{};if(e.origin===d.a.readymag_auth_host){var i=JSON.parse(decodeURIComponent(e.data));i&&"social-auth"===i.event&&(clearInterval(this.popupCheckInterval),this.socialAuthWindow&&this.socialAuthWindow.close(),this.handleSocialAuthResult(i.message))}}},redirectAfterJoin:function(t){var e=s.a.isFunction(this.joinCallback)?500:0;s.a.isFunction(this.joinCallback)&&this.joinCallback();var i=c.default.queryUrlGetParam("redirect");if(i)return window.location.href=d.a.readymag_auth_host+i;setTimeout(s.a.bind((function(){var e=d.a.readymag_auth_host+"/"+t+"/";if(!g.a.isDesktop||Modernizr.msie||Modernizr.msie11)window.location.href=e;else{var i=Modernizr.sessionstorage&&window.sessionStorage.getItem("rm.loginReturnUrl",window.location.pathname);if(Modernizr.sessionstorage&&window.sessionStorage.removeItem("rm.loginReturnUrl"),i)return window.location.href=d.a.readymag_auth_host+i;var n=this.createMagParams,o=n&&n.templateID,a=n&&n.tp?n.tp+"-join-form":"join-form";new p.default({router:this.router,me:{permissions:{can_create_mag:!0},uri:t},tp:a,templateID:o,noCreateRequestTracking:n&&n.noCreateRequestTracking,error:s.a.bind((function(){this.hideButtonPreloader(this.$button)}),this)})}}),this),e)},enableCors:function(){n.a.ajaxPrefilter((function(t,e,i){-1!==t.url.indexOf(d.a.readymag_auth_host)&&(t.xhrFields={withCredentials:!0})}))},onTouchStart:function(t){this.disableScrollWatcher||(this.scrollY=t.originalEvent.touches.item(0).clientY)},onTouchMove:function(t){if(!this.disableScrollWatcher){var e=Object(n.a)(t.currentTarget),i=this.scrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.scrollY=t.originalEvent.touches.item(0).clientY}},destroy:function(){this.hide(),Object(n.a)(window).off("message",this.processLoginMessages),setTimeout(s.a.bind((function(){this.$el.remove()}),this),400)},putStorageData:function(t){var e={},i=new Date;e.type=t,e.utm_campaign=c.default.queryUrlGetParam("utm_campaign"),e.utm_source=c.default.queryUrlGetParam("utm_source"),e.utm_medium=c.default.queryUrlGetParam("utm_medium"),e.rm_url=encodeURI(window.location.href),e.rm_referrer=document.referrer,e.timestamp=i.valueOf(),e._ga=c.default.getCookie("_ga");var n=btoa(JSON.stringify(e));c.default.createCookie("send_join_event",n,10)},getPasswordErrors:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[];return t.length<8&&i.push("min"),e.includes(t)&&i.push("oneOf"),/[a-zA-Z]+/.test(t)||i.push("letters"),i}});e.default=f},BrCd:function(module,exports){module.exports={"template-viewer-cart-sidebar":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n  <div id="cart-sidebar" class="cart-sidebar">\n    <div class="close-button" data-alt="Close cart" data-alt-pos="bottom" data-alt-offset="9">\n      <div class="line-1"></div>\n      <div class="line-3"></div>\n    </div>\n\n    <div class="cart-sidebar-wrapper">\n      <div class="cart-sidebar-tabs">\n\n        <div class="cart-sidebar-tab tab-items active">\n          <div class="sidebar-header">\n            <div class="sidebar-title">\n              Cart\n            </div>\n            <div class="sidebar-btn go-forward" data-tab="tab-inputs">\n              Check out\n              <img class="btn-icon-right svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="cart-items-list"></div>\n          </div>\n\n          <div class="empty-cart">\n            <div class="empty-cart-title">Cart is empty</div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-inputs">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-items">\n                <img class="btn-icon-center svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward" data-tab="tab-order">\n              Summary\n              <img class="btn-icon-right svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n          </div>\n          <div class="sidebar-body">\n            <div class="order-details-form shipping-form">\n              <div class="form-title">Shipping address</div>\n              <div class="form-row">\n                <div class="form-error country-error hidden"></div>\n                <div class="countries-select"></div>\n              </div>\n              <div class="form-row">\n                <div class="form-error name-error hidden"></div>\n                <input type="text" class="form-input name-input" name="name" placeholder="Customer name" />\n              </div>\n              <div class="form-row">\n                <div class="form-error line1-error hidden"></div>\n                <input type="text" class="form-input line1-input" name="line1" placeholder="Address" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input line2-input" name="line2" placeholder="Apt, unit, building, floor…" />\n              </div>\n              <div class="form-row">\n                <div class="form-error city-error hidden"></div>\n                <input type="text" class="form-input city-input" name="city" placeholder="City" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input state-input" name="state" placeholder="State/Region" />\n              </div>\n              <div class="form-row">\n                <input type="text" class="form-input postal_code-input" name="postal_code" placeholder="Zip/Postal code" />\n              </div>\n              <div class="form-row">\n                <div class="form-error phone-error hidden"></div>\n                <input type="text" class="form-input phone-input" name="phone" placeholder="Phone" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Email</div>\n              <div class="form-row">\n                <div class="form-error email-error hidden"></div>\n                <input type="text" class="form-input email-input" name="email" placeholder="address@sample.com" />\n              </div>\n            </div>\n            <div class="order-details-form">\n              <div class="form-title">Note</div>\n              <div class="form-row">\n                <textarea class="form-input note-input" rows="4" name="note" placeholder="Add shipping details"></textarea>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-order">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-inputs">\n                <img class="btn-icon-center svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="sidebar-btn go-forward cart-pay-btn hidden" data-tab="tab-checkout">\n              Pay\n              <img class="btn-icon-right svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-right-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="order-details">\n              <div class="order-items-block order-row">\n                <div class="order-title-row summary-title">Order summary</div>\n                <div class="order-items-list order-info-block"></div>\n              </div>\n              <div class="order-id-container order-row">\n                  <div class="order-title-row">Order ID</div>\n                  <div class="order-id order-info-block"></div>\n              </div>\n              <div class="shipping-details">\n                <div class="shipping-address order-row">\n                  <div class="order-title-row">Shipping address</div>\n                  <div class="order-shipping-address order-info-block"></div>\n                </div>\n                <div class="shipping-method order-row">\n                    <div class="order-title-row">Shipping method</div>\n                    <div class="order-shipping-method order-info-block"></div>\n                </div>\n              </div>\n              <div class="shipping-tax-size order-row">\n                <div class="order-title-row">Order tax</div>\n                <div class="order-tax order-info-block"></div>\n              </div>\n              <div class="shipping-email order-row hidden">\n                    <div class="order-title-row">Email</div>\n                    <div class="order-shipping-email order-info-block"></div>\n              </div>\n              <div class="shipping-phone order-row hidden">\n                    <div class="order-title-row">Phone</div>\n                    <div class="order-shipping-phone order-info-block"></div>\n              </div>\n              <div class="shipping-total-price order-row">\n                <div class="order-title-row">Grand total</div>\n                <div class="order-total-price order-info-block"></div>\n              </div>\n            </div>\n          </div>\n          <div class="order-error hidden">\n            <div class="order-error-container">\n              <div class="order-error-title">\n                Error\n              </div>\n              <div class="order-error-message">\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="cart-sidebar-tab tab-checkout">\n          <div class="sidebar-header">\n            <div class="sidebar-btn go-back" data-tab="tab-order">\n                <img class="btn-icon-center svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/sidebar-left-arrow.svg" />\n            </div>\n            <div class="preloader">\n              <div class="svg-wrap">\n              <svg width="14px" height="26px" viewBox="0 0 14 26" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                  <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">\n                      <g transform="translate(-1094.000000, -34.000000)" fill-rule="nonzero" stroke="#FFFFFF" stroke-width="2">\n                          <g transform="translate(1070.000000, 22.000000)">\n                              <path d="M25,37 C31.627417,37 37,31.627417 37,25 C37,18.372583 31.627417,13 25,13" id="Path"></path>\n                          </g>\n                      </g>\n                  </g>\n              </svg>\n              </div>\n            </div>\n          </div>\n\n          <div class="sidebar-body">\n            <div class="payment-title">Pay with card</div>\n            <form action="/charge" method="post" id="payment-form">\n              <div class="form-row">\n                <div class="form-error card-number-error hidden"></div>\n                <div id="card-number-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-expiry-error hidden"></div>\n                <div id="card-expiry-element" class="payment-input">\n                </div>\n              </div>\n              <div class="form-row">\n                <div class="form-error card-name-error hidden"></div>\n                <input type="text" class="payment-input card-name-input hidden" name="name" placeholder="Name on card" />\n              </div>\n              <div class="form-row">\n                <div class="form-error card-cvc-error hidden"></div>\n                <div id="card-cvc-element" class="payment-input">\n                </div>\n              </div>\n\n              \x3c!-- Used to display Element errors. --\x3e\n              <div id="card-number-errors" role="alert"></div>\n              <div id="card-expiry-errors" role="alert"></div>\n              <div id="card-name-errors" role="alert"></div>\n              <div id="card-cvc-errors" role="alert"></div>\n\n              <div id="payment-failed-msg">\n                <div class="failed-msg-content">\n                  <div class="error-icon">\n                    <svg width="4px" height="27px" viewBox="0 0 4 27" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                      <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                          <g transform="translate(-1010.000000, -261.000000)" fill="#FFFFFF" fill-rule="nonzero">\n                              <g transform="translate(1010.000000, 261.000000)">\n                                  <g>\n                                      <path d="M2,0 C3.05322259,-1.93473851e-16 3.90702819,0.853805605 3.90702819,1.90702819 C3.90702819,1.93727706 3.90630849,1.96752165 3.9048697,1.99773628 L3.04535404,20.0475651 C3.01996411,20.5807536 2.58027854,21 2.0464859,21 L1.9535141,21 C1.41972146,21 0.980035886,20.5807536 0.954645959,20.0475651 L0.0951302988,1.99773628 C0.045033609,0.945705789 0.857261433,0.0522551831 1.90929192,0.00215849327 C1.93950655,0.000719701408 1.96975113,5.55662667e-18 2,0 Z"></path>\n                                      <circle cx="2" cy="25" r="2"></circle>\n                                  </g>\n                              </g>\n                          </g>\n                      </g>\n                    </svg>\n                  </div>\n                  <div class="error-message"></div>\n                </div>\n              </div>\n\n              <button class="sidebar-btn cart-payment-btn">Pay</button>\n            </form>\n            <div id="payment-request-button"></div>\n            <div class="cart-cancel-btn">Cancel order</div>\n          </div>\n          <div id="payment-success-msg">\n            <div class="success-msg-content">\n              <div class="title">Payment completed</div>\n              <div class="description">Check your email for details</div>\n            </div>\n          </div>\n        </div>\n\n        <div class="sidebar-footer-mobile">\n          <img class="power-by-stripe svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/powered_by_stripe.svg" />\n        </div>\n\n      </div>\n      <div class="sidebar-footer">\n        <img class="power-by-stripe svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/viewer/cart-sidebar/powered_by_stripe.svg" />\n      </div>\n    </div>\n  </div>\n';return __p}}},CLR5:function(t,e,i){"use strict";var n=i("xi34"),o=i("OTSC"),a={model:{event:"change"},props:{value:{type:Number,default:1},width:{type:Number,default:120},handleWidth:{type:Number,default:30},gradientColor:{type:String,default:"none"},gap:{type:Number,default:0}},computed:{percent:function(){return Math.round(100*this.value)},gradientLeft:function(){return o.default.getRGBA(this.gradientColor,1)},gradientRight:function(){return o.default.getRGBA(this.gradientColor,0)}},watch:{value:function(t){t!==Object(n.a)(this.$el).data("opacity")&&Object(n.a)(this.$el).data("rmopacitydragChange")({opacity:t})}},mounted:function(){Object(n.a)(this.$el).rmOpacityDrag({opacity:this.value,onchange:this.onOpacityChange,onenddrag:this.onOpacityEndDrag,width:this.width,handleWidth:this.handleWidth,gap:this.gap}).data("rmopacitydrag-change")},methods:{opacityMouseEnter:function(){this.$emit("opacity-active",!0)},opacityMouseLeave:function(){this.$emit("opacity-active",!1)},onOpacityEndDrag:function(){this.$emit("opacity-active",!1)},onOpacityChange:function(t){Object(n.a)(this.$refs.handle).hasClass("opacity-dragging")&&this.$emit("opacity-active",!0),Math.abs(this.value-t)>.001&&this.$emit("change",t)}}},s=(i("2r+I"),i("KHd+")),r=Object(s.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rm-opacity-slider",style:{background:"linear-gradient(to right, "+this.gradientLeft+", "+this.gradientRight+")"},on:{mouseenter:this.opacityMouseEnter,mouseleave:this.opacityMouseLeave}},[e("div",{ref:"handle",staticClass:"opacity-handle"},[this._t("default")],2)])}),[],!1,null,null,null);e.a=r.exports},CXd4:function(module,exports){module.exports={"template-viewer-navigation":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="navigation">\n\t\t<div class="navigation-arrow left offscreen"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div></div>\n\t\t<div class="navigation-arrow right offscreen"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div></div>\n\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div></div>\n\t</div>\n\n";return __p}}},Cmem:function(t,e,i){t.exports=i.p+"img/constructor/controls/add_to_cart_settings/color-disabled.svg"},D12m:function(t,e,i){"use strict";var n=i("xi34"),o=i("rFsW"),a=function(){};a.prototype={text_viewport_attributes:["style","class","data-size-leading-linked","data-size-leading-ratio","data-anchor-link-pos"],switchTextToViewport:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;if("default"===e)return t;var i=Object(n.a)("<div>").html(t),a=this.text_viewport_attributes,s=this;i.find("*").each((function(){var t=Object(n.a)(this);o.a.each(a,(function(i){var n=s.getViewportAttributeName(i,e),o=s.getViewportAttributeName(i,"default"),a=t.attr(n),r=t.attr(i);t.removeAttr(o),r&&t.attr(o,r),a&&("empty"===a?t.removeAttr(i):t.attr(i,a))}))}));var r=i.html();return i.empty().remove(),r},getViewportAttributeName:function(t,e){var i=t+"-"+e;return/^data/.test(i)||(i="data-"+i),i}},e.a=a},DA8H:function(module,exports){module.exports={"template-constructor-control-text_columns":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Columns" data-alt-pos="left" data-alt-offset="9"></div>\n\t<div class="panel">\n\t\t<div class="substract"></div>\n\t\t<div class="add"></div>\n\t\t<div class="number">1</div>\n\n\t\t<div class="separator"></div>\n\n\t\t<div class="bg-color" title="Background Color">\n\t\t\t<div class="color"></div>\n\t\t\t<div class="arrow-icon"></div>\n\t\t</div>\n\n\t\t<div class="gutter">\n\t\t\t<div class="grid"></div>\n\t\t\t<input class="gap" type="text" spellcheck="false" value="" title="Column Gap"/>\n\t\t</div>\n\n\t\t<div class="colorbox_container"></div>\n\t</div>\n';return __p}}},DiDd:function(module,exports){module.exports={"template-common-add-to-cart-wrap":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="add-to-cart-wrap">\n\t\t<div class="add-to-cart-attributes"></div>\n\t\t<div class="button-wrap">\n\t\t\t<div class="add-to-cart-button">\n\t\t\t\t<div class="add-to-cart-error-block"></div>\n\t\t\t\t<div class="button-icon"></div>\n\t\t\t\t<input type="text" class="button-text" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" readonly="readonly"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="sizes-calculating-block"></div>\n\t</div>\n';return __p}}},DqjY:function(t,e,i){"use strict";var n=i("xi34"),o=i("rFsW"),a=i("tZHv"),s=i("OTSC"),r=i("v92f"),l=i("wAEK"),c=i.n(l),d=i("Kf/z"),h=i("NbUU"),u={STYLE_PREFIXES:{paragraph:{viewer:[".used-fonts-test p",".rmwidget.text div p"],editor:["p"],constructor:[".used-fonts-test p",".block.block-text .text-preview p",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h1":{viewer:[".used-fonts-test h1",".rmwidget.text div h1"],editor:["h1"],constructor:[".used-fonts-test h1",".block.block-text .text-preview h1",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h2":{viewer:[".used-fonts-test h2",".rmwidget.text div h2"],editor:["h2"],constructor:[".used-fonts-test h2",".block.block-text .text-preview h2",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h3":{viewer:[".used-fonts-test h3",".rmwidget.text div h3"],editor:["h3"],constructor:[".used-fonts-test h3",".block.block-text .text-preview h3",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},"header-h4":{viewer:[".used-fonts-test h4",".rmwidget.text div h4"],editor:["h4"],constructor:[".used-fonts-test h4",".block.block-text .text-preview h4",".controls .control.text_styles .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .paragraph-style .style-caption"]},link:{viewer:[".rmwidget.text div a"],editor:["a"],constructor:[".block.block-text .text-preview a",".controls .control.text_link .panel .resizable-scroll-wrapper .resizable-content-wrapper .resizable-content .link-style .style-caption"]}},fontsShortList:{},generateStylesStr:function(t){var e,i,n,o="",a=t.style,r=t.indentation?"\t":"",l=";"+(t.lineBreaks?"\n":""),c=t.attrPrefix||"";return"paragraph"==t.tp&&(o+=r+"font-family: "+d("font-family")+l,o+=r+"font-style: "+d("font-style")+l,o+=r+"font-weight: "+d("font-weight")+l,o+=r+"font-size: "+h(d("font-size"))+l,o+=r+"letter-spacing: "+h(d("letter-spacing"))+l,o+=r+"line-height: "+h(d("line-height"))+l,o+=r+"text-align: "+d("text-align")+l,o+=r+"text-decoration: "+d("text-decoration")+l,o+=r+"text-transform: "+d("text-transform")+l,o+=r+"color: "+s.default.getRGBA(d("color"),d("opacity")/100)+l,o+=r+"padding-top: "+h(d("padding-top"))+l,o+=r+"padding-right: "+h(d("padding-right"))+l,o+=r+"padding-bottom: "+h(d("padding-bottom"))+l,o+=r+"padding-left: "+h(d("padding-left"))+l),"link"==t.tp&&(o+=r+"text-decoration: none"+l,o+=r+"color: "+s.default.getRGBA(d("color"),d("opacity")/100)+l,"none"!=d("u-style")?(e=s.default.getRGBA(d("u-color"),d("u-opacity")/100),i=parseInt(d("u-size"),10),n=parseInt(d("u-offset"),10)+i,o+=r+"padding-bottom: "+h(Math.max(n,0))+l,"solid"==d("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 100%)"+l,o+=r+"background-size: 1px "+h(i)+l),"dotted"==d("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 50%, transparent 50%,transparent 100%)"+l,o+=r+"background-size: "+h(2*i)+" "+h(i)+l),"dashed"==d("u-style")&&(o+=r+"background: linear-gradient(to right, "+e+" 0%, "+e+" 66.6666%, transparent 66.6666%,transparent 100%)"+l,o+=r+"background-size: "+h(3*i)+" "+h(i)+l),o+=n<0?r+"background-position: 0 "+(100+n)+"%"+l:r+"background-position: 0 100%"+l,o+=r+"background-repeat: repeat-x"+l):o+=r+"background: none"+l),o;function d(t){var e=a[c+t];return"inherit"==e&&c&&(e=a[t]),e}function h(t){return t+(/px/i.test(t)?"":"px")}},generateCSS:function(t,e,i,s,r){if(s){var l=this.STYLE_PREFIXES[t][e],c=(r=r||{},this),d="";o.a.each(s,(function(i){if("paragraph"==t&&(i.tag&&"p"!==i.tag&&a.a.AVAILABLE_TEXT_TAGS.includes(i.tag)&&(l=[].concat(c.STYLE_PREFIXES["header-"+i.tag][e],c.STYLE_PREFIXES[t][e]).filter((function(t,e,i){return i.indexOf(t)===e}))),d+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",d+=c.generateStylesStr({tp:t,style:i,indentation:!0,lineBreaks:!0}),d+="}\n\n"),"link"==t){if(r.forcePseudoState&&r.forcePseudoClass==i._name)d+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",d+=c.generateStylesStr({tp:t,style:i,attrPrefix:r.forcePseudoState+"-",indentation:!0,lineBreaks:!0}),d+="}\n\n";else d+=o.a.map(l,(function(t){return t+"."+i._name})).join(",\n")+" {\n",d+=c.generateStylesStr({tp:t,style:i,indentation:!0,lineBreaks:!0}),d+="}\n\n",o.a.find(o.a.keys(i),(function(t){return/^current/.test(t)}))&&(d+=o.a.map(l,(function(t){return t+".current."+i._name})).join(",\n")+" {\n",d+=c.generateStylesStr({tp:t,style:i,attrPrefix:"current-",indentation:!0,lineBreaks:!0}),d+="}\n\n"),d+=o.a.map(l,(function(t){return t+".hovered."+i._name})).join(",\n")+" {\n",d+=c.generateStylesStr({tp:t,style:i,attrPrefix:"hover-",indentation:!0,lineBreaks:!0}),d+="}\n\n";d+=o.a.map(l,(function(t){return t+"."+i._name+" *"})).join(",\n")+" {\n",d+="\tcolor: inherit !important;\n",d+="\ttext-decoration: none !important;\n",d+="}\n\n"}})),i=i||document;var h="text_styles_"+t+"_"+e;Object(n.a)("#"+h,i).remove();var u=i.createElement("style");u.type="text/css",u.id=h,u.className="text_styles",u.appendChild(i.createTextNode(d)),i.getElementsByTagName("head")[0].appendChild(u)}},appendFontsCssToDocument:function(t,e){window.TypekitPreview&&window.TypekitPreview.setup&&window.TypekitPreview.setup({auth_id:a.a.TYPEKIT_ID,auth_token:a.a.TYPEKIT_TOKEN,default_subset:"all"});var i,r=Object(n.a)("link.fonts, style.fonts"),l=[],c=[],d={};r.each((function(){var t=Object(n.a)(this),e=t.attr("data-provider"),i=t.attr("data-fonts-and-variations").split("||");o.a.each(i,(function(t){l.push(e+"|"+t)}))})),o.a.each(t.fonts,(function(t){o.a.each(t.used_variations||t.variations,(function(e){c.push(t.provider+"|"+t.css_name+"|"+e)}))})),i=o.a.difference(c,l);var h={};o.a.each(i,(function(t){var e=t.split("|"),i=e[0],n=e[1],o=e[2],a=i+"|"+n;h[a]=h[a]||[],h[a].push(o)}));var u=[];o.a.each(h,(function(t,e){var i=e.split("|"),n=i[0],o=i[1],a=t;u.push({provider:n,css_name:o,variations:a})})),o.a.each(u,(function(e){var i,a=e.provider,s=e.css_name+"|"+e.variations.join("||"+e.css_name+"|");if(d[a]||(d[a]=[]),"google"==a){var r=n.a.map(e.variations,(function(t){return 100*(t.substr(1,1)-0)+("n"==t.substr(0,1)?"":"italic")}));i={fontAndVariations:s,data:e.css_name.split(" ").join("+")+":"+r.join(",")}}if("webtype"==a&&(i={fontAndVariations:s,data:e.css_name+":"+e.variations.join(",")}),"typetoday"==a&&(i={fontAndVariations:s,data:e.css_name+":"+e.variations.join(",")}),"custom"==a){var l=o.a.findWhere(t.fonts,{provider:"custom",css_name:e.css_name});l&&l.css_url&&(i={fontAndVariations:s,data:{css_name:e.css_name,css_url:l.css_url,signed_css_url:l.signed_css_url}})}"typekit"==a&&(i={fontAndVariations:s,data:{id:e.css_name,variations:e.variations}}),i&&d[a].push(i)}));var p=RM.screenshot&&"true"==s.default.queryUrlGetParam("pdf");p&&this.loadTypekitSubstitutionFonts(d.typekit);var g=o.a.has(d,"custom");function m(t){var e=Object(n.a)("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",t);Object(n.a)("head").append(e)}o.a.each(d,(function(i,r){var l,c,d,h,u,g,f="custom"==r?1:"google"==r?22:i.length,v=Math.ceil(i.length/f),b=0,_=function(){if(c=l*f,d=Math.min((l+1)*f,i.length),h=i.slice(c,d),u=o.a.pluck(h,"data"),g=o.a.pluck(h,"fontAndVariations"),Object(n.a)("link, style").addClass("existing"),"google"==r&&(w=(a.a.IS_FILE_PROTOCOL?"http://":"//")+"fonts.googleapis.com/css?family=",y=u.join("%7C"),"&subset=latin,vietnamese,khmer,cyrillic-ext,greek-ext,greek,devanagari,latin-ext,cyrillic",m(w+y+"&subset=latin,vietnamese,khmer,cyrillic-ext,greek-ext,greek,devanagari,latin-ext,cyrillic")),"typekit"==r){if("edit"==t.version&&!p)try{window.TypekitPreview&&window.TypekitPreview.load(u)}catch(t){}"published"==t.version&&t.typekit_url&&("undefined"!=typeof Typekit&&(Typekit=void 0),Object(n.a)("style.typekit-kit").remove(),n.a.getScript(t.typekit_url,(function(t,e,i){try{Typekit.load({active:function(){var t=Object(n.a)("style").filter((function(t,e){return/typekit/i.test(e.innerHTML)}));t.addClass("typekit-kit"),_(t)}})}catch(t){}})))}var v;function _(t){t.addClass("fonts").attr("data-id",s.default.generateUUID()).attr("data-provider",r).attr("data-fonts-and-variations",g.join("||"))}"webtype"==r&&(w=RM.common.isDownloadedSource?a.a.readymag_host:"",Object(n.a)('link.fonts[data-provider="webtype"]').length||(k=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.webtype,m(w+k))),"typetoday"!=r||p||(w=RM.common.isDownloadedSource?a.a.readymag_host:"",Object(n.a)('link.fonts[data-provider="typetoday"]').length||(k=window.ServerData&&window.ServerData.fonts&&window.ServerData.fonts.typetoday,m(w+k))),"custom"==r&&(S=u[0].signed_css_url||u[0].css_url,/^\/api\/fonts\//i.test(S)?(v=Object(n.a)("<style>").attr("type","text/css"),Object(n.a)("head").append(v),n.a.get(S,(function(t){v.text(t),++b>=i.length&&o.a.isFunction(e)&&e()}))):m(S)),_(Object(n.a)("link:not(.existing), style:not(.existing)")),Object(n.a)("link, style").removeClass("existing")};for(l=0;l<v;l++){var y,w,k,S;_()}})),!g&&o.a.isFunction(e)&&e()},loadTypekitSubstitutionFonts:function(t){t&&t.length&&o.a.each(t,(function(t){var e,i=t.data.id,a=(t.data.variations,{"sans-serif":"news-gothic",decorative:"news-gothic",handmade:"news-gothic",blackletter:"news-gothic",script:"news-gothic","slab-serif":"news-gothic",serif:"georgia-pro",monospaced:"nitti"}),s="template-export-pdf-typekit-substitution-"+(a[(e=(e=(e=o.a.findWhere(u.fontsShortList.typekit,{id:i}))&&e.browse_info)&&e.classification)&&e.length&&e[0]||"sans-serif"]||a["sans-serif"]),r=(0,c.a[s])({id:i});Object(n.a)("head").append(r)}))},appendFontsCssToIFrame:function(t){var e=Object(n.a)("link.fonts, style.fonts"),i=Object(n.a)("link.fonts, style.fonts",t),o={},a=Object(n.a)("head",t);i.each((function(){o[Object(n.a)(this).attr("data-id")]=!0})),e.each((function(){var t=Object(n.a)(this),e=this.href;if(!o[t.attr("data-id")]){var i=t.clone();e&&Modernizr.safari&&i.attr("href",e+"&edit_mode=true"),i.appendTo(a)}}))},isFastFontLoadCheckAvailable:function(){return Boolean(document.fonts&&window.Promise)},fastWaitForFontLoad:function(t,e,i){var n;if(document.fonts){var o=i+" "+e+" 12px "+t,a=Object(d.a)("viewer.simpleFontLoadCheck")?document.fonts.load(o):document.fonts.load(o).then(function(){return document.fonts.check(o)?o:this.fontLoadedTimeoutCheck(o)}.bind(this)),s=new window.Promise((function(t,e){setTimeout(e.bind(null,o),3500)}));n=window.Promise.race([a,s])}else n=window.Promise.reject();return n},exactWaitForFontLoad:function(t,e,i,o){var a=i+" "+e+" 12px "+t+", Arial",s=i+" "+e+" 12px Arial",r=Object(n.a)('<canvas width="20" height="20"></canvas>'),l=r[0],c=l.getContext("2d"),d="",h="",u=+new Date;r.appendTo("body").css({position:"absolute",left:0,top:"-999px"}),function n(){var p=+new Date-u>1e4,g=function(){var t=a;c.clearRect(0,0,20,20),d||(d=l.toDataURL("image/png"),t=s);c.font=t,c.fillStyle="000",c.fillText("a1-&q",0,20);var e=l.toDataURL("image/png");h||(h=e);return e!=d&&e!=h}();if(g||p)return c=void 0,r.remove(),void o(g,t,e,i);setTimeout(n,100)}()},fontLoadedTimeoutCheck:function(t){var e=Date.now();return new window.Promise((function(i,n){!function i(n,o){var a=Date.now()-e;document.fonts.check(t)?n(t):a<3500?setTimeout(i.bind(null,n,o),100):o(t)}(i,n)}))},getHotspotTextModels:function(t){var e=[];return t.widgets_collection&&t.widgets_collection.length&&(e=t.widgets_collection.filter((function(e){return"text"==e.get("type")&&t.get("wids").indexOf(e.get("_id"))>-1}))),t._nestedWidgetsJSON&&t._nestedWidgetsJSON.length?e=o.a.filter(t._nestedWidgetsJSON,(function(t){return"text"==t.type})):t.wids&&t.wids.length&&(e=o.a.filter(t.wids,(function(t){return"text"==t.type}))),e},getUsedFontsFromWidgetsModels:function(t){var e={},i={},n={},s={},l={},c={},p=t.models;function g(t,e){return"function"==typeof t.get?t.get(e):t[e]}for(var m=0;m<p.length;m++){var f=p[m];if("slideshow"==g(f,"type")&&g(f,"text_style")){var v=g(f,"text_style");v["font-family"]&&v["font-weight"]&&v["font-style"]&&(i[v["font-family"]+"|"+v["font-style"]+"|"+v["font-weight"]]=1)}if("button"==g(f,"type")){g(f,"font-family")&&g(f,"font-weight")&&g(f,"font-style")&&(n[g(f,"font-family")+"|"+g(f,"font-style")+"|"+g(f,"font-weight")]=1);for(var b=0;b<r.b.viewports.length;b++){var _=f["viewport_"+r.b.viewports[b].name];_&&(n[_["font-family"]+"|"+_["font-style"]+"|"+_["font-weight"]]=1)}}if(g(f,"type")===a.a.ecommerceCartBlockName&&g(f,"font-family")&&g(f,"font-weight")&&g(f,"font-style")&&(l[g(f,"font-family")+"|"+g(f,"font-style")+"|"+g(f,"font-weight")]=1),g(f,"type")===a.a.addToCartBlockName&&(g(f,"font-family")&&g(f,"font-weight")&&g(f,"font-style")&&(c[g(f,"font-family")+"|"+g(f,"font-style")+"|"+g(f,"font-weight")]=1),g(f,"attrs-font-family")&&g(f,"attrs-font-weight")&&g(f,"attrs-font-style")&&(c[g(f,"attrs-font-family")+"|"+g(f,"attrs-font-style")+"|"+g(f,"attrs-font-weight")]=1)),"form"==g(f,"type")){var y=g(f,"style-"+g(f,"style")+"-fields"),w=o.a.clone(g(f,"style-"+g(f,"style")+"-button-default"));o.a.isEmpty(w)||(w["font-family"]="inherit"==w["font-family"]?y["font-family"]:w["font-family"],w["font-style"]="inherit"==w["font-style"]?y["font-style"]:w["font-style"],w["font-weight"]="inherit"==w["font-weight"]?y["font-weight"]:w["font-weight"]),s[y["font-family"]+"|"+y["font-style"]+"|"+y["font-weight"]]=1,w&&(s[w["font-family"]+"|"+w["font-style"]+"|"+w["font-weight"]]=1);for(var k=0;k<r.b.viewports.length;k++){var S=f["viewport_"+r.b.viewports[k].name];S&&(y=S["style-"+S.style+"-fields"],w=o.a.clone(S["style-"+S.style+"-button-default"]),o.a.isEmpty(w)||(w["font-family"]="inherit"==w["font-family"]?y["font-family"]:w["font-family"],w["font-style"]="inherit"==w["font-style"]?y["font-style"]:w["font-style"],w["font-weight"]="inherit"==w["font-weight"]?y["font-weight"]:w["font-weight"]),y&&(s[y["font-family"]+"|"+y["font-style"]+"|"+y["font-weight"]]=1),w&&(s[w["font-family"]+"|"+w["font-style"]+"|"+w["font-weight"]]=1))}}Object(d.a)("constructor.textv3")&&"text"===g(f,"type")&&o.a.extend(e,Object(h.g)(f)),"text"==g(f,"type")&&g(f,"text")&&o.a.extend(e,this.scanTextForFontsAndVariationsRaw(g(f,"text"),g(f,"version"),t.excludeUnusedDefault,t.activeViewports)),"hotspot"==g(f,"type")&&o.a.each(this.getHotspotTextModels(f),o.a.bind((function(i){var n=g(i,"text");n&&o.a.extend(e,this.scanTextForFontsAndVariationsRaw(n,g(i,"version"),t.excludeUnusedDefault))}),this))}var x=o.a.extend({},e,i,n,s,l,c),C={};o.a.each(x,(function(t,e){var i=e.split("|"),n=i[0],o=i[1].toLowerCase(),a=i[2].toLowerCase();C[n]=C[n]||[],C[n].push("variable"===a?"v":("italic"===o?"i":"n")+Math.floor(a/100))}));var O,P=[],j=this;return o.a.each(C,(function(e,i){(O=o.a.findWhere(u.fontsShortList.webtype,{name:i}))?P.push({provider:"webtype",css_name:O.name,name:O.name,variations:O.variations,used_variations:j.calcBrowserUsedVariation(e,O.variations)}):(O=o.a.findWhere(u.fontsShortList.typetoday,{name:i}))?P.push({provider:"typetoday",css_name:O.name,name:O.name,variations:O.variations,used_variations:j.calcBrowserUsedVariation(e,O.variations)}):(O=o.a.findWhere(u.fontsShortList.google,{family:i}))?P.push({provider:"google",css_name:O.family,name:O.family,variations:O.variations,used_variations:j.calcBrowserUsedVariation(e,O.variations)}):(O=o.a.findWhere(u.fontsShortList.typekit,{id:i}))?P.push({provider:"typekit",css_name:O.id,name:O.name,variations:O.variations,used_variations:j.calcBrowserUsedVariation(e,O.variations)}):t.includeCustom&&(O=o.a.findWhere(t.customList,{css_name:i}))&&P.push({provider:"custom",css_name:O.css_name,css_url:O.css_url,name:O.name,variations:O.variations,used_variations:j.calcBrowserUsedVariation(e,O.variations)})})),P},getUsedParagraphStylesFromWidgetsModels:function(t){var e,i,n="";for(e=0;e<t.length;e++)"text"==l(i=t[e],"type")&&l(i,"text")&&(n+=l(i,"text")),"hotspot"==l(i,"type")&&o.a.each(this.getHotspotTextModels(i),o.a.bind((function(t){n+=l(t,"text")||""}),this));var a=[],s=RM.constructorRouter.workspace.mag.edit_params.get("paragraph_styles");if(n)for(e=0;e<s.length;e++){var r=s[e];n.indexOf(r._name)>=0&&a.push(r)}function l(t,e){return"function"==typeof t.get?t.get(e):t[e]}return a},getUsedLinkStylesFromWidgetsModels:function(t){var e,i,n="";for(e=0;e<t.length;e++)"text"==l(i=t[e],"type")&&l(i,"text")&&(n+=l(i,"text")),"hotspot"==l(i,"type")&&o.a.each(this.getHotspotTextModels(i),o.a.bind((function(t){n+=l(t,"text")||""}),this));var a=[],s=RM.constructorRouter.workspace.mag.edit_params.get("link_styles");if(n)for(e=0;e<s.length;e++){var r=s[e];n.indexOf(r._name)>=0&&a.push(r)}function l(t,e){return"function"==typeof t.get?t.get(e):t[e]}return a},sortFontsByProvider:function(t){var e=[],i=[],n={};return o.a.each(t,(function(t){"typekit"===t.provider&&e.push({id:t.css_name,variations:t.used_variations}),"custom"===t.provider&&i.push(t.css_name);var o="used_"+t.provider+"_fonts";n[o]=n[o]||[],"custom"===t.provider?n[o].push(t.css_name):n[o].push({id:t.css_name,variations:t.used_variations})})),{typekit:e,custom:i,dictionary:n}},scanTextForFontsAndVariationsRaw:function(t,e,i,a){var s,l,c,d,h,u,p,g,m,f,v={},b={},_=[],y=document.defaultView.getComputedStyle;for(s=0;s<r.b.viewports.length;s++)if(t.split("-"+r.b.viewports[s].name).length>1){if(a&&-1===a.indexOf(r.b.viewports[s].name))continue;_.push(r.b.viewports[s].name)}(c=Object(n.a)(".used-fonts-test")).length||(c=Object(n.a)("<div>").addClass("used-fonts-test").css({position:"absolute",display:"none !important",left:-9999,width:999}).appendTo("body")),c.removeClass("v1 v2").addClass("v"+(e||1)),(l=c[0]).innerHTML=t,u=(h=l.querySelectorAll("span,p,a")).length;var w,k=(d=y(l,null)).fontFamily+"|"+d.fontStyle+"|"+d.fontWeight;v[k]=1;for(var S=!1,x=function(t){return-1!==o.a.findIndex(t.childNodes,(function(t){return t.nodeType===Node.TEXT_NODE&&t.textContent.replace(/\r?\n/g,"").length}))},C=o.a.filter(h,x),O=0;O<C.length;O++)w=(d=y(C[O],null)).fontFamily+"|"+d.fontStyle+"|"+d.fontWeight,S=S||w===k,v[d.fontFamily+"|"+d.fontStyle+"|"+d.fontWeight]=1;var P=x(l);for(s=0;s<_.length;s++)if("default"!=(m=_[s])){for(O=0;O<u;O++)(p=(f=h[O]).getAttribute("data-style-"+m))&&("empty"==p?f.removeAttribute("style"):f.setAttribute("style",p)),(g=f.getAttribute("data-class-"+m))&&("empty"==g?f.removeAttribute("class"):f.setAttribute("class",g)),x(f)&&(w=(d=y(f,null)).fontFamily+"|"+d.fontStyle+"|"+d.fontWeight,S=S||w===k,v[w]=1);s<_.length-1&&(l.innerHTML=t,u=(h=l.querySelectorAll("span,p,a")).length)}return!i||S||P||delete v[k],o.a.each(v,(function(t,e){var i=e.split("|"),n=i[0],o=i[1].toLowerCase(),a=i[2].toLowerCase();n=(n=n.split(",")[0]).replace(/'|"/g,""),a=(a=(a=a.replace(/normal/g,"400")).replace(/regular/g,"400")).replace(/bold/g,"700"),b[n+"|"+o+"|"+a]=1})),b},calcBrowserUsedVariation:function(t,e){for(var i={},n=0;n<t.length;n++){for(var a,s,r,l=t[n],c=l.substr(1,1),d=l.substr(0,1),h=99999,u="",p=0;p<e.length;p++)a=e[p].substr(1,1)-0,s=e[p].substr(0,1),c<4&&(r=10*Math.abs(a-c)+(s==d?0:1e3)+(a<=c?0:100)),c>5&&(r=10*Math.abs(a-c)+(s==d?0:1e3)+(a>=c?0:100)),4==c&&(r=5==a?0+(s==d?0:1e3)+0:10*Math.abs(a-c)+(s==d?0:1e3)+(a<=c?0:100)),5==c&&(r=10*Math.abs(a-c)+(s==d?0:1e3)+(a<=c?0:100)),c==a&&d==s&&(r=0),r<h&&(h=r,u=e[p]);i[u]=1}return o.a.keys(i)},getVeryShortList:function(t){var e={google:[],typekit:[],webtype:[],typetoday:[]};return o.a.each(t,(function(t){var i,n=t.provider;switch(n){case"google":i={provider:n,family:t.name,variations:t.variations};break;case"typekit":i={provider:n,id:t.css_name,name:t.name,variations:t.variations};break;case"webtype":case"typetoday":i={provider:n,name:t.name,variations:t.variations}}e[n]&&e[n].push(i)})),e},getCustomVariationNameByFVD:function(t,e){return(u.fontCustomVariationNames[t]||{})[e]},setShortList:function(t){u.fontsShortList=t||{},u.fontCustomVariationNames={},o.a.each(u.fontsShortList,(function(t,e){o.a.each(t,(function(t){if(t.custom_variation_names){var i;switch(e){case"google":i=t.family;break;case"typekit":case"webtype":case"typetoday":i=t.name}u.fontCustomVariationNames[i]=t.custom_variation_names}}))}))}};window.fontsShortListCallback=function(t){u.setShortList(t)},e.a=u},DwEc:function(t,e,i){"use strict";i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return s}));var n=i("q1tI"),o=i.n(n),a=o.a.createContext({}),s=o.a.createContext({})},E913:function(t,e,i){},ENxh:function(t,e,i){},EvVy:function(t,e,i){"use strict";var n=i("4BoS");i.n(n).a},"F+PN":function(t,e,i){"use strict";var n=i("j/3K");i.n(n).a},Fts9:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("u1Rx"),l=i.n(r),c=i("Fi5S"),d=a.a.View.extend({name:"Colorbox",settings_vertical:{width:168,height:240,bottom_panel_height:72,hue_width:0,hue_width_opened:0,hue_height:24,color:"6CD632",opacity:1,swatches_max:60,swatches_min:10,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!1},settings_big:{width:208,height:240,bottom_panel_height:40,hue_width:9,hue_width_opened:20,color:"6CD632",opacity:1,swatches_max:60,swatches_min:10,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!1},settings_small:{width:152,height:240,bottom_panel_height:96,hue_width:9,hue_width_opened:16,color:"6CD632",opacity:1,swatches_max:60,swatches_min:15,favourites_max:6,favourites_per_line:3,swatches_per_line:5,fav_switch_speed:300,show_opacity:!0},initialize:function(t){this.model=RM.constructorRouter.mag.edit_params,this.colorDragData={},this.scrollDragData={},this.scrollData={height:0,percent:0,container_h:0,inner_h:0},this.settings={},this.RGB=[],this.HSB=[],this.section="color",s.a.bindAll(this),this["settings_"+t.type]?s.a.extend(this.settings,this["settings_"+t.type]):s.a.extend(this.settings,this.settings_big),s.a.extend(this.settings,t),"string"==typeof this.settings.color&&6==this.settings.color.length||(console.log("Error, wrong color set to colorbox: ",this.settings.color),this.settings.color=this.settings_big.color),this.RGB=this.hex2rgb(this.settings.color),this.HSB=this.rgb2hsb(this.RGB),this.settings.map_width=this.settings.width-("vertical"!=t.type?this.settings.hue_width:0),this.settings.map_height=this.settings.height-this.settings.bottom_panel_height,this.settings.hue_height=this.settings.hue_height||this.settings.height,this.settings.placeholdes_height=this.settings.map_height-22,this.settings.placeholdes_width=this.settings.width,"small"==this.settings.type&&(this.settings.placeholdes_height=166),this.template=l.a["template-constructor-helpers-colorbox"],this.create()},create:function(){this.favourites=this.model&&s.a.clone(this.model.get("fav_colors")),this.swatches=this.model&&s.a.clone(this.model.get("swatches")),this.render(),this.model&&this.model.attributes.colorbox_state&&this.section!==this.model.attributes.colorbox_state&&this.switchBetweenSwatchesAndColorsBridge(),!this.model||this.favourites.length||this.swatches.length||"swatches"!==this.section||this.switchBetweenSwatchesAndColorsBridge()},render:function(){if(Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("colorbox")})),this.setElement(Object(n.a)(this.template(this.settings)).appendTo(this.settings.$parent).addClass("rmcolorbox-type-"+this.settings.type)),this.$rmcolorbox_swatches_placeholdes=this.$(".rmcolorbox-swatches-placeholdes"),this.$rmcolorbox_swatches_placeholdes_wrapper=this.$(".rmcolorbox-swatches-placeholdes-wrapper"),this.$rmcolorbox_swatches_colors=this.$(".rmcolorbox-swatches-colors"),this.$rmcolorbox_swatches=this.$(".rmcolorbox-swatches"),this.$swatches_button=this.$(".rmcolorbox-swatches-button"),this.$add_to_swatches_button=this.$(".rmcolorbox-add-to-swatches-button"),this.$remove_from_swatches_button=this.$(".rmcolorbox-remove-from-swatches-button"),this.model||(this.$rmcolorbox_swatches.remove(),this.$swatches_button.remove(),this.$add_to_swatches_button.remove()),this.$scroll_handle=this.$(".rmcolorbox-swatches-scroll-handle"),this.$map_block=this.$(".rmcolorbox-map"),this.$map_handle=this.$map_block.find(".rmcolorbox-map-handle"),this.map_ctx=this.$map_block.find("canvas")[0].getContext("2d"),this.$rmcolorbox_color=this.$(".rmcolorbox-color"),this.$animation_box=this.$(".rmcolorbox-animation-box"),this.$animation_canvas=this.$animation_box.find("canvas"),this.animation_ctx=this.$animation_canvas[0].getContext("2d"),this.$hue_block=this.$(".rmcolorbox-hue"),this.hue_ctx1=this.$hue_block.find(".rmcolorbox-hue-canvas1")[0].getContext("2d"),"vertical"!=this.settings.type?(this.hue_ctx2=this.$hue_block.find(".rmcolorbox-hue-canvas2")[0].getContext("2d"),this.map_under_arrow_ctx=this.$(".rmcolorbox-map-under-arrow canvas")[0].getContext("2d")):this.$hueLine=this.$(".hue-line"),this.$opacity_block=this.$(".rmcolorbox-opacity"),this.$opacity_handle=this.$(".rmcolorbox-opacity-handle"),this.$input_rgb=this.$(".rmcolorbox-rgb-block-input"),this.$input_r=this.$(".rmcolorbox-r-block-input"),this.$input_g=this.$(".rmcolorbox-g-block-input"),this.$input_b=this.$(".rmcolorbox-b-block-input"),this.$input_r_g_b=this.$input_r.add(this.$input_g).add(this.$input_b),this.$hue_block.RMDrag({start:this.startHueDrag,move:this.startHueDrag,end:this.stopHueDrag,silent:!0,preventDefault:!0}),this.$map_block.RMDrag({start:this.startMapDrag,move:this.startMapDrag,silent:!0,preventDefault:!0}),this.$opacity_block.RMDrag({start:this.startOpacityDrag,move:this.startOpacityDrag,end:this.stopOpacityDrag,silent:!0,preventDefault:!0}),this.$scroll_handle.RMDrag({start:this.startScrollDrag,move:this.moveScrollDrag,end:this.stopScrollDrag,silent:!0,preventDefault:!0}),this.$rmcolorbox_swatches_placeholdes_wrapper.mousewheel(this.onScrollMouseWheel),this.$input_rgb.on("paste",this.rgbPaste).on("keyup keydown",this.rgbKeyPressed).on("blur",this.rgbBlur).on("focus",this.rgbFocus),this.$input_r_g_b.on("keyup keydown",this.r_g_bKeyPressed).on("blur",this.r_g_bBlur).on("focus",this.r_g_bFocus),this.$swatches_button.on("click",this.switchBetweenSwatchesAndColors),this.$add_to_swatches_button.on("click",this.addToSwatches),this.$remove_from_swatches_button.on("click",this.deleteColor),this.changeColor(void 0,void 0,void 0,!0),this.favourites&&this.swatches&&this.createFSPlaceholdes(!0),"small"===this.settings.type&&this.setOpacity(this.settings.opacity),this.favourites)for(var t=0;t<this.favourites.length;t++)this.favourites[t]&&this.addFavouritesColor(t,!0);if(this.swatches)for(t=0;t<this.swatches.length;t++)this.swatches[t]&&this.addSwatchesColor(t,!0);this.model&&this.model.on("change:swatches",this.onModelSwatchesChange),this.model&&this.model.on("change:fav_colors",this.onModelFavouritesChange),c.a.on("panel:showed",this.setCurrentSelectedColor)},onModelSwatchesChange:function(t,e){if(this.thisModelChangeInitiator)this.thisModelChangeInitiator=!1;else{this.thisModelChangeInitiator=!1,this.swatches=s.a.clone(e),this.createFSPlaceholdes(!0),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").remove();for(var i=0;i<this.swatches.length;i++)this.swatches[i]&&this.addSwatchesColor(i,!0);this.$remove_from_swatches_button.removeClass("active")}},onModelFavouritesChange:function(t,e){if(this.thisModelChangeInitiator)this.thisModelChangeInitiator=!1;else{this.thisModelChangeInitiator=!1,this.favourites=s.a.clone(e),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").remove();for(var i=0;i<this.favourites.length;i++)this.favourites[i]&&this.addFavouritesColor(i,!0);this.$remove_from_swatches_button.removeClass("active")}},toggleOpacity:function(t){this.$el.toggleClass("without-opacity",!t)},onSwatchesChange:function(){this.thisModelChangeInitiator=!0,this.model.save({swatches:s.a.clone(this.swatches)})},onFavouritesChange:function(){this.thisModelChangeInitiator=!0,this.model.save({fav_colors:s.a.clone(this.favourites)})},changeColor:function(t,e,i,n){n&&!t&&(t=this.HSB),n&&!e&&(e=this.RGB),"hue"==i||"sb"==i?e=this.hsb2rgb(t):t=this.rgb2hsb(e),(t[0]!=this.HSB[0]||n)&&(this.fillHue(t[0]),this.fillMap(t[0])),(t[1]!=this.HSB[1]||t[2]!=this.HSB[2]||n)&&this.$map_handle.css({left:Math.round(this.settings.map_width*t[1]/100)+"px",top:Math.round(this.settings.map_height*(100-t[2])/100)+"px"}),(e[0]!=this.RGB[0]||e[1]!=this.RGB[1]||e[2]!=this.RGB[2]||n)&&("input-rgb"!=i&&(this.$input_rgb.val(this.rgb2hex(e)),this.setInputSize(this.$input_rgb)),"vertical"!=this.settings.type&&("input-r"!=i&&(this.$input_r.val(e[0]),this.setInputSize(this.$input_r)),"input-g"!=i&&(this.$input_g.val(e[1]),this.setInputSize(this.$input_g)),"input-b"!=i&&(this.$input_b.val(e[2]),this.setInputSize(this.$input_b)))),e[0]==this.RGB[0]&&e[1]==this.RGB[1]&&e[2]==this.RGB[2]||"swatches"==i||this.unSelectColor();var o=!1;e[0]==this.RGB[0]&&e[1]==this.RGB[1]&&e[2]==this.RGB[2]&&"swatches"!=i||n||(o=!0),this.$opacity_block.css("background-color","#"+this.rgb2hex(e)),this.HSB=t,this.RGB=e,o&&this.trigger("colorchange",e[0],e[1],e[2],this.settings.opacity)},setColor:function(t){(t=this.hex2rgb(t))[0]==this.RGB[0]&&t[1]==this.RGB[1]&&t[2]==this.RGB[2]||this.changeColor(void 0,t,void 0,!0)},fillHue:function(t){if("vertical"==this.settings.type){for(var e=this.hue_ctx1.getImageData(0,0,this.settings.width,this.settings.hue_height),i=0,n=0;n<this.settings.width;n++){for(var o=360*(1-n/this.settings.width),a=this.hsb2rgb([o,100,100]),s=0;s<this.settings.hue_height;s++)e.data[i+s*this.settings.width*4]=a[0],e.data[i+1+s*this.settings.width*4]=a[1],e.data[i+2+s*this.settings.width*4]=a[2],e.data[i+3+s*this.settings.width*4]=255;i+=4}this.hue_ctx1.putImageData(e,0,0)}else{for(e=this.hue_ctx1.getImageData(0,0,this.settings.hue_width_opened-3,this.settings.hue_height),i=0,s=0;s<this.settings.hue_height;s++)for(o=360*(1-s/this.settings.hue_height),a=this.hsb2rgb([o,100,100]),n=0;n<this.settings.hue_width_opened-3;n++)e.data[i++]=a[0],e.data[i++]=a[1],e.data[i++]=a[2],e.data[i++]=255;this.hue_ctx1.putImageData(e,0,0),e=this.hue_ctx2.getImageData(0,0,3,this.settings.hue_height),i=0;for(s=0;s<this.settings.hue_height;s++)for(o=360*(1-s/this.settings.hue_height),a=this.hsb2rgb([o,100,100]),n=0;n<3;n++)e.data[i++]=a[0],e.data[i++]=a[1],e.data[i++]=a[2],e.data[i++]=255;for(var r=Math.round(this.settings.hue_height*(360-t)/360)-1,l=[1,1,2,1,2,3,2,1,1],c=[2,1,1,0,0,0,-1,-1,-2],d=0;d<l.length;d++)e.data[3*(r-c[d])*4+4*(3-l[d])+3]=0;this.hue_ctx2.putImageData(e,0,0)}},fillMap:function(t){for(var e=this.map_ctx.getImageData(0,0,this.settings.map_width,this.settings.map_height),i=0,n=this.hsb2rgb([t,100,100]),o=0;o<this.settings.map_height;o++)for(var a=1-o/(this.settings.map_height-1),s=[255*a,255*a,255*a],r=[n[0]*a,n[1]*a,n[2]*a],l=0;l<this.settings.map_width;l++)a=l/(this.settings.map_width-1),e.data[i++]=s[0]+(r[0]-s[0])*a,e.data[i++]=s[1]+(r[1]-s[1])*a,e.data[i++]=s[2]+(r[2]-s[2])*a,e.data[i++]=255;this.map_ctx.putImageData(e,0,0),this.fillMapUnderArrow(t),"vertical"==this.settings.type&&this.moveHueLine(t)},fillMapUnderArrow:function(t){if("vertical"!=this.settings.type){for(var e=this.map_under_arrow_ctx.getImageData(0,0,this.settings.hue_width,this.settings.map_height),i=0,n=0;n<this.settings.map_height;n++)for(var o=1-n/(this.settings.map_height-1),a=0;a<this.settings.hue_width;a++)e.data[i++]=255*o,e.data[i++]=255*o,e.data[i++]=255*o,e.data[i++]=255;this.map_under_arrow_ctx.putImageData(e,0,0)}},addToSwatches:function(t){t&&(t.stopPropagation(),t.preventDefault());for(var e=-1,i=-1,n=0;n<this.swatches.length;n++)this.swatches[n]?e=n:-1==i&&(i=n);if(e+1<this.settings.swatches_max)this.swatches[e+1]=this.rgb2hex(this.RGB),this.onSwatchesChange(),this.addSwatchesColor(e+1);else{if(!(i>=0))return;this.swatches[i]=this.rgb2hex(this.RGB),this.onSwatchesChange(),this.addSwatchesColor(i)}var o=this.$map_handle.position().left+this.$map_block.position().left,a=this.$map_handle.position().top+this.$map_block.position().top,s=this.$swatches_button.position().left+this.$swatches_button.width()/2,r=this.$swatches_button.position().top+this.$swatches_button.height()/2;this.$animation_box.removeClass("hidden");var l=Math.round(Math.sqrt(Math.pow(o-s,2)+Math.pow(a-r,2))),c=(s-o)/l,d=(r-a)/l,h="#"+this.rgb2hex(this.RGB),u=this.$animation_canvas.clone(),p=u[0].getContext("2d"),g=this;this.animation_ctx.clearRect(0,0,this.$animation_canvas[0].width,this.$animation_canvas[0].height),function t(e){if(e>l+25)return g.$animation_box.addClass("hidden"),void u.remove();p.clearRect(0,0,g.$animation_canvas[0].width,g.$animation_canvas[0].height),p.globalAlpha=.8,p.drawImage(g.$animation_canvas[0],0,0),g.animation_ctx.clearRect(0,0,g.$animation_canvas[0].width,g.$animation_canvas[0].height),g.animation_ctx.globalAlpha=1,void g.animation_ctx.drawImage(u[0],0,0),e<=l&&function(t,e,i){g.animation_ctx.beginPath(),g.animation_ctx.arc(t,e,5.5,0,2*Math.PI,!0),g.animation_ctx.closePath(),g.animation_ctx.lineWidth=1.2,g.animation_ctx.strokeStyle="#fff",g.animation_ctx.fillStyle=i,g.animation_ctx.fill()}(o+c*e,a+d*e,h);setTimeout((function(){t(e+6)}),10)}(0)},switchBetweenSwatchesAndColors:function(t){t&&(t.stopPropagation(),t.preventDefault()),this.switchBetweenSwatchesAndColorsBridge(this.settings.fav_switch_speed),this.model&&this.model.attributes.colorbox_state!==this.section&&this.model.save({colorbox_state:this.section}),"swatches"==this.section&&this.setCurrentSelectedColor()},switchBetweenSwatchesAndColorsBridge:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.$swatches_button.toggleClass("active"),this.$rmcolorbox_color.fadeToggle(t),this.$rmcolorbox_swatches.fadeToggle(t),this.$add_to_swatches_button.fadeToggle(t),this.$remove_from_swatches_button.fadeToggle(t),this.$(".rmcolorbox-color-input-blocker").fadeToggle(t),this.$swatches_button.hasClass("active")?this.$swatches_button.attr("title","Hide Swatches"):this.$swatches_button.attr("title","Swatches"),this.section="color"==this.section?"swatches":"color"},rgbPaste:function(t){if((t=t&&t.originalEvent)&&t.clipboardData&&t.clipboardData.getData&&/text\/plain/.test(t.clipboardData.types)){var e=t.clipboardData.getData("text/plain");e.indexOf("#")+1&&(t.preventDefault(),document.execCommand("insertText",!1,e.substr(1)))}},rgbKeyPressed:function(t){this.setInputSize(Object(n.a)(t.currentTarget));var e=Object(n.a)(t.currentTarget).val();for(e=e.replace(/[^0-9a-fA-F]/g,"");e.length<6;)e="0"+e;var i=this.hex2rgb(e);this.changeColor(void 0,i,"input-rgb"),t&&"keydown"==t.type&&13==t.keyCode&&Object(n.a)(t.currentTarget).blur()},rgbFocus:function(){this.$(".rmcolorbox-rgb-block").addClass("editing")},rgbBlur:function(t){this.$(".rmcolorbox-rgb-block").removeClass("editing"),Object(n.a)(t.currentTarget).val(this.rgb2hex(this.RGB)),this.setInputSize(Object(n.a)(t.currentTarget))},r_g_bKeyPressed:function(t){this.setInputSize(Object(n.a)(t.currentTarget));var e=Object(n.a)(t.currentTarget).data("param"),i=Object(n.a)(t.currentTarget).val();if(i=i.replace(/[^0-9]/g,""),i=parseInt(i,10),i=Math.max(Math.min(i,255),0),isNaN(i)&&(i=0),"r"==e)var o=[i,this.RGB[1],this.RGB[2]];if("g"==e)o=[this.RGB[0],i,this.RGB[2]];if("b"==e)o=[this.RGB[0],this.RGB[1],i];if(this.changeColor(void 0,o,"input-"+e),t&&"keydown"==t.type&&(13==t.keyCode&&"r"==e&&(this.$input_r.blur(),this.$input_g.focus()),13==t.keyCode&&"g"==e&&(this.$input_g.blur(),this.$input_b.focus()),13==t.keyCode&&"b"==e&&this.$input_b.blur(),38==t.keyCode||40==t.keyCode)){t.preventDefault();var a=t.shiftKey?10:1;i+=38==t.keyCode?a:-a,i=Math.max(Math.min(i,255),0),Object(n.a)(t.currentTarget).val(i),t.keyCode=0,this.r_g_bKeyPressed(t)}},r_g_bFocus:function(){this.$(".rmcolorbox-r-g-b-block").addClass("editing")},r_g_bBlur:function(t){this.$(".rmcolorbox-r-g-b-block").removeClass("editing");var e=Object(n.a)(t.currentTarget).data("param");"r"==e&&Object(n.a)(t.currentTarget).val(this.RGB[0]),"g"==e&&Object(n.a)(t.currentTarget).val(this.RGB[1]),"b"==e&&Object(n.a)(t.currentTarget).val(this.RGB[2]),this.setInputSize(Object(n.a)(t.currentTarget))},setInputSize:function(t){var e=Object(n.a)('<div style="position:absolute; top:-999px; left:-999px; width:900px; height:200px" class="rmcolorbox"></div>').appendTo("body"),i=Object(n.a)('<div style="position:absolute; width:auto"></div>').appendTo(e);i[0].className=t[0].className,i.text(t.val()+"0"),t.width(i.width()),e.remove()},startHueDrag:function(t){if("color"==this.section||"vertical"==this.settings.type)if("vertical"==this.settings.type){var e=t.pageX-this.$hue_block.offset().left;e=Math.min(Math.max(e,0),this.settings.width-1),e=360-Math.round(360*e/(this.settings.width-1)),this.changeColor([e,this.HSB[1],this.HSB[2]],void 0,"hue"),this.$hue_block.addClass("dragging")}else e=t.pageY-this.$hue_block.offset().top,e=Math.min(Math.max(e,0),this.settings.hue_height-1),e=360-Math.round(360*e/(this.settings.hue_height-1)),this.changeColor([e,this.HSB[1],this.HSB[2]],void 0,"hue"),this.$hue_block.addClass("dragging")},stopHueDrag:function(t){this.$hue_block.removeClass("dragging")},moveHueLine:function(t){if("color"==this.section||"vertical"==this.settings.type){var e=t/360*this.settings.width;e=Math.max(Math.min(this.settings.width-2,e),-1),this.$hueLine.css({right:e})}},startMapDrag:function(t){var e=t.pageX-this.$map_block.offset().left;e=Math.min(Math.max(e,0),this.settings.map_width-1),e=Math.round(100*e/(this.settings.map_width-1));var i=t.pageY-this.$map_block.offset().top;i=Math.min(Math.max(i,0),this.settings.map_height-1),i=100-Math.round(100*i/(this.settings.map_height-1)),this.changeColor([this.HSB[0],e,i],void 0,"sb")},startOpacityDrag:function(t){var e=t.pageX-this.$opacity_block.offset().left,i=this.$opacity_block.width(),n=this.$opacity_handle.width()/2,o=n,a=i-n;(e=Math.min(Math.max(e,0),i-1))>a&&(e=a),e<o&&(e=o);var s=((e-o)/(a-o)).toFixed(2);this.$opacity_handle.css({left:e}),this.$opacity_handle.find(".rmcolorbox-opacity-val").text(Math.round(100*s)+"%").addClass("dragging"),Math.abs(this.settings.opacity-s)>.001&&this.trigger("opacitychange",this.RGB[0],this.RGB[1],this.RGB[2],s-0),this.settings.opacity=s-0},stopOpacityDrag:function(t){this.$opacity_handle.find(".rmcolorbox-opacity-val").removeClass("dragging")},setOpacity:function(t,e){var i=this.$opacity_block.width(),n=this.$opacity_handle.width()/2,o=(i-n-n)*t+n,a=this.$opacity_handle.find(".rmcolorbox-opacity-val");if(e){a.addClass("dragging");var s=this.$opacity_handle.position().left,r=this.settings.opacity;s!=o&&this.$opacity_handle.stop().animate({left:o},{duration:1200,step:function(e,i){var n=r+(e-s)/(o-s)*(t-r);a.text(Math.round(100*n)+"%")},complete:function(){a.removeClass("dragging")}})}else this.$opacity_handle.css({left:o}),a.text(Math.round(100*t)+"%");this.settings.opacity=t},getFavouritesCoords:function(t){if("small"==this.settings.type){var e=32,i=18;return[e+t%this.settings.favourites_per_line*44,i+40*Math.floor(t/this.settings.favourites_per_line)]}return"big"==this.settings.type?(i=25,[(e=46)+t%this.settings.favourites_per_line*58,i+52*Math.floor(t/this.settings.favourites_per_line)]):"vertical"==this.settings.type?(i=20,[(e=36)+t%this.settings.favourites_per_line*48,i+48*Math.floor(t/this.settings.favourites_per_line)]):void 0},getSwatchesCoords:function(t){if("small"==this.settings.type){var e=25,i=95;return[Math.floor(e+t%this.settings.swatches_per_line*25),i+27*Math.floor(t/this.settings.swatches_per_line)]}return"big"==this.settings.type?(e=38,i=126,[Math.floor(e+t%this.settings.swatches_per_line*33),i+35*Math.floor(t/this.settings.swatches_per_line)]):"vertical"==this.settings.type?(i=104,[(e=28)+t%this.settings.swatches_per_line*28,i+28*Math.floor(t/this.settings.swatches_per_line)]):void 0},addFavouritesColor:function(t,e){var i=this.favourites[t],o=this.getFavouritesCoords(t),a=Object(n.a)('<div data-tp="big" data-ind="'+t+'" class="rmcolorbox-swatches-color-big" style="background:#'+i+";left:"+o[0]+"px;top:"+o[1]+'px"></div>');return this.$rmcolorbox_swatches_colors.append(a),a.RMDrag({start:this.startColorDrag,move:this.moveColorDrag,end:this.endColorDrag,silent:!0,preventDefault:!0,threshold:3}),e||this.createFSPlaceholdes(),a},addSwatchesColor:function(t,e){var i=this.swatches[t],o=this.getSwatchesCoords(t),a=Object(n.a)('<div data-tp="small" data-ind="'+t+'" class="rmcolorbox-swatches-color-small" style="background:#'+i+";left:"+o[0]+"px;top:"+o[1]+'px"></div>');return this.$rmcolorbox_swatches_colors.append(a),a.RMDrag({start:this.startColorDrag,move:this.moveColorDrag,end:this.endColorDrag,silent:!0,preventDefault:!0,threshold:3}),e||this.createFSPlaceholdes(),a},startColorDrag:function(t){var e=Object(n.a)(t.currentTarget);e.removeClass("rmcolorbox-swatches-color-moving"),e.css("z-index",9999),this.colorDragData={$target:e,mx:t.pageX,my:t.pageY,cx:e.position().left,cy:e.position().top,left:e.width()/2+3,top:e.height()/2+3,right:this.$rmcolorbox_swatches_colors.width()-e.width()/2-3,bottom:this.$rmcolorbox_swatches_colors.height()-e.height()/2-4,container_top:this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top,container_height:this.$rmcolorbox_swatches_placeholdes_wrapper.height(),orig_inner_top:this.$rmcolorbox_swatches_colors.position().top,cur_inner_top:this.$rmcolorbox_swatches_colors.position().top,wasMovement:!1,fillExEy:function(t,e){this.ex=this.cx+t-this.mx,this.ey=this.cy+e-this.my+(this.orig_inner_top-this.cur_inner_top),this.ex=Math.min(Math.max(this.ex,this.left),this.right),this.ey=Math.min(Math.max(this.ey,this.top),this.bottom)}}},moveColorDrag:function(t){this.colorDragData.wasMovement=!0,this.colorDragData.fillExEy(t.pageX,t.pageY),this.colorDragData.$target.css({left:this.colorDragData.ex+"px",top:this.colorDragData.ey+"px"}),this.checkAutoScroll(t.pageY)},checkAutoScroll:function(t){var e=t-this.colorDragData.container_top,i=this.colorDragData.container_top+this.colorDragData.container_height-t;e<20&&this.scrollBy(-2),i<20&&this.scrollBy(2),this.colorDragData.cur_inner_top=this.$rmcolorbox_swatches_colors.position().top},unSelectColor:function(){this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").removeClass("selected"),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").removeClass("selected"),this.$remove_from_swatches_button.removeClass("active")},selectColor:function(t){if(this.$remove_from_swatches_button.addClass("active"),t.addClass("selected"),"small"==t.attr("data-tp"))var e=this.hex2rgb(this.swatches[t.attr("data-ind")]);"big"==t.attr("data-tp")&&(e=this.hex2rgb(this.favourites[t.attr("data-ind")])),this.changeColor(void 0,e,"swatches")},deleteColor:function(t){if(Object(n.a)(t.currentTarget).hasClass("active")){var e=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big.selected, .rmcolorbox-swatches-color-small.selected");if(1==e.length){e.addClass("rmcolorbox-swatches-color-removing");var i=this;setTimeout((function(){"small"==e.attr("data-tp")&&(i.swatches[e.attr("data-ind")]=void 0,i.onSwatchesChange()),"big"==e.attr("data-tp")&&(i.favourites[e.attr("data-ind")]=void 0,i.onFavouritesChange()),e.remove(),i.createFSPlaceholdes()}),300)}this.unSelectColor()}},endColorDrag:function(t){if(this.colorDragData.$target.css("z-index","auto"),!this.colorDragData.wasMovement){var e=this.colorDragData.$target.hasClass("selected");return this.unSelectColor(),void(e||this.selectColor(this.colorDragData.$target))}this.colorDragData.$target.addClass("rmcolorbox-swatches-color-moving"),this.colorDragData.fillExEy(t.pageX,t.pageY),this.colorDragData.$target.css({left:this.colorDragData.ex+"px",top:this.colorDragData.ey+"px"});for(var i=0;i<this.settings.favourites_max;i++){var n=this.getFavouritesCoords(i);if(Math.round(Math.sqrt(Math.pow(n[0]-this.colorDragData.ex,2)+Math.pow(n[1]-this.colorDragData.ey,2)))<=20)break}for(var o=0;o<this.settings.swatches_max;o++){n=this.getSwatchesCoords(o);if(Math.round(Math.sqrt(Math.pow(n[0]-this.colorDragData.ex,2)+Math.pow(n[1]-this.colorDragData.ey,2)))<=13)break}var a=this.colorDragData.$target.attr("data-tp"),s=this.colorDragData.$target.attr("data-ind"),r=a,l=s;i<this.settings.favourites_max&&(r="big",l=i),o<this.settings.swatches_max&&(r="small",l=o);var c=this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top,d=this.$rmcolorbox_swatches_placeholdes_wrapper.offset().top+this.$rmcolorbox_swatches_placeholdes_wrapper.height();(t.pageY<c||t.pageY>=d)&&(r=a,l=s),this.moveColorToInd(this.colorDragData.$target[0],a,s,r,l)},moveColorToInd:function(t,e,i,o,a){if(e!=o||i!=a){if("big"==e)var s=this.$(".rmcolorbox-swatches-color-big[data-ind="+i+"]").removeClass("rmcolorbox-swatches-color-big"),r=this.getFavouritesCoords(i),l=this.favourites;else s=this.$(".rmcolorbox-swatches-color-small[data-ind="+i+"]").removeClass("rmcolorbox-swatches-color-small"),r=this.getSwatchesCoords(i),l=this.swatches;if("big"==o)var c=this.$(".rmcolorbox-swatches-color-big[data-ind="+a+"]").removeClass("rmcolorbox-swatches-color-big"),d=this.getFavouritesCoords(a),h=this.favourites;else c=this.$(".rmcolorbox-swatches-color-small[data-ind="+a+"]").removeClass("rmcolorbox-swatches-color-small"),d=this.getSwatchesCoords(a),h=this.swatches;s.css({left:d[0]+"px",top:d[1]+"px"}).addClass("rmcolorbox-swatches-color-"+o).addClass("rmcolorbox-swatches-color-moving").attr("data-tp",o).attr("data-ind",a),c.css({left:r[0]+"px",top:r[1]+"px"}).addClass("rmcolorbox-swatches-color-"+e).addClass("rmcolorbox-swatches-color-moving").attr("data-tp",e).attr("data-ind",i);var u=h[a];h[a]=l[i],l[i]=u,l!=this.favourites&&h!=this.favourites||this.onFavouritesChange(),l!=this.swatches&&h!=this.swatches||this.onSwatchesChange(),this.createFSPlaceholdes()}else{if("big"==e)var p=this.getFavouritesCoords(i);if("small"==e)p=this.getSwatchesCoords(i);Object(n.a)(t).css({left:p[0]+"px",top:p[1]+"px"})}},createFSPlaceholdes:function(t){this.$rmcolorbox_swatches_placeholdes.empty();for(var e=0;e<this.settings.favourites_max;e++){var i=this.getFavouritesCoords(e);this.$rmcolorbox_swatches_placeholdes.append('<div class="rmcolorbox-swatches-placeholder-big" style="left:'+i[0]+"px;top:"+i[1]+'px"></div>')}var n=0;for(e=0;e<this.swatches.length;e++)this.swatches[e]&&(n=e);n+=this.settings.swatches_per_line,n=Math.max(Math.min(n,this.settings.swatches_max-1),this.settings.swatches_min-1),n=Math.floor(n/this.settings.swatches_per_line)*this.settings.swatches_per_line+this.settings.swatches_per_line;var o=0;for(e=0;e<n;e++)(i=this.getSwatchesCoords(e))[1]>o&&(o=i[1]),this.$rmcolorbox_swatches_placeholdes.append('<div class="rmcolorbox-swatches-placeholder-small" style="left:'+i[0]+"px;top:"+i[1]+'px"></div>');var a=this.$rmcolorbox_swatches_colors.height(),s=o+("vertical"!=this.settings.type?17:14);this.$rmcolorbox_swatches_placeholdes.height(s),this.$rmcolorbox_swatches_colors.height(s),s!=a&&this.recalcScrollhandle(t)},recalcScrollhandle:function(t){this.scrollData.container_h=this.$rmcolorbox_swatches_placeholdes_wrapper.height(),this.scrollData.inner_h=this.$rmcolorbox_swatches_colors.height(),this.$scroll_handle.toggleClass("hidden",this.scrollData.inner_h<=this.scrollData.container_h),this.scrollData.height=this.scrollData.container_h/2*(this.scrollData.container_h/this.scrollData.inner_h),this.scrollData.height=Math.max(this.scrollData.height,20)+2,this.scrollTo(t?0:1,!0)},scrollTo:function(t,e,i){i=i||50,t=Math.max(Math.min(t,1),0),this.scrollData.percent=t;var n=t*(this.scrollData.container_h-this.scrollData.height),o=-t*(this.scrollData.inner_h-this.scrollData.container_h);e?(this.$scroll_handle.stop().animate({top:n+"px",height:this.scrollData.height-2+"px"},i,"linear"),this.$rmcolorbox_swatches_colors.stop().animate({top:o+"px"},i,"linear"),this.$rmcolorbox_swatches_placeholdes.stop().animate({top:o+"px"},i,"linear")):(this.$scroll_handle.css({top:n+"px",height:this.scrollData.height-2+"px"}),this.$rmcolorbox_swatches_colors.css("top",o+"px"),this.$rmcolorbox_swatches_placeholdes.css("top",o+"px"))},scrollBy:function(t,e,i){if(!(this.scrollData.inner_h<=this.scrollData.container_h)){var n=1/(this.scrollData.inner_h-this.scrollData.container_h);this.scrollTo(this.scrollData.percent+n*t,e,i)}},onScrollMouseWheel:function(t,e){return t.preventDefault(),this.scrollBy(-e/4,!0,50),!1},startScrollDrag:function(t){var e=Object(n.a)(t.currentTarget);e.addClass("dragging"),this.scrollDragData={$target:e,my:t.pageY,cy:e.position().top,top:0,bottom:this.scrollData.container_h-this.scrollData.height-2,fillEy:function(t){this.ey=this.cy+t-this.my,this.ey=Math.min(Math.max(this.ey,this.top),this.bottom),this.percent=(this.ey-this.top)/(this.bottom-this.top)}}},moveScrollDrag:function(t){this.scrollDragData.fillEy(t.pageY),this.scrollTo(this.scrollDragData.percent,!1)},stopScrollDrag:function(t){this.scrollDragData.$target.removeClass("dragging")},destroy:function(){this.model&&this.model.off("change:swatches",this.onModelSwatchesChange),this.model&&this.model.off("change:fav_colors",this.onModelFavouritesChange),c.a.off("panel:showed",this.setCurrentSelectedColor),this.$el.remove()},areColorsClose:function(t,e){var i=this.rgb2hsb(t),n=this.rgb2hsb(e);return Math.abs(i[0]-n[0])<=5&&Math.abs(i[1]-n[1])<=33&&Math.abs(i[2]-n[2])<=5&&Math.abs(t[3]-e[3])<=.06},hex2rgb:function(t){return[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]},rgb2hex:function(t){var e=t[0].toString(16),i=t[1].toString(16),n=t[2].toString(16);return(1==e.length?"0"+e:e)+(1==i.length?"0"+i:i)+(1==n.length?"0"+n:n)},hsb2rgb:function(t){var e,i,n,o,a,s,r,l,c=[t[0],t[1],t[2]];return c[0]%=360,0==c[2]?[0,0,0]:(c[1]/=100,c[2]/=100,c[0]/=60,o=Math.floor(c[0]),a=c[0]-o,s=c[2]*(1-c[1]),r=c[2]*(1-c[1]*a),l=c[2]*(1-c[1]*(1-a)),0==o?(e=c[2],i=l,n=s):1==o?(e=r,i=c[2],n=s):2==o?(e=s,i=c[2],n=l):3==o?(e=s,i=r,n=c[2]):4==o?(e=l,i=s,n=c[2]):5==o&&(e=c[2],i=s,n=r),[e=Math.floor(255*e),i=Math.floor(255*i),n=Math.floor(255*n)])},rgb2hsb:function(t){var e,i,n,o,a=[t[0],t[1],t[2]];return a[0]/=255,a[1]/=255,a[2]/=255,(e=Math.min(a[0],a[1],a[2]))==(o=Math.max(a[0],a[1],a[2]))?[180,0,100*o]:(i=a[0]==e?a[1]-a[2]:a[1]==e?a[2]-a[0]:a[0]-a[1],n=a[0]==e?3:a[1]==e?5:1,[Math.floor(60*(n-i/(o-e)))%360,Math.floor((o-e)/o*100),o=Math.floor(100*o)])},setCurrentSelectedColor:function(){var t=this.rgb2hex(this.RGB),e=this.favourites.indexOf(t),i=this.swatches.indexOf(t),n=null;e>-1&&(n=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big[data-ind='".concat(e,"']"))),i>-1&&(n=this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small[data-ind='".concat(i,"']"))),n&&(this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-big").removeClass("selected"),this.$rmcolorbox_swatches_colors.find(".rmcolorbox-swatches-color-small").removeClass("selected"),n.addClass("selected"))}});e.a=d},"G3+Z":function(t,e,i){"use strict";var n=["DOMMouseScroll","mousewheel"];e.a=function(t,e,i,o){t||(t=document),e||(e=window),"boolean"!=typeof i&&(i=!0);var a,s,r,l=function(t){!function(t,e,i,n){i&&(t.preventDefault?t.preventDefault():event.returnValue=!1);var o=t.detail||-t.wheelDelta/40;o*=19,"number"!=typeof n||isNaN(n)||(o*=n),e.scrollBy?e.scrollBy(0,o):e.scrollTop+=o}(t=t||window.event,e,i,o)};return(a=t.addEventListener)?(a.call(t,n[0],l,!1),a.call(t,n[1],l,!1)):(a=t.attachEvent)&&a.call(t,"on"+n[1],l),(s=t.removeEventListener)?r=function(){s.call(t,n[0],l,!1),s.call(t,n[1],l,!1)}:(s=t.detachEvent)&&(r=function(){s.call(t,"on"+n[1],l)}),{restore:r}}},G50q:function(module,exports){module.exports={"template-constructor-control-common_pack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Group" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},Gw2y:function(module,exports){module.exports={"template-viewer-final-page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="final-page offscreen hidden '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\n\t\t<div class="final-page-wrapper tp-'+(null==(__t=tp)?"":_.escape(__t))+'">\n\t\t\t<div class="final-page-container">\n\n\t\t\t\t<div class="dop-container-text">\n\t\t\t\t\t<div class="main-container">\n\t\t\t\t\t\t<a class="made-with" href="'+(null==(__t=Constants.readymag_host)?"":__t)+'">Made with <div class="logo"></div></a>\n\t\t\t\t\t\t<p class="bottom-text">Design from scratch and publish online, immediately.</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="dop-container-join">\n\t\t\t\t\t\t<div class="join ljr-panel ">\n\t\t\t\t\t\t\t<div class="header"><span>Join</span> or <a href="/login/" class="link">Log in</a></div>\n\t\t\t\t\t\t\t<input autocapitalize="on"  autocorrect="off" required="required" class="fullname-input input-template for-validate"  maxlength="24" type="text"     spellcheck="false" value="" placeholder="Name" />\n\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="email-input input-template for-validate"     type="email"    spellcheck="false" value="" placeholder="Email" />\n\t\t\t\t\t\t\t<input autocapitalize="off" autocorrect="off" required="required" class="password-input input-template for-validate"  type="password" spellcheck="false" value="" placeholder="Password" />\n\n\t\t\t\t\t\t\t<div class="checkbox-container">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" class="terms-checkbox for-validate" required="required">\n\t\t\t\t\t\t\t\t\t<span class="checkmark"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<p>I accept Readymag\n\t\t\t\t\t\t\t\t\t<a href="https://readymag.com/readymag/terms-and-privacy/" target="_blank">Terms & Privacy Policy</a>\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\t<div class="checkbox-container second">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" class="subscribe-checkbox">\n\t\t\t\t\t\t\t\t\t<span class="checkmark"></span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<p>Keep me updated on new features</p>\n\t\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\t<div class="go">Join</div>\n\n\t\t\t\t\t\t\t<div class="social-caption">Sign up with</div>\n\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'facebook\'>\n\t\t\t\t\t\t\t\t<span class="icon"></span>\n\t\t\t\t\t\t\t\t<span class="buttonText">Facebook</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="social-auth" data-provider=\'google\'>\n\t\t\t\t\t\t\t\t<span class="icon"></span>\n\t\t\t\t\t\t\t\t<span class="buttonText">Google</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="error"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="login ljr-panel hidden">\n            <div class="header"><a href="/join/" class="link">Join</a> or <span>Log in</span></div>\n\t\t\t\t\t\t<form method="post" action="/api/redirect" id="login_form">\n\t\t\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n\t\t\t\t\t\t\t<input name="password" autocapitalize="off" autocorrect="off" required="required" class="password-input input-template" autocomplete="on"  type="password" spellcheck="false" value=""  placeholder="Password" />\n\t\t\t\t\t\t\t<input name="url" type="hidden" value="" />\n\t\t\t\t\t\t\t<div class="go">Log in</div>\n\t\t\t\t\t\t</form>\n            <div class="social-caption">Log in with</div>\n            <div class="social-auth" data-provider=\'facebook\'>\n              <span class="icon"></span>\n              <span class="buttonText">Facebook</span>\n            </div>\n            <div class="social-auth" data-provider=\'google\'>\n              <span class="icon"></span>\n              <span class="buttonText">Google</span>\n            </div>\n\t\t\t\t\t\t<a href="/recover/" class="link forgot">Forgot password?</a>\n\t\t\t\t\t\t<div class="error">Invalid email or password</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="recover ljr-panel hidden">\n\t\t\t\t\t\t<div class="header"><span>Reset password</span></div>\n\t\t\t\t\t\t<div class="wrapper">\n\t\t\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="What’s your email?"/>\n\t\t\t\t\t\t\t<div class="go">Submit</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="send-message">We sent a message to <span class="recover-email">emailaddress@gmail.com</span><br/>so you can set a new password.</div>\n\t\t\t\t\t\t<div class="go-back">Go back</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n';return __p}}},"H3/6":function(t,e,i){"use strict";var n=i("rFsW"),o={defaultType:"codeinjection",matchers:{instagram:[/^\s*<blockquote\s+class=.instagram-media.*<\/blockquote>\s*<script.*src=.*instagram.+>.*<\/script>\s*$/gi],pinterest:[/^\s*<a.*data-pin-do=.*<\/a>([\s\S]*<script.*src=.*pinterest.+>.*<\/script>)?\s*$/i],facebookvideo:[/^\s*<div\s+id=.fb-root.*<\/div>[\s\S]*<script>.*src.*facebook.*sdk.*<\/script>[\s\S]*<div\s+class=.fb-video.*<\/div>\s*$/i],readymag:[/^\s*<a\s+class=.rm-mag-embed.*<\/a>[\s\S]*<script.+id=.readymag-embed-init.+><\/script>\s*$/i],ecommerce:[/^\s*<form\s+action=.*method=.*POST.+>[\s\S]*<script.*src=.*stripe.+>.*<\/script>[\s\S]*<\/form>\s*$/gim,/^\s*(<!--.*-->)?[\s\S]*<script.*src=.*stripe.+>[\s\S]*<\/script>[\s\S]*(<!--.*-->)?[\s\S]*<button .*>.*<\/button>[\s\S]*<div .*>.*<\/div>[\s\S]*<script>.*stripe.*<\/script>\s*$/gim,/^\s*<div\s+id=.+>[\s\S]*<\/div>[\s\S]*<script[\s\S]*scriptUrl[\s\S]*shopifycdn[\s\S]*>*<\/script>.*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<div\s+class=.gumroad-product-embed.+>[\s\S]*<\/div>\s*$/gim,/^\s*<script\s+src=.*gumroad.+><\/script>[\s\S]*<a\s+class=.gumroad-button.+>[\s\S]*<\/a>\s*$/gim,/^\s*<div\s+class=.*ecwid.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>\s*$/gim,/^\s*<div\s+class=.*ecsp.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>\s*$/gim,/^\s*<div\s+class=.*ec-cart-widget.+><\/div>[\s\S]*<div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*Ecwid.*<\/script>[\s\S]*<\/div>\s*$/gim,/^\s*<div\s+id=.*.+><\/div>[\s\S]*<script.+ecwid.+>.*<\/script>[\s\S]*<script.*>.*xProduct.*<\/script>[\s\S]*<\/div>\s*$/gim],iframe:function(t){var e=(t=t||"").replace(/<!--[\s\S]*-->/gi,"");return/^\s*<iframe[\s\S]*>[\s\S]*<\/iframe>\s*$/i.test(e)}},matchCode:function(t,e){for(var i in t=(t||"").trim(),this.matchers){var o=this.matchers[i];if(n.a.isFunction(o))return o(t,e)?i:this.defaultType;for(var a in o){if(a=o[a],n.a.isFunction(a)){if(a(t,e))return i}else if(new RegExp(a.source,a.flags).test(t.replace(/\n/g,"")))return i}}return this.defaultType}};e.a=o},HIJs:function(module,exports){module.exports={"template-constructor-control-common_unpack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Ungroup" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},HOx4:function(t,e,i){"use strict";var n=i("+EJ4");i.n(n).a},HjzJ:function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"e",(function(){return u})),i.d(e,"d",(function(){return g})),i.d(e,"b",(function(){return m})),i.d(e,"c",(function(){return f}));var n,o,a=i("q1tI"),s=i.n(a),r=i("sn3M");function l(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function c(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?c(Object(i),!0).forEach((function(e){h(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):c(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Unordered="unordered-list-item",t.Ordered="ordered-list-item"}(o||(o={}));var u=(h(n={},o.Unordered,{element:"li"}),h(n,o.Ordered,{element:"li"}),n),p="\n  display: list-item;\n  margin-left: 18px;\n",g=d(d({},Object(r.a)({className:o.Unordered,label:"Unordered list",styles:"\n      list-style: disc;\n      ".concat(p,"\n    ")})),Object(r.a)({className:o.Ordered,label:"Ordered list",styles:"\n      list-style: decimal;\n      ".concat(p,"\n    ")})),m=function(t){var e=t.children,i=t.type,n=l(t,["children","type"]);return i===o.Ordered?s.a.createElement("ol",n,e):s.a.createElement("ul",n,e)},f=function(t){return t===o.Ordered||t===o.Unordered}},HlXo:function(module,exports){module.exports={"template-constructor-block-audio":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="player-wrapper"></div>\n\t<div class="overlay"></div>\n';return __p}}},Hp7M:function(t,e,i){},HuYI:function(module,exports){module.exports={"template-common-form-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="button">\n\t\t<div class="caption"></div>\n\t\t<svg class="error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M17 19.8c-1.4 0-2.6 1.1-2.6 2.6s1.1 2.6 2.6 2.6c1.4 0 2.6-1.1 2.6-2.6S18.4 19.8 17 19.8zM19 0.4h-4L15 17.4h4L19 0.4z"/></svg>\n\t\t<svg class="show-if-empty-submitted-text" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 26"><path d="M31.4 3C30.6 2.3 29.4 2.3 28.6 3l0 0L13.1 18.6l-7.8-7.8 0 0c-0.8-0.7-2-0.7-2.7 0 -0.8 0.8-0.8 2 0 2.7l0 0L13.1 24.1l0.4-0.4h0L31.4 5.8l0 0C32.1 5 32.1 3.8 31.4 3z"/></svg>\n\t</div>\n';return __p}}},HwMs:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("roQd"),c=i("gobI"),d=i("m41J"),h=i("QNiq");i("Kf/z");function u(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function p(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?p(Object(i),!0).forEach((function(e){m(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function f(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function b(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}var _=a.a.View.extend({initialize:function(t){s.a.bindAll(this),s.a.extend(this,t);var e={};s.a.each(this.widgets,s.a.bind((function(t){if(t.hasAnimation()){var i=t.fixed_position||t.is_full_width||t.is_full_height||t.sticked?r.default.generateUUID():l.a.getUuidHash(t.getAnimations())||r.default.generateUUID();e[i]=e[i]||[],e[i].push(t)}}),this)),this.animations=[];var i=!h.a.isDesktop||!Modernizr.safari;s.a.each(e,function(t){this.addAnimation(t,{allowAccelerate:i})}.bind(this)),this.start.__debounced=s.a.debounce(this.start,300)},addAnimation:function(t,e){var i=this;e=e||{},t=s.a.isArray(t)?t:[t];var n=["nonMove","moveOnly"].concat(f(l.a.EVENT_TYPES)).reverse();f(t[0].getAnimations()).map((function(t){return l.a.isMoveOnly(t)?g(g({},t),{},{effects:"moveOnly"}):l.a.isNonMove(t)?g(g({},t),{},{effects:"nonMove"}):t})).sort((function(t,e){return n.indexOf(t.effects||t.type)-n.indexOf(e.effects||e.type)})).filter((function(t){return!l.a.isEmpty(t)})).map((function(n){var o=n.type;if(h.a.isDesktop||"hover"!==o||t[0].getAnimationTriggers(n.UUID).length){var a=t[0].animationObjects,s=Boolean(a&&a.length),r=new y[o]({page:i.page,widgets:t,rawAnimation:n,$container:s?a[a.length-1].$el:void 0,allowAccelerate:e.allowAccelerate,isNested:s,topmostAnimation:s?a[0]:void 0});i.animations.push(r)}}))},removeAnimation:function(t){this.animations=s.a.without(this.animations,t),t&&t.destroy()},start:function(){s.a.each(this.animations,(function(t){t.start()}))},stop:function(){s.a.each(this.animations,(function(t){t.stop()}))},resetStarted:function(){s.a.each(this.animations,(function(t){t.started=!1}))},onScroll:function(t){t=t||{},(this.page.mag.currentPage===this.page||t.forceApply)&&s.a.each(this.animations,(function(e){e.onScroll&&e.onScroll(t)}))},onResize:function(t){s.a.each(this.animations,(function(e){e.onResize(t)}))},updateTimelines:function(){s.a.each(this.animations,(function(t){t.createAnimationTimeline()}))},hasScaleUp:function(){return Boolean(s.a.find(this.animations,(function(t){return l.a.isScaleUp(t.animation)})))},destroy:function(){s.a.each(this.animations,(function(t){t.destroy()})),delete this.animations}}),y={},w=a.a.View.extend({className:"animation-container",initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),s.a.each(this.widgets,s.a.bind((function(t){t.animationObj=this,t.animationObjects=[].concat(f(t.animationObjects||[]),[this])}),this)),this.isFixed=this.widgets[0].fixed_position,this.isFullwidth=this.widgets[0].is_full_width,this.isFullheight=this.widgets[0].is_full_height,this.isSticked=this.widgets[0].sticked,this.isAbove=this.widgets[0].is_above,this.playOnce=!this.page.mag.isPreview&&this.playOnce,this.$container=this.$container||(this.isFixed||this.isAbove?this.widgets[0].$fixedContainer:this.page.$content),this.$el.appendTo(this.$wrapper?this.$wrapper:this.$container),this.createAnimationTimeline(t),this.onResize({updateAll:!0})},createAnimationTimeline:function(t){t=t||{},this.timeline&&this.timeline.destroy(),this.animation=l.a.getNormalizedAnimation(this.rawAnimation,this.isFixed,this.isFullwidth,this.isFullheight,this.page.scale),this.timeline=l.a.createAnimationTimeline({el:this.$el,steps:this.animation.steps,type:this.animation.type,force3d:!1,animationTrigger:this.animation.trigger,selfTriggered:Boolean(s.a.intersection(l.a.normalizeAnimationTriggers(this.animation.trigger),this.widgets.map((function(t){return t._id}))).length),screenshotMode:!!RM.screenshot})},start:function(){this.timeline&&this.paused&&(this.paused=!1,this.timeline.resume())},stop:function(){this.timeline&&this.timeline.active&&(this.isAbove||(this.paused=!0,this.timeline.pause()))},getAnimationContainer:function(){return this.$el},modifyWidgetPosition:function(t){return this.isFixed?(t.dimensions.left="50%",t.dimensions.top="50%",t.dimensions.right="",t.dimensions.bottom="",t.dimensions["margin-left"]=-t.dimensions.width/2,t.dimensions["margin-top"]=-t.dimensions.height/2):(t.dimensions.left-=this.bbox_css.left+(this.isNested?this.topmostAnimation.bbox_css.left:0),t.dimensions.top-=this.bbox_css.top+(this.isNested?this.topmostAnimation.bbox_css.top:0)),t},onResize:function(t){if((t=t||{}).updateAll||this.isFixed&&this.prevPageScale!==this.page.scale||this.isFullwidth||this.isFullheight||this.isSticked){var e,i={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY,z:0};this.isFixed||this.isFullwidth||this.isFullheight||this.isSticked?this.bbox_css=g(g({},this.widgets[0].calcBoxStyle({calcBBox:!0}).dimensions),this.isNested?{left:0,top:0,"margin-left":0,"margin-top":0}:{}):(s.a.each(this.widgets,(function(t){e=t.calcBoxStyle({calcBBox:!0}).dimensions,i.t=Math.min(i.t,e.top),i.l=Math.min(i.l,e.left),i.b=Math.max(i.b,e.top+e.height),i.r=Math.max(i.r,e.left+e.width),i.z=Math.max(i.z,e["z-index"])}),this),this.bbox_css={left:this.isNested?0:i.l,top:this.isNested?0:i.t,width:i.r-i.l,height:i.b-i.t,"z-index":i.z}),this.$el.css(this.bbox_css)}this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.prevPageScale=this.page.scale},withTriggerOrElement:function(t){var e,i=this;return(e=regeneratorRuntime.mark((function e(){var n,o,a,s,r,l,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],o=!0,a=!1,e.prev=3,r=b(i.animation.trigger.filter((function(t){return t})));case 5:return e.next=7,r.next();case 7:return l=e.sent,o=l.done,e.next=11,l.value;case 11:if(c=e.sent,o){e.next=27;break}return d=c,e.prev=14,e.t0=n,e.next=18,i.page.mag.getWidgetById(d,i.page);case 18:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),e.next=24;break;case 22:e.prev=22,e.t2=e.catch(14);case 24:o=!0,e.next=5;break;case 27:e.next=33;break;case 29:e.prev=29,e.t3=e.catch(3),a=!0,s=e.t3;case 33:if(e.prev=33,e.prev=34,o||null==r.return){e.next=38;break}return e.next=38,r.return();case 38:if(e.prev=38,!a){e.next=41;break}throw s;case 41:return e.finish(38);case 42:return e.finish(33);case 43:n.forEach((function(e){e.rendered?t(e.$el):i.listenToOnce(e,"rendered",(function(){return t(e.$el)}))})),n.length||t(i.$el);case 45:case"end":return e.stop()}}),e,null,[[3,29,33,43],[14,22],[34,,38,42]])})),function(){var t=this,i=arguments;return new Promise((function(n,o){var a=e.apply(t,i);function s(t){u(a,n,o,s,r,"next",t)}function r(t){u(a,n,o,s,r,"throw",t)}s(void 0)}))})()},destroy:function(){this.stop(),this.timeline&&this.timeline.destroy(),this.remove()}});y.scroll=w.extend({onScroll:function(t){if(t=t||{},this.timeline&&(this.page.mag.currentPage===this.page&&!this.isAbove||t.forceApply)){var e=this.isAbove?t.scroll:Math.max(0,this.page.visibleWidgetsCoords.scrollTop||0);if(this.isFixed)this.timeline.seek(e);else{var i=this.animation.steps[0].start_point||"bottom",n=this.bbox_css.top+(this.isNested?this.topmostAnimation.bbox_css.top:0)+this.innerContentTop,o=n-this.innerContainerHeight,a={top:1,center:.5,bottom:0}[i]*(n-o)+o+this.animation.steps[0].start_offset||0;a<=0?this.timeline.seek(e/this.page.scale):this.timeline.seek(Math.max(0,e-a*this.page.scale)/this.page.scale)}}},onResize:function(){w.prototype.onResize.apply(this,arguments),this.onScroll()}}),y.load=w.extend({visibleHeightPortion:.2,initialize:function(){w.prototype.initialize.apply(this,arguments);var t=this.animation.steps;this.startWhenInView=t&&t.length&&t[0].startWhenInView,this.checkBounds.__throttled=s.a.throttle(this.checkBounds,100)},start:function(){w.prototype.start.apply(this,arguments),this.isReady().then(function(){this.timeline.play(),this.started=!0}.bind(this)).catch((function(t){t&&console.log(t&&t.stack)}))},checkBounds:function(){this.scrolledToBounds||window.requestAnimationFrame(function(){this.isInBounds()&&(this.scrolledToBounds=!0,this.trigger("scrolledToBounds"))}.bind(this))},onScroll:function(){this.checkBounds.__throttled()},isReady:function(){var t,e=this;if(RM.screenshot||this.started||r.default.PageVisibilityManager.isPageHidden())t=window.Promise.reject();else{var i=this.widgets[0],n=[],o=window.Promise.all(this.widgets.map((function(t){return t.loaded?window.Promise.resolve():new window.Promise((function(i){return e.listenToOnce(t,"loaded",i)}))})));if(this.isAbove){var a=this.page.mag.aboveAnimationsReady?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page.mag,"aboveAnimationsReady",t)}.bind(this)),s=i.rendered?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(i,"rendered",t)}.bind(this)),l=i.wasHidden?new window.Promise(function(t){this.listenToOnce(i,"shown",t)}.bind(this)):window.Promise.resolve();n=this.startWhenInView?[s,l,o]:[a,s,l,o]}else{var c=this.page.started?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"started",t)}.bind(this)),h=this.page.loadAnimationsReady?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"loadAnimationsReady",t)}.bind(this)),u=this.page.isCurrent()?window.Promise.resolve():new window.Promise(function(t){this.listenToOnce(this.page,"changedTo",t)}.bind(this)),p=this.startWhenInView?o.then((function(){if(window.IntersectionObserver){var t=e.widgets.map((function(t){return t.$el[0]})),i=d.a.getBoundingBoxOfElements(t,e.getBBScaleFactor());return new window.Promise((function(n){var o=new window.IntersectionObserver((function(e){return e.forEach((function(e){e.isIntersecting&&(t.forEach((function(t){return o.unobserve(t)})),n())}))}),{rootMargin:"-".concat(i.height*e.visibleHeightPortion,"px 0px")});t.forEach((function(t){return o.observe(t)}))}))}return e.isInBounds()?window.Promise.resolve():new window.Promise((function(t){e.listenToOnce(e,"scrolledToBounds",t)}))})):window.Promise.resolve();n=this.startWhenInView?[c,u,p]:[h,c]}t=window.Promise.all(n)}return t},getBBScaleFactor:function(){return c.a.isOn(this.page.scale)&&c.a.isZoom()?this.page.scale:1},isInBounds:function(){var t=d.a.getBoundingBoxOfElements(this.widgets.map((function(t){return t.$el[0]})),this.getBBScaleFactor()),e=Object(n.a)(window).height(),i=this.visibleHeightPortion*t.height;return t.height&&t.bottom>=i&&t.bottom<=e||t.height&&t.top<=e-i&&t.top>0}}),y.click=w.extend({initialize:function(){w.prototype.initialize.apply(this,arguments);var t=function(t){t.on("click",this.onClick),t.css("cursor","pointer")}.bind(this);this.willStopOnEnd=!1,this.lastTimeClick=0,this.withTriggerOrElement(t)},onClick:function(){var t=this;this.timeline&&(+new Date-this.lastTimeClick<300||(this.lastTimeClick=+new Date,this.timeline.active?(this.willStopOnEnd?this.timeline.off("full-cycle-end",this.onCycleEnd):this.timeline.on("full-cycle-end",this.onCycleEnd),this.willStopOnEnd=!this.willStopOnEnd):(this.willStopOnEnd=!1,this.timeline.reversed?this.timeline.reverse():this.timeline.play(),this.setHasPlayed(),s.a.each(this.widgets,(function(e){"video"===e.type&&e.player&&(t.timeline.reversed?e.player.pause():e.player.play())})))))},onCycleEnd:function(){this.willStopOnEnd=!1,this.timeline.off("full-cycle-end",this.onCycleEnd),this.timeline.loop?this.timeline.isFullLoop?this.timeline.stop():this.timeline.reverse():(this.timeline.reversed?this.timeline.reverse():this.timeline.play(),this.setHasPlayed())},setHasPlayed:function(){var t=l.a.getPermanentAnimationId(this.widgets[0],this.animation.UUID);this.animation.playOnce&&!l.a.hasPlayed(t)&&l.a.persistHasPlayed(t)},destroy:function(){var t=function(t){t.css("cursor","")};this.withTriggerOrElement(t),w.prototype.destroy.apply(this,arguments)}}),y.hover=w.extend({initialize:function(){if(w.prototype.initialize.apply(this,arguments),h.a.isDesktop){var t=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave)}.bind(this);s.a.each(this.widgets,s.a.bind((function(t){-1!==["text","shape","picture","button"].indexOf(t.type)&&(t.hasHoverAnimation=!0)}),this)),this.withTriggerOrElement(t)}},onMouseEnter:function(){this.timeline&&(this.timeline.active?!this.timeline.loop&&this.timeline.reversed?this.timeline.on("full-cycle-end",this.onCycleEnd):this.timeline.off("full-cycle-end",this.onCycleEnd):!this.timeline.reversed&&this.timeline.play())},onMouseLeave:function(){this.timeline&&(this.timeline.active?!this.timeline.loop&&this.timeline.reversed?this.timeline.off("full-cycle-end",this.onCycleEnd):this.timeline.on("full-cycle-end",this.onCycleEnd):!this.timeline.loop&&this.timeline.reversed&&this.timeline.reverse())},onCycleEnd:function(){this.timeline.off("full-cycle-end",this.onCycleEnd),this.timeline.loop?this.timeline.isFullLoop?this.timeline.stop():this.timeline.reverse():this.timeline.reversed?this.timeline.reverse():this.timeline.play()}}),e.a=_},HxOx:function(module,exports){module.exports={"template-constructor-control-text_link":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Link" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="panel-caption">Link</div>\n\n\t\t<div class="picture-preview-error">\n\t\t\t<div class="message-text">Oops, you can’t add a link to this image since Lightbox is enabled</div>\n    </div>\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper default-state">\n\n\t\t\t\t<div class="edit-item" data-field="_caption">\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="state-switcher-wrapper">\n\t\t\t\t\t<div class="caption-default state-switcher">Link</div>\n\t\t\t\t\t<div class="caption-hover state-switcher">Hover</div>\n\t\t\t\t\t<div class="caption-current state-switcher">Current</div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="params-wrapper clearfix">\n\t\t\t\t\t<div class="params-block params-default">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="color"  data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="u-color"  data-field-dop="u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\t\t\t\t\t<div class="params-block params-hover">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="hover-color"  data-field-dop="hover-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="hover-u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="hover-u-color"  data-field-dop="hover-u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="hover-u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="hover-u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="params-block params-current">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="current-color"  data-field-dop="current-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item underline-style-click-area separator" data-field="current-u-style">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<div class="underline-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area separator" data-field="current-u-color"  data-field-dop="current-u-opacity">\n\t\t\t\t\t\t\t<div class="caption">Underline Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="current-u-size">\n\t\t\t\t\t\t\t<div class="caption">Underline Width</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="current-u-offset">\n\t\t\t\t\t\t\t<div class="caption">Padding</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\t\t\t<div class="transform-wrapper">\n\n\t\t\t\t<div class="search-wrapper">\n\t\t\t\t\t<input type="text" spellcheck="false"  required="required" value=""/>\n\t\t\t\t\t<div class="placeholder" data-initial="URL, page no., email" data-url="URL" data-page="Page Number (e.g. 8)" data-email="Email" data-phone="e.g. +71234567890" data-anchor="point a place" data-back="Scroll to Top" data-goback="Go Back" data-mailchimp="Mailchimp Popup" data-multiple="Multiple" data-no-page="Page doesn\'t exist"></div>\n\t\t\t\t\t<div class="action-icon hidden"></div>\n\t\t\t\t\t<div class="target-icon"></div>\n\t\t\t\t\t<div class="placeholder-selector hidden">\n\t\t\t\t\t\t<div class="placeholder-popup">\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="url">Website URL</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="page">Jump to Page</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="email">Email</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="phone">Phone Number</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="anchor">Anchor</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="back">Scroll to Top</div>\n\t\t\t\t\t\t\t<div class="placeholder-item" data-type="goback">Go back</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="placeholder-arrow"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t\t\t<div class="styles-wrapper"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="target-wrapper">\n\t\t\t\t\t<div class="caption">Open in new tab</div>\n\t\t\t\t\t<div class="toggle">\n\t\t\t\t\t\t<input type="checkbox">\n\t\t\t\t\t\t<div class="bg"></div>\n\t\t\t\t\t\t<div class="handle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\n\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Create New Link Style"></div>\n\t\t\t<div class="save">Save</div>\n\t\t\t<div class="cancel" title="Cancel Changes"></div>\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="underline_style_container">\n\t\t\t<div class="underline-style-popup">\n\t\t\t\t<div class="underline-style-item" data-type="none">None</div>\n\t\t\t\t<div class="underline-style-item" data-type="solid"></div>\n\t\t\t\t<div class="underline-style-item" data-type="dotted"></div>\n\t\t\t\t<div class="underline-style-item" data-type="dashed"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="style-menu transition-enable">\n\t\t\t<div class="edit-button">Edit Style</div>\n\t\t\t<div class="separator s-1"></div>\n\t\t\t<div class="duplicate-button">Duplicate</div>\n\t\t\t<div class="separator s-2"></div>\n\t\t\t<div class="delete-button">Delete</div>\n\n\t        <div class="corner-wrapper">\n\t            <div class="corner"></div>\n\t        </div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-text_link-style":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="link-style" data-id="'+(null==(__t=_name)?"":_.escape(__t))+'">\n\t\t<div class="style-caption '+(null==(__t=_name)?"":_.escape(__t))+'">'+(null==(__t=_caption)?"":_.escape(__t))+'</div>\n\t\t<div class="menu-button"></div>\n\t</div>\n';return __p}}},ICos:function(t,e,i){"use strict";i.d(e,"a",(function(){return l})),i.d(e,"i",(function(){return c})),i.d(e,"e",(function(){return d})),i.d(e,"g",(function(){return h})),i.d(e,"d",(function(){return u})),i.d(e,"f",(function(){return p})),i.d(e,"c",(function(){return g})),i.d(e,"b",(function(){return m})),i.d(e,"h",(function(){return f}));var n=i("uxXc"),o=i.n(n),a=i("xeF9");function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var l=function(t){var e=Number(t).toString(16);return e.length<2?"0".concat(e):e},c=function(t){var e=l(t.r),i=l(t.g),n=l(t.b),o=l(parseInt((100*t.a).toFixed(0)));return"".concat(e).concat(i).concat(n).concat(o)},d=function(t){var e=t;"#"===t[0]&&(e=e.slice(1));var i=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),o=parseInt(e.substring(4,6),16),a=parseInt(e.substring(6,8),16)/100;return{r:i,g:n,b:o,a:void 0===a||a>1?1:a<0?0:a}},h=function(t){var e=l(parseInt((100*t.a).toFixed(0))),i=o.a.hsv.hex([t.h,t.s,t.v]);return"".concat(i).concat(e)},u=function(t){var e=t;"#"===t[0]&&(e=e.slice(1));var i=parseInt(e.substring(6,8),16)/100,n=t.substring(0,6),a=s(o.a.hex.hsv(n),3);return{h:a[0],s:a[1],v:a[2],a:void 0===i||i>1?1:i<0?0:i}},p=function(t){return o.a.hsv.hex([t.h,t.s,t.v])},g=function(t){var e=t;return"#"===t[0]&&(e=e.slice(1)),e.substring(0,6)},m=function(t){var e=t;return"#"===t[0]&&(e=e.slice(1)),"".concat(e,"64")},f=function(t){var e=Object(a.parseCSSColor)(t);if(e){var i=s(e,4);return{r:i[0],g:i[1],b:i[2],a:i[3]||1}}return{r:0,g:0,b:0,a:1}}},Ib1Q:function(t,e,i){"use strict";var n=i("rwzP");i.n(n).a},IrH7:function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return c})),i.d(e,"c",(function(){return d})),i.d(e,"d",(function(){return h}));var n,o=i("sn3M"),a=i("9Juw");function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.AlignLeft="align-left",t.AlignCenter="align-center",t.AlignRight="align-right",t.AlignJustify="align-justify",t.AlignFullJustify="align-full-justify"}(n||(n={}));var c=r(r(r(r(r({},Object(o.a)({className:n.AlignLeft,label:"Left",styles:"text-align: left !important;"})),Object(o.a)({className:n.AlignCenter,label:"Center",styles:"text-align: center !important;"})),Object(o.a)({className:n.AlignRight,label:"Right",styles:"text-align: right !important;"})),Object(o.a)({className:n.AlignJustify,label:"Justify",styles:"text-align: justify !important;"})),Object(o.a)({className:n.AlignFullJustify,label:"Full Justify",styles:'\n      text-align: justify !important;\n      -moz-text-align-last: justify !important;\n      text-align-last: justify !important;\n\n      &:after {\n        content: "";\n        width: 100%;\n        display: inline-block;\n      }\n    '})),d=function(t){var e=t.editorState,i=t.block,n=Object(a.h)({editorState:e,block:i,key:"align"});return"string"==typeof n?n:""},h=function(t){var e=t.block,i=t.editorState,n=t.align;return Object(a.u)({editorState:i,block:e,key:"align",value:n})}},IzrY:function(t,e,i){},JW7n:function(t,e,i){"use strict";var n=i("q1tI"),o=i.n(n),a=i("i8i4"),s=i.n(a),r=i("LDvm"),l=i("8Tds"),c=[{name:l.e.H1,label:"H1",tag:"h1",cssProperties:{color:"22222264",fontFamily:"Roboto",fontStyle:"normal",textAlign:"left",fontSize:48,fontWeight:700,letterSpacing:0,lineHeight:60,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0}},{name:l.e.H2,label:"H2",tag:"h2",cssProperties:{color:"22222264",fontFamily:"Georgia",fontStyle:"normal",textAlign:"left",fontSize:24,fontWeight:400,letterSpacing:0,lineHeight:30,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0}},{name:l.e.Text,label:"Text",tag:"p",cssProperties:{color:"22222264",fontFamily:"Georgia",fontStyle:"normal",textAlign:"left",fontSize:18,fontWeight:400,letterSpacing:0,lineHeight:23,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0}},{name:l.e.Caption,label:"Caption",tag:"p",cssProperties:{color:"22222232",fontFamily:"Georgia",fontStyle:"italic",textAlign:"left",fontSize:14,lineHeight:18,letterSpacing:0,fontWeight:400,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0}}],d=i("Wwwp"),h=i("uU7u"),u=i("vOnD"),p=i("Jzj8"),g=i("L2iM"),m=i("a68n"),f=i("8RDp"),v=i("Kf/z");function b(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||y(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||y(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){if(t){if("string"==typeof t)return w(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function k(){var t=function(t,e){e||(e=t.slice(0));return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["\n  ","\n  ","\n  ","\n"]);return k=function(){return t},t}function S(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function x(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){S(a,n,o,s,r,"next",t)}function r(t){S(a,n,o,s,r,"throw",t)}s(void 0)}))}}i.d(e,"b",(function(){return O})),i.d(e,"a",(function(){return j})),i.d(e,"c",(function(){return $}));var C=function(){var t=x(regeneratorRuntime.mark((function t(){var e,i,n,o,a,s,l,d,u,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.RM.constructorRouter.mag.get("_id"),i=window.RM.constructorRouter.me&&window.RM.constructorRouter.me.get("_id"),e&&i){t.next=4;break}throw new Error("Cannot load text styles");case 4:return t.next=6,Object(r.j)({projectId:e});case 6:return n=t.sent,o=n.data,t.next=10,Object(r.o)({userId:i});case 10:return a=t.sent,s=a.data,t.next=14,Object(r.h)({projectId:e});case 14:return l=t.sent,d=l.data,t.next=18,Object(r.l)({userId:i});case 18:return u=t.sent,p=u.data,t.abrupt("return",{textStyles:{global:s&&s.length?s:[],project:o&&o.length?o:c},linkStyles:{global:p&&p.length?p:[],project:d&&d.length?d:[h.b]}});case 21:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),O=function(){var t=x(regeneratorRuntime.mark((function t(){var e,i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C();case 2:return e=t.sent,i=e.textStyles,n=e.linkStyles,window.RM.textStyles=i,window.RM.linkStyles=n,t.abrupt("return",{textStyles:i,linkStyles:n});case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=Object(u.c)(k(),(function(t){return t.blockStyles}),(function(t){return t.textStyles}),(function(t){return t.textLinkStylesSheet})),j=function(t){var e=t.mode,i=_(Object(p.c)(),2),a=i[0],s=i[1],l=_(Object(p.b)(),2),u=l[0],v=l[1];Object(n.useEffect)((function(){if("constructor"===e){var t=[],i=window.ServerData.textStyles,n=c;if(!i||!i.project||!i.project.length){var o=window.ServerData.editParams&&window.ServerData.editParams.paragraph_styles;o&&(n=Object(d.b)(o),t.push(Object(r.J)({styles:n,projectId:window.ServerData.projectId})))}i&&s({global:i.global&&i.global.length?i.global:[],project:i.project&&i.project.length?i.project:n});var a=window.ServerData.linkStyles,l=[h.b];if(!a||!a.project||!a.project.length){var u=window.ServerData.editParams&&window.ServerData.editParams.link_styles;u&&(l=Object(d.a)(u),t.push(Object(r.H)({styles:l,projectId:window.ServerData.projectId})))}a&&v({global:a.global&&a.global.length?a.global:[],project:a.project&&a.project.length?a.project:l}),t.length&&Promise.all(t)}if("viewer"===e){var p=window.ServerData&&window.ServerData.mags&&window.ServerData.mags.mag&&window.ServerData.mags.mag.textStyles;p&&s({global:p.global&&p.global.length?p.global:[],project:p.project&&p.project.length?p.project:c});var g=window.ServerData&&window.ServerData.mags&&window.ServerData.mags.mag&&window.ServerData.mags.mag.linkStyles;p&&v({global:g.global&&g.global.length?g.global:[],project:g.project&&g.project.length?g.project:[h.b]})}}),[]);var y=Object(n.useMemo)((function(){return Object.keys(g.a).map((function(t){return g.a[t].style})).join(" ")}),[g.a]),w=Object(n.useMemo)((function(){var t=function(t){return" .".concat(t.name," { ").concat(Object(m.a)(t.cssProperties)," } ")},e=a.global.map(t),i=a.project.map(t);return[].concat(b(e),b(i)).join(" ")}),[a]),k=Object(n.useMemo)((function(){var t=function(t){return" .".concat(t.name," {\n      // Стиль подчеркивания\n      ").concat(Object(m.a)(Object(f.b)(t.style.link)),"\n      ").concat(Object(m.a)({color:t.style.link.textColor}),"\n      & * {\n        ").concat(Object(m.a)({color:t.style.link.textColor}),"\n      }\n\n      // Стиль подчеркивания при наведении\n      &:hover {\n        ").concat(Object(m.a)(Object(f.b)(t.style.hover)),"\n        & * {\n          ").concat(Object(m.a)({color:t.style.hover.textColor},!0),"\n        }\n      }\n\n      ").concat(t.style.current?"\n          // Стиль подчеркивания для Current ссылки\n          &.current {\n            ".concat(Object(m.a)(Object(f.b)(t.style.current)),"\n            & * {\n              ").concat(Object(m.a)({color:t.style.current.textColor}),"\n            }\n          }"):"","\n     } ")},e=u.global.map(t),i=u.project.map(t);return[].concat(b(e),b(i)).join(" ")}),[u]);return y||w||k?o.a.createElement(P,{blockStyles:y,textStyles:w,textLinkStylesSheet:k}):null},$=function(t){Object(v.a)("constructor.textv3")&&s.a.render(o.a.createElement(j,{mode:t}),document.createElement("div"))}},Jzj8:function(t,e,i){"use strict";i.d(e,"a",(function(){return c})),i.d(e,"d",(function(){return d})),i.d(e,"c",(function(){return h})),i.d(e,"b",(function(){return u}));var n=i("v83y"),o=i("i0ke"),a=i("jcqt");function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var l={},c=function(t,e){if(l[t])return l[t];var i=s(Object(a.a)(n.EditorState.createWithContent(e,o.a)),1)[0];return l[t]=i,l[t]},d=function(t){return l[t]},h=s(Object(a.a)({global:[],project:[]}),1)[0],u=s(Object(a.a)({global:[],project:[]}),1)[0]},"Kf/z":function(t,e,i){"use strict";function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return s}));var a=window.ServerData.featureFlags?function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},window.ServerData.featureFlags):{},s=function(t){return a[t]||!1}},"Kx3/":function(module,exports){module.exports={"template-constructor-control-common_layer":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon"data-alt="Arrange" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\t\t<div class="backward-all" title="Send to Back"></div>\n\t\t<div class="backward" title="Send Backward"></div>\n\t\t<div class="forward" title="Bring Forward"></div>\n\t\t<div class="forward-all" title="Send to Front"></div>\n\t</div>\n';return __p}}},L2iM:function(t,e,i){"use strict";var n=i("q1tI"),o=i.n(n),a=i("Mpt7"),s=i("IrH7"),r=i("HjzJ"),l=i("w5C2"),c=i("a68n"),d=i("vOnD"),h=i("8AXF"),u=i("Jzj8"),p=i("9Juw"),g=i("iC7s"),m=i("ePHO"),f=i("DwEc"),v=i("w+s/"),b=i("38uW"),_=i("4hiF"),y=i("vvfI");function w(){return(w=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function k(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function S(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?k(Object(i),!0).forEach((function(e){x(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):k(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function x(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function C(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||P(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||P(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){if(t){if("string"==typeof t)return j(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function $(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var T=Object(d.e)(g.m).withConfig({displayName:"TextConstructorWrapper___StyledBox"})(["padding:0 !important;&:after{content:'';pointer-events:none;box-shadow:1px 0 0 0 ",",0 1px 0 0 ",",1px 1px 0 0 ",",1px 0 0 0 "," inset,0 1px 0 0 "," inset;position:absolute;top:0;left:0;width:calc(100% - 1px);height:100%;}"],(function(t){return t._css}),(function(t){return t._css2}),(function(t){return t._css3}),(function(t){return t._css4}),(function(t){return t._css5})),I=function(t){var e=t.children,i=$(t,["children"]),a=Object(n.useContext)(h.BackboneContext).model,s=Object(n.useContext)(f.a).model.isEditMode,r=O(Object(n.useMemo)((function(){return Object(u.d)(a._id)}),[a._id])(),2),l=r[0],d=r[1],g=O(Object(u.c)(),1)[0],k=Object(n.useMemo)((function(){if(!i["data-offset-key"])return{};var t=i["data-offset-key"].split("-")[0];return{blockKey:t,block:l.getCurrentContent().getBlockForKey(t)}}),[i,l]),x=k.blockKey,P=k.block,j=Object(n.useMemo)((function(){return Object(c.b)({block:P})}),[P]),I=Object(n.useMemo)((function(){return Boolean(x&&Object(p.q)(l,x))}),[l,x]),E=I?"var(--editor-border-color)":"transparent",M=Object(n.useMemo)((function(){return[].concat(C(g.global),C(g.project)).find((function(t){return t.name===j}))}),[j,g,l]),R=Object(n.useMemo)((function(){var t=Object(v.a)({block:P});return S(S({left:0,right:0,top:0,bottom:0},M?Object(c.e)(M):{}),t)}),[l,P,M,g]),A=Object(n.useMemo)((function(){return Object(b.a)({block:P})}),[P]),D=Object(n.useMemo)((function(){return Object(_.b)({block:P})}),[P]),z=Object(n.useMemo)((function(){return Object(y.a)({block:P})}),[P]),L=s&&I;return o.a.createElement(T,w({},i,{position:"relative",style:{lineHeight:"".concat(A,"px"),fontSize:"number"==typeof D?"".concat(D,"px"):void 0,textIndent:"number"==typeof z?"".concat(z,"px"):void 0},_css:E,_css2:E,_css3:E,_css4:E,_css5:E}),o.a.createElement(m.b,{key:x,isVisible:L,top:R.top,left:R.left,bottom:R.bottom,right:R.right,onChange:function(t){P&&d(Object(v.c)({editorState:l,paddings:t}))}},e))},E=i("v83y"),M=i("i0ke");function R(){return(R=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function A(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var D=Object(d.e)(g.m).withConfig({displayName:"TextViewerWrapper___StyledBox"})(["",""],(function(t){return t._css})),z=function(t){var e=t.children,i=t.element,a=A(t,["children","element"]),s=Object(n.useContext)(h.BackboneContext).model,r=Object(n.useMemo)((function(){var t={left:0,right:0,top:0,bottom:0};if(!a["data-offset-key"])return{paddings:t};var e=a["data-offset-key"].split("-")[0],i=Object(E.convertFromRaw)(Object(p.o)(s)),n=E.EditorState.createWithContent(i,M.a).getCurrentContent().getBlockForKey(e),o=Object(v.a)({block:n}),r=Object(b.a)({block:n}),l=Object(_.b)({block:n}),d=Object(y.a)({block:n});return{paddings:o&&!Object(c.f)(o)?o:t,lineHeight:r,fontSize:l,textIndent:d}}),[]),l=r.paddings,d=r.lineHeight,u=r.fontSize,g=r.textIndent,m="li"===i,f=m?"div":i,w=o.a.createElement(D,R({as:f,pt:l.top,pb:l.bottom,pl:l.left,pr:l.right},m?{}:a,{_css:Object(c.a)({lineHeight:d,fontSize:u,textIndent:g})}),e);return"li"===i?o.a.createElement("li",a,w):w};function L(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function B(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?L(Object(i),!0).forEach((function(e){F(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function F(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return N})),i.d(e,"b",(function(){return U}));var N=B(B(B({},s.b),r.d),l.c),U=function(){var t=window.RM.constructorRouter&&!window.RM.constructorRouter.preview,e=B(B(B({},Object(c.d)()),l.d),r.e);return a.a.Map(Object.keys(e).reduce((function(i,n){var a=e[n].element,s=t?I:"string"==typeof a?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=function(e){return o.a.createElement(z,R({},e,{element:t}))};return e}(a):a,l=Object(r.c)(n)?o.a.createElement(r.b,{type:n}):void 0;return B(B({},i),{},F({},n,B(B({},e[n]),{},{element:s,wrapper:l})))}),{}))}},L3tv:function(module,exports){module.exports={"template-constructor-control-common_position":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Position" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="param-caption solid-separator">\n\t\t\t<span>Fix position</span>\n\t\t\t<a href="https://help.readymag.com/hc/en-us/articles/360020527132-Fixed-and-positioned-widgets" target="_blank" class="question-icon">\n\t\t\t\t<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<g fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<circle cx="12" cy="12" r="12"/>\n\t\t\t\t\t\t<path d="M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"/>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="param-caption">Browser window</div>\n\n\t\t<ul class="dotted-separator">\n\t\t\t<li class="nw"></li>\n\t\t\t<li class="n"></li>\n\t\t\t<li class="ne"></li>\n\t\t\t<li class="w"></li>\n\t\t\t<li class="c"></li>\n\t\t\t<li class="e"></li>\n\t\t\t<li class="sw"></li>\n\t\t\t<li class="s"></li>\n\t\t\t<li class="se"></li>\n\t\t</ul>\n\n\t\t<div class="position-wrapper solid-separator">\n\t\t\t<div class="param-caption">Page</div>\n\t\t\t<div class="togglers-wrapper">\n\t\t\t\t<div class="sticked-top" data-side="top"></div>\n\t\t\t\t<div class="sticked-left" data-side="left"></div>\n\t\t\t\t<div class="full-width"></div>\n\t\t\t\t<div class="full-height"></div>\n\n\t\t\t\t<div class="sticked-right" data-side="right"></div>\n\t\t\t\t<div class="sticked-bottom" data-side="bottom"></div>\n\t\t\t</div>\n\n\t\t\t<div class="margin-wrapper">\n\t\t\t\t<input class="full-height margin-input" type="text" spellcheck="false" value="" data-min="0" data-max="256" data-mouseDir="v" data-mouseSpeed="8" data-shiftStep="15"/>\n\t\t\t\t<input class="full-width margin-input" type="text" spellcheck="false" value="" data-min="0" data-max="256" data-mouseDir="v" data-mouseSpeed="8" data-shiftStep="15"/>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="global-options">\n\t\t\t<div class="option global dotted-separator">\n\t\t\t\t<div class="option-title">\n\t\t\t\t\t<div class="title-wrapper">\n\t\t\t\t\t\t<span class="title-caption">On all pages</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="switcher global rmswitcher"></div>\n\t\t\t</div>\n\t\t\t<div class="option above">\n\t\t\t\t<div class="option-title">\n\t\t\t\t\t<div class="title-wrapper">\n\t\t\t\t\t\t<span class="title-caption">Above pages</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="switcher above rmswitcher"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n';return __p}}},LDvm:function(t,e,i){"use strict";var n=i("0NDv");function o(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var a=function(t){return n.a.get("/api/swatches/project/".concat(t))},s=function(t){var e=t.projectNumId,i=o(t,["projectNumId"]);return n.a.put("/api/swatches/project/".concat(e),i)},r=function(t){var e=t.projectNumId,i=o(t,["projectNumId"]);return n.a.put("/api/swatches/project/".concat(e,"/move"),i)},l=function(t){return n.a.get("/api/swatches/global/".concat(t))},c=function(t){var e=t.userId,i=o(t,["userId"]);return n.a.put("/api/swatches/global/".concat(e),i)},d=function(t){var e=t.userId,i=o(t,["userId"]);return n.a.put("/api/swatches/global/".concat(e,"/move"),i)};function h(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var u=function(t){return n.a.get("/api/mag/".concat(t,"/trash"))},p=function(t,e){return n.a.patch("/api/mag/".concat(t,"/pages/trash"),{pids:e})},g=function(t,e){return n.a.delete("/api/mag/".concat(t,"/pages/trash"),{pids:e})},m=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,i){var o,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.get("/api/screenshot/renew/".concat(e,"/").concat(i));case 2:return o=t.sent,a=o.screenshot,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){h(a,n,o,s,r,"next",t)}function r(t){h(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(t,i){return e.apply(this,arguments)}}(),f=function(t){return n.a.post("/api/font-features",t)},v=function(t){var e=new FormData;return e.append("upload",t),fetch("/api/upload/font",{method:"post",body:e}).then((function(t){return t.json()}))},b=function(t){return n.a.post("/api/custom-font",t)},_=function(t){var e=t._id,i=t.hidden;return n.a.put("/api/custom-font/".concat(e),{hidden:i})},y=function(t){return n.a.get("/api/custom-font/".concat(t))},w=function(t,e){return n.a.put("/api/custom-font/".concat(t),e)};function k(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var S=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,i){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new FormData).append("name",e),n.append("upload",i),t.next=5,fetch("/api/upload",{headers:{"cache-control":"no-cache"},method:"post",body:n}).then((function(t){return t.json()}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){k(a,n,o,s,r,"next",t)}function r(t){k(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(t,i){return e.apply(this,arguments)}}(),x=function(t){var e=t.userId;return n.a.get("/api/text-styles/global/".concat(e))},C=function(t){var e=t.projectId;return n.a.get("/api/text-styles/project/".concat(e))},O=function(t){var e=t.userId,i=t.styles;return n.a.put("/api/text-styles/global/".concat(e),{styles:i})},P=function(t){var e=t.projectId,i=t.styles;return n.a.put("/api/text-styles/project/".concat(e),{styles:i})},j=function(t){var e=t.userId;return n.a.get("/api/link-styles/global/".concat(e))},$=function(t){var e=t.projectId;return n.a.get("/api/link-styles/project/".concat(e))},T=function(t){var e=t.userId,i=t.styles;return n.a.put("/api/link-styles/global/".concat(e),{styles:i})},I=function(t){var e=t.projectId,i=t.styles;return n.a.put("/api/link-styles/project/".concat(e),{styles:i})},E=function(){return n.a.get("/api/user_templates/")},M=function(t){return n.a.delete("/api/template/",{id:t})},R=function(t,e){return n.a.put("/api/template/",{id:t,name:e})};function A(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var D=function(){var t,e=(t=regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.a.post("/api/publish/".concat(e));case 2:if(!(i=t.sent).statusCode){t.next=7;break}throw i;case 7:return t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){A(a,n,o,s,r,"next",t)}function r(t){A(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(t){return e.apply(this,arguments)}}(),z=function(t){return n.a.post("/api/mag/".concat(t,"/revert-version"))},L=function(t){return n.a.post("/api/unpublish/".concat(t))},B=function(t,e,i){return n.a.patch("/api/mag/".concat(t,"?skipChanged=").concat(i),e)},F=function(t,e,i){var o={is_private:e.toString()};return i&&(o.pass=i),n.a.post("/api/mag/privacy/".concat(t),o)},N=function(t){return n.a.get("/api/mag/fbcache/".concat(t))},U=function(t,e){return n.a.post("/api/mag/opts/".concat(t),e)},H=function(t,e){return n.a.post("/api/checkdomain",{num_id:t,domain:e})},V=function(t,e){return n.a.post("/api/mag/domain/".concat(t),{domain:e,status:"on"})},W=function(t){return n.a.post("/api/mag/domain/".concat(t),{status:"off"})},G=i("tZHv");function q(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var K=function(){var t,e=(t=regeneratorRuntime.mark((function t(e,i){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new FormData).append("widgetId",i),n.append("upload",e.slice(0,Math.min(e.size,G.a.SHOTS_UPLOAD_SIZE_LIMT))),t.next=5,fetch("/api/shots/upload/video",{method:"post",body:n}).then((function(t){return t.json()}));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){q(a,n,o,s,r,"next",t)}function r(t){q(a,n,o,s,r,"throw",t)}s(void 0)}))});return function(t,i){return e.apply(this,arguments)}}(),X=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.a.get("/api/user/".concat(t,"/links"),e)},Y=function(t){return n.a.post("/api/featured/submit",{url:t})};i.d(e,"i",(function(){return a})),i.d(e,"I",(function(){return s})),i.d(e,"s",(function(){return r})),i.d(e,"f",(function(){return l})),i.d(e,"G",(function(){return c})),i.d(e,"r",(function(){return d})),i.d(e,"k",(function(){return u})),i.d(e,"y",(function(){return p})),i.d(e,"c",(function(){return g})),i.d(e,"g",(function(){return m})),i.d(e,"p",(function(){return f})),i.d(e,"N",(function(){return v})),i.d(e,"b",(function(){return b})),i.d(e,"B",(function(){return _})),i.d(e,"e",(function(){return y})),i.d(e,"E",(function(){return w})),i.d(e,"M",(function(){return S})),i.d(e,"o",(function(){return x})),i.d(e,"j",(function(){return C})),i.d(e,"L",(function(){return O})),i.d(e,"J",(function(){return P})),i.d(e,"l",(function(){return j})),i.d(e,"h",(function(){return $})),i.d(e,"K",(function(){return T})),i.d(e,"H",(function(){return I})),i.d(e,"n",(function(){return E})),i.d(e,"d",(function(){return M})),i.d(e,"x",(function(){return R})),i.d(e,"t",(function(){return D})),i.d(e,"u",(function(){return z})),i.d(e,"D",(function(){return L})),i.d(e,"v",(function(){return B})),i.d(e,"A",(function(){return F})),i.d(e,"F",(function(){return N})),i.d(e,"w",(function(){return U})),i.d(e,"a",(function(){return H})),i.d(e,"q",(function(){return V})),i.d(e,"C",(function(){return W})),i.d(e,"O",(function(){return K})),i.d(e,"m",(function(){return X})),i.d(e,"z",(function(){return Y}))},LEh1:function(t,e,i){},LSan:function(t,e,i){"use strict";var n=i("9Tqx");i.n(n).a},LaNJ:function(module,exports){module.exports={"template-picture-preview-box":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n  <div>\n    <div class="picture-preview-box">\n      <div class="picture-preview-box-overlay" style="background-color: '+(null==(__t=overlayColor)?"":__t)+';"></div>\n      <img class="picture-preview-box-image" srcset="'+(null==(__t=previewSrc)?"":__t)+'" style="'+(null==(__t=Object.keys(originalStyle).map((function(t){return t+":"+originalStyle[t]})).join("; "))?"":__t)+'" />\n    </div>\n  </div>\n';return __p}}},LazK:function(t,e,i){"use strict";var n=i("3uGt");i.d(e,"a",(function(){return n.c}))},M9xF:function(module,exports){module.exports={"template-constructor-block-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <input class="text"\n           value="'+(null==(__t=data.text)?"":_.escape(__t))+'"\n           type="text"\n           autocapitalize="off"\n           autocorrect="off"\n           autocomplete="off"\n           spellcheck="false"/>\n\n';return __p}}},MAfP:function(module,exports){module.exports={"template-block-frame":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="frameborder">\n\t\t<div class="dot lt" data-ind="0"></div>\n\t\t<div class="dot t" data-ind="1"></div>\n\t\t<div class="dot rt" data-ind="2"></div>\n\t\t<div class="dot r" data-ind="3"></div>\n\t\t<div class="dot rb" data-ind="4"></div>\n\t\t<div class="dot b" data-ind="5"></div>\n\t\t<div class="dot lb" data-ind="6"></div>\n\t\t<div class="dot l" data-ind="7"></div>\n\t\t<div class="triangle lt" data-ind="0">\n\t\t\t<svg width="19px" height="16.23px" xmlns\t="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle t" data-ind="1">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle rt" data-ind="2">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle r" data-ind="3">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle rb" data-ind="4">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle b" data-ind="5">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle lb" data-ind="6">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t\t<div class="triangle l" data-ind="7">\n\t\t\t<svg width="19px" height="16.23px" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="m 10.472022,15.361 c -0.5555223,0.949963 -1.3861334,0.954046 -1.9440437,0 L 0.56229989,1.7394072 C 0.00677768,0.78944449 0.48120359,0 1.5877001,0 H 17.4123 c 1.103146,0 1.58331,0.78536087 1.0254,1.7394072 z" id="Triangle" fill="#0080FF"></path>\n\t\t\t</svg>\n\t\t</div>\n\t</div>\n';return __p}}},MgHC:function(module,exports){module.exports={"template-common-login":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="login-popup hidden">\n\n\t\t<div class="login-popup-wrapper">\n\t\t\t<div class="login ljr-panel hidden">\n        <div class="header"><a href="/join/" class="link">Join</a> or <span>Log in</span></div>\n\t\t\t\t<form method="post" action="/api/redirect" id="login_form">\n\t\t\t\t\t<input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n\t\t\t\t\t<input name="password" autocapitalize="off" autocorrect="off" required="required" class="password-input input-template" autocomplete="on"  type="password" spellcheck="false" value=""  placeholder="Password" />\n\t\t\t\t\t<input name="url" type="hidden" value="" />\n\t\t\t\t\t<div class="go">Log in</div>\n\t\t\t\t</form>\n        <div class="social-caption">Log in with</div>\n        <div class="social-auth" data-provider=\'facebook\'>\n          <span class="icon"></span>\n          <span class="buttonText">Facebook</span>\n        </div>\n        <div class="social-auth" data-provider=\'google\'>\n          <span class="icon"></span>\n          <span class="buttonText">Google</span>\n        </div>\n\t\t\t\t<a href="/recover/" class="link forgot">Forgot password?</a>\n\t\t\t\t<div class="error">Invalid email or password</div>\n\t\t\t</div>\n\n\n      <div class="join ljr-panel hidden">\n        <div class="header"><span>Join</span> or <a href="/login/" class="link">Log in</a></div>\n        <input autocapitalize="on"  autocorrect="off" required="required" class="fullname-input input-template for-validate"  maxlength="24" type="text"     spellcheck="false" value="" placeholder="Name" />\n        <input autocapitalize="off" autocorrect="off" required="required" class="email-input input-template for-validate"     type="email"    spellcheck="false" value="" placeholder="Email" />\n        <input autocapitalize="off" autocorrect="off" required="required" class="password-input input-template for-validate"  type="password" spellcheck="false" value="" placeholder="Password" />\n\n        <div class="checkbox-container">\n          <label>\n            <input type="checkbox" class="terms-checkbox for-validate" required="required">\n            <span class="checkmark"></span>\n          </label>\n          <p>I accept Readymag’s\n            <a href="https://readymag.com/readymag/terms-and-privacy/" target="_blank">Terms and Privacy Policy</a>\n          </p>\n        </div>\n\n\n        <div class="checkbox-container">\n          <label>\n            <input type="checkbox" class="subscribe-checkbox">\n            <span class="checkmark"></span>\n          </label>\n          <p>Кeep me updated on news and offers</p>\n        </div>\n\n\n        <div class="go">Join</div>\n\n        <div class="social-caption">Sign up with</div>\n        <div class="social-auth" data-provider=\'facebook\'>\n          <span class="icon"></span>\n          <span class="buttonText">Facebook</span>\n        </div>\n        <div class="social-auth" data-provider=\'google\'>\n          <span class="icon"></span>\n          <span class="buttonText">Google</span>\n        </div>\n      <div class="error"></div>\n\n      </div>\n\n        <div class="recover ljr-panel hidden">\n            <div class="header"><span>Reset Password</span></div>\n            <div class="wrapper">\n                <div class="info">Please enter your email address and we\'ll send you instructions:</div>\n                <input name="username" autocapitalize="off" autocorrect="off" required="required" class="email-input input-template"  autocomplete="on" type="email" spellcheck="false" value="" placeholder="Email"/>\n                <div class="go">Submit</div>\n            </div>\n            <div class="send-message">Done! You should receive an email shortly.</div>\n            <div class="go-back">Go Back</div>\n        </div>\n\n        <div class="reset ljr-panel hidden">\n            <div class="header"><span>Reset Password</span></div>\n            <input autocapitalize="off" autocorrect="off" required="required" class="new-password-input input-template"  type="password" spellcheck="false" value="" placeholder="New Password" />\n            <input autocapitalize="off" autocorrect="off" required="required" class="verify-password-input input-template"  type="password" spellcheck="false" value="" placeholder="Verify Password" />\n            <div class="go">Save</div>\n            <div class="error"></div>\n        </div>\n\n            <div class="forbidden ljr-panel hidden">\n                <div class="header"><span>Login forbidden</span></div>\n                <div class="wrapper">\n                    <div class="info">It seems Readymag is displayed as an embedded page on the third party web site. Login is disabled due to security reasons.<br/><br/>Please <a href="https://readymag.com/login" target="_blank">login or join</a> on the original Readymag page.</div>\n                </div>\n            </div>\n\n\n            <div class="close-popup"></div>\n      <a href="/" class="link go-main"></a>\n\t\t</div>\n\t</div>\n\n';return __p},"template-common-login-preloader":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rmpreloader button">\n        <div class="arc"></div>\n    </div>\n';return __p}}},MseB:function(module,exports){module.exports={"template-constructor-helpers-typekit-popup":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="typekit-popup">\n\t\t<div class="full-house">Full House</div>\n\t\t<div class="error-message">Sadly, but you cannot store more than 5 of Typekit’s fonts in your font selector. Please remove one and try again.</div>\n\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n\n';return __p}}},"MyX/":function(t,e,i){"use strict";var n=i("5IDT");i.n(n).a},NEuE:function(module,exports){module.exports={"template-constructor-control-picture_crop":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon preloader" data-alt="Crop" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="scale">\n\t\t\t<div class="handler">\n\t\t\t\t<div class="helper"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="equilateral button"></div>\n\t\t<div class="fill button">Fill</div>\n\t\t<div class="fit button">Fit</div>\n\t</div>\n';return __p}}},NbUU:function(t,e,i){"use strict";i.d(e,"d",(function(){return p})),i.d(e,"f",(function(){return g})),i.d(e,"e",(function(){return m})),i.d(e,"c",(function(){return _})),i.d(e,"b",(function(){return y})),i.d(e,"a",(function(){return w})),i.d(e,"g",(function(){return k}));var n=i("v83y"),o=i("zMlX"),a=i("LDvm"),s=i("9Juw"),r=i("A9VP"),l=i("w5C2");function c(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function h(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function u(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){h(a,n,o,s,r,"next",t)}function r(t){h(a,n,o,s,r,"throw",t)}s(void 0)}))}}var p=function(t){var e=[o.a.RequiredLigatures,o.a.StandardLigatures,o.a.HistoricalLigatures,o.a.DiscretionaryLigatures];return t.filter((function(t){return e.includes(t)}))},g=function(t){var e=/^ss[\d]{2}$/i,i=Object.values(o.a).filter((function(t){return e.test(t)}));return t.filter((function(t){return i.includes(t)}))},m=function(t){var e=[o.a.LiningFigures,o.a.OldstyleFigures,o.a.ProportionalFigures,o.a.TabularFigures];return t.filter((function(t){return e.includes(t)}))},f=/url\((?:"|')(.*?)(?:"|')\)/;function v(t){return b.apply(this,arguments)}function b(){return(b=u(regeneratorRuntime.mark((function t(e){var i,n,o,a,s,r,l,c,d,h,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i={},t.t0=regeneratorRuntime.keys(document.styleSheets);case 2:if((t.t1=t.t0()).done){t.next=20;break}n=t.t1.value,o=document.styleSheets[n],a=null,t.prev=6,a=o.rules||o.cssRules,t.next=17;break;case 10:if(t.prev=10,t.t2=t.catch(6),!o.href){t.next=17;break}return t.next=15,fetch(o.href).then((function(t){return t.text()}));case 15:(s=t.sent)&&((r=new CSSStyleSheet).replaceSync(s),r&&(r.rules||r.cssRules)&&(a=r.rules||r.cssRules));case 17:if(a)for(l in a)(c=a[l])instanceof CSSFontFaceRule&&(d=c.style.src,(h=d.match(f))&&h[1]&&(u=c.style.fontFamily.replace(/['"]+/g,""),i[u]=h[1]));t.next=2;break;case 20:if(!e){t.next=22;break}return t.abrupt("return",i[e]||null);case 22:return t.abrupt("return",i);case 23:case"end":return t.stop()}}),t,null,[[6,10]])})))).apply(this,arguments)}var _=function(t,e){var i=t;return"string"==typeof i&&/^\d+$/.test(i)&&(i=Number(i)),"string"==typeof i?"v":"".concat(e[0].toLowerCase()).concat(Math.floor(i/100))},y=function(t){var e=t&&c(t),i="v"===e[0];return{style:e[0]&&"i"===e[0]?"italic":"normal",weight:i?"initial":e[1]?100*parseInt(e[1]):400}},w=function(){var t=u(regeneratorRuntime.mark((function t(e){var i,n,s,r,l,c,d,h,u,p,g,m,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.fontFamily,n=e.fontWeight,s=e.fontStyle,r={features:[],variations:[],characters:[]},l=window.RM.constructorRouter.fonts.findFontByCSSName(i),c=_(n,s),l&&l.variations&&l.variations.includes(c)){t.next=6;break}return t.abrupt("return",r);case 6:if(d={weight:c},!l||"custom"!==l.provider||!l.is_personal){t.next=11;break}d.id=l._id,t.next=15;break;case 11:return t.next=13,v(i);case 13:(h=t.sent)&&(d.url=h);case 15:if(l&&"system"===l.provider&&(d.systemFontName=l.name),!!d.weight||!!d.systemFontName||d.url&&d.id){t.next=19;break}return t.abrupt("return",r);case 19:return t.prev=19,t.next=22,Object(a.p)(d);case 22:return u=t.sent,p=u.data,(g=p&&p.features)&&g.length&&(m=Object.values(o.a),f=m.filter((function(t){return g.some((function(e){return e.toLowerCase()===t.toLowerCase()}))})),r.features=f||[]),r.variations=p&&p.variations,r.characters=p&&p.characters,t.abrupt("return",r);case 31:throw t.prev=31,t.t0=t.catch(19),new Error(t.t0||"Can't detect font features");case 34:case"end":return t.stop()}}),t,null,[[19,31]])})));return function(e){return t.apply(this,arguments)}}(),k=function(t){var e={},i=!1,o=function(t){var e=t.fontFamily,i=t.fontStyle,n=t.fontWeight,o=[];if(e){var a=Object(r.e)(e,r.b.FontFamily);if(o.push(a),a){o.push(i?Object(r.e)(i,r.b.FontStyle):l.b.fontStyle);var s=n?Object(r.e)(String(n),r.b.FontWeight):l.b.fontWeight;o.push("initial"===String(s)?"variable":s)}}return o.length?o.join("|"):null};t&&t&&t.blocks&&Object(n.convertFromRaw)(Object(s.o)(t)).getBlockMap().forEach((function(t){if(t){var n=t.getCharacterList(),a=new Set([]);n.forEach((function(t){if(t){var e=t.getStyle().toJS(),n="";if(e&&e.length){var s=e.find((function(t){return t.startsWith(r.b.FontFamily)})),l=e.find((function(t){return t.startsWith(r.b.FontStyle)})),c=e.find((function(t){return t.startsWith(r.b.FontWeight)}));n=o({fontFamily:s,fontStyle:l,fontWeight:c})}n?a.add(n):i=!0}}));var s=t.getType();if(s){var l=window.RM.textStyles||{project:[],global:[]},d=[].concat(c(l.project),c(l.global)).find((function(t){return!!t.name&&t.name.toLowerCase()===s.toLowerCase()}));if(d){var h=d.cssProperties||{},u=h.fontFamily,p=h.fontWeight,g=h.fontStyle,m=o({fontFamily:u,fontStyle:g,fontWeight:p});m&&a.add(m)}}a.forEach((function(t){e[t]=1}))}}));if(i){var a=[l.b.fontFamily,l.b.fontStyle,l.b.fontWeight].join("|");e[a]=1}return e}},Nnyp:function(module,exports){module.exports={"template-common-alert":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var categories={"type-duplicate":"category-upgrade","type-create":"category-upgrade","type-export-pdf":"category-upgrade","type-export-code":"category-upgrade","type-more-pages":"category-upgrade","type-upload-fonts":"category-upgrade","type-custom-seo":"category-upgrade","type-custom-sharing":"category-upgrade","type-code-injection":"category-upgrade","type-widget-shots":"category-upgrade","type-publish-noemail":"category-confirm-email","type-publish-limit":"category-upgrade","type-publish-ecommerce":"category-upgrade","type-switch-desktop-create":"category-mobile","type-switch-desktop-continue":"category-mobile","type-browsers":"category-browsers","type-browsers-viewer":"category-browsers","type-shared-failed":"category-shared-failed","type-shared-unlock-page":"category-shared-unlock-page"},headers={"category-upgrade":"","category-upgrade-skip":"Push the Limits","category-browsers":"Browser Support","category-shared-failed":"Sorry, something<br/>went wrong.","category-confirm-email":"Account Activation"},texts={"type-duplicate":'To duplicate this project you need to upgrade your account. You can find out more about our subscription plans <a href="/pricing" class="learn-more">here</a>.',"type-create":'To create more projects you need to upgrade your account. You can find out more about our subscription plans <a href="/pricing" class="learn-more">here</a>.',"type-publish-noemail":"Please verify your email address<br />to publish this project.","type-publish-limit":"Please upgrade your account<br />to publish more than one project.","type-publish-ecommerce":"Please upgrade your account<br />to publish project with ecommerce.","type-export-pdf":'Please upgrade your account<br/>to export the project to PDF.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-export-code":'Please upgrade your account<br/>in order to export the source<br/>code of your projects.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-more-pages":'Please upgrade your account<br/>to create more pages.<br><a href="/pricing" class="learn-more">See the pricing</a>.',"type-custom-seo":'Please upgrade your account<br/> to customize SEO parameters.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-custom-sharing":'Please upgrade your account<br/>to customize social sharing info.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-code-injection":'Please upgrade your account to<br/>make custom code work after<br/>you publish the project.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-widget-shots":'Please upgrade your account to<br/>make Shots widget work after<br/>you publish the project.<br/><a href="/pricing" class="learn-more">See the pricing</a>.',"type-browsers":"Sorry, our Editor doesn’t support Internet Explorer. This may change in the future, but for now please use Chrome, Firefox or Safari.","type-browsers-viewer":'This site can\'t be displayed in Internet Explorer. Please switch to <a href="https://support.apple.com/en-jo/HT204416">Safari</a>, <a href="https://www.google.com/chrome/">Google Chrome</a>, <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>, or <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Microsoft Edge</a>.',"type-switch-desktop-create":"To create a project, please use your laptop or desktop computer.","type-switch-desktop-continue":"To continue, please use your laptop or desktop computer.","type-shared-failed":'Please contact <a href="mailto:support@readymag.com" class="learn-more">support</a>.',"type-upload-fonts":'Please upgrade your account<br/>to upload your own fonts.<br/><a href="/pricing" class="learn-more">See the pricing</a>.'},buttons={"category-upgrade":'<a href="/settings#change-plan" class="button main upgrade">Upgrade</a><div class="cancel-wrapper">or '+(["type-code-injection","type-widget-shots"].includes(opts.type)?'<span class="button cancel" data-type="skip">Skip</span>':'<span class="button cancel">Cancel</span>')+"</div>","category-browsers":'<div class="button main ok">Okay</div>',"category-mobile":'<div class="button main ok">Okay</div>',"category-shared-failed":'<div class="button close">Close</div>',"category-shared-unlock-page":'<div class="button ok">Ok</div>',"category-confirm-email":'<div  class="button main resend">Resend</div><div class="cancel-wrapper">or <span class="button cancel">Cancel</span></div>'},category=categories[opts.type],header=headers[category],text=texts[opts.type]||opts.text,button=buttons[category];opts.is_contributor&&(text="Please upgrade owner’s account<br/>to be able to use this feature.",button='<a href="mailto:'+opts.owner_email+'" class="contact-link">Contact owner</a><div class="cancel-wrapper">'+(["type-code-injection","type-widget-shots"].includes(opts.type)?'or <span class="button cancel" data-type="skip">Skip</span>':'<span class="button cancel">Cancel</span>')+"</div>"),__p+='\n\n\t<div class="alert-popup '+(null==(__t=category)?"":__t)+'">\n\t\t<div class="panel-wrapper">\n\t\t\t<div class="center-table">\n\t\t\t\t<div class="center-cell">\n\t\t\t\t\t<div class="panel">\n\n\t\t\t\t\t\t'+(null==(__t=header?'<div class="header">'+header+"</div>":"")?"":__t)+'\n\n\t\t\t\t\t\t<div class="icon" '+(null==(__t=opts.icon?'style="background-image:url('+opts.icon+')"':"")?"":__t)+'><div class="icon-inner"></div></div>\n\n\t\t\t\t\t\t'+(null==(__t=text?'<div class="text">'+text+"</div>":"")?"":__t)+"\n\n\t\t\t\t\t\t"+(null==(__t="type-browsers-viewer"==opts.type?'<div class="icon additional"></div>':"")?"":__t)+"\n\n\t\t\t\t\t\t"+(null==(__t=button?'<div class="buttons">'+button+"</div>":"")?"":__t)+"\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n"}return __p}}},P6JF:function(module,exports){module.exports={"template-constructor-control-text_align":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Align" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="left" title="Left Align"></div>\n\t\t<div class="center" title="Center"></div>\n\t\t<div class="right" title="Right Align"></div>\n\t\t<div class="justify" title="Justify"></div>\n\t</div>\n';return __p}}},PhV8:function(t,e,i){"use strict";function n(t){return new n.fn.init(t)}var o={},a={};Array.prototype.slice;function s(t,e,i){if(!i.contentWindow.postMessage)return!1;var n=JSON.stringify({method:t,value:e});i.contentWindow.postMessage(n,"*")}function r(t){var e,i;try{i=(e=JSON.parse(t.data)).event||e.method}catch(t){}if(!/^https?:\/\/player.vimeo.com/.test(t.origin))return!1;var n=e.value,s=e.data,r=""===r?null:e.player_id,l=function(t,e){return e?o[e]&&o[e][t]:o[t]}(i,r),c=[];return"ready"!==i||a[r]||(a[r]=!0),!!l&&(void 0!==n&&c.push(n),s&&c.push(s),r&&c.push(r),c.length>0?l.apply(null,c):l.call())}function l(t,e,i){i?(o[i]||(o[i]={}),o[i][t]=e):o[t]=e}function c(t){return!!(t&&t.constructor&&t.call&&t.apply)}n.fn=n.prototype={element:null,init:function(t){return"string"==typeof t&&(t=document.getElementById(t)),this.element=t,this.element?this:null},api:function(t,e){if(!this.element||!t)return!1;var i=this.element,n=""!==i.id?i.id:null,o=c(e)?null:e,a=c(e)?e:null;return a&&l(t,a,n),s(t,o,i),this},addEvent:function(t,e){if(!this.element)return!1;var i=this.element,n=""!==i.id?i.id:null;return l(t,e,n),"ready"!=t?s("addEventListener",t,i):"ready"==t&&a[n]&&e.call(null,n),this},removeEvent:function(t){if(!this.element)return!1;var e=this.element,i=function(t,e){if(e&&o[e]){if(!o[e][t])return!1;o[e][t]=null}else{if(!o[t])return!1;o[t]=null}return!0}(t,""!==e.id?e.id:null);"ready"!=t&&i&&s("removeEventListener",t,e)}},n.fn.init.prototype=n.fn,window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r),e.a=n},QNie:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i("q1tI"),o=i.n(n),a=i("q1z7"),s=i.n(a),r=i("xi34"),l=i("i8i4"),c=i.n(l),d=i("5BZr"),h=i("8AXF"),u=o.a.createContext({}),p=d.a.extend({name:null,component:null,alt:null,saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.a.prototype.initialize.apply(this,arguments),this.block=this.blocks[0],this.model=t.models&&t.models.length&&t.models[0],this.workspace=t.master&&t.master.workspace||{},this.page=this.workspace.page,this.project=this.workspace.mag,this.user=this.project.user,this.y=t.y||t.fromY,this.propsModel=new s.a.Model({faded:this.faded||!1,selected:this.selected||!1,disabled:this.disabled||!1,visible:this.visible||!1,y:this.y,alt:this.alt,select:this.setSelected,appearanceAnimation:this.appearanceAnimation,page:this.page,project:this.project,user:this.user,injectedRefs:{},workspace:this.workspace,controlsManager:this.workspace.controls}),this.propsModel.on("change",this.onPropsModelChanged)},render:function(){var t=this,e=document.querySelector('[data-control-type="'.concat(this.name,'"]'));e&&(c.a.unmountComponentAtNode(e)&&e.remove());if(this.$container.append('<div data-control-type="'.concat(this.name,'">')),this.domElement=document.querySelector('[data-control-type="'.concat(this.name,'"]')),this.domElement){Object(h.renderReact)({component:function(){return o.a.createElement(h.CreateContextProvider,{context:u,model:t.propsModel},o.a.createElement(t.component,{useSharedState:t.block.useSharedState}))},domElement:this.domElement,model:this.model}),setTimeout((function(){t.show(),t.$el=Object(r.a)(t.domElement).find(":first")})),this.setControlsStatusByBlockData(),this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this.bindLogic(),document.addEventListener("keyup",this.onWindowKeyUp)}},updatePropsModel:function(t){this.propsModel&&this.propsModel.set(t)},destroy:function(t){t?this.hide():this.destroyReact(),this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.unBindLogic(),this.stopListening(this.model,"change"),document.removeEventListener("keyup",this.onWindowKeyUp),this.destroyed=!0},destroyReact:function(){var t=this.$el.parent();t&&t[0]&&(c.a.unmountComponentAtNode(t[0])&&t.remove())},hide:function(){this.updatePropsModel({visible:!1})},show:function(){this.updatePropsModel({visible:!0})},moveToNewPos:function(t){this.y=t,this.domElement&&this.updatePropsModel({y:t})},bindShortcuts:function(){this.shortcutHandler=this.master.select.bind(this.master,this),this.keyboardShortcut&&window.RM.constructorRouter.bindGlobalKeyPress([{key:this.keyboardShortcut,handler:this.shortcutHandler}]),this.onWindowKeyUpBound=this.onWindowKeyUp.bind(this),Object(r.a)(window).on("keyup",this.onWindowKeyUpBound)},unbindShortcuts:function(){this.keyboardShortcut&&window.RM.constructorRouter.unbindGlobalKeyPress(this.keyboardShortcut,this.shortcutHandler),Object(r.a)(window).off("keyup",this.onWindowKeyUpBound)},select:function(){this.makeModelSnapshot(),this.updatePropsModel({selected:!0,faded:!1})},setSelected:function(){this.isOnClickDisabled()||(this.selected||this.disabled?this.master.deselect():this.master.select(this))},deselect:function(){var t=!!this.selected;this.updatePropsModel({selected:!1,faded:!1}),this.clearModelSnapshot(t)},fade:function(){this.deselect(),this.updatePropsModel({faded:!0})},setEnabled:function(){this.updatePropsModel({disabled:!1})},setDisabled:function(){this.updatePropsModel({selected:!1,disabled:!0})},save:function(){this.model.save({})},canControlBeClosed:function(){if(this.propsModel&&this.propsModel.get("preventClose"))return!0;if(this.selected){var t=this.propsModel.get("injectedRefs");return t.canControlBeClosed&&t.canControlBeClosed()||this.master.deselect(),!0}return!1},onEscKey:function(){this.selected&&this.master.deselect()},onPropsModelChanged:function(){this.selected=this.propsModel.get("selected"),this.disabled=this.propsModel.get("disabled"),this.faded=this.propsModel.get("faded"),this.visible=this.propsModel.get("visible")}});e.b=p},"QP/g":function(module,exports){module.exports={"template-constructor-control-cart_add_product_widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Add product widget" data-alt-pos="left" data-alt-offset="9">\n\t\t<img class="add-icon svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/constructor/controls/cart_connections/add_product_widget.svg" />\n\t</div>\n';return __p}}},QRzc:function(module,exports){module.exports={"template-viewer-mag-menu":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<noindex>\n\t\t<div class="mag-menu '+(null==(__t=hasProjectInfo?"":"no-project-info")?"":__t)+'" data-nosnippet>\n\t\t\t<div class="menu-wrapper">\n\n\t\t\t\t',hasProjectInfo&&(__p+='\n\t\t\t\t\t<div class="menu-info">\n\n\t\t\t\t\t\t<a class="link '+(null==(__t=common.isDownloadedSource?"inactive-link":"")?"":__t)+'" href="'+(null==(__t=mag.model.user.getLink())?"":_.escape(__t))+'">\n\t\t\t\t\t\t\t<div class="userpic" style="background-image:url(\''+(null==(__t=mag.model.user.getUserpic(64))?"":__t)+'\')"></div>\n\t\t\t\t\t\t\t<div class="username">'+(null==(__t=mag.user.name)?"":_.escape(__t))+'</div>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<div class="published-by" data_caption="published by" data_date="'+(null==(__t=publishDate)?"":__t)+'"></div>\n\t\t\t\t\t\t<div class="mag-title">'+(null==(__t=mag.title)?"":_.escape(__t))+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t"),__p+='\n\n\t\t\t\t<div class="scroll-wrapper">\n\n\t\t\t\t\t<div class="pages-wrapper has-'+(null==(__t=viewerType)?"":__t)+'-scroll">\n\t\t\t\t\t\t<div class="pages">\n\n\t\t\t\t\t\t\t',_.each(pages,(function(t,e){var i="horizontal"==viewerType?"left":"top",n=e*("horizontal"==viewerType?width:height);__p+='\n\t\t\t\t\t\t\t\t<div class="page" data-id="'+(null==(__t=t._id)?"":__t)+'" data-num="'+(null==(__t=t.num)?"":__t)+'" data-src="'+(null==(__t=mag.model.getPageScreenshot(width,{_id:t._id}))?"":__t)+'" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+"px;"+(null==(__t=i)?"":__t)+":"+(null==(__t=n)?"":__t)+'px">\n\t\t\t\t\t\t\t\t\t<img class="screenshot" src="'+(null==(__t=stub)?"":__t)+'" />\n\t\t\t\t\t\t\t\t\t<div class="num '+(null==(__t=t.pageNestedNum&&t.pageNestedNum.length>3?t.pageNestedNum.length>4?"nested-over-4":"nested-over-3":t.num>99?"over99":"")?"":__t)+'">'+(null==(__t=t.pageNestedNum?t.pageNestedNum:t.num)?"":__t)+"</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t"})),__p+='\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</noindex>\n';return __p}}},R31J:function(module,exports){module.exports={"template-pack":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="pack" id="pack_'+(null==(__t=id)?"":__t)+'">\n\t\t<div class="content"></div>\n\t\t'+(null==(__t=templates["template-block-frame"]())?"":__t)+"\n\t</div>\n";return __p}}},RLXn:function(t,e,i){"use strict";var n=i("rFsW"),o={i1:{caption:"Thin Italic",style:{fontWeight:100,fontStyle:"italic"}},i3:{caption:"Light Italic",style:{fontWeight:300,fontStyle:"italic"}},i4:{caption:"Italic",style:{fontWeight:400,fontStyle:"italic"}},i5:{caption:"Medium Italic",style:{fontWeight:500,fontStyle:"italic"}},i7:{caption:"Bold Italic",style:{fontWeight:700,fontStyle:"italic"}},i9:{caption:"Black Italic",style:{fontWeight:900,fontStyle:"italic"}},n1:{caption:"Thin",style:{fontWeight:100,fontStyle:"normal"}},n3:{caption:"Light",style:{fontWeight:300,fontStyle:"normal"}},n4:{caption:"Regular",style:{fontWeight:400,fontStyle:"normal"}},n5:{caption:"Medium",style:{fontWeight:500,fontStyle:"normal"}},n7:{caption:"Bold",style:{fontWeight:700,fontStyle:"normal"}},n9:{caption:"Black",style:{fontWeight:900,fontStyle:"normal"}}},a={model:{event:"change"},props:{fontStyle:{type:Array,default:function(){return[""]}},fontFamily:{type:Array,default:function(){return[""]}},fontWeight:{type:Array,default:function(){return[0]}}},data:function(){return{visibleBox:!1,boxStyles:{},styleVariants:{}}},computed:{exStyle:function(){return{"font-style":this.getParamForMultipleStyles(this.fontStyle),"font-weight":this.getParamForMultipleStyles(this.fontWeight)}},fromTop:function(){return n.a.keys(this.styleVariants).length>5},disabled:function(){return 0===n.a.keys(this.styleVariants).length},caption:function(){var t=this,e="";return this.keys.forEach((function(i,n){o[i]&&(e+=o[i].caption,n+1<t.keys.length&&(e+=", "))})),e},keys:function(){for(var t=[],e=0;e<this.fontStyle.length;e++){var i=("italic"===this.fontStyle[e]?"i":"n")+(""+this.fontWeight[e])[0];this.styleVariants[i]||1!==this.fontFamily.length||(i=this.styleVariants.n4?"n4":n.a.keys(this.styleVariants)[0],this.$emit("update:fontStyle","i"===i[0]?"italic":"normal"),this.$emit("update:fontWeight",100*parseInt(i[1],10))),t.push(i)}return t}},watch:{disabled:{handler:function(t){t&&this.visibleBox&&(this.visibleBox=!1)},immediate:!0},fontFamily:{handler:function(t){var e=this,i=t.map((function(t){return RM.constructorRouter.fonts.findFontByCSSName(t)})),o=[],a={i:"italic",n:"normal"};i.forEach((function(t){var i={};t.variations.forEach((function(t){i[t]={caption:e.generateName(t),style:{fontWeight:100*parseInt(t[1],10),fontStyle:a[t[0]]}}})),o.push(i)})),1===o.length?this.styleVariants=n.a.clone(o[0]):o.length>1&&function(){for(var t=n.a.clone(o[0]),i=function(e){var i=o[e];Object.keys(t).forEach((function(e){i[e]||delete t[e]}))},a=1;a<o.length;a++)i(a);e.styleVariants=t}()},immediate:!0}},methods:{generateName:function(t){var e="i"===t[0],i={1:"Thin",2:"ExtraLight",3:"Light",4:"Regular",5:"Medium",6:"SemiBold",7:"Bold",8:"ExtraBold",9:"Black"}[t[1]];return e&&"Regular"===i?"Italic":i+(e?" Italic":"")},getParamForMultipleStyles:function(t){return 1===t.length||n.a.every(t,(function(e){return e===t[0]}))?t[0]:"inherit"},selectFont:function(t){this.$emit("update:fontStyle",t.style.fontStyle),this.$emit("update:fontWeight",t.style.fontWeight)},toggleVisible:function(){this.disabled||(this.visibleBox||this.$emit("showPopup",this),this.visibleBox=!this.visibleBox)}}},s=(i("3dGj"),i("KHd+")),r=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"font-style-container"},[i("span",{staticClass:"example",class:{disabled:t.disabled},style:t.exStyle,on:{click:t.toggleVisible}},[t._v(t._s(t.caption))]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.disabled,expression:"!disabled"}],staticClass:"expand-arrow",on:{click:t.toggleVisible}}),t._v(" "),i("div",{staticClass:"box_container",class:{visible:t.visibleBox,"from-top":t.fromTop},style:t.boxStyles},t._l(t.styleVariants,(function(e,n){return i("div",{key:n,staticClass:"font-elem",class:t.keys.includes(n)?"curr":"",style:e.style,on:{click:function(i){return t.selectFont(e,n)}}},[t._v("\n      "+t._s(e.caption)+"\n      "),i("div",{staticClass:"point"})])})),0)])}),[],!1,null,null,null);e.a=r.exports},RX7I:function(t,e,i){"use strict";i("9GTV");var n=window.soundcite;delete window.soundcite,e.a=n},RedZ:function(module,exports){module.exports={"template-constructor-control-picture_preview":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Lightbox" data-alt-pos="left" data-alt-offset="9">\n    <div class="left-icon">\n      <img class="svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/constructor/controls/picture_preview/icon.svg" />\n    </div>\n    <div class="right-icon">\n      <div class="arrow"></div>\n    </div>\n  </div>\n\n\t<div class="panel">\n    <div class="panel-caption">Lightbox</div>\n\n\t\t<div class="animation-error">\n\t\t\t<div class="message-text">Oops, you can’t enable Lightbox, as this image already has an On-Click animation</div>\n    </div>\n\n    <div class="link-error">\n\t\t\t<div class="message-text">Oops, you can’t enable Lightbox to this image since link added</div>\n    </div>\n\n    <div class="fullscreen-controls">\n      <div class="icon-panel icon-overlay noarrow" data-alt-pos="left" data-alt-offset="9">\n        <div class="colorbox_container"></div>\n      </div>\n      <div class="icon-panel icon-preview-toggle noarrow" data-alt-pos="left" data-alt-offset="43">\n        <img class="svg" src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/constructor/controls/picture_preview/icon.svg" />\n      </div>\n    </div>\n\t</div>\n\n';return __p}}},Rh5U:function(module,exports){module.exports={"template-viewer-mag":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="mag">\n\t\t<div class="mag-pages-container">\n\t\t\t<div class="container disable-transitions">\n\n\t\t\t\t<div class="blackout"></div>\n\t\t\t</div>\n\t\t\t<div class="above-pages-container"></div>\n\t\t</div>\n\n\t\t',hasStandaloneBottomArrow&&(__p+='\n\t\t\t<div class="navigation-arrow bottom offscreen"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div></div>\n\t\t"),__p+="\n\n\n\t\t",isPreview&&(__p+='\n\t\t\t<div class="mag-pages-viewport-device"></div>\n\t\t'),__p+="\n\t</div>\n\n";return __p}}},Rn2B:function(module,exports){module.exports={"template-constructor-control-hotspot-pin-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Pin Settings" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="search-block">\n\n\t\t\t<input class="search" type="text" placeholder="Search">\n\n\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="common-wrapper">\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t\t<div class="rectangle-icon item">\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="circle-icon item">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t<div class="edit-item color-click-area" data-field="bg_color" data-field-dop="bg_opacity">\n\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="edit-item combined separator" data-field="borders">\n\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="edit-item separator" data-field="tip_show_on">\n\t\t\t\t\t<div class="caption">Show on</div>\n\t\t\t\t\t<div class="switcher" data-active="click">\n\t\t\t\t\t\t<div class="switcher-item" data-value="click">Click</div>\n\t\t\t\t\t\t<div class="switcher-item" data-value="hover">Hover</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="colorbox_container"></div>\n\n\t</div>\n';return __p},"template-constructor-control-hotspot-pin-settings-icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},SUqF:function(t,e,i){"use strict";var n,o,a,s=i("roQd"),r={enterPickTriggerMode:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],l=arguments.length>3?arguments[3]:void 0;a=function(n,o){if(r.canBeATrigger(n,e,i)){o.stopPropagation();var a=n.id;r.highlightActiveTriggerBlock(t,e,a,!1,!1),l(a)}},n=function(n){var o=t.findBlock(n);r.canBeATrigger(o,e,i)&&o&&o.highlight(!0,s.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS)},o=function(e){var i=t.findBlock(e);i&&i.highlight(!1,s.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS)},t.on("block:click",a),t.on("block:mouseenter",n),t.on("block:mouseleave",o)},leavePickTriggerMode:function(t){t.off("block:click",a),t.off("block:mouseenter",n),t.off("block:mouseleave",o)},canBeATrigger:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return!s.a.EXTERNAL_TRIGGER_BLOCK_EXCLUDE.includes(t.model.attributes.type)&&!i.includes(t.id)&&r.canBeExternalTrigger(t,e)},canBeExternalTrigger:function(t,e){var i=t.attributes||t.model.attributes||{},n=e.attributes||e.model.attributes||{},o=i.type&&-1===s.a.EXTERNAL_TRIGGER_BLOCK_EXCLUDE.indexOf(i.type),a=e&&n.is_above&&i.is_global&&!i.is_above;return o&&!a},highlightActiveTriggerBlock:function(t,e,i,n,o){var a=i&&t.findBlock(i),r=e.id===i&&1===t.getPackBlocks(e.model.get("pack_id")).length,l=o?s.a.ACTIVE_TRIGGER_REMOVE_CLASS:s.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS;a&&a.highlight(n,l);var c=e.triggerAssets&&e.triggerAssets[i];if(c){var d=r?e.ownTooltip&&e.ownTooltip.getElement():c.tooltip&&c.tooltip.getElement();d&&d.toggleClass(l,Boolean(n))}}};e.a=r},TAzU:function(t,e,i){},TBxE:function(t,e,i){"use strict";var n=i("xi34"),o=i("Kw5r"),a=i("rFsW"),s=i("q1z7"),r=i.n(s),l=i("tZHv"),c=i("q7tt"),d=new RegExp("^image/("+l.a.UPLOAD_IMAGE_FORMATS+")$","i"),h=new RegExp("([a-z-_0-9/:.]*.("+l.a.UPLOAD_IMAGE_FORMATS+")(\\W.*)?$)","i"),u=r.a.View.extend({DEFAULT_ERROR_MSG:"Something went wrong!",constructor:function(t){return t instanceof c.a?this.block=t:t instanceof o.default&&(this.block=t.raw_block||t.block,this.panel=t),this.initialize.apply(this,arguments),this},initialize:function(t,e){a.a.bindAll(this);var i=this.block;(e=e||{}).fileTypes&&(this.fileTypes=new RegExp("^image/("+e.fileTypes+")$","i"),this.fileTypesErrorMessage=e.fileTypesErrorMessage,delete e.fileTypes,delete e.fileTypesErrorMessage),e=a.a.defaults(e,a.a.extend({dataType:"json",singleFileUploads:!0,sequentialUploads:!0,formData:{id:i.model.id,mid:i.workspace.mag.get("num_id"),name:i.name,uploadType:"picture",unique:e.unique},dropZone:Object(n.a)(),pasteZone:null,replaceFileInput:!1},this.panel?{dropZone:Object(n.a)(this.panel.$el),fileInput:Object(n.a)(e.uploadInputRefName?this.panel.$refs[e.uploadInputRefName]:this.panel.$refs.uploadInput)}:{})),this.options=e,this.debug&&console.log(e),this.$uploader=Object(n.a)(e.fileInput).fileupload(e),this.bindHandlers(),this.uploadingData=[]},bindHandlers:function(){var t=this;this.preventDefaultOnDrop(),this.$uploader.bind("fileuploadadd",(function(e,i){if(t.debug&&console.log("add",i),t.uploadData=i,!i||!i.files||!i.files[0]||i.files[0].skipped)return!1;var n=i.files&&i.files[0].size,o=i.files&&i.files[0].type;n>l.a.UPLOAD_IMAGE_SIZE_LIMIT?(i.allowUpload=!1,alert(i.files[0].uploadError=l.a.MSG_UPLOAD_IMAGE_SIZE_ERROR)):(t.fileTypes||d).test(o)?i.allowUpload=!0:(i.allowUpload=!1,alert(i.files[0].uploadError=t.fileTypesErrorMessage||l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)),t.trigger("add",e,i),t.uploadingData.push(i),i.submit()})).bind("fileuploaddrop",(function(e,i){t.debug&&console.log("drop",i),t.trigger("drop",e);var o=(e.originalEvent.dataTransfer||e.delegatedEvent.dataTransfer).getData("text/html");if(o){var a=Object(n.a)(o).filter("img").attr("src");if(a)return h.test(a)?void t.trigger("uploadFromUrl",a):(alert(i.uploadError=l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR),i.allowUpload=!1,t.clearFileInputField(),!1)}})).bind("fileuploadsubmit",(function(e,i){if(t.debug&&console.log("submit",i),!i.allowUpload){var n=i.uploadError||i.files&&i.files[0]&&i.files[0].uploadError;return n&&(delete i.uploadError,i.files&&delete i.files[0].uploadError,t.trigger("fail",e,i,n),t.clearFileInputField()),!1}i.allowUpload=!1})).bind("fileuploadsend",(function(e,i){if(t.debug&&console.log("send",i),i.files[0].skipped)return!1;t.trigger("send",e,i)})).bind("fileuploadstart",(function(e,i){t.debug&&console.log("start",i),t.uploading=!0,t.trigger("start",e,i)})).bind("fileuploaddone",(function(e,i){t.debug&&console.log("done",i),t.uploadingData.shift(),t.uploading=!1,t.clearFileInputField(),i.files[0].skipped||t.trigger("done",e,i)})).bind("fileuploaddragover",(function(e){t.trigger("dragover",e)})).bind("fileuploaddragleave",(function(e){t.trigger("dragleave",e)})).bind("fileuploadfail",(function(e,i){t.debug&&console.log("fail",i),t.uploadingData.shift(),t.uploading=!1,t.clearFileInputField();var n=t.DEFAULT_ERROR_MSG;500==(i&&i.jqXHR&&i.jqXHR.status)&&a.a.delay((function(){alert(n=l.a.MSG_UPLOAD_IMAGE_SUPPORTED_ERROR)}),300),i.files&&!i.files[0].skipped&&"abort"!=i.errorThrown&&t.trigger("fail",e,i,n)}))},setOptions:function(t){this.options=a.a.extend(this.options,t),this.$uploader.fileupload(this.options)},setFormData:function(t,e,i){if(!t||!e||!i)return console.error("missing required parameters");this.$uploader.fileupload({formData:{id:t,name:e,uploadType:i}})},clearFileInputField:function(){this.$uploader.wrap("<form>").closest("form").get(0).reset(),this.$uploader.unwrap()},switchOff:function(){this.options.dropZone.off("drop dragover",this.prevent),this.$uploader.fileupload("disable")},switchOn:function(){this.preventDefaultOnDrop(),this.$uploader.fileupload("enable")},preventDefaultOnDrop:function(){this.options.dropZone.on("drop dragover",this.prevent)},prevent:function(t){t.preventDefault()},abort:function(){this.uploadingData[0]&&this.uploadingData[0].abort(),a.a.each(this.uploadingData,(function(t){t.files[0].skipped=!0}))},destroy:function(){this.abort(),this.switchOff(),this.off(),this.$uploader.fileupload("destroy")}});u.MimeTypeRegExp=d,u.UrlImageTypeRegExp=h,e.a=u},TGSb:function(module,exports){module.exports={"template-constructor-control-common_lock":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Lock" data-alt-pos="left" data-alt-offset="9"></div>\n';return __p}}},Tjx0:function(t,e,i){"use strict";var n=i("4nGE");i.n(n).a},Tu3F:function(module,exports){module.exports={"template-viewer-toolbar":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+='\n\n\t<div class="toolbar for-viewer">\n\n\t\t';var offscreenClass=isPreview||common.embedMode?"":"offscreen-initially";__p+="\n\n\t\t",hasPageCounter&&!pageCounterInsideMenu&&(__p+='\n\t\t\t<div class="page-counter-wrapper '+(null==(__t=offscreenClass)?"":__t)+'">\n\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t</div>\n\t\t"),__p+="\n\n\t\t",brandingInToolbar&&(__p+='\n\t\t\t<div class="toolbar-branding"></div>\n\t\t'),__p+="\n\n\t\t",hasShare&&(__p+='\n\t\t\t<div class="share-button sprite '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Share" data-alt-pos="'+(null==(__t=isNewSettingsEnabled&&!controlsOnTop?"top":"bottom")?"":__t)+'" data-alt-offset="9"  data-alt-style="toolbar-share-tooltip" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>\n\t\t"),__p+="\n\n\t\t",hasMenu&&(__p+='\n\t\t\t<div class="menu-button '+(null==(__t=offscreenClass)?"":__t)+'" data-alt="Menu (M)" data-alt-pos="'+(null==(__t=isNewSettingsEnabled&&!controlsOnTop?"top":"bottom")?"":__t)+'" data-alt-offset="9" data-alt-style="toolbar-menu-tooltip">\n\t\t\t\t',hasPageCounter&&pageCounterInsideMenu&&(__p+='\n\t\t\t\t\t<div class="page-counter"><span class="cur"></span> of <span class="total">'+(null==(__t=totalPages)?"":__t)+"</span></div>\n\t\t\t\t"),__p+="\n\n\t\t\t\t",isNewSettingsEnabled?__p+='\n\t\t\t\t\t<svg class="menu-icon" width="32" height="14" viewBox="0 0 32 14">\n\t\t\t\t\t\t<g fill="currentColor" fill-rule="evenodd"><path d="M1 0h30a1 1 0 010 2H1a1 1 0 110-2zM1 12h30a1 1 0 010 2H1a1 1 0 010-2z"/></g>\n\t\t\t\t\t</svg>\n\t\t\t\t\t<svg class="cross-icon" width="18" height="18" viewBox="0 0 18 18">\n\t\t\t\t\t\t<path d="M17.485.515a1 1 0 010 1.414L10.415 9l7.07 7.071a1 1 0 01-1.414 1.414L9 10.415l-7.071 7.07a1 1 0 01-1.414-1.414L7.585 9 .516 1.929A1 1 0 011.929.515L9 7.585l7.071-7.07a1 1 0 011.414 0z" fill="currentColor" fill-rule="evenodd"></path>\n\t\t\t\t\t</svg>\n\t\t\t\t':__p+='\n\t\t\t\t\t<div class="line-1"></div>\n\t\t\t\t\t<div class="line-2"></div>\n\t\t\t\t\t<div class="line-3"></div>\n\t\t\t\t',__p+='\n\t\t\t\t<div class="page-preloader sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>\n\t\t\t</div>\n\t\t"),__p+="\n\n\t\t",common.embedMode&&(__p+='\n\t\t\t<div class="embed-close-button '+(null==(__t=offscreenClass)?"":__t)+'">Close</div>\n\t\t'),__p+="\n\n\t</div>\n\n"}return __p}}},TxgR:function(t,e,i){},U2WL:function(t,e,i){"use strict";var n=i("/Czx");i.n(n).a},U72E:function(module,exports){module.exports={"template-constructor-workspace-inside-block":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="workspace-inside-block">\n\t\t<div class="blocks-wrapper"></div>\n\t</div>\n\n';return __p}}},UGKl:function(t,e,i){"use strict";var n=i("vOnD"),o=i("q1tI"),a=i.n(o),s=i("v83y"),r=i("iC7s"),l=i("za5s"),c=i("L2iM"),d=i("A9VP"),h=i("8Tds"),u=i("ICos"),p=i("w5C2");function g(){return(g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function m(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var f=Object(n.e)(r.C).withConfig({displayName:"TextEditor___StyledFlex"})(["--editor-border-color:",";--editor-nbsp-highlight-color:",";direction:",";overflow:",";& > div{min-height:100%;","}.public-DraftEditor-content{white-space:normal !important;}& div[data-contents='true']{font-family:",";font-weight:",";font-style:",";font-size:","px;line-height:","px;-webkit-nbsp-mode:normal;-webkit-line-break:after-white-space;"," text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;span{line-height:1px;}}"],(function(t){return t._css}),(function(t){return t._css2}),(function(t){return t._css3}),(function(t){return t._css4}),(function(t){return t._css5}),(function(t){return t._css6}),(function(t){return t._css7}),(function(t){return t._css8}),(function(t){return t._css9}),(function(t){return t._css10}),(function(t){return t._css11})),v=function(t,e){var i=t.isEditMode,n=t.textDirection,o=t.overflow,v=t.columns,b=t.verticalAlign,_=t.bgColor,y=(t.shouldShowHighlight,t.shouldShowSelectionBorder),w=(t.height,t.width,m(t,["isEditMode","textDirection","overflow","columns","verticalAlign","bgColor","shouldShowHighlight","shouldShowSelectionBorder","height","width"])),k=_?Object(u.e)(_):void 0,S=k?"rgba(".concat(k.r,", ").concat(k.g,", ").concat(k.b,", ").concat(k.a,")"):void 0;return a.a.createElement(f,{ref:e,height:o===h.b.Hidden||v&&v.count>1?"100%":"auto",flexDirection:"column",justifyContent:b&&b!==h.f.top?"flex-end":"flex-start",bg:S,_css:y?Object(l.themeGet)("colors.blue"):"transparent",_css2:i?"#1cdeb4":"transparent",_css3:n,_css4:v&&v.count>1?"hidden":o,_css5:v&&v.count>1&&"\n            column-fill: auto;\n            column-count: ".concat(v.count,";\n            column-gap: ").concat(v.gap,"px;\n          "),_css6:p.b.fontFamily,_css7:p.b.fontWeight,_css8:p.b.fontStyle,_css9:p.b.fontSize,_css10:p.b.lineHeight,_css11:v&&v.count>1?"":"white-space: pre-wrap;"},a.a.createElement(r.m,null,a.a.createElement(s.Editor,g({spellCheck:!1,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",stripPastedStyles:!0,blockRenderMap:s.DefaultDraftBlockRenderMap.merge(Object(c.b)()),customStyleFn:d.g},w))))};e.a=a.a.forwardRef(v)},UMxc:function(t,e,i){"use strict";var n=i("ENxh");i.n(n).a},UeZx:function(module,exports){module.exports={"template-constructor-block":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="block '+(null==(__t=block.hidden?"invisible":"")?"":__t)+'" data-id="'+(null==(__t=block._id)?"":__t)+'">\n\t\t<div class="content"></div>\n\t\t'+(null==(__t=templates["template-block-frame"]())?"":__t)+"\n\t</div>\n";return __p}}},UyQn:function(t,e,i){"use strict";var n=i("bXDN");i.n(n).a},VZqm:function(t,e,i){"use strict";var n=i("xi34"),o=i("rFsW"),a={model:{event:"change"},props:{value:"",variants:{type:Array,default:function(){return[]}},hideControls:{type:Boolean,default:!1}},methods:{spinType:function(t){var e=this,i=0;o.a.each(this.variants,(function(t,n){t.value===e.value&&(i=n)})),i=(i+=t)<0?i+this.variants.length:i%this.variants.length,Object(n.a)(this.$el).toggleClass("negative",t<0),this.$emit("change",this.variants[i].value)}}},s=(i("mX/r"),i("KHd+")),r=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"spinner"},[i("transition",{attrs:{name:"fade"}},[t._l(t.variants,(function(e,n){return[e.value===t.value?i("div",{key:n,staticClass:"spin-title",class:{clickable:t.hideControls},on:{click:function(e){return e.stopPropagation(),t.spinType(1)}}},[t._v("\n        "+t._s(e.title)+"\n      ")]):t._e()]}))],2),t._v(" "),t.hideControls?t._e():i("div",{staticClass:"spin left",on:{click:function(e){return e.stopPropagation(),t.spinType(-1)}}}),t._v(" "),t.hideControls?t._e():i("div",{staticClass:"spin right",on:{click:function(e){return e.stopPropagation(),t.spinType(1)}}})],1)}),[],!1,null,null,null);e.a=r.exports},Vc8N:function(module,exports){module.exports={"template-constructor-block-twitter-type_tweet":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+(null==(__t=url)?"":_.escape(__t))+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'" data-text="'+(null==(__t="undefined"!=typeof text?text:"")?"":_.escape(__t))+'">Tweet</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_follow":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/'+(null==(__t=username||"Readymag")?"":_.escape(__t))+'" class="twitter-follow-button" data-show-count="false" data-show-screen-name="'+(null==(__t=show_name?"true":"false")?"":__t)+'" data-lang="en" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Follow @'+(null==(__t=username)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_hashtag":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<a href="https://twitter.com/intent/tweet?button_hashtag='+(null==(__t=hash)?"":_.escape(__t))+'" class="twitter-hashtag-button" data-size="'+(null==(__t=large_button?"large":"medium")?"":__t)+'">Tweet #'+(null==(__t=hash)?"":_.escape(__t))+'</a>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_timeline":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-twitter-type_embed":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t"+(null==(__t=code)?"":__t)+'\n\t<div class="overlay"></div>\n';return __p}}},VsGE:function(t,e,i){t.exports=i.p+"img/constructor/controls/add_to_cart_settings/number-disabled.svg"},VxDd:function(t,e,i){t.exports=i.p+"img/constructor/controls/add_to_cart_settings/layout-horizontal.svg"},WEBt:function(module,exports){module.exports={"template-viewer-branding":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rm-branding offscreen-initially">\n\t<a class="rm-branding-button" href="https://readymag.com" target="_blank"></a>\n\t</div>\n';return __p}}},WoDZ:function(t,e,i){"use strict";var n=i("xi34"),o=i("OTSC"),a={getVideoAspectFromPoster:function(t,e){var i={abort:function(){h.onload=null,h.onerror=null}},o={aspect_poster:null,aspect_real:null};if(!t)return e(o),i;var a,s,r,l,c,d,h=new Image;return h.onload=function(){c=h.width,d=h.height,r=200,l=Math.floor(r*(d/c)),a=Object(n.a)('<canvas id="qqq" width="200" height="'+l+'"></canvas>').css("visibility","hidden").appendTo("body"),(s=a[0].getContext("2d")).drawImage(h,0,0,r,l);var t,i,u=s.getImageData(0,0,r,l),p=0,g=0,m=0,f=0;for(i=0;i<=l/2;i++){if(y(i,"row").isContrast){(i<=1||y(i-1,"row").isBlack||y(i-2,"row").isBlack)&&(p=i);break}}for(i=l-1;i>l/2;i--){if(y(i,"row").isContrast){(i>=l-2||y(i+1,"row").isBlack||y(i+2,"row").isBlack)&&(g=l-1-i);break}}var v=Math.max(p,g),b=0;if(!v){for(t=0;t<=100;t++){if(y(t,"column").isContrast){(t<=1||y(t-1,"column").isBlack||y(t-2,"column").isBlack)&&(m=t);break}}for(t=199;t>100;t--){if(y(t,"column").isContrast){(t>=198||y(t+1,"column").isBlack||y(t+2,"column").isBlack)&&(f=199-t);break}}b=Math.max(f,m)}v>l/3&&(v=0),b>r/3&&(b=0);var _=c/d;function y(t,e){var i,n,o,a,s,c="row"==e?r:l,d=0,h=0;for(i=0;i<c;i++)n=("row"==e?t*r+i:i*r+t)<<2,d+=(o=u.data[n])+(a=u.data[n+1])+(s=u.data[n+2]),o<20&&a<20&&s<20&&h++;return{isBlack:(d/=3*c)<5&&c-h<3,isContrast:h<c/2}}v?_=r/(l-2*v):b&&(_=(r-2*b)/l),a.remove(),o.aspect_poster=c/d,o.aspect_real=_,e(o)},h.onerror=function(){e(o)},h.src="/api/proxy/?url="+encodeURIComponent(t),i},setVideoPosition:function(t){if(t.aspect_poster&&t.$media&&t.$media.length){var e=t.$container.css("width"),i=t.$container.css("height");if(/px/.test(e+i))e=parseInt(e),i=parseInt(i);else{if(!t.mag)return;var n=t.mag.getContainerSizeCached();e=n.width,i=n.height}var o,a,s=t.aspect_poster,r=t.aspect_real||s,l=t.controls_remove?5:0,c=e+2*l,d=i+2*l,h=c,u=d;if(s)c/d>r?a=(o=c)/r:o=(a=d)*r,s<r?u=(h=o)/s:h=(u=a)*s;if("vimeo"==t.provider.toLowerCase()&&t.controls_remove){var p=50-(u-d)/2,g=46-(h-c)/2;if(p>0||g>0){var m=(u+2*p)/u,f=(h+2*g)/h,v=Math.max(m,f);h*=v,u*=v}}if("youtube"==t.provider.toLowerCase()&&t.controls_remove){var b=103-(u-d)/2;b>0&&(h=(u+=2*b)*s)}var _=-l-(h-c)/2,y=-l-(u-d)/2;t.$media.css({left:_,top:y,width:h,height:u})}},getHighResVideoThumbnail:function(t){if(!t.provider||!t.thumbnail_url)return Promise.resolve(t.thumbnail_url||"");function e(t,e){return t.replace(/(\/)(\w*default)(\.\w+$)/i,"$1"+e+"$3")}function i(t,e){return t.replace(/(\/)(\w+_)(\d+x\d+|\d+)(\.\w+$)/i,"$1$2"+e+"$4")}var n,o=[];switch(t.provider.toLowerCase()){case"vimeo":o.push({url:i(t.thumbnail_url,"1280"),width:1280}),o.push({url:i(t.thumbnail_url,"640"),width:640});break;case"youtube":o.push({url:e(t.thumbnail_url,"maxresdefault"),width:1280}),o.push({url:e(t.thumbnail_url,"sddefault"),width:640})}return(n=o)&&n.length?new window.Promise((function(e){var i=0;!function e(o,a,s){(function(t,e){var i=new Image,n=new window.Promise((function(t){function n(){i.removeEventListener("load",o),i.removeEventListener("error",a)}function o(){t(e<=i.naturalWidth),n()}function a(){t(!1),n()}i.addEventListener("load",o),i.addEventListener("error",a)}));return i.src=t,n})(o,a).then((function(a){a?s(o):++i<n.length?e(n[i].url,n[i].width,s):s(t.thumbnail_url)}))}(n[i].url,n[i].width,e)})):Promise.resolve(t.thumbnail_url)},getEmbedData:function(t,e,i){return n.a.ajax({type:"GET",url:"/api/proxy/",dataType:"json",data:{url:/oembed/i.test(t)?t:this.getEmbedUrl(t)},success:function(t){t.url=t.url&&o.default.toHttps(t.url),t.thumbnail_url=t.thumbnail_url&&o.default.toHttps(t.thumbnail_url),"function"==typeof e&&e(t)},error:function(t,e,n){"abort"!==e&&"function"==typeof i&&i(t,e,n)},global:!1})},getEmbedUrl:function(t){if(this.isVimeo(t))return"https://vimeo.com/api/oembed.json?url="+encodeURIComponent(t);var e=a.getYoutubeIdFromUrl(t);return e?"https://www.youtube.com/oembed?format=json&url="+encodeURIComponent("https://www.youtube.com/watch?v="+e):""},getYoutubeIdFromUrl:function(t){var e=t.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/);if(e&&11===e[2].length)return e[2];return(e=t.match(/.*(youtu.*\&v=)([^#\&\?]*).*/))&&11===e[2].length?e[2]:null},getVimeoIdFromUrl:function(t){var e=t.match(/(video\/)(\w+)(_\d+x\d+|_\d+)(\.\w+$)/i);return e&&e[2]?e[2]:null},getVideoProvider:function(t){return this.isVimeo(t)?"Vimeo":this.isYoutube(t)?"YouTube":""},isVimeo:function(t){return/vimeo\.com\/.+/.test(t)},isYoutube:function(t){return!!this.getYoutubeIdFromUrl(t)}};e.a=a},Wwwp:function(t,e,i){"use strict";var n=i("h6tn"),o=i("ICos"),a=i("v92f"),s=i("8Tds"),r=i("zjto"),l=i("tZHv"),c=i("D12m"),d=i("a68n"),h=i("IrH7"),u=i("w+s/"),p=i("38uW"),g=i("4hiF"),m=i("A9VP"),f=i("uU7u"),v=i("zZDe"),b=i("vvfI");function _(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_(Object(i),!0).forEach((function(e){w(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var k={},S=Math.pow(2,24),x=function(t){var e=window.RM.constructorRouter.mag,i=t.attributes,n=t.target,o=t.classList,a=t.dataset,s=i.getNamedItem("href"),r=s&&s.value?s.value.toLowerCase():"",l=a.anchorLinkPos?parseInt(a.anchorLinkPos):0,c={linkStyle:o[0],target:"_blank"===n?"_blank":"_self"};return r.startsWith("mailto:")?(c.url=r.replace("mailto:",""),c.type=f.a.Email):r.startsWith("tel:")?(c.url=r.replace("tel:",""),c.type=f.a.Phone):"__rm_anchor"===r?(c.url="".concat(l,"px"),c.pageId=a.pageUri||"",c.type=f.a.Anchor,c.anchorPosition=l):"back to top"===r?(c.url="",c.type=f.a.ScrollToTop):"__rm_goback"===r?(c.url="",c.type=f.a.GoBack):/^\d+$/.test(r)&&e.getPageId(r)?(c.url=r,c.pageId=e.getPageId(r)||"",c.type=f.a.Page):(c.url=r,c.type=f.a.URL),c},C=function(t,e){var i=y({},t);return!e.letterSpacing||"normal"===e.letterSpacing||i.letterSpacing&&"normal"!==i.letterSpacing||(i.letterSpacing=e.letterSpacing),["fontSize","fontWeight","fontFamily","fontStyle","letterSpacing","textDecorationLine","textTransform","color","textAlign","paddingLeft","paddingTop","paddingRight","paddingBottom","lineHeight"].reduce((function(t,e){return i[e]?y(y({},t),{},w({},e,i[e])):t}),{})},O=function(t){var e=[];return t.forEach((function(t,i){Object.keys(t.styles).forEach((function(n){var a,s,r=(a=n,s=t.styles[n],"fontSize"===a?Object(m.f)(m.b.FontSize,parseInt(s)):"fontStyle"===a?Object(m.f)(m.b.FontStyle,s):"fontWeight"===a?Object(m.f)(m.b.FontWeight,s):"fontFamily"===a?Object(m.f)(m.b.FontFamily,s.replace(/"/g,"")):"letterSpacing"===a&&"normal"!==s?Object(m.f)(m.b.LetterSpacing,parseFloat(s)):"color"===a?Object(m.f)(m.b.Color,Object(o.i)(Object(o.h)(s))):"textDecorationLine"===a?Object(m.f)(m.b.Decoration,s):"textTransform"===a?Object(m.f)(m.b.Transform,s):void 0);r&&e.push({offset:i,length:1,style:r})}))})),e},P=function(t,e){var i=e.textContent,n=null==i?void 0:i.length;e.textContent="".concat("<%TAG_POINTER%>").concat(i);var o=t.textContent,a=null==o?void 0:o.indexOf("<%TAG_POINTER%>");return e.textContent=i,{offset:a,length:n}},j=function(t){var e={blocks:[],styles:[],entityMap:{}},i=0;return t.forEach((function(t){var n=t.paragraph,o=t.charStyle,a=function(){for(var t;void 0===t||k.hasOwnProperty(t)||!isNaN(+t);)t=Math.floor(Math.random()*S).toString(32);return k[t]=!0,t}(),s=function(t){var e,i,n={};if(null===(e=t.classList)||void 0===e?void 0:e.length){var o=Array.from(t.classList).filter((function(t){return t.startsWith("paragraph")}));n[d.i]=o[0]}if(t.style.textAlign)switch(t.style.textAlign){case"right":i=h.a.AlignRight;break;case"center":i=h.a.AlignCenter;break;case"justify":i=h.a.AlignJustify;break;default:i=h.a.AlignLeft}var a={};return t.style.paddingLeft&&(a.left=parseInt(t.style.paddingLeft)),t.style.paddingTop&&(a.top=parseInt(t.style.paddingTop)),t.style.paddingRight&&(a.right=parseInt(t.style.paddingRight)),t.style.paddingBottom&&(a.bottom=parseInt(t.style.paddingBottom)),n[u.b]=a,t.style.lineHeight&&(n[p.c]=parseInt(t.style.lineHeight)),t.style.fontSize&&(n[g.a]=parseInt(t.style.fontSize)),t.style.textIndent&&(n[b.c]=parseInt(t.style.textIndent)),{type:i,data:n}}(n),r=s.data,l=s.type,c=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e,n=[],o={};Array.from(t.querySelectorAll("a")).forEach((function(e){if(e.textContent){var a=P(t,e),s=a.offset,r=a.length;"number"==typeof s&&"number"==typeof r&&(n.push({key:i,offset:s,length:r}),o[i]={mutability:"MUTABLE",type:f.e,data:x(e)},i++)}}));for(var a,s=new RegExp("↵","g"),r=t.textContent||"";null!==(a=s.exec(r));)n.push({key:i,offset:a.index,length:1}),o[i]={mutability:"MUTABLE",type:v.b,data:{}},i++;return{entityRanges:n,entityMap:o,lastKey:i}}(n,i),m=c.entityMap,_=c.entityRanges,w=c.lastKey;i=w;var C={key:a,text:n.textContent||"",data:r,depth:0,entityRanges:_},j={key:a,type:l||"unstyled",inlineStyles:O(o)};e.blocks.push(C),e.styles.push(j),e.entityMap=y(y({},e.entityMap),m)})),e},$=function(t){var e,i=function(t){var e=document.createElement("div");e.classList.add("block","block-text"),e.style.position="absolute",e.style.left="-9999px",e.style.opacity="0",e.style.visibility="hidden";var i=document.createElement("div");return i.classList.add("text-preview","v2"),i.innerHTML=t,e.append(i),document.body.appendChild(e),e}(t);!function(t){Array.from(t.querySelectorAll("br")).forEach((function(t){var e=document.createTextNode("↵");t.replaceWith(e)}))}(i);var n=function(t){var e=[];return Array.from(t.querySelectorAll("p")).forEach((function(t){for(var i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT),n=[],o=null;o=i.nextNode();)for(var a,s=(null===(a=o.parentElement)||void 0===a?void 0:a.style)||{},r=o.parentElement?window.getComputedStyle(o.parentElement):{},l=C(r,s),c=o.textContent||"",d=0;d<c.length;d++){var h=c[d];n.push({symbol:h,styles:l})}e.push({charStyle:n,paragraph:t})})),e}(i),o=j(n);return null===(e=i.parentNode)||void 0===e||e.removeChild(i),o};function T(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function I(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function E(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?I(Object(i),!0).forEach((function(e){M(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):I(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function M(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"c",(function(){return D})),i.d(e,"b",(function(){return z})),i.d(e,"a",(function(){return B}));var R=function(t,e){if(!t)return"";var i="number"==typeof e?e:100;return"".concat(t).concat(Object(o.a)(i))},A=function(t,e){return c.a.prototype.switchTextToViewport(t,e)},D=function(t){var e=E({},t),i=e.text,n=$(i),o={blocks:n.blocks,styles:n.styles,entityMap:n.entityMap};if(e.viewport_phone_portrait){var l=A(i,a.a.PhonePortrait),c=$(l),d=c.blocks,h=c.styles,u=c.entityMap;o.viewport_phone_portrait={blocks:d,styles:h,entityMap:u,bgColor:R(e.viewport_phone_portrait.bg_color,100*e.viewport_phone_portrait.bg_opacity),columns:{count:e.viewport_phone_portrait.column_count,gap:e.viewport_phone_portrait.column_gap}},e.viewport_phone_portrait=E(E({},e.viewport_phone_portrait),o.viewport_phone_portrait),e.viewport_phone_portrait.hasOwnProperty("hidden")||(e.viewport_phone_portrait.hidden=!1),delete e.viewport_phone_portrait.column_count,delete e.viewport_phone_portrait.column_gap,delete e.viewport_phone_portrait.bg_color,delete e.viewport_phone_portrait.bg_opacity}if(e.viewport_tablet_portrait){var p=A(i,a.a.TabletPortrait),g=$(p),m=g.blocks,f=g.styles,v=g.entityMap;o.viewport_tablet_portrait={blocks:m,styles:f,entityMap:v,bgColor:R(e.viewport_phone_portrait.bg_color,100*e.viewport_phone_portrait.bg_opacity),columns:{count:e.viewport_tablet_portrait.column_count,gap:e.viewport_tablet_portrait.column_gap}},e.viewport_tablet_portrait=E(E({},e.viewport_tablet_portrait),o.viewport_tablet_portrait),e.viewport_tablet_portrait.hasOwnProperty("hidden")||(e.viewport_tablet_portrait.hidden=!1),delete e.viewport_tablet_portrait.column_count,delete e.viewport_tablet_portrait.column_gap,delete e.viewport_tablet_portrait.bg_color,delete e.viewport_tablet_portrait.bg_opacity}return delete(e=E(E({},e),{},{overflow:e.autosize?s.b.Visible:s.b.Hidden,verticalAlign:s.f.top,blocks:o.blocks,styles:o.styles,entityMap:o.entityMap,bgColor:R(e.bg_color,100*e.bg_opacity),columns:{count:e.column_count,gap:e.column_gap},version:r.version})).autosize,delete e.column_count,delete e.column_gap,delete e.bg_color,delete e.bg_opacity,delete e.text,e},z=function(t){var e=["normal","none",0,"baseline"];return t.map((function(t){var i=t._name,a=t._caption,s=t.tag,r=(t._sort,T(t,["_name","_caption","tag","_sort"])),c=Object.keys(r).reduce((function(t,i){var a=Object(n.a)(i),s=r[i];return e.includes(s)?E({},t):("textAlign"===a&&"start"===s?s="left":"color"===a?s=Object(o.b)(s):a.includes("padding")&&(s=parseInt(s)),E(E({},t),{},M({},a,s)))}),{});return c.paddingLeft=c.paddingLeft||0,c.paddingRight=c.paddingRight||0,c.paddingTop=c.paddingTop||0,c.paddingBottom=c.paddingBottom||0,{name:i,label:a,tag:s||l.a.AVAILABLE_TEXT_TAGS[0],cssProperties:c}}))},L=function(t,e){var i=function(t){return e?"".concat(e,"-").concat(t):t},n=t[i("color")],o=t[i("opacity")],a=t[i("u-color")],r=t[i("u-opacity")],l=t[i("u-size")],c=t[i("u-offset")],d=t[i("u-style")];return{textColor:R(String("inherit"===n?t.color:n),Number("inherit"===o?t.opacity:o)),color:R(String("inherit"===a?t["u-color"]:a),Number("inherit"===r?t["u-opacity"]:r)),size:Number("inherit"===l?t["u-size"]:l),padding:Number("inherit"===c?t["u-offset"]:c),type:function(t){switch(t){case"none":return s.a.None;case"dotted":return s.a.Dotted;case"dashed":return s.a.Dashed;case"solid":return s.a.Solid}}(d)}},B=function(t){return t.map((function(t){return{name:t._name,label:t._caption,style:{link:L(t),hover:L(t,"hover"),current:L(t,"current")}}}))}},Wxmq:function(module,exports){module.exports={"template-viewer-share":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t",hasOverlay&&(__p+='\n\t\t<div class="share-popup-overlay hidden" data-nosnippet></div>\n\t'),__p+='\n\n\t<div class="share-popup hidden" data-nosnippet>\n\t\t<noindex>\n\t\t\t<div class="content-wrapper">\n\n\t\t\t\t<div class="share-wrapper">\n\t\t\t\t\t<div class="caption">Share</div>\n\n\t\t\t\t\t<div class="type-selector">\n\t\t\t\t\t\t\x3c!--__magterm--\x3e\n\t\t\t\t\t\t<div class="type-full">Project</div>\n\t\t\t\t\t\t<div class="type-page">Current Page</div>\n\t\t\t\t\t\t<div class="arrow sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="buttons-wrapper">\n\t\t\t\t\t\t<div class="share-facebook button" data-tp="facebook"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div>Share</div>\n\t\t\t\t\t\t<div class="share-twitter button" data-tp="twitter"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>Tweet</div>\n\t\t\t\t\t\t",isNewSettingsEnabled||(__p+='\n\t\t\t\t\t\t\t<div class="share-gplus button" data-tp="gplus"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>Google+</div>\n\t\t\t\t\t\t"),__p+='\n\t\t\t\t\t\t<div class="share-pinterest button" data-tp="pinterest"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div>Pin</div>\n\t\t\t\t\t\t<div class="share-linkedin button" data-tp="linkedin"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>Linkedin</div>\n\t\t\t\t\t\t",isNewSettingsEnabled||(__p+='\n\t\t\t\t\t\t\t<div class="share-mail button" data-tp="email"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>Email</div>\n\t\t\t\t\t\t"),__p+="\n\t\t\t\t\t</div>\n\n\t\t\t\t\t",common.isDownloadedSource||(__p+='\n\t\t\t\t\t\t<div class="open-embed"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div>Embed</div>\n\t\t\t\t\t\t<div class="close">Close</div>\n\t\t\t\t\t\t<div class="send-report" data-tp="report"><div class="icon sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+"')\"></div>Report</div>\n\t\t\t\t\t"),__p+="\n\t\t\t\t</div>\n\n\t\t\t\t",common.isDownloadedSource||(__p+='\n\t\t\t\t\t<div class="embed-wrapper">\n\t\t\t\t\t\t<div class="caption">Embed</div>\n\n\t\t\t\t\t\t<div class="size-selector" data-selected="responsive">\n\t\t\t\t\t\t\t<div class="size responsive" data-size="responsive">Responsive</div>\n\t\t\t\t\t\t\t<div class="size big" data-size="big">512×383</div>\n\t\t\t\t\t\t\t<div class="size small" data-size="small">288×236</div>\n\t\t\t\t\t\t\t<div class="arrow sprite" style="background-image: url(\''+(null==(__t=icons.sprite)?"":__t)+'\')"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="code-block">\n\t\t\t\t\t\t\t<div class="thumb">\n\t\t\t\t\t\t\t\t<img class="thumb-pic" src="" alt=""/>\n\t\t\t\t\t\t\t\t<div class="thumb-toolbar">\n\t\t\t\t\t\t\t\t\t<div class="icon arrows" style="background-image: url(\''+(null==(__t=icons.thumbArrows)?"":__t)+'\')"></div>\n\t\t\t\t\t\t\t\t\t<div class="icon open" style="background-image: url(\''+(null==(__t=icons.thumbOpen)?"":__t)+'\')"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<textarea class="embed-code"></textarea>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="back">Back</div>\n\t\t\t\t\t</div>\n\t\t\t\t'),__p+='\n\t\t\t</div>\n\n\t\t\t<div class="corner-wrapper">\n\t\t\t\t<div class="corner"></div>\n\t\t\t</div>\n\t\t</noindex>\n\t</div>\n';return __p}}},XHB6:function(t,e,i){"use strict";var n=i("xi34"),o=i("OTSC"),a=i("Fts9"),s={model:{event:"change"},props:{color:String,alpha:Number,disabled:{type:Boolean,default:!1},disabledIcon:String,customIcon:String,showAlpha:{type:Boolean,default:!0},showArrowIcon:{type:Boolean,default:!1},hOffset:{type:Number,default:0},opacityMultiplier:{type:Number,default:1},vOffset:{type:Number,default:0},verticalAlign:{type:String,default:"auto"},alwaysVisible:{type:Boolean,default:!1},colorboxType:{type:String,default:"small"},colorboxWidth:{type:Number,default:168},swatchesMin:{type:Number,default:void 0},swatchesPerLine:{type:Number,default:void 0},favouritesMax:{type:Number,default:void 0},favouritesPerLine:{type:Number,default:void 0}},data:function(){return{mutableColor:this.color,mutableAlpha:this.showAlpha?this.alpha*this.opacityMultiplier:1,visibleBox:!1,colorBoxStyles:{}}},computed:{bg:function(){return this.disabled&&!this.mutableColor?"#b8b8b8":o.default.getRGBA(this.mutableColor,this.showAlpha?this.opacity100based:1)},opacity100based:function(){return this.mutableAlpha/100},opacityResult:function(){return this.mutableAlpha/this.opacityMultiplier}},watch:{color:function(t){return this.mutableColor=t,!!this.colorbox&&(this.mutableColor?void this.colorbox.setColor(this.mutableColor):(this.visibleBox&&this.hide(),!1))},alpha:function(t){this.mutableAlpha=t}},mounted:function(){var t=8;this.alwaysVisible?(this.colorBoxStyles.width=(this.colorboxWidth||168)+"px",this.colorBoxStyles.overflow="hidden",this.colorBoxStyles["border-radius"]="6px 6px 0 0",this.onColorClick()):(Object(n.a)(this.$el).hasClass("round")&&(t=7),this.$el.getBoundingClientRect().top>window.innerHeight/2||"top"===this.verticalAlign?this.colorBoxStyles["margin-top"]=-(240+t+this.vOffset)+"px":this.colorBoxStyles["margin-top"]=Object(n.a)(this.$refs.button).height()+t+this.vOffset+"px",this.colorBoxStyles["margin-left"]=-(this.hOffset+152-Object(n.a)(this.$refs.button).width())+"px")},methods:{onColorClick:function(){if(!this.disabled){if(!this.colorbox){var t={$parent:this.$el.querySelector(".colorbox_container"),type:this.colorboxType,show_opacity:this.showAlpha};this.colorboxWidth&&(t.width=this.colorboxWidth),this.swatchesMin&&(t.swatches_min=this.swatchesMin),this.swatchesPerLine&&(t.swatches_per_line=this.swatchesPerLine),this.favouritesMax&&(t.favourites_max=this.favouritesMax),this.favouritesPerLine&&(t.favourites_per_line=this.favouritesPerLine),this.colorbox=new a.a(t),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged)}this.colorbox.setColor(this.mutableColor),this.colorbox.setOpacity(this.opacity100based),this.$emit(this.visibleBox?"hidePopup":"showPopup",this),this.visibleBox=!this.visibleBox}},colorOpacityChanged:function(t,e,i,n){this.mutableColor=this.colorbox.rgb2hex([t,e,i]),this.mutableAlpha=100*n,this.$emit("update:all",{color:this.mutableColor,alpha:this.opacityResult}),this.$emit("update:color",this.mutableColor),this.$emit("update:alpha",this.opacityResult)},hide:function(){this.visibleBox=!1,this.$emit("hidePopup")}}},r=(i("6z1P"),i("KHd+")),l=Object(r.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"button",class:{"color-picker-container":!0,"color-picker-disabled":t.disabled}},[t.showAlpha?i("div",{staticClass:"opacity-grid"}):t._e(),t._v(" "),t.alwaysVisible?t._e():i("div",{staticClass:"color-preview",style:{backgroundColor:t.bg},on:{click:function(e){return e.stopPropagation(),t.onColorClick(e)}}},[t.disabled&&t.disabledIcon?i("img",{staticClass:"disabled-icon",attrs:{src:t.disabledIcon}}):t._e(),t._v(" "),!t.disabled&&t.customIcon?i("img",{staticClass:"custom-icon",attrs:{src:t.customIcon}}):t._e()]),t._v(" "),t.showArrowIcon?i("div",{staticClass:"arrow-icon",on:{click:function(e){return e.stopPropagation(),t.onColorClick(e)}}}):t._e(),t._v(" "),i("div",{staticClass:"colorbox_container",class:{visible:t.visibleBox},style:t.colorBoxStyles,on:{click:function(t){t.stopPropagation()}}})])}),[],!1,null,null,null);e.a=l.exports},"Y+fa":function(t,e,i){"use strict";var n=i("TAzU");i.n(n).a},YNoo:function(module,exports){module.exports={"template-viewer-widget-text":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var cc=1==column_count?"auto":column_count;__p+='\n\t<div style=" -webkit-nbsp-mode:normal; -webkit-line-break:after-white-space; white-space:'+(null==(__t=isNotChrome?"normal":"pre-wrap")?"":__t)+"; column-count:"+(null==(__t=cc)?"":__t)+";-webkit-column-count:"+(null==(__t=cc)?"":__t)+" !important;-moz-column-count:"+(null==(__t=cc)?"":__t)+";column-gap:"+(null==(__t=column_gap)?"":__t)+"px;-webkit-column-gap:"+(null==(__t=column_gap)?"":__t)+"px !important;-moz-column-gap:"+(null==(__t=column_gap)?"":__t)+"px;background:"+(null==(__t=bg)?"":_.escape(__t))+'">'+(null==(__t=text)?"":__t)+"</div>\n"}return __p}}},YqYG:function(t,e,i){"use strict";i.r(e);var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("Nnyp"),l=i.n(r),c=a.a.View.extend({template:l.a["template-common-alert"],events:{"click .button":"onButtonClick",click:"hideOnBgClick","click .button.upgrade":"upgrade","click .button.cancel":"hide","click .button.close":"hide","click .button.ok":"hide","click .contact-link":"hide","click .button.resend":"resendConfirmationEmail"},initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),this.opts=this.opts||{},this.router=this.router||RM.homepageRouter||RM.collectorRouter||RM.constructorRouter,this.router&&this.router.analytics&&this.router.analytics.sendEvent("Alert Show",{label:this.alert_source,_alert_source:this.alert_source})},render:function(){this.setElement(Object(n.a)(this.template({opts:this.opts}))),this.$parent&&(this.$parent instanceof Element&&(this.$parent=Object(n.a)(this.$parent)),this.$parent.append(this.$el).addClass("visible")),s.a.delay(s.a.bind((function(){this.$el.addClass("show")}),this),50),Object(n.a)("body").on("keyup",this.onBodyKeyUp),RM.common.disableShortcuts.alert=!0},hide:function(){delete RM.common.disableShortcuts.alert,Object(n.a)("body").off("keyup",this.onBodyKeyUp),this.$el.removeClass("show").addClass("hide"),s.a.delay(s.a.bind((function(){this.remove(),this.$parent&&this.$parent.removeClass("visible")}),this),400),this.trigger("hide",{lastButtonClicked:this.lastButtonClicked})},upgrade:function(t){Modernizr.sessionstorage&&window.sessionStorage.setItem("rm.accountUpgradeReturnUrl",window.location.pathname),this.router&&this.router.analytics&&this.router.analytics.sendEvent("Alert Upgrade",{label:this.alert_source,_alert_source:this.alert_source}),2==t.which||t.metaKey||t.ctrlKey||this.router&&this.router==RM.collectorRouter&&(this.hide(),this.router.navigate("/settings#change-plan",{trigger:!0}),t.preventDefault())},onBodyKeyUp:function(t){27==t.keyCode&&(t.stopPropagation(),t.preventDefault(),this.hide())},hideOnBgClick:function(t){Object(n.a)(t.target).closest(".panel").length||this.hide()},resendConfirmationEmail:function(){n.a.get("/api/user/confirm/resend"),this.hide()},onButtonClick:function(t){var e=Object(n.a)(t.currentTarget).attr("data-type");this.lastButtonClicked=e}});e.default=c},Zuws:function(module,exports){module.exports={"template-viewer-widget-background":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="rmwidget widget-background" style="background-color: #'+(null==(__t=data.color)?"":__t)+'">\n\n        ',"picture"==data.selectedType&&(__p+='\n            <div class="picture-background" style="opacity: '+(null==(__t=data.opacity||1)?"":__t)+';"></div>\n        '),__p+="\n\n        ","video"==data.selectedType&&(__p+='\n            <div class="video-background" style="opacity: '+(null==(__t=data.videoopacity||1)?"":__t)+';">\n                <div class="video-container"></div>\n                <div class="overlay"></div>\n            </div>\n\t\t'),__p+="\n\n\t\t","slideshow"==data.selectedType&&(__p+='\n\t\t\t<div class="slideshow-background">\n\t\t\t\t<div class="slideshow-container"></div>\n\t\t\t\t<div class="slideshow-preload"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},"a/+O":function(module,exports){module.exports={"template-constructor-helpers-upload-button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rm-upload-button">\n\t\t<div class="icon"></div>\n\t</div>\n\n';return __p}}},a3mI:function(module,exports){module.exports={"template-constructor-control-button_icon":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Icon" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="search-block">\n\n\t\t\t<input class="search" type="text" placeholder="Search">\n\n\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="common-wrapper">\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t\t<div class="disable-icon item">\n\t\t\t\t\t\t\t<div class="line"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!--<div class="last-icon item">--\x3e\n\t\t\t\t\t\t\t\x3c!--<div class="noun-icon"></div>--\x3e\n\t\t\t\t\t\t\x3c!--</div>--\x3e\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t<div class="edit-item" data-field="icon_h">\n\t\t\t\t\t<div class="caption">Size</div>\n\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="edit-item" data-field="icon_pos">\n\t\t\t\t\t<div class="caption">Pos.</div>\n\t\t\t\t\t<div class="positions">\n\t\t\t\t\t\t<div class="right position" data-position="right">\n\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="left position" data-position="left">\n\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t</div>\n';return __p},"template-constructor-control-button_icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},a68n:function(t,e,i){"use strict";i.d(e,"i",(function(){return h})),i.d(e,"g",(function(){return g})),i.d(e,"a",(function(){return m})),i.d(e,"d",(function(){return f})),i.d(e,"c",(function(){return v})),i.d(e,"b",(function(){return b})),i.d(e,"h",(function(){return _})),i.d(e,"e",(function(){return y})),i.d(e,"f",(function(){return w}));var n=i("/5Qy"),o=i("ICos"),a=i("9Juw");function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){l(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function c(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return d(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return d(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var h="textStyle",u=["fontSize","lineHeight","letterSpacing","textIndent","paddingLeft","paddingTop","paddingRight","paddingBottom"],p=function(t,e){if(e){if(u.includes(t))return"".concat(e,"px");if("color"===t){var i=Object(o.e)(String(e)),n=i.r,a=i.g,s=i.b,r=i.a;return"rgba(".concat(n,", ").concat(a,", ").concat(s,", ").concat(r,")")}return e}},g=function(t,e){if(e){if(u.includes(t))return parseInt(String(e));if("color"===t){var i=Object(o.h)(String(e)),n=i.r,a=i.g,s=i.b;return Object(o.i)({r:n,g:a,b:s,a:1})}return e}},m=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object.keys(t).reduce((function(i,o){return t[o]?"".concat(i).concat(Object(n.a)(o),": ").concat(p(o,t[o])," ").concat(e?"!important":"",";"):i}),"")},f=function(){var t=window.RM.textStyles||window.ServerData&&window.ServerData.mags&&window.ServerData.mags.mag&&window.ServerData.mags.mag.textStyles;return t?[].concat(c(t.project||[]),c(t.global||[])).reduce((function(t,e){return r(r({},t),{},l({},e.name,{element:e.tag}))}),{}):{}},v=function(t,e){return t?e?parseFloat(String(t)):parseInt(String(t)):0},b=function(t){var e=t.editorState,i=t.block,n=Object(a.h)({editorState:e,block:i,key:h});return"string"==typeof n?n:""},_=function(t){var e=t.block,i=t.editorState,n=t.styleName;return Object(a.u)({editorState:i,block:e,key:h,value:n})},y=function(t){if(t&&t.cssProperties){var e=t.cssProperties,i=e.paddingTop,n=e.paddingLeft,o=e.paddingRight,a=e.paddingBottom,s={left:void 0!==n?v(n):0,top:void 0!==i?v(i):0,right:void 0!==o?v(o):0,bottom:void 0!==a?v(a):0};if(s.left||s.top||s.right||s.bottom)return s}},w=function(t){return Object.keys(t).every((function(e){return"number"==typeof t[e]&&0===t[e]}))}},amZL:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("DqjY"),c=i("ee0N"),d=i.n(c),h=i("MseB"),u=i.n(h),p=a.a.View.extend({initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),this.destroy.__debounced=s.a.debounce(this.destroy,0),this.$parent.hasClass("typekit-popup-shown")||(this.template=u.a["template-constructor-helpers-typekit-popup"],this.render(),s.a.defer(this.show))},TOP_POPUP_TRESHOLD:170,render:function(){var t,e;this.setElement(Object(n.a)(this.template({}))),this.$parent.addClass("typekit-popup-shown"),this.$parent.on("mouseleave",this.setPopupTimeout),this.$parent.on("mouseenter",this.resetPopupTimeout),this.$parent.on("click",this.destroy.__debounced),t=Math.round(this.$parent.offset().left+this.$parent.width()/2),e=Math.round(this.$parent.offset().top),this.$el.toggleClass("popup-below",e-this.TOP_POPUP_TRESHOLD<0),Object(n.a)("body").append(this.$el),this.$el.css({left:t,top:e})},show:function(t){this.$el.addClass("shown")},setPopupTimeout:function(){this.$parent.hasClass("typekit-popup-shown")&&(this.popupTimer=setTimeout(this.destroy.__debounced,500))},resetPopupTimeout:function(){clearTimeout(this.popupTimer)},destroy:function(){this.$parent.removeClass("typekit-popup-shown"),this.$parent.off("mouseleave",this.setPopupTimeout),this.$parent.off("mouseenter",this.resetPopupTimeout),this.$parent.off("click",this.destroy.__debounced),clearTimeout(this.popupTimer),this.$el.removeClass("shown"),setTimeout(s.a.bind((function(){this.$el.off().remove()}),this),300)}}),g=i("nnuN"),m=a.a.View.extend({events:{"click .view-wrapper .grid-view, .view-wrapper .list-view":"switchView","click .size-wrapper .top-letter, .size-wrapper .bottom-letter":"onSizeLetterClick","click .right-panel .providers-switcher li":"switchProvider","click .right-panel .provider-filter .language-wrapper":"toggleLanguage","click .scroll-wrapper.main .results .font-item .list-add-remove-font":"addRemoveFont","mouseenter .scroll-wrapper.main .results .font-item ":"checkAddRemoveState","click .right-panel .font-info .bottom-info .info-add-remove-font":"addRemoveFont","mousedown .scroll-wrapper.main .results .font-item":"onFontItemMouseDown","mousemove .scroll-wrapper.main .results .font-item":"onFontItemMouseMove","mouseup .scroll-wrapper.main .results .font-item":"onFontItemMouseUp","click .scroll-wrapper.main .results .font-item":"openInfo","click .search-icon":"toggleSearch","click .back-icon":"closeInfo","input .search-wrapper .search-string":"onSearchStringChange","keypress .search-wrapper .search-string":"onSearchStringKey","keyup .search-wrapper .search-string":"onSearchStringKey","keydown .search-wrapper .search-string":"onSearchStringKey","click .search-wrapper .clear":"onClearSearchString",click:"closeLanguage","click .filter div":"onFilterItemClick","mouseenter .filter div":"onFilterMouseEnter","mouseleave .filter div":"onFilterMouseLeave"},PAGINATION:4,DATA_URL:window.fontsConfig.fontslist,IMGS_URL:window.fontsConfig.fontsimgs,LANGUAGE_MAP:{cyrillic:"cyrillic",devanagari:"devanagari",greek:"greek",khmer:"khmer",latin:"latin",vietnamese:"vietnamese",ca:"latin",cs:"latin",de:"latin",en:"latin",es:"latin",fr:"latin",it:"latin",nl:"latin",pl:"latin",pt:"latin",ru:"cyrillic",sv:"latin"},LANGUAGE_NAMES:{cyrillic:"Cyrillic",devanagari:"Devanagari",greek:"Greek",khmer:"Khmer",latin:"Latin",vietnamese:"Vietnamese",ca:"Catalan",cs:"Czech",de:"German",en:"English",es:"Spanish",fr:"French",it:"Italian",nl:"Dutch",pl:"Polish",pt:"Portuguese",ru:"Russian",sv:"Swedish",mt:"Maltese",sl:"Slovenian"},FVD_NAMES:g.WEIGHTS,CHARSETS_PRIORITY_FILTER_ON:["cyrillic","greek","vietnamese","devanagari","khmer","latin"],CHARSETS_PRIORITY_FILTER_OFF:["latin","cyrillic","greek","vietnamese","devanagari","khmer"],FVD_PRIORITY_REGULAR:["n4","i4","n3","i3","n5","i5","n2","i2","n6","i6","n1","i1","n7","i7","n8","i8","n9","i9"],FVD_PRIORITY_LIGHT:["n1","i1","n2","i2","n3","i3","n4","i4","n5","i5","n6","i6","n7","i7","n8","i8","n9","i9"],FVD_PRIORITY_HEAVY:["n9","i9","n8","i8","n7","i7","n6","i6","n5","i5","n4","i4","n3","i3","n2","i2","n1","i1"],initialize:function(t){s.a.bindAll(this),this.template=d.a["template-constructor-helpers-font-explorer"],this.itemTemplate=d.a["template-constructor-helpers-font-explorer-item"],this.noFoundTemplate=d.a["template-constructor-helpers-font-explorer-no-found"],this.applyFilter.__debounced=s.a.debounce(this.applyFilter,150),this.loadVisibleFontPreviews.__debounced=s.a.debounce(this.loadVisibleFontPreviews,300)},render:function(){this.setElement(Object(n.a)(this.template({})).insertAfter("#constructor")),this.$mainList=this.$(".scroll-wrapper.main .results-wrapper .results"),this.$infoList=this.$(".scroll-wrapper.info .results-wrapper .results"),this.mainScroll=Object(n.a)(this.$mainList.closest(".scroll-wrapper")).RMScroll({$container:this.$mainList.closest(".results-wrapper"),$content:this.$mainList,$handle:this.$mainList.closest(".scroll-wrapper").find(".scroll"),onScroll:this.onFontsScroll,gap_start:8,gap_end:8}).data("scroll"),this.infoScroll=Object(n.a)(this.$infoList.closest(".scroll-wrapper")).RMScroll({$container:this.$infoList.closest(".results-wrapper"),$content:this.$infoList,$handle:this.$infoList.closest(".scroll-wrapper").find(".scroll"),gap_start:8,gap_end:8}).data("scroll");var t=Object(n.a)(this.$(".size-wrapper .slider"));if(this.sizeSlider=t.slider({min:1,max:7,value:4,orientation:"vertical",start:function(){Object(n.a)("body").addClass("ns-resize-cursor"),t.addClass("dragging")},stop:function(){Object(n.a)("body").removeClass("ns-resize-cursor"),t.removeClass("dragging")},change:this.sizeChanged,slide:this.sizeChanged}),RM.constructorRouter&&RM.constructorRouter.previewMode){var e=Math.round(Math.abs(window.innerHeight-this.$el.height())/2);this.$el.css({position:"fixed","margin-top":0,top:e+"px"})}this.loadFontsData(),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("fontexplorer")})),this.rendered=!0},loadFontsData:function(){var t=this,e=new Date,i=e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear();n.a.ajax({type:"GET",url:this.DATA_URL+"?timestamp="+i+"&callback=?",jsonpCallback:"fontsListCallback",contentType:"application/json",cache:!0,dataType:"jsonp",success:function(e){t.$(".overlay").remove(),e.typetoday.forEach((function(t){t.deprecated_variations&&t.deprecated_variations.length&&(t.variations=s.a.difference(t.variations,t.deprecated_variations))})),t.fontsData=e,t.applyFilter()},error:function(t){console.log(arguments)}})},buildFilter:function(){var t=this.$(".right-panel .providers-switcher li.active").attr("data-name"),e=this.$('.right-panel .provider-filter[data-name="'+t+'"]'),i={},o="";return this.$(".search-icon").hasClass("active")?o=n.a.trim(this.$(".search-wrapper .search-string").val()):e.find(".filter div.active").each((function(){var t=Object(n.a)(this),e=t.parent().attr("data-name"),o=t.attr("data-name");i[e]||(i[e]=[]),i[e].push(o)})),{provider:t,filter:i,search:o}},applyFilter:function(){if(this.fontsData){var t,e,i,n,o=this.buildFilter(),a=o.provider,l=o.filter,c=o.search,d=this.fontsData[a];if(this.$(".search-wrapper .search-string").attr("placeholder","Search "+d.length+" fonts"),JSON.stringify(this.filter)!=JSON.stringify(o)){d=s.a.filter(d,(function(o){for(t in o=o.browse_info?o.browse_info:o,n=!0,l)if(i=l[t],e=s.a.isArray(o[t])?o[t]:[o[t]],!(n=n&&s.a.intersection(i,e).length))return;return n}));var h=s.a.compact(r.default.escapeRegExp(c).split(" ")),u=new RegExp(h.join(".*?"),"i");d=s.a.filter(d,(function(t){var e=t.name||t.family;return u.test(e)})),this.filteredFonts=d,this.filter=o,this.$mainList.empty(),this.mainScroll.recalc()}}},showFilteredFontsPortion:function(){if(this.filteredFonts){var t=this,e=Modernizr.retina?"@2x":"",i=this.$mainList.find(".font-item").length,n=this.filteredFonts.length,o=i,a=Math.min(n-i,this.PAGINATION),l=this.filter.provider,c=this.filter.filter,d=("google"==l?[]:c.weight)||[],h=("google"==l?c.subsets:c.language)||[];if(0!=n){if(0!=a){for(var u=o;u<o+a;u++){var p=this.filteredFonts[u],g=l+"_"+m(p.id||p.family||p.name)+"_"+f("google"==l?p.subsets:p.browse_info?p.browse_info.language:["en"],h)+"_"+v(p.variations,d);this.$mainList.append(this.itemTemplate({img1:g,img2:e+".png?t="+p.lastModified,text:p.name||p.family,name:p.name||p.family,id:p.id||p.name||p.family,styles:p.variations.length,provider:l,Utils:r.default}))}this.mainScroll.recalc()}}else this.$mainList.append(this.noFoundTemplate({}))}function m(t){return t.toLowerCase().split(" ").join("-")}function f(e,i){var n=function(e){for(var i={},n=0;n<e.length;n++)t.LANGUAGE_MAP[e[n]]&&(i[t.LANGUAGE_MAP[e[n]]]=!0);return Object.keys(i)}(e=(e=i.length?s.a.intersection(e,i):e).length?e:["latin"]),o=i.length?t.CHARSETS_PRIORITY_FILTER_ON:t.CHARSETS_PRIORITY_FILTER_OFF;return s.a.intersection(o,n)[0]}function v(e,i){var n,o=(i=i.length?i:["regular"])[0];return"light"==o&&(n=t.FVD_PRIORITY_LIGHT),"regular"==o&&(n=t.FVD_PRIORITY_REGULAR),"heavy"==o&&(n=t.FVD_PRIORITY_HEAVY),s.a.intersection(n,e)[0]}},loadVisibleFontPreviews:function(){var t=this.IMGS_URL+this.$mainList.attr("data-view")+"_",e=this.$mainList.parent().scrollTop(),i=this.$mainList.parent().height();this.$mainList.find(".font-item").each((function(){var o=Object(n.a)(this),a=t+o.attr("data-img1")+o.attr("data-img2");if(!o.attr("data-loaded")){var s=o.height(),r=o.position().top;r+s>e&&r<i+e&&(o.css("background-image",'url("'+a+'")'),o.attr("data-loaded",!0))}}))},onFontsScroll:function(t){t.content_size-t.container_size-t.scroll_pos<100&&this.showFilteredFontsPortion(),this.loadVisibleFontPreviews.__debounced()},switchView:function(t){var e=Object(n.a)(t.target);if(!e.hasClass("active")){e.addClass("active").siblings().removeClass("active");var i,o=this.$mainList.parent().scrollTop(),a=0;this.$mainList.find(".font-item").each((function(){if(i=Object(n.a)(this),(a=i.position().top-o)>=0)return!1})),this.$mainList.attr("data-view",e.attr("data-name")),this.$mainList.find(".font-item").removeAttr("data-loaded").css("background-image",""),this.mainScroll.recalc(),this.$mainList.parent().scrollTop(i.position().top-a)}},switchProvider:function(t){var e=Object(n.a)(t.target);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),this.$(".provider-filter").addClass("invisible"),this.$('.provider-filter[data-name="'+e.attr("data-name")+'"]').removeClass("invisible"),this.applyFilter())},onFilterItemClick:function(t){var e=Object(n.a)(t.target),i=e.closest(".filter"),o=!!(i.attr("data-multiple")-0);e.attr("data-name")&&(e.toggleClass("active"),o||e.siblings("div").removeClass("active"),i.hasClass("language")&&this.updateLangs(i),this.applyFilter())},sizeChanged:function(t,e){this.$mainList.attr("data-size",e.value),this.mainScroll.recalc(),this.$infoList.attr("data-size",e.value),this.infoScroll.recalc()},onSearchStringKey:function(t){if(t.stopPropagation(),t.keyCode==n.a.keycodes.esc&&t.preventDefault(),"keyup"==t.type){if(t.keyCode==n.a.keycodes.esc)return void(""!=this.$(".search-wrapper .search-string").val()?this.clearSearchString():this.toggleSearch());t.keyCode==n.a.keycodes.enter&&(t.preventDefault(),this.applyFilter())}},onSearchStringChange:function(){var t=this.$(".search-wrapper .search-string").val();this.$(".search-wrapper .clear").toggleClass("invisible",""==t),this.applyFilter.__debounced()},clearSearchString:function(){this.$(".search-wrapper .search-string").blur().val("").focus(),this.onSearchStringChange()},onClearSearchString:function(){this.clearSearchString(),this.toggleSearch()},toggleSearch:function(){clearTimeout(this.searchFocusTimeout),this.$(".search-icon").toggleClass("active"),this.$(".search-wrapper").toggleClass("shift-down"),this.$(".scroll-wrapper.main").toggleClass("shift-down"),this.$(".search-icon").hasClass("active")?this.searchFocusTimeout=setTimeout(s.a.bind((function(){this.$(".search-wrapper .search-string").focus()}),this),700):r.default.getFocusBack(),this.applyFilter(),setTimeout(function(){this.mainScroll.recalc()}.bind(this),300)},addRemoveFont:function(t){t.stopPropagation();var e=Object(n.a)(t.target).closest(".font-item, .info-add-remove-font"),i=e.hasClass("removable")?"remove":"add",o=e.attr("data-font-provider"),a=e.attr("data-font-id"),r=e.attr("data-font-name"),l={};"typekit"==o&&(l={id:a}),"webtype"==o&&(l={name:a}),"google"==o&&(l={family:a}),"typetoday"==o&&(l={name:a});var c=s.a.findWhere(this.fontsData[o],l);"remove"==i?RM.constructorRouter.fonts.removeFonts([a]):RM.constructorRouter.fonts.addFonts([{provider:o,css_name:a,name:r,variations:c.variations,temporary:!0}],"font-explorer").error&&new p({$parent:e.hasClass("font-item")?e.find(".list-add-remove-font"):e});this.checkAddRemoveState(e),RM.analytics&&RM.analytics.sendEvent("Font Explorer Add/Remove from Library",i)},checkAddRemoveState:function(t){var e=Object(n.a)(t.target||t),i=RM.constructorRouter.fonts.getUsedFontsCache()[e.attr("data-font-id")],o=i&&!i.hidden;e.toggleClass("removable",!!o),e.hasClass("info-add-remove-font")&&e.text(o?"Remove from Font Selector":"Add to Font Selector")},closeInfo:function(){this.$(".font-explorer-wrapper").removeClass("info-mode")},onFontItemMouseDown:function(){this.fontItemMouseDown=!0},onFontItemMouseMove:function(){this.fontItemMouseDown&&(this.preventFontItemClick=!0)},onFontItemMouseUp:function(){this.fontItemMouseDown=!1},openInfo:function(t){if(this.preventFontItemClick)this.preventFontItemClick=!1;else{var e=Object(n.a)(t.target).closest(".font-item");this.$(".font-explorer-wrapper").addClass("info-mode"),this.$infoList.empty();var i=this,o=e.attr("data-font-provider"),a=e.attr("data-font-id"),c=e.attr("data-font-name"),d={};"typekit"==o&&(d={id:a}),"webtype"==o&&(d={name:a}),"google"==o&&(d={family:a}),"typetoday"==o&&(d={name:a});var h,u,p,g=s.a.findWhere(this.fontsData[o],d),m="google"==o?"Google Fonts":g.foundry,f="google"==o?"http://www.google.com/fonts/specimen/"+c.split(" ").join("+"):g.web_link,v=g.description,b=g.variations,_=e.attr("data-img1"),y=e.attr("data-img2"),w=Object(n.a)('<a target="_blank" href="'+g.web_link+'">More...</a>');u=g.subsets||g.browse_info&&g.browse_info.language||[],u=s.a.map(u,(function(t){return r.default.capitalize(i.LANGUAGE_NAMES[t]||t)}));for(var k=Object(n.a)(".font-info .language-wrapper .language"),S=Object(n.a)(".font-info .language-clamp"),x=u.length;x>0&&(h=u.slice(0,x).join(", "),!(x==u.length&&(S.empty().text(h),S.height()<=k.height())))&&(S.empty().text(h+", ").append(w),!(S.height()<=k.height()));x--);p=g.browse_info&&g.browse_info.recommended_for||[],p=(p=s.a.map(p,(function(t){return r.default.capitalize(i.LANGUAGE_NAMES[t]||t)}))).join(" & ");for(x=0;x<b.length;x++){var C=Object(n.a)(this.itemTemplate({img1:"",img2:"",text:l.a.getCustomVariationNameByFVD(g.name,b[x])||this.FVD_NAMES[b[x]],name:"",id:"",styles:"",provider:"",Utils:r.default})),O=this.IMGS_URL+"list_"+_.substr(0,_.length-2)+b[x]+y;C.css("background-image",'url("'+O+'")'),this.$infoList.append(C),C.attr("data-loaded",!0)}this.infoScroll.recalc();var P=this.$(".right-panel .font-info"),j=Object(n.a)(".bottom-info .info-add-remove-font",P);Object(n.a)(".name",P).text(c),Object(n.a)(".foundry",P).toggleClass("hidden",!m),Object(n.a)(".foundry a",P).text(m).attr("href",f),Object(n.a)(".description-wrapper",P).toggleClass("hidden",!v),Object(n.a)(".description-wrapper .description",P).text(v),Object(n.a)(".description-wrapper .more",P).attr("href",f),Object(n.a)(".language-wrapper",P).toggleClass("hidden",!h),Object(n.a)(".recommended-wrapper",P).toggleClass("hidden",!p),Object(n.a)(".recommended-wrapper .recommended",P).text(p),Object(n.a)(".promo",P).toggleClass("hidden","typetoday"!==o),Object(n.a)(".promo a",P).attr("href",g.web_link);var $=Object(n.a)(".description-wrapper .description",P);Object(n.a)(".description-wrapper",P).toggleClass("huge",$.height()==parseInt($.css("max-height"),10)),j.attr("data-font-provider",o).attr("data-font-id",a).attr("data-font-name",c),this.checkAddRemoveState(j)}},toggleLanguage:function(t){var e=Object(n.a)(t.currentTarget);Object(n.a)(t.target).closest(".filter.language").length||e.toggleClass("active")},closeLanguage:function(t){Object(n.a)(t.target).closest(".language-wrapper").length||this.$(".language-wrapper").removeClass("active")},updateLangs:function(t){var e=t.find("div.active"),i=[];e.each((function(){i.push(Object(n.a)(this).text())})),t.closest(".language-wrapper").find(".caption").text(i.length?i.join(", "):"Language Support")},onFilterMouseEnter:function(t){var e=Object(n.a)(t.target);if(e.attr("data-alt")){var i=e.parent().prevAll(".filter-caption").first();i.text(e.attr("data-alt")),clearTimeout(i.data("clear-timer"))}},onFilterMouseLeave:function(t){var e=Object(n.a)(t.target);if(e.attr("data-alt")){var i=e.parent().prevAll(".filter-caption").first();i.data("clear-timer",setTimeout((function(){i.text(i.attr("data-initial"))}),100))}},onSizeLetterClick:function(t){var e=Object(n.a)(t.target),i=this.sizeSlider.slider("value"),o=e.hasClass("top-letter")?1:-1;this.sizeSlider.slider("value",i+o)},onBodyKey:function(t){this.$(".search-input").is(":focus")||(t.keyCode!=n.a.keycodes.esc&&t.keyCode!=n.a.keycodes.backspace||(t.preventDefault(),t.stopPropagation()),"keyup"==t.type&&(t.keyCode==n.a.keycodes.esc&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():this.hide()),t.keyCode==n.a.keycodes.backspace&&(this.$(".font-explorer-wrapper").hasClass("info-mode")?this.closeInfo():this.hide()),t.keyCode==n.a.keycodes.f&&this.toggleSearch()))},onMouseWheel:function(t){t&&t.stopPropagation(),t&&t.preventDefault()},disableMouseWheel:function(){Object(n.a)(document).bind("mousewheel",this.onMouseWheel)},enableMouseWheel:function(){Object(n.a)(document).unbind("mousewheel",this.onMouseWheel)},show:function(){if(!this.rendered)return this.render(),void s.a.defer(this.show);this.disableMouseWheel(),this.$block_layer=RM.constructorRouter.showBlockLayer(this.hide),this.$el.removeClass("show-out").addClass("show-in").css("display","block"),setTimeout(s.a.bind((function(){this.$el.removeClass("show-in")}),this),20),setTimeout(s.a.bind((function(){this.$el.css("width","+=1")}),this),300),setTimeout(s.a.bind((function(){this.$el.css("width","-=1")}),this),300),Object(n.a)("body").on("keypress keyup keydown",this.onBodyKey),this.shown=!0},hide:function(t){t&&t.stopPropagation(),this.enableMouseWheel(),RM.constructorRouter.hideBlockLayer(this.$block_layer),Object(n.a)("body").off("keypress keyup keydown",this.onBodyKey),this.$el.addClass("show-out"),setTimeout(s.a.bind((function(){this.$el.css("display","none")}),this),200),r.default.getFocusBack(),this.$(".language-wrapper").removeClass("active"),RM.constructorRouter.fonts.clearTempFonts(),this.shown=!1},toggle:function(){this.shown?this.hide():this.show(),this.trigger("toggle")}}),f=i("o3C3"),v=i.n(f),b=i("YqYG");RM.views.fontExplorer=new m;var _=a.a.View.extend({name:"FontSelector",initialize:function(t){this.model=RM.constructorRouter.fonts,this.settings={},this.old_fonts=[],s.a.bindAll(this),s.a.extend(this.settings,t),this.mag=RM.constructorRouter.mag.toJSON(),this.settings.canUploadFonts=RM.constructorRouter.isOwner?(RM.constructorRouter.me.get("permissions")||{}).can_use_custom_fonts:this.mag.user.permissions.can_use_custom_fonts,this.settings.canEditCustomFonts=this.mag.doesUserHaveAccess,this.template=v.a["template-constructor-helpers-font-selector"],this.item_template=v.a["template-constructor-helpers-font-selector-item"],this.create()},create:function(){this.render(),this.switchToCategory(this.model.get("fonts_tab")||"custom"),this.model.on("change:fonts",this.onFontsChange)},render:function(){var t=this.settings.css&&this.settings.css.left||0,e=this.settings.css&&this.settings.css.top||0;this.setElement(Object(n.a)(this.template({})).css({display:"none",left:t,top:e})),this.settings.$parent.append(this.$el),this.$addFontPopup=this.$(".add-font-popup"),this.$el.on("click",".tabs-switcher .caption-system",s.a.bind((function(){this.switchToCategory("system"),RM.analytics&&RM.analytics.sendEvent("Font Selector Switch to Category","system")}),this)),this.$el.on("click",".tabs-switcher .caption-custom",s.a.bind((function(){this.switchToCategory("custom"),RM.analytics&&RM.analytics.sendEvent("Font Selector Switch to Category","custom")}),this)),this.$el.on("click",this.onGlobalClickHandler),this.$el.on("mouseenter",".category-element .caption",this.checkTitleShowForLongFontName),this.$el.on("click",".category-element .edit-custom-font",this.onEditCustomFontClick),this.$el.on("click",".add-font-button",this.onAddFontButtonClick),this.onFontsChange(),this.scroll={system:this.createScroll("system"),custom:this.createScroll("custom")},this.settings.canEditCustomFonts||this.$(".add-font-button[data-type=upload]").remove()},onFontsChange:function(){var t=this.old_fonts,e=this.model.get("fonts"),i=s.a.map(t,(function(t){return t.provider+"|"+t.css_name})),o=s.a.map(e,(function(t){return t.provider+"|"+t.css_name})),a=this;clearTimeout(this.reinitTimeout);var r=s.a.difference(o,i),l=s.a.difference(i,o),c=s.a.intersection(i,o);s.a.each(r,(function(t){var e=t.split("|"),i=e[0],o=e[1],s=a.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),r=a.model.findFontByCSSName(o),l=a.model.getProviderData(i),c=Object(n.a)(a.item_template({provider_data:l,font:r,canUploadFonts:a.settings.canUploadFonts,canEditCustomFonts:a.settings.canEditCustomFonts})).addClass("collapsed");if(setTimeout((function(){c.removeClass("collapsed")}),15),0==s.find(".category-element").length)c.appendTo(s);else{var d=!1;s.find(".category-element").each((function(){var t=Object(n.a)(this);if(t.find(".caption").text().toLowerCase()>r.name.toLowerCase())return c.insertBefore(t),d=!0,!1})),d||c.appendTo(s)}})),s.a.each(l,(function(t){var e=t.split("|"),i=e[0],n=e[1],o=a.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),s=(a.model.findFontByCSSName(n),a.model.getProviderData(i),o.find('.category-element[data-provider="'+i+'"][data-css_name="'+n+'"]'));s.addClass("collapsed"),setTimeout((function(){s.remove()}),300)})),s.a.each(c,(function(t){var e=t.split("|"),i=e[0],n=e[1],o=a.$(".categories .scroll-wrapper."+("system"==i?"system":"custom")+" .category"),s=a.model.findFontByCSSName(n),r=o.find('.category-element[data-provider="'+i+'"][data-css_name="'+n+'"]');r.toggleClass("hidden",!!s.hidden).find(".caption").text(s.name),s.hidden&&r.removeClass("active")})),this.old_fonts=s.a.cloneWithObjects(e),this.reinitTimeout=setTimeout(this.reinitScrolls,250)},checkTitleShowForLongFontName:function(t){var e=t.currentTarget,i=Object(n.a)(e);e.offsetWidth<e.scrollWidth&&!i.attr("title")&&i.attr("title",i.text())},onEditCustomFontClick:function(t){var e=Object(n.a)(t.currentTarget).closest(".category-element").attr("data-css_name"),i=this.model.get("fonts"),o=s.a.findWhere(i,{css_name:e});this.showFontUploadPanel(o),RM.analytics&&RM.analytics.sendEvent("Font Selector Edit Custom Font")},scrollFontsToActive:function(t,e){var i=this.$(".categories .scroll-wrapper."+t),n=this.$(".categories .scroll-wrapper."+t+" .category-wrapper"),o=n.find(".category-element.active").eq(0),a=!0;if(1==o.length){i.is(":visible")||(i.css("display","block"),a=!1);var s=o.position().top,r=o.height(),l=n.height(),c=Math.floor(s-(l-r)/2);a?n.stop().animate({scrollTop:c},e):(n.stop().scrollTop(c),i.css("display","none"))}},reinitScrolls:function(){s.a.each(this.scroll,(function(t){t.recalc()}))},createScroll:function(t){var e=Object(n.a)(this.$(".categories .scroll-wrapper."+t));return e.RMScroll({$container:e.find(".category-wrapper"),$content:e.find(".category-wrapper .category"),$handle:e.find(".scroll"),gap_start:8,gap_end:8}).data("scroll")},onGlobalClickHandler:function(t){var e=Object(n.a)(t.target),i=e.closest(".category-element"),o=i.attr("data-css_name");if(e.hasClass("action")&&e.parent().hasClass("category-element")){var a,s;!RM.constructorRouter.isOwner&&this.settings.canEditCustomFonts&&(a=this.mag.user._id,s=this.mag.num_id),this.model.changeFontHidden(o,!i.hasClass("hidden"),a,s).error&&new p({$parent:e});var r=i.hasClass("hidden")?"delete":"restore";RM.analytics&&RM.analytics.sendEvent("Font Selector Edit List",r)}if(e.hasClass("caption")&&e.parent().hasClass("category-element")){if(i.hasClass("disabled"))return void(i.hasClass("personal")&&this.showUpgradeAlert({type:"type-upload-fonts"},"use custom font"));this.setActiveFont([o]),this.trigger("selectfont",o)}this.isAddFontPopupVisible&&!e.closest(".add-font").length&&this.toggleAddFontPopup()},setActiveFont:function(t,e){this.$(".categories .category-element").removeClass("active"),s.a.each(t,s.a.bind((function(t){this.$('.categories .category-element[data-css_name="'+t+'"]').addClass("active")}),this)),void 0!==e&&(this.scrollFontsToActive("system",e),this.scrollFontsToActive("custom",e))},show:function(t){this._initialTab=this.model.get("fonts_tab"),this._initialFonts=this.model.get("fonts"),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("fontselector")})),this.$el.fadeIn(150),this.setActiveFont(t,0),this.reinitScrolls(),RM.analytics&&RM.analytics.sendEvent("Font Selector Show")},hide:function(t){this.$el.fadeOut(150),(this._initialTab||this._initialFonts)&&(s.a.isEqual(this.model.get("fonts_tab"),this._initialTab)&&s.a.isEqual(this.model.get("fonts"),this._initialFonts)||this.model.save({},{silent:!0}))},switchToCategory:function(t){"system"!=t&&"custom"!=t&&(t="custom"),this.model.set({fonts_tab:t},{silent:!0}),this.$(".tabs-switcher .caption-"+t).addClass("active").siblings().removeClass("active"),"system"==t?this.$(".add-font").stop().fadeOut():this.$(".add-font").stop().fadeIn();var e=this.$(".categories > div:visible").eq(0),i=this.$(".categories .scroll-wrapper."+t);if(!e.is(i)){if(0==e.length)i.css("display","block");else{var n=e.index()<i.index()?1:-1;i.css({display:"block",opacity:0,"margin-left":8*n}).animate({opacity:1,"margin-left":0},300),e.animate({opacity:0,"margin-left":-8*n},300,(function(){this.setAnimation=!1,e.css("display","none")}))}this.reinitScrolls()}},toggleAddFontPopup:function(){this.$addFontPopup.toggleClass("invisible",!!this.isAddFontPopupVisible),this.isAddFontPopupVisible=!this.isAddFontPopupVisible},onAddFontButtonClick:function(t){switch(Object(n.a)(t.currentTarget).attr("data-type")){case"library":this.toggleFontExplorer();break;case"upload":this.canUploadFonts()&&this.showFontUploadPanel()}},canUploadFonts:function(){return this.settings.canUploadFonts||this.showUpgradeAlert({type:"type-upload-fonts"},"upload font"),this.settings.canUploadFonts},showUpgradeAlert:function(t,e){s.a.extend(t,{is_contributor:!RM.constructorRouter.isOwner,owner_email:RM.constructorRouter.mag.get("user").email}),this.alertDuplicate=this.alertDuplicate||new b.default({$parent:Object(n.a)("body > .popups"),router:RM.constructorRouter,opts:t,alert_source:e}),this.alertDuplicate.render()},toggleFontExplorer:function(){RM.views.fontExplorer.toggle()},showFontUploadPanel:function(t){var e=this.$(".upload-font");this.fontUploader=new y({el:e,allFonts:this.model,fontParams:t,mag:this.mag}),this.fontUploader.show(),this.listenTo(this.fontUploader,"hide-font",function(t){var e=t.css_name;this.$(".category-element[data-css_name="+e+"]").find(".action").click()}.bind(this)),this.listenTo(this.fontUploader,"update-font",function(t){var e=t.css_name;this.trigger("selectfont",e)}.bind(this)),this.listenToOnce(this.fontUploader,"hide",function(){this.stopListening(this.fontUploader),this.fontUploader=null,this.isFontUploaderVisible=!1}.bind(this)),this.isFontUploaderVisible=!0},handleEscape:function(){return this.isFontUploaderVisible&&this.fontUploader.handleEscape()||!this.isFontUploaderVisible},destroy:function(){this.fontuploader&&this.fontuploader.remove(),this.fontuploader=null,this.model.off("change:fonts",this.onFontsChange),this.hide(),this.$el.remove()}}),y=a.a.View.extend({className:"upload-font",template:v.a["template-constructor-helpers-font-selector-upload"],templateWeights:v.a["template-constructor-helpers-font-selector-upload-weights"],events:{"keydown .font-name-input":"onFontNameKeydown","input .font-name-input":"onFontNameInput","click .uf-section.actions .done:not(.disabled)":"hide","click .button.add-weight:not(.disabled)":"onAddWeightClick","click .weight-item:not(.disabled)":"onWeightItemClick","click .button.select":"onSelectButtonClick","click .uf-panel.weights .delete-weight":"onDeleteWeightClick"},WEIGTS:g.WEIGHTS,SAVE_URL:"/api/customfonts",initialize:function(t){s.a.bindAll(this),s.a.extend(this,t);var e=a.a.Model.extend({urlRoot:this.SAVE_URL,idAttribute:"_id",defaults:{is_personal:!0}});t.fontParams=t.fontParams||{};var i=s.a.omit(t.fontParams,"variations"),n=s.a.map(t.fontParams.variations||[],(function(t){return{type:t}}));this.isNew=s.a.isEmpty(i),this.model=new e(i||{}),this.weights=new a.a.Collection(n),this.weights.comparator=function(t){var e=t.get("type");return e.slice(1)+e[0].replace("n","1").replace("i","2")},this.weights.sort()},render:function(t){this.$el.html(Object(n.a)(this.template(this.model.toJSON()))),this.$buttonAddWeight=this.$(".button.add-weight"),this.$buttonSelect=this.$(".button.select"),this.$buttonUpload=this.$(".button.upload"),this.$buttonDone=this.$(".uf-section.actions .done"),this.$fileUploader=Object(n.a)("#font-file-upload"),this.listenTo(this.weights,"add remove",this.renderVariations),this.listenTo(this.weights,"change",this.updateVariation),this.bindMainFileupload();var e=Object(n.a)(this.$(".uf-panel.weights .scroll-wrapper"));this.weightScroll=e.RMScroll({$container:e.find(".results-wrapper"),$content:e.find(".results"),$handle:e.find(".scroll"),gap_start:8,gap_end:88}).data("scroll"),this.renderVariations()},renderVariations:function(){this.$(".uf-panel.weights .list").html(this.templateWeights({weights:this.weights.toJSON(),names:this.WEIGTS,isUploadInProgress:s.a.findWhere(this.weights,{isUploading:!0}),_:s.a})),this.updateWeightSelector(),this.bindWeightFileuploads(),this.weightScroll.recalc()},updateVariation:function(t){var e=t.get("type"),i=this.$(".uf-panel.weights .weight[data-type="+e+"]");i.find(".name").text(this.WEIGTS[e]),i.find(".reupload-weight").toggleClass("animate",!!t.get("isUploading")),this.$(".delete-weight").toggleClass("disabled",!!t.get("isUploading")),this.$(".uf-panel.weights .list").toggleClass("uploading",!!t.get("isUploading")),this.$buttonAddWeight.toggleClass("disabled",!!t.get("isUploading"))},updateWeightSelector:function(){s.a.each(s.a.keys(this.WEIGTS),function(t){var e=!!this.weights.findWhere({type:t});this.$(".weight-item[data-var="+t+"]").toggleClass("disabled",e)}.bind(this))},bindMainFileupload:function(){Object(n.a)(this.$fileUploader).fileupload({dataType:"json",fileInput:this.$fileUploader,paramName:"upload",dropZone:this.$el,singleFileUploads:!0,acceptFileTypes:/(\.|\/)(woff)$/i,pasteZone:null,add:this.onUploadAdd,start:this.onUploadStart,done:this.onUploadDone,fail:this.onUploadFail,always:this.onUploadComplete}).bind("fileuploaddragover",function(t){if("uploader"!==this.currentPanel)return!1;clearTimeout(this.dragoverTimeout),this.dragoverTimeout=setTimeout(function(){this.$el.removeClass("file-dragover")}.bind(this),300),this.$el.hasClass("file-dragover")||this.$el.addClass("file-dragover")}.bind(this)).bind("fileuploaddrop",function(t,e){if("uploader"!==this.currentPanel)return!1}.bind(this))},bindWeightFileuploads:function(){this.reUploadXHR&&this.reUploadXHR.abort(),Object(n.a)(this.$(".uf-panel.weights .font-file-re-upload")).fileupload({dataType:"json",fileInput:this.$buttons,paramName:"upload",singleFileUploads:!0,acceptFileTypes:/(\.|\/)(woff)$/i,pasteZone:null,add:this.onReuploadEvent,start:this.onReuploadEvent,done:this.onReuploadEvent,fail:this.onReuploadEvent,always:this.onReuploadEvent})},onReuploadEvent:function(t,e){var i=Object(n.a)(t.target).closest(".weight").attr("data-type"),o=this.weights.findWhere({type:i});if(o)switch(t.type){case"fileuploadadd":if(!this.checkFile(e))return;this.reUploadXHR=e.submit();break;case"fileuploadstart":o.set("isUploading",!0);break;case"fileuploaddone":o.set("woff",e.result.woffUrl),this.saveFont();break;case"fileuploadalways":o.set("isUploading",!1)}},onUploadAdd:function(t,e){this.checkFile(e)&&(this.uploadXHR=e.submit())},checkFile:function(t){return/\.woff$/i.test((t.files||[{}])[0].name)},onUploadStart:function(t,e){var i=new a.a.Model({type:this.selectedVar});this.weights.add(i),i.set("isUploading",!0),this.switchToPanel("weights"),this.$buttonAddWeight.addClass("disabled"),RM.analytics&&RM.analytics.sendEvent("Font Selector Custom Font Panel Upload Weight")},onUploadDone:function(t,e){this.weights.findWhere({type:this.selectedVar}).set("woff",e.result.woffUrl),this.saveFont()},onUploadFail:function(t,e){var i=this.weights.findWhere({type:this.selectedVar});this.weights.remove(i)},onUploadComplete:function(t,e){var i=this.weights.findWhere({type:this.selectedVar});i&&i.set("isUploading",!1),this.$buttonAddWeight.removeClass("disabled")},show:function(){Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("fontuploader")})),this.render(),this.switchToPanel("weights"),this.onFontNameInput(),s.a.defer(function(){this.$el.removeClass("invisible"),s.a.delay(function(){this.isNew&&this.$(".font-name-input").focus(),this.weightScroll.recalc()}.bind(this),200)}.bind(this)),RM.analytics&&RM.analytics.sendEvent("Font Selector Show Custom Font Panel")},hide:function(t){this.uploadXHR&&this.uploadXHR.abort(),this.reUploadXHR&&this.reUploadXHR.abort(),this.$el.addClass("invisible"),this.undelegateEvents(),s.a.delay(function(){this.$el.empty(),this.trigger("hide")}.bind(this),200)},onFontNameKeydown:function(t){var e=this.$(".font-name-input").val().trim();t.keyCode==n.a.keycodes.enter&&e&&e!==this.model.get("name")&&this.saveFont()},onFontNameInput:function(){var t=this.$(".font-name-input").val().trim();this.$(".uf-section.weight-list").toggleClass("invisible",!t),this.$buttonDone.toggleClass("disabled",!t)},switchToPanel:function(t){this.currentPanel=t,this.$(".uf-panel."+t).removeClass("invisible").siblings(".uf-panel").addClass("invisible")},hidePanel:function(t){this.$(".uf-panel"+t).removeClass("invisible").siblings(".uf-panel").addClass("invisible")},onAddWeightClick:function(){this.switchToPanel("selector")},onWeightItemClick:function(t){var e=Object(n.a)(t.currentTarget);this.selectedVar=e.attr("data-var"),this.$buttonSelect.text(this.WEIGTS[this.selectedVar]),this.switchToPanel("uploader"),RM.analytics&&RM.analytics.sendEvent("Font Selector Custom Font Panel Select Weight",this.WEIGTS[this.selectedVar])},onSelectButtonClick:function(t){this.switchToPanel("selector")},onDeleteWeightClick:function(t){var e=Object(n.a)(t.currentTarget).closest(".weight"),i=e.attr("data-type"),o=this.weights.findWhere({type:i});if(!e.hasClass("uploading"))return!this.isNew&&this.weights.length<2?(this.model.get("hidden")||this.trigger("hide-font",{css_name:this.model.get("css_name")}),void this.hide()):void s.a.defer(function(){this.weights.remove(o),this.saveFont()}.bind(this));this.uploadXHR&&this.uploadXHR.abort()},handleEscape:function(){return"weights"!==this.currentPanel?this.switchToPanel("weights"):this.hide(),!1},saveFont:function(){var t=this.$(".font-name-input"),e=t.val().trim()||this.model.get("name"),i=this.weights.map((function(t){return s.a.pick(t.toJSON(),"type","woff")}));if(e&&i.length){var n={name:e,variations:i,is_personal:!0};!RM.constructorRouter.isOwner&&this.mag.doesUserHaveAccess&&(n.mag_user=this.mag.user._id,n.mag_num_id=this.mag.num_id),this.model.save(n,{url:this.SAVE_URL,success:function(e){this.isNew=!1;var i=s.a.pluck(e.get("variations"),"type");this.weights.reset(e.get("variations")),t.val(e.get("name"));var n=this.model.get("css_name");this.allFonts.addFonts([{provider:"custom",css_name:n,css_url:this.model.get("css_url"),signed_css_url:this.model.get("signed_css_url"),name:this.model.get("name"),variations:i,is_personal:!0,_id:this.model.get("_id")}],"font-upload"),this.trigger("update-font",{css_name:n})}.bind(this)})}},destroy:function(){}});e.a=_},avvt:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("Rh5U"),l=i.n(r),c=i("0sUV"),d=i("OTSC"),h=i("tZHv"),u=i("DqjY"),p=i("3eHG"),g=i("5ta/"),m=i("rVpV"),f=i("roQd"),v=i("gobI"),b=i("38JW"),_=i("v92f"),y=i("gdoY"),w=i("HwMs"),k=i("ubkq"),S=i.n(k),x=i("QNiq"),C=i("i7aS"),O=i("Kf/z"),P=i("phNm"),j=i("BrCd"),$=i.n(j),T=function(t,e){return new Intl.NumberFormat(window.navigator.language||"en-US",{style:"currency",currency:e}).format(t)},I=[{value:"AF",caption:"Afghanistan"},{value:"AX",caption:"Aland Islands"},{value:"AL",caption:"Albania"},{value:"DZ",caption:"Algeria"},{value:"AS",caption:"American Samoa"},{value:"AD",caption:"Andorra"},{value:"AO",caption:"Angola"},{value:"AI",caption:"Anguilla"},{value:"AQ",caption:"Antarctica"},{value:"AG",caption:"Antigua and Barbuda"},{value:"AR",caption:"Argentina"},{value:"AM",caption:"Armenia"},{value:"AW",caption:"Aruba"},{value:"AU",caption:"Australia"},{value:"AT",caption:"Austria"},{value:"AZ",caption:"Azerbaijan"},{value:"BS",caption:"Bahamas"},{value:"BH",caption:"Bahrain"},{value:"BD",caption:"Bangladesh"},{value:"BB",caption:"Barbados"},{value:"BY",caption:"Belarus"},{value:"BE",caption:"Belgium"},{value:"BZ",caption:"Belize"},{value:"BJ",caption:"Benin"},{value:"BM",caption:"Bermuda"},{value:"BT",caption:"Bhutan"},{value:"BO",caption:"Bolivia, Plurinational State of"},{value:"BQ",caption:"Bonaire, Sint Eustatius and Saba"},{value:"BA",caption:"Bosnia and Herzegovina"},{value:"BW",caption:"Botswana"},{value:"BV",caption:"Bouvet Island"},{value:"BR",caption:"Brazil"},{value:"IO",caption:"British Indian Ocean Territory"},{value:"BN",caption:"Brunei Darussalam"},{value:"BG",caption:"Bulgaria"},{value:"BF",caption:"Burkina Faso"},{value:"BI",caption:"Burundi"},{value:"KH",caption:"Cambodia"},{value:"CM",caption:"Cameroon"},{value:"CA",caption:"Canada"},{value:"CV",caption:"Cape Verde"},{value:"KY",caption:"Cayman Islands"},{value:"CF",caption:"Central African Republic"},{value:"TD",caption:"Chad"},{value:"CL",caption:"Chile"},{value:"CN",caption:"China"},{value:"CX",caption:"Christmas Island"},{value:"CC",caption:"Cocos (Keeling) Islands"},{value:"CO",caption:"Colombia"},{value:"KM",caption:"Comoros"},{value:"CG",caption:"Congo"},{value:"CD",caption:"Congo, the Democratic Republic of the"},{value:"CK",caption:"Cook Islands"},{value:"CR",caption:"Costa Rica"},{value:"CI",caption:"Côte d'Ivoire"},{value:"HR",caption:"Croatia"},{value:"CU",caption:"Cuba"},{value:"CW",caption:"Curaçao"},{value:"CY",caption:"Cyprus"},{value:"CZ",caption:"Czech Republic"},{value:"DK",caption:"Denmark"},{value:"DJ",caption:"Djibouti"},{value:"DM",caption:"Dominica"},{value:"DO",caption:"Dominican Republic"},{value:"EC",caption:"Ecuador"},{value:"EG",caption:"Egypt"},{value:"SV",caption:"El Salvador"},{value:"GQ",caption:"Equatorial Guinea"},{value:"ER",caption:"Eritrea"},{value:"EE",caption:"Estonia"},{value:"ET",caption:"Ethiopia"},{value:"FK",caption:"Falkland Islands (Malvinas)"},{value:"FO",caption:"Faroe Islands"},{value:"FJ",caption:"Fiji"},{value:"FI",caption:"Finland"},{value:"FR",caption:"France"},{value:"GF",caption:"French Guiana"},{value:"PF",caption:"French Polynesia"},{value:"TF",caption:"French Southern Territories"},{value:"GA",caption:"Gabon"},{value:"GM",caption:"Gambia"},{value:"GE",caption:"Georgia"},{value:"DE",caption:"Germany"},{value:"GH",caption:"Ghana"},{value:"GI",caption:"Gibraltar"},{value:"GR",caption:"Greece"},{value:"GL",caption:"Greenland"},{value:"GD",caption:"Grenada"},{value:"GP",caption:"Guadeloupe"},{value:"GU",caption:"Guam"},{value:"GT",caption:"Guatemala"},{value:"GG",caption:"Guernsey"},{value:"GN",caption:"Guinea"},{value:"GW",caption:"Guinea-Bissau"},{value:"GY",caption:"Guyana"},{value:"HT",caption:"Haiti"},{value:"HM",caption:"Heard Island and McDonald Islands"},{value:"VA",caption:"Holy See (Vatican City State)"},{value:"HN",caption:"Honduras"},{value:"HK",caption:"Hong Kong"},{value:"HU",caption:"Hungary"},{value:"IS",caption:"Iceland"},{value:"IN",caption:"India"},{value:"ID",caption:"Indonesia"},{value:"IR",caption:"Iran, Islamic Republic of"},{value:"IQ",caption:"Iraq"},{value:"IE",caption:"Ireland"},{value:"IM",caption:"Isle of Man"},{value:"IL",caption:"Israel"},{value:"IT",caption:"Italy"},{value:"JM",caption:"Jamaica"},{value:"JP",caption:"Japan"},{value:"JE",caption:"Jersey"},{value:"JO",caption:"Jordan"},{value:"KZ",caption:"Kazakhstan"},{value:"KE",caption:"Kenya"},{value:"KI",caption:"Kiribati"},{value:"KP",caption:"Korea, Democratic People's Republic of"},{value:"KR",caption:"Korea, Republic of"},{value:"KW",caption:"Kuwait"},{value:"KG",caption:"Kyrgyzstan"},{value:"LA",caption:"Lao People's Democratic Republic"},{value:"LV",caption:"Latvia"},{value:"LB",caption:"Lebanon"},{value:"LS",caption:"Lesotho"},{value:"LR",caption:"Liberia"},{value:"LY",caption:"Libya"},{value:"LI",caption:"Liechtenstein"},{value:"LT",caption:"Lithuania"},{value:"LU",caption:"Luxembourg"},{value:"MO",caption:"Macao"},{value:"MK",caption:"Macedonia, the Former Yugoslav Republic of"},{value:"MG",caption:"Madagascar"},{value:"MW",caption:"Malawi"},{value:"MY",caption:"Malaysia"},{value:"MV",caption:"Maldives"},{value:"ML",caption:"Mali"},{value:"MT",caption:"Malta"},{value:"MH",caption:"Marshall Islands"},{value:"MQ",caption:"Martinique"},{value:"MR",caption:"Mauritania"},{value:"MU",caption:"Mauritius"},{value:"YT",caption:"Mayotte"},{value:"MX",caption:"Mexico"},{value:"FM",caption:"Micronesia, Federated States of"},{value:"MD",caption:"Moldova, Republic of"},{value:"MC",caption:"Monaco"},{value:"MN",caption:"Mongolia"},{value:"ME",caption:"Montenegro"},{value:"MS",caption:"Montserrat"},{value:"MA",caption:"Morocco"},{value:"MZ",caption:"Mozambique"},{value:"MM",caption:"Myanmar"},{value:"NA",caption:"Namibia"},{value:"NR",caption:"Nauru"},{value:"NP",caption:"Nepal"},{value:"NL",caption:"Netherlands"},{value:"NC",caption:"New Caledonia"},{value:"NZ",caption:"New Zealand"},{value:"NI",caption:"Nicaragua"},{value:"NE",caption:"Niger"},{value:"NG",caption:"Nigeria"},{value:"NU",caption:"Niue"},{value:"NF",caption:"Norfolk Island"},{value:"MP",caption:"Northern Mariana Islands"},{value:"NO",caption:"Norway"},{value:"OM",caption:"Oman"},{value:"PK",caption:"Pakistan"},{value:"PW",caption:"Palau"},{value:"PS",caption:"Palestine, State of"},{value:"PA",caption:"Panama"},{value:"PG",caption:"Papua New Guinea"},{value:"PY",caption:"Paraguay"},{value:"PE",caption:"Peru"},{value:"PH",caption:"Philippines"},{value:"PN",caption:"Pitcairn"},{value:"PL",caption:"Poland"},{value:"PT",caption:"Portugal"},{value:"PR",caption:"Puerto Rico"},{value:"QA",caption:"Qatar"},{value:"RE",caption:"Réunion"},{value:"RO",caption:"Romania"},{value:"RU",caption:"Russian Federation"},{value:"RW",caption:"Rwanda"},{value:"BL",caption:"Saint Barthélemy"},{value:"SH",caption:"Saint Helena, Ascension and Tristan da Cunha"},{value:"KN",caption:"Saint Kitts and Nevis"},{value:"LC",caption:"Saint Lucia"},{value:"MF",caption:"Saint Martin (French part)"},{value:"PM",caption:"Saint Pierre and Miquelon"},{value:"VC",caption:"Saint Vincent and the Grenadines"},{value:"WS",caption:"Samoa"},{value:"SM",caption:"San Marino"},{value:"ST",caption:"Sao Tome and Principe"},{value:"SA",caption:"Saudi Arabia"},{value:"SN",caption:"Senegal"},{value:"RS",caption:"Serbia"},{value:"SC",caption:"Seychelles"},{value:"SL",caption:"Sierra Leone"},{value:"SG",caption:"Singapore"},{value:"SX",caption:"Sint Maarten (Dutch part)"},{value:"SK",caption:"Slovakia"},{value:"SI",caption:"Slovenia"},{value:"SB",caption:"Solomon Islands"},{value:"SO",caption:"Somalia"},{value:"ZA",caption:"South Africa"},{value:"GS",caption:"South Georgia and the South Sandwich Islands"},{value:"SS",caption:"South Sudan"},{value:"ES",caption:"Spain"},{value:"LK",caption:"Sri Lanka"},{value:"SD",caption:"Sudan"},{value:"SR",caption:"Suriname"},{value:"SJ",caption:"Svalbard and Jan Mayen"},{value:"SZ",caption:"Swaziland"},{value:"SE",caption:"Sweden"},{value:"CH",caption:"Switzerland"},{value:"SY",caption:"Syrian Arab Republic"},{value:"TW",caption:"Taiwan, Province of China"},{value:"TJ",caption:"Tajikistan"},{value:"TZ",caption:"Tanzania, United Republic of"},{value:"TH",caption:"Thailand"},{value:"TL",caption:"Timor-Leste"},{value:"TG",caption:"Togo"},{value:"TK",caption:"Tokelau"},{value:"TO",caption:"Tonga"},{value:"TT",caption:"Trinidad and Tobago"},{value:"TN",caption:"Tunisia"},{value:"TR",caption:"Turkey"},{value:"TM",caption:"Turkmenistan"},{value:"TC",caption:"Turks and Caicos Islands"},{value:"TV",caption:"Tuvalu"},{value:"UG",caption:"Uganda"},{value:"UA",caption:"Ukraine"},{value:"AE",caption:"United Arab Emirates"},{value:"GB",caption:"United Kingdom"},{value:"US",caption:"United States"},{value:"UM",caption:"United States Minor Outlying Islands"},{value:"UY",caption:"Uruguay"},{value:"UZ",caption:"Uzbekistan"},{value:"VU",caption:"Vanuatu"},{value:"VE",caption:"Venezuela, Bolivarian Republic of"},{value:"VN",caption:"Viet Nam"},{value:"VG",caption:"Virgin Islands, British"},{value:"VI",caption:"Virgin Islands, U.S."},{value:"WF",caption:"Wallis and Futuna"},{value:"EH",caption:"Western Sahara"},{value:"YE",caption:"Yemen"},{value:"ZM",caption:"Zambia"},{value:"ZW",caption:"Zimbabwe"}],E=i("3ED2"),M=i.n(E),R=i("+IKJ"),A=i("Vxjr");function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function L(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){z(a,n,o,s,r,"next",t)}function r(t){z(a,n,o,s,r,"throw",t)}s(void 0)}))}}function B(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function F(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?B(Object(i),!0).forEach((function(e){N(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):B(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function N(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var U,H,V,W,G,q,K,X,Y,Z,J,Q,tt,et,it=h.a.stripe_live?h.a.STRIPE_LIVE_PUBLIC_KEY:h.a.STRIPE_TEST_PUBLIC_KEY,nt=Backbone.View.extend({template:$.a["template-viewer-cart-sidebar"],cardStyle:{base:{letterSpacing:"0.3px",color:"#0080FF",fontSize:"16px",fontFamily:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Ubuntu, 'Fira Sans', Roboto, 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif","::placeholder":{color:"#CFD7DF"},fontSmoothing:"antialiased"},invalid:{color:"#e5424d",":focus":{color:"#303238"}}},getRenderStatus:function(){return this.rendered},initialize:function(t){return s.a.bindAll(this),this.mag=t,this.environment=this.mag.router.environment,this.rendered=!1,this.haveSkus=!1,this.havePrices=!1,this.checkoutCompete=!1,this.isHiddenSettings=!0,this.activeTab="tab-items",this.orderLoading=!1,this.paymentLoading=!1,this.hoveredItem=null,this.shippingForm={name:{value:null,error:null,validationRules:[{title:"required"}]},phone:{value:null,error:null,validationRules:[{title:"phoneNumber"}]},line1:{value:null,error:null,validationRules:[{title:"required"}]},line2:{value:null,error:null,validationRules:[]},city:{value:null,error:null,validationRules:[{title:"required"}]},state:{value:null,error:null,validationRules:[]},country:{value:"default",error:null,validationRules:[{title:"required",func:function(t,e){return"default"===e?"field is required":null}}]},postal_code:{value:null,error:null,validationRules:[]},email:{value:null,error:null,validationRules:[{title:"required"},{title:"email"}]},note:{value:null,error:null,validationRules:[]}},this.cardHolderNameValue=null,this.clearShippingFormField_debounced=s.a.debounce(this.clearShippingFormField,200),this.render(),this},render:function(){var t=this;if(!RM.screenshot){var e=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");if(e&&e.can_use_e_commerce&&!this.mag.eCommerceManager.isConstructor()&&this.mag.eCommerceManager.haveEcommerceCartWidget&&this.mag.eCommerceManager.isMagConnectedToStripe()&&!this.rendered){this.rendered=!0,document.querySelectorAll("#cart-sidebar").length&&document.querySelectorAll("#cart-sidebar").forEach((function(t){return t.parentNode.removeChild(t)})),this.setElement(this.template({})),this.$el.appendTo(Object(n.a)("body")),this.$toolbar=Object(n.a)(".toolbar.for-viewer"),this.$tabs=this.$el.find(".cart-sidebar-tabs"),this.$items=this.$el.find(".cart-items-list"),this.$closeButton=this.$el.find(".close-button"),this.$footer=this.$el.find(".sidebar-footer"),this.$navButtons=this.$el.find(".sidebar-btn"),this.$itemsTab=this.$tabs.find(".tab-items"),this.$shippingTab=this.$tabs.find(".tab-inputs"),this.$orderTab=this.$tabs.find(".tab-order"),this.$paymentTab=this.$tabs.find(".tab-checkout"),this.$goToPayment=this.$orderTab.find(".cart-pay-btn"),this.$orderDetails=this.$orderTab.find(".order-details"),this.$orderItems=this.$orderTab.find(".order-items-list"),this.$orderError=this.$orderTab.find(".order-error"),this.$orderShippingAddress=this.$orderTab.find(".order-shipping-address"),this.$orderShippingMethod=this.$orderTab.find(".order-shipping-method"),this.$orderShippingEmail=this.$orderTab.find(".order-shipping-email"),this.$orderTax=this.$orderTab.find(".order-tax"),this.$orderTotalPrice=this.$orderTab.find(".order-total-price"),this.$paymentSuccess=this.$tabs.find("#payment-success-msg"),this.$paymentFailed=this.$tabs.find("#payment-failed-msg"),this.cartWidgetData=this.mag.eCommerceManager.getCartWidgetData(),this.environment===h.a.environment.preview&&(this.cartWidgetData&&this.cartWidgetData._id&&this.setupSettingsPanel(),RM.views.toolbar.on("previewClose",(function(){t.hideSidebar()})));var i=this.$el.find(".svg");return M()(i),this.$el.find("[data-alt]:not(.rmalttext)").RMAltText(),this.generateSidebarCSS(this.cartWidgetData),this.renderCartItems(),this.renderShippingForm(),this.initNavigation(),this.bindDomEvents(),this.mag.eCommerceManager.events.on("ecommerce:cartsidebar:visibility:changed",this.toggleSidebar),this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderCartItems),this}}},bindDomEvents:function(){this.$closeButton.on("click",this.closeSideBar.bind(this)),this.$tabs.find(".cart-cancel-btn").on("click",this.cancelOrder.bind(this)),Object(n.a)(document).on("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),Object(n.a)(document).on("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},unbindDomEvents:function(){this.$closeButton.off("click",this.closeSideBar),this.$tabs.find(".cart-cancel-btn").off("click",this.cancelOrder),Object(n.a)(document).off("mouseover",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockHover),Object(n.a)(document).off("mouseleave",".cart-sidebar .sidebar-body .cart-item-block",this.cartItemBlockLeave)},hideSidebar:function(){this.$el.removeClass("show"),Object(n.a)("body").removeClass("cart-sidebar-shown"),Object(n.a)("html").removeClass("cart-disable-scroll"),!this.isHiddenSettings&&this.settingsPanel&&(this.isHiddenSettings=!0,this.settingsPanel.isHidden=this.isHiddenSettings)},toggleSidebar:function(t){t?(this.hideSidebar(),this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.clearOrderError()):(this.$el.addClass("show"),Object(n.a)("body").addClass("cart-sidebar-shown"),Object(n.a)("html").addClass("cart-disable-scroll"))},closeSideBar:function(){this.mag.eCommerceManager.changeCartSidebarVisibility()},initNavigation:function(){this.$tabs.find("[data-tab^='tab-']").each(function(t,e){Object(n.a)(e).on("click",function(){if(this.haveSkus&&this.havePrices)window.alert("You can't buy all these products, try separately");else if(this.haveSkus||this.havePrices){if("tab-inputs"===e.dataset.tab&&(this.updateShippingForm(),RM.analytics&&RM.analytics.sendEvent("Checkout 1st step completed")),"tab-order"===e.dataset.tab){if(!this.validateShippingForm())return void this.renderShippingFormErrors();this.clearShippingFormErrors(),RM.analytics&&RM.analytics.sendEvent("Checkout 2nd step completed");var t,i,n=this.mag.eCommerceManager.getShippingForm();n&&(t=s.a.mapObject(n,(function(t){return{value:t.value}})),i=s.a.mapObject(this.shippingForm,(function(t){return{value:t.value}}))),(!n||n&&!s.a.isEqual(t,i))&&(this.mag.eCommerceManager.setShippingForm(this.shippingForm),this.havePrices&&(this.needForUpdateCustomer=!0)),this.haveSkus&&this.renderOrderTab(),this.havePrices&&this.renderOrderTabForPrices()}"tab-checkout"===e.dataset.tab&&(RM.analytics&&RM.analytics.sendEvent("Checkout 3rd step completed"),this.haveSkus&&this.renderCheckoutForm(),this.havePrices&&this.renderCheckoutFormPaymentIntent()),this.goToTabByClassname("."+e.dataset.tab)}}.bind(this))}.bind(this))},goToTabByClassname:function(t){this.$tabs.find(".cart-sidebar-tab").each((function(t,e){Object(n.a)(e).removeClass("active")})),this.$tabs.find(t).addClass("active"),this.activeTab=t.slice(1)},goToInitialTab:function(){this.goToTabByClassname(".tab-items")},generateSidebarCSS:function(t){var e="cart_sidebar_styles_".concat(t._id),i=d.default.getRGBA(t["bar-color"],t["bar-color-opacity"]/100),o=d.default.getRGBA(t["bar-background-color"],t["bar-background-color-opacity"]/100),a=d.default.getRGBA(t["bar-color"],.45*t["bar-color-opacity"]/100),s=this.getAdditionalColor(o);this.cardStyle=F(F({},this.cardStyle),{},{base:F(F({},this.cardStyle.base),{},{color:i,fontWeight:t["bar-font-weight"],"::placeholder":{color:a}}),invalid:F(F({},this.cardStyle.invalid),{},{color:a,fontWeight:t["bar-font-weight"],":focus":{color:i},"::placeholder":{color:a}})});var r="    .cart-sidebar {\n\n      color: ".concat(i,";\n      background-color: ").concat(o,";\n      box-shadow: ").concat(t["bar-shadow"]?"0 0 4px rgba(124, 124, 125, 0.5)":"none",";\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar textarea {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar input {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar button {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar select {\n\n      font-family: ").concat(t["bar-font-family"],";\n      font-weight: ").concat(t["bar-font-weight"],";\n      font-style: ").concat(t["bar-font-style"],";\n    }\n\n    .cart-sidebar .sidebar-btn {\n\n      color: ").concat(i,";\n      border-color: ").concat(a,";\n    }\n\n    .cart-sidebar .preloader svg path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-btn path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .expand-arrow svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .cart-cancel-btn {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block.hover {\n\n      background-color: ").concat(s,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-attributes {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-price {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-items-quantity {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-remove-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-decrease-btn-icon rect {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .cart-item-block .cart-item-increase-btn-icon path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form, .cart-sidebar .sidebar-body .order-details-form .form-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-input::placeholder {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-fake-select.selected {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form svg path {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .form-title {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .form-error {\n\n      background-color: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-body .order-details-form .rm-native-select-popup {\n\n      background-color: ").concat(s,";\n    }\n\n    .cart-sidebar .tab-order .order-details .order-title-row {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .tab-order .order-details .rm-native-fake-select {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input {\n\n      color: ").concat(i,";\n    }\n\n    .cart-sidebar .tab-checkout .payment-input::placeholder {\n\n      color: ").concat(a,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon {\n\n      border-color: ").concat(a,";\n    }\n\n    .cart-sidebar .tab-checkout #payment-failed-msg .error-icon svg g {\n\n      fill: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-footer .power-by-stripe path {\n\n      fill: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-footer-mobile .power-by-stripe path {\n\n      fill: ").concat(a,";\n    }\n\n    .cart-sidebar .sidebar-footer .settings-button path {\n\n      stroke: ").concat(i,";\n    }\n\n    .cart-sidebar .sidebar-footer .settings-button:hover path {\n\n      stroke: ").concat(a,";\n    }\n\n    .isphone .cart-sidebar .sidebar-body .cart-item-block {\n\n      background-color: ").concat(s,";\n    }");Object(n.a)("#".concat(e)).remove();var l=document.createElement("style");l.type="text/css",l.id=e,l.className="cart-sidebar-styles",l.appendChild(document.createTextNode(r)),document.querySelector("head").appendChild(l)},getAdditionalColor:function(t){return Object(R.c)(t)<.05&&Object(R.b)("#fff",t)-Object(R.b)("#000",t)>=8?Object(R.d)(.1,t):Object(R.a)(.1,t)},renderCartItems:function(){var t=this.mag.eCommerceManager.getCartData();if(t&&t.skus){var e=Object.keys(t.skus),i=Object.keys(t.prices);this.$items.empty(),this.haveSkus=!!e.length,this.havePrices=!!i.length,this.haveSkus||this.havePrices?(this.$itemsTab.find(".sidebar-header").css("display","flex"),this.$itemsTab.find(".empty-cart").css("display","none")):(this.$itemsTab.find(".sidebar-header").css("display","none"),this.$itemsTab.find(".empty-cart").css("display","flex")),this.renderPricesCartItems(i),this.renderSkusCartItems(e);var n=this.$items.find(".svg");M()(n)}},renderCartItem:function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"price",o=this.hoveredItem===t.id,a=Object(n.a)("<div/>",{class:"cart-item-block".concat(o?" hover":"")});a.data("".concat(i,"-id"),t.id);var s=t.image||t.productObject.images&&t.productObject.images.length;if(s){var r=t.image?t.image:t.productObject.images?t.productObject.images[0]:"";e=Object(n.a)("<div/>",{class:"cart-item-image",css:{"background-position":"center center","background-size":"cover","background-repeat":"no-repeat","background-image":"url(".concat(r,")")}}),a.append(e)}var l,c=Object(n.a)("<div/>",{class:e?"cart-item-title":"cart-item-title without-image"}).text(t.productObject.name),h=t.cart_count,u=(("price"===i?t.unit_amount:t.price)/100).toFixed(2),p=T(u,t.currency),g=T((u*h).toFixed(2),t.currency),m=Object(n.a)("<div/>",{class:"cart-item-price"}).html(h>1?"Price: ".concat(p," × ").concat(h," = ").concat(g):"Price: ".concat(p));if("sku"===i){l=Object(n.a)("<div/>",{class:"cart-item-attributes"});var f=t.attributes;for(var v in f){var b=Object(n.a)("<div/>",{class:"cart-item-attribute"}).html("".concat(d.default.capitalize(v),": ").concat(f[v]));l.append(b)}}var _=Object(n.a)("<div/>",{class:"cart-items-quantity"}).html("Quantity: ".concat(h)),y=Object(n.a)("<div/>",{class:"cart-item-remove-btn",title:"remove"}).attr("data-".concat(i,"-id"),t.id),w=Object(n.a)("<img/>",{class:"svg cart-item-remove-btn-icon",src:Object(A.findImagePath)("./viewer/cart-sidebar/cart-item-delete.svg")});y.append(w),y.on("click",this.onRemoveItem);var k=Object(n.a)("<div/>",{class:"cart-item-edit-group"}),S=Object(n.a)("<div/>",{class:"cart-item-increase-btn"}).attr("data-".concat(i,"-id"),t.id),x=Object(n.a)("<img/>",{class:"svg cart-item-increase-btn-icon",src:Object(A.findImagePath)("./viewer/cart-sidebar/cart-item-increase.svg")});if(S.append(x),k.append(S),("price"===i||this.mag.eCommerceManager.checkItemQuantity(t.id))&&(S.addClass("active"),S.on("click",this.onIncreaseItem)),h>1){var C=Object(n.a)("<div/>",{class:"cart-item-decrease-btn decrease-btn-".concat(t.id)}).attr("data-".concat(i,"-id"),t.id),O=Object(n.a)("<img/>",{class:"svg cart-item-decrease-btn-icon",src:Object(A.findImagePath)("./viewer/cart-sidebar/cart-item-decrease.svg")});C.append(O),k.append(C),C.on("click",this.onDecreaseItem)}else{var P=this.$items.find("decrease-btn-".concat(t.id));P.off("click",this.onDecreaseItem),P.remove()}"price"===i?a.append(c).append(m).append(_).append(y).append(k):a.append(c).append(l).append(m).append(_).append(y).append(k),this.$items.append(a)},renderPricesCartItems:function(t){var e=this,i=this.mag.eCommerceManager.getCartData();t.forEach((function(t){var n=i.prices[t];n.active&&e.renderCartItem(n)}))},renderSkusCartItems:function(t){var e=this,i=this.mag.eCommerceManager.getCartData();t.forEach((function(t){var n=i.skus[t];n.active&&e.renderCartItem(n,"sku")}))},onRemoveItem:function(t){t.currentTarget.dataset.priceId?this.mag.eCommerceManager.removeFromCart(t.currentTarget.dataset.priceId):t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.removeSkuFromCart(t.currentTarget.dataset.skuId)},onIncreaseItem:function(t){t.currentTarget.dataset.priceId?this.mag.eCommerceManager.increaseCartItem(t.currentTarget.dataset.priceId):t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.increaseSkuCartItem(t.currentTarget.dataset.skuId)},onDecreaseItem:function(t){t.currentTarget.dataset.priceId?this.mag.eCommerceManager.decreaseCartItem(t.currentTarget.dataset.priceId):t.currentTarget.dataset.skuId&&this.mag.eCommerceManager.decreaseSkuCartItem(t.currentTarget.dataset.skuId)},renderShippingForm:(et=L(regeneratorRuntime.mark((function t(){var e,o,a,r,l,c,d,h,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=s.a.clone(I)).unshift({value:"default",caption:"Country"}),o=this.mag.eCommerceManager.getCartData(),(a=o.shippingForm)&&"object"===D(a)&&(this.shippingForm=a),t.next=7,i.e(6).then(i.bind(null,"h9wM"));case 7:return r=t.sent,l=r.default,t.next=11,Promise.resolve().then(i.bind(null,"Kw5r"));case 11:c=t.sent,d=c.default,h=d.extend(l),this.countrySelect=new h({el:this.$tabs.find(".countries-select").get(0),propsData:{options:function(){return e},value:this.shippingForm.country.value,isDesktop:!1,callback:this.onCountryChange}}),this.mag.eCommerceManager.hasShippableProducts()?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden"),this.$tabs.find(".order-details-form .form-input").each((function(t,e){var i=e.getAttribute("name");u.shippingForm[i]&&(e.value=u.shippingForm[i].value),Object(n.a)(e).on("input",u.onShippingFormChange)}));case 17:case"end":return t.stop()}}),t,this)}))),function(){return et.apply(this,arguments)}),updateShippingForm:function(){var t=this.mag.eCommerceManager.getShippingForm();t&&"object"===D(t)&&(this.shippingForm=t),this.mag.eCommerceManager.hasShippableProducts()?this.$shippingTab.find(".shipping-form").removeClass("hidden"):this.$shippingTab.find(".shipping-form").addClass("hidden")},onCountryChange:function(t){this.shippingForm.country.value=t,this.countrySelect.value=t,this.clearShippingFormField_debounced("country")},onShippingFormChange:function(t){var e=t.target.getAttribute("name");void 0!==this.shippingForm[e]&&"object"===D(this.shippingForm[e])&&(this.shippingForm[e].value=t.target.value,this.clearShippingFormField_debounced(e))},renderShippingFormErrors:function(){var t=this;Object.keys(this.shippingForm).forEach((function(e){t.shippingForm[e].error&&t.$shippingTab.find(".form-error.".concat(e,"-error")).removeClass("hidden")}))},clearShippingFormErrors:function(){var t=this;Object.keys(this.shippingForm).forEach((function(e){t.$tabs.find(".form-error.".concat(e,"-error")).addClass("hidden")}))},clearShippingFormField:function(t){if(void 0!==this.shippingForm[t]&&this.shippingForm[t].error){var e=this.validateShippingFormField(t);e&&e.success&&(this.$tabs.find(".form-error.".concat(t,"-error")).addClass("hidden"),this.shippingForm[t].error=null)}},validateShippingFormField:function(t){var e=this,i=[];if(void 0!==this.shippingForm[t])return this.shippingForm[t].validationRules.length?(this.shippingForm[t].validationRules.forEach((function(n){if("function"==typeof n.func){var o=n.func(t,e.shippingForm[t].value);o&&i.push(o)}else{var a=e["".concat(n.title,"Validation")](t,e.shippingForm[t].value);a&&i.push(a)}})),i.length?{success:!1,error:!0,errorMessages:i}:{success:!0}):{success:!0}},requiredValidation:function(t,e){return e?null:"field is required"},emailValidation:function(t,e){return e?d.default.isValidEmail(e)?null:"it's not email":null},phoneNumberValidation:function(t,e){return e?d.default.isValidPhoneNumber(e)?null:"it's not  phone number":null},validateShippingForm:function(){var t=!1;if(this.mag.eCommerceManager.hasShippableProducts())for(var e in this.shippingForm){var i=this.validateShippingFormField(e);i&&(i.success?this.shippingForm[e].error=null:(this.shippingForm[e].error=i.errorMessages,t=!0))}else{var n=this.validateShippingFormField("email");n&&(n.success?this.shippingForm.email.error=null:(this.shippingForm.email.error=n.errorMessages,t=!0))}return!t},renderOrderTab:function(){var t=this;this.clearOrderError();var e=this.mag.eCommerceManager.getCartData(),i=e.order;if(i&&i.created<Math.floor(Date.parse(e.changed)/1e3))return this.showOrderLoader(),void this.mag.eCommerceManager.cancelOrder().then((function(e){e.data&&"canceled"===e.data.status&&(t.mag.eCommerceManager.deleteOrder(),t.createOrder())})).catch((function(e){t.hideOrderLoader(),t.renderOrderError(e&&e.message?e.message:""),t.mag.eCommerceManager.deleteOrder()}));i?this.renderOrderDetails():this.createOrder()},renderOrderTabForPrices:(tt=L(regeneratorRuntime.mark((function t(){var e,i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.clearOrderError(),this.showOrderLoader(),t.next=4,this.getCustomer();case 4:if(!(e=t.sent)){t.next=42;break}return t.next=8,this.getInvoiceItemsForCustomer(e.id);case 8:if(!t.sent){t.next=42;break}return t.next=12,this.getInvoiceForCustomer(e.id);case 12:if(!(i=t.sent)){t.next=42;break}if(!(i.created<Math.floor(Date.parse(this.mag.eCommerceManager.getCartData().changed)/1e3))){t.next=41;break}if(!this.needForUpdateCustomer){t.next=19;break}return t.next=18,this.updateOrCreateCustomer();case 18:this.needForUpdateCustomer=!1;case 19:return t.prev=19,t.next=22,this.cancelInvoice(i);case 22:t.next=29;break;case 24:return t.prev=24,t.t0=t.catch(19),this.renderOrderError("can't cancel old order"),this.hideOrderLoader(),t.abrupt("return");case 29:return t.prev=29,t.next=32,this.createInvoiceWithItems();case 32:(n=t.sent)&&this.renderInvoiceDetails(n),t.next=39;break;case 36:t.prev=36,t.t1=t.catch(29),this.renderOrderError("can't create order");case 39:t.next=42;break;case 41:this.renderInvoiceDetails(i);case 42:this.hideOrderLoader();case 43:case"end":return t.stop()}}),t,this,[[19,24],[29,36]])}))),function(){return tt.apply(this,arguments)}),renderInvoiceDetails:(Q=L(regeneratorRuntime.mark((function t(e){var i,o,a,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.$orderItems.empty(),this.$orderShippingAddress.empty(),this.$orderShippingMethod.empty(),this.$orderShippingEmail.empty(),this.$orderTax.empty(),this.$orderTotalPrice.empty(),e.lines.data.forEach((function(t){var e=Object(n.a)("<div/>",{class:"order-item"}).html(t.quantity+" × "+t.description),i=Object(n.a)("<div/>",{class:"order-item-price"}).text(T((t.amount/100).toFixed(2),t.currency));e.append(i),s.$orderItems.append(e)})),e.customer_shipping&&e.customer_shipping.address&&(i=function(t){return t?" ".concat(t):""},o=e.customer_shipping.address,a="".concat(o.line1).concat(i(o.line2)," ").concat(o.city,",").concat(i(o.state)).concat(i(o.postal_code)," ").concat(o.country),this.$orderShippingAddress.text(a),this.$tabs.find(".shipping-details").removeClass("hidden")),this.$orderShippingMethod.parent(".shipping-method.order-row").addClass("hidden"),this.$orderDetails.find(".order-id").text(String(e.id).slice(0,20)+"..."),this.$orderShippingEmail.text(e.customer_email),this.$orderDetails.find(".shipping-email").removeClass("hidden"),e.customer_phone?(this.$orderDetails.find(".order-shipping-phone").text(e.customer_phone),this.$orderDetails.find(".shipping-phone").removeClass("hidden")):this.$orderDetails.find(".shipping-phone").addClass("hidden"),e.tax?(this.$orderTax.parent(".shipping-tax-size.order-row").removeClass("hidden"),this.$orderTax.text(T((e.tax/100).toFixed(2),e.currency))):this.$orderTax.parent(".shipping-tax-size.order-row").addClass("hidden"),this.$orderTotalPrice.text(T((e.total/100).toFixed(2),e.currency)),this.$goToPayment.removeClass("hidden");case 16:case"end":return t.stop()}}),t,this)}))),function(t){return Q.apply(this,arguments)}),getCustomer:(J=L(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=this.mag.eCommerceManager.getCartData()).customer){t.next=17;break}return t.prev=2,t.next=5,this.mag.eCommerceManager.createOrUpdateCustomer(this.mag.num_id,this.generateCustomerDataFromShippingForm(e.shippingForm));case 5:if(!(i=t.sent)||!i.data){t.next=9;break}return this.mag.eCommerceManager.setCustomer(i.data),t.abrupt("return",i.data);case 9:t.next=15;break;case 11:throw t.prev=11,t.t0=t.catch(2),console.error(t.t0),t.t0;case 15:t.next=18;break;case 17:return t.abrupt("return",e.customer);case 18:case"end":return t.stop()}}),t,this,[[2,11]])}))),function(){return J.apply(this,arguments)}),updateOrCreateCustomer:(Z=L(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.mag.eCommerceManager.getCartData(),t.next=3,this.mag.eCommerceManager.createOrUpdateCustomer(this.mag.num_id,this.generateCustomerDataFromShippingForm(e.shippingForm));case 3:if(!(i=t.sent)||!i.data){t.next=7;break}return this.mag.eCommerceManager.setCustomer(i.data),t.abrupt("return",i.data);case 7:case"end":return t.stop()}}),t,this)}))),function(){return Z.apply(this,arguments)}),generateCustomerDataFromShippingForm:function(t){var e={email:t.email.value,name:t.name.value,shipping:{address:{country:t.country.value,city:t.city.value,line1:t.line1.value},name:t.name.value}};return t.phone.value&&(e.phone=t.phone.value,e.shipping.phone=t.phone.value),t.line2.value&&(e.shipping.address.line2=t.line2.value),t.postal_code.value&&(e.shipping.address.postal_code=t.postal_code.value),t.state.value&&(e.shipping.address.state=t.state.value),e},getInvoiceItemsForCustomer:(Y=L(regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((i=this.mag.eCommerceManager.getCartData()).invoiceItems&&i.invoiceItems.length>0)){t.next=5;break}return t.abrupt("return",i.invoiceItems);case 5:return t.next=7,this.createInvoiceItemsForCustomer(e);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),function(t){return Y.apply(this,arguments)}),createInvoiceItemsForCustomer:(X=L(regeneratorRuntime.mark((function t(e){var i,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.mag.eCommerceManager.getCartData(),n=Object.keys(i.prices).map((function(t){return{price:i.prices[t].id,quantity:i.prices[t].cart_count}})),t.prev=2,t.next=5,this.mag.eCommerceManager.createInvoiceItems(this.mag.num_id,e,n);case 5:if(!((o=t.sent)&&o.data&&o.data.length)){t.next=9;break}return this.mag.eCommerceManager.setInvoiceItems(o.data),t.abrupt("return",o.data);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.error(t.t0);case 14:case"end":return t.stop()}}),t,this,[[2,11]])}))),function(t){return X.apply(this,arguments)}),getInvoiceForCustomer:(K=L(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i=this.mag.eCommerceManager.getCartData()).invoice||!i.invoice.id){t.next=15;break}return t.next=4,this.mag.eCommerceManager.getInvoice(this.mag.num_id,i.invoice.id);case 4:if(!(n=t.sent)||"draft"!==n.status&&"open"!==n.status){t.next=10;break}return this.mag.eCommerceManager.setInvoice(n),t.abrupt("return",n);case 10:return t.next=12,this.createInvoiceForCustomer(e);case 12:return t.abrupt("return",t.sent);case 13:t.next=18;break;case 15:return t.next=17,this.createInvoiceForCustomer(e);case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t,this)}))),function(t){return K.apply(this,arguments)}),createInvoiceForCustomer:(q=L(regeneratorRuntime.mark((function t(e){var i,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.mag.eCommerceManager.getCartData(),n={customer:e,collection_method:"charge_automatically",auto_advance:!1},i.shippingForm&&i.shippingForm.note.value&&(n.metadata={customer_note:i.shippingForm.note.value}),t.prev=3,t.next=6,this.mag.eCommerceManager.createInvoice(this.mag.num_id,n);case 6:if(!(o=t.sent)||!o.data){t.next=10;break}return this.mag.eCommerceManager.setInvoice(o.data),t.abrupt("return",o.data);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),t.t0&&t.t0.type===P.c.nothingToInvoice&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab());case 15:case"end":return t.stop()}}),t,this,[[3,12]])}))),function(t){return q.apply(this,arguments)}),createInvoiceWithItems:(G=L(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCustomer();case 2:return e=t.sent,t.next=5,this.createInvoiceItemsForCustomer(e.id);case 5:return t.next=7,this.createInvoiceForCustomer(e.id);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),function(){return G.apply(this,arguments)}),cancelInvoice:(W=L(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("draft"!==e.status){t.next=5;break}return t.next=3,this.mag.eCommerceManager.deleteDraftInvoice(this.mag.num_id,e.id);case 3:t.next=8;break;case 5:if("open"!==e.status&&"uncollectible"!==e.status){t.next=8;break}return t.next=8,this.mag.eCommerceManager.voidDraftInvoice(this.mag.num_id,e.id);case 8:this.mag.eCommerceManager.unsetInvoiceItems(),this.mag.eCommerceManager.unsetInvoice();case 10:case"end":return t.stop()}}),t,this)}))),function(t){return W.apply(this,arguments)}),createOrder:function(){this.showOrderLoader(),this.mag.eCommerceManager.updateCartData().then(function(){var t=this,e=this.generateOrderRequestData();e&&e instanceof Error?this.renderOrderError(e.message):e&&e.currency&&n.a.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){t.hideOrderLoader(),e&&e.data&&(t.mag.eCommerceManager.setOrder(e.data),t.renderOrderDetails())},error:function(e){var i=JSON.parse(e.responseText);t.hideOrderLoader(),t.renderOrderError(i.message)}})}.bind(this)).catch(function(t){this.hideOrderLoader(),t&&t.message&&this.renderOrderError(t.message)}.bind(this))},showOrderLoader:function(){this.orderLoading||(this.orderLoading=!0,this.$goToPayment.hasClass("hidden")||this.$goToPayment.addClass("hidden"),this.$orderTab.find(".preloader").addClass("show"),this.$orderDetails.addClass("hidden"))},hideOrderLoader:function(){this.orderLoading&&(this.orderLoading=!1,this.$goToPayment.hasClass("hidden")&&this.$goToPayment.removeClass("hidden"),this.$orderTab.find(".preloader").removeClass("show"),this.$orderDetails.removeClass("hidden"))},renderOrderDetails:(V=L(regeneratorRuntime.mark((function t(){var e,o,a,s,r,l,c,d,h,u,p,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.mag.eCommerceManager.getOrder(),this.$orderItems.empty(),this.$orderShippingAddress.empty(),this.$orderShippingMethod.empty(),this.$orderShippingEmail.empty(),this.$orderTax.empty(),this.$orderTotalPrice.empty(),e.items.forEach(function(t){if("tax"===t.type)o=t;else if("shipping"===t.type)a=t;else{var e=Object(n.a)("<div/>",{class:"order-item"}).html(t.quantity+" × "+t.description),i=Object(n.a)("<div/>",{class:"order-item-price"}).text(T((t.amount/100).toFixed(2),t.currency));e.append(i),this.$orderItems.append(e)}}.bind(this)),e.shipping?(s=function(t){return t?" ".concat(t):""},r=e.shipping.address,l="".concat(r.line1).concat(s(r.line2)," ").concat(r.city,",").concat(s(r.state)).concat(s(r.postal_code)," ").concat(r.country),this.$orderShippingAddress.text(l),this.$tabs.find(".shipping-details").removeClass("hidden")):this.$tabs.find(".shipping-details").addClass("hidden"),!(e.shipping_methods.length>1)){t.next=23;break}return c=this.shippingMethodsOptions(e.shipping_methods),t.next=13,i.e(6).then(i.bind(null,"h9wM"));case 13:return d=t.sent,h=d.default,t.next=17,Promise.resolve().then(i.bind(null,"Kw5r"));case 17:u=t.sent,p=u.default,g=p.extend(h),this.shippingMethodSelect?(this.shippingMethodSelect.options=function(){return c},this.shippingMethodSelect.value=a.parent):this.shippingMethodSelect=new g({el:this.$orderShippingMethod.get(0),propsData:{options:function(){return c},value:a.parent,isDesktop:!1,callback:this.onShippingMethodChange}}),t.next=25;break;case 23:this.$orderShippingMethod.parent(".shipping-method.order-row").removeClass("hidden"),this.$orderShippingMethod.text(a.description+" "+T((a.amount/100).toFixed(2),a.currency));case 25:this.$orderDetails.find(".order-id").text(String(e.id).slice(0,20)+"..."),e.email?(this.$orderShippingEmail.text(e.email),this.$orderDetails.find(".shipping-email").removeClass("hidden")):this.$orderDetails.find(".shipping-email").addClass("hidden"),e.phone?(this.$orderDetails.find(".order-shipping-phone").text(e.phone),this.$orderDetails.find(".shipping-phone").removeClass("hidden")):this.$orderDetails.find(".shipping-phone").addClass("hidden"),o&&(this.$orderTax.parent(".shipping-tax-size.order-row").removeClass("hidden"),this.$orderTax.text(o.description+" "+T((o.amount/100).toFixed(2),o.currency))),this.$orderTotalPrice.text(T((e.amount/100).toFixed(2),e.currency)),this.$goToPayment.removeClass("hidden");case 31:case"end":return t.stop()}}),t,this)}))),function(){return V.apply(this,arguments)}),shippingMethodsOptions:function(t){return t.map((function(t){return{value:t.id,caption:t.description+" "+T((t.amount/100).toFixed(2),t.currency)}}))},onShippingMethodChange:function(t){var e=this;this.shippingMethodSelect.value=t,this.showOrderLoader(),this.mag.eCommerceManager.changeShippingMethod(t).then((function(t){e.hideOrderLoader(),t.data&&(e.mag.eCommerceManager.setOrder(t.data),e.renderOrderDetails())})).catch((function(){e.hideOrderLoader()}))},renderOrderError:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$orderError.find(".order-error-message").text(t),this.$orderError.removeClass("hidden"),this.$orderDetails.addClass("hidden"),this.$goToPayment.addClass("hidden")},clearOrderError:function(){this.$orderError.addClass("hidden"),this.$orderDetails.removeClass("hidden"),this.$goToPayment.removeClass("hidden")},transformShippingFormToOrderRequest:function(){var t=this.checkShippableInCart(),e={currency:"usd",email:this.shippingForm.email.value,items:[]};return this.shippingForm.note.value&&(e.metadata={note:this.shippingForm.note.value}),t?(e.shipping={name:this.shippingForm.name.value,phone:this.shippingForm.phone.value,address:{line1:this.shippingForm.line1.value,line2:this.shippingForm.line2.value,city:this.shippingForm.city.value,state:this.shippingForm.state.value,country:this.shippingForm.country.value,postal_code:this.shippingForm.postal_code.value}},e):e},generateOrderRequestData:function(){var t=this.mag.eCommerceManager.getCartData();if(!t||!t.skus)return new Error("Empty cart");var e=[],i=this.transformShippingFormToOrderRequest();for(var n in t.skus)t.skus[n].active&&(i.items.push({type:t.skus[n].object,parent:n,currency:t.skus[n].currency,quantity:t.skus[n].cart_count}),-1===e.indexOf(t.skus[n].currency)&&e.push(t.skus[n].currency));return e.length>1?new Error("mixed currencies"):(i.currency=e.pop(),i)},cancelOrder:function(){var t=this;if(this.showPaymentLoader(),this.havePrices){var e=this.mag.eCommerceManager.getCartData();e.invoice&&this.cancelInvoice(e.invoice).then((function(){t.hidePaymentLoader(),t.goToTabByClassname(".tab-items")})).catch((function(){t.hidePaymentLoader()}))}else this.mag.eCommerceManager.cancelOrder().then((function(e){t.hidePaymentLoader(),e.data&&"canceled"===e.data.status&&(t.mag.eCommerceManager.deleteOrder(),t.goToTabByClassname(".tab-items"))})).catch((function(){t.hidePaymentLoader()}))},renderCheckoutFormPaymentIntent:(H=L(regeneratorRuntime.mark((function t(){var e,i,n,o,a,s,r,l,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.mag.eCommerceManager.getCustomer()){t.next=4;break}return this.$paymentFailed.text("Customer not found"),t.abrupt("return");case 4:return t.next=6,this.getInvoiceForCustomer(e.id);case 6:if(i=t.sent){t.next=10;break}return this.$paymentFailed.text("Invoice not found"),t.abrupt("return");case 10:if(n=this.mag.eCommerceManager.getCartData(),this.showPaymentLoader(),"draft"!==i.status){t.next=27;break}return t.next=15,this.mag.eCommerceManager.finalizeInvoice(this.mag.num_id,i.id);case 15:return o=t.sent,this.mag.eCommerceManager.setInvoice(o),t.next=19,this.mag.eCommerceManager.getPaymentIntent(this.mag.num_id,o.payment_intent);case 19:if((a=t.sent).receipt_email){t.next=23;break}return t.next=23,this.mag.eCommerceManager.updatePaymentIntent(this.mag.num_id,a.id,{receipt_email:n.shippingForm.email.value});case 23:this.clientSecret=a.client_secret,this.hidePaymentLoader(),t.next=36;break;case 27:if("open"!==i.status){t.next=36;break}return t.next=30,this.mag.eCommerceManager.getPaymentIntent(this.mag.num_id,i.payment_intent);case 30:if((s=t.sent).receipt_email){t.next=34;break}return t.next=34,this.mag.eCommerceManager.updatePaymentIntent(this.mag.num_id,s.id,{receipt_email:n.shippingForm.email.value});case 34:this.clientSecret=s.client_secret,this.hidePaymentLoader();case 36:r=this.mag.eCommerceManager.getStripeConnectedUserId(),this.stripe||(this.stripe=Stripe(it,{stripeAccount:r})),l=this.stripe.elements(),this.cardNumber||(this.cardNumber=l.create("cardNumber",{style:this.cardStyle,placeholder:"Card number"}),this.cardNumber.mount("#card-number-element"),this.cardNumber.addEventListener("change",(function(t){var e=c.$paymentTab.find(".card-number-error");t.error?e.removeClass("hidden"):e.addClass("hidden")})),this.cardNumber.addEventListener("ready",(function(t){c.renderCartHolderInput()}))),this.cardExpiry||(this.cardExpiry=l.create("cardExpiry",{style:this.cardStyle,placeholder:"M/Y"}),this.cardExpiry.mount("#card-expiry-element"),this.cardExpiry.addEventListener("change",(function(t){var e=c.$paymentTab.find(".card-expiry-error");t.error?e.removeClass("hidden"):e.addClass("hidden")}))),this.cardCvc||(this.cardCvc=l.create("cardCvc",{style:this.cardStyle,placeholder:"Security code"}),this.cardCvc.mount("#card-cvc-element"),this.cardCvc.addEventListener("change",(function(t){var e=c.$paymentTab.find(".card-cvc-error");t.error?e.removeClass("hidden"):e.addClass("hidden")}))),this.form||(this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",this.onPaymentFormSubmit.bind(this)));case 43:case"end":return t.stop()}}),t,this)}))),function(){return H.apply(this,arguments)}),renderCheckoutForm:function(){var t=this,e=this.mag.eCommerceManager.getStripeConnectedUserId();this.stripe||(this.stripe=Stripe(it,{stripeAccount:e}));var i=this.stripe.elements();this.cardNumber||(this.cardNumber=i.create("cardNumber",{style:this.cardStyle,placeholder:"Card number"}),this.cardNumber.mount("#card-number-element"),this.cardNumber.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-number-error");e.error?i.removeClass("hidden"):i.addClass("hidden")})),this.cardNumber.addEventListener("ready",(function(e){t.renderCartHolderInput()}))),this.cardExpiry||(this.cardExpiry=i.create("cardExpiry",{style:this.cardStyle,placeholder:"M/Y"}),this.cardExpiry.mount("#card-expiry-element"),this.cardExpiry.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-expiry-error");e.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.cardCvc||(this.cardCvc=i.create("cardCvc",{style:this.cardStyle,placeholder:"Security code"}),this.cardCvc.mount("#card-cvc-element"),this.cardCvc.addEventListener("change",(function(e){var i=t.$paymentTab.find(".card-cvc-error");e.error?i.removeClass("hidden"):i.addClass("hidden")}))),this.form||(this.form=document.getElementById("payment-form"),this.form.addEventListener("submit",this.onPaymentFormSubmit.bind(this)))},renderCartHolderInput:function(){this.cardHolderName||(this.cardHolderName=this.$paymentTab.find(".card-name-input"),this.cardHolderName.removeClass("hidden"),this.cardHolderName.on("input",this.onCardHolderNameChange))},onCardHolderNameChange:function(t){this.cardHolderNameValue=t.target.value,this.cardHolderNameValue?this.$paymentTab.find(".card-name-error").hasClass("hidden")||this.$paymentTab.find(".card-name-error").addClass("hidden"):this.$paymentTab.find(".card-name-error").hasClass("hidden")&&this.$paymentTab.find(".card-name-error").removeClass("hidden")},onPaymentFormSubmit:function(t){t.preventDefault(),this.cardHolderNameValue?(this.$paymentTab.find(".card-name-error").addClass("hidden"),this.haveSkus?this.onSkuPaymentFormSubmit():this.havePrices&&this.onPricesPaymentFormSubmit()):this.$paymentTab.find(".card-name-error").removeClass("hidden")},onSkuPaymentFormSubmit:function(){var t=this;this.stripe.createToken(this.cardNumber,{name:this.cardHolderNameValue}).then((function(e){e.error||t.stripeTokenHandler(e.token)}))},onPricesPaymentFormSubmit:function(){var t=this;this.clientSecret?(this.hideErrorPaymentMessage(),this.showPaymentLoader(),this.stripe.confirmCardPayment(this.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.cardHolderNameValue}}}).then((function(e){e.error?(t.hidePaymentLoader(),t.showErrorPaymentMessage("Payment Failed on confirmCardPayment"),t.checkoutCompete=!0):(t.hidePaymentLoader(),"succeeded"===e.paymentIntent.status&&(t.showSuccessPaymentMessage(),RM.analytics&&RM.analytics.sendEvent("Checkout success")),t.checkoutCompete=!0)}))):this.showErrorPaymentMessage("Not client secret")},stripeTokenHandler:function(t,e){var i=this.mag.eCommerceManager.getOrder();if(i){var o=i.email;o?(this.hideErrorPaymentMessage(),this.showPaymentLoader(),n.a.ajax({type:"POST",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/"+i.id+"/pay/",data:JSON.stringify({stripe_token:t.id,email:o}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){this.hidePaymentLoader(),t&&t.data&&("paid"===t.data.status&&(RM.analytics&&RM.analytics.sendEvent("Checkout success"),this.showSuccessPaymentMessage(),"function"==typeof e&&e({status:"success"})),this.checkoutCompete=!0)}.bind(this),error:function(){this.hidePaymentLoader(),this.showErrorPaymentMessage("Payment Failed"),"function"==typeof e&&e({status:"fail"}),this.checkoutCompete=!0}.bind(this)})):this.showErrorPaymentMessage("Email is required")}else this.showErrorPaymentMessage("Order not found")},showPaymentLoader:function(){this.paymentLoading||(this.paymentLoading=!0,this.$paymentTab.find(".preloader").addClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","none"),this.$paymentTab.find(".cart-cancel-btn").css("display","none"))},hidePaymentLoader:function(){this.paymentLoading&&(this.paymentLoading=!1,this.$paymentTab.find(".preloader").removeClass("show"),this.$paymentTab.find(".cart-payment-btn").css("display","block"),this.$paymentTab.find(".cart-cancel-btn").css("display","block"))},showErrorPaymentMessage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$paymentFailed.find(".error-message").text(t),this.$paymentFailed.addClass("show")},hideErrorPaymentMessage:function(){this.$paymentFailed.find(".error-message").empty(),this.$paymentFailed.removeClass("show")},showSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","none"),this.$paymentTab.find(".sidebar-body").css("display","none"),this.$paymentSuccess.addClass("show")},hideSuccessPaymentMessage:function(){this.$paymentTab.find(".sidebar-header").css("display","block"),this.$paymentTab.find(".sidebar-body").css("display","block"),this.$paymentSuccess.removeClass("show")},toogleSettings:function(){this.isHiddenSettings=!this.isHiddenSettings,this.settingsPanel&&(this.settingsPanel.isHidden=this.isHiddenSettings)},getSettingsData:function(){return{isHidden:this.isHiddenSettings,model:this.cartWidgetModel?s.a.clone(this.cartWidgetModel.attributes):{},onOverlayClick:this.onSettingsOverlayClick.bind(this)}},setupSettingsPanel:(U=L(regeneratorRuntime.mark((function t(){var e,o,a,r,l,c,d,h,u,p,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(i.bind(null,"tf3M"));case 2:return e=t.sent,o=e.default,t.next=6,i.e(18).then(i.bind(null,"YOpb"));case 6:return a=t.sent,r=a.default,t.next=10,Promise.resolve().then(i.bind(null,"nnuN"));case 10:return l=t.sent,c=l.default,this.cartWidgetModel=new o(this.cartWidgetData),this.saveModelChanges_debounced=s.a.debounce(this.saveModelChanges.bind(this),80),RM.constructorRouter&&RM.constructorRouter.mag&&!RM.constructorRouter.mag.get("_id")&&(RM.constructorRouter.isOwner=s.a.isEmpty(RM.constructorRouter.previewMag.get("shared")),RM.constructorRouter.previewMag.edit_params=new r(RM.constructorRouter.previewMag.get("edit_params"),RM.constructorRouter.previewMag),RM.constructorRouter.previewMag.unset("edit_params"),RM.constructorRouter.previewMag.filterUnusedFonts(),RM.constructorRouter.fonts=new c(RM.constructorRouter.previewMag.edit_params)),this.$settingButton=Object(n.a)("<div>",{class:"settings-button-wrap",attr:{"data-alt":"Settings","data-alt-pos":"top","data-alt-offset":"9"}}),this.$settingButton.append(Object(n.a)("<img>",{class:"settings-button svg",src:Object(A.findImagePath)("./constructor/controls/cart_settings/cart-sidebar-settings.svg")})),this.$footer.append(this.$settingButton),this.$settingButton.on("click",this.toogleSettings),t.next=21,i.e(10).then(i.bind(null,"MErq"));case 21:return d=t.sent,h=d.default,t.next=25,Promise.resolve().then(i.bind(null,"Kw5r"));case 25:u=t.sent,p=u.default,g=p.extend(h),this.settingsPanel=new g({el:Object(n.a)('<div id="settings-panel">').appendTo(document.body).get(0),data:this.getSettingsData()}),this.settingsPanel.$on("change",this.onModelChange);case 30:case"end":return t.stop()}}),t,this)}))),function(){return U.apply(this,arguments)}),onSettingsOverlayClick:function(){this.toogleSettings()},onModelChange:function(t){this.saveModelChanges_debounced(t)},saveModelChanges:function(t){this.cartWidgetData=t,this.generateSidebarCSS(t),this.cartWidgetModel&&this.cartWidgetModel.save(t,{toHistory:!1,skipHistory:!0})},checkShippableInCart:function(){var t=this.mag.eCommerceManager.getCartData();for(var e in t.skus)if(t.skus[e].productObject.shippable)return!0;return!1},destroy:function(){var t=this;if(this.rendered)return this.checkoutCompete&&(this.mag.eCommerceManager.clearCart(),this.goToInitialTab(),this.hideSuccessPaymentMessage(),this.$paymentFailed.empty()),this.mag.eCommerceManager.events.off("ecommerce:cartsidebar:visibility:changed"),this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed"),this.form&&this.form.removeEventListener("submit",this.onPaymentFormSubmit),this.cardHolderName&&this.cardHolderName.off("input",this.onCardHolderNameChange),this.$tabs.find("[data-tab^='tab-']").each((function(t,e){Object(n.a)(e).off("click")})),this.$items.find(".cart-item-remove-btn").each((function(t,e){Object(n.a)(e).off("click")})),this.$tabs.find(".order-details-form .form-input").each((function(e,i){Object(n.a)(i).off("input",t.onShippingFormChange)})),this.unbindDomEvents(),this.settingsPanel&&(this.settingsPanel.$off("change",this.onModelChange),this.settingsPanel.$destroy()),this.$settingButton&&this.$settingButton.off("click",this.toogleSettings),this.remove()},cartItemBlockHover:function(t){var e=Object(n.a)(t.currentTarget);e&&e.length&&(e.addClass("hover").siblings().removeClass("hover"),this.hoveredItem=e.data("price-id")||e.data("sku-id"))},cartItemBlockLeave:function(t){var e=Object(n.a)(t.currentTarget);e&&e.length&&(e.removeClass("hover"),(e.data("price-id")||e.data("sku-id"))===this.hoveredItem&&(this.hoveredItem=null))}}),ot=i("CXd4"),at=i.n(ot),st=a.a.View.extend({ARROWS_SHOW_DELAY:1e3,BOTTOM_SHOW_DELAY:1e3,BOTTOM_HIDE_DELAY:0,template:at.a["template-viewer-navigation"],events:{"click .navigation-arrow.left":"goPrevPage","click .navigation-arrow.right":"goNextPage","click .navigation-arrow.bottom":"scrollCurrentPage"},initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this.updateScaleState.__debounced=s.a.debounce(this.updateScaleState,100),this},render:function(){return this.setElement(this.template({icons:{sprite:Object(A.findImagePath)("./common/navigation/sprite".concat(A.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.$prev=this.$(".navigation-arrow.left"),this.$next=this.$(".navigation-arrow.right"),this.$bottom=this.$(".navigation-arrow.bottom"),s.a.delay(s.a.bind((function(){this.$prev.removeClass("offscreen"),this.$next.removeClass("offscreen")}),this),this.ARROWS_SHOW_DELAY),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+n.a.keycodes.left,this.goPrevPage),this.listenTo(this.mag,"keypress-"+n.a.keycodes.right,this.goNextPage),x.a.isDesktop&&Object(n.a)(window).bind("mousewheel",this.onMouseWheel),x.a.isDesktop||(Object(n.a)(window).bind("gesturechange",this.updateScaleState.__debounced),this.updateScaleState(),(this.mag.getPagesCount()>1||this.hasFinalPage)&&this.setSwipeAction()),this},destroy:function(){return x.a.isDesktop&&Object(n.a)(window).unbind("mousewheel",this.onMouseWheel),x.a.isDesktop||(Object(n.a)(window).unbind("gesturechange",this.updateScaleState.__debounced),this.pagesSwipe&&this.pagesSwipe.destroy()),this.remove()},onMouseWheel:function(t,e,i,n){this.preventTrackpadSwipeTill&&+new Date<this.preventTrackpadSwipeTill||Math.abs(i)>40&&Math.abs(i)>Math.abs(n)&&(i>0&&this.goPrevPage(),i<0&&this.goNextPage(),this.preventTrackpadSwipeTill=+new Date+1e3)},setSwipeAction:function(){this.pagesSwipe=this.mag.$mag_container.RMSwipe({$scrollElements:this.mag.$mag_container,getMaxTransitionSpeed:s.a.bind((function(){return this.mag.getPageTransitionTime()}),this),customMoveCheck:s.a.bind((function(t,e){if(this.hasFinalPage&&this.mag.isLastPage()){if(this.finalPageShown&&!t.hasClass("final-page"))return!1;if(!this.finalPageShown){if(!t.hasClass("final-page")&&e<0)return!1;if(t.hasClass("final-page")&&e>0)return!1}}return!(t.hasClass("prev-page")&&e<0)&&!(t.hasClass("next-page")&&e>0)}),this),beforeAutoAnimation:s.a.bind((function(t,e){return this.mag.isLastPage()&&this.hasFinalPage&&("left"===t&&!this.finalPageShown||"right"===t&&this.finalPageShown)?{autoAnimate:!0,immediateCallback:!0}:(this.mag.showPageCounter(t),{autoAnimate:!0,immediateCallback:!1})}),this),onSwipeStart:s.a.bind((function(){!this.finalPageShown&&this.mag.showPageCounter()}),this),getCurrentConstraints:s.a.bind((function(t){var e={},i=this.mag.$mag_container.width(),n=t.closest(".page, .final-page");return n.length||(n=this.mag.currentPage.$el),this.mag.isLastPage()&&this.hasFinalPage&&this.finalPageShown?e.$moveItems=n:e.$moveItems=n.add(n.prev()).add(n.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-page)").first(),!this.mag.isLastPage()||this.hasFinalPage&&!this.finalPageShown?e.left={max:i}:e.left={max:0,noTrigger:!0},this.mag.isFirstPage()&&!this.finalPageShown?e.right={max:0,noTrigger:!0}:e.right={max:i},e}),this),callback:s.a.bind((function(t){"right"===t&&this.mag.goPrevPage({animation:!1,bySwipe:!0}),"left"===t&&this.mag.goNextPage({animation:!1,bySwipe:!0})}),this)}).data("swipe")},onFinalPageShow:function(){this.finalPageShown=!0,this.$next.addClass("hidden"),this.$bottom.addClass("final-page-offscreen"),this.$prev.toggleClass("hidden",!x.a.isDesktop)},onFinalPageHide:function(){this.finalPageShown=!1,this.$next.removeClass("hidden"),this.$bottom.removeClass("final-page-offscreen"),this.$prev.toggleClass("hidden",this.mag.isFirstPage())},onPageChange:function(t,e){this.$next.toggleClass("hidden",!(!this.mag.isLastPage()||this.mag.finalPage)||!(!this.mag.finalPage||!this.mag.finalPage.shown)),this.recalcBottomArrowState(t),this.$prev.toggleClass("hidden",this.mag.isFirstPage()),this.mag.updateArrowsColor(t)},recalcBottomArrowState:function(t){clearTimeout(this.bottomArrowTimeout);var e=t.isBottomArrowVisible();"horizontal"===this.viewerType&&v.a.isScaleLayout()&&(e=!1),this.isPreview&&"default"!==this.mag.viewport&&(e=!1),this.bottomArrowTimeout=setTimeout(s.a.bind((function(){this.$bottom.toggleClass("offscreen",!e)}),this),e?this.BOTTOM_SHOW_DELAY:this.BOTTOM_HIDE_DELAY)},goPrevPage:function(t){this.mag.goPrevPage({animation:!0})},goNextPage:function(t){this.mag.goNextPage({animation:!0})},scrollCurrentPage:function(t){this.mag.scrollCurrentPageALittle()},updateScaleState:function(){Modernizr.android||this.$prev.add(this.$next).add(this.$bottom).toggleClass("scaled-offscreen",d.default.isPageNativelyScaled())}}),rt=i("Gw2y"),lt=i.n(rt),ct=i("BVsp"),dt=a.a.View.extend({template:lt.a["template-viewer-final-page"],events:{"click .recover .go":"onClickRecoverSubmit","click .join.ljr-panel .go":"onJoinButtonClick"},initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this},render:function(){var t="empty";return"join"!==this.finalPageType||this.me||(t="join"),"join"===this.finalPageType&&(t="join"),this.setElement(this.template({mag:this.mag,disableSocials:this.isPrivate,recentMags:this.recentMags,tp:t,magLink:this.mag.getUrl(),isStickyVerticalViewer:this.isStickyVerticalViewer,tweetText:g.getFinalShare(null,s.a.extend(this.mag.model.toJSON(),{user:this.mag.user}),{forProject:!0,customDomain:RM.common.isDomainViewer}).tweet,specialRecentView:"recent"===t&&1===this.recentMags.length&&!x.a.isPhone,Constants:h.a})),Modernizr.safari&&this.unFocusInput(),this.$el.appendTo(this.$container),"join"===t&&new ct.default({useNavigate:!1,$node:this.$(".dop-container-join"),router:this.router}).render(),"horizontal"===this.viewerType?(this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"keypress-"+n.a.keycodes.esc,this.hide)):this.show(),this.setRecoverPanelTop(),this},onJoinButtonClick:function(){!this.$(".join.ljr-panel input").hasClass("err")&&this.$(".join.ljr-panel .go").hasClass("active")},onClickRecoverSubmit:function(){var t=this.$(".recover.ljr-panel .email-input").val();Object(n.a)(".recover.ljr-panel .send-message .recover-email").text(t)},unFocusInput:function(){this.$(".join.ljr-panel .email-input").one("focus",(function(){Object(n.a)(this).blur()}))},setRecoverPanelTop:function(){var t=window.matchMedia("(max-width: 768px)").matches,e=(this.getHeight()-Object(n.a)(".join.ljr-panel").outerHeight())/2+"px";Object(n.a)(".recover.ljr-panel").css({top:t?"0":e})},show:function(){return this.shown||(this.$el.removeClass("offscreen hidden"),this.shown=!0,"horizontal"===this.viewerType&&this.mag.trigger("finalPageShown")),this},hide:function(){return this.shown&&(this.$el.addClass("offscreen"),this.shown=!1,this.mag.trigger("finalPageHidden")),this},destroy:function(){return this.remove()},setSizeAndPosForStickyVersion:function(t){var e=window.matchMedia("(max-width: 768px)").matches;t=t||{},this.$(".recover.ljr-panel").hasClass("hidden")?(this.$(".dop-container-text").removeClass("hidden"),this.$el.css({height:e?this.$(".final-page-container").height():"100vh",top:t.absolutePosition})):(this.$(".dop-container-text").addClass("hidden"),this.$el.css({height:"100vh",top:t.absolutePosition}))},scrollOnVerticalMode:function(t){this.hasScrollOnVerticalMode=!0,this.$el.css("top",0),d.default.applyTransform(this.$(".final-page-wrapper"),"translateY("+-t+"px)")},resetScrollOnVerticalMode:function(){this.hasScrollOnVerticalMode&&(this.hasScrollOnVerticalMode=!1,this.$el.css("top",""),d.default.applyTransform(this.$(".final-page-wrapper"),""))},getHeight:function(){return this.$(".final-page-wrapper").height()},onPageChange:function(){this.$el.toggleClass("hidden",!this.mag.isLastPage()),this.hide()},onKeyUp:function(t){t.stopPropagation()}}),ht=i("Tu3F"),ut=i.n(ht),pt=i("Wxmq"),gt=i.n(pt),mt=a.a.View.extend({template:gt.a["template-viewer-share"],events:{"click .buttons-wrapper .button":"share","click .send-report":"share","click .open-embed":"openEmbed","click .close":"hide","click .embed-wrapper .back":"closeEmbed","click .embed-wrapper .embed-code":"selectEmbedCode","keyup .embed-wrapper .embed-code":"onKeyUp","click .type-selector":"onTypeSelectorClick","click .size-selector":"onSizeSelectorClick",click:"onClick"},initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this},render:function(){return this.setElement(this.template({hasOverlay:x.a.isPhone,common:RM.common,icons:{sprite:Object(A.findImagePath)("./viewer/share/sprite".concat(A.is2X?"@2x":"",".png")),thumbArrows:Object(A.findImagePath)("./viewer/share/thumb-arrows".concat(A.is2X?"@2x":"",".png")),thumbOpen:Object(A.findImagePath)("./viewer/share/thumb-open".concat(A.is2X?"@2x":"",".png"))},isNewSettingsEnabled:Object(O.a)("constructor.newProjectSettings")})),this.$el.appendTo(this.$container),this.selectFullMode(),x.a.isPhone&&(this.shareSwipe=this.$el.RMSwipe({minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,beforeAutoAnimation:s.a.bind((function(t,e){return{autoAnimate:!0,immediateCallback:!0}}),this),getCurrentConstraints:s.a.bind((function(t){var e={},i=this.$el.filter(".share-popup");return e.$referenceItem=i,e.$moveItems=i,e.up={max:0,noTrigger:!0},e.down={max:i.height()},e}),this),callback:s.a.bind((function(t){this.hide()}),this)}).data("swipe")),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"keypress-"+n.a.keycodes.esc,this.hide),Object(n.a)("body").on("click",this.hideOnBodyClick),this},show:function(){return this.shown||(clearTimeout(this.hideTimeout),this.$el.removeClass("hidden"),this.$el.height(),this.$el.addClass("show-popup"),this.$container.addClass("no-hover"),this.shown=!0,this.updateEmbed()),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.$el.removeClass("show-popup"),this.$container.removeClass("no-hover"),this.hideTimeout=setTimeout(s.a.bind((function(){this.closeEmbed(),this.$el.addClass("hidden")}),this),400),this.shown=!1),this},destroy:function(){return clearTimeout(this.hideTimeout),Object(n.a)("body").off("click",this.hideOnBodyClick),this.shareSwipe&&this.shareSwipe.destroy(),this.remove()},hideOnBodyClick:function(t){x.a.isPhone||Object(n.a)(t.target).closest(this.$container).length||this.hide()},onPageChange:function(t,e){this.hide()},onFinalPageShow:function(){this.hide()},onClick:function(t){x.a.isPhone&&Object(n.a)(t.currentTarget).hasClass("share-popup-overlay")&&this.hide()},onKeyUp:function(t){t.stopPropagation()},openEmbed:function(t){this.router.analytics&&this.router.analytics.sendEvent("Embed","contents ("+this.shareMode+")"),this.selectEmbedCode(),this.$el.addClass("show-embed")},updateEmbed:function(){var t,e=this.mag.currentPage||this.mag.pages[0],i=this.$(".size-selector").attr("data-selected");this.$(".embed-wrapper .embed-code").val(mt.getEmbedCode({shareMode:this.shareMode,cur_page_num_id:e.num_id,mag_num_id:this.mag.num_id,size:{responsive:"responsive",big:512,small:288}[i]})),t=this.mag.model.getPageScreenshot(256,{_id:"page"===this.shareMode?e._id:this.mag.coverPid}),this.currentEmbedSrc!==t&&(this.$(".thumb-pic").attr("src",t),this.currentEmbedSrc=t)},closeEmbed:function(){this.$el.removeClass("show-embed")},share:function(t){g.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:Object(n.a)(t.currentTarget).attr("data-tp"),source:"share panel",page:this.mag.currentPage||this.mag.pages[0],mag:s.a.extend(this.mag.model.toJSON(),{user:this.mag.user}),forProject:"full"===this.shareMode,customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!==RM.common.embedDomainType),analytics:this.router.analytics,exportBasePath:window.RM.common.isDownloadedSource?window.RM.config&&window.RM.config.root:void 0})},onTypeSelectorClick:function(t){if(x.a.isPhone){var e=Object(n.a)(t.target);e.closest(".type-full").length&&this.selectFullMode(),e.closest(".type-page").length&&this.selectPageMode()}else{"page"===(this.$(".type-selector").attr("data-tp")||"page")?this.selectFullMode():this.selectPageMode()}},onSizeSelectorClick:function(t){var e,i,o=Object(n.a)(t.currentTarget),a=o.attr("data-selected");i=(i=(e=s.a.map(o.find(".size"),(function(t){return Object(n.a)(t).attr("data-size")}))).indexOf(a)+1)>=e.length?0:i,o.attr("data-selected",e[i]),this.updateEmbed()},selectPageMode:function(){this.$(".type-selector").attr("data-tp","page"),this.shareMode="page",this.updateEmbed()},selectFullMode:function(){this.$(".type-selector").attr("data-tp","full"),this.shareMode="full",this.updateEmbed()},selectEmbedCode:function(){x.a.isDesktop&&this.$(".embed-wrapper .embed-code").get(0).setSelectionRange(0,9999)}},{getEmbedCode:function(t){var e,i,n,o,a='<script async src="'+h.a.EMBED_SCRIPT_INIT+'" id="readymag-embed-init"><\/script>';return e=RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname,o=' data-uri="'+(i="full"===t.shareMode?t.mag_num_id:"p"+t.cur_page_num_id)+'" ',o+=' data-width="'+t.size+'" ',(RM.common.isDomainViewer||RM.common.embedDomainName)&&(o+=' data-domain="'+e+'" ',RM.common.customDomainProfile||"User"===RM.common.embedDomainType||(i="full"===t.shareMode?"":"p"+t.cur_page_num_id)),h.a.IS_LIVE||(o+=' data-origin="'+h.a.readymag_embed_host+'" '),'<a class="rm-mag-embed" href="'+(n=e+"/"+i)+'"'+o+' target="_blank">'+n+"</a>\n"+a}}),ft=mt,vt=i("QRzc"),bt=i.n(vt),_t=i("Fi5S"),yt=a.a.View.extend({template:bt.a["template-viewer-mag-menu"],isNewSettingsEnabled:Object(O.a)("constructor.newProjectSettings"),events:{"click .page":"onPageClick"},initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this.IMG_STUB=Object(A.findImagePath)("./spacer.gif"),x.a.isPhone?"horizontal"===this.viewerType?(this.PAGE_WIDTH=140,this.PAGE_HEIGHT=92):(this.PAGE_WIDTH=240,this.PAGE_HEIGHT=158):(this.PAGE_WIDTH=this.isNewSettingsEnabled&&"vertical"===this.viewerType?240:280,this.PAGE_HEIGHT=this.isNewSettingsEnabled&&"vertical"===this.viewerType?158:184),this.loadVisibleScreenshots.__debounced=s.a.debounce(this.loadVisibleScreenshots,500),this.unloadInvisibleScreenshots.__debounced=s.a.debounce(this.unloadInvisibleScreenshots,3e3),this},render:function(){this.setElement(this.template({mag:this.mag,pages:this.pages,width:this.PAGE_WIDTH,height:this.PAGE_HEIGHT,stub:this.IMG_STUB,viewerType:this.viewerType,publishDate:this.publishDate,hasProjectInfo:this.hasProjectInfo,common:RM.common})),this.$el.appendTo(this.$container),this.$pagesWrapper=this.$(".pages-wrapper");var t=this.$(".page");if("horizontal"==this.viewerType?(this.$(".pages").css("width",t.length*this.PAGE_WIDTH),this.$pagesWrapper.scrollLeft(99999)):(this.$(".pages").css("height",t.length*this.PAGE_HEIGHT),this.$pagesWrapper.scrollTop(99999)),x.a.isDesktop&&(this.scroll=this.$(".scroll-wrapper").RMScroll({$container:this.$pagesWrapper,$content:this.$(".pages"),$handle:this.$(".scroll"),wheelScrollSpeed:1.3,gap_start:8,gap_end:8,maxHandleSize:136,dragScroll:!0,tp:this.viewerType}).data("scroll")),this.$pagesWrapper.bind("scroll",this.onScroll),this.cacheSize(),this.cacheScroll(),this.cachePagesPos(),this.loadedScreenshots={},this.showInitially&&(this.loadVisibleScreenshots(),this.show(!0)),"horizontal"==this.viewerType&&x.a.isPhone||Object(n.a)(".menu-info .mag-title").dotdotdot({height:x.a.isPhone?48:68,wrap:"letter",callback:s.a.bind((function(t,e){t&&this.$(".menu-info .mag-title").attr("title",this.mag.title)}),this)}),!x.a.isDesktop){var e="horizontal"==this.viewerType?this.$el.height():this.$el.width(),i=this.$el.add(this.$toolbar);"horizontal"==this.viewerType&&this.mag.navigation&&(i=i.add(this.mag.navigation.$bottom)),this.menuSwipe=i.RMSwipe({$scrollElements:this.$pagesWrapper,minTransitionSpeed:200,maxTransitionSpeed:400,rubberBand:!1,getCurrentConstraints:s.a.bind((function(){var t={};return t.$referenceItem=this.$el,t="horizontal"==this.viewerType?this.shown?{up:{max:0,noTrigger:!0},down:{max:e}}:{up:{max:e},down:{max:0,noTrigger:!0}}:this.shown?{left:{max:0,noTrigger:!0},right:{max:e}}:{left:{max:e},right:{max:0,noTrigger:!0}}}),this),callback:s.a.bind((function(t){this.shown?this.hide():this.show()}),this)}).data("swipe")}return this.isPreview&&this.listenTo(RM.constructorRouter,"renewScreenshot",this.renewScreenshot),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"keypress-"+n.a.keycodes.m,this.toggle),this.listenTo(this.mag,"keypress-"+n.a.keycodes.esc,this.hide),_t.a.on("constructorSettings:open",this.show),_t.a.on("constructorSettings:close",this.hide),Object(n.a)(window).on("resize",this.onResize),this.$el.bind("mousewheel",this.onMouseWheel),this},show:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.finalPageShown||this.shown||(this.shown=!0,e&&this.$el.css({transition:"none"}),this.mag.$el.addClass("viewer-mag-menu-shown"),Object(n.a)("html").addClass("mag-menu-shown"),this.mag.$el.toggleClass("viewer-mag-menu-no-project-info",!this.hasProjectInfo),this.loadOtherScreenshots(),this.mag.trigger("menuShown"),_t.a.trigger("magMenu:open"),e&&setTimeout((function(){return t.$el.css({transition:""})}))),this},toggle:function(){return this.shown?this.hide():this.show()},hide:function(){return this.shown&&(this.mag.$el.removeClass("viewer-mag-menu-shown viewer-mag-menu-no-project-info"),Object(n.a)("html").removeClass("mag-menu-shown"),this.clearLoadOtherTimeout(),this.mag.focusCurrentPage(),this.shown=!1,this.mag.trigger("menuHidden"),_t.a.trigger("magMenu:close")),this},destroy:function(){return Object(n.a)(window).off("resize",this.onResize),Object(n.a)("html").removeClass("mag-menu-shown"),_t.a.trigger("magMenu:close"),this.$el.unbind("mousewheel",this.onMouseWheel),this.menuSwipe&&this.menuSwipe.destroy(),this.$pagesWrapper.unbind("scroll",this.onScroll),_t.a.off("constructorSettings:open",this.show),_t.a.off("constructorSettings:close",this.hide),this.remove()},onMouseWheel:function(t){t.preventDefault()},onResize:function(){this.cacheSize(),this.scroll&&this.scroll.recalc(),this.mag.currentPage&&this.shiftToPage(this.mag.currentPage.num,!1)},onScroll:function(){this.cacheScroll()},cacheSize:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollSize="horizontal"==this.viewerType?this.$pagesWrapper.width():this.$pagesWrapper.height()},cacheScroll:function(){this.cachedData=this.cachedData||{},this.cachedData.scrollPos="horizontal"==this.viewerType?this.$pagesWrapper.scrollLeft():this.$pagesWrapper.scrollTop()},cachePagesPos:function(){this.cachedData=this.cachedData||{},this.cachedData.pagesPos={};var t=this.cachedData.pagesPos,e=this.viewerType,i=this.PAGE_WIDTH,n=this.PAGE_HEIGHT;s.a.each(this.pages,(function(o,a){t[o.num]=a*("horizontal"==e?i:n)}))},onPageChange:function(t,e){this.shown||(this.loadVisibleScreenshots.__debounced(),!x.a.isDesktop&&this.unloadInvisibleScreenshots.__debounced()),this.shiftToPage(t.num,this.shown),s.a.isEmpty(this.loadedScreenshots)&&this.loadVisibleScreenshots()},onFinalPageShow:function(){this.hide(),this.finalPageShown=!0},onFinalPageHide:function(){this.finalPageShown=!1},shiftToPage:function(t,e){var i,n=this.$('.page[data-num="'+t+'"]'),o=this.cachedData.scrollSize,a=this.cachedData.scrollPos,s="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT,r=this.cachedData.pagesPos[t],l=a+s/2,c=a+o-s/2;if(this.$(".page.active").removeClass("active"),n.addClass("active"),r<l)i=r-l;else{if(!(r+s>c))return;i=r+s-c}var d={};d["horizontal"==this.viewerType?"scrollLeft":"scrollTop"]=a+i,this.$pagesWrapper.stop().animate(d,e?300:0)},onPageClick:function(t){if(!this.scroll||!this.scroll.wasContentDrag){var e=Object(n.a)(t.currentTarget).data("num");this.mag.currentPage&&e==this.mag.currentPage.num||this.mag.showPage(e,{animation:!1})}},renewScreenshot:function(t){var e=this.$(".page").filter((function(){return Object(n.a)(this).data("id")==t})),i=RM.constructorRouter.mag.pages.find((function(e){return e.id==t})),o=i&&i.getScreenshot(this.PAGE_WIDTH);e.attr("data-src")?e.attr("data-src",o):e.find(".screenshot").prop("src",o)},getVisibleScreenshotRange:function(){var t=this.cachedData.scrollSize,e=this.cachedData.scrollPos,i="horizontal"==this.viewerType?this.PAGE_WIDTH:this.PAGE_HEIGHT;return{min:Math.max(0,Math.floor(e/i)),max:Math.min(this.mag.getPagesCount()-1,Math.floor((e+t)/i))}},loadVisibleScreenshots:function(){if(this.mag.pages&&this.mag.pages.length){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each((function(i){var o,a=(o=Object(n.a)(this)).attr("data-src");i>=t.min&&i<=t.max&&a&&!e.loadedScreenshots[i]&&((o=Object(n.a)(this)).find(".screenshot").prop("src",a),o.removeAttr("data-src"),e.loadedScreenshots[i]=!0)}))}},unloadInvisibleScreenshots:function(){if(!this.shown){var t=this.getVisibleScreenshotRange(),e=this;this.$(".page").each((function(i){var o,a=(o=Object(n.a)(this)).attr("data-src");(i<t.min||i>t.max)&&!a&&e.loadedScreenshots[i]&&((o=Object(n.a)(this)).attr("data-src",o.find(".screenshot").prop("src")),o.find(".screenshot").prop("src",e.IMG_STUB),delete e.loadedScreenshots[i])}))}},loadOtherScreenshots:function(){this.clearLoadOtherTimeout(),this.loadOtherSafeTimeout=500,this.loadNextScreenshot()},loadNextScreenshot:function(){var t,e,i,n=this.getVisibleScreenshotRange(),o=Math.floor((n.min+n.max)/2),a=this.loadedScreenshots,s=this.mag.getPagesCount()-1;for(t=o;t<=s&&a[t];t++);for(e=o;e>=0&&a[e];e--);if(!(e<0&&t>s)){a[i=t>s?e:e<0?t:t-o>o-e?e:t]=!0;var r=this.$(".page").eq(i),l=r.find(".screenshot"),c=this;l.one("load error",(function(t){clearTimeout(c.$curLoadingTimeout),c.loadNextScreenshot()})),this.$curLoadingTimeout=setTimeout((function(){l.off(),c.loadOtherSafeTimeout*=1.1,c.loadNextScreenshot()}),this.loadOtherSafeTimeout),l.prop("src",r.attr("data-src")),r.removeAttr("data-src"),this.$curLoadingScreenshot=l}},clearLoadOtherTimeout:function(){this.$curLoadingScreenshot&&this.$curLoadingScreenshot.off(),clearTimeout(this.$curLoadingTimeout)}}),wt=a.a.View.extend({PAGE_COUNTER_TIMEOUT:2800,PAGE_COUNTER_TIMEOUT_INITIAL:4e3,isNewSettingsEnabled:Object(O.a)("constructor.newProjectSettings"),brandingInToolbar:!1,template:ut.a["template-viewer-toolbar"],events:{"click .menu-button":"toggleMenu","click .share-button":"toggleShare","click .embed-close-button":"onEmbedCloseClick"},initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this},render:function(){if(this.setElement(this.template({mag:this.mag,isPreview:this.isPreview,hasMenu:this.hasMenu,hasShare:this.hasShare,hasPageCounter:this.hasPageCounter,pageCounterInsideMenu:this.hasMenu&&x.a.isPhone,totalPages:this.mag.getPagesCount(),common:RM.common,isNewSettingsEnabled:this.isNewSettingsEnabled,controlsOnTop:this.controlsOnTop,brandingInToolbar:this.brandingInToolbar,icons:{sprite:Object(A.findImagePath)("./common/toolbar/sprite".concat(A.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.$menuButton=this.$el.find(".menu-button"),this.$shareButton=this.$el.find(".share-button"),this.$pageCounter=this.$el.find(".page-counter"),this.$pageCounterWrapper=this.$pageCounter.parent(),this.hasShare&&(this.share=new ft({mag:this.mag,router:this.router,$container:x.a.isPhone?this.$container:this.$shareButton}).render(),this.hasMenu||this.$shareButton.addClass("without-menu-button")),this.hasMenu&&(this.magMenu=new yt({mag:this.mag,pages:this.pages,router:this.router,isPreview:this.isPreview,hasProjectInfo:this.hasProjectInfo,publishDate:this.publishDate,$container:this.$container,$toolbar:this.$el,viewerType:this.viewerType,showInitially:this.isSettingsOpened}).render()),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.onFinalPageShow),this.listenTo(this.mag,"finalPageHidden",this.onFinalPageHide),this.listenTo(this.mag,"menuShown",this.onMenuShow),this.listenTo(this.mag,"menuHidden",this.onMenuHide),this.listenTo(this.mag,"presentationModeOn",this.onPresentationModeOn),this.listenTo(this.mag,"presentationModeOff",this.onPresentationModeOff),!this.isPreview){var t=this.$(".offscreen-initially:visible"),e=150*t.length+800;t.each((function(t,i){setTimeout((function(){Object(n.a)(i).removeClass("offscreen-initially")}),e),e-=150}))}return this.$("div[data-alt]:not(.rmalttext), a[data-alt]:not(.rmalttext)").RMAltText(),this},destroy:function(){return this.share&&this.share.destroy(),this.magMenu&&this.magMenu.destroy(),this.remove()},isMenuOpened:function(){return!!this.menuShown},closeMenu:function(){this.magMenu&&this.magMenu.hide()},onPageChange:function(t,e){this.showPageCounter(t,e),this.$menuButton.removeClass("waiting-video-bg-start preloading"),this.prevPage&&this.stopListening(this.prevPage),t&&(t.loaded||(this.$menuButton.addClass("preloading"),this.listenTo(t,"pageLoaded",this.onPageLoaded)),t.hasVideoBG&&!t.videoBGStarted&&(this.$menuButton.addClass("waiting-video-bg-start"),this.listenTo(t,"videoBGStarted",this.onVideoBGStarted)),this.prevPage=t)},onPageLoaded:function(){this.$menuButton.removeClass("preloading")},onVideoBGStarted:function(){this.$menuButton.removeClass("waiting-video-bg-start")},onFinalPageShow:function(){this.magMenu&&this.magMenu.hide(),this.finalPageShown=!0,this.updateVisibilityState()},onFinalPageHide:function(){this.finalPageShown=!1,this.updateVisibilityState()},onPresentationModeOn:function(){this.isPresentationMode=!0,this.updateVisibilityState()},onPresentationModeOff:function(){this.isPresentationMode=!1,this.updateVisibilityState()},updateVisibilityState:function(){this.finalPageShown||this.isPresentationMode?this.$el.stop().fadeOut(200):this.$el.stop().fadeIn(200)},onMenuShow:function(){this.menuShown=!0,this.hidePageCounter()},onMenuHide:function(){this.menuShown=!1},getPageCounterSize:function(t){if(!this.cachedPageCounterData){this.$pageCounter.find(".cur").text("0");var e=this.$pageCounter.outerWidth();this.$pageCounter.find(".cur").text("00");var i=this.$pageCounter.outerWidth()-e,n=e-i;this.cachedPageCounterData={baseSize:n,digitSize:i},this.$pageCounter.find(".cur").text(t)}var o=this.cachedPageCounterData;return o.baseSize+(t+"").length*o.digitSize},updatePageCounterSize:function(t){this.$pageCounter.length&&this.$pageCounterWrapper.length&&(!this.menuShown&&this.pageCounterShown?this.$pageCounterWrapper.css("width",this.getPageCounterSize(t)):this.$pageCounterWrapper.css("width",""))},showPageCounter:function(t,e){this.hasPageCounter&&(this.$pageCounter.find(".cur").text(t.num),e.showPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.addClass("show-page-counter"),this.pageCounterShown=!0,Modernizr.android?setTimeout(s.a.bind((function(){this.updatePageCounterSize(t.num)}),this),17):this.updatePageCounterSize(t.num),this.pageCounterTimeout=setTimeout(this.hidePageCounter,e.initial?this.PAGE_COUNTER_TIMEOUT_INITIAL:this.PAGE_COUNTER_TIMEOUT)))},hidePageCounter:function(){this.hasPageCounter&&(clearTimeout(this.pageCounterTimeout),this.$el.removeClass("show-page-counter"),this.pageCounterShown=!1,this.updatePageCounterSize())},toggleMenu:function(t){this.magMenu&&this.magMenu.toggle()},toggleShare:function(t){Object(n.a)(t.target).is(this.$shareButton)&&this.share&&this.share.toggle()},postMessageToParent:function(t,e){var i={type:t,data:e},n=window.parent;n&&n.postMessage(JSON.stringify(i),"*")},onEmbedCloseClick:function(t){this.postMessageToParent("close-fullscreen")}}),kt=i("WEBt"),St=i.n(kt),xt=a.a.View.extend({template:St.a["template-viewer-branding"],initialize:function(t){return s.a.bindAll(this),s.a.extend(this,t),this},render:function(){return this.setElement(this.template()),this.$el.appendTo(this.$container),this.listenTo(this.mag,"pageChanged",this.onPageChange),this.listenTo(this.mag,"finalPageShown",this.hide),this.listenTo(this.mag,"finalPageHidden",this.show),s.a.delay(function(){this.$el.removeClass("offscreen-initially")}.bind(this),800),this},onPageChange:function(t,e){},hide:function(){this.$el.stop().fadeOut(200)},show:function(){this.$el.stop().fadeIn(200)}}),Ct=i("H3/6");function Ot(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Pt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ot(Object(i),!0).forEach((function(e){jt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ot(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function jt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var $t=a.a.View.extend({TYPEKIT_PREVIEW_API_LINK:"//use.typekit.net/previewkits/pk-v1.js",PRELOAD_COUNT_HORIZONTAL:{backward:1,forward:x.a.isDesktop?5:x.a.isPhone?3:2},PRELOAD_COUNT_VERTICAL:{backward:x.a.isDesktop?2e3:(x.a.isPhone,1e3),forward:x.a.isDesktop?3e3:(x.a.isPhone,2e3)},SCROLLABLE_TRESHOLD:100,SCROLL_SNAP:0,template:l.a["template-viewer-mag"],initialize:function(t,e){var i=this;s.a.bindAll(this),t||(t={}),s.a.defaults(t,{pages:[]}),this.hasWidgetsWithVerticalOnscrollAnimation=!1;var o=Object(s.a)(t.pages).chain().reduce((function(t,e){return t.concat(e.wids)}),[]).each((function(t){f.a.normalizeAnimations(t.animation).find((function(t){return"scroll"===t.type&&t.steps&&t.steps.find((function(t){return t.dy}))}))&&(i.hasWidgetsWithVerticalOnscrollAnimation=!0)})).filter({is_global:!0}).value();this.staticGlobalWidgetsData=Object(s.a)(o).filter((function(t){return!t.is_above})),this.aboveGlobalWidgetsData=Object(s.a)(o).filter((function(t){return t.is_above}));var a=s.a.pluck(this.aboveGlobalWidgetsData,"_id");return Object(O.a)("constructor.newProjectSettings")&&(t.pages.forEach((function(t){t.pagePath=t.pagePath||t.uri||t.num.toString()})),t.pages.forEach((function(t){t.uri=t.pagePath}))),Object(s.a)(t.pages).each(function(t){t.wids=t.wids.concat(s.a.reject(this.staticGlobalWidgetsData,(function(e){return e.pid===t._id}))),t.wids=s.a.unique(t.wids,(function(t){return t._id||Math.random()})),t.wids=Object(s.a)(t.wids).filter((function(t){return!s.a.contains(a,t._id)}))}.bind(this)),s.a.extend(this,t),this.model=new c.a(t,{parse:!0}),this.router=e,this.eCommerceManager=new P.b(this.router,this,this.router.environment),this.cartSidebar=new nt(this),this.isPreview=e.isPreview,this.$container=e.$mags_container,x.a.isDesktop&&Object(n.a)("<div>").bind("mousewheel",(function(){})),this.setViewerOptions(this.getMagViewport()),this.continueLoading.__debounced=s.a.debounce(this.continueLoading,200),this.loadPages.__debounced=s.a.debounce(this.loadPages,700),this.onResize.__debounced=s.a.debounce(this.onResize,300),this.redrawAboveGlobalWidgets.__debounced=s.a.debounce(this.redrawAboveGlobalWidgets,500,!0),this.widgetPackCount=0,this.getAboveGlobalBoxMemoized=s.a.memoize(this.getAboveGlobalBox,(function(t,e,i){return t+" "+(e&&e.num)+" "+(e&&e.pageViewport)+" "+(i&&i.width)+" "+(i&&i.height)})),this},setViewerOptions:function(t){var e=Pt(Pt({arrows:!0,menubutton:!0,projectinfo:!0,sharebutton:!0,pagecounter:!0},Object(O.a)("constructor.newProjectSettings")&&{controlsontop:!1}),{},{viewertype:"vertical",slidein:!1,scalewidth:3600,endpage:!0,endpagetype:"join",lqip:!1});e=s.a.extend(e,this.model.get("opts")),C.a.flagLQIP()||(e.lqip=!1),e.viewertype=RM.screenshot?"horizontal":e.viewertype,(!x.a.isDesktop||this.isPreview&&"default"!==t)&&(e.slidein=!1),"vertical"===e.viewertype&&(x.a.isDesktop?this.isStickyVerticalViewer=!e.slidein&&!this.isPreview&&!this.hasWidgetsWithVerticalOnscrollAnimation:(this.isStickyVerticalViewer=Modernizr.csspositionsticky,this.isStickyVerticalViewer||(e.viewertype="horizontal",this.pages.length>1&&(e.arrows=!0)))),e.sharebutton=e.sharebutton&&!this.isPreview&&!!this.published&&!this.is_private,e.pagecounter=e.pagecounter&&!this.isPreview&&this.pages.length>1,e.endpage=e.endpage&&!this.isPreview&&!!this.published,this.model.user&&this.model.user.get&&"540dc7a3a5c9259a383b910b"==this.model.user.get("_id")&&(e=s.a.extend(e,{arrows:!0,menubutton:this.isPreview,sharebutton:!1,pagecounter:!1,endpage:!1})),RM.common.isDomainViewer&&(e.endpage=!1),this.viewOpts=e,this.PRELOAD_COUNT="horizontal"==this.viewOpts.viewertype?this.PRELOAD_COUNT_HORIZONTAL:this.PRELOAD_COUNT_VERTICAL},setViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").addClass("viewer-type-"+this.viewOpts.viewertype).removeClass("pages-pos-normal pages-pos-overlap").addClass("pages-pos-"+(this.viewOpts.slidein?"overlap":"normal")),"vertical"==this.viewOpts.viewertype&&(Object(n.a)("html").addClass("overflow-on-vertical-view"),this.isStickyVerticalViewer&&(this.$el.addClass("viewer-type-vertical-sticky"),Object(n.a)("body").addClass("overflow-on-vertical-view"))),this.viewOpts.controlsontop&&Object(n.a)("html").addClass("controls-on-top"),Object(O.a)("constructor.newProjectSettings")&&Object(n.a)("html").addClass("new-settings")},unsetViewerClasses:function(){this.$el.removeClass("viewer-type-horizontal viewer-type-vertical").removeClass("pages-pos-normal pages-pos-overlap"),"vertical"==this.viewOpts.viewertype&&(Object(n.a)("html").removeClass("overflow-on-vertical-view"),this.$magScrollSizer.css("height",""),this.isStickyVerticalViewer&&(this.$el.removeClass("viewer-type-vertical-sticky"),Object(n.a)("body").removeClass("overflow-on-vertical-view"))),Object(n.a)("html").removeClass("controls-on-top")},render:function(){if(!this.active){this.title=this.title||"Project",this.magOpenTime=new Date,this.setElement(this.template({hasStandaloneBottomArrow:!this.isPreview&&"vertical"==this.viewOpts.viewertype&&this.viewOpts.arrows,isPreview:!!this.isPreview,icons:{sprite:Object(A.findImagePath)("./common/navigation/sprite".concat(A.is2X?"@2x":"",".png"))}})),this.$el.appendTo(this.$container),this.setViewerClasses(),Object(n.a)("body").on("click","a.external-link",this.toExternalLink).on("click",".maglink.back-to-top",this.backToTopCurrentPage).on("click",".maglink",this.maglink).on("click",".goback-link",this.onGobackLinkClick).on("click",".mailchimp-link",this.onMailchimpLinkClick).on("click",".anchor-link",this.onAnchorLinkClick).on("click",".share-link",this.onShareLinkClick),this.$mag_container=this.$(".mag-pages-container"),this.$mag_container.on("scroll",this.fixFocusScroll),this.$mag_viewport_device=this.$(".mag-pages-viewport-device"),this.$pages_container=this.$(".mag-pages-container .container"),this.$pages_blackout=this.$pages_container.find(".blackout"),this.$aboveWidgetsContainer=this.$(".above-pages-container"),"vertical"==this.viewOpts.viewertype&&(this.$magScrollContainer=Object(n.a)(window),this.$magScrollSizer=Object(n.a)("body"),this.isStickyVerticalViewer&&(this.$magScrollSizer=Object(n.a)("body").add(this.$el)),this.$magScrollHandler=Object(n.a)(window),this.$magScrollAnimate=Object(n.a)("body, html")),"vertical"==this.viewOpts.viewertype&&(this.$bottomArrow=this.$(".navigation-arrow.bottom"),this.$bottomArrow.one("click",this.scrollMagALittle)),this.active=!0;var t=this.pages;this.pages=null,this.viewport=null,this.switchToViewport(this.getMagViewport()),this.onResize(),x.a.isDesktop||setTimeout(this.onResize,1500),this.pages=Object(s.a)(t).chain().sortBy((function(t){return t.num})).map(s.a.bind((function(e){var i="";try{i=new b.a({mag:this,router:this.router,totalPages:t.length,pageData:e,viewerType:this.viewOpts.viewertype,isStickyVerticalViewer:this.isStickyVerticalViewer,$container:this.$pages_container}).render()}catch(t){console.log("Error page rendering.",t)}return i}),this)).filter((function(t){return!!t})).value();var e=this.getPage(this.getPagesCount());if(e&&e.markAsLast(),"horizontal"==this.viewOpts.viewertype&&this.setPagesTransitions(),!RM.screenshot){"horizontal"==this.viewOpts.viewertype&&this.viewOpts.arrows&&(this.navigation=new st({mag:this,router:this.router,$container:this.$el,isPreview:this.isPreview,hasFinalPage:this.viewOpts.endpage,viewerType:this.viewOpts.viewertype}).render()),this.viewOpts.endpage&&(this.finalPage=new dt({me:this.router.me,mag:this,router:this.router,$container:this.$pages_container,isPreview:this.isPreview,isPrivate:this.is_private,viewerType:this.viewOpts.viewertype,finalPageType:this.viewOpts.endpagetype,isStickyVerticalViewer:this.isStickyVerticalViewer,recentMags:this.model.recentMags||Object(s.a)([])}).render());var i=this.must_show_branding&&!(RM.common.embedMode&&!x.a.isDesktop),o=Object(O.a)("constructor.newProjectSettings")&&i&&x.a.isDesktop&&!this.viewOpts.controlsontop&&!this.isPreview;this.toolbar=new wt({mag:this,pages:this.pages,router:this.router,$container:this.$el,isPreview:this.isPreview,hasMenu:this.viewOpts.menubutton,hasProjectInfo:this.viewOpts.projectinfo,hasShare:this.viewOpts.sharebutton&&!h.a.IS_FILE_PROTOCOL,hasPageCounter:this.viewOpts.pagecounter,controlsOnTop:this.viewOpts.controlsontop,brandingInToolbar:o,viewerType:this.viewOpts.viewertype,publishDate:this.published?S()(new Date(this.published),"mmm dd, yyyy"):"unpublished",isSettingsOpened:this.isSettingsOpened}).render(),i&&(this.branding=new xt({mag:this,$container:o?this.toolbar.$el.find(".toolbar-branding"):this.$el}).render())}"vertical"==this.viewOpts.viewertype&&(this.onResize(),x.a.isDesktop&&this.getPage(1)&&this.getPage(1).$content.focus(),Object(n.a)("body").on("keydown",this.onVerticalViewKeyDown)),x.a.isDesktop?(Object(n.a)(window).on("mousedown",this.onMouseDown),Object(n.a)(window).on("mouseup",this.onMouseUp),Object(n.a)(window).on("mousewheel",this.onMouseWheel)):(Object(n.a)(window).on("touchstart",this.onDragStart),Object(n.a)(window).on("touchmove",this.onDragMove),Object(n.a)(window).on("touchend touchcancel",this.onDragEnd),Object(n.a)(window).on("pageshow",this.onResize)),d.default.PageVisibilityManager.addEventListener(this.onPageVisibilityChange),this.listenTo(this,"finalPageShown",this.onFinalPageShow),this.listenTo(this,"finalPageHidden",this.onFinalPageHide),this.listenTo(a.a,"form:focus",this.onFormFocus),this.listenTo(a.a,"form:blur",this.onFormBlur),Object(n.a)(window).on("resize",this.onResize),this.isPreview&&this.listenTo(this.model,"change:opts",this.onOptsChange),x.a.isDesktop||Object(n.a)(window).on("orientationchange",this.onResize),Object(n.a)(window).on("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.on("scroll",this.onMagScroll),Object(n.a)("body").on("keyup",this.onKeyup),u.a.generateCSS("paragraph","viewer",document,this.edit_params&&this.edit_params.paragraph_styles),u.a.generateCSS("link","viewer",document,this.edit_params&&this.edit_params.link_styles),RM.screenshot&&"true"==d.default.queryUrlGetParam("pdf")||this.isPreview||u.a.setShortList(u.a.getVeryShortList(this.edit_params&&this.edit_params.fonts));var r=!this.isPreview&&this.model.get("is_published")?"published":"edit",l=this;return"edit"!=r||window.TypekitPreview?c():n.a.getScript(this.TYPEKIT_PREVIEW_API_LINK,(function(t,e,i){c()})),this}function c(){u.a.appendFontsCssToDocument({version:r,fonts:l.edit_params&&l.edit_params.fonts,typekit_url:l.typekit_url})}},destroy:function(){var t=this;return s.a.each(this.pages,(function(t){t.destroy()})),this.pages=null,Object(n.a)("body").off("click","a.external-link",this.toExternalLink).off("click",".maglink.back-to-top",this.backToTopCurrentPage).off("click",".maglink",this.maglink).off("click",".goback-link",this.onGobackLinkClick).off("click",".mailchimp-link",this.onMailchimpLinkClick).off("click",".anchor-link",this.onAnchorLinkClick).off("keydown",this.onVerticalViewKeyDown).off("click",".share-link",this.onShareLinkClick),this.toolbar&&this.toolbar.destroy(),this.navigation&&this.navigation.destroy(),this.finalPage&&this.finalPage.destroy(),this.cartSidebar&&setTimeout((function(){t.cartSidebar.destroy()}),320),x.a.isDesktop?(Object(n.a)(window).off("mousedown",this.onMouseDown),Object(n.a)(window).off("mouseup",this.onMouseUp),Object(n.a)(window).off("mousewheel",this.onMouseWheel)):(Object(n.a)(window).off("touchstart",this.onDragStart),Object(n.a)(window).off("touchmove",this.onDragMove),Object(n.a)(window).off("touchend touchcancel",this.onDragEnd),Object(n.a)(window).off("pageshow")),this.unsetViewerClasses(),d.default.PageVisibilityManager.removeEventListener(this.onPageVisibilityChange),Object(n.a)(window).off("resize",this.onResize),Object(n.a)(window).off("orientationchange",this.onResize),Object(n.a)(window).off("gesturestart gestureend",this.onGestureChange),"vertical"==this.viewOpts.viewertype&&this.$magScrollHandler.off("scroll",this.onMagScroll),Object(n.a)("body").off("keyup",this.onKeyup),this.active=!1,this.trigger("destroyed"),this.remove()},getUrl:function(){return RM.common.isDomainViewer?window.location.protocol+"//"+window.location.hostname+"/"+(RM.common.customDomainProfile?this.num_id+"/":""):window.location.protocol+"//"+window.location.hostname+"/"+this.num_id+"/"},getPage:function(t){return parseInt(t,10)==t&&(t=parseInt(t,10)),s.a.isNumber(t)?this.pages[t-1]:Object(s.a)(this.pages).find((function(e){return e.uri==t}))},getPageByPath:function(t){return"1"===t.toString()?this.pages[0]:this.pages.find((function(e){return e.pagePath===t}))},getPagesCount:function(){return this.pages&&this.pages.length},isFirstPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num-1)},isLastPage:function(){return this.currentPage&&!this.getPage(this.currentPage.num+1)},getPageId:function(t){var e=s.a.find(this.pages,(function(e){return e.num_id===t}));return e&&e._id},getPageNum:function(t){var e=s.a.find(this.pages,(function(e){return e._id==t}));return e&&e.num},getPageUri:function(t){var e=s.a.find(this.pages,(function(e){return e._id==t}));if(!e)return null;var i=e.uri?e.uri+"/":1==e.num?"":e.num+"/";return this.router.getMagUri(this)+i},getPageTransitionTime:function(){var t=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),e=this.getContainerSizeCached().height;return x.a.isDesktop?550:x.a.isTablet?t>e?550:470:t>e?520:370},onPageVisibilityChange:function(){var t=this;if(this.currentPage)if(clearTimeout(this.visibilityHandlerTimeout),d.default.PageVisibilityManager.isPageHidden())this.visibilityHandlerTimeout=setTimeout((function(){t.currentPage.stop({widgetTypes:["video","background","iframe"]});var e=t.getPage(t.currentPage.num+1);e&&e.started&&(e.stop({widgetTypes:["video","background","iframe"]}),t.restartNextPage=!0)}),700);else{this.currentPage.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0});var e=this.getPage(this.currentPage.num+1);e&&this.restartNextPage&&(e.start({widgetTypes:["audio","video","background","iframe"],forceStart:!0}),delete this.restartNextPage)}},updateArrowsColor:function(t){if(t){var e=t.arrows_color||"white";this.$el.removeClass("navigation-white-arrows").removeClass("navigation-black-arrows").addClass("navigation-"+e+"-arrows")}},onFinalPageShow:function(){this.currentPage&&this.currentPage.stop({widgetTypes:["audio","video","background","iframe"]}),"horizontal"==this.viewOpts.viewertype&&(this.$pages_container.removeClass("disable-transitions"),this.$pages_container.addClass("fade-last-page-on-final-page"))},onFinalPageHide:function(){this.currentPage&&this.currentPage.start({widgetTypes:["audio","video","background","iframe"]}),"horizontal"==this.viewOpts.viewertype&&this.$pages_container.removeClass("fade-last-page-on-final-page")},onFormFocus:function(){if(Modernizr.safari&&!x.a.isDesktop&&"vertical"===this.viewOpts.viewertype){var t=this.getScroll();s.a.each(this.pages,(function(e){e.trigger("form:focus",t)})),this.$magScrollContainer&&this.$magScrollContainer.on("scroll",this.onScrollWithFormInFocus)}},onFormBlur:function(){(Modernizr.safari||!x.a.isDesktop)&&"vertical"===this.viewOpts.viewertype&&(s.a.each(this.pages,(function(t){t.trigger("form:blur")})),this.$magScrollContainer&&this.$magScrollContainer.off("scroll",this.onScrollWithFormInFocus))},onScrollWithFormInFocus:function(){if((Modernizr.safari||!x.a.isDesktop)&&"vertical"===this.viewOpts.viewertype){var t=this.getScroll();s.a.each(this.pages,(function(e){e.trigger("page:scrollWithFormInFocus",t)}))}},onDragStart:function(t){clearTimeout(this.touchInProgressTimeout),this.pauseLoading("touch");var e=t.originalEvent.targetTouches[0];this.globalTouchObject={$target:Object(n.a)(t.target).closest(".has-horizontal-scroll, .has-vertical-scroll"),x:e.screenX,y:e.screenY,startTime:+new Date}},onDragMove:function(t){var e=this.globalTouchObject;if(!(t.originalEvent.touches.length>1)&&e){if("horizontal"==this.viewOpts.viewertype)this.currentPage&&this.currentPage.hasFixedWidgets&&Object(n.a)(t.target).closest(this.$mag_container).length&&!e.$target.length&&(e.$target=this.currentPage.$scrollWrapper);else e.$target.length||(e.$target=this.$magScrollContainer);if(e.$target.length){if(!d.default.isPageNativelyScaled()){var i=t.originalEvent.targetTouches[0],o=(i.screenX,e.x,i.screenY-e.y);if(Math.abs(o)>5&&e.$target.hasClass("has-vertical-scroll")){var a=e.$target[0].scrollHeight,s=e.$target.outerHeight();o>0&&e.$target.scrollTop()<=0&&t.preventDefault(),o<0&&e.$target.scrollTop()>=a-s&&t.preventDefault()}e.$target.hasClass("has-horizontal-scroll")}}else t.preventDefault()}},onDragEnd:function(t){this.checkDoubleTap(t),this.touchInProgressTimeout=setTimeout(s.a.bind((function(){this.continueLoading("touch")}),this),400);var e=this.globalTouchObject;if(e){var i=t.originalEvent.changedTouches[0],o=i.screenX-e.x,a=i.screenY-e.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(o)<3&&Math.abs(a)<3&&+new Date-e.startTime<500&&!d.default.isPageNativelyScaled()&&Object(n.a)(t.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalTouchObject},checkDoubleTap:function(t){if(!(t.originalEvent.touches.length>0)){var e=+new Date,i=e-(this.lastTouchEndTime||e+1);if(this.lastTouchEndTime=e,i<500&&i>0&&d.default.isPageNativelyScaled()){var o=Object(n.a)('meta[name="viewport"]');if(o.length){var a=o.attr("content"),r=a.replace(/maximum\-scale\=[0-9\.]*/,"maximum-scale=1.0");if(o.attr("content",r),Modernizr.android){var l=Object(n.a)("<div>").appendTo("body");s.a.delay((function(){l.remove()}),500),setTimeout(s.a.bind((function(){o.attr("content",a);var t=Object(n.a)("<div>").appendTo("body");s.a.delay((function(){t.remove()}),500)}),this),1e3)}else o.attr("content",a);this.lastTouchEndTime=0,s.a.delay((function(){Object(n.a)(window).trigger("gesturechange")}),300),s.a.delay((function(){Object(n.a)(window).trigger("gesturechange")}),1e3)}}}},onMouseDown:function(t){this.globalMouseObject={x:t.screenX,y:t.screenY,startTime:+new Date}},onMouseUp:function(t){var e=this.globalMouseObject;if(e){var i=t.screenX-e.x,o=t.screenY-e.y;this.toolbar&&this.toolbar.isMenuOpened()&&Math.abs(i)<3&&Math.abs(o)<3&&+new Date-e.startTime<500&&Object(n.a)(t.target).closest(this.$mag_container).length&&this.toolbar.closeMenu()}delete this.globalMouseObject},onMouseWheel:function(t){t.originalEvent.deltaX<0&&Math.abs(t.originalEvent.deltaY)<2&&t.cancelable&&t.preventDefault()},onKeyup:function(t){if("input"!=t.target.tagName.toLowerCase()&&("textarea"!=t.target.tagName.toLowerCase()||"copyhack"==t.target.className)&&s.a.isEmpty(RM.common.disableShortcuts)&&!this.isInPresentationMode){var e=s.a.chain(_.b.viewports).filter((function(t){return"tablet_portrait"!=t.name||(this.currentPage["viewport_"+t.name]||{}).enabled}),this).map((function(t,e){var i=s.a.clone(t);return i.shortcut=""+(e+1),i})).findWhere({shortcut:String.fromCharCode(t.keyCode)}).value();e&&this.isPreview&&(this.switchToViewport(e.name),this.aboveGlobalWidgetsRendered||"horizontal"!==this.viewOpts.viewertype||this.renderAboveGlobalWidgets(this.currentPage),this.setViewerOptions(e.name),this.setViewerClasses(),this.onResize(),this.loadPages());s.a.find(n.a.keycodes,(function(e,i){var o=n.a.keycodes[i]===t.keyCode;return o&&i,o}))&&this.trigger("keypress-"+t.keyCode,t)}},onKeydown:function(t){if("input"!=t.target.tagName.toLowerCase()&&("textarea"!=t.target.tagName.toLowerCase()||"copyhack"==t.target.className)&&s.a.isEmpty(RM.common.disableShortcuts)&&this.isInPresentationMode&&!(t.altKey||t.ctrlKey||t.metaKey))switch(t.which){case 8:case 33:case 80:case 37:case 72:case 38:case 75:t.preventDefault(),this.goPrevPage({animation:!0});break;case 13:case 34:case 78:case 39:case 76:case 40:case 74:t.preventDefault(),this.goNextPage({animation:!0});break;case 36:t.preventDefault(),this.goFirstPage();break;case 35:t.preventDefault(),this.goLastPage();break;case 9:case 32:t.preventDefault(),t.shiftKey?this.goPrevPage({animation:!0}):this.goNextPage({animation:!0});break;case 77:t.preventDefault(),this.trigger("keypress-"+t.keyCode,t)}},onVerticalViewKeyDown:function(t){var e;if(!this.isInPresentationMode&&"vertical"===this.viewOpts.viewertype&&(t.which===n.a.keycodes.down||t.which===n.a.keycodes.up)){if(t.preventDefault(),this.arrowKeyLastScrollAt&&new Date-this.arrowKeyLastScrollAt<400)return;var i=t.which===n.a.keycodes.down;this.arrowKeyLastScrollAt=+new Date;var o,a,r=window.innerHeight,l=this.getScroll(),c=this.getScrollPosition(),d=Math.round(r/4),h=function(t){return t&&t<=d},u=s.a.bind((function(){var t=this.magPagesPos[this.currentPage.num];return Math.abs(l-t.y)}),this),p=this.currentPage.pageHeight,g=0===c&&!this.isFirstPage();if(i)h(o=p-c-r)?a=p-c:a=(e=o)>d&&e<r?o:r,g&&this.viewOpts.slidein&&(a+=u());else{if(g){var m=this.magPagesPos[this.currentPage.num-1];c=m?m.h:0}a=h(o=c-r)||c<r?-c:-r,g&&this.viewOpts.slidein&&(a-=this.SCROLL_SNAP-u())}this.setScrollPosition({delta:a,animate:!0})}},togglePresentationMode:function(t){!!this.isInPresentationMode!=t&&x.a.isDesktop&&(this.isPreview||(t?(Object(n.a)("body").on("keydown",this.onKeydown),this.trigger("presentationModeOn")):(Object(n.a)("body").off("keydown",this.onKeydown),this.trigger("presentationModeOff")),this.isInPresentationMode=t))},recalcBottomArrowState:function(t){this.currentPage&&t===this.currentPage&&this.navigation&&this.navigation.recalcBottomArrowState(t)},setScrollPosition:function(t){var e;this.currentPage&&("vertical"==this.viewOpts.viewertype?(e=void 0!==t.offset?this.magPagesPos[this.currentPage.num].y+t.offset:this.getScroll()+t.delta,t.animate?this.$magScrollAnimate.animate({scrollTop:e},500):this.setScroll(e)):(e=void 0!==t.offset?t.offset:this.currentPage.$scrollWrapper.scrollTop()+t.delta,t.animate?this.currentPage.$scrollWrapper.animate({scrollTop:e},500):this.currentPage.$scrollWrapper.scrollTop(e)))},getScrollPosition:function(){if(!this.currentPage)return 0;return"vertical"==this.viewOpts.viewertype?Math.max(this.getScroll()-this.magPagesPos[this.currentPage.num].y,0):this.currentPage.$scrollWrapper.scrollTop()},getScroll:function(){return this.$magScrollContainer&&this.$magScrollContainer.scrollTop()},setScroll:function(t){this.$magScrollContainer&&this.$magScrollContainer.scrollTop(t)},onMagScroll:function(){if(!(document.fullscreenElement||document.webkitFullscreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement)){s.a.isFunction(this._resetUrlStringTimeoutFunc)&&this._resetUrlStringTimeoutFunc(),this.pauseWidgetsLoadingOnScroll();var t=this.findPageOnCurrentMagScroll({pageStartsOnBottom:this.isStickyVerticalViewer&&!x.a.isDesktop}),e=this.getScrollParams(t);if(this.lastPageScroll=e.pageScroll,this.lastPageScrollPercent=e.pageScrollPercent,this.showPage(t.page.num,e),this.finalPage&&!this.isStickyVerticalViewer&&(null!=t.finalPageScroll?this.finalPage.scrollOnVerticalMode(t.finalPageScroll):this.finalPage.resetScrollOnVerticalMode()),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!0,scroll:this.getScroll()}),this.trigger("mag scroll",this.getScroll()),this.finalPage&&this.isStickyVerticalViewer){var i=this.getScroll(),n=this.magPagesPos[this.pages.length],o=n.y+n.h-this.getContainerSizeCached().height;this.trigger(i>o?"finalPageShown":"finalPageHidden")}if(this.$bottomArrow&&+this.magOpenTime+2e3<+new Date){this.$bottomArrow.addClass("offscreen");var a=this.$bottomArrow;delete this.$bottomArrow,setTimeout((function(){a.remove()}),400)}}},scrollMagALittle:function(){this.$magScrollAnimate.animate({scrollTop:this.getScroll()+this.getContainerSizeCached().height},500)},findPageOnCurrentMagScroll:function(t){t=t||{};var e,i,n,o,a=this.getScroll(),s=this.getContainerSizeCached(),r=(a=Math.min(Math.max(a,0),this.magHeight-s.height),this.pages.length),l=a+(t.pageStartsOnBottom?s.height-50-16-16:0);for(e=0;e<r;e++){i=this.pages[e],n=this.magPagesPos[i.num];var c,d=o?o.y+o.h:n.y;if(l>=d&&l<n.y+n.h||e==r-1)return e==r-1&&(c=Math.max(a-n.y-n.h-n.dh,0)),{page:i,scroll:a,pos:n,finalPageScroll:c,finalPageShown:this.finalPage&&!(l>=d&&l<n.y+n.h)};o=n}},getScrollParams:function(t){var e=Math.max(t.scroll-t.pos.y,0),i={initiator:"scroll",pageScroll:e,pageScrollPercent:e/t.page.pageHeight};if(this.viewOpts.slidein?(i.nextPageScroll=0,i.slideInNextPageScroll=t.pos.h-i.pageScroll):i.nextPageScroll=i.pageScroll-t.pos.h,i.nextPageVisible=t.pos.h-i.pageScroll<this.getContainerSizeCached().height,this.viewOpts.slidein){var n=(t.pos.h-i.pageScroll)/this.getContainerSizeCached().height;i.nextPageBlackout=Math.min(Math.max(n,0),1)}return i},onCurrentPageScroll:function(t,e){this.pauseWidgetsLoadingOnScroll(),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.onScroll({forceApply:!this.isStickyVerticalViewer,scroll:e}),this.lastPageScroll=e,this.lastPageScrollPercent=this.lastPageScroll/t.pageHeight,this.loadPages.__debounced()},scrollCurrentPageALittle:function(){this.currentPage&&this.currentPage.scrollPageALittle()},focusCurrentPage:function(){this.currentPage&&this.currentPage.focusPage()},backToTopCurrentPage:function(){if("vertical"==this.viewOpts.viewertype){var t=this.findPageOnCurrentMagScroll();this.$magScrollAnimate.animate({scrollTop:t.pos.y},500)}else this.currentPage&&this.currentPage.backToTop();RM.analytics&&RM.analytics.sendEvent("Scroll Top Link")},scrollPageToPos:function(t,e){var i,n,o=this.getPage(t),a=this.getContainerSizeCached();e=e||0,e*=o.scale,e+=o.contentPosition.top,"vertical"==this.viewOpts.viewertype?(i=this.magPagesPos[o.num],n=Math.max(0,i.y+e),n=Math.min(n,i.y+i.h-a.height),this.$magScrollAnimate.animate({scrollTop:n},500)):(this.currentPage!=o&&this.showPage(o.num),n=Math.max(0,e),o.scrollTo(n))},pauseWidgetsLoadingOnScroll:function(){},toExternalLink:function(t){var e=Object(n.a)(t.target).closest("a").attr("href");RM.analytics&&RM.analytics.sendEvent("External Link",e)},maglink:function(t){if(2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=Object(n.a)(t.currentTarget).data("link")||Object(n.a)(t.currentTarget).attr("href");if(!e)return!1;if(t.preventDefault(),Object(n.a)(t.currentTarget).hasClass("back-to-top"))return this.backToTopCurrentPage();this.router.navigate(e,{trigger:!0})}},onGobackLinkClick:function(t){this.router.goBack()},onMailchimpLinkClick:function(t){var e,i=Object(n.a)(t.currentTarget);if(!i.hasClass("disabled")){i.flashClass("disabled",3e3);try{e=JSON.parse(i.attr("data-mailchimp"))}catch(t){e=null}e&&p.a.initMailchimpAPI((function(t){d.default.deleteCookie("MCEvilPopupClosed"),t.start(e)}))}},onAnchorLinkClick:function(t){var e=Object(n.a)(t.currentTarget),i=parseInt(e.attr("data-anchor-link-pos"),10)||0,o=e.attr("data-page-uri");i&&o&&(this.scrollPageToPos(o,i),RM.analytics&&RM.analytics.sendEvent("Anchor Link",i))},onShareLinkClick:function(t){g.share({host:(RM.common.embedDomainName||window.location.protocol+"//"+window.location.hostname)+"/",tp:Object(n.a)(t.currentTarget).attr("data-share-provider"),source:"mag links",page:this.currentPage||this.pages[0],mag:s.a.extend(this.model.toJSON(),{user:this.user}),forProject:"mag"==Object(n.a)(t.currentTarget).attr("data-share-type"),customDomain:!(!RM.common.isDomainViewer&&!RM.common.embedDomainName),customDomainProfile:!(!RM.common.customDomainProfile&&"User"!=RM.common.embedDomainType),analytics:this.router.analytics})},showPageCounter:function(t){if(this.toolbar){var e=1;this.currentPage&&(e=this.currentPage.num+(t?"left"==t?1:-1:0),e=Math.max(Math.min(e,this.getPagesCount()),1)),this.toolbar.showPageCounter(this.getPage(e),{showPageCounter:!0})}},showPage:function(t,e){e=e||{},this.active||this.render();var i=this.getPage(t),n=this.currentPage,o=i&&this.getPage(i.num+1),a=this;i&&!this.aboveGlobalWidgetsRendered&&this.renderAboveGlobalWidgets(i),this.isStickyVerticalViewer?this.redrawAboveGlobalWidgets():e.nextPageVisible||"horizontal"===this.viewOpts.viewertype?this.redrawAboveGlobalWidgets(i,o,e.slideInNextPageScroll||e.nextPageScroll,e.animation):i?this.redrawAboveGlobalWidgets(i):n&&this.redrawAboveGlobalWidgets.__debounced(),"vertical"==this.viewOpts.viewertype&&(e.animation=!1,i&&i.scrollOnVerticalMode(e.pageScroll||0),i&&o&&null!=e.nextPageScroll&&(o.scrollOnVerticalMode(e.nextPageScroll),x.a.isDesktop&&(e.nextPageVisible?o.start():o.stop())),i&&null!=e.nextPageBlackout&&this.$pages_blackout.css({display:o?"block":"none",opacity:e.nextPageBlackout,"z-index":i.getPageZIndex()}));var s=!this.currentPage;if(!s&&t===this.currentPage.num)return!1;if(!i)return 1!==t&&this.router.onError(),!1;if(n)if("horizontal"==this.viewOpts.viewertype||this.isStickyVerticalViewer)n.stop();else{o==n&&e.nextPageVisible||n.stop();var r=n&&this.getPage(n.num+1);r&&!(r==i||r==o&&e.nextPageVisible)&&r.stop()}else e.animation=!1;this.pauseLoading("page-change-animation"),this.currentPage=i,n&&n.resetWaitForAnimationEnd(),clearInterval(this.showPageCompleteInterval),this.$pages_container.toggleClass("disable-transitions",!e.animation),e.animation&&(this.viewOpts.slidein&&n&&n.num>i.num?n.waitForAnimationEnd(u):i.waitForAnimationEnd(u)),this.direction=!n||n.num<i.num?"forward":"backward";var l=i.num-this.getPreloadPageCount(i.num-1,"forward"===this.direction?"backward":"forward"),c=i.num+this.getPreloadPageCount(i.num-1,this.direction);"horizontal"!=this.opts.viewertype||this.opts.arrows||(l=c=i.num);for(var d=0;d<this.pages.length;d++){var h=this.pages[d];h.num<i.num?h.setPosition("prev",h.num+1==i.num):h.num>i.num?h.setPosition("next",h.num-1==i.num):h.setPosition("center",h.num==i.num),h.num>=l&&h.num<=c&&h.show(),"vertical"==this.viewOpts.viewertype&&(h.num<i.num||h.num>i.num+1)&&h.resetScrollOnVerticalMode()}function u(){function t(){for(var t=0;t<a.pages.length;t++){var e=a.pages[t];(e.num<l||e.num>c)&&e.hide()}!a.lastFinalPageState&&i.start(),a.loadPages()}e.animation||s||window.requestAnimationFrame((function(){a.$pages_container.removeClass("disable-transitions")})),a.continueLoading("page-change-animation"),"vertical"==a.viewOpts.viewertype&&"scroll"!=e.initiator&&a.setScroll(a.magPagesPos[i.num].y),a.isPreview&&a.$el.scrollTop(0),clearInterval(a.showPageCompleteInterval),a.loadingPaused?a.showPageCompleteInterval=setInterval((function(){a.loadingPaused||(clearInterval(a.showPageCompleteInterval),t())}),17):t()}!e.animation&&u(),this.scheduleSetUrlString({replace:!s,skipInternalHistory:e.skipInternalHistory}),this.router.setTitle(),this.trigger("pageChanged",i,{showPageCounter:e.animation||e.bySwipe||s||"scroll"==e.initiator,initial:s}),i.trigger("changedTo"),"vertical"==this.viewOpts.viewertype&&this.updateArrowsColor(i)},scheduleSetUrlString:function(){if(!Modernizr.chrome)return this.router.setUrlString.apply(this.router,arguments),this.router.trackPage(),void(this._resetUrlStringTimeoutFunc=!1);var t=arguments;this._resetUrlStringTimeoutFunc=function(){clearTimeout(this._urlStrigScheduleTimeout),this._urlStrigScheduleTimeout=setTimeout(function(){this._resetUrlStringTimeoutFunc=null,this.router.setUrlString.apply(this.router,t),this.router.trackPage()}.bind(this),100)}.bind(this),this._resetUrlStringTimeoutFunc()},goNextPage:function(t){var e=this.finalPage&&this.finalPage.shown;this.isLastPage()?e||(this.finalPage&&this.finalPage.show(),this.finalPage&&this.redrawAboveGlobalWidgets(this.finalPage)):Object(O.a)("constructor.newProjectSettings")?this.currentPage&&this.router.go(this.currentPage.num+1,Pt(Pt({},t),{},{isPageNum:!0})):this.currentPage&&this.router.go(this.currentPage.num+1,t)},goPrevPage:function(t){var e=this.finalPage&&this.finalPage.shown;if(this.isLastPage()&&e)return this.finalPage&&this.finalPage.hide(),void(this.finalPage&&this.redrawAboveGlobalWidgets(this.currentPage));this.isFirstPage()||(Object(O.a)("constructor.newProjectSettings")?this.currentPage&&this.router.go(this.currentPage.num-1,Pt(Pt({},t),{},{isPageNum:!0})):this.currentPage&&this.router.go(this.currentPage.num-1,t))},goFirstPage:function(){Object(O.a)("constructor.newProjectSettings")?this.router.go(1,{isPageNum:!0}):this.router.go(1)},goLastPage:function(){Object(O.a)("constructor.newProjectSettings")?this.router.go(this.getPagesCount(),{isPageNum:!0}):this.router.go(this.getPagesCount())},pauseLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!0,this.loadingPaused=!0},continueLoading:function(t){this.pauseReasons=this.pauseReasons||{},this.pauseReasons[t]=!1,this.loadingPaused=!s.a.every(s.a.values(this.pauseReasons),(function(t){return!t}))},loadPages:function(){if(this.pages&&this.pages.length){var t=this.getPagesLoadOrder();if(t&&t.length){var e,i,n=[],o=[];for(e=0;e<t.length;e++){var a=(i=this.pages[t[e]]).getWidgetsPacks();a.length&&n.push(a),o=o.concat(i.getImmediatePack())}if(n.length){var s=[];for(e=0;e<n.length;e++){0==e&&l(e,0),l(e+1,0);for(var r=1;r<n[e].length;r++)l(e,r)}s.unshift(o),this.widgetsPacksLoadQueue=s,this.stopPagesLoad(),this.loadNextWidgetsPack()}}}function l(t,e){t<0||t>=n.length||e<0||e>=n[t].length||s.push(n[t][e])}},stopPagesLoad:function(){clearTimeout(this.loadNextWidgetsTimer)},loadNextWidgetsPack:function(){if(this.widgetsPacksLoadQueue.length)if(this.loadingPaused)this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,50);else{var t=this.widgetsPacksLoadQueue.shift();if(t.length){var e=s.a.uniq(s.a.map(t,"page")),i=e[0];if(1!==e.length||i.shown&&!i.loaded){this.widgetPackCount;i.loadWidgetsPack(t,s.a.bind((function(){this.widgetPackCount++,this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}),this))}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}else this.loadNextWidgetsTimer=setTimeout(this.loadNextWidgetsPack,17)}else a.a.trigger("widgetsQueue:empty",this.num_id)},getPreloadPageCount:function(t,e){if("horizontal"==this.viewOpts.viewertype)return this.PRELOAD_COUNT[e];for(var i=1,n=0,o="forward"==e?1:-1;n<this.PRELOAD_COUNT[e]&&i*o+t<this.pages.length&&i*o+t>=0;)n+=this.pages[i*o+t].height,i++;return i},getPagesLoadOrder:function(){var t=this.currentPage;if(t){var e,i=t.num-1,n=this.pages.length,o=[],a=this,s=t.num-this.getPreloadPageCount(i,"forward"==this.direction?"backward":"forward"),r=t.num+this.getPreloadPageCount(i,this.direction);if(l(i),"backward"==this.direction){for(l(i-1),l(i+1),e=i-2;e>=s;e--)l(e);for(e=i+2;e<=r;e++)l(e)}else{for(l(i+1),l(i-1),e=i+2;e<=r;e++)l(e);for(e=i-2;e>=s;e--)l(e)}return o}function l(t){t<0||t>=n||!a.pages[t].shown||a.pages[t].loaded||o.push(t)}},onGestureChange:function(){this.onResize.__debounced()},checkFullscreen:function(){this.fullscreenCheckCounter=5,clearInterval(this.fullscreenCheckTimer),this.fullscreenCheckTimer=setInterval(s.a.bind((function(){var t=window.fullScreen||window.innerWidth==screen.width&&window.innerHeight>=screen.height-1;this.togglePresentationMode(t),this.fullscreenCheckCounter--,this.fullscreenCheckCounter||clearInterval(this.fullscreenCheckTimer)}),this),500)},onResize:function(t){if(this.checkFullscreen(),!x.a.isDesktop&&"horizontal"==this.viewOpts.viewertype||"vertical"==this.viewOpts.viewertype&&!this.isStickyVerticalViewer){var e="horizontal"==this.viewOpts.viewertype?Object(n.a)("html, body").add(this.$el):this.$el,i=d.default.isPageNativelyScaled(),o=window.innerHeight;337==o&&414==Object(n.a)(window).height()&&o++,e.height(i?"100%":o),!i&&e.scrollTop(0)}var a=this.getContainerSize(),r=this.isPortrait()?"portrait":"landscape",l=!1;if(!x.a.isDesktop&&this.prevOrientation&&this.prevOrientation!=r&&(this.switchToViewport(this.getMagViewport()),this.setPagesTransitions(),this.stopPagesLoad(),l=!0,setTimeout(this.onResize,300),setTimeout(this.onResize,1500)),this.prevOrientation=r,this.isPreview&&"default"!=this.viewport){var c=Math.round((this.$el.width()-a.width)/2),h=Math.round((this.$el.height()-a.height)/2);this.$mag_container.add(this.$mag_viewport_device).css({top:Math.max(h,0),left:Math.max(c,0),width:a.width,height:a.height})}else this.$mag_container.add(this.$mag_viewport_device).css({top:"",left:"",width:"",height:""});this.$mag_viewport_device.attr("data-viewport",this.viewport),this.setNewPagesWidths(a.width,a.height),this.magHeight=0,this.magPagesPos=[];var u=this.pages&&this.pages.length;if(s.a.each(this.pages,s.a.bind((function(t,e){var i=t.onResize({absolutePosition:this.magHeight}),n=0;(e<u-1||this.finalPage)&&this.viewOpts.slidein&&(n=this.SCROLL_SNAP),this.magPagesPos[t.num]={y:this.magHeight,h:i,dh:n},this.magHeight+=i+n}),this)),this.finalPage&&(this.isStickyVerticalViewer&&this.finalPage.setSizeAndPosForStickyVersion({absolutePosition:this.magHeight}),this.magHeight+=this.finalPage.getHeight()),"vertical"===this.viewOpts.viewertype&&this.magHeight){var p=this.$magScrollSizer.width(),g=0;if(this.isPreview&&"default"!==this.viewport&&(g=Math.max(this.$el.height()-this.getViewportSetting("min_height"),0)),this.$magScrollSizer.css("height",this.magHeight+g),p!=this.$magScrollSizer.width()&&x.a.isDesktop&&this.onResize(),this.currentPage)if(this.isStickyVerticalViewer){if(l){var m=this.getScrollPosForNewSize();setTimeout(s.a.bind((function(){this.setScroll(m)}),this),0)}}else this.setScroll(this.getScrollPosForNewSize()),this.onMagScroll();this.$bottomArrow&&this.$bottomArrow.toggleClass("offscreen",this.getScroll()+a.height+this.SCROLLABLE_TRESHOLD>this.magHeight)}if("horizontal"==this.viewOpts.viewertype&&this.currentPage&&l){m=this.getScrollPosForNewSize();setTimeout(s.a.bind((function(){this.currentPage.$scrollWrapper.scrollTop(m)}),this),0),this.aboveGlobalWidgetsRendered||setTimeout(s.a.bind((function(){this.aboveGlobalWidgetsRendered||this.renderAboveGlobalWidgets(this.currentPage)}),this),40)}this.currentPage&&this.loadPages.__debounced()},onOptsChange:function(){window.dispatchEvent(new Event("resize"))},getScrollPosForNewSize:function(){return this.currentPage?"vertical"==this.viewOpts.viewertype?this.magPagesPos[this.currentPage.num].y+(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:(this.lastPageScrollPercent||0)*this.currentPage.pageHeight:0},setNewPagesWidths:function(t,e){var i=this.$el.find("#page-position-style"),o=x.a.isDesktop?"":" translateZ(0)",a="        .mag .mag-pages-container .container {\n          left: 0px;\n          width: "+t+"px;\n        }\n        .mag .mag-pages-container .container .page {\n          left: 0px;\n          width: "+t+"px;\n        }\n        .mag .mag-pages-container .container .final-page {\n          left: 0px;\n          width: "+t+"px;\n        }\n",s="";if("horizontal"==this.viewOpts.viewertype)s="          .mag .mag-pages-container .container .final-page.offscreen {\n            -webkit-transform: translateX("+t+"px) "+o+";\n            transform: translateX("+t+"px) "+o+";\n          }\n          .mag .mag-pages-container .container .page.prev-page {\n            -webkit-transform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+o+";\n            transform: translateX("+(this.viewOpts.slidein?0:-t)+"px) "+o+";\n          }\n          .mag .mag-pages-container .container .page.center-page {\n            -webkit-transform: translateX(0) "+o+";\n            transform: translateX(0) "+o+";\n          }\n          .mag .mag-pages-container .container .page.next-page {\n            -webkit-transform: translateX("+t+"px) "+o+";\n            transform: translateX("+t+"px) "+o+";\n          }";else if(this.isStickyVerticalViewer){var r=this.getContainerSizeCached().height;s="            .mag .mag-pages-container .container .page .page-fixed-bg-container,            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top {              height: "+r+"px;            }\n            .mag .mag-pages-container .container .page .fixed-position-container,            .mag .mag-pages-container .container .page .fixed-position-container-top,            .mag .mag-pages-container .container .page:not(.hide-sticky) .content-scroll-wrapper {              margin-top: "+-r+"px;            }\n"}else s="            .mag .mag-pages-container .container .final-page {\n              top: "+(e+1)+"px;            }\n            .mag .mag-pages-container .container .page.prev-page {\n              top: "+(-e-1)+"px;            }\n            .mag .mag-pages-container .container .page.next-page {\n              top: "+(e+1)+"px;            }\n";i.length||(i=Object(n.a)('<style id="page-position-style" type="text/css">')).appendTo(this.$el),"horizontal"==this.viewOpts.viewertype?(this.$pages_container.addClass("disable-transitions-on-resize"),i.text(a+s),this.$pages_container.height(),this.$pages_container.removeClass("disable-transitions-on-resize")):i.text(a+s)},setPagesTransitions:function(){var t=this.$el.find("#page-transition-style"),e=this.getPageTransitionTime(),i="cubic-bezier(0.40, 0.24, 0.40, 1)",o="        .mag .mag-pages-container .container .page {\n          -webkit-transition:\tall "+e+"ms "+i+";          transition: all "+e+"ms "+i+";        }\n        .mag .mag-pages-container .container .page.center-page {\n          -webkit-transition:\tall "+(e-5)+"ms "+i+";          transition: all "+(e-5)+"ms "+i+";        }\n        .mag .mag-pages-container .container .final-page {\n          -webkit-transition:\tall "+e+"ms "+i+";          transition: all "+e+"ms "+i+";        }\n        ";t.length||(t=Object(n.a)('<style id="page-transition-style" type="text/css">')).appendTo(this.$el),t.text(o)},switchToViewport:function(t){if(this.viewport!=t){var e=this.viewport;this.containerSize=null,this.viewport=t,this.trigger("change:viewport",{viewport:this.viewport,oldViewport:e}),this.aboveGlobalWidgetsRendered=!1,this.aboveGlobalWidgets&&this.aboveGlobalWidgets.forEach((function(t){t.destroy(),t.off()})),this.aboveGlobalAnimations&&this.aboveGlobalAnimations.destroy(),this.aboveGlobalWidgets=[],s.a.each(this.pages,(function(t){t.updateViewport()}))}},getContainerSize:function(){var t,e,i=this;return this.isPreview&&"default"!=this.viewport?(t=this.getViewportSetting("width"),e=Math.min(this.getViewportSetting("min_height"),this.$el.height())):(t=RM.screenshot?Object(n.a)(window).width():this.$el.width(),e=RM.screenshot?window.innerHeight:this.isStickyVerticalViewer&&Modernizr.safari&&!x.a.isDesktop?i.isPortrait()?Math.max(window.innerHeight,screen.height-20-20+1):Math.min(screen.width,screen.height):this.isStickyVerticalViewer?window.innerHeight:this.$el.height()||window.innerHeight),this.containerSize={width:t,height:e},this.containerSize},getContainerSizeCached:function(){return this.containerSize||this.getContainerSize()},isPortrait:function(){return window.screen?window.screen.orientation&&window.screen.orientation.type?!!window.screen.orientation.type.match(/portrait/i):0===window.orientation||90!==window.orientation&&-90!==window.orientation&&window.innerWidth<window.innerHeight:window.innerWidth<window.innerHeight},getMagViewport:function(){var t=this.isPortrait();if(this.isPreview)return this.constructorViewport||"default";var e=_.a.Default,i=window.innerWidth;if(Modernizr.retina||!x.a.isDesktop||Modernizr.ismobile){if(screen&&screen.width&&(i=t?Math.min(screen.width,screen.height):Math.max(screen.width,screen.height)),t)return i<600?_.a.PhonePortrait:i>=600&&i<=1024?_.a.TabletPortrait:_.a.Default;if(i>980)return _.a.Default}if(Modernizr.isipad)return t?_.a.TabletPortrait:_.a.Default;if(!x.a.isDesktop){var n=i,o=s.a.reduce(_.b.viewports,(function(t,e,i){return Math.abs(e.width-n)<=Math.abs(_.b.viewports[t].width-n)?i:t}),0);e=_.b.viewports[o].name}return e},getViewportSetting:function(t,e){return e=e||this.viewport,(s.a.findWhere(_.b.viewports,{name:e})||{})[t]},log:function(){for(var t="",e=0;e<arguments.length;e++)t+=arguments[e]+" ";var i=Object(n.a)("#log");i.length||(i=Object(n.a)('<div id="log">').css({position:"fixed",background:"rgba(0, 0, 0, 0.7)",color:"#fff",width:200,height:300,left:10,top:10,"z-index":999999,overflow:"auto"}).appendTo("body"));var o=i.html(),a=o.split("<br>");i.html(a.slice(-17).join("<br/>")+"<br/>"+t),i.scrollTop(999999)},fixFocusScroll:function(){this.$mag_container.scrollTop(0),this.$mag_container.scrollLeft(0)},matchSameDomainLink:function(t){var e=t.match(new RegExp("//"+d.default.escapeSpecial(window.location.hostname)+"/(.*)")),i=e&&e[1];if(i){var n=Object(O.a)("constructor.newProjectSettings")?this.getPageByPath(i):this.getPage(i);if(n)return n._id}return t},getScale:function(t){if(RM.screenshot)return 1;var e=Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),i=e/this.getViewportSetting("width",t);return e<this.getContainerSizeCached().width&&v.a.isScaleLayout()&&!Modernizr.firefox&&this.$el.find(".page-content-container").addClass("scale-centring"),v.a.normalize(i)},getWidgetById:function(t,e){var i,n,o=e&&e.getWidgetDataById(t)?e:s.a.find(this.pages,(function(e){return e.getWidgetDataById&&e.getWidgetDataById(t)}));return o?(n=o.getWidgetById(t))?i=window.Promise.resolve(n):o.loaded||(i=new window.Promise(function(e,i){this.listenToOnce(o,"loaded"+t,(function(){var n=o.getWidgetById(t);n?e(n):i()}))}.bind(this))):s.a.find(this.aboveGlobalWidgetsData,{_id:t})&&((n=s.a.find(this.aboveGlobalWidgets,{_id:t}))?i=window.Promise.resolve(n):this.aboveGlobalWidgetsRendered||(i=new window.Promise(function(e,i){this.listenToOnce(this,"aboveGlobalWidgetsRendered",(function(){var n=s.a.find(this.aboveGlobalWidgets,{_id:t});n?e(n):i()}))}.bind(this)))),i||window.Promise.reject()},renderAboveGlobalWidgets:function(t){var e=[],i=t.pageViewport;s.a.each(this.aboveGlobalWidgetsData,function(n){var o,a=s.a.find(this.aboveGlobalWidgets,{_id:n._id});if(a&&(a.destroy(),a.off()),n){var r=t.getWidgetViewportData(n,i),l=!this.isPreview&&f.a.hasExpired(r);y.a[r.type]&&!l&&((o=new y.a[r.type](r,t)).$fixedContainer=this.$aboveWidgetsContainer,o.isValid()&&e.push(o))}}.bind(this)),this.aboveGlobalAnimations=this.initializeAboveGlobalAnimation(e,t),s.a.each(e,(function(t){t.render(),t.hidden?m.a.hide(t,!0):m.a.show(t,!0)})),this.aboveGlobalWidgets=s.a.sortBy(e,"y"),this.aboveGlobalWidgetsRendered=!0,this.trigger("aboveGlobalWidgetsRendered")},initializeAboveGlobalAnimation:function(t,e){t=s.a.isArray(t)?t:[t],e.scale=this.getScale(e.pageViewport);var i=new w.a({page:e,widgets:t}),n=[];return s.a.each(t,(function(t){var e=new window.Promise((function(e){t.loaded?e(t):t.on("loaded",e.bind(null,t))}));n.push(e)})),window.Promise.all(n).then(function(){this.aboveAnimationsReady=!0,this.trigger("aboveAnimationsReady")}.bind(this)),this.listenTo(e,"resize",(function(t){s.a.isUndefined(t.prevScale)||t.prevScale===t.scale||i.updateTimelines(),i.onResize({updateAll:!0})})),i},updateAboveGlobalViewport:function(t,e){var i=s.a.find(this.aboveGlobalWidgetsData,{_id:t._id}),n=e.getWidgetViewportData(i,e.pageViewport);if(t.animationObj&&this.aboveGlobalAnimations.removeAnimation(t.animationObj),t.destroy(),t.initialize(n,e),t.hasAnimation()){var o=this.aboveGlobalAnimations.addAnimation(t);o&&o.start()}t.render(),m.a.hide(t,!0)},getAboveGlobalBox:function(t,e,i){var n=s.a.find(this.aboveGlobalWidgetsData,{_id:t}),o=e.getWidgetViewportData(n,e.pageViewport);return d.default.getFixedPositionBox(o.fixed_position,s.a.pick(o,["x","y","w","h"]),e.scale,i)},redrawAboveGlobalWidgets:function(t,e,i,n){if(!t){var o=s.a.isUndefined(this.getScroll())?void 0:this.findPageOnCurrentMagScroll(),a=o&&o.page.num,r=o&&this.getScrollParams(o);t=a&&this.getPage(a),e=t&&this.getPage(t.num+1),i=r&&(r.slideInNextPageScroll||r.nextPageScroll),n=r&&r.animation}i=s.a.isUndefined(i)?void 0:Math.abs(i);var l={width:Math.min(this.viewOpts.scalewidth,this.getContainerSizeCached().width),height:this.getContainerSizeCached().height},c=function(t,e){return!t.page||e&&t.page.pageViewport!==e.pageViewport};if(s.a.isUndefined(i)){var h=this.getPageTransitionTime();s.a.each(this.aboveGlobalWidgets,function(e){var i=t._id&&!m.a.isHidden(e,t._id,this.isPreview),o=t._id&&c(e,t);t._id&&e.updatePage(t),o&&this.updateAboveGlobalViewport(e,t),i?n?e.wasHidden&&d.default.waitForTransitionEnd(t.$el,h,"transform",m.a.show.bind(null,e)):e.wasHidden&&m.a.show(e):!e.wasHidden&&m.a.hide(e)}.bind(this))}else{var u=Math.abs(i);s.a.each(this.aboveGlobalWidgets,function(i){var n=!m.a.isHidden(i,t._id,this.isPreview),a=e&&!m.a.isHidden(i,e._id,this.isPreview),s=n&&a&&t.pageViewport===e.pageViewport,r=this.getAboveGlobalBoxMemoized(i._id,t,l),d=this.getAboveGlobalBoxMemoized(i._id,e||t,l),h=!x.a.isDesktop&&o&&o.finalPageScroll&&o.finalPageScroll>0,p=n&&u>r.top+r.height&&!h,g=e&&a&&d.top>u,f=!e&&n&&(!t.mag.viewOpts.endpage||!!o&&void 0===o.finalPageScroll);if(p||g||s||f){var v=p?t:g?e:i.page,b=c(i,v);i.updatePage(v),b?(i.rendered=!1,m.a.hide(i).then(function(){this.updateAboveGlobalViewport(i,v),m.a.show(i)}.bind(this))):i.wasHidden&&m.a.show(i)}else!i.wasHidden&&m.a.hide(i)}.bind(this))}},getUsedFonts:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u.a.getUsedFontsFromWidgetsModels(Pt(Pt({},t),{},{models:this.pages.reduce((function(t,e){return e.widgets.reduce((function(t,e){return t.push(e)&&t}),t)}),[]),customList:t.includeCustom?s.a.filter(this.edit_params&&this.edit_params.fonts,{provider:"custom"}):[]}))},hasCodeInjection:function(){var t=this;if(s.a.any(["ci_head","ci_body_top","ci_body_bottom","ci_css"],(function(e){return!!t[e]})))return!0;var e=!1;return s.a.each(this.pages,(function(t){s.a.each(t.widgetsData,(function(t){var i=!("iframe"!==t.type||!t.code);if(i&&!t.use_iframe){var n="codeinjection"===Ct.a.matchCode(t.code,t);if(n){var o=!(!s.a.all(_.b.viewport_listall,(function(e){var i=t[e];return i&&i.hidden||!i}))||!t.hidden);i&&n&&!o&&(e=!0)}}}))})),e}});e.a=$t},bXDN:function(t,e,i){},bl1U:function(t,e,i){},btdP:function(module,exports){module.exports={"template-constructor-control-picture-color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},cBBe:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("gHxz"),l=i.n(r),c=i("OTSC"),d=a.a.View.extend({TIP_GAP:15,initialize:function(t){t&&(s.a.bindAll(this),this.block=t.block,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,this.template=l.a["template-common-hotspot-widget"],this.render())},render:function(){this.setElement(Object(n.a)(this.template({data:this.model}))),"viewer"===this.environment&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&0===t.height&&(t.height=120),t&&this.$(".tip").css(t)},apply_tip_bg_color:function(t){this.$(".blocks-wrapper").css("background-color",c.default.getRGBA(t["tip_background-color"],t["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t){var e,i=this.$(".tip"),n=t.tip_pos,o=t.tip_w,a=t.tip_h||120,s=t.w,r=t.h,l="",c="",d=this.TIP_GAP;return"top"===n?(l=-(d+a),c=s/2-o/2):"right"===n?(l=r/2-a/2,c=s+d):"bottom"===n?(l=r+d,c=s/2-o/2):"left"===n&&(l=r/2-a/2,c=-(d+o)),e={top:l,left:c},i.css(e),e},destroy:function(){this.remove()}});e.a=d},csmR:function(module,exports){module.exports={"template-common-audio-player-standard":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<iframe class="common-audio-player standard" width="100%" height="100%" scrolling="no" frameborder="no" src="'+(null==(__t=src)?"":_.escape(__t))+'"></iframe>\n';return __p},"template-common-audio-player-minimal":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player minimal loading">\n\n\t\t<div class="sc-artwork-list">\n\t\t\t<div class="sc-loaded-artwork"></div>\n\t\t\t<div class="sc-artworks-overlay"></div>\n\t\t</div>\n\n\t\t<div class="sc-info">\n\t\t\t<h3></h3>\n\t\t\t<h4></h4>\n\t\t</div>\n\n\t\t<div class="sc-scrubber no-rmswipe">\n\t\t\t<div class="sc-hover-indicator"></div>\n\t\t\t<div class="sc-time-span">\n\t\t\t\t<div class="sc-buffer"></div>\n\t\t\t\t<div class="sc-played"></div>\n\t\t\t\t<div class="sc-button-wrapper">\n\t\t\t\t\t<div class="sc-button">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="12" height="12"><path d="M0 0 L12 6 L0 12  Z " style="fill:#1d1a1b; stroke:none; stroke-width:0"></path></svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="sc-time-indicators">\n\t\t\t\t<span class="sc-left"></span>\n\t\t\t</div>\n\t\t</div>\n\n\t</div>\n';return __p},"template-common-audio-player-engine-html5":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<audio preload="auto"></audio>\n\t</div>\n';return __p},"template-common-audio-player-engine-flash":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'">\n\t\t\t<embed allowscriptaccess="always" height="100%" width="100%" src="'+(null==(__t=swf)?"":__t)+'" type="application/x-shockwave-flash" name="'+(null==(__t=id)?"":_.escape(__t))+'" />\n\t    </object>\n\t</div>\n';return __p},"template-common-audio-player-engine-flash-ie":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-audio-player-engine">\n\t\t<object height="100%" width="100%" id="'+(null==(__t=id)?"":_.escape(__t))+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" data="'+(null==(__t=swf)?"":_.escape(__t))+'">\n\t\t\t<param name="movie" value="'+(null==(__t=swf)?"":_.escape(__t))+'" />\n\t\t\t<param name="allowscriptaccess" value="always" />\n\t\t</object>\n\t</div>\n';return __p}}},"cx/9":function(t,e,i){},djzF:function(t,e,i){"use strict";var n=i("7OA4");i.n(n).a},dptL:function(t,e,i){"use strict";i.r(e);var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("q7tt"),l=i("R31J"),c=i.n(l),d=i("MAfP"),h=i.n(d),u=i("q5gH"),p=i("m41J"),g=u.a.extend({baseDimension:"width",initialize:function(t){u.a.prototype.initialize.apply(this,arguments),this.setSizeConstraints()},setSizeConstraints:function(){var t=this.getLimits();this.minwidth=Math.max(15,t.minwidth||0),this.minheight=Math.max(15,t.minheight||0),this.maxwidth=Math.min(1/0,t.maxwidth||1/0),this.maxheight=Math.min(1/0,t.maxheight||1/0)},getLimits:function(){var t=this.block.getModelBox(),e=this.block.isFullWidth()?"height":this.baseDimension,i=s.a.reduce(this.block.blocks,(function(t,i){var n=i.getModelBox(),o={minwidth:i.frame&&i.frame.minwidth,minheight:i.frame&&i.frame.minheight,maxwidth:i.frame&&i.frame.maxwidth,maxheight:i.frame&&i.frame.maxheight};if(i.proportional&&(o=p.a.getBoxLimits(n,o)),i.frame&&i.frame.applyExtraConstraints){var a=i.frame.applyExtraConstraints({width:o.minwidth,height:o.minheight});o.minwidth=a.width,o.minheight=a.height}var s=n.angle?p.a.calcBoundingBox(n,!1,!0):n,r=(n.angle?s[e]:n[e])/o["min"+e],l=(n.angle?s[e]:n[e])/o["max"+e];return{min:Math.min(r,t.min),max:Math.max(l,t.max)}}),{min:1/0,max:0});return{minwidth:t.width/i.min,minheight:t.height/i.min,maxwidth:t.width/i.max,maxheight:t.height/i.max}},show:function(t){s.a.each(this.block.blocks,(function(t){t.frame.hide()})),u.a.prototype.show.apply(this,arguments)},onResizeStart:function(t,e){u.a.prototype.onResizeStart.apply(this,arguments),s.a.each(this.block.blocks,(function(i){i.frame.onResizeStart(t,e,{isGroupResize:!0})}))},onResizeEnd:function(t,e){u.a.prototype.onResizeEnd.apply(this,arguments),s.a.each(this.block.blocks,(function(i){i.frame.onResizeEnd(t,e,{skipHistory:!0,skipPersist:!0,isGroupResize:!0})}))},doResize:function(t,e,i,n){this.block.line&&this.block.line.update(t,this.block.isVisible(),this.block.model.get("fixed_position"),this.block.model.getViewport());var o=this.block.getModelBox(),a=this.resizeBlock.bind(this,o,t,i,n),r=s.a.map(this.block.blocks,a),l=p.a.getBoundingBoxOfBoxes(r);return this.block.css(s.a.extend({},l,{doNotRedrawPacksFrames:!0}),this.currentResizePoint),l},resizeBlock:function(t,e,i,n,o){var a=o.getModelBox(),r=a.angle,l=r?p.a.calcBoundingBox(a,!1,!0):a,c=p.a.getResizedBoxNested(l,t,e,this.block.isFullWidth()?"height":null);c=o.frame.applyConstraints(c,{direction:i,fromCenter:n,packBox:e,ratio:r?l[this.baseDimension]/l["width"===this.baseDimension?"height":"width"]:o.ratio,baseDimension:this.baseDimension});var d=r?p.a.getResizedBoxByBB(a,l,c):c;return o.css(s.a.extend({},{left:Math.round(d.left),top:Math.round(d.top),width:Math.round(d.width),height:Math.round(d.height)},{doNotRedrawPacksFrames:!0,isGroupResize:!0,groupedIds:"hotspot"===o.model.get("type")?s.a.map(this.block.blocks,"id"):[]})),o.recalcFixedLine(),o.recalcStickedLine(),c}});function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"WidgetPackModel",(function(){return b})),i.d(e,"WidgetPack",(function(){return _}));var b=a.a.Model.extend({defaults:{type:"pack",visible:!1,x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,r:Number.NEGATIVE_INFINITY,b:Number.NEGATIVE_INFINITY,w:0,h:0,aspect:null,angle:0,fixed_position:null,is_full_width:!1,is_full_height:!1,flip_v:!1,flip_h:!1,sinAngle:0,cosAngle:1,viewport:"default"},getViewport:function(){return this.get("viewport")},reset:function(){this.set(this.defaults)}}),_=r.a.extend({id:null,blocks:null,workspace:null,latestPosSizeAngle:null,frame:null,line:null,proportional:!0,initialize:function(t){s.a.bindAll(this),this.blocks=[],this.latestPosSizeAngle={},this.model=new b,this.workspace=t.workspace},render:function(){var t=c.a["template-pack"]({id:this.id,templates:f({},h.a)});return this.setElement(Object(n.a)(t)),this.bindHandlers(),this.frame=new g({packId:this.id,block:this,blocks:this.blocks}),this.rendered=!0,this.$el},getCss:function(t,e){var i=this.model.attributes;return{left:i.x+(i.fixed_position?t:0),top:i.y+(i.fixed_position?e:0),width:i.w,height:i.h,position:i.fixed_position?"fixed":"absolute","z-index":i.fixed_position?999:void 0}},update:function(){var t=this.getCss(this.workspace.position.left,this.workspace.position.top);this.$el.css(t),this.isVisible()&&!this.frame.isFrameVisible()?this.frame.show():this.isVisible()||this.frame.hide(),this.$el.toggleClass("fixed-frame",this.isFixed()),this.$el.toggleClass("full-width",this.isFullWidth()),this.$el.toggleClass("full-height",this.isFullHeight()),this.recalcFixedLine()},recalcFixedLine:function(t){var e=this.model.get("fixed_position")||this.restoreFixed,i=this.isVisible()||t;e&&i&&!this.isSelection()?this.updateFixedLine(e):this.removeFixedLine()},destroy:function(){this.removeFixedLine(),r.a.prototype.destroy.apply(this,arguments)},bindHandlers:function(){var t=Object(n.a)(this.$el);t.drag("start",this.onDragStart,{not:".no-drag"}),t.drag(this.onDragMove,{delay:100}),t.drag("end",this.onDragEnd),t.on("click",this.onPackClick)},addBlock:function(t){if(this.blocks.push(t),!t.isPackFrameHidden){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0}),i=Math.min(this.model.get("x"),e.bb_x),n=Math.min(this.model.get("y"),e.bb_y),o=Math.max(this.model.get("b"),e.bb_y+e.bb_h),a=Math.max(this.model.get("r"),e.bb_x+e.bb_w),r=t.model.get("fixed_position"),l=t.model.get("is_full_width"),c=t.model.get("is_full_height");this.model.set({y:n,x:i,b:o,r:a,w:a-i,h:o-n,visible:s.a.every(this.blocks,"selected"),fixed_position:r||this.model.get("fixed_position"),is_full_width:l||this.model.get("is_full_width"),is_full_height:c||this.model.get("is_full_height"),viewport:t.model.getViewport()}),t.recalcFixedLine(),this.frame&&this.frame.setSizeConstraints()}this.latestPosSizeAngle=this.getModelBox()},reset:function(){this.blocks=[],this.model.reset()},isFixed:function(){return Boolean(this.model.get("fixed_position"))},isSelection:function(){return"selected"===this.id},isVisible:function(){return Boolean(this.model.get("visible"))},export:function(){return s.a.extend({},this.model.attributes,{id:this.id})},onDragStart:function(t,e){this.anyBlockInPackForDragging=s.a.first(this.blocks),r.a.prototype.onDragStart.call(this.anyBlockInPackForDragging,t,e)},onDragMove:function(t,e){this.anyBlockInPackForDragging&&r.a.prototype.onDragMove.call(this.anyBlockInPackForDragging,t,e)},onDragEnd:function(t,e){this.anyBlockInPackForDragging&&r.a.prototype.onDragEnd.call(this.anyBlockInPackForDragging,t,e)},onPackClick:function(t){this._justResized?this._justResized=!1:window.suppressClick&&window.suppressClick>+new Date||this.trigger("click",t)},restoreFixedPosition:function(){r.a.prototype.restoreFixedPosition.apply(this,arguments),s.a.each(this.blocks,(function(t){t.restoreFixedPosition()}))},getBoxData:function(t){var e=r.a.prototype.getBoxData.apply(this,arguments);return e.b=e.y+e.h,e.r=e.x+e.w,e},getHotspotExternalPeerIds:function(){var t=s.a.map(this.blocks,"id");return s.a.reduce(this.blocks,(function(e,i){var n="hotspot"===i.model.get("type")&&s.a.difference(i.getPeerIds(),t);return s.a.each(n,(function(t){-1===e.indexOf(t)&&e.push(t)})),e}),[])},getHotspotPeerData:function(){var t=this.getHotspotExternalPeerIds();return s.a.map(t,function(t){var e=this.workspace.findBlock(t);return s.a.extend({},e.getSaveBoxData(),{_id:t})}.bind(this),{})},saveBox:function(t,e){var i=s.a.pick(this.getBoxData(),["w","h","x","y"]);this.model.set(i);var n=s.a.map(this.blocks,function(t){return s.a.extend({},t.getSaveBoxData(),{_id:t.id})}.bind(this));n=s.a.uniq([].concat(n,this.getHotspotPeerData(),e||[]),(function(t){return t._id})),this._saveXHR&&this._saveXHR.abort(),this.workspace.set_group(n,s.a.extend({isGroupResize:!0},t)),this.workspace.save_group(n,s.a.extend({isGroupResize:!0},t))}})},eN9J:function(module,exports,__webpack_require__){var require;!function(){var requirejs,require,define,__inflate;(function(t){function e(t,e){var i,n,o,a,s,r,l,c=e&&e.split("/"),d=h.map,u=d&&d["*"]||{};if(t&&"."===t.charAt(0)&&e){for(t=(c=c.slice(0,c.length-1)).concat(t.split("/")),s=0;l=t[s];s++)if("."===l)t.splice(s,1),s-=1;else if(".."===l){if(1===s&&(".."===t[2]||".."===t[0]))return!0;s>0&&(t.splice(s-1,2),s-=2)}t=t.join("/")}if((c||u)&&d)for(s=(i=t.split("/")).length;s>0;s-=1){if(n=i.slice(0,s).join("/"),c)for(r=c.length;r>0;r-=1)if((o=d[c.slice(0,r).join("/")])&&(o=o[n])){a=o;break}if(a=a||u[n]){i.splice(0,s,a),t=i.join("/");break}}return t}function i(e,i){return function(){return l.apply(t,p.call(arguments,0).concat([e,i]))}}function n(t){return function(e){c[t]=e}}function o(e){if(d.hasOwnProperty(e)){var i=d[e];delete d[e],u[e]=!0,r.apply(t,i)}if(!c.hasOwnProperty(e))throw new Error("No "+e);return c[e]}function a(t,i){var n,a,s=t.indexOf("!");return-1!==s?(n=e(t.slice(0,s),i),t=t.slice(s+1),t=(a=o(n))&&a.normalize?a.normalize(t,function(t){return function(i){return e(i,t)}}(i)):e(t,i)):t=e(t,i),{f:n?n+"!"+t:t,n:t,p:a}}function s(t){return function(){return h&&h.config&&h.config[t]||{}}}var r,l,c={},d={},h={},u={},p=[].slice;r=function(e,r,l,h){var p,g,m,f,v,b,_=[];if(h=h||e,"string"==typeof l&&(l=__inflate(e,l)),"function"==typeof l){for(r=!r.length&&l.length?["require","exports","module"]:r,b=0;b<r.length;b++)if("require"===(m=(v=a(r[b],h)).f))_[b]=i(e);else if("exports"===m)_[b]=c[e]={},p=!0;else if("module"===m)g=_[b]={id:e,uri:"",exports:c[e],config:s(e)};else if(c.hasOwnProperty(m)||d.hasOwnProperty(m))_[b]=o(m);else if(v.p)v.p.load(v.n,i(h,!0),n(m),{}),_[b]=c[m];else if(!u[m])throw new Error(e+" missing "+m);f=l.apply(c[e],_),e&&(g&&g.exports!==t&&g.exports!==c[e]?c[e]=g.exports:f===t&&p||(c[e]=f))}else e&&(c[e]=l)},requirejs=require=l=function(e,i,n,s){return"string"==typeof e?o(a(e,i).f):(e.splice||(h=e,i.splice?(e=i,i=n,n=null):e=t),i=i||function(){},s?r(t,e,i,n):setTimeout((function(){r(t,e,i,n)}),15),l)},l.config=function(t){return h=t,l},(define=function(t,e,i){e.splice||(i=e,e=[]),d[t]=[t,e,i]}).amd={jQuery:!0}})(),__inflate=function __inflate(name,src){var r;return eval(["r = function(a,b,c){","\n};\n//@ sourceURL="+name+"\n"].join(src)),r},define("lib/api/events",["require","exports","module"],(function(t,e,i){e.api={LOAD_PROGRESS:"loadProgres",PLAY_PROGRESS:"playProgress",PLAY:"play",PAUSE:"pause",FINISH:"finish",SEEK:"seek",READY:"ready",OPEN_SHARE_PANEL:"sharePanelOpened",SHARE:"share",CLICK_DOWNLOAD:"downloadClicked",CLICK_BUY:"buyClicked"},e.bridge={REMOVE_LISTENER:"removeEventListener",ADD_LISTENER:"addEventListener"}})),define("lib/api/getters",["require","exports","module"],(function(t,e,i){i.exports={GET_VOLUME:"getVolume",GET_DURATION:"getDuration",GET_POSITION:"getPosition",GET_SOUNDS:"getSounds",GET_CURRENT_SOUND:"getCurrentSound",GET_CURRENT_SOUND_INDEX:"getCurrentSoundIndex",IS_PAUSED:"isPaused"}})),define("lib/api/setters",["require","exports","module"],(function(t,e,i){i.exports={PLAY:"play",PAUSE:"pause",TOGGLE:"toggle",SEEK_TO:"seekTo",SET_VOLUME:"setVolume",NEXT:"next",PREV:"prev",SKIP:"skip"}})),define("lib/api/api",["require","exports","module","lib/api/events","lib/api/getters","lib/api/setters"],(function(t,e,i){function n(t){var e,i=!1;for(e in k)if(k.hasOwnProperty(e)&&k[e]===t){i=!0;break}return i}function o(t){var e,i;for(e=0,i=P.length;e<i&&!1!==t(P[e]);e++);}function a(t){return t.contentWindow?t.contentWindow:t.contentDocument&&"parentWindow"in t.contentDocument?t.contentDocument.parentWindow:null}function s(t){var e,i=[];for(e in t)t.hasOwnProperty(e)&&i.push(t[e]);return i}function r(t,e,i){i.callbacks[t]=i.callbacks[t]||[],i.callbacks[t].push(e)}function l(t,e){var i=!0;return e.callbacks[t]=[],o((function(e){if((e.callbacks[t]||[]).length)return i=!1,!1})),i}function c(t,e,i){var n,o,s=a(i);if(!s.postMessage)return!1;n=i.getAttribute("src").split("?")[0],o=JSON.stringify({method:t,value:e}),"//"===n.substr(0,2)&&(n=window.location.protocol+n),n=n.replace(/http:\/\/(w|wt).soundcloud.com/,"https://$1.soundcloud.com"),s.postMessage(o,n)}function d(t){var e;return o((function(i){if(i.instance===t)return e=i,!1})),e}function h(t){var e;return o((function(i){if(a(i.element)===t)return e=i,!1})),e}function u(t,e){return function(i){var n=function(t){return!!(t&&t.constructor&&t.call&&t.apply)}(i),o=d(this),a=!n&&e?i:null,s=n&&!e?i:null;return s&&r(t,s,o),c(t,a,o.element),this}}function p(t,e,i){var n,o,a;for(n=0,o=e.length;n<o;n++)t[a=e[n]]=u(a,i)}function g(t,e,i){return t+"?url="+e+"&"+function(t){var e,i,n=[];for(e in t)t.hasOwnProperty(e)&&(i=t[e],n.push(e+"="+("start_track"===e?parseInt(i,10):i?"true":"false")));return n.join("&")}(i)}function m(t,e,i){var o,a,s=t.callbacks[e]||[];for(o=0,a=s.length;o<a;o++)s[o].apply(t.instance,i);(n(e)||e===x.READY)&&(t.callbacks[e]=[])}function f(t){var e,i,n,o,a;try{i=JSON.parse(t.data)}catch(t){}if(i&&(!t.origin||/soundcloud/i.test(t.origin))){if(e=h(t.source),n=i.method,o=i.value,n===x.READY&&(e?(e.isReady=!0,m(e,j),l(j,e)):O.push(t.source)),n===x.PLAY&&!e.playEventFired&&(e.playEventFired=!0),n===x.PLAY_PROGRESS&&!e.playEventFired&&(e.playEventFired=!0,m(e,x.PLAY,[o])),!e||v(t.origin)!==v(e.domain))return!1;a=[],void 0!==o&&a.push(o),m(e,n,a)}}function v(t){return t.replace($,"")}var b,_,y,w=t("lib/api/events"),k=t("lib/api/getters"),S=t("lib/api/setters"),x=w.api,C=w.bridge,O=[],P=[],j="__LATE_BINDING__",$=/^http(?:s?)/;window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f),i.exports=y=function(t,e,i){if(function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)}(t)&&(t=document.getElementById(t)),!function(t){return!!t&&1===t.nodeType&&"IFRAME"===t.nodeName.toUpperCase()}(t))throw new Error("SC.Widget function should be given either iframe element or a string specifying id attribute of iframe element.");e&&(i=i||{},t.src=g("http://wt.soundcloud.dev:9200/",e,i));var n,o,s=h(a(t));return s&&s.instance?s.instance:(n=O.indexOf(a(t))>-1,o=new b(t),P.push(new _(o,t,n)),o)},y.Events=x,window.SC=window.SC||{},window.SC.Widget=y,_=function(t,e,i){this.instance=t,this.element=e,this.domain=function(t){var e,i,n,o="";for("//"===t.substr(0,2)&&(t=window.location.protocol+t),e=0,i=(n=t.split("/")).length;e<i&&e<3;e++)o+=n[e],e<2&&(o+="/");return o}(e.getAttribute("src")),this.isReady=!!i,this.callbacks={}},(b=function(){}).prototype={constructor:b,load:function(t,e){if(t){e=e||{};var i=this,n=d(this),o=n.element,a=o.src,s=a.substr(0,a.indexOf("?"));n.isReady=!1,n.playEventFired=!1,o.onload=function(){i.bind(x.READY,(function(){var t,i=n.callbacks;for(t in i)i.hasOwnProperty(t)&&t!==x.READY&&c(C.ADD_LISTENER,t,n.element);e.callback&&e.callback()}))},o.src=g(s,t,e)}},bind:function(t,e){var i=this,n=d(this);return n&&n.element&&(t===x.READY&&n.isReady?setTimeout(e,1):n.isReady?(r(t,e,n),c(C.ADD_LISTENER,t,n.element)):r(j,(function(){i.bind(t,e)}),n)),this},unbind:function(t){var e,i=d(this);i&&i.element&&(e=l(t,i),t!==x.READY&&e&&c(C.REMOVE_LISTENER,t,i.element))}},p(b.prototype,s(k)),p(b.prototype,s(S),!0)})),window.SC=window.SC||{},window.SC.Widget=require("lib/api/api")}()},ePHO:function(t,e,i){"use strict";i.d(e,"a",(function(){return v}));var n=i("vOnD"),o=i("q1tI"),a=i.n(o),s=i("i8i4"),r=i.n(s),l=i("iC7s"),c=i("IiUL"),d=i("uxFs");function h(){return(h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function g(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function m(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?g(Object(i),!0).forEach((function(e){f(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var v=Object(o.createContext)({}),b=Object(n.e)(l.C).withConfig({displayName:"TextPaddings___StyledFlex"})(["transform:scale(var(--workspace-inverse-zoom));"]),_=Object(n.e)(l.I).withConfig({displayName:"TextPaddings___StyledInlineInput"})(["user-select:none !important;appearance:textfield;padding:0 !important;border:none !important;&::-webkit-outer-spin-button,&::-webkit-inner-spin-button{appearance:none;}"]),y=a.a.memo((function(t){var e=t.isActive,i=t.isSmall,s=t.from,c=t.value,h=t.position,u=t.onChange,p=t.disabled,g=Object(l.Tb)("Shift"),f="top"===s||"bottom"===s,v=i&&!f,y=Object(o.useRef)(null),w=Object(l.Vb)(y),k=w.width,S=w.height,x=f?k:S,C=y&&y.current?y.current.getBoundingClientRect():{x:0,y:0},O=v?10:"top"===s?"22px 22px 0 0":"right"===s?"0 22px 22px 0":"left"===s?"22px 0 0 22px":"0 0 22px 22px",P=Object(o.useMemo)((function(){var t=x-43,e=h-21.5;return Math.max(0,e<=t?e:t)}),[h,x]),j=v?20:43,$=v?38:f?43:47,T=Object(o.useContext)(d.a).ref,I=T&&T.current?T.current.node.getBoundingClientRect():{x:0,y:0},E=document.getElementById("paddings-input-portal"),M=a.a.createElement(l.C,{position:"relative",justifyContent:v?"flex-start":"flex-end",flexDirection:f?"row":"column",style:m({position:"absolute"},f?{left:P+I.x+C.x,top:I.y+C.y-("top"===s?j:0)}:{top:P+I.y+C.y,left:I.x+C.x-("left"===s?$:0)})},a.a.createElement(b,{bg:"blue",width:$,height:j,borderRadius:O,alignItems:"center",justifyContent:"center"},a.a.createElement(_,{fontSize:14,height:18,fontWeight:600,color:"white",placeholder:"0",type:"number",value:c,textAlign:"center",min:0,step:g?10:1,onChange:function(t){return u(parseInt(t.target.value))},autoFocus:!1,disabled:p})));return a.a.createElement(n.a,{target:document.head},a.a.createElement(a.a.Fragment,null,a.a.createElement(l.m,{ref:y,width:"100%",height:"100%"}),e&&E?r.a.createPortal(M,E):null))})),w=Object(n.e)(l.m).withConfig({displayName:"TextPaddings___StyledBox"})(["cursor:",";"],(function(t){return t._css})),k=a.a.memo((function(t){var e=t.from,i=t.onChange,n=t.value,s=void 0===n?0:n,r=t.isSmall,d=t.marginBottom,p=void 0===d?0:d,g=t.marginLeft,m=void 0===g?0:g,v=t.marginRight,b=void 0===v?0:v,_=t.marginTop,k=void 0===_?0:_,S=t.onStart,x=t.onStop,C=Object(o.useContext)(c.FrameContext),O=C&&C.window,P=function(t,e){var i=e;O&&O.addEventListener(t,i),window.addEventListener(t,i)},j=function(t,e){var i=e;O&&O.removeEventListener(t,i),window.removeEventListener(t,i)},$="top"===e||"bottom"===e,T="bottom"===e,I=u(Object(o.useState)(!1),2),E=I[0],M=I[1],R=u(Object(o.useState)(!1),2),A=R[0],D=R[1],z=u(Object(o.useState)(!1),2),L=z[0],B=z[1],F=u(Object(o.useState)(0),2),N=F[0],U=F[1],H=Object(o.useRef)(null),V=u(Object(o.useState)(0),2),W=V[0],G=V[1],q=u(Object(o.useState)(0),2),K=q[0],X=q[1],Y=Object(o.useRef)(!1).current,Z=function(t){Y=!0;var n=$?t.screenY:t.screenX,o="right"===e?N-n:n-N;i(Math.max(0,s+o)),X(Math.max(0,($?t.clientX:t.clientY)-W))},J=function(){D(!1),Y&&(B(!1),x&&x(e)),Y=!1};Object(o.useEffect)((function(){return A?(P("mousemove",Z),P("mouseup",J)):(j("mousemove",Z),j("mouseup",J)),function(){j("mousemove",Z),j("mouseup",J)}}),[A]);var Q=function(t){var i=document.getElementById("paddings-input-portal"),n=t.target;i&&!i.contains(n)&&H.current&&!H.current.contains(n)&&(B(!1),D(!1),J(),x&&x(e))},tt=function(t){"Escape"===t.key&&(B(!1),D(!1),J(),x&&x(e))};Object(o.useEffect)((function(){return A||(L?(P("click",Q),P("keyup",tt)):(j("click",Q),j("keyup",tt))),function(){j("click",Q),j("keyup",tt)}}),[A,L]);var et=Object(o.useMemo)((function(){return E||A?2:1}),[A,E]),it=Object(o.useMemo)((function(){return $?"calc(100% - ".concat(m+b,"px)"):"".concat(et,"px")}),[et,m,b]),nt=Object(o.useMemo)((function(){return $?"".concat(et,"px"):"calc(100% - ".concat(p+k,"px)")}),[et,p,k]),ot=Object(o.useMemo)((function(){return $?0+m:void 0}),[m]),at=Object(o.useMemo)((function(){return $?void 0:0+k}),[k]);return a.a.createElement(l.m,h({ref:H,position:"absolute",width:$?"100%":void 0,height:$?void 0:"100%",left:$?0:void 0,top:$?void 0:0},f({},e,0)),a.a.createElement(l.m,{bg:"rgba(28, 222, 180, 0.18)",style:{width:$?"100%":s,height:$?s:"calc(100% - ".concat(k+p,"px)"),marginTop:$?0:k}}),a.a.createElement(w,h({position:"absolute",onMouseEnter:function(){return M(!0)},onMouseLeave:function(){return M(!1)},onMouseDown:function(t){var i=document.getElementById("paddings-input-portal");if(!i||!i.contains(t.target)){if(!L){var n=t.target.getBoundingClientRect(),o=$?n.x:n.y;G(o),X(Math.max(0,($?t.clientX:t.clientY)-o)),B(!0)}U($?t.screenY:t.screenX),D(!0),S&&S(e)}}},f({},e,T?0:"100%"),{style:{width:T?"100%":$?it:"4px",height:T||$?4:nt,left:T?0:ot,top:at},_css:$?"row-resize":"col-resize"}),a.a.createElement(l.m,{position:"absolute",width:$?"100%":void 0,height:$?void 0:"100%",bottom:"top"===e?"100%":void 0,top:"bottom"===e?"100%":void 0,left:"right"===e?"100%":void 0,right:"left"===e?"100%":void 0},a.a.createElement(y,{isSmall:r,position:K,isActive:L,onChange:i,value:s,from:e,disabled:A})),a.a.createElement(l.C,{width:"100%",height:"100%",alignItems:"top"===e?"flex-start":"flex-end",justifyContent:"right"===e?"flex-end":void 0},a.a.createElement(l.m,{width:$?"100%":"".concat(et,"px"),height:$?"".concat(et,"px"):"100%",bg:E||A||T||s&&s>0?"blue":"transparent"}))),T&&a.a.createElement(l.m,{position:"absolute",bg:s&&s>1?"blue":"transparent",top:0,height:"1px",style:{left:ot,width:it}}))})),S=Object(n.e)(l.m).withConfig({displayName:"TextPaddings___StyledBox2"})(["opacity:",";visibility:",";"],(function(t){return t._css2}),(function(t){return t._css3})),x=Object(n.e)(l.m).withConfig({displayName:"TextPaddings___StyledBox3"})(["",""],(function(t){return t._css4}));e.b=function(t){var e=t.isVisible,i=t.children,n=t.left,s=t.top,r=t.right,c=t.bottom,d=t.onChange,h=Object(o.useContext)(v),u=h.isPaddingsEnabled,p=h.setIsPaddingsEnabled,g=Object(o.useRef)(null).current,m=function(t){g=t,p(!0)},f=function(t){g&&g!==t||p(!1)},b=Object(o.useRef)(null),_=Object(l.Vb)(b).height,y=Object(o.useMemo)((function(){return _<43}),[_]);return a.a.createElement(l.m,{position:"relative",style:{paddingTop:s,paddingLeft:n,paddingRight:r,paddingBottom:c}},a.a.createElement(S,{_css2:e?1:0,_css3:e?"visible":"hidden"},a.a.createElement(k,{isSmall:y,from:"top",value:s,marginLeft:n,marginRight:r,onChange:function(t){return d({left:n,top:t,right:r,bottom:c})},onStart:m,onStop:f}),a.a.createElement(k,{isSmall:y,from:"left",value:n,marginTop:s,marginBottom:c,onChange:function(t){return d({left:t,top:s,right:r,bottom:c})},onStart:m,onStop:f}),a.a.createElement(k,{isSmall:y,from:"right",value:r,marginTop:s,marginBottom:c,onChange:function(t){return d({left:n,top:s,right:t,bottom:c})},onStart:m,onStop:f}),a.a.createElement(k,{isSmall:y,from:"bottom",value:c,marginLeft:n,marginRight:r,onChange:function(t){return d({left:n,top:s,right:r,bottom:t})},onStart:m,onStop:f})),a.a.createElement(x,{ref:b,_css4:u?"* { user-select: none; }":""},i))}},ee0N:function(module,exports){module.exports={"template-constructor-helpers-font-explorer":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var initial="google";__p+='\n\t<div class="font-explorer">\n\t\t<div class="font-explorer-wrapper">\n\n\t\t\t<div class="left-panel">\n\n\t\t\t\t<div class="search-icon"></div>\n\n\t\t\t\t<div class="view-wrapper">\n\t\t\t\t\t<div class="grid-view active" data-name="grid"></div>\n\t\t\t\t\t<div class="list-view"  data-name="list"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="back-icon"></div>\n\n\n\t\t\t\t<div class="size-wrapper">\n\t\t\t\t\t<div class="top-letter">A</div>\n\t\t\t\t\t<div class="slider"></div>\n\t\t\t\t\t<div class="bottom-letter">A</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="center-panel">\n\n\t\t\t\t<div class="search-wrapper">\n\t\t\t\t\t<div class="border"></div>\n\t\t\t\t\t<input class="search-string" type="text" placeholder=""/>\n\t\t\t\t\t<div class="clear invisible"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="scroll-wrapper main">\n\t\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t\t<div class="results" data-view="grid" data-size="4">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="scroll-wrapper info">\n\t\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t\t<div class="results" data-view="list" data-size="4">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="right-panel">\n\n\t\t\t\t<div class="providers-switcher">\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li '+(null==(__t="google"==initial?'class="active"':"")?"":__t)+' data-name="google"></li>\n            <li '+(null==(__t="typetoday"==initial?'class="active"':"")?"":__t)+' data-name="typetoday"></li>\n            <li '+(null==(__t="typekit"==initial?'class="active"':"")?"":__t)+' data-name="typekit"></li>\n            <li '+(null==(__t="webtype"==initial?'class="active"':"")?"":__t)+' data-name="webtype"></li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<span></span>\n\t\t\t\t</div>\n\n        <div class="provider-filter '+(null==(__t="typekit"==initial?"":"invisible")?"":__t)+'" data-name="typekit">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n            <div class="icon-slab-serif" data-name="slab-serif" data-alt="Slab Serif"></div>\n            <div class="icon-script" data-name="script" data-alt="Script"></div>\n            <div class="icon-blackletter" data-name="blackletter" data-alt="Blackletter"></div>\n            <div class="icon-monospaced" data-name="monospaced" data-alt="Monospaced"></div>\n            <div class="icon-handmade" data-name="handmade" data-alt="Handmade"></div>\n            <div class="icon-decorative" data-name="decorative" data-alt="Decorative"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n          <div class="filter capitals" data-name="capitals" data-multiple="0">\n            <div class="icon-uppercase-lowercase" data-name="uppercase-lowercase" data-alt="Standard"></div>\n            <div class="icon-all-or-small-caps" data-name="all-or-small-caps" data-alt="Caps Only"></div>\n          </div>\n\n          <div class="filter number-style" data-name="number_style" data-multiple="0">\n            <div class="icon-uppercase" data-name="uppercase" data-alt="Lining Figures"></div>\n            <div class="icon-lowercase" data-name="lowercase" data-alt="Old Style Figures"></div>\n          </div>\n\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="top-left left" data-name="ca">Catalan</div>\n              <div data-name="cs">Czech</div>\n              <div class="top-right" data-name="de">German</div>\n\n              <div class="left" data-name="en">English</div>\n              <div data-name="es">Spanish</div>\n              <div data-name="fr">French</div>\n\n              <div class="left" data-name="it">Italian</div>\n              <div data-name="nl">Dutch</div>\n              <div data-name="pl">Polish</div>\n\n              <div class="bottom-left bottom left" data-name="pt">Portugese</div>\n              <div class="with-corner bottom" data-name="ru">Russian</div>\n              <div class="bottom-right bottom" data-name="sv">Swedish</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n          </div>\n\n          <a class="logo" href="http://typekit.com" target="_blank"></a>\n\n        </div>\n\n\n\n\n\n        <div class="provider-filter '+(null==(__t="webtype"==initial?"":"invisible")?"":__t)+'" data-name="webtype">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n            <div class="icon-monospaced" data-name="monospaced" data-alt="Monospaced"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="bottom-left top-left left bottom" data-name="latin">Latin</div>\n              <div class="with-corner bottom" data-name="cyrillic">Cyrillic</div>\n              <div class="top-right bottom-right bottom" data-name="greek">Greek</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n\n          </div>\n\n          <a class="logo" href="http://webtype.com" target="_blank"></a>\n\n        </div>\n\n\n\t\t\t\t<div class="provider-filter '+(null==(__t="google"==initial?"":"invisible")?"":__t)+'" data-name="google">\n\n\t\t\t\t\t<div class="filter-caption" data-initial="Category">Category</div>\n\n\t\t\t\t\t<div class="filter classification" data-name="category" data-multiple="0">\n\t\t\t\t\t\t<div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n\t\t\t\t\t\t<div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n\t\t\t\t\t\t<div class="icon-script" data-name="handwriting" data-alt="Handwriting"></div>\n\t\t\t\t\t\t<div class="icon-monospaced" data-name="monospace" data-alt="Monospaced"></div>\n\t\t\t\t\t\t<div class="icon-decorative" data-name="display" data-alt="Display"></div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="language-wrapper">\n\t\t\t\t\t\t<div class="caption">Language Support</div>\n\t\t\t\t\t\t<div class="arrow"></div>\n\n\n\t\t\t\t\t\t<div class="filter language" data-name="subsets" data-multiple="1">\n\t\t\t\t\t\t\t<div class="top-left left" data-name="cyrillic">Cyrillic</div>\n\t\t\t\t\t\t\t<div data-name="devanagari">Devanagari</div>\n\t\t\t\t\t\t\t<div class="top-right" data-name="greek">Greek</div>\n\n\t\t\t\t\t\t\t<div class="bottom-left bottom left" data-name="khmer">Khmer</div>\n\t\t\t\t\t\t\t<div class="with-corner bottom" data-name="latin">Latin</div>\n\t\t\t\t\t\t\t<div class="bottom-right bottom" data-name="vietnamese">Vietnamese</div>\n\n\t\t\t\t\t\t\t<span class="context-panel-corner"><span class="corner"></span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<a class="logo" href="http://google.com/fonts" target="_blank"></a>\n\n\t\t\t\t</div>\n\n\n        <div class="provider-filter '+(null==(__t="typetoday"==initial?"":"invisible")?"":__t)+'" data-name="typetoday">\n\n          <div class="filter-caption" data-initial="Classification">Classification</div>\n\n          <div class="filter classification" data-name="classification" data-multiple="0">\n            <div class="icon-sans-serif" data-name="sans-serif" data-alt="Sans Serif"></div>\n            <div class="icon-serif" data-name="serif" data-alt="Serif"></div>\n          </div>\n\n          <div class="filter-caption" data-initial="For">For</div>\n\n          <div class="filter recommended-for" data-name="recommended_for" data-multiple="1">\n            <div class="icon-paragraphs" data-name="paragraphs">Paragraphs</div>\n            <div class="icon-headings" data-name="headings">Headings</div>\n          </div>\n\n          <div class="filter-caption" data-initial="Properties">Properties</div>\n\n          <div class="filter weight" data-name="weight" data-multiple="1">\n            <div class="icon-light" data-name="light" data-alt="Light"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-heavy" data-name="heavy" data-alt="Heavy"></div>\n          </div>\n\n          <div class="filter width" data-name="width" data-multiple="0">\n            <div class="icon-condensed" data-name="condensed" data-alt="Condensed"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular"></div>\n            <div class="icon-extended" data-name="extended" data-alt="Extended"></div>\n          </div>\n\n          <div class="filter x-height" data-name="x_height" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low x-height"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular x-height"></div>\n            <div class="icon-high" data-name="high" data-alt="High x-height"></div>\n          </div>\n\n          <div class="filter contrast" data-name="contrast" data-multiple="0">\n            <div class="icon-low" data-name="low" data-alt="Low Contrast"></div>\n            <div class="icon-regular" data-name="regular" data-alt="Regular Contrast"></div>\n            <div class="icon-high" data-name="high" data-alt="High Contrast"></div>\n          </div>\n\n          <div class="filter capitals" data-name="capitals" data-multiple="0">\n            <div class="icon-uppercase-lowercase" data-name="uppercase-lowercase" data-alt="Standard"></div>\n            <div class="icon-all-or-small-caps" data-name="all-or-small-caps" data-alt="Caps Only"></div>\n          </div>\n\n          <div class="filter number-style" data-name="number_style" data-multiple="0">\n            <div class="icon-uppercase" data-name="uppercase" data-alt="Lining Figures"></div>\n            <div class="icon-lowercase" data-name="lowercase" data-alt="Old Style Figures"></div>\n          </div>\n\n\n\n          <div class="language-wrapper">\n            <div class="caption">Language Support</div>\n            <div class="arrow"></div>\n\n            <div class="filter language" data-name="language" data-multiple="1">\n              <div class="top-left left" data-name="ca">Catalan</div>\n              <div data-name="cs">Czech</div>\n              <div class="top-right" data-name="de">German</div>\n\n              <div class="left" data-name="en">English</div>\n              <div data-name="es">Spanish</div>\n              <div data-name="fr">French</div>\n\n              <div class="left" data-name="it">Italian</div>\n              <div data-name="nl">Dutch</div>\n              <div data-name="pl">Polish</div>\n\n              <div class="bottom-left bottom left" data-name="pt">Portugese</div>\n              <div class="with-corner bottom" data-name="ru">Russian</div>\n              <div class="bottom-right bottom" data-name="sv">Swedish</div>\n\n              <span class="context-panel-corner"><span class="corner"></span></span>\n            </div>\n          </div>\n\n          <a class="logo" href="https://type.today" target="_blank"></a>\n\n        </div>\n\n\t\t\t\t<div class="font-info">\n\t\t\t\t\t<div class="top-info">\n\t\t\t\t\t\t<div class="name"></div>\n\t\t\t\t\t\t<div class="foundry">by <a target="_blank" href="http://123"></a></div>\n\t\t\t\t\t\t<div class="description-wrapper huge">\n\t\t\t\t\t\t\t<div class="description"></div>\n\t\t\t\t\t\t\t<a class="more" target="_blank" href="http://123">More...</a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="promo">To get more styles of this typeface visit <a href="https://type.today" target="_blank">type.today</a></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bottom-info">\n\t\t\t\t\t\t<div class="language-wrapper">\n\t\t\t\t\t\t\t<div class="caption">Language Support:</div>\n\t\t\t\t\t\t\t<div class="language">\n\t\t\t\t\t\t\t\t<div class="language-clamp"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="recommended-wrapper">\n\t\t\t\t\t\t\t<div class="caption">Recommended For:</div>\n\t\t\t\t\t\t\t<div class="recommended"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="info-add-remove-font">Add to Font Selector</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\n\n\t\t\t<div class="overlay">\n\t\t\t\t<div class="preloader"></div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n'}return __p},"template-constructor-helpers-font-explorer-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="font-item" data-img1="'+(null==(__t=img1)?"":__t)+'" data-img2="'+(null==(__t=img2)?"":__t)+'" data-font-name="'+(null==(__t=name)?"":__t)+'" data-font-id="'+(null==(__t=id)?"":__t)+'" data-font-provider="'+(null==(__t=provider)?"":__t)+'">\n\t\t<div class="caption">'+(null==(__t=text)?"":__t)+'<span class="styles-count">'+(null==(__t=styles)?"":__t)+" "+(null==(__t=Utils.declination("styles","style","styles",styles))?"":__t)+'</span></div>\n\t\t<div class="list-add-remove-font"></div>\n\t</div>\n';return __p},"template-constructor-helpers-font-explorer-no-found":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="no-found">\n\t\t<div class="header">Fk</div>\n\t\t<div class="sub-header">Sorry, no fonts found.</div>\n\t\t<div class="message">Try selecting fewer options.</div>\n\t</div>\n';return __p}}},etQA:function(t,e,i){},fEUr:function(t,e,i){"use strict";var n,o,a;i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return o})),i.d(e,"c",(function(){return a})),function(t){t.hover="hover",t.scroll="scroll"}(n||(n={})),function(t){t.horizontally="horizontally",t.vertically="vertically"}(o||(o={})),function(t){t.bottom="bottom",t.center="center",t.top="top"}(a||(a={}))},gHxz:function(module,exports){module.exports={"template-common-hotspot-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-hotspot">\n\n\t    <div class="pin"></div>\n\n    </div>\n\n';return __p},"template-common-hotspot-widget-mobile-wrapper":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="hotspot-fullscreen-wrapper invisible">\n        <div class="center-table">\n            <div class="center-cell">\n\n            </div>\n        </div>\n    </div>\n\n';return __p}}},gP9L:function(t,e,i){"use strict";var n=i("xi34"),o=i("amZL"),a={model:{event:"change"},props:{family:{type:[String,Array],default:function(){return[""]}},disabled:{type:Boolean,default:!1},vAlign:{type:String,default:"auto"},hAlign:{type:String,default:"right"},hOffset:{type:Number,default:0}},data:function(){return{visibleBox:!1,boxStyles:{}}},computed:{fontFamily:function(){return"string"==typeof this.family?[this.family]:this.family},exStyle:function(){return this.getFontFamilyStyle()},caption:function(){var t=this,e="";return this.fontFamily.forEach((function(i,n){e+=i,n+1<t.fontFamily.length&&(e+=", ")})),e}},watch:{family:function(t){!t&&this.visibleBox&&(this.visibleBox=!this.visibleBox)}},mounted:function(){if("auto"===this.vAlign){var t=this.$el.getBoundingClientRect(),e="top";t.top>window.innerHeight/2&&(e="bottom"),this.boxStyles[e]=t.height+"px"}this.boxStyles[this.hAlign]=this.hOffset+"px",this.fontselector=new o.a({$parent:Object(n.a)(this.$el.querySelector(".box_container"))}),this.fontselector.on("selectfont",this.fontChanged),this.fontselector.show()},methods:{getFontFamilyStyle:function(){return{"font-family":1===this.fontFamily.length?this.fontFamily[0]:"-apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', Ubuntu, 'Fira Sans', Roboto, 'Avenir Next', 'Helvetica Neue', Helvetica, Arial, sans-serif"}},fontChanged:function(t){this.$emit("change",t)},toggleVisible:function(){this.disabled||(this.visibleBox||this.$emit("showPopup",this),this.visibleBox=!this.visibleBox)}}},s=(i("HOx4"),i("KHd+")),r=Object(s.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{"font-family-container":!0,"container-disabled":t.disabled}},[i("span",{staticClass:"example",style:t.exStyle,on:{click:t.toggleVisible}},[t._v(t._s(t.caption))]),t._v(" "),i("div",{staticClass:"expand-arrow",on:{click:t.toggleVisible}}),t._v(" "),i("div",{staticClass:"box_container",class:{visible:t.visibleBox},style:t.boxStyles})])}),[],!1,null,null,null);e.a=r.exports},gdoY:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("4m+J"),l=i.n(r),c=i("DqjY"),d=i("gobI"),h=i("roQd"),u=i("m41J"),p=i("OTSC"),g=i("tf3M"),m=i("Kf/z"),f=1,v=a.a.View.extend({template:l.a["template-viewer-widget"],initialize:function(t,e,i){return s.a.bindAll(this),this.model=new g.default(t),this.updateWidgetData(t,e,i),this.destroyed=!1,this.$document=Object(n.a)(document),this._id=this._id||f++,this},render:function(){return this.makeBox("some-widget-class"),this.rendered=!0,this.checkLink(),this},redraw:function(){return this.checkLink(),this},updatePage:function(t){var e=this.page;(!e||t&&e.num!==t.num)&&(this.page=t,this.redraw())},canRenderImmediately:function(){return Boolean(this.DO_NOT_WAIT_FOR_PRELOAD)},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.started&&this.start(),this.trigger("loaded"))},isValid:function(){return!0},hasFontsToLoad:function(){return!1},seamlessFontsShow:function(t,e){this._id;if(c.a.isFastFontLoadCheckAvailable()&&!RM.screenshot&&!this.insideHotspot&&this.hasFontsToLoad()){e();this.makeSureFontsLoaded().then((function(e){window.requestAnimationFrame(t)})).catch((function(e){t()}))}},makeSureFontsLoaded:function(){var t=this.page.getFontsVariations([this],!0),e=[];return s.a.each(t,(function(t){var i=c.a.fastWaitForFontLoad(t.fontFamily,t.fontWeight,t.fontStyle);e.push(i)})),window.Promise.all(e)},hasAnimation:function(){return Boolean(this.getAnimations().find((function(t){return!h.a.isEmpty(t)})))},hasLoadAnimation:function(){return Boolean(this.getAnimations().find((function(t){return"load"===t.type})))},start:function(){return this.started=!0,this},stop:function(){return this.started=!1,this},hide:function(){return this.stop(),this.$el.hide(),this.wasHidden=!0,this.trigger("hidden"),this},show:function(){return this.$el.show(),this.start(),this.wasHidden=!1,this.trigger("shown"),this},destroy:function(){return this.stop(),this.destroyed=!0,this.trigger("destroyed"),delete this.animationObj,this.$el.off(),this.remove()},BringToTopZ:function(){if(this.animationObj){var t=this.animationObj.getAnimationContainer();this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.savedAnimationContainerZIndex||(this.animationObj.savedAnimationContainerZIndex=t.css("z-index")),t.css("z-index",99999+this.z)}this.$el.css("z-index",99999+this.z)},BackToNormalZ:function(){var t=function(){this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(this.animationObj.getAnimationContainer().css("z-index",this.animationObj.savedAnimationContainerZIndex||this.z),delete this.animationObj.savedAnimationContainerZIndex);delete this.animationObj.resetTimeout}.bind(this);this.animationObj&&this.animationObj.savedAnimationContainerZIndex&&(this.animationObj.resetTimeout&&clearTimeout(this.animationObj.resetTimeout),this.animationObj.resetTimeout=setTimeout(t,200)),this.$el.css("z-index",this.z)},makeBox:function(t){this.setElement(this.template({id:this._id}));var e=this.fixed_position?this.$fixedContainer:this.$pageContainer;this.animationObj&&(e=this.animationObj.getAnimationContainer()),this.$el.appendTo(e).addClass(t).toggleClass("full-width",!!this.is_full_width).toggleClass("full-height",!!this.is_full_height).toggleClass("inside-hotspot",!!this.insideHotspot),this.applyBoxStyle(),(this.is_full_width||this.is_full_height||this.fixed_position||this.sticked)&&this.listenTo(this.page,"resize",this.onPageResize),this.trigger("rendered")},onPageResize:function(){this.applyBoxStyle()},calcBoxStyle:function(t){t=t||{};var e,i={left:this.x,top:this.y,width:this.w,height:this.h,right:"",bottom:"","margin-left":"","margin-top":"","z-index":this.z||1},o=parseInt(this.full_width_margin,10)||0,a=parseInt(this.full_height_margin,10)||0,r=parseInt(this.sticked_margin,10)||0,l=this.ignoreScale?1:this.page.scale,c=this.page.mag.getContainerSizeCached().width,h=c-Object(n.a)(window).width(),g=this.fixed_position;if(this.angle&&(i.width=Math.round(this.w),i.height=Math.round(this.h),this.angle%90==0&&i.width%2!=i.height%2&&(i.width+=1)),this.is_full_height&&(i.top=-this.page.contentPosition.top+a,g?(i.top=a/l,i.height=Object(n.a)(window).height()/l-2*a,["nw","w","sw"].indexOf(g)>-1&&(g="nw"),["n","c","s"].indexOf(g)>-1&&(g="n"),["ne","e","se"].indexOf(g)>-1&&(g="ne")):i.height=this.page.pageHeight/l-2*a),this.is_full_width&&(i.left=-this.page.contentPosition.left+o,i.width=this.page.mag.getContainerSizeCached().width/l-2*o,e=-((i.width-this.page.$content[0].clientWidth)/2).toFixed(3),d.a.isAllowed()&&this.page.mag.getContainerSizeCached().width>this.mag.viewOpts.scalewidth&&(Modernizr.msie11?(e=-(c-this.page.$content[0].clientWidth)/2-h/2,i.left=e/l):Modernizr.firefox?(i.width=i.width+1,i.left=e-1):i.left=e),g)){if(i.left=o,"horizontal"==this.page.viewerType){var m=this.page.$scrollWrapper,f=m.width()-m[0].clientWidth;i.width-=f/l}["nw","n","ne"].indexOf(g)>-1&&(g="nw"),["w","c","e"].indexOf(g)>-1&&(g="w"),["sw","s","se"].indexOf(g)>-1&&(g="sw")}if(this.sticked){f=0;"horizontal"==this.page.viewerType&&(f=this.page.$scrollWrapper.width()-this.page.$scrollWrapper[0].clientWidth),"left"==this.sticked&&(i.left=-this.page.contentPosition.left/l+r),"right"==this.sticked&&(i.left=this.page.mag.getContainerSizeCached().width/l-r-this.w-this.page.contentPosition.left/l-f/l),"top"==this.sticked&&(i.top=-this.page.contentPosition.top/l+r),"bottom"==this.sticked&&(i.top=this.$pageContainer.height()-r-this.h+this.page.contentPosition.top/l)}if(t.calcBBox){g&&(i.left*=l,i.top*=l,i.width*=l,i.height*=l),i.sinAngle=Math.sin(-(this.angle||0)*Math.PI/180),i.cosAngle=Math.cos(-(this.angle||0)*Math.PI/180);var v=u.a.calcBoundingBox(i,g);return i.width=v.bb_width,i.height=v.bb_height,i.left=v.bb_left,i.top=v.bb_top,g&&s.a.extend(i,p.default.getFixedPositionCSS(g,i,1)),{dimensions:i}}g&&(s.a.extend(i,p.default.getFixedPositionCSS(g,i,d.a.normalize(l,"transform"))),l>=1&&d.a.isAllowed()&&d.a.isZoom()&&(i.zoom=l));var b={rotate:this.angle?this.angle+"deg":"",scaleX:this.flip_h?-1:1,scaleY:this.flip_v?-1:1};return g&&(b.scaleX*=d.a.normalize(l,"transform"),b.scaleY*=d.a.normalize(l,"transform")),Math.abs(b.scaleX-1)<1e-6&&(b.scaleX=""),Math.abs(b.scaleY-1)<1e-6&&(b.scaleY=""),{dimensions:i,transform:b}},applyBoxStyle:function(){var t=this.calcBoxStyle();this.animationObj&&(t=this.animationObj.modifyWidgetPosition(t)),this.$el.css(t.dimensions);var e=s.a.map(t.transform,(function(t,e){return t?e+"("+t+")":""})).join(" ");p.default.applyTransform(this.$el,n.a.trim(e))},calcDistsToPageVisibleBounds:function(){var t,e=this.page.mag.getContainerSizeCached(),i=d.a.isOn(this.page.scale)&&d.a.isZoom()?d.a.getBox(this.$el[0],this.page.scale):this.$el[0].getBoundingClientRect(),n=this.page.mag.isPreview?this.page.mag.$mag_container[0].getBoundingClientRect():{top:0,left:0},o=(i.top+i.height/2-n.top)/this.page.scale,a=(e.height-(i.top+i.height/2-n.top))/this.page.scale,s=(i.left+i.width/2-n.left)/this.page.scale,r=(e.width-(i.left+i.width/2-n.left))/this.page.scale;if(this.fixed_position){var l=this.page.$el[0].getBoundingClientRect(),c=(i.top+i.height/2-l.top)/this.page.scale,h=(l.height-(i.top+i.height/2-l.top))/this.page.scale;t={left:Math.max(0,s),right:Math.max(0,r),top:Math.max(0,Math.min(o,c)),bottom:Math.max(0,Math.min(a,h))}}else{var u=this.page.contentPosition.left/this.page.scale,p=this.page.contentPosition.top/this.page.scale,g=this.x+this.w/2,m=this.y+this.h/2;c=m+p,h=this.page.contentHeight-m+p;t={left:Math.max(0,g+u),right:Math.max(0,this.page.pageWidth-g+u),top:Math.max(0,Math.min(o,c)),bottom:Math.max(0,Math.min(a,h))}}return t},checkLink:function(){var t={};if(this.clickLink){this.clickLink=this.page.mag.matchSameDomainLink(this.clickLink);var e=/^http(s?)\:\/\//i.test(this.clickLink)||/^mailto\:/i.test(this.clickLink)||/^tel\:/i.test(this.clickLink),i=/^__rm_goback$/i.test(this.clickLink),o=this.mailchimpMatcher.test(this.clickLink),a=this.anchorRegexp.test(this.clickLink),r=this.shareRegexp.test(this.clickLink),l=this.clickLink,c=this.clickTarget||"_blank",d=e?"external-link":i?"goback-link":"maglink";if(o&&(d="mailchimp-link"),a&&(d="anchor-link"),r&&(d="share-link"),!e){var h=l;/^back\sto\stop$/i.test(l)&&(h=this.page._id);var u=this.page.mag.getPageNum(h);l=u&&this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(h):"javascript:void(0)";u?c="":l="",h==this.page._id&&(d+=" back-to-top",this.is_global&&(d+=" current"))}if(i&&(l="javascript:void(0)"),o){l="javascript:void(0)";var p=this.clickLink.match(this.mailchimpMatcher)[1];t["data-mailchimp"]=p}if(a){l="javascript:void(0)",t["data-anchor-link-pos"]=this.anchor_link_pos;var g=s.a.findWhere(this.mag.pages,{_id:this.clickPage})||this.page;t["data-page-uri"]=g.uri||g.num}if(r){l="javascript:void(0)";var m=this.clickLink.match(this.shareRegexp);t["data-share-provider"]=m[1],t["data-share-type"]=m[2]}if(0!=l.indexOf("mailto")&&0!=l.indexOf("tel")&&"maglink"!=d||(c=""),l){s.a.extend(t,{class:d,href:l,target:c});var f=this.$el.parent("a");f.length?f.attr(t):(f=Object(n.a)("<a>").attr(t),this.$el.wrap(f)),!e&&RM.screenshot&&(f=this.$el.parent("a")).removeAttr("href")}}},updateWidgetData:function(t,e,i){s.a.extend(this,t,t.params),this.page=e,this.mag=this.page.mag,this.$pageContainer=i||this.page.$content,this.x=this.x||0,this.y=this.y||0},getAnimations:function(){return h.a.normalizeAnimations(this.animation)},getAnimationTriggers:function(t){var e=this.getAnimations().find((function(e){return e.UUID===t}));return h.a.normalizeAnimationTriggers(e&&e.trigger)},isGlobal:function(){return!!this.model.get("is_global")},isAbove:function(){return!!this.model.get("is_above")}}),b=i("zzMN"),_=v.extend({render:function(){var t=this,e=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_e_commerce&&(e=!0);else{var i=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");i&&i.can_use_e_commerce&&(e=!0)}if(e)return this.makeBox("widget-add-to-cart"),this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.addToCartWidget=new b.a({data:this,environment:"viewer",$container:this.$el,eCommerceManager:this.mag.eCommerceManager}),RM.screenshot?(this.addToCartWidget.on("loaded",(function(){t.widgetIsLoaded()})),setTimeout((function(){t.widgetIsLoaded()}),1e4)):this.widgetIsLoaded(),this.addToCartWidget.render(),this.rendered=!0,this},destroy:function(){return this.addToCartWidget&&this.addToCartWidget.destroy(),this.addToCartWidget=null,v.prototype.destroy.apply(this,arguments)}}),y=i("hdsW"),w=i("QNiq"),k=v.extend({render:function(){return this.makeBox("audio"),this.player=new y.a(this,this.$el,this.widgetIsLoaded),this.player.show(),this.rendered=!0,this},isValid:function(){return this.parsed_url},start:function(){return this.started=!0,!RM.screenshot&&!this.destroyed&&this.player&&this.autoplay&&this.rendered&&this.loaded&&w.a.isDesktop&&!p.default.PageVisibilityManager.isPageHidden()&&this.player.play(),this},stop:function(){return this.started=!1,!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.pause(),this},destroy:function(){return this.player&&this.player.destroy(),this.player=null,v.prototype.destroy.apply(this,arguments)}}),S=i("WoDZ"),x=i("Zuws"),C=i.n(x),O=i("0zSa"),P=i("i7aS"),j=i("PhV8"),$=i("Vxjr"),T=function(t,e){this.playerIsReady=!1,this.queue=[],function(t,e){var i=s.a.bind(t,e);if(window.youTubeApiIsReady)return i();window.ytQueue.push({cb:i,context:e})}((function(){this.yt=new window.YT.Player(t.id,{events:{onReady:s.a.bind((function(){this.destroyed||(this.playerIsReady=!0,s.a.each(this.queue,(function(t){s.a.isFunction(t.cb)&&t.cb()})))}),this)}})}),this),this.start_time=e&&e.start_time};T.prototype={addToQueue:function(t,e){var i=s.a.bind(t,e);if(this.playerIsReady)return i();this.queue.push({cb:i,context:e})},on:function(t,e,i){var n=s.a.bind(e,i||window),o={finish:0,play:1,pause:2};"ready"!==t?this.addToQueue((function(){this.yt.addEventListener("onStateChange",(function(e){o[t]===Number(e.data)&&n()}))}),this):this.addToQueue(n,this)},mute:function(){this.addToQueue((function(){this.yt.mute()}),this)},unMute:function(){this.addToQueue((function(){this.yt.unMute()}),this)},pause:function(){this.addToQueue((function(){this.yt&&this.yt.pauseVideo&&this.yt.pauseVideo()}),this)},play:function(){this.addToQueue((function(){this.yt.playVideo()}),this)},rewind:function(t){this.addToQueue((function(){this.yt.seekTo(t||0)}),this)},loop:function(){this.rewind(this.start_time||.01)},getDuration:function(){return this.duration||(this.duration=this.yt.getDuration()),this.duration},getCurrentTime:function(){return this.yt.getCurrentTime&&this.yt.getCurrentTime()||0},checkLoop:function(){if(this.getDuration()-this.yt.getCurrentTime()<.5)return this.loop(),!0},destroy:function(){window.ytQueue=s.a.reject(window.ytQueue,(function(t){return t.context===this})),delete this.yt,delete this.queue,this.destroyed=!0}};var I=function(t,e){s.a.bindAll(this),this.id=t.id,this.start_time=e&&e.start_time};I.prototype={on:function(t,e){Object(j.a)(this.id).addEvent(t,e)},mute:function(){Object(j.a)(this.id).api("setVolume",0)},unMute:function(){return!1},pause:function(){Object(j.a)(this.id).api("pause")},play:function(){Object(j.a)(this.id).api("play")},rewind:function(t){Object(j.a)(this.id).api("seekTo",t||0)},loop:function(){this.start_time&&this.rewind(this.start_time)},getCurrentTime:function(t){Object(j.a)(this.id).api("getCurrentTime",t)},setColor:function(t){Object(j.a)(this.id).api("setColor",t)},destroy:function(){var t=Object(j.a)(this.id);t&&(t.removeEvent("ready"),t.removeEvent("play"),t.removeEvent("finish"),t.removeEvent("pause"))}};var E={Vimeo:s.a.template('<iframe src="https://player.vimeo.com/video/<%=video_id%>?wmode=opaque&api=1&loop=<%=(loop)?1:0%>&muted=<%=(mute)?1:0%>&player_id=video_<%=id%><%=(!real)?"_c":""%>&title=<%=info?1:0%>&byline=<%=info?1:0%>&portrait=<%=info?1:0%>&color=<%=color%>" id="video_<%=id%><%=(!real)?"_c":""%>" width="<%=w%>" height="<%=h%>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen allow="autoplay; fullscreen; encrypted-media"></iframe>'),YouTube:s.a.template('<iframe <% if (real) {%>id="yt_<%=video_id%>"<%}%> src="https://www.youtube.com/embed/<%=video_id%>?&wmode=opaque&enablejsapi=1&playlist=&autohide=1&loop=<%=(loop)?1:0%>&showinfo=<%=info?1:0%>&theme=<%=theme%>&controls=<%=controls? 1: 0%><%=html5 ? "&html5=1" : ""%>&rel=0&vq=hd1080&playsinline=<%=(autoplay)?1:0%>" width="<%=w%>" height="<%=h%>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen allow="autoplay; fullscreen; encrypted-media"></iframe>')},M=v.extend({RESTART_TIMEOUT:5e3,initialize:function(t,e,i){return v.prototype.initialize.apply(this,arguments),this.$container=i,delete this.real,this},render:function(){return this.$container?this.setElement(this.$container):this.makeBox("video"),this.rendered=!0,this.setPosterInsteadOfVideo(),this},isValid:function(){return this.video_id&&this.provider_name},_needAutoStart:function(){return this.autoplay&&!p.default.PageVisibilityManager.isPageHidden()},start:function(){return this.started=!0,this.onPlayFired=!1,RM.screenshot||!this.rendered||this.destroyed||(this.playerInitialized||(this.$el.append(this.getEmbed()),this.$iframe=this.$el.find("iframe"),this.$iframe.attr("id","video_"+this.id),this.player=this.createPlayer(this.provider_name,this.$iframe,{start_time:this.start_time,autoplay:this._needAutoStart()}),this.player&&this.player.on("ready",this.onPlayerReady),this.playerInitialized=!0),this.player&&this._needAutoStart()&&this.player.play()),this},stop:function(){return this.started=!1,clearInterval(this.loopInterval),!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&("youtube"===this.provider_name.toLowerCase()?(this._needAutoStart()&&this.player.pause(),!this._needAutoStart()&&this.onPlayFired&&this.player.pause()):this.player.pause()),this},destroy:function(){return clearInterval(this.loopInterval),this.player&&this.player.destroy(),this.player=null,v.prototype.destroy.apply(this,arguments)},setPosterInsteadOfVideo:function(){if(this.custom_thumbnail||this.thumbnail_url){var t=this.getCustomThumbnail(this);this.custom_thumbnail&&t.url?this.setCustomPosterInsteadOfVideo():this.setEmbeddedPosterInsteadOfVideo()}else this.widgetIsLoaded()},setEmbeddedPosterInsteadOfVideo:function(){this.$poster&&this.$poster.remove(),this.$poster&&this.$poster.off(),this.$poster=Object(n.a)("<img/>").addClass("poster").css("opacity",0).appendTo(this.$el),this.$poster.on("load",s.a.bind((function(){this.$poster.css({width:"",height:""}).css("opacity",1);var t=this.$poster[0].width,e=this.$poster[0].height;this.aspect_poster||(this.aspect_poster=t/e),S.a.setVideoPosition({mag:this.page.mag,$container:this.$el,$media:this.$poster,provider:this.provider_name,aspect_poster:this.aspect_poster,aspect_real:this.aspect_real,controls_remove:!!this.$container}),setTimeout(this.widgetIsLoaded,100)}),this)).on("error",s.a.bind((function(){this.oldUrl=this.thumbnail_url,this.thumbnail_url=this.thumbnail_url.replace("https://","http://"),this.oldUrl!==this.thumbnail_url?this.setEmbeddedPosterInsteadOfVideo():this.widgetIsLoaded()}),this)).attr("src",this.thumbnail_url)},setCustomPosterInsteadOfVideo:function(){this.$poster&&this.$poster.remove(),this.$poster&&this.$poster.off(),this.$poster=this.getCustomVideoPoster(this),this.$poster.css({visibility:"hidden",cursor:"pointer"}),this.$poster.on("click",s.a.bind((function(){this.onPosterClicked()}),this)),this.$poster.appendTo(this.$el),setTimeout(this.widgetIsLoaded,100)},getCustomVideoPoster:function(t){var e=Object($.findImagePath)("./common/video-player/play.svg"),i=Object(n.a)("<div/>").addClass("poster poster-custom"),o=this.getCustomThumbnail(t),a=o.unscaledOptimizedUrl||o.url;if(P.a.useLambdaUrl(o)||P.a.useLambdaUrlOldProjects(o,"video")){var s={width:t.w};o.originalW&&(s.originalW=o.originalW),o.originalH&&(s.originalH=o.originalH);var r=h.a.normalizeAnimations(t.animation).reduce((function(t,e){return Math.max(t,h.a.maxScaleAnimation(e))}),0);s.animationScale=r&&r/100,this.page?s.scale=d.a.isOn(this.page.scale)?this.page.scale:1:s.scale=RM.constructorRouter.zoom.getZoom(),a=P.a.getLambdaUrl(o,s)}i.css({width:t.w,height:t.h}),P.a.flagLQIP()&&this.mag&&this.mag.opts&&this.mag.opts.lqip&&(this.$lqipImg=Object(n.a)("<div/>").addClass("lqip").css({"background-image":"url(".concat(P.a.getLqipUrl(o),")"),width:this.w,height:this.h}).appendTo(this.$el));var l=new Image;return l.onload=function(){var t=this;this.$poster&&this.$poster.css({"background-image":"url(".concat(e,"), url(").concat(a,")"),visibility:""}),this.$iframe&&this.$iframe.addClass("fade-out"),this.$lqipImg&&this.$lqipImg.css("opacity",0),setTimeout((function(){t.$lqipImg&&t.$lqipImg.remove()}),200)}.bind(this),l.src=a,i},getCustomThumbnail:function(t){var e=t.custom_thumbnail_url||"";return t.picture||{url:e,type:s.a.last(e.split("."))}},onPosterClicked:function(){this.player.play(),s.a.delay(s.a.bind((function(){this.$poster&&(this.$poster.off(),this.$poster.remove())}),this),200)},createPlayer:function(t,e,i){return"vimeo"===t.toLowerCase()?new I(e[0],i):"youtube"===t.toLowerCase()?new T(e[0],i):null},getEmbed:function(t){if(t=t||this,s.a.defaults(t,{real:!0,w:640,h:320,theme:"dark",color:"3ab9ff",info:!1,controls:!0,id:s.a.uniqueId("video_"),origin:encodeURIComponent(window.location.protocol+"//"+window.location.hostname)}),Modernizr.safari&&(t.html5=!0),!t.video_id)return null;var e=E[t.provider_name](t),i=this.getCustomThumbnail(t);if(!t.real&&t.custom_thumbnail&&i.url){var o=Object(n.a)(e).css("visibility","hidden");return this.getCustomVideoPoster(t).add(o)}return E[t.provider_name](t)},onPlayerReady:function(){if(!this.destroyed&&this.player){if(this.$container&&(this.mute=!0),this.mute?this.player.mute():this.player.unMute(),!this.$container){var t=this.getCustomThumbnail(this);this.custom_thumbnail&&t.url||(this.$iframe&&this.$iframe.addClass("fade-out"),s.a.delay(s.a.bind((function(){this.$poster&&this.$poster.css("opacity",0)}),this),125),s.a.delay(s.a.bind((function(){this.$poster&&(this.$poster.off(),this.$poster.remove())}),this),250))}this.player.on("pause",this.onPause),this.player.on("play",this.onPlay),this.start_time&&(this.player.rewind(this.start_time),this.player.pause()),w.a.isDesktop&&"vimeo"===this.provider_name.toLowerCase()&&this.player.on("playProgress",this.onProgress),this.started&&this._needAutoStart()&&this.player.play(),this.player.setColor&&this.player.setColor(this.color)}},onPlay:function(){!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Play",this.title+" / "+this.url),this.$iframe&&!this.$iframe.hasClass("fade-out")&&(this.$iframe.addClass("fade-out"),this.trigger("playStarted")),clearInterval(this.loopInterval),this.loop&&this.player.checkLoop&&(this.loopInterval=setInterval(s.a.bind((function(){this.player.checkLoop()&&(clearInterval(this.loopInterval),Modernizr.safari&&s.a.delay(function(){this.onPlay()}.bind(this),200))}),this),100)),this.onPlayFired=!0},onPause:function(){if("Vimeo"===this.provider_name)this.player.getCurrentTime(s.a.bind((function(t){t=Math.round(t),!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+t+" sec.",t)}),this));else if("YouTube"===this.provider_name){var t=Math.round(this.player.getCurrentTime());!this.$container&&RM.analytics&&RM.analytics.sendEvent("Video Pause",this.title+" / "+this.url+" / "+t+" sec.",t)}},onProgress:function(t){this.onPlayFired||this.onPlay(),1===t.percent&&this.loop&&this.player.loop&&this.player.loop(),0===parseFloat(t.seconds)?this.restartTimeout||(this.restartTimeout=setTimeout(s.a.bind((function(){clearInterval(this.loopInterval),this.playerInitialized=!1,this.player&&this.player.destroy(),this.player=null,this.$iframe&&this.$iframe.remove(),!this.destroyed&&this.started&&this.start(),delete this.restartTimeout}),this),this.RESTART_TIMEOUT)):(clearTimeout(this.restartTimeout),delete this.restartTimeout)},updateVideoFrameSize:function(t,e){this.$iframe&&this.$iframe.attr("width",t).attr("height",e),this.$poster&&this.$poster.css({width:t,height:e})}}),R=v.extend({render:function(){return this.rendered=!0,this.page.on("resize",this.onResize,this),this.template=C.a["template-viewer-widget-background"],this.setElement(this.template({data:this})),this.$el.prependTo(this.page.$fixedBgContainer),this.$picture=this.$(".picture-background"),this.$video=this.$(".video-background"),this.$videoContainer=this.$(".video-container"),this.$slideshow=this.$(".slideshow-container"),this.$slideshowPreload=this.$(".slideshow-preload"),this.picture&&"picture"===this.selectedType?this.renderPicture():s.a.isEmpty(this.video)||"video"!==this.selectedType?this.slideshow&&"slideshow"===this.selectedType?this.renderSlideshow():this.widgetIsLoaded():this.renderVideo(),this},start:function(){return this.started=!0,"video"===this.selectedType&&!RM.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&(this.videoWidget.start(),this.onResize()),"slideshow"!==this.selectedType||RM.screenshot||!this.rendered||this.destroyed||!this.slideshowWidget||this.slideshowWidget.isAnimationRunning||this.slideshowWidget.startAnimationLoop(),this},stop:function(){return this.started=!1,"video"===this.selectedType&&!RM.screenshot&&this.rendered&&this.videoWidget&&!this.destroyed&&this.videoWidget.stop(),"slideshow"===this.selectedType&&!RM.screenshot&&this.rendered&&!this.destroyed&&this.slideshowWidget&&this.slideshowWidget.isAnimationRunning&&this.slideshowWidget.stopAnimationLoop(),this},destroy:function(){return this.page.off("resize",this.onResize,this),"video"===this.selectedType&&(this.videoWidget&&this.videoWidget.destroy(),this.videoWidget=null),"slideshow"===this.selectedType&&(this.slideshowWidget&&this.slideshowWidget.destroy(),this.slideshowWidget=null),v.prototype.destroy.apply(this,arguments)},hasVideoBG:function(){return!(RM.screenshot||"video"!==this.selectedType||!this.video||!this.video.url)},onResize:function(){!this.destroyed&&this.$videoContainer&&this.video&&S.a.setVideoPosition({mag:this.page.mag,$container:this.$videoContainer,$media:this.$videoContainer.children(),provider:this.video.provider_name,aspect_poster:this.video.aspect_poster||this.videoWidget&&this.videoWidget.aspect_poster,aspect_real:this.video.aspect_real,controls_remove:!0})},renderPicture:function(){if(this.picture){var t=P.a.useLambdaUrl(this.picture)||P.a.useLambdaUrlOldProjects(this.picture,"background")?P.a.getLambdaUrl(this.picture):this.picture.finalUrl||this.picture.effectUrl||this.picture.unscaledOptimizedUrl||this.picture.url;Object(n.a)("<img/>").on("load",s.a.bind((function(){this.$picture.css({"background-image":"url("+t+")"}),RM.screenshot?setTimeout(this.widgetIsLoaded,200):this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded).attr("src",t)}else this.widgetIsLoaded()},renderSlideshow:function(){this.slideshowWidget=new O.a({data:this.slideshow,container:this.$slideshow,preloadContainer:this.$slideshowPreload,name:this.page.cid}),RM.screenshot?(this.slideshowWidget.render(),this.slideshowWidget.on("loaded",function(){this.widgetIsLoaded()}.bind(this))):(this.slideshowWidget.render(!this.page.isCurrent()),this.widgetIsLoaded())},renderVideo:function(){this.video.id=this.id,this.video.mute=this.mute,this.video.loop=this.loop,this.video.controls=!1,this.videoWidget=new M(this.video,this.page,this.$videoContainer),this.videoWidget.on("loaded",s.a.bind((function(){this.widgetIsLoaded(),this.onResize()}),this)),this.videoWidget.on("playStarted",s.a.bind((function(){this.trigger("videoBGStarted")}),this)),this.videoWidget.render()}}),A=i("lRGI");function D(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function z(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?D(Object(i),!0).forEach((function(e){L(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function L(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var B=v.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){var t;return this.preloadIconImage({default:!0}),this.makeBox("widget-button"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.buttonWidget=new A.a(t),this.preloadIconImage({hover:!0}),this.$el.on(w.a.isDesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.on(w.a.isDesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.on("click",this.onButtonClick),this.checkLink(),RM.screenshot?(this.waitForIconImageLoad(),this.waitForUsedFontsLoad()):this.widgetIsLoaded(),this},renderButtonText:function(t){this.buttonWidget.renderButtonText(t)},renderButtonTextWithSizes:function(t,e){this.buttonWidget.renderButtonTextWithSizes(t,z(z({},this),e))},hasFontsToLoad:function(){return"text"===this.tp||"text_and_icon"===this.tp},onButtonHover:function(){this.$(".common-button").addClass("hovered")},onButtonHoverOut:function(){this.$(".common-button").removeClass("hovered")},onButtonClick:function(t){if(2!==t.which&&!t.metaKey&&!t.ctrlKey){var e=this.$el.closest("a"),i=n.a.trim(e.attr("href")).match(/\/start-with-template\/(\d+)$/i),o=i&&i[1];o&&RM.viewerRouter&&RM.viewerRouter.createMagFromTemplate&&(t.preventDefault(),RM.viewerRouter.createMagFromTemplate("template-link",o))}},preloadIconImage:function(t){t=t||{};var e=this.tp;if("icon"===e||"text_and_icon"===e){if(t.default)(new Image).src=Modernizr.retina&&this.icon_raster2xUrl||this.icon_rasterUrl;if(t.hover)(new Image).src=Modernizr.retina&&this["hover-icon_raster2xUrl"]||this["hover-icon_rasterUrl"]}},_widgetIsLoaded:function(){this.loaded||this.destroyed||(RM.screenshot?this.iconImageLoaded&&this.fontLoaded&&this.widgetIsLoaded():this.widgetIsLoaded())},waitForIconImageLoad:function(){this.iconImageLoaded=!1,"icon"!==this.tp&&"text_and_icon"!==this.tp||!this.icon_rasterUrl?this.onIconImageLoaded():Object(n.a)("<img>").on("load",this.onIconImageLoaded).on("error",this.onIconImageLoaded).attr("src",Modernizr.retina?this.icon_raster2xUrl||this.icon_rasterUrl||"":this.icon_rasterUrl||"")},onIconImageLoaded:function(){this.iconImageLoaded=!0,this._widgetIsLoaded()},waitForUsedFontsLoad:function(){this.fontLoaded=!1,this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.onFontLoaded):this.onFontLoaded()},onFontLoaded:function(){this.fontLoaded=!0,this._widgetIsLoaded()},destroy:function(){return this.buttonWidget&&this.buttonWidget.destroy(),this.buttonWidget=null,this.$el.off(w.a.isDesktop?"mouseenter":"touchstart",this.onButtonHover),this.$el.off(w.a.isDesktop?"mouseleave":"touchend",this.onButtonHoverOut),this.$el.off("click",this.onButtonClick),v.prototype.destroy.apply(this,arguments)}}),F=i("A0Lk"),N=i.n(F),U=i("tZHv"),H=B.extend({initialize:function(){B.prototype.initialize.apply(this,arguments),this.is_above&&this.mag.on("destroyed",this.destroy)},render:function(){var t=this,e=!1;if(RM.screenshot)window.ServerData.userPermissions&&window.ServerData.userPermissions.can_use_e_commerce&&(e=!0);else{var i=RM.viewerRouter?RM.viewerRouter.getUserPermissions():RM.constructorRouter.me.get("permissions");i&&i.can_use_e_commerce&&(e=!0)}if(e){if(B.prototype.render.apply(this,arguments),!RM.screenshot){this.mag.eCommerceManager.events.on("ecommerce:cartdata:changed",this.renderTotalItems);var n=this["font-family"];if(n&&!U.a.systemFontsList.includes(n.toLowerCase())){var o=new N.a(this["font-family"]);o.load().then((function(){t.renderTotalItems(t.mag.eCommerceManager.getCartData())})).catch((function(){t.renderTotalItems(t.mag.eCommerceManager.getCartData())}))}else this.renderTotalItems(this.mag.eCommerceManager.getCartData())}return this}},renderTotalItems:function(t){if(t&&t.skus){var e=0;for(var i in t.skus)t.skus.hasOwnProperty(i)&&(e+=t.skus[i].cart_count);for(var n in t.prices)t.prices.hasOwnProperty(n)&&(e+=t.prices[n].cart_count);var o=e?"".concat(this.text||""," ").concat(e):this.text||"",a=this.recalcTextInputSize(o);this.renderButtonTextWithSizes(o,a)}},onButtonClick:function(){this.mag.eCommerceManager.changeCartSidebarVisibility()},recalcTextInputSize:function(t){var e,i,o,a,s=this["font-size"],r=this["letter-spacing"],l=this["font-family"],c=this["font-style"],d=this["font-weight"];return this.$textInputSizeAdjuster||(this.$textInputSizeAdjuster=Object(n.a)("<div/>"),this.$textInputSizeAdjuster.css({position:"absolute",left:"-9999px",top:"-9999px","white-space":"pre",width:"auto"}),Object(n.a)(document.getElementById("tmp")).append(this.$textInputSizeAdjuster)),this.$textInputSizeAdjuster.addClass("for-text-size-calc").addClass(p.default.generateUUID()),this.$textInputSizeAdjuster.text(t.trim()),this.$textInputSizeAdjuster.css({"font-family":l,"font-style":c,"font-weight":d,"font-size":s+"px","letter-spacing":r+"px"}),e=this.$textInputSizeAdjuster.width(),i=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.css("letter-spacing",0).text("M"),o=this.$textInputSizeAdjuster.width(),o=2*Math.ceil(o/2),a=this.$textInputSizeAdjuster.height(),0===t.length&&(e=o,i=a),e=2*Math.ceil(e/2),{text_w:e+=o,text_h:i=2*Math.ceil(i/2)}},destroy:function(){return this.mag.eCommerceManager.events.off("ecommerce:cartdata:changed",this.renderTotalItems),this.$textInputSizeAdjuster&&(this.$textInputSizeAdjuster.remove(),this.$textInputSizeAdjuster=null),B.prototype.destroy.apply(this,arguments)}}),V=i("3eHG"),W=i("wxrA"),G=i.n(W),q=v.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,initialize:function(){return v.prototype.initialize.apply(this,arguments),"type_like_box"===this.current_type&&(this.current_type="type_page",this.type_page=this.type_like_box),this},render:function(){return this.makeBox("widget-facebook"),this.rendered=!0,this.started?this.start():!RM.screenshot&&this.widgetIsLoaded(),this},start:function(){if(this.started=!0,this.destroyed||!this.rendered||this.innerRendered)return this;this.innerRendered=!0;var t,e,i=this;return this.current_type?((e=this[this.current_type]).w=this.w,e.h=this.h,"mag"===e.use_own_url?e.url=this.page.mag.getUrl():"page"!==e.use_own_url&&e.url||(e.url=this.page.getUrl()),t=G.a["template-constructor-block-facebook-"+this.current_type],this.$el.html(t({data:e})).removeClass(["type_like_button","type_page","type_comments"].join(" ")).addClass(this.current_type),"type_comments"===this.current_type?this.$el.css({"overflow-x":"hidden","overflow-y":"auto"}):"type_like_button"!==this.current_type&&this.$el.css({overflow:"hidden"}),V.a.initFacebookAPI((function(){!i.destroyed&&i.innerRendered&&window.FB.XFBML.parse(i.$el.get(0),(function(){s.a.delay((function(){!i.destroyed&&i.innerRendered&&(i.widgetIsLoaded(),"type_like_button"===i.current_type&&(i.iframe_w=i.$("iframe").width(),i.iframe_h=i.$("iframe").height()))}),500)}))})),this):(this.widgetIsLoaded(),this)},stop:function(){return this.started=!1,this}}),K=i("gm8A");function X(t){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Z(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Z(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var J=v.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,NUMBER_TEST_REGEX:/^[0-9.,`']+$/,events:{"focus :input":"onFocus","blur :input":"onBlur"},render:function(){return this.makeBox("widget-form"),this.rendered=!0,this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),this.formWidget=new K.a({data:this,environment:"viewer",$container:this.$el}),this.formWidget.render(),this.$button=this.$(".button"),this.$button.on("click",this.onButtonClick),this.$(".js-input").on("keydown",this.onInputKeyDown),this.$(".js-input").on("input",this.onInput),this.$("select").on("change",this.onInput),RM.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this},hasFontsToLoad:function(){return!0},destroy:function(){return this.formWidget&&this.formWidget.destroy(),this.formWidget=null,this.$(".button").off("click",this.onButtonClick),v.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},onFocus:function(){Backbone.trigger("form:focus",this._id)},onBlur:function(){Backbone.trigger("form:blur",this._id)},onButtonClick:function(){this.$button.hasClass("submitted")||this.validateForm()&&(this.setButtonState("submitted"),"Text after submit"===this.button_caption_after_submit||!this.button_caption_after_submit||this.submit_mode&&"textAfterSubmit"!==this.submit_mode?this.$button.addClass("empty-submitted-text"):this.$button.find(".caption").text(this.button_caption_after_submit),RM.common.isDownloadedSource?this.submitToIframe((function(t){t&&(this.setButtonState("error"),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t))})):this.submitForm(function(t){t&&(this.setButtonState("error"),t.responseJSON&&"email_not_confirmed"===t.responseJSON.name&&s.a.delay((function(){alert(t.responseJSON.message)}),100),RM.analytics&&RM.analytics.sendEvent("Form Submit Error",t))}.bind(this)),this.link_after_submit&&this.submit_mode&&"textAfterSubmit"!==this.submit_mode&&this.applyLink())},applyLink:function(){var t;"toUrlAfterSubmit"===this.submit_mode?this.openInNewTab(this.link_after_submit):(t=this.page.mag.getPageUri?"/"+this.page.mag.getPageUri(this.link_after_submit):"javascript:void(0)",this.mag.router.navigate(t,{trigger:!0}))},openInNewTab:function(t){Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener",href:t}).click()},getDataBySort:function(t){return t=parseInt(t,10),s.a.findWhere(this.fields,{sort:t})},validateForm:function(){var t=this.$(".js-input"),e=!0;return s.a.each(t,function(t){var i=Object(n.a)(t),o=i.val().trim(),a=this.getDataBySort(i.attr("data-sort")),s=!0;if(o)switch(a.tp){case"name":case"text":case"dropdown":break;case"email":p.default.isValidEmail(o)||(s=!1);break;case"phone":/^[0123456789 +-]+$/.test(o)||(s=!1);break;case"number":this.NUMBER_TEST_REGEX.test(o)&&!isNaN(parseFloat(o))||(s=!1);break;case"checkbox":a.optional||i.prop("checked")||(s=!1)}else s=a.optional;s||(this.formWidget.applyInputsStyle(i.closest(".input-wrapper"),{invalid:!0}),e=!1)}.bind(this)),e},onInput:function(t){var e=Object(n.a)(t.currentTarget).parent().find(".js-input");this.formWidget.applyInputsStyle(e.closest(".input-wrapper")),this.setButtonState()},onInputKeyDown:function(t){t.keyCode!==n.a.keycodes.enter||Object(n.a)(t.target).is("textarea")||this.onButtonClick(),!Object(n.a)(t.target).is("textarea")||t.keyCode!==n.a.keycodes.up&&t.keyCode!==n.a.keycodes.down||t.stopPropagation()},getFormData:function(){var t={wid:this._id,mag_num_id:this.page.mag.num_id,is_preview:!(!RM.constructorRouter||!RM.constructorRouter.preview),fields:[]};return s.a.each(this.fields,function(e){var i=this.$(".js-input[data-sort="+e.sort+"]"),n=i.val().trim();if("checkbox"===e.tp&&(n=i.prop("checked")?"On":"Off"),"number"===e.tp){var o=parseFloat(n);n=isNaN(o)?n:o}"file"!==e.tp&&t.fields.push({caption:e.caption,type:e.tp,value:n})}.bind(this)),t},submitForm:function(t){if(this.xhr&&this.xhr.abort(),Object(m.a)("constructor.formsAddFile")){var e=this.$el.find("form");e.length||(e=this.$el.find(".form-wrapper").wrap('<form enctype="multipart/form-data" method="post" target="form_submit_iframe"></form>').parent().attr("action","/api/connect/forms/send"));var i=new FormData(e.get(0)),o=this.getFormData();if(o&&o.fields){var a,s=Y(o.fields);try{for(s.s();!(a=s.n()).done;){var r=a.value;i.delete(r.name)}}catch(t){s.e(t)}finally{s.f()}}for(var l=0,c=Object.keys(o);l<c.length;l++){var d=c[l];i.append(d,"object"===X(o[d])&&null!==o[d]?JSON.stringify(o[d]):o[d])}this.xhr=n.a.ajax({url:"/api/connect/forms/send",method:"POST",dataType:"json",data:i,cache:!1,contentType:!1,processData:!1,success:function(){t()},error:function(e){t({status:e.status,responseJSON:e.responseJSON,responseText:e.responseText})}})}else this.xhr=n.a.ajax({dataType:"json",contentType:"application/json",url:"/api/connect/forms/submit",data:JSON.stringify(this.getFormData()),method:"POST",success:function(){t()},error:function(e){t({status:e.status,responseJSON:e.responseJSON,responseText:e.responseText})}});RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},submitToIframe:function(t){var e,i=this.endpoint_url&&this.endpoint_url.custom_url;if(!i)return t("No custom URL specified for submit");Object(n.a)("#form_submit_iframe").length||Object(n.a)('<iframe id="form_submit_iframe" name="form_submit_iframe" style="display:none;"></iframe>').appendTo("body"),(e=this.$el.find("form")).length||(e=this.$el.find(".form-wrapper").wrap('<form method="post" target="form_submit_iframe"'.concat(Object(m.a)("constructor.formsAddFile")?' enctype="multipart/form-data"':"","></form>")).parent().attr("action",i)),e.get(0).submit(),t(null),RM.analytics&&RM.analytics.sendEvent("Form Submit Click")},setButtonState:function(t){t=t||"";this.$button.removeClass(["error","submitted"].join(" ")).addClass(t)}}),Q=i("udqo");function tt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function et(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var it=v.extend({antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){this.makeBox("widget-picture"),this.canShowPreview()&&this.initPreview(),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.$lqipImg=null,this.useLqip=P.a.flagLQIP()&&this.mag&&this.mag.opts&&this.mag.opts.lqip;var t=this.getPictureUrl();if(/\.gif/.test(t)&&(this.isGIF=!0),this.$el.html(""),this.isVector(t)&&!U.a.IS_FILE_PROTOCOL)this.loadVector(t);else{var e=!!(this.border_size>0||this.border_radius>0||this.border_radius_max||this.border_radius_independent&&(this.border_radius_tl>0||this.border_radius_tr>0||this.border_radius_bl>0||this.border_radius_br>0)||this.is_full_width||this.is_full_height),i=void 0===this.opacity?1:this.opacity;if(this.insideHotspot&&this.isGIF){var o=this.scale;Object(n.a)("<div/>").appendTo(this.$el).css({position:"absolute","background-image":"url("+t+")","background-position":"50% 50%",width:Math.max(Math.round(this.originalW*o),this.w),height:Math.max(Math.round(this.originalH*o),this.h),top:-Math.round(this.cropY*o),left:-Math.round(this.cropX*o)}).attr("url",t)}else e&&Object(n.a)("<div/>").appendTo(this.$el).addClass("bgpic").css({"background-image":this.useLqip?"":"url(".concat(t,")"),"background-position":(this.fhpos?this.fhpos:50)+"% "+(this.fwpos?this.fwpos:50)+"%","box-shadow":this.border_size>0?"inset 0 0 0 "+this.border_size+"px #"+(this.border_color||"000000"):"none","border-radius":this.getBorderRadius(),opacity:this.useLqip?0:i}).attr("url",this.useLqip?"":t);if(P.a.useLambdaUrl(this.picture)||P.a.useLambdaUrlOldProjects(this.picture)){var a=P.a.getSrcset(this.picture,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(i),!0).forEach((function(e){et(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):tt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},this.getPictureOptions()));Object(n.a)("<img/>").attr("srcset",a).attr("alt",this.getAltText()).attr("src",t).addClass("viewable").toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("opacity",0).load(s.a.bind((function(){var e=this.$el.find(".viewable"),n=e&&e.get(0)&&e.get(0).currentSrc||t,o=this.$el.find(".bgpic");o&&o.css({opacity:i,"background-image":"url(".concat(n,")")}).attr("url",n),e&&e.css("opacity",i),this.$lqipImg&&this.$lqipImg.css("opacity",0),s.a.delay(s.a.bind((function(){this.$el.css({overflow:"","border-radius":""}),this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()}),this),200)}),this)).on("error",s.a.bind((function(){this.$lqipImg&&this.$lqipImg.remove(),this.$lqipImg=null,this.widgetIsLoaded()}),this)).appendTo(this.$el),this.useLqip&&(this.$el.css("overflow","hidden"),(this.border_radius||this.border_radius_max||this.border_radius_independent)&&this.$el.css("border-radius",this.getBorderRadius()),this.$lqipImg=Object(n.a)("<div/>").addClass("lqip").css({"background-image":"url(".concat(P.a.getLqipUrl(this.picture,{cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH}),")"),"background-position":"50% 50%",opacity:i}).appendTo(this.$el))}else Object(n.a)("<img/>").appendTo(this.$el).toggleClass("saveable",!!(e||this.insideHotspot&&this.isGIF)).css("opacity",void 0===this.opacity?1:this.opacity).addClass("viewable").load(s.a.bind((function(){this.$el.find("img").attr("url",t),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded).attr("srcset",this.getSrcset()).attr("alt",this.getAltText()).attr("src",t)}return this.checkLink(),this},getBorderRadius:function(){return this.border_radius_independent?"".concat(this.border_radius_tl||0,"px ").concat(this.border_radius_tr||0,"px ").concat(this.border_radius_bl||0,"px ").concat(this.border_radius_br||0,"px"):"".concat(this.border_radius_max?"9999":this.border_radius||0,"px")},canShowPreview:function(){var t=Boolean(this.getAnimations().find((function(t){return"click"===t.type&&t.steps&&t.steps.length}))),e=!!this.clickLink;return this.preview_enabled&&!t&&!e},isValid:function(){return Boolean(this.picture&&(this.picture.type||this.picture.unscaledUrl||this.picture.finalUrl||this.picture.editedVectorUrl||this.picture.url))},isVector:function(t,e){var i=t||this.picture&&this.picture.url;return"svg"===(e||this.picture&&this.picture.type)||i&&0===s.a.last(i.split(".")).indexOf("svg")},start:function(){return this.started=!0,Modernizr.safari&&this.isGIF&&this.$el.flashClass("fix-safari-gif",100),this},getPictureOptions:function(){var t=this.getAnimations().reduce((function(t,e){return Math.max(t,h.a.maxScaleAnimation(e))}),0);return{width:this.w,height:this.h,cropX:this.cropX,cropY:this.cropY,cropW:this.cropW,cropH:this.cropH,originalW:this.originalW,originalH:this.originalH,scale:d.a.isOn(this.page.scale)?this.page.scale:1,animationScale:t&&t/100,isStretched:this.is_full_width||this.is_full_height}},getPictureUrl:function(){return this.picture?P.a.useLambdaUrl(this.picture)||P.a.useLambdaUrlOldProjects(this.picture)?P.a.getLambdaUrl(this.picture,this.getPictureOptions()):this.picture.finalUrl&&0===s.a.last(this.picture.finalUrl.split(".")).indexOf("svg")?this.picture.finalUrl:(t=d.a.isOn(this.page.scale)?this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl:Modernizr.retina&&(window.devicePixelRatio>=3&&(this.picture.final3xUrl||this.picture.unscaledOptimizedUrl)||this.picture.final2xUrl||this.picture.unscaledOptimizedUrl)||this.picture.finalUrl,(this.is_full_width||this.is_full_height)&&(t=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final2xUrl||this.picture.finalUrl),t||this.picture.effectUrl||this.picture.editedVectorUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.url):"";var t},getAltText:function(){return this.picture&&this.alt?s.a.escape(this.alt):void 0},getSrcset:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.picture)return[];if(!this.originalW)return[];if(this.isGIF)return[];if(d.a.isAllowed())return[];if(this.getAnimations().length)return[];if(RM.screenshot)return[];if(this.picture.finalUrl&&0===s.a.last(this.picture.finalUrl.split(".")).indexOf("svg"))return[];var e=Math.floor(this.w),i=[{url:this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl,size:this.originalW},{url:this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl),size:3*e},{url:this.picture.final2xUrl,size:2*e},{url:this.picture.finalUrl,size:e}];if(i=i.filter(function(t){return!!t.url&&this.originalW>=t.size}.bind(this)).map((function(t){return"".concat(t.url," ").concat(t.size,"w")})),!t)return i;var n=["".concat(this.picture.finalUrl||this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl," 1x")];return this.picture.final2xUrl&&n.push("".concat(this.picture.final2xUrl," 2x")),this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)&&n.push("".concat(this.picture.final2xUrl&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl)," 3x")),n.concat(i)},cleanupSVG:function(t){var e=Object(n.a)(Object(n.a)(t).find("svg").get(0).cloneNode(!0)),i=e[0].outerHTML;return s.a.chain(e.find("[id]")).map((function(t){return{id:t.getAttribute("id"),newId:p.default.generateUUID()}})).sortBy((function(t){return-t.id.length})).each((function(t){i=(i=i.split("#"+t.id).join("#"+t.newId)).split('id="'+t.id+'"').join('id="'+t.newId+'"')})),i},loadVector:function(t){this.$el.addClass("svg"),this.svgAjax=n.a.get(t+"?c",s.a.bind((function(e){(e=Object(n.a)(this.cleanupSVG(e))).get(0).removeAttribute("width"),e.get(0).removeAttribute("height"),this.$svg=e;var i=e.get(0).cloneNode(!0);this.$svg.find("title").remove();var o=new Image;Object(n.a)(o).on("load error",s.a.bind((function(){Object(n.a)(o).appendTo(window.document.body).css({width:"100%",height:"100%"});var t=Object(n.a)(i);t.get(0).setAttribute("viewBox","0 0 "+Object(n.a)(o).width()+" "+Object(n.a)(o).height()),t.appendTo(window.document.body);var e=t.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),Object(n.a)(o).remove(),t.remove();var a=Object(n.a)('<div class="svg-scale-wrapper"></div>');this.$svg.appendTo(a),a.appendTo(this.$el),this.widgetIsLoaded()}),this)),o.src=t}),this)).fail(this.widgetIsLoaded)},initPreview:function(){this.preview=new Q.a({$container:Object(n.a)("body"),$el:this.$el,picture:this.picture,overlayColor:this.preview_overlay_color,originalW:this.originalW,width:this.w}),this.$el.addClass("preview-enabled"),this.$el.on("click",function(){this.preview.render(),this.preview.bindClick()}.bind(this))}}),nt=v.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){this.makeBox("widget-gmaps"),this.$el.html(Object(n.a)('<div class="map-container"></div>')),this.rendered=!0;var t=this.api_key;return this.mag&&this.mag.opts&&this.mag.opts.gmaps_key&&this.mag.opts.gmaps_key!==this.api_key&&(t=this.mag.opts.gmaps_key),V.a.initGMapsAPI(t,function(){this.destroyed||s.a.defer(function(){this.destroyed||(d.a.isOn()&&this.scale(),this.map=new google.maps.Map(this.$(".map-container").get(0),{zoom:this.map_zoom,center:new google.maps.LatLng(this.center_lat,this.center_lng),mapTypeId:this.map_type_id||google.maps.MapTypeId.ROADMAP,disableDefaultUI:!this.show_controls,streetViewControl:!1,scrollwheel:void 0===this.scrollwheel||!!this.scrollwheel}),this.marker_lat&&this.marker_lng&&"directions"!==this.current_type&&(this.marker=new google.maps.Marker({map:this.map,position:new google.maps.LatLng(this.marker_lat,this.marker_lng)}),google.maps.event.addListener(this.marker,"click",function(){this.infowindow&&this.infowindow.open(this.map,this.marker)}.bind(this)),this.infowindow=new google.maps.InfoWindow({maxWidth:this.w-100}),this.formatted_address?this.infowindow.setContent(this.formatted_address):(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(this.marker_lat,this.marker_lng)},function(t,e){e===google.maps.GeocoderStatus.OK&&t[0]&&this.infowindow.setContent(t[0].formatted_address)}.bind(this))),"directions"===this.current_type&&this.direction_start_lat&&this.direction_start_lng&&this.direction_end_lat&&this.direction_end_lng&&this.direction_route_type?(this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer({preserveViewport:!0}),this.directionsService.route({origin:new google.maps.LatLng(this.direction_start_lat,this.direction_start_lng),destination:new google.maps.LatLng(this.direction_end_lat,this.direction_end_lng),travelMode:google.maps.TravelMode[this.direction_route_type.toUpperCase()]},function(t,e){e===google.maps.DirectionsStatus.OK&&(this.directionsDisplay.setDirections(t),this.directionsDisplay.setMap(this.map),google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)))}.bind(this))):google.maps.event.addListener(this.map,"tilesloaded",function(){this.widgetIsLoaded()}.bind(this)),"custom"===this.current_type&&this.custom_json&&this.map.setOptions({styles:JSON.parse(this.custom_json)}))}.bind(this))}.bind(this)),this},scale:function(){var t=this.mag.getScale(this.page.pageViewport),e=this.$(".map-container");if(d.a.isZoom())e.css("zoom",1/t);else if(d.a.isTransform()){var i=100*t,n=(i-100)/2;e.css({transform:"scale("+1/t+") translate(-"+n+"%, -"+n+"%)",width:i+"%",height:i+"%"})}},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.map?(google.maps.event.trigger(this.map,"resize"),this.map.setCenter(new google.maps.LatLng(this.center_lat,this.center_lng)),this):this},destroy:function(){return this.map&&google.maps.event.clearListeners(this.map,"tilesloaded"),this.marker&&google.maps.event.clearListeners(this.marker,"click"),v.prototype.destroy.apply(this,arguments)}}),ot=i("gHxz"),at=i.n(ot),st=i("z79a"),rt=i("cBBe"),lt=v.extend(st.a.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){var t;if(this.makeBox("widget-hotspot"),this.rendered=!0,this.phoneTipWrapperTemplate=at.a["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!(!RM.constructorRouter||!RM.constructorRouter.preview),t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new rt.a(t),this.$pin=this.$(".pin").addClass("viewer"),this.started&&this.renderTip(),"icon"===this.pin_type){if(this.$el.addClass("icon"),!this.rasterUrl)return this.widgetIsLoaded(),this;var e=Object(n.a)("<img>");e.on("load",s.a.bind((function(){this.$(".pin").html(e),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),e.attr("src",this.raster3xUrl||this.raster2xUrl||this.rasterUrl||"")}else this.renderPinShape(),this.widgetIsLoaded();return this},renderPinShape:function(){var t,e=new Backbone.Model(this);e.id=this._id,t=this.generateShapeSVG("viewer",e,this.w,this.h),this.$pin.html(t)},renderTip:function(){this.isTipRendered||(this.$tip=Object(n.a)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=Object(n.a)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":p.default.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.$(".common-hotspot").append(this.$tip),this.pictureData=s.a.findWhere(this.wids||[],{type:"picture"}),this.textData=s.a.findWhere(this.wids||[],{type:"text"}),this.hasPictureWidget=!(!this.pictureData||this.pictureData.hidden),this.hasTextWidget=!(!this.textData||this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureWidget=new te.picture(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.hasGlobalParent=this.is_global,this.textWidget=new te.text(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.textWidget.render()),this.hasPictureWidget||this.hasTextWidget?(this.$closeButton=Object(n.a)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0):this.$tip.remove())},updatePage:function(t){v.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return this.started=!1,this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){var t,e,i,n,o,a,r,l=this.calcDistsToPageVisibleBounds(),c=this.w,d=this.h,h=this.$tip.width(),u=this.$tip.height(),p=this.hotspotWidget.TIP_GAP,g=this.tip_pos,m=s.a.pick(this,"w","h","tip_w","tip_h","tip_pos"),f=!1,v=!1;function b(t){var e,i,n,o;switch(t){case"top":e=l.top-d/2-p-u,n=l.bottom+d/2+p,o=l.left-h/2,i=l.right-h/2;break;case"right":e=l.top-u/2,n=l.bottom-u/2,o=l.left+c/2+p,i=l.right-c/2-p-h;break;case"bottom":e=l.bottom+d/2+p,n=l.bottom-d/2-p-u,o=l.left-h/2,i=l.right-h/2;break;case"left":e=l.top-u/2,n=l.bottom-u/2,o=l.left-c/2-p-h,i=l.right+c/2+p}return{top:e,left:o,bottom:n,right:i}}i=this.tip_pos,o=i,a=-1/0,r=!1,s.a.each(["top","right","bottom","left"],(function(t){if(!r){var e=b(t);n=s.a.min(e),t===i&&e[t]>0?(o=t,r=!0):n>a&&e[t]>=0&&(a=n,o=t)}})),g=o,m.tip_pos=g,e=this.hotspotWidget.apply_tip_position(m),t=b(g),s.a.each(t,function(t,i){if(t<0)switch(i){case"top":e.top-=t-this.EDGE_GAP,f=!0;break;case"bottom":f||(e.top+=t-this.EDGE_GAP);break;case"left":e.left-=t-this.EDGE_GAP,v=!0;break;case"right":v||(e.left+=t-this.EDGE_GAP)}}.bind(this)),this.$tip.css(e)},adjustPictureSize:function(){var t,e=this.tip_w/this.PHONE_TIP_WIDTH;this.pictureWidget&&(t=this.isPhone()?{width:this.PHONE_TIP_WIDTH,height:this.pictureData.h/e}:{width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(t))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("Hotspot Click"))},onMouseenter:function(){this.isHoverable()&&this.isTipRendered&&(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("Hotspot Hover"))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){this.isTipRendered&&(this.adjustPictureSize(),this.isPhone()?(this.$phoneTipWrapper=this.$phoneTipWrapper||Object(n.a)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tip.detach().appendTo(this.$phoneTipWrapper.find(".center-cell")),s.a.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(t){Object(n.a)(t.target).closest(".tip").is(this.$tip)||(this.hideTip(),this.$phoneTipWrapper.off())}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)):(this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.router.$mags_container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||Object(n.a)("body").on("keydown",this.onBodyKeyDown)),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isTipVisible=!0)},hideTip:function(){this.isTipVisible&&(this.isTipVisible=!1,clearTimeout(this.mouseLeaveTimeout),this.isPhone()?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),s.a.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.BackToNormalZ(),Object(n.a)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"))},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();var e=Object(n.a)(t.currentTarget),i=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(i<0&&e.scrollTop()<=0||i>0&&e.scrollTop()+e.height()>=e[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){var e=Object(n.a)(t.target),i=e.closest(".pin"),o=e.closest(".tip");i.is(this.$pin)||o.is(this.$tip)||(this.page.mag.router.$mags_container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return w.a.isPhone||this.isPreview&&"phone_portrait"===this.page.mag.viewport},isHoverable:function(){return"hover"===this.tip_show_on&&w.a.isDesktop&&!this.isPhone()&&"tablet_portrait"!==this.page.mag.viewport},onBodyKeyDown:function(t){t.keyCode===n.a.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,v.prototype.destroy.apply(this,arguments)}}),ct=i("60Nw"),dt=v.extend({render:function(){this.makeBox("widget-iframe"),this.rendered=!0;var t=this.getPluginClass();return t?(this.plugin=new t({widget:this}),this.$el.addClass(this.plugin.embed_type),this.started?this.drawPlugin():(this.contentCleared=!0,!RM.screenshot&&!this.drawInProgress&&this.widgetIsLoaded()),this):(this.widgetIsLoaded(),this)},drawPlugin:function(){this.$el.empty(),this.contentCleared=!1,this.drawInProgress=!0,this.plugin.parse(this.code,function(t){if(this.$data=this.plugin.sanitize(t),RM.screenshot&&setTimeout(s.a.bind((function(){this.widgetIsLoaded()}),this),5e3),this.plugin.draw(this.$data,this.$el,function(t,e){var i=RM.screenshot?5e3:2e3;this.loadTimeout=setTimeout(function(){this.drawInProgress=!1,this.destroyed||(this.widgetIsLoaded(),this.$data.off&&this.$data.off("load"),this.started||this.clearContent())}.bind(this),i)}.bind(this)),!RM.screenshot){if(!s.a.isFunction(this.$data.one))return;this.$data.one("load",function(){this.drawInProgress=!1,!this.destroyed&&this.started&&(this.widgetIsLoaded(),clearTimeout(this.loadTimeout))}.bind(this))}}.bind(this))},widgetIsLoaded:function(){this.loaded||this.destroyed||(this.loaded=!0,this.trigger("loaded"))},isValid:function(){return this.code&&this.getPluginClass()},start:function(){return this.started=!0,this.destroyed||!this.rendered||this.contentCleared&&this.drawPlugin(),this},stop:function(){return this.started=!1,this.plugin?(this.widgetIsLoaded(),this.drawInProgress?void 0:(this.clearContent(),this)):this},clearContent:function(){this.clear_content&&(this.$el.empty(),this.contentCleared=!0)},getPluginClass:function(){return ct.a.findPlugin(this)},destroy:function(){return this.clearContent(),this.plugin&&this.plugin.remove(),v.prototype.destroy.apply(this,arguments)}}),ht=v.extend(st.a.prototype).extend({mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){if(this.makeBox("widget-shape"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.requiresImageLoad()){if(!this.rasterUrl)return this.widgetIsLoaded(),this;this.$el.addClass("icon"),this.antialiasRotation=!0;var t=Object(n.a)("<img>");t.on("load",s.a.bind((function(){this.$el.html(t),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),t.attr("src",Modernizr.retina||d.a.isOn(this.page.scale)?this.raster2xUrl||this.rasterUrl||"":this.rasterUrl||"")}else this.redrawSVG(),this.widgetIsLoaded();return this.checkLink(),this},start:function(){Modernizr.firefox&&!this.requiresImageLoad()&&this.borders>0&&this.redrawSVG()},redrawSVG:function(){var t=this,e={id:t._id,get:function(e){return t[e]}};if("rectangle"!==this.tp||1!==this.opacity||w.a.isDesktop&&0!==this.borders){var i=this.generateShapeSVG("viewer-"+p.default.generateUUID(),e,this.$el.width(),this.$el.height());this.$el.html(i)}else{var n=p.default.hex2rgb(this.bg_color),o=p.default.hex2rgb(this.color);n&&n.push(this.bg_opacity),this.$el.css({"background-color":n?"rgba("+n.join(",")+")":"transparent","border-color":o?"rgb("+o.join(",")+")":"transparent","border-radius":this.radius||0,"border-style":"solid","border-width":this.borders,"box-sizing":"border-box"}),this.$el.addClass("div-instead-of-svg")}},requiresImageLoad:function(){return"icon"===this.tp},canRenderImmediately:function(){return!this.requiresImageLoad()},onPageResize:function(t){v.prototype.onPageResize.apply(this,arguments),this.requiresImageLoad()||this.redrawSVG()}}),ut=i("tcpm"),pt=v.extend({MIN_TOP_SCROLL_SPACE:5,TIME_OF_STOPPED_SCROLL:55,render:function(){var t=this;(this.makeBox("widget-slideshow"),this.pictures=s.a.filter(this.pictures,(function(t){return!t.error})),this.player=new ut.a(this,this.$el,"viewer",null,this.page&&this.page.mag),void 0!==this.play_method&&"scroll"===this.play_method)&&(Object(n.a)(window).on("scroll",this.onScrollTransition),this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.isScrolling=!1,this.$image=this.$el.find(".image"),this.lastScrollTop=0,this.isCrossfade="crossfade"===this.transition_type,this.delay=(this.theme_data.scroll_delay>0?this.theme_data.scroll_delay:1)+(this.isCrossfade?this.theme_data.crossfade:0),this.picsID=[],this.player.$images_wrapper.children(".image").each((function(e,i){t.picsID.push(Object(n.a)(i).attr("data-id"))})));return this.player.on("ready",s.a.bind((function(){setTimeout(this.widgetIsLoaded,100)}),this)),!this.theme_data.arrows||"library"!==this.theme_data.arrows_type&&"noun"!==this.theme_data.arrows_type||this.renderNounIcons(),this.rendered=!0,this},onScrollTransition:function(t){var e=this,i=window.pageYOffset||document.documentElement.scrollTop,n=this.y+this.innerContentTop,o=n-this.innerContainerHeight,a=0*(n-o)+o+this.theme_data.start_offset||0,s=this.isCrossfade?10*this.theme_data.crossfade:this.TIME_OF_STOPPED_SCROLL,r=this.picsID.length,l=a>0?(i-a*this.page.scale)/this.page.scale:i/this.page.scale,c=Math.floor(l/this.delay),d=c+1,h=d>=r?d-Math.floor(d/r)*r:d;this.isScrolling&&(this.setFreezeStyles(i),h>=0&&this.player.currentImageID!==this.picsID[h]&&this.changeImage(i,c,this.picsID[h])),a<=0&&i<this.MIN_TOP_SCROLL_SPACE?setTimeout((function(){e.changeImage(i,c,e.picsID[0]),e.isScrolling=!1}),s):(clearTimeout(this.isScrolling),this.isScrolling=setTimeout((function(){e.setFreezeStyles(i)}),s))},changeImage:function(t,e,i){(t>this.lastScrollTop&&t>=e*this.delay||t<this.lastScrollTop&&t>=(e-1)*this.delay)&&this.player.moveToImage(i,!0,"switch-to-image-scroll"),this.lastScrollTop=t<=0?0:t},setFreezeStyles:function(t){var e=this.$el.find(".center-image"),i=this.$el.find(".prev-image"),n=this.getRealOpacity(e.css("opacity")),o=this.getRealOpacity(i.css("opacity"));this.isCrossfade&&(e.css({opacity:n>o?n:1-o}),i.css({opacity:o>n?o:1-n}),e.hasClass("changed-opacity")||i.hasClass("changed-opacity")||i.addClass("changed-opacity"))},getRealOpacity:function(t){return t<.1?10*t:t},renderNounIcons:function(){var t=this.left_arrow_noun&&this.left_arrow_noun.rasterUrl?this.left_arrow_noun:this.theme_data.left_icon_noun,e=this.right_arrow_noun&&this.right_arrow_noun.rasterUrl?this.right_arrow_noun:this.theme_data.right_icon_noun,i=this.theme_data.arrows_position;if(t&&t.rasterUrl){var o=Object(n.a)("<img>");o.on("load",s.a.bind((function(){"bottom"===i?this.$el.find(".prev-picture-arrow-bottom").empty().html(o.clone()):this.$el.find(".prev-picture-arrow-middle").empty().html(o.clone())}),this)).on("error",this.widgetIsLoaded),o.attr("src",t.raster3xUrl||t.raster2xUrl||t.rasterUrl||"")}if(e&&e.rasterUrl){var a=Object(n.a)("<img>");a.on("load",s.a.bind((function(){"bottom"===i?this.$el.find(".next-picture-arrow-bottom").empty().html(a.clone()):this.$el.find(".next-picture-arrow-middle").empty().html(a.clone())}),this)).on("error",this.widgetIsLoaded),a.attr("src",e.raster3xUrl||e.raster2xUrl||e.rasterUrl||"")}},isValid:function(){return this.pictures&&this.pictures.length},start:function(){return this.started=!0,!RM.screenshot&&!this.destroyed&&this.player&&(this.theme_data.autoplay&&void 0===this.play_method||"autoplay"===this.play_method)&&this.rendered&&this.loaded&&this.player.startAutoplay(),this},stop:function(){return this.started=!1,!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.stopAutoplay(),this},destroy:function(){return this.player&&this.player.off(),this.player&&this.player.destroy(),this.player=null,"scroll"===this.play_method&&Object(n.a)(window).off("scroll",this.onScrollTransition),v.prototype.destroy.apply(this,arguments)}}),gt=i("q1tI"),mt=i.n(gt),ft=i("8AXF"),vt=i("DwEc");function bt(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var _t,yt,wt=v.extend({render:(_t=regeneratorRuntime.mark((function t(){var e,n,o,s,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.makeBox("widget-text-v3"),this.propsModel=new a.a.Model({currentPage:this.mag.currentPage}),this.mag.on("pageChanged",this.onPageChanged),e=i("8AXF"),n=e.renderReact,t.next=6,Promise.resolve().then(i.bind(null,"zjto"));case 6:return o=t.sent,s=o.TextViewer,n({component:function(){return mt.a.createElement(ft.CreateContextProvider,{context:vt.b,model:r.propsModel},mt.a.createElement(s,null))},domElement:this.$el[0],model:this.model}),this.rendered=!0,window.RM.screenshot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),t.abrupt("return",this);case 13:case"end":return t.stop()}}),t,this)})),yt=function(){var t=this,e=arguments;return new Promise((function(i,n){var o=_t.apply(t,e);function a(t){bt(o,i,n,a,s,"next",t)}function s(t){bt(o,i,n,a,s,"throw",t)}a(void 0)}))},function(){return yt.apply(this,arguments)}),hasFontsToLoad:function(){return!0},onPageChanged:function(t){this.propsModel.set({currentPage:t})},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return v.prototype.destroy.apply(this,e)}}),kt=i("D12m"),St=i("YNoo"),xt=i.n(St),Ct=i("RX7I"),Ot=v.extend({DO_NOT_WAIT_FOR_PRELOAD:!0,antialiasRotation:!0,mailchimpMatcher:/__rm_mailchimp_(.+)/i,anchorRegexp:/__rm_anchor/i,shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,render:function(){Object(m.a)("viewer.textOverflow")?this.makeBox("text text-overflow-disabled"):this.makeBox("text"),this.hasHoverAnimation&&this.$el.addClass("has-onhover-animation"),this.rendered=!0,this.bg_color=null==this.bg_color?"ffffff":this.bg_color,this.bg_opacity=null==this.bg_opacity?0:this.bg_opacity,this.column_count=null==this.column_count?1:this.column_count,this.column_gap=null==this.column_gap?16:this.column_gap;var t=[parseInt(this.bg_color.substring(0,2),16),parseInt(this.bg_color.substring(2,4),16),parseInt(this.bg_color.substring(4,6),16)];this.bg_opacity>.99?this.bg="rgb("+t[0]+","+t[1]+","+t[2]+")":this.bg="rgba("+t[0]+","+t[1]+","+t[2]+", "+this.bg_opacity+")",this.text=this.switchTextToViewport(this.text,this.insideHotspot?"default":this.page.pageViewport);var e=this.mag.model.attributes&&this.mag.model.attributes.edit_params&&this.mag.model.attributes.edit_params.paragraph_styles||[],i=n.a.parseHTML(this.text);i=i.map((function(t){var i=Object(n.a)(t),o=i.attr("class");if(o){var a=e.find((function(t){return t._name.toLowerCase()===o.toLowerCase()}));if(a&&a.tag&&"p"!==a.tag&&U.a.AVAILABLE_TEXT_TAGS.includes(a.tag))return Object(n.a)("<"+a.tag+' class="'+o+'" style="'+(i.attr("style")||"")+'" />').append(i.contents())[0].outerHTML}return t.outerHTML})).filter((function(t){return t})),this.text=i.join(""),this.isNotChrome=!(Modernizr.webkit&&!Modernizr.safari&&!Modernizr.safari5)&&this.text.includes("justify");var o=xt.a["template-viewer-widget-text"],a=Object(n.a)(o(this));this.seamlessFontsShow(function(){this.$el.removeClass("fonts-pending")}.bind(this),function(){this.$el.addClass("fonts-pending")}.bind(this)),d.a.isAllowed()&&d.a.isZoom()&&this.transformInsteadOfZoom(a),this.$el.append(a),this.$content=a,this.$el.on(w.a.isDesktop?"mouseenter":"touchstart","a",this.onLinkMouseEnter),this.$el.on(w.a.isDesktop?"mouseleave":"touchend","a",this.onLinkMouseLeave),this.$el.on("click","a",this.onLinkClick),a.addClass("v"+(this.version||1));var r=this;return this.$el.find("a").each((function(){var t=Object(n.a)(this),e=t.attr("data-pid"),i=t.attr("href"),o=decodeURIComponent(i),a=/^back\sto\stop$/i,l=e,c=!1;(a.test(i)||a.test(o))&&(l=r.page._id);var d=i&&r.page.mag.matchSameDomainLink(i);if((d==t.attr("href")||l)&&(d=void 0),l=l||d){var h=r.page.mag.getPageNum(l),u=h&&r.page.mag.getPageUri?"/"+r.page.mag.getPageUri(l):"javascript:void(0)";h?t.attr("href",u).addClass("maglink").attr("target",""):t.removeAttr("href"),l==r.page._id&&(t.addClass("back-to-top"),e&&(r.is_global||r.hasGlobalParent)&&t.addClass("current"))}else if(/^__rm_goback$/i.test(t.attr("href")))t.attr("href","javascript:void(0)").addClass("goback-link");else if(r.mailchimpMatcher.test(t.attr("href"))){var p=t.attr("href").match(r.mailchimpMatcher)[1];t.attr("href","javascript:void(0)").attr("data-mailchimp",p).addClass("mailchimp-link"),V.a.initMailchimpAPI()}else if(r.shareRegexp.test(t.attr("href"))){var g=t.attr("href").match(r.shareRegexp);t.attr("href","javascript:void(0)").attr("data-share-provider",g[1]).attr("data-share-type",g[2]).addClass("share-link")}else if(r.anchorRegexp.test(t.attr("href"))){t.attr("href","javascript:void(0)").addClass("anchor-link");var m=t.attr("data-page-uri"),f=s.a.findWhere(r.mag.pages,{_id:m})||r.page;t.attr("data-page-uri",f.uri||f.num)}else c=!0,t.addClass("external-link");!t.attr("href")||0!=t.attr("href").indexOf("mailto")&&0!=t.attr("href").indexOf("tel")||t.attr("target",""),!c&&RM.screenshot&&t.removeAttr("href")})),RM.screenshot&&!this.insideHotspot?this.waitForUsedFontsLoad():this.widgetIsLoaded(),this.$el.find("span.soundcite").each((function(t,e){RM.screenshot||Ct.a.createPlayer(e)})),d.a.isAllowed()&&d.a.isZoom()&&this.listenTo(this.page,"resize",this.onScaleChange),this},onScaleChange:function(){this.transformInsteadOfZoom(this.$content)},transformInsteadOfZoom:function(t){var e=this.page.scale;d.a.normalize(e,"zoom")>=1&&t.css({zoom:1/e,transform:"scale(".concat(e,")"),width:"".concat(1/e*100,"%"),height:"".concat(1/e*100,"%"),"transform-origin":"left top"})},isValid:function(){var t=Object(n.a)("<div>").html(this.text).text();return""!=n.a.trim(t)},hasFontsToLoad:function(){return!0},start:function(){return this.started=!0,Modernizr.chrome&&this.$el.addClass("force-repaint-content"),this},stop:function(){return this.started=!1,this.$el.removeClass("force-repaint-content"),RM.screenshot||this.destroyed||!this.rendered||this.$el&&this.$el.find("span.soundcite").each((function(t,e){Ct.a.pausePlayer(e)})),this},destroy:function(){return this.$el&&this.$el.find("span.soundcite").each((function(t,e){Ct.a.destroyPlayer(e)})),v.prototype.destroy.apply(this,arguments)},waitForUsedFontsLoad:function(){this.hasFontsToLoad()?this.page.addFontsToLoad(this,this.widgetIsLoaded):this.widgetIsLoaded()},checkLink:function(){if(this.is_global||this.hasGlobalParent){var t=this.$el.find("a[data-pid]");t.removeClass("current back-to-top"),this.page&&t.filter('[data-pid="'+this.page._id+'"]').addClass("current back-to-top").removeClass("hovered")}v.prototype.checkLink.apply(this,arguments)},onLinkMouseEnter:function(t){var e=Object(n.a)(t.currentTarget).attr("data-uuid");this.$el.find("a[data-uuid='"+e+"']").addClass("hovered")},onLinkMouseLeave:function(t){var e=Object(n.a)(t.currentTarget).attr("data-uuid");this.$el.find("a[data-uuid='"+e+"']").removeClass("hovered")},onLinkClick:function(t){if(2!=t.which&&!t.metaKey&&!t.ctrlKey){var e=Object(n.a)(t.currentTarget),i=n.a.trim(e.attr("href")).match(/\/start\-with\-template\/(\d+)$/i),o=i&&i[1];o&&RM.viewerRouter&&RM.viewerRouter.createMagFromTemplate&&(t.preventDefault(),RM.viewerRouter.createMagFromTemplate("template-link",o))}}}).extend(kt.a.prototype),Pt=i("5ta/"),jt=i("Vc8N"),$t=i.n(jt),Tt=v.extend({CONTENT_WAIT_TICK:100,CONTENT_WAIT_MAX_TICKS:20,CONTENT_IMG_WAIT:1e3,DO_NOT_WAIT_FOR_PRELOAD:!0,render:function(){var t,e;return this.makeBox("widget-twitter"),this.rendered=!0,this.current_type?("mag"===(e=this[this.current_type]).use_own_url?e.url=this.page.mag.getUrl():"page"!==e.use_own_url&&e.url||(e.url=this.page.getUrl()),RM.screenshot||(e.text=Pt.getFinalShare(this.page,s.a.extend(this.page.mag.model.toJSON(),{user:this.page.mag.user}),{forProject:"mag"===e.use_own_url,customDomain:RM.common.isDomainViewer}).tweet),t=$t.a["template-constructor-block-twitter-"+this.current_type],this.$el.html(t(e)),"type_timeline"===this.current_type&&this.$el.find("a").attr({width:this.w,height:this.h}),V.a.initTwitterAPI(function(){this.destroyed||(window.twttr&&window.twttr.widgets&&s.a.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load(),Object(s.a)(["type_timeline","type_embed"]).contains(this.current_type)?this.waitForTwitterContent():this.widgetIsLoaded())}.bind(this)),this):(this.widgetIsLoaded(),this)},waitForTwitterContent:function(){var t,e,i,n=0,o=!1,a={type_timeline:".timeline-Widget",type_embed:"blockquote.tweet"};clearInterval(t),t=setInterval(s.a.bind((function(){n++,this.destroyed?clearInterval(t):(1==(e=this.$el.find("iframe")).length&&(i=a[this.current_type],o=e.contents().find(i).length>0),(o||n>this.CONTENT_WAIT_MAX_TICKS)&&("type_embed"==this.current_type&&e.css({margin:0,"max-width":"100%"}),"type_timeline"==this.current_type&&(console.log("$frame : ",e),e.css({width:"100%",height:"100%!important","max-width":"100%"})),clearInterval(t),setTimeout(s.a.bind((function(){this.widgetIsLoaded()}),this),this.CONTENT_IMG_WAIT)))}),this),this.CONTENT_WAIT_TICK)}}),It=i("i8i4"),Et=i.n(It),Mt=i("LazK"),Rt=v.extend({ignoreScale:!0,render:function(){this.makeBox("widget-rm-header"),this.$header=Object(n.a)("<div>").appendTo(this.$el).get(0);var t=new a.a.Model({activeLink:this.activeLink});return Object(ft.renderReact)({component:Mt.a,domElement:this.$header,model:t}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return Et.a.unmountComponentAtNode(this.$header),v.prototype.destroy.apply(this,arguments)}}),At=i("1cLU");function Dt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function zt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Lt=v.extend({ignoreScale:!0,render:function(){return this.makeBox("widget-rm-footer"),Object(n.a)(".widget-rm-footer").css({background:"rgb(40, 40, 40)"}),this.propsModel=new Backbone.Model(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(i),!0).forEach((function(e){zt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Dt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({isMobileViewport:!1},this.getStyles())),this.$footer=Object(n.a)("<div>").appendTo(this.$el).get(0),Object(ft.renderReact)({component:At.a,domElement:this.$footer,model:this.propsModel}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return Et.a.unmountComponentAtNode(this.$footer),v.prototype.destroy.apply(this,arguments)},getStyles:function(){if(d.a.isAllowed()&&!(Object(n.a)(window).width()<1024)){var t=1/d.a.getRatio(),e=d.a.isZoom(),i=d.a.isTransform();return{zoom:e?"".concat(t):null,transform:i?"scale(".concat(t,")"):null}}},onPageResize:function(){v.prototype.onPageResize.apply(this,arguments),this.propsModel.set(this.getStyles())}}),Bt=i("Kw5r"),Ft=i("4rJ8"),Nt=v.extend({ignoreScale:!0,render:function(){this.makeBox("widget-rm-cookies");var t=Bt.default.extend(Ft.a);return this.vue=new t({el:Object(n.a)("<div>").appendTo(this.$el).get(0)}),this.rendered=!0,this.widgetIsLoaded(),this},destroy:function(){return this.vue&&this.vue.$destroy(),v.prototype.destroy.apply(this,arguments)}}),Ut=i("3TY3"),Ht=i("fEUr");function Vt(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Wt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Wt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function Wt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Gt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function qt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Gt(Object(i),!0).forEach((function(e){Kt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Gt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Kt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Xt(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Yt(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){Xt(a,n,o,s,r,"next",t)}function r(t){Xt(a,n,o,s,r,"throw",t)}s(void 0)}))}}var Zt,Jt,Qt=v.extend({triggerWidgets:[],render:function(){var t=Yt(regeneratorRuntime.mark((function t(){var e,n,o,s,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.basePath&&this.numberOfImages){t.next=2;break}return t.abrupt("return");case 2:return this.makeBox("widget-shots"),t.next=5,Promise.resolve().then(i.bind(null,"8AXF"));case 5:return e=t.sent,n=e.renderReact,t.next=9,Promise.resolve().then(i.bind(null,"3TY3"));case 9:return o=t.sent,s=o.Shots,this.stateModel=new a.a.Model(this.getCurrentState()),n({component:function(){return mt.a.createElement(ft.CreateContextProvider,{context:Ut.ShotsStateContext,model:r.stateModel},mt.a.createElement(s,{mode:window.RM.screenshot?"screenshoter":"viewer",onFirstRender:r.onFirstRender,onFirstFrameLoaded:r.widgetIsLoaded}))},domElement:this.el,model:this.model}),t.abrupt("return",this);case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),getCurrentState:function(){return{pageScale:this.page.scale,pageContentTop:this.page.contentPosition.top,magContainerHeight:this.page.mag.getContainerSizeCached().height,widgetBoxTop:this.calcBoxStyle({calcBBox:!0}).dimensions.top}},getViewerType:function(){return this.page.mag&&this.page.mag.viewOpts&&this.page.mag.viewOpts.viewertype||"vertical"},onFirstRender:function(){var t;(this.rendered=!0,this._scheduleStart&&this.start(),this.playbackType===Ht.b.scroll)&&(t=this.isAbove()&&"vertical"===this.getViewerType()?this.page.mag.getScroll():this.page.getScroll(),this.handleScroll(t))},handleScroll:function(t){this.rendered&&this.stateModel.set(qt(qt({},this.getCurrentState()),{},{currentScrollOffset:t}))},handlePointerMovement:function(t){if(this.rendered){"touches"in t&&"horizontal"===this.getViewerType()&&this.hoverDirection===Ht.a.horizontally&&t.stopPropagation();var e="touches"in t?t.touches[0].clientX:t.clientX,i="touches"in t?t.touches[0].clientY:t.clientY,n=t.target;if(n){var o=n.getBoundingClientRect(),a=e/this.page.scale-o.left,s=i/this.page.scale-o.top;this.hoverDirection===Ht.a.horizontally?this.stateModel.set({hoverPercent:a/o.width}):this.hoverDirection===Ht.a.vertically&&this.stateModel.set({hoverPercent:s/o.height})}}},getTriggerWidgets:(Jt=Yt(regeneratorRuntime.mark((function t(){var e,i,n,o,a=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=[],i=Vt(this.triggers),t.prev=2,o=regeneratorRuntime.mark((function t(){var i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.value,o=void 0,t.prev=2,t.next=5,a.page.mag.getWidgetById(i,a.page);case 5:o=t.sent,t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return","continue");case 11:if(o){t.next=13;break}return t.abrupt("return","continue");case 13:if(!o.rendered){t.next=17;break}e.push(o),t.next=20;break;case 17:return t.next=19,new Promise((function(t){return a.listenToOnce(o,"rendered",t)}));case 19:e.push(o);case 20:case"end":return t.stop()}}),t,null,[[2,8]])})),i.s();case 5:if((n=i.n()).done){t.next=12;break}return t.delegateYield(o(),"t0",7);case 7:if("continue"!==t.t0){t.next=10;break}return t.abrupt("continue",10);case 10:t.next=5;break;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(2),i.e(t.t1);case 17:return t.prev=17,i.f(),t.finish(17);case 20:return e.length||e.push(this),t.abrupt("return",e);case 22:case"end":return t.stop()}}),t,this,[[2,14,17,20]])}))),function(){return Jt.apply(this,arguments)}),bindTriggers:(Zt=Yt(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTriggerWidgets();case 2:this.triggerWidgets=t.sent,this.triggerWidgets.forEach((function(t){t.el instanceof HTMLElement&&(t.el.addEventListener("mousemove",e.handlePointerMovement),t.el.addEventListener("touchmove",e.handlePointerMovement))}));case 4:case"end":return t.stop()}}),t,this)}))),function(){return Zt.apply(this,arguments)}),unbindTriggers:function(){var t=this;this.triggerWidgets.forEach((function(e){e.el instanceof HTMLElement&&(e.el.removeEventListener("mousemove",t.handlePointerMovement),e.el.removeEventListener("touchmove",t.handlePointerMovement))}))},start:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];v.prototype.start.apply(this,i),this.rendered?(this.playbackType===Ht.b.scroll?this.isAbove()&&"vertical"===this.getViewerType()?this.listenTo(this.page.mag,"mag scroll",this.handleScroll):this.listenTo(this.page,"page scroll",this.handleScroll):this.playbackType===Ht.b.hover&&this.bindTriggers(),setTimeout((function(){t.stateModel.set({isStarted:!0})}),1)):this._scheduleStart=!0},stop:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];v.prototype.stop.apply(this,e),this.rendered&&(this.stopListening(),this.unbindTriggers(),this.stateModel.set({isStarted:!1}))},destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];v.prototype.destroy.apply(this,e)}}),te=e.a={addtocart:_,audio:k,background:R,button:B,ecommercecart:H,facebook:q,form:J,picture:it,gmaps:nt,hotspot:lt,iframe:dt,shape:ht,slideshow:pt,text:function(t,e,i){switch(t.version){case 3:return new wt(t,e,i);default:return new Ot(t,e,i)}},twitter:Tt,video:M,rmheader:Rt,rmfooter:Lt,rmcookies:Nt,shots:Qt}},gm8A:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("HuYI"),c=i.n(l),d=i("QNiq"),h=i("tZHv"),u=i("Kf/z");function p(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return g(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,r=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return s=t.done,t},e:function(t){r=!0,a=t},f:function(){try{s||null==i.return||i.return()}finally{if(r)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var m=a.a.View.extend({MIN_FIELD_WIDTH:50,MIN_FIELD_HEIGHT:30,LINE_HEIGHT_FACTOR:1.2,INVALID_COLOR:"ff4828",INVALID_BORDER_WIDTH:2,DROPDOWN_TRIANGLE:{SVG:'<svg class="form-dropdown-triangle" width="9" height="6" preserveAspectRatio="none" viewBox="0 0 9 6" xmlns="http://www.w3.org/2000/svg"><path d="M3.763 5.196L.536 1.676A1 1 0 0 1 1.273 0h6.454a1 1 0 0 1 .737 1.676l-3.227 3.52a1 1 0 0 1-1.474 0z" fill-rule="evenodd"/></svg>',OPACITY_MULTIPLIER:.4,W:9,H:6,FONT_SIZE:18},CHECKBOX_TICK:{SVG:'<svg width="19" height="14" preserveAspectRatio="none" viewBox="0 0 19 14" xmlns="http://www.w3.org/2000/svg"><path d="M6.657 10.9L17.263.292a1 1 0 1 1 1.415 1.414L7.364 13.021a.997.997 0 0 1-1.414 0L.293 7.364A1 1 0 1 1 1.707 5.95l4.95 4.95z" fill-rule="evenodd"/></svg>',W:19,H:14,FONT_SIZE:18},initialize:function(t){s.a.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.buttonTemplate=c.a["template-common-form-button"]},render:function(t){t=t||{},this.rendered?t.force&&this.$el&&this.$el.empty():(this.setElement(Object(n.a)("<div>")),this.$el.addClass("form-wrapper").appendTo(this.$container),"constructor"!==this.environment&&this.$el.on(d.a.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).on(d.a.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut),this.$el.on("change","select",this.onDropdownChange).on("mouseenter",".input-wrapper",this.onInputHover).on("mouseleave",".input-wrapper",this.onInputHoverOut),this.rendered=!0);for(var e,i,o=this.data,a=o.fields,s=Object(n.a)("<div>"),r=0;r<a.length;r++){var l=a[r];if("file"!==l.tp||Object(u.a)("constructor.formsAddFile")){e="vertical"===o.layout&&"text"===l.tp,(i=Object(n.a)(e?"<textarea>":"<input>")).addClass("js-input"),i.attr("type","text").attr("autocapitalize","name"===l.tp?"on":"off").attr("autocomplete","off").attr("autocorrect","off").attr("name",l.caption).attr("placeholder",l.caption+(l.optional&&"viewer"!==this.environment?" (optional)":"")).attr("spellcheck",!1).attr("data-sort",l.sort),"email"===l.tp&&i.attr("inputmode","email"),"phone"===l.tp&&i.attr("inputmode","tel"),"number"===l.tp&&i.attr("inputmode","numeric"),"checkbox"===l.tp&&i.attr("type","checkbox"),"dropdown"===l.tp&&(i.attr({tabindex:-1}),i.prop({readonly:!0}),i.addClass("fake-dropdown"));var c=Object(n.a)('<div class="input-wrapper js-input-wrapper"/>');if(c.append(i),c.append('<div class="overlay"></div>'),"viewer"!==this.environment&&e){var h=Object(n.a)('<span class="input-line-control input-line-control-add js-add-line"></span>'),p=Object(n.a)('<span class="input-line-control input-line-control-remove js-remove-line"></span>');c.append(h).append(p)}if("file"===l.tp){"viewer"===this.environment&&i.attr("type","file");var g="formfiles-".concat(this.data._id).concat("viewer"!==this.environment?"-constructor":"");i.attr("name","formfiles"),i.attr("id",g),i.attr("multiple",""),i.addClass("input-file");var m=l.caption+(l.optional&&"viewer"!==this.environment?" (optional)":"")||"Add files";c.append(Object(n.a)('<label for="'.concat(g,'" class="input-file-label').concat("viewer"!==this.environment?" no-hover":"",'" data-empty-text="').concat(m,'">').concat(m,"</label>"))),"viewer"===this.environment&&c.append(Object(n.a)('<span class="input-file-control input-file-control-add"></span><span class="input-file-control input-file-control-remove"></span>'))}if(c.appendTo(s),"dropdown"===l.tp&&l.items){var f=Object(n.a)("<select>"),v=Object(n.a)(this.DROPDOWN_TRIANGLE.SVG);f.attr("name",l.caption),Object(n.a)('<option value="" selected></option>').prop("disabled",!l.optional).appendTo(f);for(var b=0;b<l.items.length;b++)Object(n.a)("<option>").attr("value",l.items[b]).text(l.items[b]).appendTo(f);i.parent().append(v).append(f)}if("checkbox"===l.tp){var _=d.a.isDesktop?"":"input-checkbox-wrapper-mobile";i.wrap('<label class="input-checkbox-wrapper '+_+'"></label>'),i.after('\t\t\t\t\t\t<div class="input-checkbox-inner"> \t\t\t\t\t\t\t<span class="label">'+i.attr("placeholder")+'</span> \t\t\t\t\t\t\t<span class="tick">'+this.CHECKBOX_TICK.SVG+"</span> \t\t\t\t\t\t</div>")}}}Object(n.a)(this.buttonTemplate()).appendTo(s),this.$el.html(s.html()).addClass("common-form"),this.$button=this.$(".button"),this.$buttonIcons=this.$(".button svg"),this.$inputs=this.$(".input-wrapper"),this.$triangles=this.$(".form-dropdown-triangle"),this.$fileInputLabel=this.$inputs.find(".input-file-label"),"viewer"===this.environment&&(this.$fileInput=this.$inputs.find(".input-file"),this.$fileInput&&this.$fileInput.on("change",this.onFileChange),this.$fileAddCtrl=this.$(".input-file-control-add"),this.$fileRemoveCtrl=this.$(".input-file-control-remove"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.on("click",this.onFileRemove)),this.recalcStyles()},validateFiles:function(t){if(!t||!t.length)return!0;if(t.length>h.a.UPLOAD_FORMS_FILES_LIMIT)return alert(h.a.MSG_UPLOAD_FORMS_FILES_ERROR),!1;var e,i=p(t);try{for(i.s();!(e=i.n()).done;){if(e.value.size>h.a.UPLOAD_FORMS_SIZE_LIMIT)return alert(h.a.MSG_UPLOAD_FORMS_SIZE_ERROR),!1}}catch(t){i.e(t)}finally{i.f()}return!0},onFileChange:function(){var t=this,e=this.$fileInput.get(0).files;if(!e||!e.length)return this.$fileRemoveCtrl&&this.$fileRemoveCtrl.hide(),this.$fileAddCtrl&&this.$fileAddCtrl.show(),this.$fileInputLabel.text(this.$fileInputLabel.data("emptyText")),void this.$fileInputLabel.removeClass("has-files");if(!this.validateFiles(e))return this.onFileRemove();this.$fileInputLabel.addClass("has-files"),this.$fileRemoveCtrl&&this.$fileRemoveCtrl.show(),this.$fileAddCtrl&&this.$fileAddCtrl.hide();var i=(e[0].name||"Filename").split("\\").join("/").split("/").pop();setTimeout((function(){if(e.length>1){var n=t.$fileInputLabel.get(0),o="".concat(i," + ").concat(e.length-1),a=o.length;for(t.$fileInputLabel.text(o);a>0&&n.scrollWidth>n.offsetWidth;)a--,o="".concat(i.substr(0,a),"… + ").concat(e.length-1),t.$fileInputLabel.text(o)}else t.$fileInputLabel.text(i)}),100)},onFileRemove:function(){this.$fileInput.val(""),this.onFileChange()},onDropdownChange:function(t){Object(n.a)(t.currentTarget).parent().find(".js-input").val(Object(n.a)(t.currentTarget).val())},setButtonHoverState:function(){this.forcePseudoState="hover",this.applyButtonStyle()},unsetButtonHoverState:function(){this.forcePseudoState=!1,this.applyButtonStyle()},recalcStyles:function(t){this.$el.attr("data-layout",this.data.layout).attr("data-style",this.data.style),this.$button.find(".caption").text(this.data["button-caption"]),this.resizeElements(t),this.applyInputsStyle(this.$inputs),this.applyButtonStyle(t)},getMinimalDimensions:function(){var t,e=this.data,i=e.fields,n=e["style-"+e.style+"-fields"],o=e["style-"+e.style+"-button-default"],a=this.getButtonValue.bind(this,o,n),s=o.gutter+i.length*n.gutter,r=n["underline-width"]||0,l=Math.max(Math.ceil(a("font-size")*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+r,c=Math.max(Math.ceil(n["font-size"]*this.LINE_HEIGHT_FACTOR),this.MIN_FIELD_HEIGHT)+r,d=Math.max(l,c);return"vertical"===e.layout&&(t={width:this.MIN_FIELD_WIDTH,height:s+this.getTotalInputsHeight(i,d)+d}),"horizontal"===e.layout&&(t={width:s+(i.length+1)*this.MIN_FIELD_WIDTH,height:d}),t},getTotalInputsHeight:function(t,e){return s.a.reduce(t,function(t,i){return"text"===i.tp?t+this.getExtraTextareaDimensions(i.rows,e).height:t+e}.bind(this),0)},getRowsCount:function(t){return s.a.reduce(t,(function(t,e){return t+("text"===e.tp&&e.rows||1)}),0)},getInputDimensions:function(t){var e,i,n=this.data,o=n.fields,a=o.length+1,s=n["style-"+n.style+"-button-default"],r=n["style-"+n.style+"-fields"],l=s.gutter+o.length*r.gutter,c=t&&void 0!==t.w?t.w:n.w,d=t&&void 0!==t.h?t.h:n.h,h="vertical"===n.layout,u=Math.floor(h?d:c),p=u-l;if(h){var g=this.getLineHeight(),m=p-this.getRowsCount(o)*g.input-g.input,f=Math.ceil(m/a);e=g.input+f,i=this.getTotalInputsHeight(o,e)+e+l-u}else i=(e=Math.ceil(p/a))*(o.length+1)+l-u;return{overflow:i,itemSize:e,itemOtherSize:h?c:d,gutter:r.gutter,lastGutter:s.gutter+r.gutter}},getLineHeight:function(){var t=this.data||{},e=this.LINE_HEIGHT_FACTOR,i=this.getButtonValue(t["style-"+t.style+"-button-default"],t["style-"+t.style+"-fields"],"font-size"),n=t["style-"+t.style+"-fields"]["font-size"];return{input:Math.floor(e<10?e*n:e),button:Math.floor(e<10?e*i:e)}},getExtraTextareaDimensions:function(t,e){t=t||1;var i=this.getLineHeight(),n=Math.round(e-i.input),o=this.data&&"underlined"==this.data.style,a=o?n:Math.ceil(n/2),s=o?0:Math.floor(n/2);return{height:t*i.input+a+s,top:a,bottom:s}},resizeElements:function(t){var e=this.data,i="vertical"===e.layout,o=e.fields,a=o.length,s=this.getInputDimensions(t),r=s.overflow,l=e["style-"+e.style+"-fields"],c=(l&&l["underline-width"]||0)+2;this.$inputs.add(this.$button).each(function(t,e){var l={},d=s.itemSize,h=t===a-1,u=t<a,p=o[t],g=Object(n.a)(e),m=t>=a+1-r;if(m&&d--,l[i?"height":"width"]=d+"px",l[i?"width":"height"]=s.itemOtherSize+"px",u&&(l[i?"margin-bottom":"margin-right"]=h?s.lastGutter:s.gutter),l[i?"margin-right":"margin-bottom"]="",i&&p&&"text"===p.tp){var f=p.rows||1,v=g.find(".js-input"),b=g.find(".js-add-line"),_=g.find(".js-remove-line"),y=this.getExtraTextareaDimensions(f,s.itemSize);l.height=y.height+(m?-1:0)+"px",v.css({top:y.top-c,bottom:y.bottom}),v.attr({rows:f}),b.css({top:y.top-c}),_.css({bottom:y.bottom+c}),g.toggleClass("is-multiline",f>1)}g.css(l)}.bind(this))},showInputPlaceholdersAsValues:function(t){this.$inputs.each((function(e,i){var o=Object(n.a)(i).find(".js-input");"checkbox"===o.attr("type")?o.parent().find(".label").addClass("input-checkbox-preview"):o.val(t?o.attr("placeholder"):"")}))},applyInputsStyle:function(t,e){var i=this;e=e||{};var o,a=this.data,r=(a.fields,s.a.clone(a["style-"+a.style+"-fields"]));"underlined"===a.style?(e.invalid&&(r["underline-color"]=this.INVALID_COLOR,r["underline-opacity"]=100,r["underline-width"]=r["underline-width"]||this.INVALID_BORDER_WIDTH),o={"background-color":"transparent","border-radius":0,"box-shadow":"inset 0 "+-r["underline-width"]+"px 0 0 "+this.getRgba(r["underline-color"],r["underline-opacity"])}):(e.invalid&&(r["border-color"]=this.INVALID_COLOR,r["border-opacity"]=100,r["border-width"]=r["border-width"]||this.INVALID_BORDER_WIDTH),o={"background-color":this.getRgba(r.color,r.opacity),"border-radius":r["border-radius"]+"px","box-shadow":"inset 0 0 0 "+r["border-width"]+"px "+this.getRgba(r["border-color"],r["border-opacity"])});var l={"font-family":r["font-family"],"font-style":r["font-style"],"font-weight":r["font-weight"],color:this.getRgba(r["text-color"],r["text-opacity"]),"font-size":r["font-size"],"letter-spacing":r["letter-spacing"],"margin-bottom":r["underline-width"]?r["underline-width"]+"px":0};t.css(o).find(".js-input, select").css(l),t.find(".input-checkbox-inner .label").css(l),t.find(".input-file-label").css(l),t.find(".js-add-line, .js-remove-line").css({"font-size":r["font-size"]}),t.find(".form-dropdown-triangle").each(function(t,e){var i=Object(n.a)(e),o=i.parent(),a=o.find(".js-input"),s=a.position().top,l=o.height()-a.height()-s,c=this.getSvgSizesFromFontSize(r["font-size"],"DROPDOWN_TRIANGLE");i.css({fill:this.getRgba(r["text-color"],r["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER),top:s,bottom:l,width:c.w,height:c.h})}.bind(this)),t.find(".input-checkbox-inner svg").each((function(t,e){var o=Object(n.a)(e),a=i.getSvgSizesFromFontSize(r["font-size"],"CHECKBOX_TICK");o.css({fill:i.getRgba(r["text-color"],r["text-opacity"]),width:a.w,height:a.h})}))},applyButtonStyle:function(){var t=this.data,e=(t.fields,t["style-"+t.style+"-fields"]),i=t["style-"+t.style+"-button-default"],n=t["style-"+t.style+"-button-hover"],o=this.getButtonValue.bind(this,i,e),a=this.getHoverValue.bind(this,n,i,e),s=o("letter-spacing");this.$button.css({"line-height":this.$button.height()+"px","background-color":this.getRgba(o("color"),o("opacity")),"border-radius":o("border-radius")+"px","box-shadow":"inset 0 0 0 "+o("border-width")+"px "+this.getRgba(o("border-color"),o("border-opacity")),"font-family":o("font-family"),"font-style":o("font-style"),"font-weight":o("font-weight"),color:this.getRgba(o("text-color"),o("text-opacity")),"font-size":o("font-size"),"letter-spacing":s,"text-align":o("text-align"),"text-indent":s/2||0}),this.$buttonIcons.css({fill:this.getRgba(o("text-color"),o("text-opacity"))}),this.$button.attr("data-default",this.$button.attr("style")),this.$button.css({"background-color":this.getRgba(a("color"),a("opacity")),"box-shadow":"inset 0 0 0 "+a("border-width")+"px "+this.getRgba(a("border-color"),a("border-opacity")),color:this.getRgba(a("text-color"),a("text-opacity"))}),this.$button.attr("data-hover",this.$button.attr("style")),this.forcePseudoState||this.$button.attr("style",this.$button.attr("data-default")),this.$button.outerHeight(),this.$button.toggleClass("with-transition",!!n.transition&&"viewer"==this.environment)},getRgba:function(t,e){var i=r.default.hex2rgb(t);return"rgba("+i[0]+", "+i[1]+","+i[2]+","+e/100+")"},getButtonValue:function(t,e,i){return"inherit"===t[i]?e[i]:t[i]},getHoverValue:function(t,e,i,n){return"inherit"===t[n]?this.getButtonValue(e,i,n):t[n]},onInputHover:function(t){var e=this.data,i=s.a.clone(e["style-"+e.style+"-fields"]);Object(n.a)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]))},onInputHoverOut:function(t){var e=this.data,i=s.a.clone(e["style-"+e.style+"-fields"]);Object(n.a)(t.currentTarget).find(".form-dropdown-triangle").css("fill",this.getRgba(i["text-color"],i["text-opacity"]*this.DROPDOWN_TRIANGLE.OPACITY_MULTIPLIER))},onButtonHover:function(t){this.$button.hasClass("submitted")||this.$button.attr("style",this.$button.attr("data-hover"))},onButtonHoverOut:function(t){this.$button.attr("style",this.$button.attr("data-default"))},destroy:function(){this.$fileInput&&this.$fileInput.off("change",this.onFileChange),this.$el.off(d.a.isDesktop?"mouseenter":"touchstart",".button",this.onButtonHover).off(d.a.isDesktop?"mouseleave":"touchend",".button",this.onButtonHoverOut).off("change","select",this.onDropdownChange),this.$el&&this.$el.remove()},getSvgSizesFromFontSize:function(t,e){var i=this[e].H,n=this[e].W,o=this[e].FONT_SIZE;return{h:t*i/o,w:t*n/o}}});e.a=m},gobI:function(t,e,i){"use strict";var n=i("avvt"),o=i("QNiq"),a=(i("v92f"),{getNormalizedBox:function(t){return a.isOn()&&a.isZoom()?a.getBox(t,a.getRatio()):t&&t.getBoundingClientRect()},getBox:function(t,e){e=e||1;var i=t?t.getBoundingClientRect():{};return{top:i.top*e,left:i.left*e,width:i.width*e,height:i.height*e,bottom:i.bottom*e,right:i.right*e}},getRatio:function(t,e){return e=e||this.getDefaultWidth(),(t=t||window.innerWidth)/e},getMaxWidth:function(){return this.getScaleWidth()||1/0},getDefaultWidth:function(){return n.a.prototype.getViewportSetting("width","default")},getMag:function(){return RM.viewerRouter&&RM.viewerRouter.mag||RM.constructorRouter&&RM.constructorRouter.preview&&RM.constructorRouter.preview.mag||RM.constructorRouter&&RM.constructorRouter.mag&&RM.constructorRouter.mag.attributes||{}},getViewport:function(){return this.getMag().viewport},getScaleWidth:function(){var t=this.getMag();return t.attributes?t.attributes.opts.scalewidth:t.opts.scalewidth},isScaleLayout:function(){var t=RM.constructorRouter&&RM.constructorRouter.mag&&RM.constructorRouter.mag.attributes.opts&&RM.constructorRouter.mag||RM.constructorRouter&&RM.constructorRouter.preview&&RM.constructorRouter.preview.mag.model||this.getMag();return t.attributes?t.attributes.opts.scalableviewer:t.opts.scalableviewer},isAllowed:function(){return a.isDesktopDefault()&&a.isScaleLayout()},isOn:function(t){return t=t||a.getRatio(),a.isAllowed()&&t>1},isZoom:function(){return!Modernizr.firefox},isTransform:function(){return Modernizr.firefox},isDesktopDefault:function(){return o.a.isDesktop&&"default"===a.getViewport()},normalize:function(t,e){if(Math.abs(t-1)<1e-6)return 1;if(a.isDesktopDefault()){var i=!e||"zoom"===e&&a.isZoom()||"transform"===e&&a.isTransform();return a.isAllowed()&&i?Math.max(1,t):1}return t}});e.a=a},hQZz:function(t,e,i){"use strict";i.r(e);var n=i("Kf/z"),o=i("rFsW"),a=i("5BZr"),s=i("Kx3/"),r=i.n(s),l=a.a.extend({name:"common_layer",className:"control common_layer",BASE_ZINDEX:100,initialize:function(t){this.template=r.a["template-constructor-control-common_layer"],this.initControl(t),this.blocks&&Array.isArray(this.blocks)&&(this.block=this.blocks[0],this.model=this.block.model),t.noInit||(this.selectedModels=o.a.pluck(this.blocks,"model"),this.fixBadZIndexes())},normalizeZIndexes:function(){var t=this.allModels,e=this.BASE_ZINDEX,i=!1;return Object(o.a)(t).chain().sortBy((function(t){return t.get("z")})).each((function(t){var n=t.get("z"),o=e++;t.set("z",o,{first:!0}),n!==o&&(i=!0)})).value(),i},fixBadZIndexes:o.a.debounce((function(){if(!Object(n.a)("constructor.zIndex")){this.allModels=Object(o.a)(this.master.workspace.blocks).chain().filter((function(t){return!t.outofbox})).pluck("model").map((function(t){return o.a.isNumber(t.get("z"))||t.set("z",this.BASE_ZINDEX),t}),this).value();var t=this.moveToFixLayers(1,{fixOnlyBad:!0}),e=this.moveToAboveAllLayers(),i=this.normalizeZIndexes();(t||i||e)&&this.save({silent:!0,skipHistory:!0})}}),10),moveToFixLayers:function(t,e){var i=!1,n=o.a.filter(this.allModels,(function(t){return!t.get("fixed_position")&&!t.get("hidden")&&!t.get("is_above")}));if(!o.a.isEmpty(n)){var a=o.a.min(n,(function(t){return t.get("z")})).get("z"),s=o.a.max(n,(function(t){return t.get("z")})).get("z"),r=0;o.a.filter(this.allModels,(function(t){return t.get("fixed_position")}));return o.a.chain(this.allModels).filter((function(e){return e.get("fixed_position")&&(t>0?e.get("z")>a:e.get("z")<s)})).sortBy((function(t){return t.get("z")})).each((function(n){if(!(e&&e.fixOnlyBad&&(n.get("z")<a||n.get("z")>s))){var o=t>0?1e4:-1e4;if(e&&e.fixOnlyBad){r++;var l=(t>0?s:a)+1e-4*r*(t>0?1:-1);n.set("z",l,{first:!0})}else n.set("z",o+n.get("z"),{first:!0});i=!0}})),i}},moveToAboveAllLayers:function(){var t=[],e=o.a.filter(this.allModels,(function(t){return!t.get("is_above")&&!t.get("hidden")}));o.a.filter(this.allModels,(function(t){return t.get("is_above")&&!t.get("hidden")}));if(!o.a.isEmpty(e)){var i=o.a.max(e,(function(t){return t.get("z")})).get("z");return o.a.chain(this.allModels).filter((function(t){return t.get("is_above")&&t.get("z")<i})).each((function(e){e.set("z",2e4+e.get("z"),{first:!0}),t.push(e)})),o.a.isEmpty(t)||o.a.chain(this.allModels).filter((function(e){return e.get("is_above")&&-1==t.indexOf(e)})).each((function(t){t.set("z",2e4+t.get("z"),{first:!0})})),!o.a.isEmpty(t)}},restrictions:function(t){return t.getSelectableBlocks().length>1},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-common_layer")}))},bindLogic:function(){this.$panel.on("click",".forward",this.forward),this.$panel.on("click",".backward",this.backward),this.$panel.on("click",".forward-all",this.forwardAll),this.$panel.on("click",".backward-all",this.backwardAll),RM.constructorRouter.bindGlobalKeyPress([{key:"[",handler:this.backward,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"]",handler:this.forward,optionKeys:Modernizr.mac?"meta":"ctrl"},{key:"[",handler:this.backwardAll,optionKeys:Modernizr.mac?["alt","meta"]:["alt","ctrl"]},{key:"]",handler:this.forwardAll,optionKeys:Modernizr.mac?["alt","meta"]:["alt","ctrl"]}])},unBindLogic:function(){this.$panel.off("click",".forward",this.forward),this.$panel.off("click",".backward",this.backward),this.$panel.off("click",".forward-all",this.forwardAll),this.$panel.off("click",".backward-all",this.backwardAll),RM.constructorRouter.unbindGlobalKeyPress("[",this.backward),RM.constructorRouter.unbindGlobalKeyPress("]",this.forward),RM.constructorRouter.unbindGlobalKeyPress("[",this.backwardAll),RM.constructorRouter.unbindGlobalKeyPress("]",this.forwardAll)},forward:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","bring forward"),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,1),this.save()):this._move(1)},backward:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","bring backward"),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,-1),this.save()):this._move(-1)},forwardAll:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","send to front"),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,999),this.save()):this._move(999,!0)},backwardAll:function(t){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","send to back"),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.moveWidget(this.master.workspace.page,this.selectedModels,-999),this.save()):this._move(-999,!0)},_getBlocks:function(){var t={},e={};return{groupLayers:e,blocks:Object(o.a)(this.master.workspace.blocks).chain().filter((function(t){return"background"!=t.model.get("type")})).sortBy((function(t){return t.model.get("z")})).reduce((function(e,i){var n=i.model.get("pack_id");return n?t[n]?t[n].push(i):(t[n]=[i],e.push(t[n])):e.push(i),e}),[]).reduce((function(t,i){for(var n=t[t.length-1],o=i;n instanceof Array;)n=n[n.length-1];for(;o instanceof Array;)o=o[o.length-1];return!n||!!n.model.get("is_above")==!!o.model.get("is_above")&&!!n.model.get("fixed_position")==!!o.model.get("fixed_position")?(n||(o.model.get("is_above")?e.above_all=t[t.length-1]:o.model.get("fixed_position")?e.regular?e.fixed_top=t[t.length-1]:e.fixed_bottom=t[t.length-1]:e.regular=t[t.length-1]),t[t.length-1].push(i)):(t.push([i]),o.model.get("is_above")?e.above_all=t[t.length-1]:o.model.get("fixed_position")?e.regular?e.fixed_top=t[t.length-1]:e.fixed_bottom=t[t.length-1]:e.regular=t[t.length-1]),t}),[[]]).value(),packs:t}},_getBlockGroup:function(t,e){if(-1!=t.indexOf(e))return t;var i=null;return o.a.each(t,(function(t){t instanceof Array&&(i=i||this._getBlockGroup(t,e))}),this),i},_recalcZindex:function(t){var e=o.a.flatten(t),i=100,n=[];return o.a.each(e,(function(t){t.model.get("z")!=i&&(t.model.set("z",i),n.push({_id:t.model.get("_id"),z:i})),i++})),n},_checkForMovedGroup:function(t,e){if(!t.model.get("pack_id"))return t;var i=this._getBlockGroup(e,t),n=!0;return o.a.each(i,(function(t){n=n&&t.selected})),n?i:t},_move:function(t,e){for(var i=this._getBlocks(),n=i.blocks,a=i.packs,s=[],r=o.a.chain(this.blocks.slice()).sortBy((function(t){return t.model.get("z")})).reduce((function(t,e,i){if(-1!==s.indexOf(e))return t;s.push(e);var n=e.model.get("pack_id");if(n){var r=!0;o.a.each(a[n],(function(t){r=r&&t.selected})),r?(t.push(a[n]),s=s.concat(a[n])):t.push(e)}else t.push(e);return t}),[]).value();r&&r.length;){var l=r[0],c=this._getBlockGroup(n,l),d=o.a.reduce(c,(function(t,e,i){return-1!=r.indexOf(e)&&c[i-1]&&-1!=r.indexOf(c[i-1])?t[t.length-1].push(e):-1!=r.indexOf(e)&&t.push([e]),t}),[[]]),h=o.a.find(d,(function(t){return-1!=t.indexOf(l)})),u=c.indexOf(h[0]);c.splice(u,h.length);var p=u+t;p<0&&(c==i.groupLayers.fixed_top?(i.groupLayers.fixed_bottom||(i.groupLayers.fixed_bottom=[],n.splice(0,0,i.groupLayers.fixed_bottom)),c=i.groupLayers.fixed_bottom,p=e?0:c.length):p=0),p>c.length&&(c==i.groupLayers.fixed_bottom?(i.groupLayers.fixed_top||(i.groupLayers.fixed_top=[],i.groupLayers.above_all?n.splice(n.length-1,0,i.groupLayers.fixed_top):n.push(i.groupLayers.fixed_top)),c=i.groupLayers.fixed_top,p=e?c.length:0):p=c.length),Array.prototype.splice.apply(c,[p,0].concat(h)),r=o.a.difference(r,h)}this.allModels=this._recalcZindex(n),this.save()},save:function(t){var e=(t=t||{}).success;t.success=o.a.bind((function(t){this._saving=!1,e&&e(t),this._saveOptions&&(this.save(this._saveOptions),this._saveOptions=null)}),this),this._saving?this._saveOptions=t:(t.skipInitial=!0,this._saving=!0,Object(n.a)("constructor.zIndex")?this.master.workspace.page.save(null,t):this.master.workspace.save_group(this.allModels,t))}}),c=i("j6/F"),d=i.n(c),h=a.a.extend({name:"common_align",className:"control common_align",initialize:function(t){this.template=d.a["template-constructor-control-common_align"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-common_align")}))},bindLogic:function(){this.$panel.on("click","div",this.storeFixed),this.$panel.on("click",".left",this.left),this.$panel.on("click",".top",this.top),this.$panel.on("click",".bottom",this.bottom),this.$panel.on("click",".right",this.right),this.$panel.on("click",".center",this.center),this.$panel.on("click",".middle",this.middle),this.$panel.on("click","div",this.restoreFixed)},storeFixed:function(){o.a.invoke(this.blocks,"storeFixedPosition")},restoreFixed:function(){o.a.invoke(this.blocks,"restoreFixedPosition"),this.master.workspace.save_group(o.a.pluck(this.blocks,"model"))},setParam:function(t,e){var i=o.a.map(this.blocks,(function(i){var n={_id:i.model.id};return n[t]=o.a.isFunction(e)?e(i):e,n}));this.master.workspace.set_group(i)},restrictions:function(t){var e=t.getSelectedBlocks().length>1,i=Object(o.a)(t.getSelectedBlocks()).chain().map((function(t){return t.model.get("fixed_position")})).compact().uniq().value().length<=1;return e&&i},getPacksDimensions:function(t){var e={},i=1===o.a.chain(t).map((function(t){return t.model.get("pack_id")})).uniq().value().length;return o.a.each(t,(function(t){var n=t.model.get("pack_id");if(n&&!i){e[n]=e[n]||{t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};var o=e[n],a=t.getBoxData({includeBoundingBox:!0});o.t=Math.min(o.t,a.bb_y),o.l=Math.min(o.l,a.bb_x),o.b=Math.max(o.b,a.bb_y+a.bb_h),o.r=Math.max(o.r,a.bb_x+a.bb_w)}})),o.a.each(e,(function(t){t.x=t.l,t.y=t.t,t.w=t.r-t.l,t.h=t.b-t.t,delete t.t,delete t.l,delete t.b,delete t.r})),e},top:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.min.apply(null,o.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?i.y:n.bb_y})));this.setParam("y",(function(t){var n=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return n?o.y+(i-n.y):i-(o.bb_y-o.y)}))},left:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.min.apply(null,o.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?i.x:n.bb_x})));this.setParam("x",(function(t){var n=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return n?o.x+(i-n.x):i-(o.bb_x-o.x)}))},right:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.max.apply(null,o.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?i.x+i.w:n.bb_x+n.bb_w})));this.setParam("x",(function(t){var n=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return n?o.x+(i-n.w-n.x):i-(o.bb_w-(o.bb_w-o.w)/2)}))},bottom:function(t){var e=this.getPacksDimensions(this.blocks),i=Math.max.apply(null,o.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?i.y+i.h:n.bb_y+n.bb_h})));this.setParam("y",(function(t){var n=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return n?o.y+(i-n.h-n.y):i-(o.bb_h-(o.bb_h-o.h)/2)}))},middle:function(t){var e=this.getPacksDimensions(this.blocks),i=o.a.map(this.blocks,(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?i.y+i.h/2:n.bb_y+n.bb_h/2})),n=i[Math.floor(i.length/2)];this.setParam("y",(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],o=t.getBoxData({includeBoundingBox:!0});return i?o.y+(n-i.h/2-i.y):n-o.h/2}))},center:function(t){var e=this.getPacksDimensions(this.blocks),i=0,n=0,a=o.a.map(this.blocks,(function(t,o){var a=t.model.get("pack_id")&&e[t.model.get("pack_id")],s=t.getBoxData({includeBoundingBox:!0}),r=a?a.w:s.bb_w;return(t.isFullWidth()||r>i)&&(i=r,n=o),a?a.x+a.w/2:s.bb_x+s.bb_w/2}))[n];this.setParam("x",(function(t){var i=t.model.get("pack_id")&&e[t.model.get("pack_id")],n=t.getBoxData({includeBoundingBox:!0});return i?n.x+(a-i.w/2-i.x):a-n.w/2}))}}),u=i("xi34"),p=i("q1z7"),g=i.n(p),m=a.a.extend({MIN_PANEL_HEIGHT:100,MAX_PANEL_HEIGHT:672,PANEL_MARGIN:20,SCROLL_GAP_START:16,SCROLL_GAP_END:16,render:function(){this.panelSizes={resizable:this.getControlParam("height")||this.MIN_PANEL_HEIGHT},a.a.prototype.render.apply(this,arguments),this.$el.addClass("control-resizable"),this.resizableScroll=Object(u.a)(this.$el.find(".resizable-scroll-wrapper")).RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:this.SCROLL_GAP_START,gap_end:this.SCROLL_GAP_END,onScroll:this.onPanelScroll}).data("scroll"),this.__scrollRecalc_debounced=o.a.debounce(o.a.bind((function(){this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")}),this),300),Object(u.a)(this.$(".resize-handle-top")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),Object(u.a)(this.$(".resize-handle-bottom")).RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),this.updatePanelHeight()},onResize:function(t){this.updatePanelHeight()},updatePanelHeight:function(t){if(!this.destroyed){if(t=t||this.panelSizes[this.fixedPanelSize?"fixed":"resizable"],!this.fixedPanelSize){var e=2*Math.ceil(this.MIN_PANEL_HEIGHT/2),i=2*Math.ceil(this.MAX_PANEL_HEIGHT/2),n=Object(u.a)(window).height()-2*this.PANEL_MARGIN,o=2*Math.ceil(n/2);t=Math.max(t,e),t=Math.min(t,i),t=Math.min(t,o)}if(this.$panel.height(t),this.panelSizes[this.fixedPanelSize?"fixed":"resizable"]=t,this.fixedPanelSize)this.$panel.css("top",-Math.ceil((t-this.master.ICON_HEIGHT)/2));else{var a=parseInt(this.$el.css("top"));this.$panel.css("top",-Math.ceil(t/2)-a)}this.fixedPanelSize||this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced()}},startHandleDrag:function(t){var e=Object(u.a)(t.currentTarget);this.resizeParams={$handle:e,dir:e.hasClass("resize-handle-top")?-1:1,initial_h:this.panelSizes.resizable},e.addClass("dragging"),this.$panel.addClass("no-transitions")},moveHandleDrag:function(t){var e=this.resizeParams.initial_h+t.deltaY*this.resizeParams.dir*2;this.updatePanelHeight(e),this.resizableScroll&&this.resizableScroll.recalc(),this.onScrollRecalc("control-resize")},endHandleDrag:function(t){this.resizeParams.$handle.removeClass("dragging"),this.$panel.removeClass("no-transitions")},toggleFixedPanelSize:function(t,e){this.fixedPanelSize=t,this.$(".resize-handle-top").toggle(!t),this.$(".resize-handle-bottom").toggle(!t),this.updatePanelHeight(t?e:this.panelSizes.resizable)},onScrollRecalc:function(t){},onPanelScroll:function(){},select:function(){a.a.prototype.select.apply(this,arguments),this.resizableScroll&&this.resizableScroll.recalc(),this.onScrollRecalc("control-show"),this.resizeScrollBinded||(Object(u.a)(window).on("resize",this.onResize),this.resizeScrollBinded=!0)},deselect:function(){a.a.prototype.deselect.apply(this,arguments),this.$panel&&(this.panelSizes.resizable!=this.getControlParam("height")&&this.saveControlParam({height:this.panelSizes.resizable}),Object(u.a)(window).off("resize",this.onResize),this.resizeScrollBinded=!1)},destroy:function(){this.panelSizes.resizable!=this.getControlParam("height")&&this.saveControlParam({height:this.panelSizes.resizable}),Object(u.a)(window).off("resize",this.onResize),this.resizeScrollBinded=!1,a.a.prototype.destroy.apply(this,arguments)}}),f=i("j0jp"),v=i.n(f),b=i("roQd"),_=i("onY4"),y=i("OTSC"),w=i("q7tt"),k=i("q5gH"),S=i("wHgl"),x=i.n(S),C=w.a.extend({controls:[],initialize:function(t){o.a.extend(this,t),this.uuid=t.uuid,this.isStandalone=!0,this.proportional=!0,this.resizeFromCenter=!0,this.addButtonTemplate=x.a["template-constructor-helpers-animation_steps_add_button"],this.frameClass=k.a.extend({minwidth:0,minheight:0}),this.initBlock(this.model,this.workspace)},render:function(){this.create(),this.$el.addClass("animation-step"),this.$mainContent=this.$(".content"),this.$addButton=Object(u.a)(this.addButtonTemplate()),this.$addButton.find('.effect-popup-item[data-value="use_rotate"]').toggle(!this.hideRotateEffect),this.$addButton.on("click",".effect-popup-item",this.addStepWithEffectClick),this.$el.append(this.$addButton),this.$mainContent.addClass("main-content")},addStepWithEffectClick:function(t){this.trigger("add-step",Object(u.a)(t.currentTarget).attr("data-value")),t.stopPropagation()},select:function(){w.a.prototype.select.apply(this,arguments),this.updateAddButtonPos()},setContent:function(t){this.$innerContent=t,this.$innerContent.addClass("fantoms"),this.$mainContent.html(this.$innerContent),this.redrawOpacity(),this.redrawScale()},show:function(){this.$el.show()},hide:function(){this.$el.hide()},onClick:function(){this.selected||this.select()},flashTransitions:function(){clearTimeout(this.flashTransitionsTimeout),this.$el.addClass("animation-transitions"),this.flashTransitionsTimeout=setTimeout(o.a.bind((function(){this.$el.removeClass("animation-transitions")}),this),200)},redrawOpacity:function(){this.$innerContent&&this.$innerContent.css({opacity:this.model.get("opacity")/100})},redrawScale:function(){this.$innerContent&&y.default.applyTransform(this.$innerContent,100==this.model.get("scale")?"":"scale("+this.model.get("scale")/100+")")},updateAddButtonPos:function(){if(this.selected&&this.$addButton){var t=RM.constructorRouter.zoom.getZoom(),e=o.a.extend({},this.latestPosSizeAngle,{width:this.latestPosSizeAngle.width*t,height:this.latestPosSizeAngle.height*t}),i=e.height+18,n=e.width/2,a=e.height/2,s=a-i,r=n+e.sinAngle*s;i=a-e.cosAngle*s,this.$addButton.css({left:Math.round(r),top:Math.round(i),zoom:1/RM.constructorRouter.zoom.getZoom()}),y.default.applyTransform(this.$addButton,"");var l=this.$addButton.offset(),c=l.top+15,d=l.left+15,h=0,p=0,g=Object(u.a)(window).height(),m=Object(u.a)(window).width();c<32?h=c-32:c>g-32&&(h=c-(g-32)),d<32?p=d-32:d>m-32&&(p=d-(m-32)),(h||p)&&y.default.applyTransform(this.$addButton,"translate("+Math.round(-p)+"px, "+Math.round(-h)+"px)")}},updateAddButtonPopupPos:function(){if(this.$addButton&&this.selected){var t=this.$addButton.offset(),e=t.top+15,i=t.left+15,n=Object(u.a)(window).height(),o=Object(u.a)(window).width(),a=this.$addButton.find(".effect-popup"),s=a.height(),r=a.width();a.css("margin-top","").find(".corner-wrapper").css("margin-top",""),i>12+r/2&&i<o-r/2?e>12+s+15+15?a.attr("data-pos","top"):a.attr("data-pos","bottom"):(i<o/2?a.attr("data-pos","right"):a.attr("data-pos","left"),e<s/2+12&&a.css("margin-top",s/2+12-e).find(".corner-wrapper").css("margin-top",-(s/2+12-e)),e>n-(s/2+12)&&a.css("margin-top",-(e-n+s/2+12)).find(".corner-wrapper").css("margin-top",e-n+s/2+12))}},css:function(){w.a.prototype.css.apply(this,arguments),this.updateAddButtonPos()},redraw:function(){this.$mainContent&&(this.redrawOpacity(),this.redrawScale(),w.a.prototype.redraw.apply(this,arguments))}}),O=g.a.View.extend({className:"animation-steps-container",StepModel:g.a.Model.extend({save:function(){return this.set.apply(this,arguments),null},sync:function(){return null},getViewport:function(){return self.blocks[0].model.getViewport()},getAnimations:function(){return[]}}),initialize:function(t){o.a.bindAll(this),o.a.extend(this,t),this.someModel=this.blocks[0].model,this.workspace.switchOnAnimationMode(this),this.$el.appendTo(this.workspace.$el.children().first()),this.$workspaceScroll=this.workspace.$el.parent(),Object(u.a)(this.$el).drag("start",(function(t){t.stopPropagation()})),this.$stepsLinesWrapper=Object(u.a)('<div class="steps-lines-wrapper">'),this.$el.append(this.$stepsLinesWrapper),this.$previewAnimator=Object(u.a)('<div class="preview-animator">'),this.$el.append(this.$previewAnimator),this.popupManager.addPopup({$parent:this.$el,name:"add-step-selector",selector:".block .add-button",popupSelector:".block .add-button .effect-popup",cbOpen:function(t){this.currentStep&&this.currentStep.updateAddButtonPopupPos(),o.a.each(this.blocks,(function(e){e.trigger("animation:stepsPopup:open",t)}))}.bind(this),cbClose:function(){o.a.each(this.blocks,(function(t){t.trigger("animation:stepsPopup:closed")}))}.bind(this)}),this.updateContainerDims(),this.updateFantoms(),this.updateSteps(),o.a.each(this.blocks,(function(t){t.toggleAnimationMode(!0)})),this.$previewAnimator.css({visibility:"hidden"}),this.isPreviewMode=!1,Object(u.a)(window).on("resize",this.onResize),this.$workspaceScroll.on("scroll",this.onWorkspaceScroll)},startPreviewMode:function(){this.isPreviewMode||(this.isPreviewMode=!0,this.$previewAnimator.css({visibility:"inherit"}),this.$stepsLinesWrapper.css({visibility:"hidden"}),this.updatePreviewMode({immediate:!0}))},updatePreviewMode:function(t){if(t=t||{},this.isPreviewMode){var e=this;clearTimeout(this.updatePreviewModeTimeout),t.immediate?i():this.updatePreviewModeTimeout=setTimeout(i,500)}function i(){e.previewTimeline&&e.previewTimeline.destroy();var t=b.a.getNormalizedAnimation(e.uuid?e.someModel.getAnimations().find((function(t){return t.UUID===e.uuid})):e.someModel.getAnimations()[0],e.isFixed,e.isFullwidth,e.isFullheight,RM.constructorRouter.zoom.getZoom());e.previewTimeline=b.a.createAnimationTimeline({el:e.$previewAnimator,steps:t.steps,type:t.type,force3d:!1,loop:b.a.normalizeLoopValue(t.loop),animationTrigger:t.trigger,screenshotMode:!1}),"scroll"!=t.type?e.previewTimeline.play():e.onWorkspaceScroll()}},stopPreviewMode:function(){this.isPreviewMode&&(this.isPreviewMode=!1,this.$previewAnimator.css({visibility:"hidden"}),this.$stepsLinesWrapper.css({visibility:"inherit"}),this.previewTimeline&&this.previewTimeline.destroy())},togglePreviewMode:function(){this.isPreviewMode?this.stopPreviewMode():this.startPreviewMode()},onWorkspaceScroll:function(){var t=this;if(this.currentStep&&this.currentStep.updateAddButtonPos(),this.previewTimeline&&this.isPreviewMode){var e=this.uuid?this.someModel.getAnimations().find((function(e){return e.UUID===t.uuid})):this.someModel.getAnimations()[0];if("scroll"===e.type&&e){var i=Math.max(0,this.$workspaceScroll.scrollTop()),n=RM.constructorRouter.zoom.getZoom();if(this.isFixed)this.previewTimeline.seek(i);else{var o=this.baseDimensions.top,a=o-this.$workspaceScroll.height()/n,s={top:1,center:.5,bottom:0}[e.steps[0].start_point||"bottom"]*(o-a)+a+e.steps[0].start_offset||0;s<=0?this.previewTimeline.seek(i/n):this.previewTimeline.seek(Math.max(0,i-s*n)/n)}}}},updateContainerDims:function(){var t;o.a.each(this.blocks,(function(e){var i=e.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});(t=t||{t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY}).t=Math.min(t.t,i.bb_y),t.l=Math.min(t.l,i.bb_x),t.b=Math.max(t.b,i.bb_y+i.bb_h),t.r=Math.max(t.r,i.bb_x+i.bb_w)}),this),this.baseDimensions={left:t.l+(this.isFixed?this.workspace.position.left:0),top:t.t+(this.isFixed?this.workspace.position.top:0),width:t.r-t.l,height:t.b-t.t},this.$el.css({width:t.r-t.l,height:t.b-t.t,position:this.isFixed?"fixed":"absolute"}),this.$previewAnimator.css(this.baseDimensions)},createStep:function(t){t=t||{};var e=new C({model:new this.StepModel,workspace:this.workspace,constraintHorzMove:this.isFullwidth,constraintVertMove:this.isFullheight,hideRotateEffect:this.isFullwidth||this.isFullheight,$standaloneContainer:this.$stepsLinesWrapper}),i=this;return e.on("select",(function(){if(i.currentStep=this,i.steps)for(var t=0;t<=i.steps.length;t++){var e=i.$lines&&i.$lines[t]&&i.$lines[t].find("line"),n=t==i.steps.length?i.initialStep:i.steps[t];this!=n?(n.deselect(),e&&e.attr("stroke-dasharray","4,2")):(i.isIndirectSelect||i.trigger("select","initial"==n.model.get("id")?0:n.model.get("id")),e&&e.removeAttr("stroke-dasharray"))}})),e.model.set({id:t.id,is_locked:"initial"==t.id}),e.render(),e.setContent(this.getFantom()),"initial"!=t.id&&e.on("move",o.a.bind((function(t){this.trigger("move",{id:e.model.get("id"),dx:Math.round(t.left-this.baseDimensions.left+(t.width-this.baseDimensions.width)/2),dy:Math.round(t.top-this.baseDimensions.top+(t.height-this.baseDimensions.height)/2)}),this.updateSteps({exceptStep:e})}),this)),e.on("resize",o.a.bind((function(i){"initial"==t.id?this.trigger("scale",{id:0,from_scale:Math.round(100*i.width/this.baseDimensions.width)}):this.trigger("scale",{id:e.model.get("id"),scale:Math.round(100*i.width/this.baseDimensions.width)}),e.model.set({scale:100*i.width/this.baseDimensions.width},{silent:!0}),e.redrawScale(),this.updateSteps({exceptStep:e})}),this)),e.on("add-step",o.a.bind((function(t){this.trigger("add-step",{after_step:e.model.get("id"),use_effect:t}),this.popupManager.closePopup("add-step-selector")}),this)),e},setStepModel:function(t,e){var i=this.baseDimensions,n=i.width*e.scale/100,o=i.height*e.scale/100;t.model.set({x:i.left+i.width/2+e.dx-n/2,y:i.top+i.height/2+e.dy-o/2,w:n,h:o,z:1,angle:e.rotate,opacity:e.opacity,scale:e.scale,aspect:i.width/i.height},{silent:!0}),t.redraw(t.model)},getFantom:function(t){var e=t?t.$el.clone():this.$fantoms.clone();if(t&&"picture"===t.model.get("type")&&t.model.get("picture")){var i=t.model.get("picture"),n=t.useLambdaUrl&&t.useLambdaUrl()?t.getLambdaUrl():i.unscaledOptimizedUrl||i.unscaledUrl||i.url;n&&e.find(".content div").css("background-image","url(".concat(n,")"))}var o=[];if(e.find("defs mask, defs clippath").each((function(){o.push(Object(u.a)(this).attr("id"))})),t&&"hotspot"===t.model.get("type")&&e.find(".tip").remove(),e.find(".size-tool").remove(),e.find(".animation-trigger-tooltip").remove(),o.length){for(var a=e[0].outerHTML,s=0;s<o.length;s++){var r=y.default.generateUUID(),l=new RegExp("("+y.default.escapeSpecial(o[s],!1)+")","g");a=a.replace(l,r)}e=Object(u.a)(a)}return e},updateFantoms:function(){this.$fantoms&&this.$fantoms.remove(),this.$fantoms=Object(u.a)("<div>").css({position:"relative",left:0,top:0,width:this.baseDimensions.width,height:this.baseDimensions.height}),o.a.each(this.blocks,o.a.bind((function(t){var e=this.getFantom(t);e.find(".frameborder").remove(),e.find(".animation-trigger-tooltip").remove(),e.removeClass("animation-mode"),this.isFixed?e.css({position:"absolute",left:"50%",top:"50%",bottom:"",right:"","margin-left":-t.model.get("w")/2,"margin-top":-t.model.get("h")/2}):e.css({left:"-="+this.baseDimensions.left,top:"-="+this.baseDimensions.top}),this.$fantoms.append(e)}),this)),this.$previewAnimator.html(this.getFantom())},updateSteps:function(t){var e=this;this.updateLines(),t=t||{};var i=b.a.getNormalizedAnimation(this.uuid?this.someModel.getAnimations().find((function(t){return t.UUID===e.uuid})):this.someModel.getAnimations()[0],this.isFixed,this.isFullwidth,this.isFullheight,1);this.initialStep=this.initialStep||this.createStep({id:"initial"}),0===t.animateStepInd&&this.initialStep.flashTransitions(),t.exceptStep!=this.initialStep&&this.setStepModel(this.initialStep,{dx:0,dy:0,opacity:i.steps[0].from_opacity,rotate:i.steps[0].from_rotate,scale:i.steps[0].from_scale}),this.steps=this.steps||[];for(var n=0;n<i.steps.length;n++)this.steps[n]=this.steps[n]||this.createStep({id:n}),null!=t.animateStepInd&&t.animateStepInd<=n&&this.steps[n].flashTransitions(),t.exceptStep!=this.steps[n]&&this.setStepModel(this.steps[n],i.steps[n]);for(n=i.steps.length;n<this.steps.length;n++)this.steps[n].model.destroy(),this.steps[n].destroy(),this.steps[n].off();this.steps.length=i.steps.length},updateLines:function(){var t=this,e=0,i=0;this.$lines=this.$lines||[];for(var n=b.a.getNormalizedAnimation(this.uuid?this.someModel.getAnimations().find((function(e){return e.UUID===t.uuid})):this.someModel.getAnimations()[0],this.isFixed,this.isFullwidth,this.isFullheight,1),o=0;o<n.steps.length;o++){this.$lines[o]||(this.$lines[o]=Object(u.a)('<svg class="step-line"><line /></svg>'),this.$lines[o].appendTo(this.$stepsLinesWrapper));var a=n.steps[o],s=this.$lines[o].find("line").get(0),r=this.baseDimensions.width/2+e,l=this.baseDimensions.height/2+i,c=this.baseDimensions.width/2+a.dx,d=this.baseDimensions.height/2+a.dy,h=Math.abs(r-c)+8,p=Math.abs(l-d)+8;this.$lines[o].css({width:h,height:p,left:this.baseDimensions.left+Math.min(r,c)-4,top:this.baseDimensions.top+Math.min(l,d)-4}),this.$lines[o].show(),s.setAttributeNS(null,"x1",4),s.setAttributeNS(null,"x2",h-4),r<c&&l<d||r>c&&l>d?(s.setAttributeNS(null,"y1",4),s.setAttributeNS(null,"y2",p-4)):(s.setAttributeNS(null,"y1",p-4),s.setAttributeNS(null,"y2",4)),e=a.dx,i=a.dy}for(o=n.steps.length;o<this.$lines.length;o++)this.$lines[o].hide()},selectStep:function(t){this.isIndirectSelect=!0,this.steps[t].select(),this.isIndirectSelect=!1},moveSelected:function(t,e){var i=o.a.filter(o.a.union(this.steps,this.initialStep),(function(t){return!t.isLocked()&&t.selected}));if(!o.a.isEmpty(i)&&!(this.isFullwidth&&Object(o.a)(["left","right"]).contains(e)||this.isFullheight&&Object(o.a)(["up","down"]).contains(e))){var n=t.shiftKey?10:1,a=RM.constructorRouter.gg.snap;RM.constructorRouter.gg.snap=!1;var s={deltaY:0,deltaX:0};switch(e){case"up":s.deltaY=-n;break;case"right":s.deltaX=n;break;case"down":s.deltaY=n;break;case"left":s.deltaX=-n}C.prototype.moveBlocks(null,i,s),RM.constructorRouter.gg.snap=a,t.stopPropagation(),t.preventDefault()}},removeSelected:function(){var t=o.a.filter(o.a.union(this.steps,this.initialStep),(function(t){return t.selected}));o.a.isEmpty(t)||this.trigger("remove-step",t[0].model.get("id"))},onResize:function(){(this.isFullwidth||this.isFullheight||this.isFixed||this.isSticked)&&(this.updateContainerDims(),this.updateSteps()),this.isFullwidth&&(clearTimeout(this.updateFantomsTimer),this.updateFantomsTimer=setTimeout(o.a.bind((function(){this.updateFantoms(),this.initialStep.setContent(this.getFantom());for(var t=0;t<this.steps.length;t++)this.steps[t].setContent(this.getFantom())}),this),100)),this.onWorkspaceScroll()},destroy:function(){if(this.stopPreviewMode(),o.a.each(this.blocks,(function(t){t.toggleAnimationMode(!1)})),this.$fantoms&&this.$fantoms.remove(),this.initialStep&&(this.initialStep.model.destroy(),this.initialStep.destroy(),this.initialStep.off()),this.steps)for(var t=0;t<this.steps.length;t++)this.steps[t].model.destroy(),this.steps[t].destroy(),this.steps[t].off();this.remove(),this.workspace.switchOffAnimationMode(),Object(u.a)(window).off("resize",this.onResize),this.$workspaceScroll.off("scroll",this.onWorkspaceScroll)}}),P=(i("QNiq"),i("SUqF"));function j(t){return function(t){if(Array.isArray(t))return $(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return $(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function T(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function I(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?T(Object(i),!0).forEach((function(e){E(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var M=m.extend({name:"common_animation",className:"control common_animation",MIN_PANEL_HEIGHT:560,MAX_PANEL_HEIGHT:640,DISABLED_HEIGHT:138,DISABLED_HEIGHT_RESET:138,MESSAGE_MIXED_HEIGHT:128,MESSAGE_MULTIPLE_HEIGHT:112,MESSAGE_NON_ANIMATABLE_HEIGHT:96,MESSAGE_UNITE_HEIGHT:160,DEFAULT_ANIMATION_STEP:{duration:.5,delay:0,speed:1,delay_px:0,dx:void 0,dy:void 0,opacity:void 0,rotate:void 0,scale:void 0,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!1},PRESETS:{"fade-and-scale":{loop:!1,selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"fade-in":{loop:!1,selected:0,steps:[{duration:1.6,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:80,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!1}]},"scale-big":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,opacity:100,scale:100,acceleration:"ease-out",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:256,use_move:!1,use_opacity:!0,use_rotate:!1,use_scale:!0}]},"move-and-fade":{loop:!1,selected:0,steps:[{duration:.8,delay:0,speed:1,delay_px:0,dx:0,dy:-32,opacity:100,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:0,from_rotate:0,from_scale:100,use_move:!0,use_opacity:!0,use_rotate:!1,use_scale:!1}]},pulse:{loop:"swing",selected:0,steps:[{duration:1.2,delay:0,speed:1,delay_px:0,dx:142,dy:0,scale:90,acceleration:"ease-both",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!1,use_scale:!0}]},rotate:{loop:"repeat",selected:0,steps:[{duration:1.8,delay:0,speed:1,delay_px:0,dx:0,dy:0,rotate:360,acceleration:"none",start_point:"bottom",start_offset:0,from_opacity:100,from_rotate:0,from_scale:100,use_move:!1,use_opacity:!1,use_rotate:!0,use_scale:!1}]}},TRIGGER_COUNT_LIMIT:3,events:{"click .js-trigger-button":"onTriggerButtonClick","click .js-cancel-trigger":"onTriggerCancelClick","click .js-remove-trigger":"onTriggerRemoveClick","mouseenter .js-trigger-name":"onTriggerNameMouseEnter","mouseleave .js-trigger-name":"onTriggerNameMouseLeave","mouseenter .js-remove-trigger":"onTriggerRemoveMouseEnter","mouseleave .js-remove-trigger":"onTriggerRemoveMouseLeave"},initialize:function(t){var e=this;this.typeSelectorTemplate=v.a["template-constructor-control-common_animation-type-popup"],this.template=function(t){return v.a["template-constructor-control-common_animation"](I(I({},t),{},{renderInitialTypePopup:function(){return e.typeSelectorTemplate({isInitial:!0,type:void 0,uuid:void 0,cssClass:"js-change-type-popup",currentType:void 0,availableTypes:b.a.EVENT_TYPES})},renderAddTypePopup:function(){return e.typeSelectorTemplate({isInitial:!1,cssClass:"js-add-animation-popup",type:void 0,uuid:void 0,currentType:void 0,availableTypes:b.a.EVENT_TYPES})}}))},this.step_template=v.a["template-constructor-control-common_animation-step"],this.typeTemplate=v.a["template-constructor-control-common_animation-type"],this.initControl(t),this.isPreviewMode=!1,this.isSwitcherVisible=!1,this.block=this.blocks&&this.blocks[0],this.someModel=this.models&&this.models[0],this.triggerButtonsState={},this.currentUuid=void 0,this.updateControlState()},bindLogic:function(){this.master.workspace.on("paste-animation",this.onAnimationPaste),this.$loop_types=this.$panel.find(".js-loop-types"),this.$loop_repeat=this.$panel.find(".js-loop-repeat"),this.$loop_swing=this.$panel.find(".js-loop-swing"),this.$playOnce=this.$panel.find(".js-play-once"),this.$preview_switcher=this.$panel.find(".bottom-block .preview"),this.$steps_container=this.$panel.find(".resizable-content"),this.$step_selector=this.$panel.find(".js-step-selector"),this.$step_selector.find(".js-prev-step").on("click",this.prevStepClick),this.$step_selector.find(".js-next-step").on("click",this.nextStepClick),this.$steps_container.on("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.on("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.on("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.on("click",".remove-effect",this.removeEffectClick),this.$steps_container.on("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.on("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.on("click",".unite-button",this.uniteClick),this.$loop_repeat.on("click",this.onLoopTypeClick),this.$loop_swing.on("click",this.onLoopTypeClick),this.$playOnce.on("click",this.onPlayOnceClick),this.$preview_switcher.on("click",this.togglePreviewMode),this.$panel.on("click",".js-type-popup-item",this.typeSelectorItemClick),this.$panel.on("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.$panel.on("click",".js-change-animation",this.onAnimationSelect),this.$panel.on("click",".js-remove-animation",this.onAnimationRemove),this.popupManager=new A,this.popupManager.addPopup({$parent:this.$panel,name:"type-selector",selector:".js-change-type",popupSelector:".js-change-type-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"add-animation",selector:".js-add-animation",popupSelector:".js-add-animation-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"steps",selector:".js-step-selector:not(.one-step)",popupSelector:".js-step-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"add-effect",selector:".bottom-block .add-effect",popupSelector:".bottom-block .effect-popup",cbOpen:this.updateEffectPopupState}),this.popupManager.addPopup({$parent:this.$panel,name:"start-selector",selector:".resizable-content .param-wrapper.start-block",popupSelector:".resizable-content .param-wrapper.start-block .start-popup"}),this.popupManager.addPopup({$parent:this.$panel,name:"acceleration-selector",selector:".resizable-content .param-wrapper.acceleration-block",popupSelector:".resizable-content .param-wrapper.acceleration-block .acceleration-popup",cbOpen:this.updateAccelerationPopupState}),RM.constructorRouter.bindGlobalKeyPress([{key:"a",handler:this.onClick}]),this.listenTo(this.someModel,"animation:trigger:add",this.onAnimationTriggerAdd),this.listenTo(this.someModel,"animation:trigger:remove",this.onAnimationTriggerRemove),this.$step_selector.find(".js-step-popup").sortable({items:".js-step-popup-item",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onStepsSortStart.bind(this),stop:this.onStepsSortEnd.bind(this)}),Object(u.a)("").add(this.$loop_swing).add(this.$loop_repeat).RMAltText({cssClass:"loop-type-tooltip",offset:-4})},unBindLogic:function(){this.master.workspace.off("paste-animation",this.onAnimationPaste),this.$step_selector.find(".js-prev-step").off("click",this.prevStepClick),this.$step_selector.find(".js-next-step").off("click",this.nextStepClick),this.$steps_container.off("click",".param-wrapper.start-block .start-popup-item",this.startItemClick),this.$steps_container.off("click",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemClick),this.$steps_container.off("mouseenter mouseleave",".param-wrapper.acceleration-block .acceleration-popup-item",this.accelerationItemMouseEnterLeave),this.$steps_container.off("click",".remove-effect",this.removeEffectClick),this.$steps_container.off("click",".effects-presets-wrapper .effects-item",this.addStepClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item",this.usePresetClick),this.$steps_container.off("click",".effects-presets-wrapper .presets-item .preview",this.previewPresetClick),this.$panel.off("click",".unite-button",this.uniteClick),this.removeTriggerButtons(),this.$loop_repeat.off("click",this.onLoopTypeClick),this.$loop_swing.off("click",this.onLoopTypeClick),this.$playOnce.off("click",this.onPlayOnceClick),this.$preview_switcher.off("click",this.togglePreviewMode),this.$panel.off("click",".js-type-popup-item",this.typeSelectorItemClick),this.$panel.off("click",".bottom-block .add-effect .effect-popup-item",this.addEffectItemClick),this.popupManager.destroy(),delete this.popupManager,RM.constructorRouter.unbindGlobalKeyPress("a",this.onClick),this.stopListening(this.someModel,"animation:trigger:add"),this.stopListening(this.someModel,"animation:trigger:remove")},onPlayOnceClick:function(){var t=this;this.setAnimation({playOnce:!(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}))||{}).playOnce},this.currentUuid),this.updatePlayOnce()},updatePlayOnce:function(){var t=this;this.$playOnce.toggleClass("active",Boolean(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})).playOnce))},startPreviewMode:function(){this.isPreviewMode||(this.isPreviewMode=!0,this.$preview_switcher.text("Stop").addClass("active"),this.animationSteps&&this.animationSteps.startPreviewMode())},updatePreviewMode:function(){this.isPreviewMode&&this.animationSteps&&this.animationSteps.updatePreviewMode()},stopPreviewMode:function(){this.isPreviewMode&&(this.isPreviewMode=!1,this.$preview_switcher.text("Preview").removeClass("active"),this.animationSteps&&this.animationSteps.stopPreviewMode())},togglePreviewMode:function(){this.isPreviewMode?this.stopPreviewMode():this.startPreviewMode()},onAnimationPaste:function(){this.selected?this.updateAll():this.onClick()},renderStep:function(t,e){var i,n,a=this.block.getAnimationTriggers(this.currentUuid),s=a&&a.length>0,r=this.block.id,l=a&&1===a.length&&a.includes(r);this.isSwitcherVisible=s&&!l&&0===e&&this.doesOpacityHaveDefaultvalues(),i=o.a.extend({index:e,isSwitcherVisible:this.isSwitcherVisible},t),n=Object(u.a)(this.step_template(i)),e>0?this.$steps_container.find(".step").eq(e-1).after(n):this.$steps_container.append(n),n.find("input").each(o.a.bind((function(t,e){var i=Object(u.a)(e).RMNumericInput({onChange:this.onParamInputChange,labelSelector:".units:not(.for-centering)",autoSize:!0}).data("changeValue");Object(u.a)(e).data("cb",i)}),this));var c=n.find(".js-start-when-in-view-switcher");c.length&&c.RMSwitcher({state:i.startWhenInView,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onSwitcherChange.bind(this));var d=n.find(".js-hide-in-editor-switcher");d.length&&d.RMSwitcher({state:i.hideInEditor,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.onHidingSwitcherChange.bind(this))},destroyStep:function(t){this.$steps_container.find(".step").eq(t).remove()},destroyAllSteps:function(t){this.$steps_container.find(".step").remove()},updateStepsIndexes:function(){this.$steps_container.find(".step").each((function(t,e){Object(u.a)(e).attr("data-ind",t)}))},prevStepClick:function(t){var e=this;t.stopPropagation(),this.switchStep({updateWorkspaceSelectedStep:!0,cur:(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected||0)-1})},nextStepClick:function(t){var e=this;t.stopPropagation(),this.switchStep({updateWorkspaceSelectedStep:!0,cur:(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected||0)+1})},onStepPopupItemClick:function(t){var e=this,i=Object(u.a)(t.target).closest(".js-step-popup-item"),n=parseInt(i.data("ind"),10);n!==this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected&&this.switchStep({updateWorkspaceSelectedStep:!0,cur:n})},onAnimationStepsSelect:function(t){this.switchStep({updateWorkspaceSelectedStep:!1,cur:t})},onStepsSortStart:function(){this.$(".js-step-popup").addClass("grabbing")},onStepsSortEnd:function(){this.$(".js-step-popup").removeClass("grabbing"),this.reorderSteps()},reorderSteps:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e.steps,n=e.selected,a=[];o.a.each(this.$step_selector.find(".js-step-popup-item"),function(t,e){var o=Object(u.a)(t).data("ind");o===n&&this.setAnimation({selected:e},this.currentUuid);var s=i[o];a.push(s)}.bind(this)),this.setAnimation({steps:a},this.currentUuid),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0})},switchStep:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps.length;t.cur>=i||t.cur<0||(this.setAnimation({selected:t.cur},this.currentUuid,{historyMergeID:"selected",skipPreviewUpdate:!0}),this.showSelectedStep({updateWorkspaceSelectedStep:t.updateWorkspaceSelectedStep}),this.updateLoop(),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Switch Steps"))},addStepClick:function(t){var e=Object(u.a)(t.currentTarget).attr("data-value");this.addStep({use_effect:e}),RM.analytics&&RM.analytics.sendEvent("Animation Choose Effect",e.split("_").pop())},addStep:function(t){var e=this;t=t||{};var i,n=o.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),a=o.a.cloneWithObjects(this.DEFAULT_ANIMATION_STEP),s={};if("initial"!=t.after_step?i=null!=t.after_step?t.after_step+1:n.length:(i=0,s.from_opacity=n[0].from_opacity,s.from_rotate=n[0].from_rotate,s.from_scale=n[0].from_scale,n[0].use_opacity&&(s.use_opacity=!0,s.opacity=n[0].from_opacity),n[0].use_rotate&&(s.use_rotate=!0,s.rotate=n[0].from_rotate),n[0].use_scale&&(s.use_scale=!0,s.scale=n[0].from_scale),o.a.extend(a,s)),n.splice(i,0,a),this.setAnimation({selected:i,steps:n},this.currentUuid),1==n.length)return this.updateAll(),void this.addEffectItem(t.use_effect);this.renderStep(a,i),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),this.addEffectItem(t.use_effect),RM.analytics&&RM.analytics.sendEvent("Animation Add Step",i)},usePresetClick:function(t){if(!Object(u.a)(t.target).closest(".preview").length){var e=Object(u.a)(t.currentTarget).attr("data-value");this.setAnimation(this.PRESETS[e],this.currentUuid),this.updateAll(),RM.analytics&&RM.analytics.sendEvent("Animation Use Preset",e)}},previewPresetClick:function(t){},removeStep:function(t){var e=this,i=o.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),n={};if((0==t||"initial"==t)&&1==i.length)return this.setAnimation({selected:void 0,steps:[]},this.currentUuid),void this.updateAll();if(0==t&&i.length>1){var a=b.a.getNormalizedAnimation(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),this.isFixed,this.isFullwidth,this.isFullheight,1);n.from_opacity=i[0].from_opacity,n.from_rotate=i[0].from_rotate,n.from_scale=i[0].from_scale,i[0].use_opacity&&(n.opacity=a.steps[1].opacity,n.use_opacity=!0),i[0].use_rotate&&(n.rotate=a.steps[1].rotate,n.use_rotate=!0),i[0].use_scale&&(n.scale=a.steps[1].scale,n.use_scale=!0),o.a.extend(i[1],n)}"initial"!=t&&(i.splice(t,1),this.setAnimation({selected:t==i.length?t-1:t,steps:i},this.currentUuid),this.destroyStep(t),this.updateStepsIndexes(),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:t}),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.__scrollRecalc_debounced(),RM.analytics&&RM.analytics.sendEvent("Animation Remove Step",t))},resetClick:function(){this.setAnimation({},this.currentUuid),this.updateAll()},uniteClick:function(){var t={},e=0,i=null;this.models.forEach((function(n){var o=b.a.getUuidHash(n.getAnimations())||"none";t[o]=(t[o]||0)+1,"none"!==o&&t[o]>e&&(i=n,e=t[o])})),this.setAnimations(i.getAnimations(),{skipHistory:!0}),this.updateAll()},onAnimationStepsChange:function(t){var e=this,i=t.id,n=o.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).steps),a=!1;delete t.id,n[i]&&(o.a.extend(n[i],t),null==t.dx||n[i].use_move||(n[i].use_move=!0,a=!0),null==t.scale&&null==t.from_scale||n[i].use_scale||(n[i].use_scale=!0,a=!0),this.setAnimation({steps:n},this.currentUuid,{historyMergeID:o.a.keys(t).join("-")}),a&&this.updateCurrentStepParams({visibility:!0}),i==this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})).selected&&this.updateCurrentStepInputs(o.a.keys(t)))},onAnimationSelect:function(t){var e=Object(u.a)(t.currentTarget).data("uuid");this.switchToAnimation(e)},onAnimationRemove:function(t){var e=Object(u.a)(t.currentTarget).data("uuid"),i=this.someModel.getAnimations();if(i.length>1){var n=i.filter((function(t){return t.UUID!==e}));this.setAnimations(n),this.currentUuid===e?this.switchToAnimation(n[n.length-1].UUID):this.updateType()}else this.setAnimations([]),this.updateAll()},typeSelectorItemClick:function(t){var e=Object(u.a)(t.currentTarget).data("uuid")||y.default.generateUUID(),i=Object(u.a)(t.currentTarget).attr("data-value"),n=this.someModel.getAnimations().find((function(t){return t.UUID===e})),o=(n&&n.type)!==i;this.setAnimation({type:i},e),this.switchToAnimation(e,o)},switchToAnimation:function(t,e){var i=this.someModel.getAnimations().find((function(e){return e.UUID===t})),n=i&&i.type,o=this.checkPreviewEnabled(n),a=this.currentUuid!==t||e;if(o)return this.setAnimation({type:n},t),this.popupManager.closePopup("type-selector"),this.updateAll(),this.setAnimation({type:"none"},t),this.someModel.trigger("animation:type:change","none",t),void(this.animationSteps&&this.animationSteps.destroy());this.currentUuid=t,n&&this.setAnimation({type:n},t),this.popupManager.closePopup("type-selector"),a||this.someModel.get("preview_enabled")?this.updateAll():(this.updateType(),this.updateCurrentStepParams({visibility:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs()),e&&this.someModel.trigger("animation:type:change",n,t),RM.analytics&&RM.analytics.sendEvent("Animation Type Change",n)},addType:function(t){t.preventDefault()},addEffectItemClick:function(t){this.addEffectItem(Object(u.a)(t.currentTarget).attr("data-value")),this.popupManager.closePopup("add-effect")},addEffectItem:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),n=i.selected||0,a={};if(!i.steps[n][t]){var s=o.a.cloneWithObjects(i.steps),r=b.a.getNormalizedAnimation(i,this.isFixed,this.isFullwidth,this.isFullheight,1);s[n][t]=!0,"use_move"==t&&null==s[n].dx&&(a.dx=r.steps[n].dx,a.dy=r.steps[n].dy+10),"use_opacity"==t&&null==s[n].opacity&&(a.opacity=Math.round(r.steps[n].opacity)),"use_rotate"==t&&null==s[n].rotate&&(a.rotate=r.steps[n].rotate+45),"use_scale"==t&&null==s[n].scale&&(a.scale=Math.round(.7*r.steps[n].scale)),o.a.extend(s[n],a),this.setAnimation({steps:s},this.currentUuid),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:n}),this.__scrollRecalc_debounced(),this.updateCurrentStepInputs()}},removeEffectClick:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),n=Object(u.a)(t.target).closest(".step").attr("data-ind")-0,a=Object(u.a)(t.currentTarget).attr("data-value"),s=o.a.cloneWithObjects(i.steps);s[n][a]=!1,this.setAnimation({steps:s},this.currentUuid),this.updateCurrentStepParams({visibility:!0}),this.animationSteps&&this.animationSteps.updateSteps({animateStepInd:n}),this.__scrollRecalc_debounced()},onTriggerButtonClick:function(t){var e=Object(u.a)(t.target).closest("[data-id]").data("id"),i=this.getTriggerButtonState(e),n=this.block.id;"none"===i.status?this.updateTriggerButton(e,"pending"):"onOtherPage"===i.status&&i.pageNumber&&(t.stopPropagation(),RM.constructorRouter.once("pageChange",(function(t){setTimeout((function(){var e=o.a.find(t.blocks,(function(t){return t.id==n}));e&&e.onClick()}),0)})),RM.constructorRouter.showWorkspace(i.pageNumber))},onTriggerCancelClick:function(t){var e=Object(u.a)(t.target).closest("[data-id]").data("id");t.stopPropagation(),this.removeTriggerButton(e)},onTriggerRemoveClick:function(t){t.stopPropagation();var e=Object(u.a)(t.target).closest("[data-id]").data("id"),i=this.block.getAnimationTriggers(this.currentUuid);-1!==i.indexOf(e)&&(P.a.highlightActiveTriggerBlock(this.master.workspace,this.block,e,!1,!0),this.setAnimation({trigger:o.a.without(i,e)},this.currentUuid),this.someModel.trigger("animation:trigger:remove",e)),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Remove")},onTriggerNameMouseEnter:function(t){P.a.highlightActiveTriggerBlock(this.master.workspace,this.block,Object(u.a)(t.target).closest("[data-id]").data("id"),!0,!1)},onTriggerNameMouseLeave:function(t){P.a.highlightActiveTriggerBlock(this.master.workspace,this.block,Object(u.a)(t.target).closest("[data-id]").data("id"),!1,!1)},onTriggerRemoveMouseEnter:function(t){P.a.highlightActiveTriggerBlock(this.master.workspace,this.block,Object(u.a)(t.target).closest("[data-id]").data("id"),!0,!0)},onTriggerRemoveMouseLeave:function(t){P.a.highlightActiveTriggerBlock(this.master.workspace,this.block,Object(u.a)(t.target).closest("[data-id]").data("id"),!1,!0)},onTriggerClick:function(t){this.setAnimation({trigger:this.removeMissingTriggers(this.block.getAnimationTriggers(this.currentUuid)).concat(t)},this.currentUuid),this.someModel.trigger("animation:trigger:add",t),RM.analytics&&RM.analytics.sendEvent("Animation Trigger Click")},onTriggerMouseEnter:function(t){this.highlightPendingTriggerBlock(Object(u.a)(t.target).closest(".block").data("id"),!0)},onTriggerMouseLeave:function(t){this.highlightPendingTriggerBlock(Object(u.a)(t.target).closest(".block").data("id"),!1)},onLoopTypeClick:function(t){var e=this,i=Object(u.a)(t.currentTarget);if(!this.$loop_types.hasClass("disabled")&&!i.hasClass("included")){var n=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),a=n.selected||0,s=o.a.cloneWithObjects(n.steps).map((function(t){return I(I({},t),{},{loop:!1})}));s[a].loop=!i.hasClass("checked")&&i.data("value"),this.setAnimation({steps:s,loop:!1},this.currentUuid),this.updateLoop(),this.updateStepsPopup()}},highlightPendingTriggerBlock:function(t,e){var i=t&&this.master.workspace.findBlock(t);i&&i.highlight(e&&P.a.canBeExternalTrigger(i,this.block),b.a.ACTIVE_TRIGGER_HIGHLIGHT_CLASS)},updateTriggerButtonHandlers:function(t){var e=o.a.map(t,(function(t){return t.status}));switch(-1!==e.indexOf("pending")?"pending":-1!==e.indexOf("active")?"active":"none"){case"pending":this.waitingForTriggerClick=!0,P.a.enterPickTriggerMode(this.master.workspace,this.block,this.block.getAnimationTriggers(this.currentUuid),this.onTriggerClick),this.block.animationMode&&(this.willRestoreAnimationMode=!0,this.destroyAnimationSteps());break;case"active":case"onOtherPage":case"none":o.a.delay(function(){this.waitingForTriggerClick=!1}.bind(this)),P.a.leavePickTriggerMode(this.master.workspace),this.willRestoreAnimationMode&&(this.willRestoreAnimationMode=!1,this.initializeAnimationSteps())}},renderTriggerButton:function(t,e,i){var n=t&&this.master.workspace.findBlock(t),o=n&&1===this.blocks.length&&this.block.id===n.id;return v.a["template-constructor-control-common_animation-trigger"]({id:t,status:e,pageNumber:i,isSelf:o,triggerBlockName:n&&n.model.get("name")||n&&n.getStandardName()||"Trigger"})},getTriggerButtonState:function(t){return this.triggerButtonsState&&this.triggerButtonsState[t]||{}},getStepIndex:function(t){return Object(u.a)(t).closest(".step").attr("data-ind")-0},changeStepField:function(t,e){var i=this,n=this.someModel.getAnimations().find((function(t){return t.UUID===i.currentUuid})),a=o.a.cloneWithObjects(n.steps);o.a.extend(a[t],e),this.setAnimation({steps:a},this.currentUuid)},onSwitcherChange:function(t){this.changeStepField(0,{startWhenInView:t})},onHidingSwitcherChange:function(t){this.changeStepField(0,{hideInEditor:t})},startItemClick:function(t){var e=Object(u.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{start_point:e}),this.updateCurrentStepParams({start:!0})},accelerationItemClick:function(t){var e=Object(u.a)(t.currentTarget).attr("data-value");this.changeStepField(this.getStepIndex(t.target),{acceleration:e}),this.popupManager.closePopup("acceleration-selector"),this.updateCurrentStepParams({acceleration:!0})},accelerationItemMouseEnterLeave:function(t){var e=Object(u.a)(t.currentTarget).siblings(".acceleration-popup-preview").find(".ball"),i="mouseenter"==t.type?Object(u.a)(t.currentTarget).attr("data-value"):"";if(e.attr("data-acceleration")||""){var n=b.a.ANIMATION_PROPERTIES.animationIterationJS;e.off().one(n,(function(t){0==Math.round(t.originalEvent.elapsedTime/.7)%2?(e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)):e.off().one(n,(function(t){e.attr("data-acceleration",""),e.outerHeight(),e.attr("data-acceleration",i)}))}))}else e.attr("data-acceleration",i)},onParamInputChange:function(t,e){var i=this,n=this.getStepIndex(t),a=o.a.cloneWithObjects(this.someModel.getAnimations().find((function(t){return t.UUID===i.currentUuid})).steps),s=Object(u.a)(".move-block .numeric-input.left-align")[0].value,r=Object(u.a)(".move-block .numeric-input.right-align")[0].value,l=t.attr("data-param");if(s>9999||s<-9999||r>9999||r<-9999?Object(u.a)(".move-block .numeric-input").css("font-size","18px"):Object(u.a)(".move-block .numeric-input").css("font-size","22px"),a[n]&&(a[n][l]=e,this.setAnimation({steps:a},this.currentUuid,{historyMergeID:l}),o.a.contains(["rotate","scale","opacity","dx","dy","from_rotate","from_scale","from_opacity"],l)&&this.animationSteps&&this.animationSteps.updateSteps(),o.a.contains(["opacity","from_opacity"],l)&&0===n&&this.onOpacityChange(),"start_offset"==l&&this.updateCurrentStepParams({start:!0}),o.a.contains(["delay","duration","delay_px"],l))){var c={};c[l]=!0,this.updateCurrentStepParams(c)}},onOpacityChange:function(){this.doesOpacityHaveDefaultvalues()||this.changeStepField(0,{hideInEditor:!1}),(this.doesOpacityHaveDefaultvalues()&&!this.isSwitcherVisible||!this.doesOpacityHaveDefaultvalues()&&this.isSwitcherVisible)&&(this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},doesOpacityHaveDefaultvalues:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e&&e.steps&&e.steps[0]&&e.steps[0].from_opacity,n=e&&e.steps&&e.steps[0]&&e.steps[0].opacity;return 0===i&&100===n},onAnimationTriggerAdd:function(t){this.updateTriggerButton(t,"active")},onAnimationTriggerRemove:function(t){this.removeTriggerButton(t)},initializeAnimationSteps:function(){this.animationSteps=new O({uuid:this.currentUuid,blocks:this.blocks,workspace:this.master.workspace,isFixed:this.isFixed,isFullwidth:this.isFullwidth,isFullheight:this.isFullheight,isSticked:this.isSticked,popupManager:this.popupManager});var t=parseInt(this.animationSteps.$el.css("z-index"),10),e=o.a.max(o.a.map(this.blocks,(function(t){return t.model.attributes.z})));o.a.each(this.block.getTriggerBlocks(),(function(i,n){var o=i.$el.css("z-index"),a=i.model.attributes.z;e<a&&i.$el.css({"z-index":t+n+1}),i.$el.data({"original-element-z-index":o})})),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}),this.animationSteps.on("move scale",this.onAnimationStepsChange),this.animationSteps.on("add-step",this.addStep),this.animationSteps.on("remove-step",this.removeStep),this.animationSteps.on("select",this.onAnimationStepsSelect)},destroyAnimationSteps:function(){this.animationSteps&&this.animationSteps.destroy(),o.a.each(this.block.getTriggerBlocks(),(function(t){var e=t.$el.data("original-element-z-index");t.$el.css({"z-index":e&&"auto"!==e?e:null})}))},updateAll:function(t){if(t=t||{},this.isFullwidth=!!this.someModel.get("is_full_width"),this.isFullheight=!!this.someModel.get("is_full_height"),this.isFixed=!!this.someModel.get("fixed_position"),this.isSticked=!!this.someModel.get("sticked"),this.isMobileViewport="default"!=this.master.workspace.page.getCurrentViewport(),this.$panel.find('.type-selector .type-popup-item[data-value="hover"]').toggle(!this.isMobileViewport),this.updateControlState(),this.destroyAnimationSteps(),this.updateType(),!this.checkWidgetsCompatibility())return this.__scrollRecalc_debounced(),void this.stopPreviewMode();this.__scrollRecalc_debounced(),this.popupManager&&this.popupManager.closeAllPopups(),this.initializeAnimationSteps(),this.updateLoop(),this.updatePlayOnce(),this.resetTriggerButtons(),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced()},updateControlState:function(){this.$el.toggleClass("has-animation",o.a.any(this.models,(function(t){return t.getAnimations().filter((function(t){return"none"!==t.type})).length})))},checkWidgetsCompatibility:function(){var t=this,e=0,i=0,n=[],a=0,s=0,r=0,l=0,c={};if(o.a.each(this.models,o.a.bind((function(t){t.get("fixed_position")&&(i++,n.push(t.get("fixed_position"))),t.get("is_full_width")&&a++,t.get("is_full_height")&&s++,t.get("sticked")&&r++,b.a.canHaveAnimation(t)||l++,t.get("fixed_position")||t.get("is_full_width")||t.get("is_full_height")||t.get("sticked")||e++,c[b.a.getUuidHash(t.getAnimations())||"none"]=!0}),this)),this.$panel.removeClass("show-mixed-types show-multiple-fixeds show-multiple-stickeds show-multiple-fullwidths show-multiple-fullheights show-multiple-animations animation-disabled animation-without-steps show-non-animatable"),this.models.length>1){if(e&&(i||a||s||r)||!e&&(i&&a||i&&s||i&&r||r&&a||r&&s||a&&s))return this.$panel.addClass("show-mixed-types"),this.toggleFixedPanelSize(!0,this.MESSAGE_MIXED_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Mixed Types"),!1;if(i)return this.$panel.addClass("show-multiple-fixeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Fixed"),!1;if(r)return this.$panel.addClass("show-multiple-stickeds"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Sticky"),!1;if(a)return this.$panel.addClass("show-multiple-fullwidths"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Width"),!1;if(s)return this.$panel.addClass("show-multiple-fullheights"),this.toggleFixedPanelSize(!0,this.MESSAGE_MULTIPLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Multiple Full Height"),!1;if(l)return this.$panel.addClass("show-non-animatable"),this.toggleFixedPanelSize(!0,this.MESSAGE_NON_ANIMATABLE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Cannot Animate Group"),!1;if(o.a.keys(c).length>1)return this.$panel.addClass("show-multiple-animations"),this.toggleFixedPanelSize(!0,this.MESSAGE_UNITE_HEIGHT),RM.analytics&&RM.analytics.sendEvent("Animation Message Unite Animations Confirm"),!1}var d=this.someModel.getAnimations(),h=d.find((function(e){return e.UUID===t.currentUuid}));if(!d.length)return this.$panel.addClass("animation-disabled"),this.toggleFixedPanelSize(!0,Object(u.a)(".js-top-block").height()),!1;if("none"===h.type){var p=j(this.$panel.children(":visible").map((function(t,e){return"absolute"!==Object(u.a)(e).css("position")?Object(u.a)(e).height():0}))).reduce((function(t,e){return t+e}),0);return this.toggleFixedPanelSize(!0,p),!1}return o.a.isEmpty(h.steps)?(this.$panel.addClass("animation-without-steps"),this.$panel.find('.effects-presets-wrapper .effects-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.$panel.find('.effects-presets-wrapper .presets-item[data-value="rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),this.destroyAllSteps(),this.toggleFixedPanelSize(!1),this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:16}),this.__scrollRecalc_debounced&&this.__scrollRecalc_debounced(),!1):(this.resizableScroll&&this.resizableScroll.changeGaps({gap_start:88}),this.toggleFixedPanelSize(!1),!0)},updateEffectPopupState:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},n=i.selected||0,a=i.steps[n];t.find('.effect-popup-item[data-value="use_rotate"]').toggle(!(this.isFullwidth||this.isFullheight)),o.a.each(["use_move","use_opacity","use_rotate","use_scale"],(function(e){t.find('.effect-popup-item[data-value="'+e+'"]').toggleClass("used",!!a[e])}))},updateAccelerationPopupState:function(t){var e=t.position().top<130;t.toggleClass("shift-popup",e)},updateType:function(){var t=this,e=[].concat(j(b.a.EVENT_TYPES),["none"]),i=j(this.someModel.getAnimations()).sort((function(t,i){return e.indexOf(t.type)-e.indexOf(i.type)})),n=i.find((function(e){return e.UUID===t.currentUuid}))||{},a=n&&n.type,s=Object(u.a)(document.createDocumentFragment());this.$panel.attr("data-animation",a),this.$el.find(".js-animation-type").remove();var r=o.a.without.apply(o.a,[b.a.EVENT_TYPES].concat(j(i.map((function(t){return t.type})))));i.forEach((function(n,o){s.append(t.typeTemplate({index:o,animation:n,currentType:a,allowTriggers:function(t){return b.a.POINTER_EVENTS.includes(t.type)},currentUuid:t.currentUuid,total:i.length,renderTypePopup:function(i){var n=i.type,o=i.uuid;return t.typeSelectorTemplate({type:n,isInitial:!1,uuid:o,cssClass:"js-change-type-popup",availableTypes:("none"!==n?[n].concat(j(r)):r).sort((function(t,i){return e.indexOf(t)-e.indexOf(i)})),currentType:a})}}))}));var l=Object(u.a)(this.typeSelectorTemplate({isInitial:!1,cssClass:"js-add-animation-popup",type:void 0,uuid:void 0,currentType:void 0,availableTypes:r}));s.insertBefore(this.$el.find(".js-step-selector")),this.$panel.toggleClass("show-add-block",i.length<4&&i.length>0),this.$el.find(".js-add-animation-popup").replaceWith(l),this.resetTriggerButtons(),this.$panel.toggleClass("show-trigger",b.a.isExternalTriggerAllowed(a)&&!o.a.isEmpty(n&&n.steps)),this.$panel.toggleClass("show-loops","scroll"!==a),this.$panel.toggleClass("show-start-condition","load"===a),this.$panel.toggleClass("show-play-once","click"===a),this.toggleRequiresTrigger(),this.checkPreviewEnabled(),window.requestAnimationFrame(this.resizableScroll.recalc.bind(this.resizableScroll)),this.__scrollRecalc_debounced()},toggleRequiresTrigger:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}))||{};this.$panel.toggleClass("show-requires-trigger",Boolean("click"===e.type&&!this.block.getAnimationTriggers(this.currentUuid).length&&"video"===this.someModel.get("type"))&&!o.a.isEmpty(e.steps)),this.updateCurrentStepInputs()},checkPreviewEnabled:function(t){var e=this,i=t||(this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{}).type,n=Boolean(this.someModel.get("preview_enabled")),o=Boolean("click"===i&&n);return this.$panel.toggleClass("show-cannot-use-with-picture-preview",o),this.updateCurrentStepInputs(),o},resetTriggerButtons:function(){this.updateTriggerButtons(o.a.reduce(this.block.getAnimationTriggers(this.currentUuid),function(t,e){return t[e]=this.verifyTriggerState(e,"active"),t}.bind(this),{}))},removeTriggerButton:function(t){if(t)var e="new"===t?o.a.extend({},this.triggerButtonsState,{new:{status:"none"}}):o.a.omit(this.triggerButtonsState,t);this.updateTriggerButtons(e),this.isSwitcherVisible&&(this.changeStepField(0,{hideInEditor:!1}),this.updateSteps(),this.updateStepsIndexes(),this.showSelectedStep({updateWorkspaceSelectedStep:!0}))},removeTriggerButtons:function(){this.updateTriggerButtons({})},updateTriggerButton:function(t,e){if(t){var i={};i[t]=this.verifyTriggerState(t,e);var n=o.a.extend({},o.a.omit(this.triggerButtonsState,"new"),i);this.updateTriggerButtons(n)}},updateTriggerButtons:function(t){!(t=o.a.omit(t,(function(t,e){return"new"!==e&&t&&"none"===t.status}))).new&&o.a.keys(t).length<this.TRIGGER_COUNT_LIMIT&&(t.new={status:"none"});var e=Object(u.a)(document.createDocumentFragment());o.a.each(t,function(t,i){e.append(this.renderTriggerButton(i,t.status,t.pageNumber))}.bind(this)),this.$panel.find(".js-trigger-buttons-container").empty().append(e),this.updateTriggerButtonHandlers(t),this.triggerButtonsState=t,this.__scrollRecalc_debounced(),this.toggleRequiresTrigger(),this.checkPreviewEnabled()},verifyTriggerState:function(t,e){if(-1!==["pending","none"].indexOf(e))return{status:e};var i=t&&this.master.workspace.findBlock(t),n=t&&!i?this.master.workspace.mag.getWidgetPage(t):null;return i?{status:"active"}:n&&n.id!==this.master.workspace.page.id?{status:"onOtherPage",pageNumber:n.attributes.num}:{status:"none"}},removeMissingTriggers:function(t){return o.a.filter(t,function(t){return t&&this.master.workspace.findBlock(t)||this.master.workspace.mag.getWidgetPage(t)}.bind(this))},updateCurrentStepParams:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},n=i.type||"none",a=i.selected||0,s=i.steps;if(!o.a.isEmpty(s)){var r=this.$steps_container.find(".step").eq(a),l=s[a];if(t.visibility&&(Object(u.a)(" .param-wrapper.delay-block, .param-wrapper.duration-block",r).toggleClass("hide-unallowed","scroll"==n),Object(u.a)(".param-wrapper.delay_px-block",r).toggleClass("hide-unallowed","scroll"!=n||0==a&&!this.isFixed),Object(u.a)(".param-wrapper.speed-block",r).toggleClass("hide-unallowed","scroll"!=n),Object(u.a)(".param-wrapper.start-block",r).toggleClass("hide-unallowed","scroll"!=n||a>0||this.isFixed),Object(u.a)(".param-wrapper.move-block",r).toggleClass("hide-dx-input",this.isFullwidth),Object(u.a)(".param-wrapper.move-block",r).toggleClass("hide-dy-input",this.isFullheight),Object(u.a)(".param-wrapper.rotate-block",r).toggleClass("hide-unallowed",this.isFullwidth||this.isFullheight),Object(u.a)(".param-wrapper.opacity-block, .param-wrapper.rotate-block, .param-wrapper.scale-block",r).toggleClass("hide-from-input",a>0),Object(u.a)(".param-wrapper.move-block",r).toggleClass("hide-unused",!l.use_move),Object(u.a)(".param-wrapper.opacity-block",r).toggleClass("hide-unused",!l.use_opacity),Object(u.a)(".param-wrapper.rotate-block",r).toggleClass("hide-unused",!l.use_rotate),Object(u.a)(".param-wrapper.scale-block",r).toggleClass("hide-unused",!l.use_scale)),t.start&&!Object(u.a)(".param-wrapper.start-block",r).hasClass("hide-unallowed")){var c;(c=Object(u.a)('.param-wrapper.start-block .start-popup .start-popup-item[data-value="'+l.start_point+'"]',r)).addClass("curr").siblings(".start-popup-item").removeClass("curr"),Object(u.a)(".param-wrapper.start-block .start-value",r).text(c.text()),Object(u.a)(".param-wrapper.start-block .start-popup",r).toggleClass("has-offset",!!l.start_offset);var d=63*{top:0,center:.5,bottom:1}[l.start_point],h=-63*l.start_offset/Object(u.a)(window).height(),p=Math.max(Math.min(d+h,63),0);Object(u.a)(".param-wrapper.start-block .start-preview .start-point",r).css("top",d),Object(u.a)(".param-wrapper.start-block .start-preview .start-dist",r).css({top:Math.min(d,p),bottom:63-Math.max(d,p)}),Object(u.a)(".param-wrapper.start-block .start-preview .start-offset",r).css("top",p)}if(t.acceleration)(c=Object(u.a)('.param-wrapper.acceleration-block .acceleration-popup .acceleration-popup-item[data-value="'+l.acceleration+'"]',r)).addClass("curr").siblings(".acceleration-popup-item").removeClass("curr"),Object(u.a)(".param-wrapper.acceleration-block .acceleration-value",r).text(c.text());o.a.each(["delay","duration","delay_px"],(function(e){if(t[e]&&!Object(u.a)(".param-wrapper."+e+"-block",r).hasClass("hide-unallowed")){var i;i="delay_px"==e?Math.min(76*l[e]/Object(u.a)(window).height(),76):Math.min(20*l[e],76),Object(u.a)(".param-wrapper."+e+"-block .bg",r).height(i)}}))}},updateCurrentStepInputs:function(t){var e=this,i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid}))||{},n=i.selected||0;t=t||["start_offset","delay","duration","delay_px","speed","dx","dy","opacity","rotate","scale"];if(!o.a.isEmpty(i.steps)){var a=this.$steps_container.find(".step").eq(n);o.a.each(t,(function(t){var e;((e=a.find('input[data-param="'+t+'"]').data("cb"))&&e(i.steps[n][t],!0),"opacity"==t||"rotate"==t||"scale"==t)&&(t="from_"+t,(e=a.find('input[data-param="'+t+'"]').data("cb"))&&e(i.steps[n][t],!0))}))}},updateStepsPopup:function(){var t=this,e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})),i=e.steps,n=e.selected||0,a=this.$step_selector.find(".js-step-popup-content"),s=v.a["template-constructor-control-common_animation-step-popup-item"],r=e.loop?0:i?i.findIndex((function(t){return t.loop})):-1,l=Object(u.a)(document.createDocumentFragment());o.a.each(i,(function(t,e){var i=s({index:e,text:"Step "+(e+1),isSelected:e===n,isInLoop:r>-1&&e>=r});l.append(i)})),a.empty().append(l),a.off("click.popup-item"),a.on("click.popup-item",".js-step-popup-item",this.onStepPopupItemClick)},updateLoop:function(){var t=this;this.$loop_types.find("[data-value]").removeClass("checked included");var e=this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid}));if(e&&e.steps&&e.steps.length){var i=e.selected||0,n=b.a.normalizeLoopValue(e.loop||e.steps.map((function(t){return t.loop})).find((function(t){return t}))),o=e.loop?0:e.steps.findIndex((function(t){return t.loop})),a=this.$loop_types.find("[data-value="+n+"]");i===o&&a.addClass("checked"),o>-1&&i>o&&a.addClass("included"),this.$loop_types.toggleClass("first",0===i)}},updateSteps:function(){var t=this;this.destroyAllSteps(),o.a.each(this.someModel.getAnimations().find((function(e){return e.UUID===t.currentUuid})).steps,this.renderStep)},showSelectedStep:function(t){var e=this;t=t||{};var i=this.someModel.getAnimations().find((function(t){return t.UUID===e.currentUuid})),n=i.steps.length,o=i.selected||0;this.$step_selector.toggleClass("one-step",1==n),this.$step_selector.find(".js-step-caption").text(1==n?"Step 1":"Step "+(o+1)+"/"+n),this.$step_selector.find(".js-prev-step").toggleClass("disabled",0==o),this.$step_selector.find(".js-next-step").toggleClass("disabled",o==n-1),this.$steps_container.find(".step").hide().eq(o).show(),this.updateCurrentStepParams({visibility:!0,acceleration:!0,start:!0,delay:!0,duration:!0,delay_px:!0}),this.updateCurrentStepInputs(),this.updateStepsPopup(),t.updateWorkspaceSelectedStep&&this.animationSteps.selectStep(o)},setAnimation:function(t,e,i){var n=!e||!this.someModel.getAnimations().find((function(t){return t.UUID===e}))?[].concat(j(this.someModel.getAnimations()),[I({loop:!1,selected:0,steps:[],UUID:e||y.default.generateUUID()},t||{})]):this.someModel.getAnimations().map((function(i){return i.UUID===e?I(I({},o.a.cloneWithObjects(i)),t||{}):i}));this.setAnimations(n,i)},setAnimations:function(t,e){e=e||{};var i=o.a.map(this.models,(function(e){return{_id:e.get("_id"),animation:t}}));e.skipHistory||e.redo||e.undo||!this.undoController||(this.undoController.isEmpty()&&this.undoController.add(o.a.cloneWithObjects(this.someModel.getAnimations())),this.undoController.add.__debounced(t,{historyMergeID:e.historyMergeID})),this.master.workspace.set_group(i),!e.skipPreviewUpdate&&this.isPreviewMode&&this.updatePreviewMode(),this.hasChanges=!0},save:function(){this.hasChanges&&(this.setAnimations(this.someModel.getAnimations().map((function(t){return I(I({},t),{},{UUID:y.default.generateUUID()})})),{skipHistory:!0,skipPreviewUpdate:!0}),this.master.workspace.save_group(this.models,{skipHistory:!0}),delete this.hasChanges),m.prototype.save.apply(this,arguments)},onPanelScroll:function(t){},select:function(){m.prototype.select.apply(this,arguments),this.undoController=new R({control:this,pid:this.models[0].get("pid")});var t=this.someModel.getAnimations(),e=t.find((function(t){return!t.steps||!t.steps.length}))||t.find((function(t){return"none"!==t.type}))||t[0];e&&!e.UUID&&(e.UUID=y.default.generateUUID()),this.currentUuid=e&&e.UUID,this.updateAll(),this.$panel.hide(),this.$panel.outerHeight(),this.$panel.show()},deselect:function(){this.stopPreviewMode(),this.destroyAnimationSteps(),this.popupManager&&this.popupManager.closeAllPopups&&this.popupManager.closeAllPopups(),this.save(),this.undoController&&this.undoController.destroy(),delete this.undoController,m.prototype.deselect.apply(this,arguments)},onClick:function(){this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||a.a.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.isPreviewMode?this.stopPreviewMode():this.selected&&this.popupManager.openedPopup&&this.popupManager.closeAllPopups()||a.a.prototype.onEscKey.apply(this,arguments)},restrictions:function(t){var e=t.getSelectedBlocks();return o.a.find(e,(function(t){return b.a.canHaveAnimation(t)}))},canControlBeClosed:function(){return!(!this.popupManager.openedPopup||!this.popupManager.closeAllPopups())||(!!this.waitingForTriggerClick||a.a.prototype.canControlBeClosed.apply(this,arguments))},destroy:function(){this.selected&&this.deselect(),this.willRestoreAnimationMode=!1,this.removeTriggerButtons(),m.prototype.destroy.apply(this,arguments)}}),R=g.a.Model.extend({initialize:function(t){o.a.bindAll(this),this.control=t.control,this.pid=t.pid,this.undoIndex=-1,this.undoStack=[],this.add.__debounced=o.a.debounce(this.add,300),this.historyTriggers=_.a.setCustomHandlers({undo:this.undo,redo:this.redo,getLength:this.getLength})},isEmpty:function(){return-1==this.undoIndex},add:function(t,e){e=e||{},-1!=this.undoIndex&&o.a.isEqual(this.undoStack[this.undoIndex].animation,t)||(o.a.isEmpty(t)&&(t={}),this.undoIndex>=0&&e.historyMergeID&&e.historyMergeID==this.undoStack[this.undoIndex].historyMergeID||this.undoIndex++,this.undoStack[this.undoIndex]={animation:t,historyMergeID:e.historyMergeID},this.undoStack.length=this.undoIndex+1,this.historyTriggers.triggerChange(this.pid))},undo:function(t){this.undoIndex>0&&(this.undoIndex--,this.control.setAnimations(this.undoStack[this.undoIndex].animation,{undo:!0}),this.control.updateAll({undo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerUndo(this.pid))},redo:function(t){this.undoIndex<this.undoStack.length-1&&(this.undoIndex++,this.control.setAnimations(this.undoStack[this.undoIndex].animation,{redo:!0}),this.control.updateAll({redo:!0}),this.historyTriggers.triggerChange(this.pid),this.historyTriggers.triggerRedo(this.pid))},getLength:function(t){return{undo:this.undoIndex,redo:this.undoStack.length-1-this.undoIndex,page:t}},destroy:function(){_.a.removeCustomHandlers()}});function A(t){this.popups={},this.openedPopup="",o.a.bindAll(this),this.closeAllPopups.__debounced=o.a.debounce(this.closeAllPopups,50)}A.prototype.addPopup=function(t){t.onClick=o.a.bind((function(e){e&&Object(u.a)(e.target).closest(t.popupSelector).length>0||this.onClick(t.name,e.currentTarget)}),this),t.$parent.on("click",t.selector,t.onClick),t.$parent.on("click",this.closeAllPopups.__debounced),this.popups[t.name]=t},A.prototype.onClick=function(t,e){this.openedPopup==t?this.closePopup(t):this.openPopup(t,e)},A.prototype.closePopup=function(t){this.openedPopup==t&&this.popups[t]&&(this.openedPopup="",Object(u.a)(this.popups[t].selector,this.popups[t].$parent).removeClass("opened"),this.popups[t].cbClose&&this.popups[t].cbClose())},A.prototype.openPopup=function(t,e){this.openedPopup!=t&&this.popups[t]&&(this.openedPopup&&this.closePopup(this.openedPopup),this.openedPopup=t,Object(u.a)(e).addClass("opened"),this.popups[t].cbOpen&&this.popups[t].cbOpen(Object(u.a)(e)))},A.prototype.closeAllPopups=function(t){return!this.openedPopup||!(t&&Object(u.a)(t.target).closest(this.popups[this.openedPopup].selector).length>0)&&(this.closePopup(this.openedPopup),!0)},A.prototype.destroy=function(){for(var t in this.popups)this.popups[t].$parent.off("click",this.popups[t].selector,this.popups[t].onClick),this.popups[t].$parent.off("click",this.closeAllPopups.__debounced);delete this.popups};var D=M,z=i("Kw5r"),L=i("G50q"),B=i.n(L),F=a.a.extend({name:"common_pack",className:"control common_pack",initialize:function(t){this.template=B.a["template-constructor-control-common_pack"],this.initControl(t)},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"g",handler:this.onClick,optionKeys:Modernizr.mac?"meta":"ctrl"}])},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("g",this.onClick)},restrictions:function(t){var e={},i=o.a.reduce(t.getSelectedBlocks(),(function(t,i){var n=i.model.get("pack_id"),o=n&&e[n]?0:1;return e[n]=1,t+o}),0)>1,n=o.a.uniq(o.a.map(t.getSelectedBlocks(),(function(t){var e=!!t.model.get("fixed_position");return e=e||!1}))).length<=1,a=o.a.uniq(o.a.map(t.getSelectedBlocks(),(function(t){return!!t.model.get("is_global")}))).length<=1,s=o.a.uniq(o.a.map(t.getSelectedBlocks(),(function(t){return!!t.model.get("is_above")}))).length<=1;return i&&n&&a&&s},onClick:function(){var t=y.default.generateUUID();z.default.nextTick(function(){var e=o.a.map(this.models,(function(e){var i={_id:e.id,pack_id:t};return e.get("is_locked")&&(e.set("is_locked",!1),o.a.extend(i,{is_locked:!1})),i}));this.master.workspace.set_group(e),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.doPack(this.models,this.master.workspace.page,this.master.workspace.page.getCurrentViewport(),t),this.master.workspace.save_group(this.models),RM.constructorRouter.indexController.saveAffectedPages()):this.master.workspace.save_group(this.models),this.master.deselect()}.bind(this))}}),N=i("HIJs"),U=i.n(N),H=a.a.extend({name:"common_unpack",className:"control common_unpack",initialize:function(t){this.template=U.a["template-constructor-control-common_unpack"],this.initControl(t)},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"g",handler:this.onClick,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}])},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("g",this.onClick)},restrictions:function(t){return o.a.reduce(t.getSelectedBlocks(),(function(t,e){return t+(e.model.get("pack_id")?1:0)}),0)>0},onClick:function(){var t=o.a.map(this.models,(function(t){var e={_id:t.id,pack_id:null};return t.get("is_locked")&&(t.set("is_locked",!1),o.a.extend(e,{is_locked:!1})),e}));this.master.workspace.set_group(t),Object(n.a)("constructor.zIndex")?(RM.constructorRouter.indexController.doUnpack(this.models,this.master.workspace.page,this.master.workspace.page.getCurrentViewport()),this.master.workspace.save_group(this.models),RM.constructorRouter.indexController.saveAffectedPages()):this.master.workspace.save_group(this.models),this.master.deselect()}}),V={props:{selected:!1,alt:null,svgIcon:null,iconClass:null}},W=i("KHd+"),G=Object(W.a)(V,(function(){var t,e=this.$createElement,i=this._self._c||e;return i("div",{directives:[{name:"svginject",rawName:"v-svginject"}],staticClass:"icon preloader noarrow",class:(t={},t[this.iconClass]=!!this.iconClass,t["rmalttext-disable"]=this.selected,t),attrs:{"data-alt":this.alt,"data-alt-pos":"left","data-alt-offset":"9"}},[this.svgIcon?i("img",{staticClass:"svg svg-icon",attrs:{src:this.svgIcon}}):this._e()])}),[],!1,null,null,null).exports,q={props:{block:Object,raw_block:Object},data:function(){return{m:{}}},computed:{Globals:function(){return window}},created:function(){this.assignBlockState(this.block)},mounted:function(){var t=this;this.$watch("m",(function(e){t.$parent.$emit("change",e)}),{deep:!0})},watch:{block:{handler:function(t){this.assignBlockState(t)},deep:!0}},methods:{$:function(t){return Object(u.a)(this.$el.querySelector(t))},assignBlockState:function(t){var e=this;o.a.each(t,(function(t,i){return e.$set(e.m,i,t)}))},canClose:function(){var t=!0;return o.a.each(this.$children,(function(e){t=!e.visibleBox&&t,e.visibleBox=!1})),t},closeOthersPopups:function(t){t&&o.a.each(this.$children,(function(e){e!=t&&(e.visibleBox=!1)}))},hide:function(){this.$parent.deselect()}}},K=Object(W.a)(q,void 0,void 0,!1,null,null,null).exports,X=i("tRog"),Y={mixins:[K],components:{NumericInput:X.a},data:function(){return{m:{angle:0,flip_v:!1,flip_h:!1}}},methods:{onEnter:function(){this.$parent.$emit("deselect")},onInputChange:function(t){this.setAngle(t)},onRotate90Click:function(){this.setAngle((this.m.angle||0)+90)},onFirstFocus:function(){this.transparentSelection=!1},setAngle:function(t){if(t=(t=t>=360?t-360:t)<=-360?t+360:t,this.raw_block.workspace.spacesController){var e=Math.abs(Math.cos(this.m.angle/180*Math.PI)),i=Math.abs(Math.sin(this.m.angle/180*Math.PI)),n=Math.abs(Math.cos(t/180*Math.PI)),o=Math.abs(Math.sin(t/180*Math.PI)),a=(this.m.w,this.m.h,this.m.w*o+this.m.h*n),s=this.m.y-a/2+this.m.h/2,r=this.raw_block.workspace.spacesController.getRestriction(this.raw_block.model,[this.raw_block.model]);(!r.canMoveTop||s<r.top)&&(this.m.y+=r.top-s)}this.m.angle=t},flipVertical:function(){this.flip("vertical")},flipHorizontal:function(){this.flip("horizontal")},flip:function(t){var e=(this.m.angle+360)%360,i=this.m.flip_v,n=this.m.flip_h,a=this.m.angle;e<=45||e>=135&&e<=225||e>=315?a=-this.m.angle:(e>45&&e<135||e>225&&e<315)&&(a=180-this.m.angle),"vertical"===t?i=!this.m.flip_v:n=!this.m.flip_h;var s={angle:a,flip_v:i,flip_h:n};o.a.extend(this.m,s)}}},Z=Object(W.a)(Y,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"param-caption"},[t._v("Rotate")]),t._v(" "),i("div",{staticClass:"input-wrapper",class:{negative:t.m.angle<0}},[i("span",{staticClass:"balance-deg"},[t._v("°")]),t._v(" "),i("numeric-input",{attrs:{value:t.m.angle,autofocus:!0,autosize:!0,wait:200,min:-360,max:360,dir:"v",speed:4,"shift-step":15},on:{change:t.onInputChange},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)}}}),t._v(" "),i("span",{staticClass:"deg"},[t._v("°")]),t._v(" "),i("span",{staticClass:"balance-minus"},[t._v("-")])],1),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("div",{staticClass:"flip-h",on:{click:t.flipHorizontal}}),t._v(" "),i("div",{staticClass:"flip-v",on:{click:t.flipVertical}}),t._v(" "),i("div",{staticClass:"rotate90",on:{click:t.onRotate90Click}})])}),[],!1,null,null,null).exports,J=i("gP9L"),Q=i("RLXn"),tt=i("uGDn"),et=i("XHB6"),it={components:{FontFamilySelector:J.a,FontStyleSelector:Q.a,RmSwitcher:tt.a,NumericInput:X.a,ColorPicker:et.a},mixins:[K],data:function(){return{shapes:["rectangle","circle","square"],states:["default","hover","current"],state:"default"}},computed:{maxBorderWidth:function(){return Math.ceil(Math.min(this.w,this.h)/2)}},watch:{state:function(t){Object(u.a)(".common-button",this.raw_block.$el).toggleClass("hovered","hover"===t),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("current","current"===t)}},destroyed:function(){this.setCorrectIconColor("default"),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("hovered",!1),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("current",!1)},mounted:function(){var t=this.m.clickLink;if(t&&this.m.is_global&&Object(u.a)(".controls .control.picture_link .placeholder-selector").hasClass("hidden"))if(/^http(s?)\:\/\//i.test(t)||/^mailto\:/i.test(t)||/^tel\:/i.test(t))this.states.pop();else{var e=t;RM.constructorRouter.mag.getPageUri(e)||this.states.pop()}else this.states.pop()},methods:{changeShapeHandler:function(t){this.m.form=t,this.closeOthersPopups(null)},changeStateHandler:function(t){this.state=t,this.closeOthersPopups(null),this.setCorrectIconColor(t)},changePropHandler:function(t,e){this.m[t]=e},setCorrectIconColor:function(t){this.raw_block.onIconColorChange(this.m,null,{},t)}}},nt=Object(W.a)(it,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"row shape-type"},t._l(t.shapes,(function(e){var n;return i("div",{key:e,class:(n={shape:!0},n[e]=!0,n.current=t.m.form===e,n),on:{click:function(i){return t.changeShapeHandler(e)}}})})),0),t._v(" "),i("div",{staticClass:"row state-switcher-wrapper"},t._l(t.states,(function(e){var n;return i("div",{key:e,class:(n={"state-switcher":!0},n["caption-"+e]=!0,n.current=e===t.state,n),on:{click:function(i){return t.changeStateHandler(e)}}},[t._v("\n      "+t._s(e)+"\n    ")])})),0),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["background-color"],alpha:t.m["background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-background-color"],alpha:t.m["hover-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-background-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-background-color"],alpha:t.m["current-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-background-color",e)},"update:alpha":function(e){return t.changePropHandler("current-background-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state&&"circle"!==t.m.form?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["border-radius"]<10,"two-digit":t.m["border-radius"]<100&&t.m["border-radius"]>9,"three-digit":t.m["border-radius"]>99},attrs:{autosize:!0,value:t.m["border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1):t._e(),t._v(" "),"current"===t.state&&"circle"!==t.m.form?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["current-border-radius"]<10,"two-digit":t.m["current-border-radius"]<100&&t.m["current-border-radius"]>9,"three-digit":t.m["current-border-radius"]>99},attrs:{autosize:!0,value:t.m["current-border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("current-border-radius",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["border-width"]<10,"two-digit":t.m["border-width"]<100&&t.m["border-width"]>9,"three-digit":t.m["border-width"]>99},attrs:{autosize:!0,value:t.m["border-width"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["hover-border-width"]<10,"two-digit":t.m["hover-border-width"]<100&&t.m["hover-border-width"]>9,"three-digit":t.m["hover-border-width"]>99},attrs:{autosize:!0,value:t.m["hover-border-width"]},on:{change:function(e){return t.changePropHandler("hover-border-width",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption input-correction"},[t._v("Border")]),t._v(" "),i("numeric-input",{class:{"num-input":!0,"one-digit":t.m["current-border-width"]<10,"two-digit":t.m["current-border-width"]<100&&t.m["current-border-width"]>9,"three-digit":t.m["current-border-width"]>99},attrs:{autosize:!0,value:t.m["current-border-width"],min:0,max:999},on:{change:function(e){return t.changePropHandler("current-border-width",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["border-color"],alpha:t.m["border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-border-color"],alpha:t.m["hover-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-border-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-border-color"],alpha:t.m["current-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-border-color",e)},"update:alpha":function(e){return t.changePropHandler("current-border-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row font-family-click-area",attrs:{title:"Font Family"}},[i("font-family-selector",{attrs:{family:t.m["font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row font-family-click-area",attrs:{title:"Font Family"}},[i("font-family-selector",{attrs:{family:t.m["current-font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("current-font-family",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row font-style-click-area",attrs:{title:"Font Style"}},[i("font-style-selector",{style:{"font-family":t.m["font-family"]},attrs:{"font-style":[t.m["font-style"]],"font-weight":[t.m["font-weight"]],"font-family":[t.m["font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row font-style-click-area",attrs:{title:"Font Style"}},[i("font-style-selector",{style:{"font-family":t.m["current-font-family"]},attrs:{"font-style":[t.m["current-font-style"]],"font-weight":[t.m["current-font-weight"]],"font-family":[t.m["current-font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("current-font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("current-font-weight",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.color,alpha:t.m["color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-color"],alpha:t.m["hover-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-color-opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-color"],alpha:t.m["current-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-color",e)},"update:alpha":function(e){return t.changePropHandler("current-color-opacity",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("icon_color",e)},"update:alpha":function(e){return t.changePropHandler("icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("hover-icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon Color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["current-icon_color"],alpha:t.m["current-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("current-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("current-icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"hover"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff"},model:{value:t.m.transition,callback:function(e){t.$set(t.m,"transition",e)},expression:"m['transition']"}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"font-size-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"font-size-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["current-font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("current-font-size",e)}}})],1):t._e(),t._v(" "),"default"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"letter-spacing-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1):t._e(),t._v(" "),"current"===t.state?i("div",{staticClass:"row"},[i("div",{staticClass:"letter-spacing-icon"}),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["current-letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("current-letter-spacing",e)}}})],1):t._e()])}),[],!1,null,null,null).exports,ot={props:{data:{type:Object}},data:function(){return{url:""}},ounted:function(){this.url=this.updateUrl()},methods:{updateUrl:function(){return"page"===this.data.use_own_url?"Using the page URL":"mag"===this.data.use_own_url?"Using the project URL":this.data.url},updateUrlData:function(t,e){this.data.url=t,this.data.use_own_url=e,this.url=this.updateUrl()}}},at=(i("F+PN"),Object(W.a)(ot,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"variant-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],staticClass:"input tweet-url",attrs:{readonly:!!t.data.use_own_url,placeholder:"URL"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),t._v(" "),t.data.use_own_url||t.data.url&&t.data.url===t.url?i("div",{staticClass:"input-control clear",on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","")}}}):t.data.use_own_url||t.data.url||t.url?t.url!==t.data.url?i("div",{staticClass:"input-control apply",on:{click:function(e){return e.stopPropagation(),t.updateUrlData(t.url,"")}}}):t._e():i("div",{staticClass:"input-control target"},[i("div",{staticClass:"use-url-popup"},[i("ul",[i("li",{on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","mag")}}},[t._v("Using the project URL")]),t._v(" "),i("li",{on:{click:function(e){return e.stopPropagation(),t.updateUrlData("","page")}}},[t._v("Using the page URL")])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"hover-zone"})])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"corner-wrapper"},[e("div",{staticClass:"corner"})])}],!1,null,null,null).exports),st={props:{value:{},options:{type:Array,default:function(){return[]}},arrowSize:{default:"small"},showTitles:{type:Boolean,default:!1},callback:{type:Function,default:function(){}}},data:function(){return{isOpened:!1}},computed:{caption:function(){return(o.a.findWhere(this.options,{value:this.value})||{}).caption}},methods:{onClick:function(t){this.isOpened=!this.isOpened},emitValue:function(t){t.disabled||(this.$emit("input",t.value),this.callback(t))}}},rt=(i("muOB"),Object(W.a)(st,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"selector",class:{opened:t.isOpened},on:{click:t.onClick}},[i("div",{staticClass:"types-popup"},t._l(t.options,(function(e){return i("div",{key:e.value,staticClass:"type-item",class:{curr:e.value===t.value,disabled:!!e.disabled},attrs:{title:t.showTitles?e.caption:""},on:{click:function(i){return t.emitValue(e)}}},[t._t("listitem",[t._v("\n        "+t._s(e.caption)+"\n        "),i("div",{staticClass:"point"})],{option:e,value:t.value})],2)})),0),t._v(" "),i("div",{staticClass:"caption"},[i("div",{staticClass:"caption-inner"},[t._v(t._s(t.caption))])]),t._v(" "),"small"===this.arrowSize?i("div",{staticClass:"popup-arrow"}):t._e(),t._v(" "),"big"===this.arrowSize?i("div",{staticClass:"popup-arrow-big"},[i("svg",{attrs:{width:"12",height:"7",xmlns:"http://www.w3.org/2000/svg"}},[i("path",{attrs:{d:"M5.24 6.114L1.416 1.651A1 1 0 0 1 2.175 0h7.65a1 1 0 0 1 .76 1.65L6.759 6.115a1 1 0 0 1-1.518 0z","fill-rule":"evenodd"}})])]):t._e()])}),[],!1,null,"473f91c6",null).exports),lt={props:{value:{type:String},prefix:{type:String,default:""}},data:function(){return{text:""}},mounted:function(){this.text=this.value}},ct=(i("/0Qt"),Object(W.a)(lt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"apply-input"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],staticClass:"input",class:{"no-prefix":!t.prefix},attrs:{placeholder:"Username"},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}}),t._v(" "),i("div",{staticClass:"input-prefix"},[t._v(t._s(t.prefix))]),t._v(" "),t.value!=t.text?i("div",{staticClass:"input-control apply",on:{click:function(e){return e.stopPropagation(),t.$emit("input",t.text)}}}):t.value?i("div",{staticClass:"input-control clear",on:{click:function(e){e.stopPropagation(),t.$emit("input",""),t.text=""}}}):t._e()])}),[],!1,null,null,null).exports),dt={mixins:[K],components:{RmVariantInput:at,RmSwitcher:tt.a,RmSelect:rt,RmApplyInput:ct}},ht=Object(W.a)(dt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Twitter")]),t._v(" "),i("rm-select",{attrs:{options:[{value:"type_timeline",caption:"User Timeline"},{value:"type_embed",caption:"Embed Tweet"},{value:"type_tweet",caption:"Tweet Button"},{value:"type_follow",caption:"Follow Button"},{value:"type_hashtag",caption:"Hashtag Button"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),"type_timeline"==t.m.current_type?i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.type_timeline.code,expression:"m.type_timeline.code"}],staticClass:"textarea",attrs:{placeholder:"Paste embed code here"},domProps:{value:t.m.type_timeline.code},on:{input:function(e){e.target.composing||t.$set(t.m.type_timeline,"code",e.target.value)}}}),t._v(" "),t._m(0)]):t._e(),t._v(" "),"type_embed"==t.m.current_type?i("div",[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.type_embed.code,expression:"m.type_embed.code"}],staticClass:"textarea",attrs:{placeholder:"Paste embed code here"},domProps:{value:t.m.type_embed.code},on:{input:function(e){e.target.composing||t.$set(t.m.type_embed,"code",e.target.value)}}}),t._v(" "),t._m(1)]):t._e(),t._v(" "),"type_tweet"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_tweet}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_tweet.large_button,callback:function(e){t.$set(t.m.type_tweet,"large_button",e)},expression:"m.type_tweet.large_button"}})],1)]):t._e(),t._v(" "),"type_follow"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{attrs:{prefix:"@"},model:{value:t.m.type_follow.username,callback:function(e){t.$set(t.m.type_follow,"username",e)},expression:"m.type_follow.username"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show name")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_follow.show_name,callback:function(e){t.$set(t.m.type_follow,"show_name",e)},expression:"m.type_follow.show_name"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_follow.large_button,callback:function(e){t.$set(t.m.type_follow,"large_button",e)},expression:"m.type_follow.large_button"}})],1)]):t._e(),t._v(" "),"type_hashtag"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{attrs:{prefix:"#"},model:{value:t.m.type_hashtag.hash,callback:function(e){t.$set(t.m.type_hashtag,"hash",e)},expression:"m.type_hashtag.hash"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Large button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#3366cc","color-off":"rgba(75, 75, 75, 0.4)"},model:{value:t.m.type_hashtag.large_button,callback:function(e){t.$set(t.m.type_hashtag,"large_button",e)},expression:"m.type_hashtag.large_button"}})],1)]):t._e()],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center"},[e("a",{staticClass:"embed-tutorial",attrs:{target:"_blank",href:"https://dev.twitter.com/docs/embedded-timelines"}},[this._v("How to embed Timeline")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center"},[e("a",{staticClass:"embed-tutorial",attrs:{target:"_blank",href:"https://dev.twitter.com/docs/embedded-tweets"}},[this._v("How to embed Tweet")])])}],!1,null,null,null).exports,ut=i("VZqm"),pt={mixins:[K],components:{RmVariantInput:at,RmSwitcher:tt.a,RmSpinner:ut.a,RmSelect:rt,RmApplyInput:ct,NumericInput:X.a}},gt=Object(W.a)(pt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Facebook")]),t._v(" "),i("rm-select",{attrs:{options:[{value:"type_like_button",caption:"Like Button"},{value:"type_page",caption:"Page"},{value:"type_comments",caption:"Comments"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),"type_like_button"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_like_button}})],1),t._v(" "),i("div",[i("rm-spinner",{attrs:{variants:[{value:"standard",title:"Standard Layout"},{value:"button_count",title:"Button Count"},{value:"box_count",title:"Box Count"}]},model:{value:t.m.type_like_button.layout,callback:function(e){t.$set(t.m.type_like_button,"layout",e)},expression:"m.type_like_button.layout"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Share Button")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_like_button.share_button,callback:function(e){t.$set(t.m.type_like_button,"share_button",e)},expression:"m.type_like_button.share_button"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Faces")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_like_button.show_faces,callback:function(e){t.$set(t.m.type_like_button,"show_faces",e)},expression:"m.type_like_button.show_faces"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_like_button.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_like_button.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_like_button.theme="dark"}}})])])]):t._e(),t._v(" "),"type_page"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-apply-input",{model:{value:t.m.type_page.url,callback:function(e){t.$set(t.m.type_page,"url",e)},expression:"m.type_page.url"}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Stream")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.show_stream,callback:function(e){t.$set(t.m.type_page,"show_stream",e)},expression:"m.type_page.show_stream"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Small Header")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.small_header,callback:function(e){t.$set(t.m.type_page,"small_header",e)},expression:"m.type_page.small_header"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Show Faces")]),t._v(" "),i("rm-switcher",{attrs:{"color-on":"#2d90ff","color-off":"#313131"},model:{value:t.m.type_page.show_faces,callback:function(e){t.$set(t.m.type_page,"show_faces",e)},expression:"m.type_page.show_faces"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_page.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_page.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_page.theme="dark"}}})])])]):t._e(),t._v(" "),"type_comments"==t.m.current_type?i("div",[i("div",{staticClass:"input-wrapper"},[i("rm-variant-input",{attrs:{data:t.m.type_comments}})],1),t._v(" "),i("div",{staticClass:"sep-line"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Number of posts")]),t._v(" "),i("numeric-input",{attrs:{autosize:!0,min:1,max:99},model:{value:t.m.type_comments.num_posts,callback:function(e){t.$set(t.m.type_comments,"num_posts",e)},expression:"m.type_comments.num_posts"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"theme-picker",class:t.m.type_comments.theme},[i("div",{staticClass:"theme light",on:{click:function(e){e.stopPropagation(),t.m.type_comments.theme="light"}}}),t._v(" "),i("div",{staticClass:"theme dark",on:{click:function(e){e.stopPropagation(),t.m.type_comments.theme="dark"}}})])])]):t._e()],1)}),[],!1,null,null,null).exports,mt={components:{RmSwitcher:tt.a,RmSelect:rt},mixins:[K],data:function(){return{m:{direction_route_type:"driving",custom_json:"",api_key:"",scrollwheel:!0},mapTypes:[{value:"standard",caption:"Standard"},{value:"directions",caption:"Directions"},{value:"custom",caption:"Custom map"}],directions:[{value:"driving",icon:"car"},{value:"transit",icon:"train"},{value:"walking",icon:"walk"},{value:"bicycling",icon:"bicycle"}],custom_json:"",api_key:"",is_json_invalid:!1}},mounted:function(){this.custom_json=this.m.custom_json,this.api_key=this.m.api_key},methods:{validateJSON:function(t){try{JSON.parse(t)}catch(t){return!1}return!0},validateApiKey:function(t){if(t)return 39===t.length},onRemove:function(){this.api_key="",this.m.api_key=""}},watch:{custom_json:o.a.debounce((function(t){!t||this.validateJSON(t)?(this.m.custom_json=t,this.is_json_invalid=!1):this.is_json_invalid=!0}),500),api_key:o.a.debounce((function(t){t&&!this.validateApiKey(t)||(this.m.api_key=t)}),500),"m.api_key":function(){this.api_key=this.m.api_key}}},ft=Object(W.a)(mt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"param-caption"},[t._v("Google Maps")]),t._v(" "),i("div",{staticClass:"param",attrs:{"data-param":"code"}},[t.m.api_key&&t.validateApiKey(t.m.api_key)?t._e():i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.api_key,expression:"api_key"}],staticClass:"input",class:[{error:t.api_key&&!t.validateApiKey(t.api_key)}],attrs:{placeholder:"API Key",minlength:"39",maxlength:"39",required:""},domProps:{value:t.api_key},on:{input:function(e){e.target.composing||(t.api_key=e.target.value)}}})]),t._v(" "),t.m.api_key&&t.validateApiKey(t.m.api_key)?i("div",{staticClass:"gmap-api-enabled"},[i("span",[t._v("API Key Enabled")]),t._v(" "),i("div",{ref:"remove",staticClass:"remove map-icon",attrs:{"data-alt":"Delete Google Maps API Key "+t.m.api_key,"data-alt-style":"controls-gmap-icon-tooltip"},on:{click:t.onRemove}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M12 10.586l4.536-4.536a1 1 0 0 1 1.414 1.414L13.414 12l4.536 4.536a1 1 0 0 1-1.414 1.414L12 13.414 7.464 17.95a1 1 0 0 1-1.414-1.414L10.586 12 6.05 7.464A1 1 0 0 1 7.464 6.05L12 10.586z","fill-rule":"nonzero"}})])])]),t._v(" "),i("a",{ref:"question-enabled",staticClass:"question map-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-gmap-icon-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]):t._e(),t._v(" "),t.m.api_key||t.api_key?t._e():i("a",{ref:"question-disabled",staticClass:"question map-icon",attrs:{href:"http://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-gmap-icon-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]),t._v(" "),i("rm-select",{staticClass:"map-type-select",class:[{"no-line":"directions"===t.m.current_type||"custom"===t.m.current_type}],attrs:{options:t.mapTypes,"arrow-size":"big"},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),i("div",{staticClass:"types-param"},["custom"==t.m.current_type?i("div",{staticClass:"type-param",attrs:{"data-type":"custom"}},[i("div",{staticClass:"param",attrs:{"data-param":"code"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.custom_json,expression:"custom_json"}],staticClass:"custom-json",class:{error:t.is_json_invalid,empty:!t.custom_json},attrs:{placeholder:"Paste JSON code",required:""},domProps:{value:t.custom_json},on:{input:function(e){e.target.composing||(t.custom_json=e.target.value)}}})]),t._v(" "),t._m(0)]):t._e(),t._v(" "),"directions"==t.m.current_type?i("div",{staticClass:"type-param",attrs:{"data-type":"directions"}},[i("div",{staticClass:"param",attrs:{"data-param":"route_type"}},[i("div",{staticClass:"route-switcher"},t._l(t.directions,(function(e,n){return i("div",{key:n,staticClass:"route-item",class:{active:t.m.direction_route_type===e.value},on:{click:function(i){t.m.direction_route_type=e.value}}},[i("div",{staticClass:"route-icon",class:[e.icon]})])})),0)])]):t._e()]),t._v(" "),i("div",{staticClass:"map-controls"},[i("div",{staticClass:"map-control"},[i("div",{staticClass:"caption"},[t._v("Controls")]),t._v(" "),i("rm-switcher",{staticClass:"controls-switcher",attrs:{"color-off":"#B8B8B8","color-on":"#0080FF",height:24,width:40},model:{value:t.m.show_controls,callback:function(e){t.$set(t.m,"show_controls",e)},expression:"m.show_controls"}})],1),t._v(" "),i("div",{staticClass:"map-control"},[i("div",{staticClass:"caption"},[t._v("Zoom on scroll")]),t._v(" "),i("rm-switcher",{staticClass:"controls-switcher",attrs:{"color-off":"#B8B8B8","color-on":"#0080FF",height:24,width:40},model:{value:t.m.scrollwheel,callback:function(e){t.$set(t.m,"scrollwheel",e)},expression:"m.scrollwheel"}})],1)])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"wizard-link"},[e("a",{attrs:{target:"_blank",href:"https://mapstyle.withgoogle.com/"}},[this._v("Launch Maps Wizard")])])}],!1,null,null,null).exports,vt=i("i7aS"),bt=i("TBxE"),_t=i("wrlV"),yt=i("CLR5"),wt={components:{NumericInput:X.a,ColorPicker:et.a,RmOpacityDrag:yt.a},mixins:[K],data:function(){return{searchText:"",uploading:!1,dragging:!1,opacityActive:!1,originalSizeInactive:!1,m:{border_size:0,border_color:"ffffff",border_radius:0,border_radius_tl:0,border_radius_tr:0,border_radius_bl:0,border_radius_br:0,border_radius_max:!1,border_radius_independent:!1,opacity:1}}},computed:{trimmedSearchText:function(){return u.a.trim(this.searchText)},hasPicture:function(){return z.default.nextTick(function(){this.$emit("resize")}.bind(this)),this.block.picture&&this.block.picture.url&&!this.uploading||vt.a.flagLambda()&&!this.uploading&&this.raw_block&&(this.raw_block.useLambdaUrl&&this.raw_block.useLambdaUrl()||this.raw_block.tempPicture)},opacityPercents:function(){return this.$refs.opacity.percent},hasVectorPicture:function(){return this.raw_block&&this.raw_block.isVector&&this.raw_block.isVector()}},mounted:function(){this.uploader=new bt.a(this),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("uploadFromUrl",this.uploadFromUrl),this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this),this.$watch("block.picture",(function(){var t=this.raw_block&&(this.raw_block.isVector()||this.raw_block.isAnimated());(vt.a.flagLambda()||this.block.picture&&this.block.picture.finalUrl||t&&this.block.picture.url)&&(this.uploading=!1,this.searchText="")})),this.$watch("raw_block.isLoading",(function(){this.uploading=this.raw_block.isLoading})),this.$emit("resize"),this.onScaleChange.__debounced=o.a.debounce(this.onScaleChange,100),this.raw_block.model.on("change",this.onScaleChange.__debounced),this.raw_block.on("modechanged",this.onScaleChange),this.onScaleChange()},beforeDestroy:function(){this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this),this.raw_block.model.off("change",this.onScaleChange.__debounced,this),this.raw_block.off("modechanged",this.onScaleChange)},methods:{uploadOrDelete:function(t){Object(u.a)(t.target).hasClass("uploadInput")||Object(u.a)(this.$refs.uploadInput).trigger("click","stop")},uploadFromSearch:function(t){var e=u.a.trim(this.searchText);e&&(this.isURL(e)?this.uploadFromUrl(e):RM.views.searchUnsplash&&RM.views.searchUnsplash.show(e,{upload:this.uploadFromUrl}))},uploadFromUrl:function(t){var e=this;this.uploading=!0,this.raw_block.showIconLoader(),this.raw_block.loadFromUrl(t,{success:function(){},error:function(){e.onFailUpload()},save:!1}),t&&vt.a.flagLambda()&&Object(_t.b)(t).then((function(i){if(e.uploading){var n={width:i.width,height:i.height,content:t};e.uploading=!1,e.raw_block.setTempPicture(n)}})).catch((function(t){}))},cancelUpload:function(){this.uploading=!1,vt.a.flagLambda()?this.raw_block.removeTempPicture():this.raw_block.removePicture()},searchFlickr:function(){RM.views.searchFlickr&&RM.views.searchFlickr.show("",{upload:this.uploadFromUrl})},searchUnsplash:function(){RM.views.searchUnsplash&&RM.views.searchUnsplash.show("",{upload:this.uploadFromUrl,preview:this.block.setPreviewImage})},onStartUpload:function(t,e){var i=this;if(this.raw_block.showTempPreloader&&this.raw_block.showTempPreloader(),this.uploading=!0,vt.a.flagLambda()){var n=t.target&&t.target.files.length&&t.target.files[0];n&&Object(_t.a)(n).then((function(t){i.uploading&&(i.uploading=!1,i.raw_block.setTempPicture(t))})).catch((function(t){}))}},onDoneUpload:function(t,e){e&&e.result?this.raw_block.changePicture(e.result):this.onFailUpload()},onFailUpload:function(){this.uploading=!1,this.searchText="",vt.a.flagLambda()&&this.raw_block.removeTempPicture()},highlightDropZone:function(t){var e=this;this.dragging=!0,Object(u.a)(this.$el).find(t.target).length&&this.raw_block.$el.removeClass(".replace"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.dragging=!1}),500)},updateColor:function(t){this.m.border_color=t},showPercents:function(t){this.opacityActive=t},toggleBorderRadiusMax:function(){this.m.border_radius_max=!this.m.border_radius_max},toggleBorderRadiusIndependent:function(){this.m.border_radius_independent=!this.m.border_radius_independent,this.m.border_radius_max=!1},onBorderRadiusChange:function(){this.m.border_radius_max=!1,this.m.border_radius_independent=!1},onBorderRadiusIndependentChange:function(){this.m.border_radius_max=!1},setOriginalSize:function(){this.saving||!this.raw_block.$picture||this.originalSizeInactive||(this.raw_block.cropmode&&this.raw_block.leaveCropMode(!0),this.saving=!0,this.raw_block.model.once("sync",(function(){delete this.saving}),this),this.raw_block.setActualScale(),RM.analytics&&RM.analytics.sendEvent("Picture Scale","actual size"))},onScaleChange:function(){var t=0===this.raw_block.model.get("cropX")&&0===this.raw_block.model.get("cropY")&&this.raw_block.model.get("cropW")===this.raw_block.model.get("originalW")&&this.raw_block.model.get("cropH")===this.raw_block.model.get("originalH");this.originalSizeInactive=Math.abs(this.raw_block.model.get("scale")-1)<.01&&t||this.raw_block.isFullWidth&&this.raw_block.isFullWidth()||this.raw_block.isFullHeight&&this.raw_block.isFullHeight()||this.raw_block.isVector&&this.raw_block.isVector()},isURL:y.default.filters.isURL,flagLambda:vt.a.flagLambda}},kt=(i("djzF"),Object(W.a)(wt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel picture-settings",class:{uploading:t.uploading,dragging:t.dragging,"has-picture":t.hasPicture,"has-extended-settings":!t.hasVectorPicture}},[i("div",{staticClass:"param-caption"},[t._v("Picture")]),t._v(" "),i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:t.uploadOrDelete}},[i("div",{staticClass:"icon"}),t._v(" "),i("div",{staticClass:"caption-upload-dop"},[t._v(t._s(t.dragging?"drop here":"drop file here"))])])]),t._v(" "),i("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":t.flagLambda()?"/api/upload/lambda/":"/api/upload/"}}),t._v(" "),i("div",{staticClass:"social"},[i("div",{staticClass:"search"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchText,expression:"searchText"}],class:{"has-icon":""!=t.searchText},attrs:{type:"text",spellcheck:"false",placeholder:"Search or paste URL"},domProps:{value:t.searchText},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.uploadFromSearch(e)},input:function(e){e.target.composing||(t.searchText=e.target.value)}}}),t._v(" "),i("div",{staticClass:"icon",class:{hidden:!t.trimmedSearchText,"upload-icon":t.isURL(t.trimmedSearchText)},on:{click:t.uploadFromSearch}})]),t._v(" "),i("div",{staticClass:"search-icons"},[i("div",{staticClass:"flickr",attrs:{title:"Flickr"},on:{click:t.searchFlickr}}),t._v(" "),i("div",{staticClass:"unsplash",attrs:{title:"Unsplash"},on:{click:t.searchUnsplash}})]),t._v(" "),i("div",{staticClass:"separator"})])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"loading"},[i("div",{staticClass:"delete",on:{click:t.cancelUpload}})]),t._v(" "),i("div",{staticClass:"settings"},[i("div",{staticClass:"param param-component"},[i("div",{staticClass:"param-caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.m.border_size,callback:function(e){t.$set(t.m,"border_size",e)},expression:"m.border_size"}}),t._v(" "),i("div",{staticClass:"border-color",attrs:{title:"Color"}},[i("color-picker",{ref:"colorpicker",staticClass:"color round",attrs:{color:t.m.border_color,"show-alpha":!1,"show-arrow-icon":!0},on:{"update:color":t.updateColor}})],1),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"param param-component"},[i("div",{staticClass:"param-caption"},[t._v("Radius")]),t._v(" "),i("div",{staticClass:"border-radius-independent",class:{active:t.m.border_radius_independent},attrs:{title:"Independent corners"},on:{click:t.toggleBorderRadiusIndependent}}),t._v(" "),t.m.border_radius_independent?i("div",[i("div",{staticClass:"border-radius-independent-params"},[i("numeric-input",{staticClass:"numeric-input",attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusIndependentChange},model:{value:t.m.border_radius_tl,callback:function(e){t.$set(t.m,"border_radius_tl",e)},expression:"m.border_radius_tl"}}),t._v(" "),i("numeric-input",{staticClass:"numeric-input",attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusIndependentChange},model:{value:t.m.border_radius_tr,callback:function(e){t.$set(t.m,"border_radius_tr",e)},expression:"m.border_radius_tr"}})],1),t._v(" "),i("div",{staticClass:"border-radius-independent-params"},[i("numeric-input",{staticClass:"numeric-input",attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusIndependentChange},model:{value:t.m.border_radius_br,callback:function(e){t.$set(t.m,"border_radius_br",e)},expression:"m.border_radius_br"}}),t._v(" "),i("numeric-input",{staticClass:"numeric-input",attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusIndependentChange},model:{value:t.m.border_radius_bl,callback:function(e){t.$set(t.m,"border_radius_bl",e)},expression:"m.border_radius_bl"}})],1)]):t._e(),t._v(" "),t.m.border_radius_independent?t._e():i("div",[i("numeric-input",{class:{inactive:t.m.border_radius_max},attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},on:{change:t.onBorderRadiusChange},model:{value:t.m.border_radius,callback:function(e){t.$set(t.m,"border_radius",e)},expression:"m.border_radius"}}),t._v(" "),i("div",{staticClass:"border-radius-max",class:{active:t.m.border_radius_max},attrs:{title:"Radius: 100%"},on:{click:t.toggleBorderRadiusMax}})],1),t._v(" "),i("div",{staticClass:"separator"})]),t._v(" "),i("div",{staticClass:"param-component opacity"},[i("transition",{attrs:{name:"fade"}},[t.opacityActive?t._e():i("div",{key:"title",staticClass:"param-caption"},[t._v("Opacity")]),t._v(" "),t.opacityActive?i("div",{key:"percent",staticClass:"percent param-caption"},[t._v(t._s(t.opacityPercents))]):t._e()]),t._v(" "),i("rm-opacity-drag",{ref:"opacity",on:{"opacity-active":t.showPercents},model:{value:t.m.opacity,callback:function(e){t.$set(t.m,"opacity",e)},expression:"m.opacity"}})],1),t._v(" "),t.hasVectorPicture?t._e():i("div",{staticClass:"param-component original-size"},[i("div",{staticClass:"separator"}),t._v(" "),i("div",{staticClass:"original-size-btn",class:{inactive:t.originalSizeInactive},on:{click:t.setOriginalSize}},[t._v("\n        Original size\n      ")])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"picture_preloader rmpreloader"},[e("div",{staticClass:"shadow"}),this._v(" "),e("div",{staticClass:"arc"})])}],!1,null,"1b6b0750",null).exports),St=i("tZHv"),xt={methods:{getAudioFromUrl:function(t){var e;if(/soundcloud\.com\/.+/.test(t)||/snd\.sc\/.+/.test(t)){var i=t.replace(/\/?#?$/,""),n={url:i};e="http://soundcloud.com/oembed?format=json&url="+encodeURIComponent(i),this.audioEmbedXHR&&this.audioEmbedXHR.abort(),this.audioEmbedXHR=u.a.ajax({type:"GET",url:"/api/proxy/",dataType:"json",data:{url:e},global:!1,success:o.a.bind((function(t){t.parsed_url=this.parseUrl(t.html),t.thumbnail_url=t.thumbnail_url.replace("-large","-t300x300"),t.thumbnail_url=t.thumbnail_url.replace("-t500x500","-t300x300"),t.parsed_url?this.loadTracksData(o.a.extend(t,n),[{url:i}]):this.$emit("audioEmbedError")}),this),error:o.a.bind((function(t,e,i){"abort"!==e&&this.$emit("audioEmbedError")}),this)}),this.$emit("audioDataObtained",n)}else this.$emit("audioWrongUrl")},parseUrl:function(t){var e=t.match(/.*?src=\"(.*?)\".*?/);if(e&&e.length&&e[1]){var i=e[1].split("?"),n=i[0],a=i[1].split("&"),s=["auto_play","buying","liking","download","sharing","show_artwork","show_comments","show_playcount","color","auto_advance","show_user","visual"],r=[];return o.a.each(a,(function(t){var e=t.split("=");e[0]&&!o.a.contains(s,e[0])&&r.push(t)})),n+"?"+r.join("&")}},isURL:function(t){return/^http(s?)\:\/\//i.test(t)},scApiUrl:function(t){var e=t,i="https:"===document.location.protocol,n=(i||/^https/i.test(e)?"https":"http")+"://api.soundcloud.com/resolve?url=",o="format=json&client_id="+this.apiKey;return i&&(e=e.replace(/^http:/,"https:")),/api\./.test(e)?e+"?"+o:n+e+"&"+o},loadTracksData:function(t,e){var i=0,n={tracks:[]},o=this;if(this.apiKey){!function a(s){var r=o.scApiUrl(s.url);u.a.ajax({url:r,method:"GET",dataType:"json",success:function(r){i+=1,r.tracks?n.tracks=n.tracks.concat(r.tracks):r.duration?(r.permalink_url=s.url,n.tracks.push(r)):r.creator?e.push({url:r.uri+"/tracks"}):r.username?/favorites/.test(s.url)?e.push({url:r.uri+"/favorites"}):e.push({url:r.uri+"/tracks"}):u.a.isArray(r)&&(n.tracks=n.tracks.concat(r)),e[i]?a(e[i]):o.tracksDataIsLoaded(t,n.tracks)},error:function(t){o.$emit("audioEmbedError"),console.log("xhr : ",t)},context:this})}(e[i])}else this.$emit("audioEmbedError","No SoundCloud API key configured.")},tracksDataIsLoaded:function(t,e){e.length?((/tracks/i.test(t.parsed_url)||t.thumbnail_url&&/fb_placeholder/.test(t.thumbnail_url))&&(e[0].artwork_url?t.thumbnail_url=e[0].artwork_url.replace("-large","-t300x300"):e[0].user&&e[0].user.avatar_url&&(t.thumbnail_url=e[0].user.avatar_url.replace("-large","-t300x300")),t.title=e[0].title),t.thumbnail_url&&y.default.toHttps(t.thumbnail_url),this.$emit("audioEmbedLoaded",t)):this.$emit("audioEmbedError")}}},Ct=Object(W.a)(xt,void 0,void 0,!1,null,null,null).exports,Ot={components:{RmSwitcher:tt.a,RmSpinner:ut.a,ColorPicker:et.a},mixins:[K,Ct],data:function(){return{state:"default",errorMessage:"",apiKey:St.a.SOUNDCLOUD_API,search:this.url,playerVar:["visual","standard","minimal"],playerTitle:["Visual Player","Original Player","Minimal"]}},computed:{isUrl:function(){return this.isURL(this.search)},currInd:function(){var t=this.playerVar.indexOf(this.m.current_type);return t<0?0:t}},mounted:function(){this.$on("audioWrongUrl",this.onAudioWrongUrl),this.$on("audioEmbedError",this.onAudioEmbedError),this.$on("audioEmbedLoaded",this.onAudioEmbedLoaded),this.$on("audioDataObtained",this.onAudioDataObtained),this.search=this.m.url},methods:{spinType:function(t){this.m.current_type=this.playerVar[(this.currInd+t)%3]},loadAudio:function(){this.getAudioFromUrl(this.search)},resetAudio:function(){var t={url:"",parsed_url:"",thumbnail_url:"",title:"",embed_height:void 0,resized:!1};this.search="",this.$parent.$emit("change",t),this.errorMessage=""},onAudioWrongUrl:function(){console.log("onAudioWrongUrl",arguments)},onAudioEmbedError:function(){console.log("onAudioEmbedError",arguments),this.errorMessage="Can't add track due to it's privacy settings. Try change the sharing settings of your track"},onAudioEmbedLoaded:function(t){if(t.thumbnail_url){var e=o.a.pick(t,"url","thumbnail_url","title","parsed_url","height");e.embed_height=e.height,e.height=void 0,e.resized=!1,this.$parent.$emit("change",e),this.errorMessage=""}else this.onAudioEmbedError()},onAudioDataObtained:function(){console.log("onAudioDataObtained",arguments),this.errorMessage=""}}},Pt=Object(W.a)(Ot,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel"},[i("div",{staticClass:"panel-title"},[t._v("Audio")]),t._v(" "),t.m.url?t._e():i("a",{staticClass:"soundcloud-logo",attrs:{href:"https://soundcloud.com/",target:"_blank"}}),t._v(" "),i("div",{staticClass:"search"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"search-input",class:{"with-icon":t.isUrl&&!t.m.url||t.m.url},attrs:{placeholder:"Paste URL"},domProps:{value:t.search},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadAudio(e)},input:function(e){e.target.composing||(t.search=e.target.value)}}}),t._v(" "),t.isUrl&&!t.m.url?i("div",{staticClass:"sicon apply-btn",on:{click:function(e){return e.stopPropagation(),t.loadAudio(e)}}}):t._e(),t._v(" "),t.m.url?i("div",{staticClass:"sicon remove-btn",on:{click:function(e){return e.stopPropagation(),t.resetAudio(e)}}}):t._e()]),t._v(" "),t.m.url?i("a",{staticClass:"soundcloud-logo-small",attrs:{href:"https://soundcloud.com/",target:"_blank"}}):t._e(),t._v(" "),t.errorMessage?i("div",{staticClass:"error-message"},[t._v(t._s(t.errorMessage))]):t._e(),t._v(" "),t.m.url?i("div",{staticClass:"settings"},[i("div",{staticClass:"description"},[t._v(t._s(t.m.title))]),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("rm-spinner",{attrs:{variants:[{value:"visual",title:"Visual Player"},{value:"standard",title:"Original Player"},{value:"minimal",title:"Minimal"}]},model:{value:t.m.current_type,callback:function(e){t.$set(t.m,"current_type",e)},expression:"m.current_type"}}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Comments")]),t._v(" "),i("rm-switcher",{model:{value:t.m.comments,callback:function(e){t.$set(t.m,"comments",e)},expression:"m.comments"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Artwork")]),t._v(" "),i("rm-switcher",{model:{value:t.m.artwork,callback:function(e){t.$set(t.m,"artwork",e)},expression:"m.artwork"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Social")]),t._v(" "),i("rm-switcher",{model:{value:t.m.socials,callback:function(e){t.$set(t.m,"socials",e)},expression:"m.socials"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Color")]),t._v(" "),i("color-picker",{attrs:{color:t.m.color,"show-alpha":!1},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.m.color=e}}})],1)],1):t._e()])}),[],!1,null,null,null).exports,jt=i("Vxjr");function $t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Tt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var It=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Tt(this,"prevSVGSearch",{}),Tt(this,"defaultIcons",[{rm_id:"rm0",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/00-star.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/01-bolt.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/02-bubble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/03-camera.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/04-cloud.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/05-download1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/06-download2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/07-globe2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/08-globe.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/09-pin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/10-share1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/11-share2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/12-send.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/13-checkmark.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/14-x.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/15-minus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/16-plus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/17-mail1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/18-mail2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/19-user.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/20-clock.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/21-embed.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/22-flag.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/23-heart.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/24-itunes.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/25-like.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/26-music.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/27-play.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/28-video.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/29-facebook.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/30-twitter.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/31-linkedin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/32-pinterest.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/33-instagram.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/34-googleplus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/35-tumblr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/36-youtube.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/37-vimeo.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/38-flickr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/39-blogger.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/40-dribbble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/41-behance.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/42-rss.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/43-at.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/shape/default-collection/43-at.svg")}])}var e,i,n;return e=t,(i=[{key:"fetchIconsPage",value:function(t){var e;if(!t||this.searchInProgress)return Promise.resolve();var i=this.prevSVGSearch.nextPage||0;return this.prevSVGSearch.query!==t&&(i=0,this.prevSVGSearch.icons=[]),e="/icons/"+t+"?page="+i,new Promise(function(n,o){this.requestIcons(e,function(e,o){return e?(delete this.prevSVGSearch.nextPage,n(this.prevSVGSearch.icons)):(this.prevSVGSearch.icons=this.prevSVGSearch.icons.concat(o.icons),this.prevSVGSearch.query=t,this.prevSVGSearch.nextPage=i+1,n(this.prevSVGSearch.icons))}.bind(this))}.bind(this))}},{key:"requestIcons",value:function(t,e){this.destroyed||(this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.searchXhr=u.a.ajax({method:"GET",url:"/api/authservice/noun?uri="+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1},context:this}))}},{key:"clearSearch",value:function(){this.prevSVGSearch={},this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1}},{key:"findIcon",value:function(t){return t.rm_id?o.a.findWhere(this.defaultIcons,t):o.a.findWhere(this.prevSVGSearch.icons,{id:t.noun_id})}},{key:"destroy",value:function(){this.clearSearch(),this.destroyed=!0}}])&&$t(e.prototype,i),n&&$t(e,n),t}();function Et(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var Mt,Rt,At={components:{RmScroll:i("0DSZ").a},props:{rawBlock:Object,placeholder:{type:String,default:"Search"}},data:function(){var t=new It;return{iconsutils:t,icons:t.prevSVGSearch.icons||t.defaultIcons,searchString:t.prevSVGSearch.query,currentSearchString:t.prevSVGSearch.query,isSearch:!!t.prevSVGSearch.query,iconsListLoading:!1,iconLoading:null,iconSelected:!1,savedScrollPosition:t.prevSVGSearch.savedScrollPosition||0}},watch:{"block.tp":{handler:function(){z.default.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.iconSelected=this.iconsutils.findIcon(o.a.pick(this.block,"noun_id","rm_id")),this._scroll=this.$refs.rmscroll},beforeDestroy:function(){this.iconsutils&&this.iconsutils.destroy()},methods:{onLoupeClick:function(t){this.isSearch?this.clearSearch():this.doSearch()},doSearch:function(){this.searchString&&this.currentSearchString!==this.searchString&&!this.iconsutils.searchInProgress&&(this.savedScrollPosition=0,this.currentSearchString=this.searchString,this.icons=[],delete window.prevSVGSearch,this.isSearch=!0,this.fetchIcons())},clearSearch:function(){this.savedScrollPosition=0,this.isSearch=!1,this.searchString="",this.currentSearchString="",this.icons=this.iconsutils.defaultIcons,this.iconsutils.clearSearch()},onPanelScroll:function(t){this.iconsutils.prevSVGSearch.savedScrollPosition=t.scroll_pos,this.savedScrollPosition=t.scroll_pos,t.content_size-t.container_size-t.scroll_pos<32&&this.iconsutils.prevSVGSearch.nextPage&&!this.iconsutils.searchInProgress&&this.fetchIcons()},fetchIcons:(Mt=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.iconsListLoading=!0,t.next=3,this.iconsutils.fetchIconsPage(this.searchString);case 3:this.icons=t.sent,this.iconsListLoading=!1,this._scroll.recalcScroll();case 6:case"end":return t.stop()}}),t,this)})),Rt=function(){var t=this,e=arguments;return new Promise((function(i,n){var o=Mt.apply(t,e);function a(t){Et(o,i,n,a,s,"next",t)}function s(t){Et(o,i,n,a,s,"throw",t)}a(void 0)}))},function(){return Rt.apply(this,arguments)}),onIconItemClick:function(t){this.iconLoading||(this.$emit("dataObtained",t),this.iconLoading=!1)}}},Dt=(i("UMxc"),Object(W.a)(At,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icons"},[i("div",{staticClass:"search-block"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchString,expression:"searchString"}],staticClass:"search",attrs:{type:"text",placeholder:t.placeholder,rawBlock:t.rawBlock},domProps:{value:t.searchString},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.doSearch(e)},input:function(e){e.target.composing||(t.searchString=e.target.value)}}}),t._v(" "),i("div",{staticClass:"loupe",class:{clear:t.isSearch,preloading:t.iconsListLoading},on:{click:t.onLoupeClick}},[t._m(0)])]),t._v(" "),i("div",{staticClass:"separator"}),t._v(" "),i("div",{staticClass:"common-wrapper"},[i("rm-scroll",{ref:"rmscroll",attrs:{"on-panel-scroll":t.onPanelScroll,"scroll-gap-start":8,"scroll-gap-end":8,"saved-scroll-position":t.savedScrollPosition}},t._l(t.icons||[],(function(e){return i("div",{key:e.id,staticClass:"icon-item",class:{preloading:t.iconLoading==e,selected:t.iconSelected==e},on:{click:function(i){return t.onIconItemClick(e)}}},[i("div",{staticClass:"noun-icon",style:{"background-image":"url('"+e.preview_url_42+"')"},attrs:{"data-id":e.id,"data-rm_id":e.rm_id,"data-url":e.icon_url}}),t._v(" "),t.iconLoading==e?i("div",{staticClass:"rmpreloader"},[i("div",{staticClass:"arc"})]):t._e()])})),0)],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"rmpreloader hidden"},[e("div",{staticClass:"arc"})])}],!1,null,"52714dcb",null).exports),zt={components:{NumericInput:X.a,ColorPicker:et.a,ShapeSearch:Dt},mixins:[K],data:function(){var t=new It;return{iconsutils:t,stroke_popup_visible:!1,icons:t.prevSVGSearch.icons||t.defaultIcons}},watch:{"block.tp":{handler:function(){z.default.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.iconSelected=this.iconsutils.findIcon(o.a.pick(this.block,"noun_id","rm_id"))},beforeDestroy:function(){this.iconsutils&&this.iconsutils.destroy()},methods:{selectShape:function(t){this.block.tp=t,"icon"!==t?this.abortRequests():this.updateShapeSearchScroll()},updateShapeSearchScroll:function(){this.$refs.shapeSearch.$refs.rmscroll.recalcScroll()},onInputChange:function(t,e){this.block[t]=e},updateColor:function(t){this.block.color=t.color,this.block.opacity=t.alpha},closeOtherPopups:function(){this.$refs.colorpicker.hide(),this.stroke_popup_visible=!1},toggleStrokePopup:function(t){Object(u.a)(t.target).closest(".stroke-selector .stroke-popup").length>0||(this.stroke_popup_visible=!this.stroke_popup_visible)},selectStroke:function(t){this.block.stroke=t,this.stroke_popup_visible=!1},onDataObtained:function(t){var e=this;this.raw_block.getIconSVG(t.id||t.rm_id,t.icon_url,{noCache:!0},(function(i){if(!i){var n={noun_url:t.icon_url};t.id?o.a.extend(n,{noun_id:t.id,rm_id:null}):t.rm_id&&o.a.extend(n,{noun_id:null,rm_id:t.rm_id}),e.raw_block.model.set(n)}}))},abortRequests:function(){this.iconsutils.clearSearch()}}},Lt=(i("MyX/"),Object(W.a)(zt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel resizable",class:{"overflow-visible":t.stroke_popup_visible},attrs:{"data-current-type":t.block.tp},on:{click:t.closeOtherPopups}},[i("div",{staticClass:"param-caption"},[t._v("Shape")]),t._v(" "),i("div",{staticClass:"selector",attrs:{"data-current-type":t.block.tp}},[t._l(["rectangle","polygon","ellipse","line","icon"],(function(e){return i("div",{key:e,staticClass:"shape",attrs:{"data-type":e},on:{click:function(i){return t.selectShape(e)}}})})),t._v(" "),i("div",{staticClass:"separator"})],2),t._v(" "),i("div",{staticClass:"details"},[i("div",{staticClass:"weight param-component"},[i("div",{staticClass:"param-caption"},[t._v("Weight")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:1,max:999,dir:"v",speed:5},model:{value:t.block.weight,callback:function(e){t.$set(t.block,"weight",e)},expression:"block.weight"}}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"sides param-component"},[i("div",{staticClass:"param-caption"},[t._v("Sides")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:3,max:30,dir:"v",speed:10},model:{value:t.block.sides,callback:function(e){t.$set(t.block,"sides",e)},expression:"block.sides"}}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"borders param-component"},[i("div",{staticClass:"param-caption name-border"},[t._v(t._s("ellipse"==t.block.tp?"Border":"Borders"))]),t._v(" "),i("numeric-input",{style:{width:"66px"},attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.borders,callback:function(e){t.$set(t.block,"borders",e)},expression:"block.borders"}}),t._v(" "),i("div",{staticClass:"border-color",attrs:{title:"Color"}},[i("color-picker",{ref:"colorpicker",staticClass:"color round",attrs:{color:t.block.color,alpha:t.block.opacity,"opacity-multiplier":100,"v-offset":8,"show-alpha":!0,"show-arrow-icon":!0},on:{"update:all":t.updateColor}})],1),t._v(" "),i("div",{staticClass:"colorbox_container"}),t._v(" "),i("div",{staticClass:"separator"})],1),t._v(" "),i("div",{staticClass:"radius param-component"},[i("div",{staticClass:"param-caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{attrs:{autofocus:!0,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.radius,callback:function(e){t.$set(t.block,"radius",e)},expression:"block.radius"}})],1),t._v(" "),i("div",{staticClass:"stroke param-component"},[i("div",{staticClass:"param-caption"},[t._v("Stroke")]),t._v(" "),i("div",{staticClass:"stroke-selector",class:{opened:t.stroke_popup_visible},attrs:{"data-current-type":t.block.stroke},on:{click:function(e){return e.stopPropagation(),t.toggleStrokePopup(e)}}},[i("div",{staticClass:"stroke-popup"},t._l(["solid","double","dotted","dashed"],(function(e){return i("div",{key:e,staticClass:"stroke-item",attrs:{"data-type":e},on:{click:function(i){return t.selectStroke(e)}}},[i("div",{staticClass:"preview"}),t._v(" "),i("div",{staticClass:"point"})])})),0),t._v(" "),i("div",{staticClass:"current"}),t._v(" "),i("div",{staticClass:"popup-arrow"})])])]),t._v(" "),i("shape-search",{ref:"shapeSearch",on:{dataObtained:t.onDataObtained}})],1)}),[],!1,null,"30763dfc",null).exports),Bt={components:{RmSwitcher:tt.a,ColorPicker:et.a,ShapeSearch:Dt,NumericInput:X.a},mixins:[K],data:function(){var t=new It;return{iconsutils:t,uploading:!1,dragging:!1,activeNounArrow:"left",icons:t.prevSVGSearch.icons||t.defaultIcons,m:{pictures:[]}}},computed:{hasPictures:function(){return!o.a.isEmpty(this.m.pictures)},compoundProperty:function(){return[this.raw_block.queue,this.block.theme_data.captions].join()}},watch:{compoundProperty:{handler:function(){z.default.nextTick(function(){this.$emit("resize")}.bind(this))},immediate:!0}},mounted:function(){this.uploader=this.raw_block.uploader,this.uploader.on("start",this.showPreloader),this.uploader.on("done fail",this.checkFinishUpload),this.raw_block.settingsPanel=this,this.raw_block.updateDropZone(),this.raw_block.colorbox_visible=!1,this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this)},beforeDestroy:function(){this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this),this.iconsutils&&this.iconsutils.destroy()},methods:{upload:function(t){this.raw_block.$(".uploadInput").trigger("click","stop")},closePopups:function(t){o.a.each(this.$children,(function(e){e!==t&&(e.visibleBox=!1)}))},onShowPopup:function(t){this.closePopups(t),this.raw_block.colorbox_visible=!0},onUpdateColor:function(t){this.block.theme_data.controls_color=t,this.raw_block.needRasterize=!0},updateShapeSearchScroll:function(){this.$refs.shapeSearch.$refs.rmscroll.recalcScroll()},getCapitalizedName:function(t){return y.default.capitalize(t)},onCountersTypeClick:function(t){if(Object(u.a)(t.target).hasClass("dots")){if(Object(u.a)(t.target).hasClass("disabled"))return void t.preventDefault();this.block.theme_data.counters_type="dots"}else this.block.theme_data.counters_type="numbers"},onCrossfadeValueChange:function(t){this.block.theme_data.autoplay_delay<t&&(this.block.theme_data.autoplay_delay=t)},onThumbnailsChange:function(t){t&&(this.block.theme_data.counters_type="numbers",this.block.theme_data.captions=!1)},onCaptionsChange:function(t){this.raw_block.trigger("captions_changed",t),t&&(this.block.theme_data.thumbnails=!1)},onArrowsTypeChange:function(t){"library"!==t&&"noun"!==t||this.updateShapeSearchScroll(),this.block.theme_data.arrows_type=t,this.block.current_mode=t,this.raw_block.trigger("arrow_type_changed")},onDataObtained:function(t){var e=this,i="left"===this.activeNounArrow?"left_arrow_noun":"right_arrow_noun";this.raw_block.getIconSVG(t.id||t.rm_id,t.icon_url,i,(function(i,n){var a;e.raw_block.needRasterize=!0,i||(a={noun_url:t.icon_url},t.id?o.a.extend(a,{noun_id:t.id,rm_id:null}):t.rm_id&&o.a.extend(a,{noun_id:null,rm_id:t.rm_id}),"left"===e.activeNounArrow?e.block.theme_data.left_icon_noun=a:e.block.theme_data.right_icon_noun=a)}))},canUpload:function(){return!this.hasPictures&&!this.uploading},checkFinishUpload:function(){o.a.isEmpty(this.raw_block.queue)&&(this.uploading=!1)},highlightDropZone:function(t){var e=this;this.dragging=!0,clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.dragging=!1}),500)},showPreloader:function(){this.uploading=!0},cancelUpload:function(){this.uploading=!1,this.raw_block.removePictures()}}},Ft=(i("+7zK"),Object(W.a)(Bt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel slideshow-panel resizable",class:{noun:"library"===t.block.current_mode||"noun"===t.block.current_mode,"has-upload-images":t.hasPictures,uploading:t.uploading&&!t.hasPictures,dragging:t.dragging},on:{click:t.closePopups}},[i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:function(e){return t.upload(e)}}},[i("div",{staticClass:"icon"}),t._v(" "),i("div",{staticClass:"caption-upload-dop"},[t._v(t._s(t.dragging?"drop here":"drop file here"))])])])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"loading"},[i("div",{staticClass:"delete",on:{click:t.cancelUpload}})]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"default"===t.block.current_mode,expression:"block.current_mode === 'default'"}],staticClass:"settings"},[i("div",{staticClass:"colorbox_container"}),t._v(" "),i("div",{staticClass:"params",attrs:{"data-current-theme":t.block.current_theme}},[i("div",{staticClass:"param param-arrows solid-separator",class:{invisible:t.block.theme_data.arrows}},[i("div",{staticClass:"caption"},[t._v("Arrows")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.arrows,callback:function(e){t.$set(t.block.theme_data,"arrows",e)},expression:"block.theme_data.arrows"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows,expression:"block.theme_data.arrows"}],staticClass:"param param-arrows-type"},t._l(["default","library"],(function(e){var n;return i("div",{key:e,staticClass:"arrows-type",class:(n={active:t.block.theme_data.arrows_type===e},n[e]=!0,n),on:{click:function(i){return t.onArrowsTypeChange(e)}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows,expression:"block.theme_data.arrows"}],staticClass:"param param-arrows-view-mode solid-separator",class:{invisible:"normal"===t.block.theme_data.arrows_view_mode}},t._l(["normal","mouseover"],(function(e){var n;return i("div",{key:e,staticClass:"arrows-view-mode",class:(n={active:t.block.theme_data.arrows_view_mode===e},n[e]=!0,n),on:{click:function(i){t.block.theme_data.arrows_view_mode=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.arrows&&"normal"===t.block.theme_data.arrows_view_mode,expression:"block.theme_data.arrows && block.theme_data.arrows_view_mode === 'normal'"}],staticClass:"param param-arrows-position solid-separator"},t._l(["sides","bottom"],(function(e){var n;return i("div",{key:e,staticClass:"arrows-position",class:(n={active:t.block.theme_data.arrows_position===e},n[e]=!0,n),on:{click:function(i){t.block.theme_data.arrows_position=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"param param-counters solid-separator",class:{invisible:t.block.theme_data.counters}},[i("div",{staticClass:"caption"},[t._v("Counter")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.counters,callback:function(e){t.$set(t.block.theme_data,"counters",e)},expression:"block.theme_data.counters"}})],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.counters,expression:"block.theme_data.counters"}],staticClass:"param param-counters-type solid-separator",class:{invisible:"numbers"!==t.block.theme_data.counters_type}},t._l(["numbers","dots"],(function(e){var n;return i("div",{key:e,staticClass:"counters-type",class:(n={active:t.block.theme_data.counters_type===e,disabled:"dots"===e&&t.block.theme_data.thumbnails},n[e]=!0,n),on:{click:t.onCountersTypeClick}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.counters&&"dots"===t.block.theme_data.counters_type,expression:"block.theme_data.counters && block.theme_data.counters_type === 'dots'"}],staticClass:"param param-counters-position solid-separator"},t._l(["inside","outside"],(function(e){var n;return i("div",{key:e,staticClass:"counters-position",class:(n={active:t.block.theme_data.counters_position===e,disabled:"dots"===e&&t.block.theme_data.thumbnails},n[e]=!0,n),on:{click:function(i){t.block.theme_data.counters_position=e}}},[t._v("\n          "+t._s(t.getCapitalizedName(e))+"\n        ")])})),0),t._v(" "),i("div",{staticClass:"param param-fullscreen solid-separator"},[i("div",{staticClass:"caption"},[t._v("Fullscreen")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.fullscreen,callback:function(e){t.$set(t.block.theme_data,"fullscreen",e)},expression:"block.theme_data.fullscreen"}})],1),t._v(" "),i("div",{staticClass:"param param-controls"},[i("div",{staticClass:"caption"},[t._v("Icons color")]),t._v(" "),i("color-picker",{attrs:{color:t.block.theme_data.controls_color,"show-alpha":!1},on:{showPopup:t.onShowPopup,"update:color":function(e){return t.onUpdateColor(e)}}})],1),t._v(" "),i("div",{staticClass:"param param-controls-bg"},[i("div",{staticClass:"caption"},[t._v("Background")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.controls_bg,callback:function(e){t.$set(t.block.theme_data,"controls_bg",e)},expression:"block.theme_data.controls_bg"}})],1),t._v(" "),i("div",{staticClass:"param param-show-on-hover solid-separator"},[i("div",{staticClass:"caption"},[t._v("Show on hover")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.show_on_hover,callback:function(e){t.$set(t.block.theme_data,"show_on_hover",e)},expression:"block.theme_data.show_on_hover"}})],1),t._v(" "),i("div",{staticClass:"param param-captions"},[i("div",{staticClass:"caption"},[t._v("Captions")]),t._v(" "),i("rm-switcher",{attrs:{callback:t.onCaptionsChange,width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.captions,callback:function(e){t.$set(t.block.theme_data,"captions",e)},expression:"block.theme_data.captions"}})],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"param param-thumbnails"},[i("div",{staticClass:"caption"},[t._v("Thumbs")]),t._v(" "),i("rm-switcher",{attrs:{callback:t.onThumbnailsChange,width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.thumbnails,callback:function(e){t.$set(t.block.theme_data,"thumbnails",e)},expression:"block.theme_data.thumbnails"}})],1)]),t._v(" "),i("div",{staticClass:"param param-fill solid-separator",class:{invisible:t.block.theme_data.thumbnails||!t.block.theme_data.fill||t.block.theme_data.radius>0}},[i("div",{staticClass:"caption"},[t._v("Fill")]),t._v(" "),i("rm-switcher",{attrs:{width:40,height:24,"color-on":"#282828","color-off":"#B8B8B8"},model:{value:t.block.theme_data.fill,callback:function(e){t.$set(t.block.theme_data,"fill",e)},expression:"block.theme_data.fill"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.block.theme_data.thumbnails||!t.block.theme_data.fill||t.block.theme_data.radius>0,expression:"block.theme_data.thumbnails || !block.theme_data.fill || block.theme_data.radius > 0"}],staticClass:"param param-backgroundr solid-separator"},[i("div",{staticClass:"caption"},[t._v("Bg color")]),t._v(" "),i("color-picker",{attrs:{"vertical-align":"top",color:t.block.theme_data.background_color,alpha:t.block.theme_data.background_opacity,"opacity-multiplier":100,"show-alpha":!0},on:{"update:color":function(e){return t.block.theme_data.background_color=e},"update:alpha":function(e){return t.block.theme_data.background_opacity=e},showPopup:t.onShowPopup}})],1),t._v(" "),i("div",{staticClass:"param param-radius"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.radius>0},attrs:{autofocus:!1,autosize:!1,min:0,max:999,dir:"v",speed:5},model:{value:t.block.theme_data.radius,callback:function(e){t.$set(t.block.theme_data,"radius",e)},expression:"block.theme_data.radius"}})],1)],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"library"===t.block.current_mode||"noun"===t.block.current_mode,expression:"block.current_mode === 'library' || block.current_mode === 'noun'"}],staticClass:"noun-settings"},[i("div",{staticClass:"noun-wrapper solid-separator"},t._l(["left","right"],(function(e){var n;return i("span",{key:e,staticClass:"arrow-noun",class:(n={active:t.activeNounArrow==e},n[e]=!0,n),on:{click:function(i){t.activeNounArrow=e}}},[t._v(t._s(t.getCapitalizedName(e)))])})),0),t._v(" "),i("shape-search",{ref:"shapeSearch",on:{dataObtained:t.onDataObtained}})],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"picture_preloader rmpreloader"},[e("div",{staticClass:"shadow"}),this._v(" "),e("div",{staticClass:"arc"})])}],!1,null,"0d6c7aca",null).exports),Nt={components:{NumericInput:X.a},mixins:[K],data:function(){return{isPlayOnScrollEnabled:Object(n.a)("constructor.playOnScroll"),isHoverDisabled:!1,methodsObject:{click:"Play on click",hover:"Play on hover",scroll:"On scroll",autoplay:"Autoplay"}}},computed:{},mounted:function(){this.raw_block.workspace.page.on("change:viewport",this.onChangeViewport),this.onChangeViewport()},methods:{onTransitionsValueChange:function(t){(this.block.theme_data.autoplay_delay<t||this.block.theme_data.hover_delay<t)&&(this.block.theme_data.autoplay_delay=t,this.block.theme_data.hover_delay=t)},onTransitionsTypeChange:function(t){this.block.transition_type=t,this.resetTransition()},resetTransition:function(){"scroll"===this.block.play_method&&"slider"===this.block.transition_type&&(this.block.theme_data.slider_transition=0)},onPlayMethodsChange:function(t){this.block.play_method=t,this.resetTransition()},onChangeViewport:function(){var t=this.raw_block.workspace.page.getCurrentViewport(),e=this.raw_block.workspace.page.getViewportParam("phone_portrait","enabled"),i=this.raw_block.workspace.page.getViewportParam("tablet_portrait","enabled");this.isHoverDisabled="default"!==t,(e||i)&&this.isHoverDisabled&&"hover"===this.block.play_method&&(this.block.play_method="autoplay")},getPlayMethods:function(){var t,e=this.raw_block.workspace.page.getCurrentViewport();return t=this.isPlayOnScrollEnabled?this.methodsObject:o.a.omit(this.methodsObject,"scroll"),t="default"!==e?o.a.omit(t,"hover"):t}}},Ut=Object(W.a)(Nt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel slideshow-transition-panel transitions resizable"},[i("div",{staticClass:"settings"},[i("div",{staticClass:"params"},[i("div",{staticClass:"param param-transition-type"},t._l(["slider","crossfade"],(function(e){var n;return i("div",{key:e,staticClass:"transition-type",class:(n={active:t.block.transition_type===e},n[e]=!0,n),on:{click:function(i){return t.onTransitionsTypeChange(e)}}},[t._v("\n          "+t._s(e.charAt(0).toUpperCase()+e.slice(1))+"\n        ")])})),0),t._v(" "),i("div",{staticClass:"param param-play-method",class:{click:"click"===t.block.play_method,hover:"hover"===t.block.play_method,autoplay:"autoplay"===t.block.play_method,scroll:"scroll"===t.block.play_method,scroll_enabled:t.isPlayOnScrollEnabled,hover_disabled:t.isHoverDisabled}},t._l(t.getPlayMethods(),(function(e,n){var o;return i("div",{key:n,staticClass:"play-method",class:(o={active:t.block.play_method===n},o[n]=!0,o),on:{click:function(e){return t.onPlayMethodsChange(n)}}},[t._v("\n          "+t._s(e)+"\n        ")])})),0),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"autoplay"===t.block.play_method,expression:"block.play_method === 'autoplay'"}],staticClass:"param param-autoplay-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.autoplay_delay>0},attrs:{autofocus:!1,min:"crossfade"===t.block.transition_type?t.block.theme_data.crossfade:t.block.theme_data.slider_transition,max:60,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.autoplay_delay,callback:function(e){t.$set(t.block.theme_data,"autoplay_delay",e)},expression:"block.theme_data.autoplay_delay"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hover"===t.block.play_method,expression:"block.play_method === 'hover'"}],staticClass:"param param-hover-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.hover_delay>0},attrs:{autofocus:!1,min:"crossfade"===t.block.transition_type?t.block.theme_data.crossfade:t.block.theme_data.slider_transition,max:60,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.hover_delay,callback:function(e){t.$set(t.block.theme_data,"hover_delay",e)},expression:"block.theme_data.hover_delay"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"scroll"===t.block.play_method,expression:"block.play_method === 'scroll'"}],staticClass:"param param-start-offset"},[i("div",{staticClass:"caption"},[t._v("Start offset")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.start_offset>0},attrs:{autofocus:!1,min:0,max:3e3,dir:"v",step:1,"use-float":!0,speed:5},model:{value:t.block.theme_data.start_offset,callback:function(e){t.$set(t.block.theme_data,"start_offset",e)},expression:"block.theme_data.start_offset"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"crossfade"===t.block.transition_type,expression:"block.transition_type === 'crossfade'"}],staticClass:"param param-crossfade",class:{scroll:"scroll"===t.block.play_method}},[i("div",{staticClass:"caption"},[t._v("Сrossfade")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.crossfade>0},attrs:{autofocus:!1,min:0,max:60,dir:"v",step:.1,"use-float":!0,speed:5},on:{change:t.onTransitionsValueChange},model:{value:t.block.theme_data.crossfade,callback:function(e){t.$set(t.block.theme_data,"crossfade",e)},expression:"block.theme_data.crossfade"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"slider"===t.block.transition_type,expression:"block.transition_type === 'slider'"}],staticClass:"param param-slider-transition",class:{scroll:"scroll"===t.block.play_method}},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.slider_transition>0},attrs:{autofocus:!1,min:0,max:"scroll"===t.block.play_method?0:60,dir:"v",step:.1,"use-float":!0,speed:5,readonly:"scroll"===t.block.play_method},on:{change:t.onTransitionsValueChange},model:{value:t.block.theme_data.slider_transition,callback:function(e){t.$set(t.block.theme_data,"slider_transition",e)},expression:"block.theme_data.slider_transition"}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"scroll"===t.block.play_method,expression:"block.play_method === 'scroll'"}],staticClass:"param param-scroll-delay"},[i("div",{staticClass:"caption"},[t._v("Delay")]),t._v(" "),i("numeric-input",{class:{active:t.block.theme_data.scroll_delay>0},attrs:{autofocus:!1,min:0,max:3e3,dir:"v",step:.1,"use-float":!0,speed:5},model:{value:t.block.theme_data.scroll_delay,callback:function(e){t.$set(t.block.theme_data,"scroll_delay",e)},expression:"block.theme_data.scroll_delay"}})],1)])])])}),[],!1,null,null,null).exports,Ht={props:{href:String}};i("896M");function Vt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Wt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Gt={components:{InlineHelp:Object(W.a)(Ht,(function(){var t=this.$createElement;return(this._self._c||t)("a",{staticClass:"info",attrs:{href:this.href,rel:"noreferrer noopener",target:"_blank"}})}),[],!1,null,"4b1e125a",null).exports,VideoSearch:i("vIxw").a,RmSwitcher:tt.a,ColorPicker:et.a},mixins:[K],data:function(){return{isLoading:!1,isError:!1,isUploading:!1,isDragging:!1,isDropZoneEnter:!1,isCustomThumbnail:!1,errorText:"",m:{url:null,video_id:null,provider_name:null,thumbnail_url:null,custom_thumbnail:!1,picture:null,title:null,start_time:null,autoplay:!1,loop:!1,mute:!1,info:!1,theme:null,color:null}}},computed:{logoClass:function(){var t={};return t[this.m.provider_name&&this.m.provider_name.toLowerCase()]=!0,t},hasVideo:function(){return Boolean(this.m.video_id)},providerName:function(){var t=this.m&&this.m.provider_name;return t&&t.toLowerCase()},isYoutube:function(){return"youtube"===this.providerName},isVimeo:function(){return"vimeo"===this.providerName},previewBackground:function(){if(!this.m.custom_thumbnail)return null;var t=this.getCustomThumbnail(),e=t.thumbUrl||t.url;if(vt.a.useLambdaUrlOldProjects(t,"video")){var i={width:St.a.THUMB_SIZE_VIDEO_COVER,height:St.a.THUMB_SIZE_VIDEO_COVER};e=vt.a.getThumbnailUrl(t,i)}return e?"url(".concat(e,")"):null},isPrivate:function(){return this.hasVideo&&!this.m.title&&!this.m.thumbnail_url},backgroundColor:function(){return this.m.color||"3ab9ff"},showPreview:function(){return this.isLoading||this.hasVideo},isAutoplay:{get:function(){return this.m.autoplay},set:function(t){this.m.autoplay=t,this.m.mute=t,t&&(this.isCustomThumbnail=!t)}},hasCustomThumbnail:{get:function(){return this.isCustomThumbnail},set:function(t){var e=this;this.isCustomThumbnail=t,this.m.custom_thumbnail=t,t?(setTimeout((function(){e.$dropCaption=Object(u.a)(".video-panel-dropzone-container .caption-upload-dop"),e.$replaceIcon=Object(u.a)(".video-panel-icon-replace"),e.$dropCaption.css("opacity",0)}),0),setTimeout((function(){e.$dropCaption.show()}),150),setTimeout((function(){e.$dropCaption.css("opacity",.9)}),200),setTimeout((function(){e.$replaceIcon.show()}),300)):this.$dropCaption&&(this.$dropCaption.hide(),this.$replaceIcon.hide(),this.$dropCaption.css("opacity",0))}}},beforeDestroy:function(){this.abortAjaxLoading(),this.raw_block.workspace.off("main-dragover",this.highlightDropZone,this)},created:function(){this.isCustomThumbnail=!0===this.m.custom_thumbnail,this.m.custom_thumbnail_url&&!this.m.picture&&(this.m.picture=this.getCustomThumbnail(this))},mounted:function(){Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-video_settings")})),this.mountUploader()},methods:{abortAjaxLoading:function(){this.videoEmbedXHR&&this.videoEmbedXHR.abort(),this.isLoading=!1},onLoaded:function(t){var e=this,i=t;if(this.isLoading=!1,i.html){i=o.a.pick(i,"url","video_id","provider_name","thumbnail_url","title","start_time"),this.m.start_time&&(i.start_time=i.start_time||null);var n=o.a.extend(i,{autoplay:Boolean(this.m.autoplay),loop:Boolean(this.m.loop),mute:Boolean(this.m.mute),info:Boolean(this.m.info),theme:this.m.theme||"dark",color:this.m.color||"3ab9ff"});o.a.extend(this.m,n);var a=this.getCustomThumbnail();this.isCustomThumbnail=Boolean(this.m.custom_thumbnail&&a&&a.url),setTimeout((function(){e.mountUploader()}),0)}else this.onVideoSearchError()},onRemove:function(){o.a.extend(this.m,{video_id:"",provider_name:"",thumbnail_url:"",custom_thumbnail:!1,picture:null,title:""})},onDataObtained:function(t){clearTimeout(this.errorRemovalTimeout),this.m.url===t.url?this.abortAjaxLoading():(this.isLoading=!0,this.isError=!1,this.m.provider_name=t.provider_name,this.m.url=t.url)},onVideoSearchError:function(){this.showError("Sorry, but we can't get this video due to its limitations")},showError:function(t){var e=this;this.errorText=t,this.isError=!0,this.isLoading=!1,this.errorRemovalTimeout=setTimeout((function(){e.isError=!1,e.errorText=""}),2e3)},dismissError:function(){this.isError=!1,this.errorText="",clearTimeout(this.errorRemovalTimeout)},mountUploader:function(){this.$refs.uploadInput&&this.$refs.uploadInputDropZone&&!this.uploader&&(this.uploader=new bt.a(this,{fileInput:Object(u.a)(this.$refs.uploadInput),dropZone:Object(u.a)(this.$refs.uploadInputDropZone)}),this.uploader.on("start",this.onStartUpload),this.uploader.on("done",this.onDoneUpload),this.uploader.on("fail",this.onFailUpload),this.uploader.on("dragover",this.highlightDropZoneEnter),this.raw_block.workspace.on("main-dragover",this.highlightDropZone,this))},uploadCustomThumbnail:function(t){t&&Object(u.a)(t.target).hasClass("uploadInput")||(this.isUploading&&Object(u.a)(this.$refs.uploadInput).trigger("click","stop"),Object(u.a)(this.$refs.uploadInput).trigger("click"))},replaceCustomThumbnail:function(){this.isCustomThumbnail&&Object(u.a)(this.$refs.uploadInput).trigger("click")},getCustomThumbnail:function(){return this.m.picture?this.m.picture:{url:this.m.custom_thumbnail_url,type:o.a.last((this.m.custom_thumbnail_url||"").split("."))}},onStartUpload:function(t,e){this.isUploading=!0},onDoneUpload:function(t,e){if(this.isUploading=!1,!e||!e.result)return this.showError("Sorry, but we couldn't upload the custom thumbnail"),void(this.isCustomThumbnail=!1);if(e.result.picture){this.isCustomThumbnail=!0;var i=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(i),!0).forEach((function(e){Wt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Vt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({originalW:e.result.size.width,originalH:e.result.size.height},e.result.picture);o.a.extend(this.m,{picture:i})}else this.isCustomThumbnail=!1,this.showError("Sorry, but we couldn't upload the custom thumbnail")},onFailUpload:function(){this.isUploading=!1},cancelUpload:function(){this.isUploading=!1},highlightDropZone:function(t){var e=this;this.isDragging=!0,clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout((function(){e.isDragging=!1}),500)},highlightDropZoneEnter:function(t){var e=this;this.isDropZoneEnter=!0,clearTimeout(this.dropZoneTimeout),this.dropZoneTimeout=setTimeout((function(){e.isDropZoneEnter=!1}),500)},flagLambda:vt.a.flagLambda}},qt=(i("Ib1Q"),Object(W.a)(Gt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel control-panel video-panel",class:{error:t.isError,loading:t.isLoading,loaded:t.hasVideo,youtube:t.isYoutube,vimeo:t.isVimeo,"custom-thumb":t.isCustomThumbnail}},[i("div",{staticClass:"video-panel-header"},[t._v("Video")]),t._v(" "),i("video-search",{attrs:{"is-video-processed":t.m.video_id,"show-social":!t.isLoading&&!t.hasVideo,"highlight-on-error":!0},on:{dataObtained:t.onDataObtained,loaded:t.onLoaded,error:t.onVideoSearchError,remove:t.onRemove},model:{value:t.m.url,callback:function(e){t.$set(t.m,"url",e)},expression:"m.url"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showPreview?i("div",{staticClass:"video-panel-preview-logo",class:t.logoClass}):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.hasVideo?i("div",{staticClass:"video-panel-preview-caption"},[t._v(t._s(t.m.title))]):t._e(),t._v(" "),t.isPrivate?i("div",{staticClass:"video-panel-preview-caption video-panel-preview-caption-private"},[t._v("Private video")]):t._e()]),t._v(" "),i("transition",{attrs:{name:"slide"}},[t.showPreview?i("div",{staticClass:"video-panel-preview-wrapper"},[i("div",{staticClass:"video-panel-preview",class:{"custom-thumb":t.isCustomThumbnail,vimeo:t.isVimeo}},[i("transition",{attrs:{name:"fade"}},[i("div",{staticClass:"video-panel-preview-image-container",class:{vimeo:t.isVimeo,dragging:t.isDragging}},[t.m.picture&&t.m.picture.url&&!t.isDragging&&!t.isUploading?i("div",{staticClass:"video-panel-preview-image-wrapper"},[i("div",{staticClass:"video-panel-preview-image",style:{backgroundImage:t.previewBackground}})]):t._e(),t._v(" "),t.isCustomThumbnail&&!t.isDragging?i("div",{staticClass:"video-panel-preview-mask"}):t._e()])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.hasVideo?i("div",{staticClass:"video-panel-settings"},[i("div",{staticClass:"video-panel-setting autoplay"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Autoplay")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.isAutoplay,callback:function(e){t.isAutoplay=e},expression:"isAutoplay"}})],1),t._v(" "),i("div",{staticClass:"video-panel-setting loop"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Loop")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.loop,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.loop,callback:function(e){t.$set(t.m,"loop",e)},expression:"m.loop"}})],1),t._v(" "),i("div",{staticClass:"video-panel-setting mute"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("\n                Mute\n                "),i("inline-help",{attrs:{href:"http://help.readymag.com/hc/en-us/articles/360020792871-Video"}})],1),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.mute,"is-disabled":t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.mute,callback:function(e){t.$set(t.m,"mute",e)},expression:"m.mute"}})],1),t._v(" "),t.isYoutube?t._e():i("div",{staticClass:"video-panel-setting info"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Show Info")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.m.info,"color-off":"rgb(125, 125, 125)"},model:{value:t.m.info,callback:function(e){t.$set(t.m,"info",e)},expression:"m.info"}})],1),t._v(" "),t.isVimeo?i("div",{staticClass:"video-panel-setting video-panel-setting-color video-panel-setting-color-vimeo"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Color")]),t._v(" "),i("div",{staticClass:"video-panel-switcher video-panel-switcher-vimeo"},[i("color-picker",{staticClass:"video-panel-color-picker-vimeo",attrs:{color:t.backgroundColor,"show-alpha":!1},on:{"update:color":function(e){return t.m.color=e}}})],1)]):t._e(),t._v(" "),i("div",{staticClass:"video-panel-setting thumb"},[i("div",{staticClass:"video-panel-setting-caption"},[t._v("Thumbnail")]),t._v(" "),i("rm-switcher",{staticClass:"video-panel-switcher",attrs:{state:t.hasCustomThumbnail,"is-disabled":t.isAutoplay,"color-off":"rgb(125, 125, 125)"},model:{value:t.hasCustomThumbnail,callback:function(e){t.hasCustomThumbnail=e},expression:"hasCustomThumbnail"}})],1)]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.isLoading?i("div",{staticClass:"video-panel-preview-preloader rmpreloader"},[i("div",{staticClass:"shadow"}),t._v(" "),i("div",{staticClass:"arc"})]):t._e()]),t._v(" "),i("input",{ref:"uploadInput",staticClass:"uploadInput",attrs:{type:"file",name:"upload","data-url":t.flagLambda()?"/api/upload/lambda/":"/api/upload/"}}),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{ref:"uploadInputDropZone"},[t.isCustomThumbnail?i("div",{staticClass:"video-panel-dropzone-container"},[t.m.picture&&t.m.picture.url&&!t.isDragging&&!t.isUploading?i("div",{staticClass:"video-panel-icon-replace",on:{click:function(e){return t.replaceCustomThumbnail()}}}):t._e(),t._v(" "),i("div",{staticClass:"video-panel-thumb-upload-container"},[i("div",{staticClass:"upload"},[i("div",{staticClass:"upload-wrapper"},[i("div",{staticClass:"center-wrapper",on:{click:function(e){return t.uploadCustomThumbnail(e)}}},[t.isUploading?t._e():i("div",{staticClass:"caption-upload-dop caption-upload-dop-light"},[t.m.picture&&t.m.picture.url?i("span",[t._v(t._s(t.isDragging?"Drop here":""))]):i("span",[t._v(t._s(t.isDragging?"Drop here":"Drop file here"))])])])])])]),t._v(" "),t.isUploading?i("div",{staticClass:"video-panel-thumb-preloader preloader"},[i("div",{staticClass:"rmpreloader"},[i("div",{staticClass:"arc"})])]):t._e()]):t._e()])])],1)]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.isError?i("div",{staticClass:"video-panel-error",on:{click:t.dismissError}},[i("div",{staticClass:"error-text"},[t._v(t._s(t.errorText))])]):t._e()])],1)}),[],!1,null,null,null).exports),Kt={components:{ColorPicker:et.a,NumericInput:X.a,FontFamilySelector:J.a,FontStyleSelector:Q.a},mixins:[K],data:function(){return{stylingState:"default"}},computed:{maxBorderWidth:function(){return Math.ceil(Math.min(this.m.w,this.m.h)/2)}},watch:{stylingState:function(t){Object(u.a)(".common-button",this.raw_block.$el).toggleClass("hovered","hover"===t),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("current","current"===t)}},destroyed:function(){this.setCorrectIconColor("default"),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("hovered",!1),Object(u.a)(".common-button",this.raw_block.$el).toggleClass("current",!1)},methods:{onChangeStylingState:function(t){t&&t!==this.stylingState&&(this.stylingState=t),this.closeOthersPopups(null),this.setCorrectIconColor(t)},changePropHandler:function(t,e){this.m[t]=e},setCorrectIconColor:function(t){this.raw_block.onIconColorChange(this.m,null,{},t)}}},Xt=(i("6ouf"),Object(W.a)(Kt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel cart-settings-panel",class:{"default-tab":"default"===t.stylingState,"hover-tab":"hover"===t.stylingState}},[t._m(0),t._v(" "),i("div",{staticClass:"styling-state-switcher"},[i("span",{class:{btn:!0,active:"default"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("default")}}},[t._v("Default")]),t._v(" "),i("span",{class:{btn:!0,active:"hover"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("hover")}}},[t._v("Hover")])]),t._v(" "),i("div",{staticClass:"separator-filled"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"default"===t.stylingState,expression:"stylingState === 'default'"}],staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["background-color"],alpha:t.m["background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["border-radius"]<10,"two-digit":t.m["border-radius"]<100&&t.m["border-radius"]>9,"three-digit":t.m["border-radius"]>99},attrs:{autosize:!0,value:t.m["border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["border-width"]<10,"two-digit":t.m["border-width"]<100&&t.m["border-width"]>9,"three-digit":t.m["border-width"]>99},attrs:{autosize:!0,value:t.m["border-width"],min:0,max:t.maxBorderWidth},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["border-color"],alpha:t.m["border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-family-selector",{attrs:{family:t.m["font-family"]},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-style-selector",{style:{"font-family":t.m["font-family"]},attrs:{"font-style":[t.m["font-style"]],"font-weight":[t.m["font-weight"]],"font-family":[t.m["font-family"]]},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Size")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["font-size"],min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Letter spacing")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["letter-spacing"],min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.color,alpha:t.m["color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("icon_color",e)},"update:alpha":function(e){return t.changePropHandler("icon_color_opacity",e)}}})],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"hover"===t.stylingState,expression:"stylingState === 'hover'"}],staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-background-color"],alpha:t.m["hover-background-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-radius"]<10,"two-digit":t.m["hover-border-radius"]<100&&t.m["hover-border-radius"]>9,"three-digit":t.m["hover-border-radius"]>99},attrs:{autosize:!0,value:t.m["hover-border-radius"],min:0,max:999},on:{change:function(e){return t.changePropHandler("hover-border-radius",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-width"]<10,"two-digit":t.m["hover-border-width"]<100&&t.m["hover-border-width"]>9,"three-digit":t.m["hover-border-width"]>99},attrs:{autosize:!0,value:t.m["hover-border-width"],min:0,max:t.maxBorderWidth},on:{change:function(e){return t.changePropHandler("hover-border-width",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-border-color"],alpha:t.m["hover-border-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-color"],alpha:t.m["hover-color-opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-color",e)},"update:alpha":function(e){return t.changePropHandler("hover-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changePropHandler("hover-icon_color_opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{staticClass:"num-input",class:{"one-digit":t.m["hover-border-radius"]<10,"two-digit":t.m["hover-border-radius"]<100&&t.m["hover-border-radius"]>9,"three-digit":t.m["hover-border-radius"]>99},attrs:{autosize:!0,value:t.m["hover-tansition-duration"],min:0,max:2,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("hover-tansition-duration",e)}}})],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title-row"},[e("div",{staticClass:"title"},[this._v("Cart button")])])}],!1,null,null,null).exports),Yt={components:{RmSelect:rt},mixins:[K],data:function(){return{productsOptions:this.getProductsOptions()}},computed:{thereAreProducts:function(){return this.productsOptions&&this.productsOptions.length>1},isCurrentProductInactive:function(){return this.getCurrentProductActiveStatus()}},methods:{getProductsOptions:function(t){var e=t||this.raw_block.model.get("selected_product_id");return this.raw_block.workspace.eCommerceManager.getProductsLikeOptionsList(e)},getCurrentProductActiveStatus:function(t){var e=t||this.raw_block.model.get("selected_product_id");return!this.raw_block.workspace.eCommerceManager.isProductActive(e)},onProductSelect:function(t){this.isCurrentProductInactive&&(this.productsOptions=this.getProductsOptions(t.value))}}},Zt=(i("U2WL"),Object(W.a)(Yt,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{panel:!0,"select-product-panel":!0,"no-products-wrap":!t.thereAreProducts}},[t.thereAreProducts?t._e():i("div",{staticClass:"no-products-alert"},[t._v("You have no active products to choose")]),t._v(" "),t.thereAreProducts?i("rm-select",{staticClass:"select-wrap",attrs:{options:t.productsOptions,"arrow-size":"big",callback:t.onProductSelect},scopedSlots:t._u([{key:"listitem",fn:function(e){return[i("span",{class:{"inactive-product":e.option.value===e.value&&t.getCurrentProductActiveStatus()},attrs:{title:e.option.value===e.value&&t.getCurrentProductActiveStatus()?"inactive product":""}},[t._v(t._s(e.option.caption))]),t._v(" "),i("div",{staticClass:"point"})]}}],null,!1,1835512949),model:{value:t.m.selected_product_id,callback:function(e){t.$set(t.m,"selected_product_id",e)},expression:"m.selected_product_id"}}):t._e()],1)}),[],!1,null,"4b24eb32",null).exports),Jt=i("VxDd"),Qt=i.n(Jt),te=i("5bt+"),ee=i.n(te),ie=i("Cmem"),ne=i.n(ie),oe=i("VsGE"),ae=i.n(oe),se={components:{ColorPicker:et.a,NumericInput:X.a,FontFamilySelector:J.a,FontStyleSelector:Q.a},mixins:[K],data:function(){return{stylingState:"default",haveProductAttributes:this.raw_block.haveProductAttributes(),layoutHorizontalImg:Qt.a,layoutVerticalImg:ee.a,colorDisabledImg:ne.a,numberDisabledImg:ae.a}},computed:{maxBtnBorderWidth:function(){return Math.ceil(Math.min(this.m.btn_w,this.m.btn_h)/2)},selectionState:function(){return this.raw_block.selectionState}},watch:{stylingState:function(t){this.raw_block.$el.toggleClass("hovered","hover"===t)}},destroyed:function(){this.onChangeStylingState("default")},methods:{onChangeLayout:function(t){var e=t.currentTarget.dataset.layoutType;e&&this.m.layout&&this.m.layout!==e&&(this.m.layout=e)},onChangeStylingState:function(t){t&&t!==this.stylingState&&(this.stylingState=t,this.raw_block.changeStylingState(this.stylingState))},changeSinglePropHandler:function(t,e){this.m[t]=e},changeSelectIconProp:function(t,e){var i={"attrs-icon-w":e,"attrs-icon-h":this.m["attrs-icon-h"]+(e-this.m["attrs-icon-w"])};this.m=Object.assign(this.m,i)},changeIconPropHandler:function(t,e){var i={};i[t]=e,this.m[t]===this.m["hover-"+t]&&(i["hover-"+t]=e),this.m=Object.assign(this.m,i)},changeHoverPropHandler:function(t,e){var i={};"both"===this.selectionState&&(i[t]=e,i["attrs-"+t]=e),"button"===this.selectionState&&(i[t]=e),"selects"===this.selectionState&&(i["attrs-"+t]=e),this.m=Object.assign(this.m,i)},changePropHandler:function(t,e){var i={};"both"===this.selectionState&&(i[t]=e,i["attrs-"+t]=e,this.m[t]===this.m["hover-"+t]&&this.m["attrs-"+t]===this.m["attrs-hover-"+t]&&(i["hover-"+t]=e,i["attrs-hover-"+t]=e)),"button"===this.selectionState&&(i[t]=e,this.m[t]===this.m["hover-"+t]&&(i["hover-"+t]=e)),"selects"===this.selectionState&&(i["attrs-"+t]=e,this.m["attrs-"+t]===this.m["attrs-hover-"+t]&&(i["attrs-hover-"+t]=e)),this.m=Object.assign(this.m,i)},getFontFamilyValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:[this.m[t],this.m["attrs-"+t]]:"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},getFontParam:function(t){return"both"===this.selectionState?"font-style"===t?this.m[t]===this.m["attrs-"+t]&&this.m["font-weight"]===this.m["attrs-font-weight"]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:"font-weight"===t?this.m[t]===this.m["attrs-"+t]&&this.m["font-style"]===this.m["attrs-font-style"]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:this.m[t]===this.m["attrs-"+t]?[this.m[t]]:[this.m[t],this.m["attrs-"+t]]:"button"===this.selectionState?[this.m[t]]:"selects"===this.selectionState?[this.m["attrs-"+t]]:void 0},getColorValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:"000000":"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},getNumValue:function(t){return"both"===this.selectionState?this.m[t]===this.m["attrs-"+t]?this.m[t]:Math.min(this.m[t],this.m["attrs-"+t]):"button"===this.selectionState?this.m[t]:"selects"===this.selectionState?this.m["attrs-"+t]:void 0},isDisabledValue:function(t){return"both"===this.selectionState&&this.m[t]!==this.m["attrs-"+t]}}},re=(i("+/R+"),Object(W.a)(se,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel addtocart-settings-panel",class:{"panel-default":"default"===t.stylingState,"panel-hover":"hover"===t.stylingState,"panel-both":"both"===t.selectionState,"panel-selects":"selects"===t.selectionState,"panel-button":"button"===t.selectionState}},[i("div",{staticClass:"title-row"},["both"===t.selectionState&&t.haveProductAttributes?i("div",{staticClass:"both-header header"},[i("div",{staticClass:"title"},[t._v("Layout")]),t._v(" "),i("div",{directives:[{name:"svginject",rawName:"v-svginject"}],staticClass:"layout-controls"},[i("div",{class:{"layout-btn":!0,"horizontal-layout":!0,active:"horizontal"===t.m.layout},attrs:{"data-layout-type":"horizontal"},on:{click:t.onChangeLayout}},[i("img",{staticClass:"svg layout-icon",attrs:{title:"horizontal layout",src:t.layoutHorizontalImg}})]),t._v(" "),i("div",{class:{"layout-btn":!0,"vertical-layout":!0,active:"vertical"===t.m.layout},attrs:{"data-layout-type":"vertical"},on:{click:t.onChangeLayout}},[i("img",{staticClass:"svg layout-icon",attrs:{title:"vertical layout",src:t.layoutVerticalImg}})])])]):t._e(),t._v(" "),"button"===t.selectionState||"both"===t.selectionState&&!t.haveProductAttributes?i("div",{staticClass:"button-header header"},[t._v("\n      Button\n    ")]):t._e(),t._v(" "),"selects"===t.selectionState?i("div",{staticClass:"selects-header header"},[t._v("Dropdown")]):t._e()]),t._v(" "),i("div",{staticClass:"styling-state-switcher"},[i("span",{class:{btn:!0,active:"default"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("default")}}},[t._v("Default")]),t._v(" "),i("span",{class:{btn:!0,active:"hover"===t.stylingState},on:{click:function(e){return t.onChangeStylingState("hover")}}},[t._v("Hover")])]),t._v(" "),i("div",{staticClass:"separator-filled"}),t._v(" "),"default"===t.stylingState?i("div",{staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("background-color"),alpha:t.getColorValue("background-color-opacity"),"custom-icon":t.isDisabledValue("background-color")||t.isDisabledValue("background-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("background-color",e)},"update:alpha":function(e){return t.changePropHandler("background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("border-radius")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("border-radius")},attrs:{autosize:!0,value:t.getNumValue("border-radius"),min:0,max:999},on:{change:function(e){return t.changePropHandler("border-radius",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("border-width")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("border-width")},attrs:{autosize:!0,value:t.getNumValue("border-width"),min:0,max:t.maxBtnBorderWidth},on:{change:function(e){return t.changePropHandler("border-width",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("border-color"),alpha:t.getColorValue("border-color-opacity"),"custom-icon":t.isDisabledValue("border-color")||t.isDisabledValue("border-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("border-color",e)},"update:alpha":function(e){return t.changePropHandler("border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-family-selector",{attrs:{family:t.getFontFamilyValue("font-family")},on:{showPopup:t.closeOthersPopups,change:function(e){return t.changePropHandler("font-family",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("font-style-selector",{style:{"font-family":1===t.getFontParam("font-family").length?t.getFontParam("font-family")[0]:"inherit"},attrs:{"font-style":t.getFontParam("font-style"),"font-weight":t.getFontParam("font-weight"),"font-family":t.getFontParam("font-family")},on:{showPopup:t.closeOthersPopups,"update:fontStyle":function(e){return t.changePropHandler("font-style",e)},"update:fontWeight":function(e){return t.changePropHandler("font-weight",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Size")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("font-size")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("font-size")},attrs:{autosize:!0,value:t.getNumValue("font-size"),min:8,max:999},on:{change:function(e){return t.changePropHandler("font-size",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Letter spacing")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("letter-spacing")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("letter-spacing")},attrs:{autosize:!0,value:t.getNumValue("letter-spacing"),min:-99,max:999,step:.1,"use-float":!0},on:{change:function(e){return t.changePropHandler("letter-spacing",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("color"),alpha:t.getColorValue("color-opacity"),"custom-icon":t.isDisabledValue("color")||t.isDisabledValue("color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changePropHandler("color",e)},"update:alpha":function(e){return t.changePropHandler("color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),"selects"!==t.selectionState?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m.icon_color,alpha:t.m.icon_color_opacity},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeIconPropHandler("icon_color",e)},"update:alpha":function(e){return t.changeIconPropHandler("icon_color_opacity",e)}}})],1):t._e(),t._v(" "),"selects"===t.selectionState?i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon size")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["attrs-icon-w"],min:5,max:100},on:{change:function(e){return t.changeSelectIconProp("attrs-icon-w",e)}}})],1):t._e()]):t._e(),t._v(" "),"hover"===t.stylingState?i("div",{staticClass:"settings-panel"},[i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Shape color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-background-color"),alpha:t.getColorValue("hover-background-color-opacity"),"custom-icon":t.isDisabledValue("hover-background-color")||t.isDisabledValue("hover-background-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-background-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-background-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Radius")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("hover-border-radius")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("hover-border-radius")},attrs:{autosize:!0,value:t.getNumValue("hover-border-radius"),min:0,max:999},on:{change:function(e){return t.changeHoverPropHandler("hover-border-radius",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border")]),t._v(" "),i("div",{staticClass:"num-input-wrap"},[i("img",{class:{"disabled-numeric":!0,"show-disabled-icon":t.isDisabledValue("hover-border-width")},attrs:{src:t.numberDisabledImg}}),t._v(" "),i("numeric-input",{class:{"num-input":!0,"hidden-num-input":t.isDisabledValue("hover-border-width")},attrs:{autosize:!0,value:t.getNumValue("hover-border-width"),min:0,max:t.maxBtnBorderWidth},on:{change:function(e){return t.changeHoverPropHandler("hover-border-width",e)}}})],1)]),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Border color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-border-color"),alpha:t.getColorValue("hover-border-color-opacity"),"custom-icon":t.isDisabledValue("hover-border-color")||t.isDisabledValue("hover-border-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-border-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-border-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Text color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.getColorValue("hover-color"),alpha:t.getColorValue("hover-color-opacity"),"custom-icon":t.isDisabledValue("hover-color")||t.isDisabledValue("hover-color-opacity")?t.colorDisabledImg:null},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeHoverPropHandler("hover-color",e)},"update:alpha":function(e){return t.changeHoverPropHandler("hover-color-opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Icon color")]),t._v(" "),i("color-picker",{staticClass:"round",attrs:{color:t.m["hover-icon_color"],alpha:t.m["hover-icon_color_opacity"]},on:{showPopup:t.closeOthersPopups,"update:color":function(e){return t.changeSinglePropHandler("hover-icon_color",e)},"update:alpha":function(e){return t.changeSinglePropHandler("hover-icon_color_opacity",e)}}})],1),t._v(" "),i("div",{staticClass:"separator-dotted"}),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"caption"},[t._v("Transition")]),t._v(" "),i("numeric-input",{staticClass:"num-input",attrs:{autosize:!0,value:t.m["hover-tansition-duration"],min:0,max:2,step:.1,"use-float":!0},on:{change:function(e){return t.changeSinglePropHandler("hover-tansition-duration",e)}}})],1)]):t._e()])}),[],!1,null,null,null).exports),le={components:{RmSwitcher:tt.a},mixins:[K],data:function(){return{connectedToStripe:this.raw_block.workspace.eCommerceManager.isMagConnectedToStripe(),loading:!1}},computed:{switcherPosition:{get:function(){return this.loading?void 0:this.connectedToStripe},set:function(t){this.connectedToStripe=t}}},methods:{switcherChange:function(t){var e=this;this.loading||(this.loading=!0,t?this.raw_block.workspace.eCommerceManager.connectToStripe().then((function(){e.switcherPosition=!0,e.checkControlsRestrictions(),e.raw_block.workspace.eCommerceManager.getProducts(),e.loading=!1,RM.analytics&&RM.analytics.sendEvent("Stripe","enabled")})).catch((function(t){e.switcherPosition=!1,e.loading=!1,e.checkControlsRestrictions()})):this.raw_block.workspace.eCommerceManager.disconnectFromStripe().then((function(t){e.switcherPosition=!1,e.checkControlsRestrictions(),e.loading=!1,RM.analytics&&RM.analytics.sendEvent("Stripe","disabled")})).catch((function(t){e.switcherPosition=!0,e.loading=!1,e.checkControlsRestrictions()})))},checkControlsRestrictions:function(){this.raw_block.workspace.controls.setControls(this.raw_block.controls,this.raw_block)}}},ce=(i("EvVy"),Object(W.a)(le,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"panel connect-panel"},[e("div",{staticClass:"title"},[this._v(this._s(this.connectedToStripe?"Connected":"Connect")+" to Stripe")]),this._v(" "),e("div",{staticClass:"connect-to-stripe"},[e("rm-switcher",{attrs:{value:this.switcherPosition,width:40,height:24,"color-on":"#0080FF","color-off":"#B8B8B8",callback:this.switcherChange}})],1),this._v(" "),e("a",{ref:"question-enabled",staticClass:"question-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360035903372",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-ecommerce-connection-icon-tooltip"}},[this._v("?")])])}),[],!1,null,null,null).exports),de={mixins:[K],data:function(){return{m:{alt:""}}}},he=(i("UyQn"),Object(W.a)(de,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel picture-alt"},[i("div",{staticClass:"param-caption"},[i("span",[t._v("Semantics")]),t._v(" "),i("a",{staticClass:"question-icon",attrs:{href:"https://help.readymag.com/hc/en-us/articles/360019989052-Picture",rel:"noreferrer noopener",target:"_blank","data-alt-style":"controls-picture-alt-tooltip"}},[i("svg",{attrs:{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg"}},[i("g",{attrs:{fill:"none","fill-rule":"evenodd"}},[i("circle",{attrs:{cx:"12",cy:"12",r:"12"}}),t._v(" "),i("path",{attrs:{d:"M8 9.259C8.06 7.371 9.294 6 11.542 6 13.615 6 15 7.259 15 9.02c0 1.219-.575 2.072-1.604 2.717-.992.614-1.272 1.02-1.272 1.809V14H10.37l-.008-.542c-.068-1.195.37-1.912 1.415-2.558.939-.597 1.256-1.02 1.256-1.808 0-.83-.635-1.427-1.589-1.427-.976 0-1.604.622-1.665 1.594H8zM11.5 18c-.904 0-1.5-.592-1.5-1.495 0-.913.596-1.505 1.5-1.505.922 0 1.5.592 1.5 1.505 0 .903-.578 1.495-1.5 1.495z"}})])])])]),t._v(" "),i("div",{staticClass:"param",attrs:{"data-param":"alt_text"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.m.alt,expression:"m.alt"}],attrs:{placeholder:"Descriptive alt text",maxlength:"100"},domProps:{value:t.m.alt},on:{input:function(e){e.target.composing||t.$set(t.m,"alt",e.target.value)}}})])])}),[],!1,null,"60cc4a0c",null).exports),ue={mixins:[K],components:{RmSelect:rt},data:function(){return{m:{activeLink:""}}}},pe=(i("Y+fa"),{components:{ControlIcon:G,PanelAddtocartSettings:re,PanelRotation:Z,PanelButtonSettings:nt,PanelTwitterSettings:ht,PanelFacebookSettings:gt,PanelGmapsSettings:ft,PanelPictureSettings:kt,PanelPictureAlt:he,PanelAudioSettings:Pt,PanelShapeSettings:Lt,PanelSlideshowSettings:Ft,PanelSlideshowTransitions:Ut,PanelVideo:qt,PanelCartConnections:ce,PanelCartSettings:Xt,PanelProductSelector:Zt,PanelRmheaderSettings:Object(W.a)(ue,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"panel rmheader_settings"},[t._m(0),t._v(" "),i("rm-select",{attrs:{options:[{value:"none",caption:"None"},{value:"features",caption:"Features"},{value:"pricing",caption:"Pricing"},{value:"examples",caption:"Examples"},{value:"learn",caption:"Learn"}]},model:{value:t.m.activeLink,callback:function(e){t.$set(t.m,"activeLink",e)},expression:"m.activeLink"}})],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"param-caption"},[e("span",[this._v("RM Header")])])}],!1,null,null,null).exports},computed:{cssClasses:function(){var t={fade:this.faded&&!this.selected||this.disabled,checked:this.selected,loading:this.loading};if(this.raw_block.controlsClasses&&"function"==typeof this.raw_block.controlsClasses){var e=this.raw_block.controlsClasses(this.panelComponent);e&&(t[e]=!0)}return t[this.cssClass]=!0,t},svgIcon:function(){return this.raw_block.controlsSvgIcons&&this.raw_block.controlsSvgIcons[this.panelComponent]?this.raw_block.controlsSvgIcons[this.panelComponent]:null},iconClass:function(){if(this.raw_block.controlsIconClasses&&"function"==typeof this.raw_block.controlsIconClasses){var t=this.raw_block.controlsIconClasses();return t&&t[this.panelComponent]?"function"==typeof t[this.panelComponent]?t[this.panelComponent]():t[this.panelComponent]:null}return null}},methods:{onIconClick:function(){this.selected||this.disabled?this.selected&&this.deselect():this.select()},deselect:function(){this.$emit("deselect")},select:function(){this.$emit("select")},canClosePanel:function(){if(!this.selected)return!0;var t=null;return o.a.each(this.$children,(function(e){e.canClose&&null===t&&(t=e.canClose())})),null===t||t},closePopups:function(){this.$refs.panel.closeOthersPopups()},onPanelResize:function(){this.$emit("panel-resize",this.$refs.panel.$el)}}}),ge=(i("Tjx0"),Object(W.a)(pe,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("transition",{attrs:{name:"control",appear:t.appearanceAnimation},on:{"after-leave":t.afterLeave}},[t.visible?i("div",{staticClass:"control",class:t.cssClasses,style:{top:t.y+"px"}},[i("control-icon",{attrs:{selected:t.selected,alt:t.alt,"svg-icon":t.svgIcon,"icon-class":t.iconClass},nativeOn:{click:function(e){return t.onIconClick(e)}}}),t._v(" "),i("transition",{attrs:{name:"panel"}},[t.selected?i(t.panelComponent,{ref:"panel",tag:"component",attrs:{block:t.block,raw_block:t.raw_block},on:{resize:t.onPanelResize},nativeOn:{click:function(e){return t.closePopups(e)}}}):t._e()],1)],1):t._e()])}),[],!1,null,null,null).exports),me=a.a.extend({name:null,panelComponent:null,$el:null,alt:null,saveOnDeselect:!0,saveOnDestroy:!0,waitForRender:function(t,e){return this.isRendered()?t.apply(this,e):z.default.nextTick(function(){return t.apply(this,e)}.bind(this))},initialize:function(t){t=t||{},a.a.prototype.initialize.apply(this,arguments),this.block=this.blocks[0],this.model=t.models&&t.models.length&&t.models[0],this.y=t.y||t.fromY,this.bindShortcuts()},getData:function(){return{cssClass:this.name,panelComponent:this.panelComponent,faded:!1,selected:!1,disabled:!1,y:this.y,visible:!1,alt:this.alt,block:JSON.parse(JSON.stringify(this.model.attributes)),raw_block:this.blocks[0],loading:!1,appearanceAnimation:this.appearanceAnimation}},onModelChange:function(){this.waitForRender(this._onModelChange.bind(this),arguments)},_onModelChange:function(t){this.vue.block=o.a.extend({},this.vue.block,o.a.pick(o.a.cloneWithObjects(t.attributes),(function(t){return void 0!==t})))},onPanelChange:function(t){this.model.set(o.a.cloneWithObjects(t))},render:function(){if(!this.isRendered()){var t=this,e=function(e){var i=e.$emit;e.$emit=function(){t.trigger.apply(t,arguments),i.apply(e,arguments)}};this.vue=new z.default({mixins:[ge],data:this.getData(),mounted:function(){e.called||(e(this),e.called=!0)},updated:function(){e.called||(e(this),e.called=!0)},methods:{afterLeave:function(){this.$el.remove(),this.$destroy()}}}),this.vue.$on("panel-resize",this.onPanelResize),this.vue.visible=!0,this.$container.append('<div id="'+this.name+'">'),this.vue.$mount("#"+this.name),this.$el=Object(u.a)(this.vue.$el),this.on("select",function(){this.master.select(this)}.bind(this)),this.on("deselect",function(){this.master.deselect()}.bind(this)),this.on("change",this.onPanelChange.bind(this)),this.listenTo(this.model,"change",this.onModelChange.bind(this)),this.setControlsStatusByBlockData(),this.block.on("disabledControls:changed",this.onDisabledControlsChanged.bind(this)),this.bindLogic()}},bindShortcuts:function(){this.shortcutHandler=this.master.select.bind(this.master,this),this.keyboardShortcut&&RM.constructorRouter.bindGlobalKeyPress([{key:this.keyboardShortcut,handler:this.shortcutHandler}]),this.onWindowKeyUpBound=this.onWindowKeyUp.bind(this),Object(u.a)(window).on("keyup",this.onWindowKeyUpBound)},unbindShortcuts:function(){this.keyboardShortcut&&RM.constructorRouter.unbindGlobalKeyPress(this.keyboardShortcut,this.shortcutHandler),Object(u.a)(window).off("keyup",this.onWindowKeyUpBound)},isRendered:function(){return Boolean(this.vue)},onPanelResize:function(t){this.$panel=Object(u.a)(t),this.updatePanelVerticalPosition()},select:function(){this.waitForRender(this._select.bind(this),arguments)},_select:function(){this.makeModelSnapshot(),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls")})),o.a.extend(this.vue,{selected:!0,faded:!1}),this.selected=!0},deselect:function(){this.waitForRender(this._deselect.bind(this),arguments)},_deselect:function(){if(this.vue){var t=this.vue.selected;o.a.extend(this.vue,{selected:!1,faded:!1}),this.selected=!1,this.clearModelSnapshot(t)}},fade:function(){this.waitForRender(this._fade.bind(this),arguments)},_fade:function(){this.deselect(),o.a.extend(this.vue,{faded:!0})},setEnabled:function(){this.waitForRender(this._setEnabled.bind(this),arguments)},_setEnabled:function(){this.vue.disabled=!1},setDisabled:function(){this.waitForRender(this._setDisabled.bind(this),arguments)},_setDisabled:function(){o.a.extend(this.vue,{selected:!1,disabled:!0})},canControlBeClosed:function(){this.waitForRender(this._canControlBeClosed.bind(this),arguments)},_canControlBeClosed:function(){return!(!this.vue||!this.vue.selected)&&(this.vue.canClosePanel()&&this.master.deselect(),!0)},moveToNewPos:function(){this.waitForRender(this._moveToNewPos.bind(this),arguments)},_moveToNewPos:function(t){this.vue?this.vue.y=t:this.y=t},onEscKey:function(){this.waitForRender(this._onEscKey.bind(this),arguments)},_onEscKey:function(){this.vue.selected&&this.master.deselect()},save:function(){this.model.save({})},destroy:function(t){this.vue&&(this.vue.visible=!1,t||(this.vue.$el.remove(),this.vue.$destroy()),this.block.off("disabledControls:changed",this.onDisabledControlsChanged),this.unBindLogic(),this.unbindShortcuts(),this.stopListening(this.model,"change"),this.clearModelSnapshot(this.vue.selected))}}),fe=me.extend({name:"common_rotation",alt:"Rotation",panelComponent:"panel-rotation",keyboardShortcut:"r",onPanelChange:function(t){me.prototype.onPanelChange.apply(this,arguments),(this.model.changed.hasOwnProperty("flip_v")||this.model.changed.hasOwnProperty("flip_h"))&&this.model.save({})},select:function(){me.prototype.select.apply(this,arguments),this.block.frame.setRotationState()},deselect:function(){this.block.frame.removeRotationState(),me.prototype.deselect.apply(this,arguments)},restrictions:function(t){var e=t.getSelectedBlocks();return e.length&&!e[0].isFullWidth()&&!e[0].isFullHeight()}}),ve=i("v92f"),be=i("rVpV"),_e=i("L3tv"),ye=i.n(_e),we=(i("jamO"),a.a.extend({saveOnDeselect:!0,saveOnDestroy:!0,name:"common_position",className:"control common_position",events:{"click li":"toggleFixed","click .position-wrapper .sticked-left":"toggleSticked","click .position-wrapper .sticked-right":"toggleSticked","click .position-wrapper .sticked-top":"toggleSticked","click .position-wrapper .sticked-bottom":"toggleSticked","click .position-wrapper .full-width:not(.margin-input):not(.full-screen-video)":"toggleFullWidth","click .position-wrapper .full-height:not(.margin-input):not(.full-screen-video)":"toggleFullHeight","click .position-wrapper .full-screen-video.full-height":"toggleFullScreen","click .position-wrapper .full-screen-video.full-width":"toggleFullScreen","mouseover .position-wrapper .margin-input":"addHoveredClass","mouseleave .position-wrapper .margin-input":"removeHoveredClass","mouseover .position-wrapper .togglers-wrapper .full-height.active":"addFullWidthClass","mouseleave .position-wrapper .togglers-wrapper .full-height":"removeFullWidthClass","focus .position-wrapper .margin-input":"addHoveredClass","focusout .position-wrapper .margin-input":"removeHoveredClass"},POS_LIST:["nw","n","ne","w","c","e","sw","s","se"],ALLOW_FULL_WIDTH:["shape","picture","video","iframe","rmfooter","rmheader","shots"],ALLOW_FULL_HEIGHT:["shape","picture","video","iframe","shots"],initialize:function(t){this.template=ye.a["template-constructor-control-common_position"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},restrictions:function(t){var e={},i=t.getSelectedBlocks();return o.a.reduce(i,(function(n,a){if(!n)return n;if(a.model.get("pack_id")){var s=a.model.get("pack_id");return e[s]?n:(e[s]=o.a.filter(t.blocks,(function(t){return t.model.get("pack_id")===s})),n&&o.a.filter(i,(function(t){return t.model.get("pack_id")===s})).length===e[s].length)}return n}),!0)},bindLogic:function(){var t=Object(o.a)(["fixed_position","is_full_width","full_width_margin","is_full_height","full_height_margin","sticked","sticked_margin","is_global","is_above"]).map((function(t){return"change:"+t})).join(" ");this.listenTo(this.model,t,function(){o.a.defer(this.updatePanel)}.bind(this))},unBindLogic:function(){this.stopListening(this.model)},select:function(){this.updatePanel(),a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-common_position")}))},updateModel:function(t){this.model.set(t)},render:function(){var t=!!a.a.prototype.render.apply(this,arguments);if(t){this.$fullwidthMarginInput=Object(u.a)(this.$(".full-width.margin-input")),this.$fullwidthMarginInput.RMNumericInput({onChange:function(t,e){this.setFullwidth()}.bind(this)}),this.$fullheightMarginInput=Object(u.a)(this.$(".full-height.margin-input")),this.$fullheightMarginInput.RMNumericInput({onChange:function(t,e){this.setFullheight()}.bind(this)}),Object(u.a)(this.$(".margin-input")).RMDrag({start:this.addHoveredClass,end:this.removeHoveredClass,silent:!0});var e={width:40,height:24,"color-0":"#0078ff","color-1":"#c9c8c9","text-0":"","text-1":""},i=!1;if(this.blocks&&this.blocks[0]&&this.blocks[0].mag&&this.blocks[0].workspace.eCommerceManager.haveEcommerceCartWidget){var n=this.blocks.find((function(t){return t.blockName===St.a.ecommerceCartBlockName}));n&&(i=!0)}var s=function(t,e){var i=!0,n=!0;o.a.each(this.blocks,(function(t){t.model.get(e)||(i=!1),t.model.get(e)&&(n=!1)})),i||n?t.setState(i,!0):t.setUndefinedState()}.bind(this);return this.globalSwitcher=Object(u.a)(this.$(".switcher.global")).RMSwitcher(i?Object.assign({},e,{disabled:!0}):e,function(t){this.setGlobal(t)}.bind(this)).data("switcher"),s(this.globalSwitcher,"is_global"),this.aboveSwitcher=Object(u.a)(this.$(".switcher.above")).RMSwitcher(e,function(t){this.setAbove(t)}.bind(this)).data("switcher"),s(this.aboveSwitcher,"is_above"),this.updatePanel(),this}this.updatePanel()},addFullWidthClass:function(){Object(u.a)(".position-wrapper .togglers-wrapper .full-width.active").addClass("light-blue")},removeFullWidthClass:function(){var t=Object(u.a)(".position-wrapper .togglers-wrapper .full-width");t.hasClass("light-blue")&&t.removeClass("light-blue")},addHoveredClass:function(t){Object(u.a)(t.currentTarget).hasClass("full-width")?this.$el.removeClass("full-height-hovered"):this.$el.removeClass("full-width-hovered"),this.$el.addClass(t.currentTarget.classList[0]+"-hovered")},removeHoveredClass:function(t){o.a.defer(function(){Object(u.a)(t.target).hasClass("dragging")||Object(u.a)(t.target).hasClass("focused")||this.$el.removeClass(this.$el.hasClass("full-width-hovered")?"full-width-hovered":"full-height-hovered")}.bind(this))},toggleFixed:function(t){var e=Object(u.a)(t.currentTarget),i=this.POS_LIST[e.index()];e.hasClass("active")?this.resetFixed(i):this.setFixed(i)},toggleFullScreen:function(){var t=Object(u.a)(".position-wrapper .full-width:not(.margin-input)"),e=Object(u.a)(".position-wrapper .full-height:not(.margin-input)");t.hasClass("disabled")||e.hasClass("disabled")||(t.hasClass("active")&&!e.hasClass("active")?this.setFullheight({storeHeight:!0}):t.hasClass("active")||e.hasClass("active")?(this.resetFullheight(),this.resetFullwidth()):(this.setFullheight({storeHeight:!0}),this.setFullwidth({storeWidth:!0})))},setFixedPositionInViewports:function(){var t=this,e=this.master.workspace.page.getCurrentViewport(),i=this.getBlocksWithHotspotBlocks(),n={};o.a.each(i,function(t){var i=t.model,a=e;o.a.each(ve.b.viewport_listall,function(e){var s=(e=e.replace("viewport_",""))!==a?i["viewport_"+e]:i.attributes,r=!o.a.isEmpty(s),l=r&&!s.fixed_position,c=r&&!s.hidden;r&&l&&(e!==a&&c?(a=e,n[e]=n[e]||[],n[e].push(t)):c?(n[e]=n[e]||[],n[e].push(t)):s.fixed_position="n")}.bind(this))}.bind(this)),o.a.each(n,(function(i,n){n=n.replace("viewport_",""),o.a.each(i,(function(t){if(n!==e){var i=t.model;i.storeViewport(e),i.restoreViewport(n)}})),t.setFixed("c",i),o.a.each(i,(function(t){if(n!==e){var i=t.model;i.storeViewport(n),i.restoreViewport(e)}}))})),this.master.workspace.set_group(o.a.pluck(i,"model"))},updatePageIndex:function(t){Object(n.a)("constructor.zIndex")&&RM.constructorRouter.indexController.updateIndex(this.master.workspace.page,o.a.map(t,(function(t){return t.model})),!1)},setFixed:function(t,e){e=e?o.a.isArray(e)?e:[e]:this.blocks,this.resetSticked(e);var i=[],a={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY},s=this,r=o.a.max(this.master.workspace.blocks,(function(t){return t.model.get("z")})).model.get("z"),l=o.a.min(this.blocks,(function(t){return t.model.get("z")})).model.get("z");o.a.each(e||this.blocks,(function(t){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});a.t=Math.min(a.t,e.bb_y),a.l=Math.min(a.l,e.bb_x),a.b=Math.max(a.b,e.bb_y+e.bb_h),a.r=Math.max(a.r,e.bb_x+e.bb_w)})),o.a.each(e,(function(e){var c=0,d=0,h=e.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});-1!=["n","c","s"].indexOf(t)&&(c=h.w/2-(a.r-a.l)/2),-1!=["w","c","e"].indexOf(t)&&(d=h.h/2-(a.b-a.t)/2),t.indexOf("s")>-1?0!==(d=h.y-a.b+h.h-d)&&(d*=-1):d+=h.y-a.t,t.indexOf("e")>-1?0!==(c=h.x-a.r+h.w-c)&&(c*=-1):c+=h.x-a.l;var u={_id:e.model.id,fixed_position:t,x:c,y:d};Object(n.a)("constructor.zIndex")||e.model.get("fixed_position")||(u.z=e.model.get("z")+r-l+1),o.a.defer(function(){e.model.get("is_full_height")&&s.setFullheight()}.bind(s)),i.push(u)})),this.master.workspace.set_group(i),this.updatePageIndex(e)},resetFixed:function(t){var e=[],i=this;o.a.each(this.blocks,(function(n){if(n.model.get("fixed_position")&&(!t||n.model.get("fixed_position")==t)){var a=n.$el.offset(),s=n.workspace.position;e.push({_id:n.model.id,fixed_position:"",x:a.left-s.left,y:a.top-s.top}),o.a.defer(function(){n.model.get("is_full_height")&&i.setFullheight()}.bind(i))}})),o.a.isEmpty(e)||(this.master.workspace.set_group(e),this.setAbove(!1))},toggleFullHeight:function(t){var e=Object(u.a)(t.currentTarget);e.hasClass("disabled")||(e.hasClass("active")?(this.removeFullWidthClass(),this.resetFullheight()):this.setFullheight({storeHeight:!0}))},toggleFullWidth:function(t){var e=Object(u.a)(t.currentTarget);e.hasClass("disabled")||e.hasClass(".full-screen-video")||(e.hasClass("active")?this.resetFullwidth():this.setFullwidth({storeWidth:!0}))},setFullheight:function(t){this.resetSticked(null,{vertical_only:!0}),t=t||{};var e=[],i=parseInt(this.$fullheightMarginInput.val(),10)||0,n=this.block.getFullHeightDims(i);o.a.each(this.blocks,(function(a){var s={_id:a.model.get("_id"),is_full_height:!0,h:n.h,full_height_margin:i};t.storeHeight&&(o.a.extend(s,{full_height_initial_y:a.model.get("y"),full_height_initial_h:a.model.get("h")}),a.model.get("angle")&&(s.angle=0),a.model.get("flip_v")&&(s.flip_v=!1),a.model.get("flip_h")&&(s.flip_h=!1)),e.push(s)})),this.master.workspace.set_group(e)},setFullwidth:function(t){this.resetSticked(null,{horizontal_only:!0}),t=t||{};var e=[],i=parseInt(this.$fullwidthMarginInput.val(),10)||0,n=this.block.getFullWidthDims(i);o.a.each(this.blocks,(function(a){var s={_id:a.model.get("_id"),is_full_width:!0,w:n.w,full_width_margin:i};t.storeWidth&&(o.a.extend(s,{full_width_initial_x:a.model.get("x"),full_width_initial_w:a.model.get("w")}),a.model.get("angle")&&(s.angle=0),a.model.get("flip_v")&&(s.flip_v=!1),a.model.get("flip_h")&&(s.flip_h=!1)),e.push(s)})),this.master.workspace.set_group(e)},resetFullheight:function(){var t=[],e=this;o.a.each(this.blocks,(function(i){i.model.get("is_full_height")&&t.push({_id:i.model.get("_id"),is_full_height:!1,y:i.model.get("full_height_initial_y")||i.model.get("y"),h:i.model.get("full_height_initial_h")||i.model.get("h")}),i.model.get("is_full_width")&&t.push({_id:i.model.get("_id"),w:i.getFullWidthDims().w}),o.a.defer(function(){i.model.get("fixed_position")&&e.setFixed(i.model.get("fixed_position"),i)}.bind(e))})),o.a.isEmpty(t)||this.master.workspace.set_group(t)},resetFullwidth:function(){var t=[],e=this;o.a.each(this.blocks,(function(i){i.model.get("is_full_width")&&t.push({_id:i.model.get("_id"),is_full_width:!1,x:i.model.get("full_width_initial_x")||i.model.get("x"),w:i.model.get("full_width_initial_w")||i.model.get("w")}),i.model.get("is_full_height")&&t.push({_id:i.model.get("_id"),h:i.getFullHeightDims().h}),o.a.defer(function(){i.model.get("fixed_position")&&e.setFixed(i.model.get("fixed_position"),i)}.bind(e))})),o.a.isEmpty(t)||this.master.workspace.set_group(t)},toggleSticked:function(t){var e=Object(u.a)(t.currentTarget),i=e.attr("data-side");e.hasClass("disabled")||(e.hasClass("active")?this.resetSticked(null,{side:i}):this.setSticked(i))},setSticked:function(t){this.resetFixed(),"left"!=t&&"right"!=t||this.resetFullwidth(),"top"!=t&&"bottom"!=t||this.resetFullheight();var e={t:Number.POSITIVE_INFINITY,l:Number.POSITIVE_INFINITY,b:Number.NEGATIVE_INFINITY,r:Number.NEGATIVE_INFINITY};o.a.each(this.blocks,(function(t){var i=t.getBoxData({includeBoundingBox:!0});e.t=Math.min(e.t,i.bb_y),e.l=Math.min(e.l,i.bb_x),e.b=Math.max(e.b,i.bb_y+i.bb_h),e.r=Math.max(e.r,i.bb_x+i.bb_w)}));var i=[];o.a.each(this.blocks,(function(n){var o=0,a=n.getBoxData({includeBoundingBox:!0});"left"==t?o=a.x-e.l:"right"==t?o=(e.r-(a.x+a.w))/RM.constructorRouter.zoom.getZoom():"top"==t?o=a.y-e.t:"bottom"==t&&(o=e.b-(a.y+a.h));var s=n.getStickedDims(t,o);i.push({_id:n.model.id,sticked:t,sticked_margin:o,x:s.x,y:s.y})})),o.a.isEmpty(i)||(this.master.workspace.set_group(i),this.setAbove(!1)),"top"==t?this.master.workspace.scrollToTop():"bottom"==t&&this.master.workspace.scrollToBottom()},resetSticked:function(t,e){e=e||{};var i=[];o.a.each(t||this.blocks,(function(t){var n=t.model.get("sticked");if(n&&(!e.side||n==e.side)){if(e.horizontal_only&&"left"!==n&&"right"!==n)return;if(e.vertical_only&&"bottom"!==n&&"top"!==n)return;var o=t.getStickedDims();i.push({_id:t.model.id,sticked:"",x:o.x,y:o.y})}})),o.a.isEmpty(i)||this.master.workspace.set_group(i)},setGlobal:function(t){var e,i=[],n=this.getBlocksWithHotspotBlocks();o.a.each(n,(function(e){i.push({_id:e.model.id,is_global:t})})),t?o.a.each(n,function(t){var e=this.master.workspace.page.getCurrentViewport();be.a.resetGlobalData(t.model,e)}.bind(this)):(e=this.master.workspace.mag.changeParentPage(o.a.pluck(n,"model"),this.master.workspace.page,{silent:!0}),this.changedPages=this.changedPages||new Backbone.Collection,this.changedPages.add(e),this.aboveSwitcher.setState(t)),o.a.isEmpty(i)||(this.master.workspace.set_group(i),this.updatePageIndex(n),this.master.workspace.trigger("widget:context:change",n))},setAbove:function(t){var e=[],i=this.getBlocksWithHotspotBlocks();void 0!==t&&this.aboveSwitcher&&this.aboveSwitcher.setState(t),t&&this.globalSwitcher.setState(t),o.a.each(i,(function(i){e.push({_id:i.model.id,is_above:t})})),t&&this.setFixedPositionInViewports(),RM.constructorRouter.workspace.common_layer&&RM.constructorRouter.workspace.common_layer.fixBadZIndexes(),o.a.isEmpty(e)||(this.master.workspace.set_group(e),this.updatePageIndex(i),this.master.workspace.trigger("widget:context:change",i))},getBlocksWithHotspotBlocks:function(){var t=[];return o.a.each(this.blocks,(function(e){"hotspot"==e.model.get("type")&&(t=o.a.union(t,e.getGroupBlocks()))})),o.a.union(t,this.blocks)},updatePanel:function(){var t=!0,e=!0,i=!1,n=!1,a=!1,s=!1,r=!1,l=!1,c=!1,d=!1,h=!1,u=!0,p=0,g=0,m=!1,f=this.$("ul li").removeClass("active"),v="default"==this.master.workspace.page.getCurrentViewport();o.a.each(this.blocks,function(v){if(i=i||"left"==v.model.get("sticked"),n=n||v.model.get("is_full_width"),a=a||v.model.get("is_full_height"),s=s||"right"==v.model.get("sticked"),r=r||"top"==v.model.get("sticked"),l=l||"bottom"==v.model.get("sticked"),d=d||v.model.get("fixed_position"),h=d||v.model.get("is_global"),u=u&&v.model.get("is_global"),c=v.model.get("video_id"),m=m||v.model.get("type")===St.a.ecommerceCartBlockName,t=t&&o.a.contains(this.ALLOW_FULL_WIDTH,v.model.get("type"))&&!("shape"==v.model.get("type")&&"icon"==v.model.get("tp")),e=e&&o.a.contains(this.ALLOW_FULL_HEIGHT,v.model.get("type"))&&!("shape"==v.model.get("type")&&("icon"==v.model.get("tp")||"line"==v.model.get("tp"))),v.model.get("fixed_position")&&!v.restoreFixed){var b=this.POS_LIST.indexOf(v.model.get("fixed_position"));f.eq(b).addClass("active")}v.model.get("is_full_width")&&(p=Math.max(p,v.model.get("full_width_margin")||0)),v.model.get("is_full_height")&&(g=Math.max(g,v.model.get("full_height_margin")||0))}.bind(this)),u&&this.globalSwitcher.setState(!0,!0),m&&this.globalSwitcher.setDisabled(!0),this.$fullwidthMarginInput.val(p),this.$fullheightMarginInput.val(g),this.$(".position-wrapper .sticked-left").toggleClass("disabled",!v).toggleClass("active",!!i),this.$(".position-wrapper .full-width").toggleClass("disabled",!v).toggleClass("hidden",!t).toggleClass("active",!!n).toggleClass("full-screen-video",!!c&&!!n&&!!a),this.$(".position-wrapper .full-height").toggleClass("disabled",!v).toggleClass("hidden",!e).toggleClass("active",!!a).toggleClass("full-screen-video",!!c),this.$(".position-wrapper .sticked-right").toggleClass("disabled",!v).toggleClass("active",!!s),this.$(".position-wrapper .sticked-top").toggleClass("disabled",!v).toggleClass("active",!!r),this.$(".position-wrapper .sticked-bottom").toggleClass("active",!!l),this.$el.toggleClass("full-width-margin",!(!t||!n)&&v).toggleClass("full-height-margin",!(!e||!a)&&v).toggleClass("control-active",!!(i||n||a||s||r||l||d||h)),this.updatePanelVerticalPosition()},save:function(){var t=o.a.pluck(this.getBlocksWithHotspotBlocks(),"model");o.a.isEmpty(this.changedPages)||(t=t.concat(this.changedPages.models));var e=this.master.workspace.page.getCurrentViewport();"default"!=e&&o.a.each(t,(function(t){t.storeViewport(e)})),this.master.workspace.save_group(t,{viewport:"default"}),Object(n.a)("constructor.zIndex")&&o.a.each(RM.constructorRouter.indexController.getPagesToSave(),(function(t){t.save(null,{silent:!0})})),"default"!==e&&o.a.each(t,(function(t){t.restoreViewport(e)})),this.master.workspace.common_layer.fixBadZIndexes()}})),ke=i("Fts9"),Se=i("amZL"),xe=i("qOkM"),Ce=i.n(xe),Oe=m.extend({name:"text_styles",className:"control text_styles",MIN_PANEL_HEIGHT:275,MAX_PANEL_HEIGHT:640,STYLE_PROPERTIES:["color","opacity","font-family","font-size","font-style","font-weight","letter-spacing","line-height","text-align","text-decoration","text-transform","vertical-align","padding-top","padding-right","padding-bottom","padding-left"],saveOnDestroy:!0,initialize:function(t){this.template=Ce.a["template-constructor-control-text_styles"],this.style_template=Ce.a["template-constructor-control-text_styles-style"],this.initControl(t),this.block=this.blocks[0],this.refreshEditorCssDebounced=o.a.debounce(this.refreshEditorCss,100)},bindLogic:function(){this.textStyles=RM.constructorRouter.textStyles,this.textStyles.on("change:paragraph_styles",this.onStylesChange),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".paragraph-style",this.onParagraphStyleClick),this.$panel.on("click",".paragraph-style .tag-changer",this.changeStyleTag),this.$panel.on("click",".paragraph-style .menu-button",this.toggleMenu),this.$panel.on("click",".style-menu .redefine-button",this.onRedefineClick),this.$panel.on("click",".style-menu .revert-button",this.onRevertClick),this.$panel.on("click",".style-menu .edit-button",this.onEditClick),this.$panel.on("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.on("click",".style-menu .delete-button",this.onDeleteClick),this.params=this.block&&this.block.params||{},this.block&&this.block.on("selection_styles_all_changed",this.selectionStylesAllChanged.bind(this)),Object(u.a)(this.$panel.find(".styles-wrapper")).sortable({distance:10,axis:"y",scrollSpeed:20,containment:"parent",tolerance:"pointer",start:o.a.bind((function(t,e){this.closeMenu(!1)}),this),stop:o.a.bind((function(t,e){this.reorder()}),this)}),this.renderParagraphStyles(),this.$panel.on("click",".add-block .save",this.saveEditClick),this.$panel.on("click",".add-block .cancel",this.cancelEditClick),this.$panel.on("input",".edit-content .caption",this.onEditCaptionChange),this.$panel.on("click",".edit-content .switcher",this.onSwitcherClick),this.$panel.on("click",".edit-content .color-click-area",this.onColorboxShowClick),this.$panel.on("click",".edit-content .font-family-click-area",this.onFontSelectorShowClick),this.$panel.on("click",".edit-content .font-style-click-area",this.onFontStyleShowClick),this.$panel.on("click",".edit-scroll-wrapper",this.closeAllEditPopups),this.$panel.on("dblclick",".paragraph-style",this.onDoubleClick),this.$panel.on("click",".edit-content .tag-changer",this.changeStyleTag),this.colorbox=new ke.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.fontselector=new Se.a({$parent:this.$(".fontselector_container")}),this.fontselector.on("selectfont",this.fontChanged),this.editFontSizeChangeValue=Object(u.a)(this.$panel.find(".edit-content .font-size")).RMNumericInput({min:this.params.minFontSize,max:this.params.maxFontSize,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editLineHeightChangeValue=Object(u.a)(this.$panel.find(".edit-content .line-height")).RMNumericInput({min:this.params.minLineHeight,max:this.params.maxLineHeight,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editLetterSpacingChangeValue=Object(u.a)(this.$panel.find(".edit-content .letter-spacing")).RMNumericInput({min:this.params.minLetterSpacing,max:this.params.maxLetterSpacing,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingLeftChangeValue=Object(u.a)(this.$panel.find(".edit-content .padding-left")).RMNumericInput({min:0,max:999,mouseSpeed:4,mouseDir:"h",onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingRightChangeValue=Object(u.a)(this.$panel.find(".edit-content .padding-right")).RMNumericInput({min:0,max:999,mouseSpeed:4,mouseDir:"h",invertMouse:!0,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingTopChangeValue=Object(u.a)(this.$panel.find(".edit-content .padding-top")).RMNumericInput({min:0,max:999,mouseSpeed:4,invertMouse:!0,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingBottomChangeValue=Object(u.a)(this.$panel.find(".edit-content .padding-bottom")).RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editScroll=Object(u.a)(this.$el.find(".edit-scroll-wrapper")).RMScroll({$container:this.$el.find(".edit-content-wrapper"),$content:this.$el.find(".edit-content"),$handle:this.$el.find(".edit-scroll"),wheelScrollSpeed:.4,gap_start:16,gap_end:16,onScroll:this.onEditScroll.bind(this)}).data("scroll")},unBindLogic:function(){this.block.off(null,null,this),this.textStyles.off("change:paragraph_styles",this.onStylesChange),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".paragraph-style",this.onParagraphStyleClick),this.$panel.off("click",".paragraph-style .tag-changer",this.changeStyleTag),this.$panel.off("click",".paragraph-style .menu-button",this.toggleMenu),this.$panel.off("click",".style-menu .redefine-button",this.onRedefineClick),this.$panel.off("click",".style-menu .revert-button",this.onRevertClick),this.$panel.off("click",".style-menu .edit-button",this.onEditClick),this.$panel.off("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.off("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.off("dblclick",".paragraph-style",this.onDoubleClick),this.$panel.off("click",".edit-content .tag-changer",this.changeStyleTag),this.block&&this.block.off("selection_styles_all_changed",this.selectionStylesAllChanged),this.$panel.off("click",".add-block .save",this.saveEditClick),this.$panel.off("click",".add-block .cancel",this.cancelEditClick),this.$panel.off("input",".edit-content .caption",this.onEditCaptionChange),this.$panel.off("click",".edit-content .switcher",this.onSwitcherClick),this.$panel.off("click",".edit-content .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-content .font-family-click-area",this.onFontSelectorShowClick),this.$panel.off("click",".edit-content .font-style-click-area",this.onFontStyleShowClick),this.$panel.off("click",".edit-scroll-wrapper",this.closeAllEditPopups),this.colorbox&&this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox&&this.colorbox.destroy(),this.colorbox=null,this.fontselector&&this.fontselector.off("selectfont",this.fontChanged),this.fontselector&&this.fontselector.destroy(),this.fontselector=null},onStylesChange:function(t,e,i){(i=i||{}).socketUpdate&&this.renderParagraphStyles()},renderParagraphStyles:function(){var t=this.textStyles.getStylesListSorted("paragraph"),e="";o.a.each(t,(function(t){e+=this.style_template(t)}),this),this.$panel.find(".styles-wrapper").html(e),this.resizableScroll&&this.resizableScroll.recalc(),Object(u.a)(this.$panel.find(".styles-wrapper")).sortable("refresh")},reorder:function(){var t=[];this.$(".paragraph-style").each((function(){t.push(Object(u.a)(this).attr("data-id"))})),this.textStyles.reorder("paragraph",t)},selectionStylesAllChanged:function(t){if(this.selected){var e={};this.$(".paragraph-style.active").each((function(){e[Object(u.a)(this).attr("data-id")]=!0})),this.closeMenu(!0);var i={},n={};o.a.each(t,o.a.bind((function(t,e){var a=this.textStyles.findStyle("paragraph",t["paragraph-class"]),s=a?a._name:"",r=o.a.pick.apply(void 0,o.a.union([t],this.STYLE_PROPERTIES)),l=o.a.values(r).join("|");if(i[s]||(i[s]={}),n[l]=!0,0==e&&this.$panel.find(".add-block .add").attr("data-redefine",l),a){var c=o.a.pick.apply(void 0,o.a.union([a],this.STYLE_PROPERTIES));l!=o.a.values(c).join("|")&&(i[s][l]=!0)}else i[s][l]=!0}),this)),this.$(".paragraph-style").removeClass("active is-changed can-redefine can-override"),o.a.each(i,o.a.bind((function(t,e){if(e){var i=this.$('.paragraph-style[data-id="'+e+'"]');i.addClass("active"),o.a.isEmpty(t)||i.addClass("is-changed can-override")}else this.$('.paragraph-style[data-id="paragraph-none"]').addClass("active")}),this));var a=o.a.keys(n).length;if(a<=2){var s=o.a.keys(n);this.$(".paragraph-style").each(o.a.bind((function(t,e){var i=Object(u.a)(e),n=this.textStyles.findStyle("paragraph",i.attr("data-id"));if(n){var r,l=o.a.pick.apply(void 0,o.a.union([n],this.STYLE_PROPERTIES)),c=o.a.values(l).join("|");1==a&&c!=s[0]&&(r=s[0]),2==a&&c==s[0]&&(r=s[1]),2==a&&c==s[1]&&(r=s[0]),r&&i.addClass("can-redefine").attr("data-redefine",r)}}),this))}var r={};if(this.$(".paragraph-style.active").each((function(){r[Object(u.a)(this).attr("data-id")]=!0})),!o.a.isEqual(e,r)){var l=this.$(".paragraph-style.active").first();if(l.length){var c,d=this.$panel.find(".resizable-content-wrapper"),h=l.position().top,p=d.height(),g=l.outerHeight();h+g-d.scrollTop()>p-8?c=h+g-p+8:h-d.scrollTop()<8&&(c=h-8),null!=c&&d.stop().animate({scrollTop:c},200)}}}},onParagraphStyleClick:function(t){if(!Object(u.a)(t.target).closest(".menu-button").length&&!Object(u.a)(t.target).closest(".tag-changer").length){var e=Object(u.a)(t.target).closest(".paragraph-style").attr("data-id");this.block&&("paragraph-none"==e?this.block.trigger("changeClassParagraph",{remove:!0}):this.block.trigger("changeClassParagraph",{class:e}))}},getNextStyleTag:function(t){var e=St.a.AVAILABLE_TEXT_TAGS,i=e.indexOf(t);return i>-1?e[i+1]||e[0]:t},changeStyleTag:function(t){if(this.currentEditStyle){var e=this.getNextStyleTag(this.currentEditStyle.tag||"p");this.currentEditStyle.tag=e,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced(),this.renderParagraphStyles()}else{var i=Object(u.a)(t.target),n=i.closest(".paragraph-style"),o=n.attr("data-id"),a=n.attr("data-tag"),s=this.textStyles.findStyle("paragraph",o);s.tag=this.getNextStyleTag(a),this.textStyles.changeStyle("paragraph",s._name),i.text(s.tag),n.attr("data-tag",s.tag)}},toggleMenu:function(t){var e=Object(u.a)(t.currentTarget),i=e.hasClass("active"),n=this.$(".style-menu");i?this.closeMenu(!0):(this.$(".paragraph-style .menu-button.active").length>0&&this.closeMenu(!1),setTimeout(o.a.bind((function(){var t=e.closest(".paragraph-style"),i=t.position().top+e.position().top+e.height()-this.$panel.find(".resizable-content-wrapper").scrollTop()-5;n.css("top",i).addClass("shown").attr("data-id",t.attr("data-id")).toggleClass("can-redefine",t.hasClass("can-redefine")).toggleClass("can-override",t.hasClass("can-override")),e.addClass("active")}),this),40))},closeMenu:function(t){var e=this.$(".style-menu");t||e.removeClass("transition-enable"),e.removeClass("shown"),t||setTimeout((function(){e.addClass("transition-enable")}),20),this.$(".paragraph-style .menu-button").removeClass("active")},onPanelScroll:function(t){this.closeMenu(!0)},onRedefineClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu"),i=this.$('.paragraph-style[data-id="'+e.attr("data-id")+'"]').attr("data-redefine"),n=o.a.object(this.STYLE_PROPERTIES,i.split("|"));this.textStyles.redefineStyle("paragraph",e.attr("data-id"),n),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleRedefined")},onRevertClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id");this.block&&("paragraph-none"==e?this.block.trigger("changeClassParagraph",{remove:!0,override:!0}):this.block.trigger("changeClassParagraph",{class:e,override:!0}))},onDuplicateClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.textStyles.duplicateStyle("paragraph",e),n=this.$('.paragraph-style[data-id="'+e+'"]');if(i){RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(u.a)(this.style_template(i));a.addClass("enable-transition").css("margin-top",-n.outerHeight()),a.insertAfter(n),setTimeout(o.a.bind((function(){a.css("margin-top",0),setTimeout(o.a.bind((function(){a.removeClass("enable-transition"),Object(u.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)}},onDeleteClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.$('.paragraph-style[data-id="'+e+'"]');this.closeMenu(!0),i.addClass("enable-transition"),setTimeout(o.a.bind((function(){i.addClass("shift-left"),setTimeout(o.a.bind((function(){i.css("margin-top",-i.outerHeight()),setTimeout(o.a.bind((function(){i.remove(),Object(u.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc(),RM.constructorRouter.textStyles.deleteStyle("paragraph",e),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleDeleted")}),this),270)}),this),270)}),this),50)},addClick:function(t){var e=Object(u.a)(t.currentTarget).attr("data-redefine"),i=o.a.object(this.STYLE_PROPERTIES,e.split("|")),n=this.textStyles.addStyle("paragraph",i);RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(u.a)(this.style_template(n));a.addClass("enable-transition").addClass("collapsed"),this.$panel.find(".styles-wrapper").append(a);var s=Object(u.a)(a).closest(".paragraph-style").attr("data-id");this.block&&this.block.trigger("changeClassParagraph",{class:s}),this.$el.find(".resizable-content-wrapper").scrollTop(9999),setTimeout(o.a.bind((function(){a.removeClass("collapsed"),setTimeout(o.a.bind((function(){a.removeClass("enable-transition"),Object(u.a)(this.$panel.find(".styles-wrapper")).sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)},onScrollRecalc:function(t){this.editScroll&&this.editScroll.recalc()},openMenu:function(t){var e=this.textStyles.findStyle("paragraph",t);this.originalEditStyle=o.a.clone(e),this.currentEditStyle=e,this.setEditParams(this.currentEditStyle),this.$panel.addClass("toggle-opaque"),this.closeMenu(!0),setTimeout(o.a.bind((function(){this.$panel.addClass("show-style-edit")}),this),300)},onEditClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id");this.openMenu(e)},onDoubleClick:function(t){var e=Object(u.a)(t.target).closest(".paragraph-style").attr("data-id");this.openMenu(e)},editClose:function(){this.closeAllEditPopups(),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("paragraph","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleChanged"),this.$panel.removeClass("show-style-edit"),setTimeout(o.a.bind((function(){this.$panel.removeClass("toggle-opaque")}),this),400),this.currentEditStyle=void 0},setEditParams:function(t){var e=this.$panel.find(".edit-content");e.find(".caption").val(t._caption);var i=RM.constructorRouter.fonts.findFontByCSSName(t["font-family"]);e.find(".font-family").text(i.name).css("font-family",i.css_name);var n=RM.constructorRouter.fonts.getStyleName(t["font-weight"],t["font-style"],i.name);e.find(".font-style").text(n).css({"font-family":i.css_name,"font-style":t["font-style"],"font-weight":t["font-weight"]}),e.find(".color-value").text("#"+t.color),e.find(".color-circle").css({background:"#"+t.color,opacity:t.opacity/100}),this.editFontSizeChangeValue(t["font-size"],!0),this.editLineHeightChangeValue(t["line-height"],!0),this.editLetterSpacingChangeValue(t["letter-spacing"],!0),e.find(".text-align-left").toggleClass("active","left"==t["text-align"]),e.find(".text-align-center").toggleClass("active","center"==t["text-align"]),e.find(".text-align-right").toggleClass("active","right"==t["text-align"]),e.find(".text-align-justify").toggleClass("active","justify"==t["text-align"]),e.find(".text-transform").toggleClass("active","uppercase"==t["text-transform"]),e.find(".text-underline").toggleClass("active","underline"==t["text-decoration"]),e.find(".text-strike").toggleClass("active","line-through"==t["text-decoration"]),this.editPaddingLeftChangeValue(t["padding-left"],!0),this.editPaddingRightChangeValue(t["padding-right"],!0),this.editPaddingTopChangeValue(t["padding-top"],!0),this.editPaddingBottomChangeValue(t["padding-bottom"],!0),e.find(".tag-changer span").text(t.tag||"p")},onEditCaptionChange:function(t){this.currentEditStyle._caption=Object(u.a)(t.target).val()},onEditInputChanged:function(t,e){this.currentEditStyle[t.attr("data-param")]=e,this.refreshEditorCssDebounced()},onSwitcherClick:function(t){var e=Object(u.a)(t.target).attr("data-param"),i=Object(u.a)(t.target).attr("data-val");this.currentEditStyle[e]==i?this.currentEditStyle[e]="text-align"==e?"start":"none":this.currentEditStyle[e]=i,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},colorOpacityChanged:function(t,e,i,n){this.currentEditStyle.color=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle.opacity=100*n,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},fontChanged:function(t){this.currentEditStyle["font-family"]=t,this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced()},styleChanged:function(t){this.currentEditStyle["font-weight"]=Object(u.a)(t.currentTarget).attr("data-font-weight"),this.currentEditStyle["font-style"]=Object(u.a)(t.currentTarget).attr("data-font-style"),this.setEditParams(this.currentEditStyle),this.refreshEditorCssDebounced(),this.closeFontStyle()},refreshEditorCss:function(){RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.block.iframe_document),this.block.somethingChangedInEditor("styleChanging")},onColorboxShowClick:function(t){this.colorbox_visible?this.closeColorBox():(this.closeAllEditPopups(),this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(200),this.colorbox.setOpacity(this.currentEditStyle.opacity/100),this.colorbox.setColor(this.currentEditStyle.color),this.positionPopup(this.$(".colorbox_container"),this.$(".edit-content .color-click-area")))},onFontSelectorShowClick:function(t){this.fontselector_visible?this.closeFontSelector():(this.closeAllEditPopups(),this.fontselector_visible=!0,this.fontselector&&this.fontselector.show([this.currentEditStyle["font-family"]]),this.positionPopup(this.$(".fontselector_container"),this.$(".edit-content .font-family-click-area")))},onFontStyleShowClick:function(t){if(this.fontstyle_visible)this.closeFontStyle();else{this.closeAllEditPopups();var e=this.$(".fontstyle_container .font-style-wrapper");e.empty();var i=RM.constructorRouter.fonts.findFontByCSSName(this.currentEditStyle["font-family"]);i&&(o.a.each(i.variations,o.a.bind((function(t){var n=100*(t.substr(1,1)-0),o="n"==t.substr(0,1)?"normal":"italic",a=RM.constructorRouter.fonts.getStyleName(n,o,i.name),s=Object(u.a)("<div>").appendTo(e).addClass("font-style-item").text(a).css({"font-family":i.css_name,"font-weight":n+"","font-style":o}).attr("data-font-weight",n).attr("data-font-style",o).on("click",this.styleChanged);Object(u.a)("<div>").appendTo(s).addClass("point");n==this.currentEditStyle["font-weight"]&&o==this.currentEditStyle["font-style"]&&s.addClass("curr")}),this)),this.fontstyle_visible=!0,this.$(".fontstyle_container").fadeIn(200),this.positionPopup(this.$(".fontstyle_container"),this.$(".edit-content .font-style-click-area")))}},positionPopup:function(t,e){var i=t.children().first().height(),n=this.$panel.height(),o=Math.floor((n-i)/2),a=e.position().top-this.$panel.find(".edit-content-wrapper").scrollTop();t.css({top:Math.min(o,a)})},closeColorBox:function(){this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(200)},closeFontSelector:function(){this.fontselector_visible=!1,this.fontselector.hide()},closeFontStyle:function(){this.fontstyle_visible=!1,this.$(".fontstyle_container").fadeOut(200)},closeAllEditPopups:function(t){if(t){if(Object(u.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(u.a)(t.target).closest(".color-click-area").length>0)return;if(Object(u.a)(t.target).closest(".fontselector_container").length>0)return;if(Object(u.a)(t.target).closest(".font-family-click-area").length>0)return;if(Object(u.a)(t.target).closest(".fontstyle_container").length>0)return;if(Object(u.a)(t.target).closest(".font-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.fontselector_visible&&this.closeFontSelector(),this.fontstyle_visible&&this.closeFontStyle()},onEditScroll:function(){this.closeAllEditPopups()},saveEditClick:function(){this.$('.paragraph-style[data-id="'+this.currentEditStyle._name+'"]').find(".style-caption").text(this.currentEditStyle._caption),this.textStyles.changeStyle("paragraph",this.currentEditStyle._name),this.editClose()},onEnterKey:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick()},cancelEditClick:function(){this.textStyles.restoreStyle("paragraph",this.currentEditStyle._name,this.originalEditStyle),this.editClose()},save:function(){o.a.isEqual(this.textStyles.getOrder("paragraph"),this.textStyles.orderBefore.paragraph)||this.textStyles.save()},deselect:function(){this.closeAllEditPopups(),m.prototype.deselect.apply(this,arguments)},destroy:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick(),this.save(),m.prototype.destroy.apply(this,arguments)},select:function(){m.prototype.select.apply(this,arguments),this.block&&this.selectionStylesAllChanged(this.block.cur_selection_styles_all),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_styles")}))},onClick:function(){if(this.selected){if(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0)}m.prototype.onClick.apply(this,arguments)},onEscKey:function(){if(this.selected){if(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0)}m.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible?(this.closeAllEditPopups(),!0):this.$(".style-menu").hasClass("shown")?(this.closeMenu(!0),!0):m.prototype.canControlBeClosed.apply(this,arguments)}}),Pe=i("+teE"),je=i.n(Pe),$e=a.a.extend({name:"text_typography",className:"control text_typography",initialize:function(t){this.template=je.a["template-constructor-control-text_typography"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_typography")}))},bindLogic:function(){this.$panel.on("click",this.closeAllPopups),this.fontselector=new Se.a({$parent:this.$panel,css:{left:-79,top:-33}}),this.fontselector.on("selectfont",this.fontChanged),this.params=this.blocks&&this.blocks[0].params||{},this.$panel.on("click",".linked",this.onLinkedClick),this.$panel.on("click",".font-family-popup",this.onFontPopupClick),this.$panel.on("click",".font-style-popup",this.onFontStylePopupClick),this.editFontSizeChangeValue=Object(u.a)(this.$panel.find(".font-size")).RMNumericInput({min:this.params.minFontSize,max:this.params.maxFontSize,mouseSpeed:4,onChange:this.onInputChanged}).data("changeValue"),this.editLineHeightChangeValue=Object(u.a)(this.$panel.find(".line-height")).RMNumericInput({min:this.params.minLineHeight,max:this.params.maxLineHeight,mouseSpeed:4,onChange:this.onInputChanged}).data("changeValue"),this.editLetterSpacingChangeValue=Object(u.a)(this.$panel.find(".letter-spacing")).RMNumericInput({min:this.params.minLetterSpacing,max:this.params.maxLetterSpacing,mouseDir:"h",useFloat:!0,step:.2,shiftStep:1,mouseSpeed:4,onChange:this.onLetterSpacingChanged}).data("changeValue"),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.blocks[0].on("selection_styles_all_changed",this.selectionStylesAllChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles),this.blocks&&this.selectionStylesAllChanged(this.blocks[0].cur_selection_styles_all)},unBindLogic:function(){this.$panel.off("click",this.closeAllPopups),this.fontselector&&this.fontselector.off("selectfont",this.fontChanged),this.fontselector&&this.fontselector.destroy(),this.font_selector_visible=!1,this.fontselector=null,this.$panel.off("click",".linked",this.onLinkedClick),this.$panel.off("click",".font-family-popup",this.onFontPopupClick),this.$panel.off("click",".font-style-popup, .font-style",this.onFontStylePopupClick),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.blocks[0].off("selection_styles_all_changed",this.selectionStylesAllChanged)},plusAnimation:function(){this.$el.flashClass("plus-animation",1200)},selectionStylesAllChanged:function(t){this.$panel.find(".font-style").fadeOut(200),this.font_style_visible=!1,this.fonts_in_selection=[],this.styles_in_selection=[];var e,i=[],n=[],a=[];if(t&&RM.constructorRouter.fonts&&t.length>0){for(var s=0;s<t.length;s++){n.push(t[s]["font-family"]);var r=RM.constructorRouter.fonts.getVisualRenderedFontStyles(t[s]["font-family"],t[s]["font-weight"],t[s]["font-style"]);a.push(r["font-weight"]+"-"+r["font-style"])}if(n=o.a.uniq(n),a=o.a.uniq(a),n.length>0&&(this.fonts_in_selection=n),1==n.length&&(e=n[0]),a.length>0&&o.a.each(a,o.a.bind((function(t){var i=t.split("-");2==i.length&&this.styles_in_selection.push({name:RM.constructorRouter.fonts.getStyleName(i[0],i[1],e),"font-weight":i[0],"font-style":i[1]})}),this)),n.length>0&&a.length>0){var l=RM.constructorRouter.fonts.findCommonFontsStylesAvailable(n);o.a.each(l,(function(t){var n=t.split("-");2==n.length&&i.push({name:RM.constructorRouter.fonts.getStyleName(n[0],n[1],e),"font-weight":n[0],"font-style":n[1]})}))}}var c=o.a.map(this.fonts_in_selection,(function(t){return RM.constructorRouter.fonts.findFontByCSSName(t).name}));this.$panel.find(".font-family-popup .popup-caption").text(c.join(", ")).css("font-family",this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial");var d=o.a.pluck(this.styles_in_selection,"name");this.$panel.find(".font-style-popup .popup-caption").text(d.join(", ")).css({"font-family":this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial","font-weight":this.styles_in_selection.length>0?this.styles_in_selection[0]["font-weight"]:"400","font-style":this.styles_in_selection.length>0?this.styles_in_selection[0]["font-style"]:"normal"});var h=this.$panel.find(".font-style-wrapper");if(h.empty(),o.a.each(i,o.a.bind((function(t,e){var i=Object(u.a)("<div>").appendTo(h).addClass("font-style-item").text(t.name).css({"font-family":this.fonts_in_selection.length>0?this.fonts_in_selection[0]:"Arial","font-weight":t["font-weight"]+"","font-style":t["font-style"]}).attr("font-weight",t["font-weight"]).attr("font-style",t["font-style"]).on("click",this.styleChanged);Object(u.a)("<div>").appendTo(i).addClass("point");o.a.indexOf(d,t.name)+1&&i.addClass("curr")}),this)),this.$panel.find(".font-style-popup").toggleClass("disabled",0==i.length),this.font_selector_visible){var p=this.blocks[0].initiatorControl==this.name?void 0:300;this.fontselector&&this.fontselector.setActiveFont(this.fonts_in_selection||[],p)}t.length&&this.$panel.find(".linked").toggleClass("active",t[0]["size-leading-linked"])},selectionStylesChanged:function(t){"text_typography"!==this.blocks[0].initiatorControl&&this.blocks[0].initiatorControl==this.name||this.updateState(t)},updateState:function(t){null!=t["font-size"]&&this.setMultipleState(this.$panel.find(".font-size"),this.editFontSizeChangeValue,t,"font-size",!0),null!=t["line-height"]&&this.setMultipleState(this.$panel.find(".line-height"),this.editLineHeightChangeValue,t,"line-height",!0),null!=t["letter-spacing"]&&this.setMultipleState(this.$panel.find(".letter-spacing"),this.editLetterSpacingChangeValue,t,"letter-spacing",!1)},setMultipleState:function(t,e,i,n,o){if(this.blocks){var a,s=t.parent().find(".multiple-layer");i[n]==this.blocks[0].params.multipleName?(s.css("display","block"),t.css("opacity",0),a=this.blocks[0].cur_selection_styles_all.length>0?this.blocks[0].cur_selection_styles_all[0][n]:"line-height"==n?this.params.minLineHeight:this.params.minFontSize):(s.css("display","none"),t.css("opacity",1),a=i[n]),e(a=parseFloat(a),!0),o&&this.onInputChanged(t,a,!0,!0)}},onLinkedClick:function(){var t=this.$panel.find(".linked"),e=(this.$panel.find(".font-size"),this.blocks[0].cur_selection_styles_all);if(t.toggleClass("active"),t.hasClass("active")?t.attr("title","Unbind Font Size and Line Height"):t.attr("title","Bind Font Size and Line Height"),this.blocks[0].cur_selection_styles["size-leading-linked"]!=this.blocks[0].params.multipleName&&this.blocks[0].cur_selection_styles["size-leading-ratio"]!=this.blocks[0].params.multipleName){var i={"size-leading-linked":this.$panel.find(".linked").hasClass("active"),"size-leading-ratio":parseInt(e[0]["line-height"],10)/parseInt(e[0]["font-size"],10)};isNaN(i["size-leading-ratio"])&&(i["size-leading-ratio"]=this.params.fontSizeLineHeightRatio),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",i))}},onInputChanged:function(t,e,i,n){if(this.blocks){var a=t.attr("data-class"),s="line-height"==a?this.params.minLineHeight:this.params.minFontSize;"line-height"==a?this.params.maxLineHeight:this.params.maxFontSize;this["springEffect-"+a]=this["springEffect-"+a]||0;try{var r=this.blocks[0].cur_selection_styles_all[0]["size-leading-ratio"];if(isNaN(r))r=this.params.fontSizeLineHeightRatio}catch(t){console.log(t.message,t.stack),this.blocks&&(console.log(this.blocks),this.blocks[0]&&(console.log(this.blocks[0]),this.blocks[0].cur_selection_styles_all&&(console.log(this.blocks[0].cur_selection_styles_all),this.blocks[0].cur_selection_styles_all[0]&&console.log(this.blocks[0].cur_selection_styles_all[0]))));r=this.params.fontSizeLineHeightRatio}if(this.$panel.find(".linked").hasClass("active")&&!i&&"font-size"==a){var l=Math.round(e*r);this.editLineHeightChangeValue(l,!0),this.onInputChanged(this.$panel.find(".line-height"),l,!0)}if(this.$panel.find(".linked").hasClass("active")&&!i&&"line-height"==a){l=Math.round(e/r);this.editFontSizeChangeValue(l,!0),this.onInputChanged(this.$panel.find(".font-size"),l,!0)}t.toggleClass("big-number",e>99);var c=0;this["oldVal-"+a]>e&&(c=-1),this["oldVal-"+a]<e&&(c=1),this["oldVal-"+a]=e;var d=(e-s)/63;if(d>1){if(clearTimeout(this["springTimeout-"+a]),this["springEffect-"+a]-=1*c,this["springEffect-"+a]>100&&(this["springEffect-"+a]=100),this["springEffect-"+a]<-100&&(this["springEffect-"+a]=-100),this["springEffect-"+a]>0)var h=Math.sqrt(this["springEffect-"+a]);else h=-Math.sqrt(-this["springEffect-"+a]);t.parent().removeClass("spring-effect"),t.parent().css({"margin-top":-25+h}),this["springTimeout-"+a]=setTimeout(o.a.bind((function(){t.parent().addClass("spring-effect").css({"margin-top":"-25px"}),this["springEffect-"+a]=0}),this),200),d=1}var u=188+-63*d;if(t.parent().css({top:u}),this.$panel.find("."+a+"-gauge").height(188-u+17),!n){var p={};p[a]=e+"px",this.updateState(p),this.$panel.find(".linked").hasClass("active")&&(p["font-size"]=this.$panel.find(".font-size").val()+"px",p["line-height"]=this.$panel.find(".line-height").val()+"px"),p["size-leading-linked"]=this.$panel.find(".linked").hasClass("active"),p["size-leading-ratio"]=r,this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",p))}}},onLetterSpacingChanged:function(t,e){var i={"letter-spacing":e+"px"};this.updateState(i),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",i))},onFontPopupClick:function(t){this.fontselector&&this.fontselector.show(this.fonts_in_selection||[]),this.font_selector_visible=!0},onFontStylePopupClick:function(t){this.$panel.find(".font-style-popup").hasClass("disabled")||(this.font_style_visible=!this.$panel.find(".font-style").is(":visible"),this.$panel.find(".font-style").fadeToggle(200))},fontChanged:function(t){var e={"font-family":t};this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},styleChanged:function(t){var e=Object(u.a)(t.currentTarget),i={"font-weight":e.attr("font-weight"),"font-style":e.attr("font-style")};this.closeFontStyle(),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",i))},closeFontSelector:function(){this.font_selector_visible=!1,this.fontselector&&this.fontselector.hide()},closeFontStyle:function(){this.font_style_visible=!1,this.$panel.find(".font-style").fadeOut(200)},closeAllPopups:function(t){if(t){if(Object(u.a)(t.target).closest(".rmfontselector").length>0)return;if(Object(u.a)(t.target).closest(".font-family-popup").length>0)return;if(Object(u.a)(t.target).closest(".font-style-wrapper").length>0)return;if(Object(u.a)(t.target).closest(".font-style-popup").length>0)return}this.font_selector_visible&&this.fontselector.handleEscape()&&this.closeFontSelector(),this.font_style_visible&&this.closeFontStyle()},onClick:function(){this.selected&&(this.font_selector_visible||this.font_style_visible)?this.closeAllPopups():a.a.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&(this.font_selector_visible||this.font_style_visible)?this.closeAllPopups():a.a.prototype.onEscKey.apply(this,arguments)},deselect:function(){this.closeAllPopups(),a.a.prototype.deselect.apply(this,arguments)},canControlBeClosed:function(){return this.font_selector_visible||this.font_style_visible?(this.closeAllPopups(),!0):a.a.prototype.canControlBeClosed.apply(this,arguments)}}),Te=i("+uCx"),Ie=i.n(Te),Ee=a.a.extend({name:"text_bius",className:"control text_bius",initialize:function(t){this.template=Ie.a["template-constructor-control-text_bius"],this.initControl(t),o.a.bindAll(this)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_bius")}))},bindLogic:function(){this.$panel.on("click",".all-caps",this.allСaps),this.$panel.on("click",".small-caps",this.smallСaps),this.$panel.on("click",".sup",this.sup),this.$panel.on("click",".sub",this.sub),this.$panel.on("click",".bold",this.bold),this.$panel.on("click",".italic",this.italic),this.$panel.on("click",".underline",this.underline),this.$panel.on("click",".strike",this.strike),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.$panel.off("click",".all-caps",this.allСaps),this.$panel.off("click",".small-caps",this.smallСaps),this.$panel.off("click",".sup",this.sup),this.$panel.off("click",".sub",this.sub),this.$panel.off("click",".bold",this.bold),this.$panel.off("click",".italic",this.italic),this.$panel.off("click",".underline",this.underline),this.$panel.off("click",".strike",this.strike),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){this.blocks[0].initiatorControl!=this.name&&this.updateState(t)},updateState:function(t){t["text-transform"]&&(this.$panel.find(".all-caps").toggleClass("curr","uppercase"==t["text-transform"]),this.$panel.find(".small-caps").toggleClass("curr","lowercase"==t["text-transform"])),t["vertical-align"]&&(this.$panel.find(".sup").toggleClass("curr","super"==t["vertical-align"]),this.$panel.find(".sub").toggleClass("curr","sub"==t["vertical-align"])),t["font-weight"]&&this.$panel.find(".bold").toggleClass("curr","700"==t["font-weight"]),t["font-style"]&&this.$panel.find(".italic").toggleClass("curr","italic"==t["font-style"]),t["text-decoration"]&&(this.$panel.find(".underline").toggleClass("curr","underline"==t["text-decoration"]),this.$panel.find(".strike").toggleClass("curr","line-through"==t["text-decoration"]))},"allСaps":function(t){var e={"text-transform":"uppercase"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-transform":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},"smallСaps":function(t){var e={"text-transform":"lowercase"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-transform":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},sup:function(t){var e={"vertical-align":"super"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"vertical-align":"baseline"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},sub:function(t){var e={"vertical-align":"sub"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"vertical-align":"baseline"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},bold:function(t){var e={"font-weight":"700"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"font-weight":"400"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},italic:function(t){var e={"font-style":"italic"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"font-style":"normal"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},underline:function(t){var e={"text-decoration":"underline"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-decoration":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))},strike:function(t){var e={"text-decoration":"line-through"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-decoration":"none"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",e))}}),Me=i("P6JF"),Re=i.n(Me),Ae=a.a.extend({name:"text_align",className:"control text_align",initialize:function(t){this.template=Re.a["template-constructor-control-text_align"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_align")}))},bindLogic:function(){this.$panel.on("click",".left",this.left),this.$panel.on("click",".center",this.center),this.$panel.on("click",".right",this.right),this.$panel.on("click",".justify",this.justify),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.$panel.off("click",".left",this.left),this.$panel.off("click",".center",this.center),this.$panel.off("click",".right",this.right),this.$panel.off("click",".justify",this.justify),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){this.blocks[0].initiatorControl!=this.name&&this.updateState(t)},updateState:function(t){t["text-align"]&&(this.$panel.find(".left").toggleClass("curr","left"==t["text-align"]),this.$panel.find(".center").toggleClass("curr","center"==t["text-align"]),this.$panel.find(".right").toggleClass("curr","right"==t["text-align"]),this.$panel.find(".justify").toggleClass("curr","justify"==t["text-align"]),this.$icon.toggleClass("left","right"!=t["text-align"]&&"center"!=t["text-align"]&&"justify"!=t["text-align"]),this.$icon.toggleClass("right","right"==t["text-align"]),this.$icon.toggleClass("center","center"==t["text-align"]),this.$icon.toggleClass("justify","justify"==t["text-align"]))},left:function(t){var e={"text-align":"left"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},center:function(t){var e={"text-align":"center"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},right:function(t){var e={"text-align":"right"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))},justify:function(t){var e={"text-align":"justify"};Object(u.a)(t.currentTarget).hasClass("curr")&&(e={"text-align":"inherit"}),this.updateState(e),this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleParagraph",e))}}),De=i("7E8S"),ze=i.n(De),Le=a.a.extend({name:"text_autosize",className:"control text_autosize",initialize:function(t){this.template=ze.a["template-constructor-control-text_autosize"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_autosize")}))},bindLogic:function(){o.a.each(this.models,function(t){this.listenTo(t,"change:autosize",this.updateState)}.bind(this))},unBindLogic:function(){},onClick:function(){var t=this.models[0].get("autosize");this.models[0].save("autosize",!t)},updateState:function(){var t=!!this.models[0].get("autosize");this.$el.toggleClass("autosize",t),this.$(".icon").attr("data-alt",t?"Auto-size on":"Auto-size off")},render:function(){a.a.prototype.render.apply(this,arguments),this.updateState()}}),Be=i("vetb"),Fe=i.n(Be),Ne=g.a.View.extend({template:Fe.a["template-constructor-control-anchor_picker"],initialize:function(t){o.a.bindAll(this),o.a.extend(this,t)},render:function(){return this.setElement(Object(u.a)(this.template())),this.$picker=this.$el.find(".anchor-picker"),this.$popup=this.$el.find(".popup"),this.workspace=RM.constructorRouter.workspace,this.listenTo(this.workspace,"workspace-resize",this.setOverlayPosition),this.setOverlayPosition(),this},show:function(){this.render(),this.$el.insertAfter(this.$after),Object(u.a)(window).on("resize",this.onWindowResize)},hide:function(){this.stopFollowing(),Object(u.a)(window).off("resize",this.onWindowResize),this.remove()},startFollowing:function(){Object(u.a)(window).on("mousemove",this.onMouseMove),this.$el.on("click",this.onMouseClick),this.$el.addClass("target-mode"),this.containerInitialScroll=this.$container.scrollTop()},stopFollowing:function(){Object(u.a)(window).off("mousemove",this.onMouseMove),this.$el.off("click",this.onMouseClick),this.$el.removeClass("target-mode"),void 0!==this.containerInitialScroll&&this.$container.animate({scrollTop:this.containerInitialScroll},500)},onMouseMove:function(t){this.updateY(t.pageY+this.$container.scrollTop()-this.top),this.$popup.css("left",t.pageX)},onMouseClick:function(t){this.stopFollowing(),this.trigger("target-select",{y:Math.round(t.offsetY/RM.constructorRouter.zoom.getZoom())})},updateY:function(t){this.$picker.css("top",t)},onWindowResize:function(t){this.setOverlayPosition()},setOverlayPosition:function(){var t=this.$after.height(),e=parseInt(this.$after.css("top"),10),i=parseInt(this.$after.css("border-top-width"),10);this.top=e+i,this.$el.height(t*RM.constructorRouter.zoom.getZoom()),this.$el.css("top",this.top)}}),Ue=i("HxOx"),He=i.n(Ue),Ve=a.a.extend({name:"text_link",className:"control text_link",urlRegexp:/^http(s?)\:\/\//i,shortUrlRegexp:/^[\da-z\.-]+\.[a-z-]{2,}.*/i,telRegexp:/\+(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{1,14}$/i,backRegexp:/^(back|scroll)\sto\stop$/i,backLink:"Back to Top",backDisplayName:"Scroll to Top",gobackRegexp:/^(__rm_goback|go\sback)$/i,gobackLink:"__rm_goback",gobackDisplayName:"Go Back",mailchimpRegexp:/^(__rm_mailchimp_.*|<script.*mailchimp\.com.*\{.*baseUrl.*uuid.*lid.*\}.*)$/i,mailchimpMatcher:/start\((\{.*\})\).*\}\)/i,mailchimpLink:"__rm_mailchimp_",mailchimpDisplayName:"Mailchimp Popup",anchorRegexp:/^(__rm_anchor|\d+px)$/i,anchorMatcher:/^(\d+)px$/i,anchorLink:"__rm_anchor",shareRegexp:/^share\.(facebook|twitter|pinterest|gplus|linkedin|email)\.(mag|page)$/i,NEW_DEFAULT_STYLE:{color:"0078ff",opacity:100,"u-style":"solid","u-color":"0078ff","u-opacity":100,"u-size":1,"u-offset":0,"hover-color":"inherit","hover-opacity":"inherit","hover-u-style":"none","hover-u-color":"inherit","hover-u-opacity":"inherit","hover-u-size":"inherit","hover-u-offset":"inherit","current-color":"inherit","current-opacity":"inherit","current-u-style":"none","current-u-color":"inherit","current-u-opacity":"inherit","current-u-size":"inherit","current-u-offset":"inherit"},saveOnDestroy:!0,initialize:function(t){this.template=He.a["template-constructor-control-text_link"],this.style_template=He.a["template-constructor-control-text_link-style"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.refreshEditorCssDebounced=o.a.debounce(this.refreshEditorCss,100)},bindLogic:function(){this.bindLogicCommon(),this.bindLogicSpecific()},bindLogicCommon:function(){this.$input=this.$panel.find(".search-wrapper input"),this.$action_icon=this.$panel.find(".search-wrapper .action-icon"),this.$placeholder=this.$panel.find(".search-wrapper .placeholder"),this.$placeholder_icon=this.$panel.find(".search-wrapper .placeholder-selector"),this.$target_input=this.$panel.find(".target-wrapper input"),this.$target_wrapper=this.$panel.find(".target-wrapper"),this.$search_wrapper=this.$panel.find(".search-wrapper"),this.$target_icon=this.$panel.find(".target-icon"),this.$input.on("input",this.onInputChange),this.$input.on("keyup",this.onInputKey),this.$action_icon.on("click",this.inputIconClick),this.$target_input.on("change",this.onTargetInputChange),this.$target_icon.on("click",this.anchorOnTargetClick),this.$panel.on("click",".placeholder-selector",this.togglePlaceholderPopup),this.$panel.on("click",".placeholder-selector .placeholder-item",this.clickPlaceholder),this.$panel.on("click",this.closePlaceholderPopup)},bindLogicSpecific:function(){this.resizableScroll=this.$el.find(".resizable-scroll-wrapper").RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:8,gap_end:8,onScroll:this.onPanelScroll.bind(this)}).data("scroll"),Object(u.a)(window).on("resize",this.repositionPanel),this.textStyles=RM.constructorRouter.textStyles,this.textStyles.on("change:link_styles",this.onStylesChange),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".link-style",this.onLinkStyleClick),this.$panel.on("click",".link-style .menu-button",this.toggleMenu),this.$panel.on("click",".style-menu .edit-button",this.onEditClick),this.$panel.on("dblclick",".link-style .style-caption",this.onEditClick),this.$panel.on("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.on("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.find(".styles-wrapper").sortable({distance:10,axis:"y",scrollSpeed:20,containment:"parent",tolerance:"pointer",start:o.a.bind((function(t,e){this.closeMenu(!1)}),this),stop:o.a.bind((function(t,e){this.reorder()}),this)}),this.renderLinkStyles(),this.block&&this.block.on("selection_styles_changed",this.selectionStylesChanged),this.block&&this.selectionStylesChanged(this.block.cur_selection_styles),this.$panel.on("click",".add-block .save",this.saveEditClick),this.$panel.on("click",".add-block .cancel",this.cancelEditClick),this.$panel.on("click",".edit-wrapper .state-switcher-wrapper .state-switcher",this.onStateSwitchClick),this.$panel.on("input",'.edit-wrapper .edit-item[data-field="_caption"] input',this.onEditCaptionChange),this.$panel.on("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.on("click",".edit-wrapper .underline-style-click-area",this.onUnderlineStyleShowClick),this.$panel.on("click",".underline_style_container .underline-style-item",this.underlineStyleChanged),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.colorbox=new ke.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.editUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editHoverUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="hover-u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editHoverPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="hover-u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editCurrentUnderlineWidthChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="current-u-size"] input').RMNumericInput({min:1,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.editCurrentPaddingChangeValue=this.$panel.find('.edit-wrapper .edit-item[data-field="current-u-offset"] input').RMNumericInput({min:-99,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue")},unBindLogic:function(){this.unBindLogicCommon(),this.unBindLogicSpecific()},unBindLogicCommon:function(){this.$input.off("input",this.onInputChange),this.$input.off("keyup",this.onInputKey),this.$action_icon.off("click",this.inputIconClick),this.$target_input.off("change",this.onTargetInputChange),this.$panel.off("click",".placeholder-selector",this.togglePlaceholderPopup),this.$panel.off("click",".placeholder-selector .placeholder-item",this.clickPlaceholder),this.$panel.off("click",this.closePlaceholderPopup)},unBindLogicSpecific:function(){Object(u.a)(window).off("resize",this.repositionPanel),this.block&&this.block.off(null,null,this),this.textStyles.off("change:link_styles",this.onStylesChange),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".link-style",this.onLinkStyleClick),this.$panel.off("click",".link-style .menu-button",this.toggleMenu),this.$panel.off("click",".style-menu .edit-button",this.onEditClick),this.$panel.off("click",".style-menu .duplicate-button",this.onDuplicateClick),this.$panel.off("click",".style-menu .delete-button",this.onDeleteClick),this.$panel.off("click",".add-block .save",this.saveEditClick),this.$panel.off("click",".add-block .cancel",this.cancelEditClick),this.$panel.off("click",".edit-wrapper .state-switcher-wrapper .state-switcher",this.onStateSwitchClick),this.$panel.off("input",'.edit-wrapper .edit-item[data-field="_caption"] input',this.onEditCaptionChange),this.$panel.off("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-wrapper .underline-style-click-area",this.onUnderlineStyleShowClick),this.$panel.off("click",".edit-wrapper",this.closeAllEditPopups),this.colorbox&&this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox&&this.colorbox.destroy(),this.colorbox=null,this.block&&this.block.off("selection_styles_changed",this.selectionStylesChanged)},repositionPanel:function(){this.$panel.css("margin-top","");var t=this.$panel.height(),e=this.$panel.offset().top,i=Math.max(Object(u.a)(window).height(),324)-10;t+e>i&&this.$panel.css("margin-top",i-t-e)},toggleCurrentStateSwitch:function(t){var e=this.hasCurrentState(t);this.isInState("current")&&!e&&this.switchState("default"),this.$panel.find(".state-switcher.caption-current").toggle(e)},canHaveCurrentState:function(){var t=this.model.get("is_global"),e=this.block.workspace,i=e&&e.block&&e.block.model&&e.block.model.get("is_global");return Boolean(t||i)},hasCurrentState:function(t){return Boolean(this.canHaveCurrentState()&&t)},initCurrentStyle:function(){var t=function(t){return o.a.pick(t,(function(t,e){return/^current/.test(e)}))},e=t(this.currentEditStyle),i=t(this.NEW_DEFAULT_STYLE);this.canHaveCurrentState()&&o.a.values(e).length<o.a.values(i).length&&o.a.extend(this.currentEditStyle,i,e)},togglePlaceholderPopup:function(t){t&&Object(u.a)(t.target).closest(".placeholder-selector .placeholder-popup").length>0||(this.placeholder_popup_visible?this.closePlaceholderPopup():(this.anchorExitTargetMode(),this.placeholder_popup_visible=!0,this.$(".placeholder-selector").addClass("opened")))},closePlaceholderPopup:function(t){t&&Object(u.a)(t.target).closest(".placeholder-selector").length>0||(this.placeholder_popup_visible=!1,this.$(".placeholder-selector").removeClass("opened"))},clickPlaceholder:function(t){var e=Object(u.a)(t.currentTarget).attr("data-type");this.setPlaceholder(e),"back"==e&&(this.$input.val(this.backDisplayName),this.onInputChange(),this.applyLink()),"goback"==e&&(this.$input.val(this.gobackDisplayName),this.onInputChange(),this.applyLink()),"anchor"==e?(this.anchorEnterMode(),this.$input.val()||this.anchorEnterTargetMode()):this.anchorExitMode(),this.focusInputField()},setPlaceholder:function(t){var e=this.$panel.find('.search-wrapper .placeholder-selector .placeholder-item[data-type="'+t+'"]');this.$placeholder.text(this.$placeholder.attr("data-"+(t||"initial"))),this.closePlaceholderPopup(),this.$panel.find(".search-wrapper .placeholder-selector .placeholder-item").removeClass("active"),e.addClass("active")},anchorEnterMode:function(t){this.isAnchorMode||(this.$search_wrapper.addClass("anchor-mode"),this.anchorPicker=new Ne({$container:Object(u.a)("#main"),$after:Object(u.a)(".workspace-container:visible")}),this.anchorPicker.show()),t&&this.anchorPicker.updateY(t),this.isAnchorMode=!0},anchorExitMode:function(){this.isAnchorMode&&(this.$search_wrapper.removeClass("anchor-mode"),this.anchorPicker&&(this.anchorPicker.hide(),this.anchorPicker=null),this.isAnchorMode=!1)},anchorOnTargetClick:function(){this.$target_icon.hasClass("active")?this.anchorExitTargetMode():this.anchorEnterTargetMode()},anchorEnterTargetMode:function(){this.$target_icon.addClass("active"),this.anchorPicker.startFollowing(),this.listenToOnce(this.anchorPicker,"target-select",this.anchorOnTargetSelect),this.isAnchorTargetMode=!0},anchorExitTargetMode:function(){o.a.defer(function(){this.isAnchorTargetMode=!1}.bind(this)),this.anchorPicker&&(this.$target_icon.removeClass("active"),this.anchorPicker.stopFollowing())},anchorOnTargetSelect:function(t){var e=t.y;this.anchorExitTargetMode(),this.$input.val(e+"px"),this.applyLink()},onStylesChange:function(t,e,i){(i=i||{}).socketUpdate&&this.renderLinkStyles()},renderLinkStyles:function(){var t=this.textStyles.getStylesListSorted("link"),e="";o.a.each(t,(function(t){e+=this.style_template(t)}),this),this.$panel.find(".styles-wrapper").html(e),this.resizableScroll&&this.resizableScroll.recalc(),this.$panel.find(".styles-wrapper").sortable("refresh")},reorder:function(){var t=[];this.$(".link-style").each((function(){t.push(Object(u.a)(this).attr("data-id"))})),this.textStyles.reorder("link",t)},selectionStylesChanged:function(t){this.updateState(t)},onTargetInputChange:function(){var t=this.$target_input.prop("checked");this.block&&this.block.trigger("changeLink",{action:"change-target",target:t?"_blank":null})},updateState:function(t){var e,i=t&&t.link_nodes,n=!(!i||!i.length);if(this.$panel.toggleClass("collapsed",!n),this.anchorExitMode(),setTimeout(this.repositionPanel,400),this.closeMenu(!1),this.placeholder_popup_visible&&this.closePlaceholderPopup(),n){var a=[],s=[],r=[];if(o.a.each(i,(function(t){a.push(Object(u.a)(t).attr("data-uuid")),r.push(Object(u.a)(t).attr("target")),s.push(t.className)})),a=o.a.uniq(a),s=o.a.uniq(s),r=o.a.uniq(r),this.$target_wrapper.addClass("disabled"),a.length>1)this.$input.val(""),this.setPlaceholder("multiple");else{var l=Object(u.a)(i[0]);if(e=l.attr("data-pid")){this.setPlaceholder("page");var c=RM.constructorRouter.mag.getPageUri(e);c?this.$input.val(c):(this.$input.val(""),this.setPlaceholder("no-page"))}else{var d=l.attr("href");if(/^mailto\:/i.test(d))this.setPlaceholder("email");else if(/^tel\:/i.test(d))this.setPlaceholder("phone");else if(this.backRegexp.test(d))this.setPlaceholder("back"),d=this.backDisplayName;else if(this.gobackRegexp.test(d))this.setPlaceholder("goback"),d=this.gobackDisplayName;else if(this.mailchimpRegexp.test(d))this.setPlaceholder("mailchimp"),d=this.mailchimpDisplayName;else if(this.anchorRegexp.test(d)){this.setPlaceholder("anchor");var h=parseInt(l.attr("data-anchor-link-pos"),10)||0;d=h+"px",this.anchorEnterMode(h)}else this.setPlaceholder("url"),this.$target_wrapper.removeClass("disabled");this.$input.val(d.replace(/^mailto\:/i,"").replace(/^tel\:/i,""))}}this.onInputChange(),this.$action_icon.addClass("remove-icon"),this.$action_icon.removeClass("hidden"),this.$placeholder_icon.addClass("hidden"),this.$target_input.prop("checked",1==r.length&&"_blank"==r[0]),this.$target_input.prop("indeterminate",r.length>1),this.showActiveStyles(s)}else this.$input.val(""),this.onInputChange(),this.setPlaceholder("initial");this.toggleCurrentStateSwitch(e),this.$icon.toggleClass("highlighted",!(!i||!i.length))},onInputChange:function(){this.$action_icon.toggleClass("hidden",!this.getUrlData(this.$input.val()).result),this.$action_icon.removeClass("remove-icon"),this.$placeholder_icon.toggleClass("hidden",""!=this.$input.val())},getUrlData:function(t){var e=RM.constructorRouter.mag,i=RM.constructorRouter.me;t=u.a.trim(t);var n=this.urlRegexp.test(t),o=new RegExp("/(edit|"+i.get("uri")+")/(\\d+|"+e.get("uri")+")/(preview/)?(.*)","i"),a=t.match(o);!a||e.get("uri")!=a[2]&&e.get("num_id")!=a[2]||(t=(a[4]||"1").replace("/",""));var s=""!=t&&!!e.getPageId(t);t=t.replace(/^mailto\:/i,"");var r=y.default.isValidEmailLink(t);t=t.replace(/^tel\:/i,"");var l=this.telRegexp.test(t),c=this.backRegexp.test(t),d=this.gobackRegexp.test(t),h=this.mailchimpRegexp.test(t),p=this.anchorRegexp.test(t),g=this.shareRegexp.test(t);return n||s||r||l||h||g||(n=this.shortUrlRegexp.test(t))&&(t="http://"+t),h&&(t=this.mailchimpLink+this.getMailchimpData(t)),p&&(t=t.match(this.anchorMatcher)[1]),{result:n||s||r||l||c||d||h||p||g,isURL:n,isEmail:r,isTel:l,isValidPageNumber:s,isBack:c,isGoBack:d,isMailchimp:h,isAnchor:p,isShare:g,url:t}},getMailchimpData:function(t){var e,i=t.match(this.mailchimpMatcher);try{e=i&&i[1]&&!!JSON.parse(i[1])}catch(t){e=!1}return e?i[1]:""},inputIconClick:function(t){this.$action_icon.hasClass("remove-icon")?(this.removeLink(),this.anchorExitMode()):this.applyLink()},onInputKey:function(t){var e=this.block&&this.block.cur_selection_styles&&this.block.cur_selection_styles.link_nodes;t.keyCode==u.a.keycodes.enter&&this.applyLink(),t.keyCode==u.a.keycodes.del&&""==this.$input.val()&&e&&e.length&&this.removeLink()},applyLink:function(){var t,e,i=this.$input.val(),n=this.getUrlData(i);if(n.result){n.isEmail&&(n.url="mailto:"+n.url),n.isTel&&(n.url="tel:"+n.url),n.isBack&&(n.url=this.backLink),n.isGoBack&&(n.url=this.gobackLink),n.isAnchor&&(t=n.url,n.url=this.anchorLink);var a=this.block&&this.block.cur_selection_styles&&this.block.cur_selection_styles.link_nodes,s="link-1",r=n.isURL?"_blank":null;a.length&&(s=a[0].className,s=/^link\-/.test(s)?s:null,n.isURL&&(r="_blank"==(r=Object(u.a)(a[0]).attr("target"))?r:null)),this.block&&(e={action:"create",url:n.url,class:s,target:r},t&&o.a.extend(e,{anchor_pos:t,clickPage:this.blocks[0].workspace.page.id}),this.block.trigger("changeLink",e))}},removeLink:function(){this.block&&this.block.trigger("changeLink",{action:"remove"})},focusInputField:function(){this.$panel.find(".search-wrapper input").focus()},showActiveStyles:function(t){if(this.selected&&t){var e={},i={};this.$(".link-style.active").each((function(){e[Object(u.a)(this).attr("data-id")]=!0})),this.closeMenu(!0),this.$(".link-style").removeClass("active");for(var n=0;n<t.length;n++)this.$('.link-style[data-id="'+t[n]+'"]').addClass("active");if(this.$(".link-style.active").each((function(){i[Object(u.a)(this).attr("data-id")]=!0})),!o.a.isEqual(e,i)){var a=this.$(".link-style.active").first();if(a.length){var s,r=this.$panel.find(".resizable-content-wrapper"),l=a.position().top,c=r.height(),d=a.outerHeight();l+d-r.scrollTop()>c-0?s=l+d-c+0:l-r.scrollTop()<0&&(s=l-0),null!=s&&r.stop().animate({scrollTop:s},200)}}}},onLinkStyleClick:function(t){if(!Object(u.a)(t.target).closest(".menu-button").length){var e=Object(u.a)(t.target).closest(".link-style").attr("data-id");this.block&&this.block.trigger("changeLink",{action:"change-class",class:e})}},toggleMenu:function(t){var e=Object(u.a)(t.currentTarget),i=e.hasClass("active"),n=this.$(".style-menu");i?this.closeMenu(!0):(this.$(".link-style .menu-button.active").length>0&&this.closeMenu(!1),setTimeout(o.a.bind((function(){var t=e.closest(".link-style"),i=this.$(".resizable-scroll-wrapper").position().top+t.position().top+e.position().top-this.$panel.find(".resizable-content-wrapper").scrollTop(),o=e.height(),a=i+7,s=Math.max(Object(u.a)(window).height(),304)-10;n.css("top",a).addClass("shown").addClass("shift-bottom").removeClass("shift-left").attr("data-id",t.attr("data-id"));var r=n.offset().top+n.height();if(r+8>s){var l=r-s,c=o/2+7,d=c+n.height()-o;l=Math.min(Math.max(l,c+4),d-8);n.css("top",a-l).addClass("shift-left").removeClass("shift-bottom").find(".corner-wrapper").css("top",l-c+4),e.addClass("shift-left")}else e.removeClass("shift-left");e.addClass("active")}),this),40))},closeMenu:function(t){var e=this.$(".style-menu");t||e.removeClass("transition-enable"),e.removeClass("shown"),t||setTimeout((function(){e.addClass("transition-enable")}),20),this.$(".link-style .menu-button").removeClass("active")},onPanelScroll:function(t){this.closeMenu(!0)},onDuplicateClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.textStyles.duplicateStyle("link",e),n=this.$('.link-style[data-id="'+e+'"]');if(i){RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleAdded");var a=Object(u.a)(this.style_template(i));a.addClass("enable-transition").css("margin-top",-n.outerHeight()),a.insertAfter(n),setTimeout(o.a.bind((function(){a.css("margin-top",0),setTimeout(o.a.bind((function(){a.removeClass("enable-transition"),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)}},onDeleteClick:function(t){var e=Object(u.a)(t.currentTarget).closest(".style-menu").attr("data-id"),i=this.$('.link-style[data-id="'+e+'"]');this.closeMenu(!0),i.addClass("enable-transition"),setTimeout(o.a.bind((function(){i.addClass("shift-left"),setTimeout(o.a.bind((function(){i.css("margin-top",-i.outerHeight()),setTimeout(o.a.bind((function(){i.remove(),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc(),RM.constructorRouter.textStyles.deleteStyle("link",e),RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleDeleted")}),this),270)}),this),270)}),this),50)},addClick:function(t){var e=this.textStyles.addStyle("link",this.NEW_DEFAULT_STYLE);RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.block.somethingChangedInEditor("styleAdded");var i=Object(u.a)(this.style_template(e));i.addClass("enable-transition").addClass("collapsed"),this.$panel.find(".styles-wrapper").append(i),this.$el.find(".resizable-content-wrapper").scrollTop(9999),setTimeout(o.a.bind((function(){i.removeClass("collapsed"),setTimeout(o.a.bind((function(){i.removeClass("enable-transition"),this.$panel.find(".styles-wrapper").sortable("refresh"),this.resizableScroll&&this.resizableScroll.recalc()}),this),270)}),this),50)},refreshEditorCss:function(){var t=("hover"===this.currentStyleEditMode||"current"===this.currentStyleEditMode)&&this.currentStyleEditMode,e={forcePseudoState:t,forcePseudoClass:!!t&&this.getEditValue("_name")};RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document,e),this.block.somethingChangedInEditor("styleChanging")},onEditClick:function(t){var e={dblclick:function(t){return Object(u.a)(t.currentTarget).closest(".link-style")},click:function(){return Object(u.a)(t.currentTarget).closest(".style-menu")}}[t.type](t),i=Object(u.a)(t.currentTarget).closest(e).attr("data-id"),n=this.textStyles.findStyle("link",i);this.originalEditStyle=o.a.clone(n),this.currentEditStyle=n,this.initCurrentStyle(),this.setEditParams(),this.switchState("default"),this.$panel.addClass("toggle-opaque"),this.closeMenu(!0),setTimeout(o.a.bind((function(){this.$panel.addClass("show-style-edit")}),this),300)},editClose:function(){this.closeAllEditPopups(),RM.constructorRouter.textStyles.generateCSS("link","editor",this.block.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","constructor",document),this.resizableScroll&&this.resizableScroll.recalc(),this.block.somethingChangedInEditor("styleChanged"),this.$panel.removeClass("show-style-edit"),setTimeout(o.a.bind((function(){this.$panel.removeClass("toggle-opaque")}),this),400)},isInState:function(t){return this.$panel.find(".edit-wrapper").hasClass(t+"-state")},onStateSwitchClick:function(t){this.colorbox_visible||this.underline_style_visible||(Object(u.a)(t.currentTarget).hasClass("caption-default")&&this.switchState("default"),Object(u.a)(t.currentTarget).hasClass("caption-hover")&&this.switchState("hover"),Object(u.a)(t.currentTarget).hasClass("caption-current")&&this.switchState("current"))},switchState:function(t){var e=this.$panel.find(".edit-wrapper");e.removeClass("hover-state default-state current-state"),e.addClass(t+"-state"),"hover"!==t&&"current"!==t||this.setEditParams(),this.currentStyleEditMode=t,this.refreshEditorCssDebounced()},getEditValue:function(t){if(this.currentEditStyle){var e=o.a.isUndefined(this.currentEditStyle[t])&&/^current/.test(t)?this.NEW_DEFAULT_STYLE[t]:this.currentEditStyle[t];return"inherit"==e&&(e=this.currentEditStyle[t.replace(/^(hover|current)\-/,"")]),e}},setEditParams:function(){var t=this.$panel.find(".edit-wrapper");t.find('.edit-item[data-field="_caption"] input').val(this.getEditValue("_caption")),t.find('.edit-item[data-field="u-style"] .underline-style').attr("data-type",this.getEditValue("u-style")),t.find('.edit-item[data-field="hover-u-style"] .underline-style').attr("data-type",this.getEditValue("hover-u-style")),t.find('.edit-item[data-field="current-u-style"] .underline-style').attr("data-type",this.getEditValue("current-u-style")),t.find('.edit-item[data-field="color"] .color-circle').css({background:"#"+this.getEditValue("color"),opacity:this.getEditValue("opacity")/100}),t.find('.edit-item[data-field="u-color"] .color-circle').css({background:"#"+this.getEditValue("u-color"),opacity:this.getEditValue("u-opacity")/100}),t.find('.edit-item[data-field="hover-color"] .color-circle').css({background:"#"+this.getEditValue("hover-color"),opacity:this.getEditValue("hover-opacity")/100}),t.find('.edit-item[data-field="current-color"] .color-circle').css({background:"#"+this.getEditValue("current-color"),opacity:this.getEditValue("current-opacity")/100}),t.find('.edit-item[data-field="hover-u-color"] .color-circle').css({background:"#"+this.getEditValue("hover-u-color"),opacity:this.getEditValue("hover-u-opacity")/100}),t.find('.edit-item[data-field="current-u-color"] .color-circle').css({background:"#"+this.getEditValue("current-u-color"),opacity:this.getEditValue("current-u-opacity")/100}),this.editUnderlineWidthChangeValue(this.getEditValue("u-size"),!0),this.editPaddingChangeValue(this.getEditValue("u-offset"),!0),this.editHoverUnderlineWidthChangeValue(this.getEditValue("hover-u-size"),!0),this.editHoverPaddingChangeValue(this.getEditValue("hover-u-offset"),!0),this.editCurrentUnderlineWidthChangeValue(this.getEditValue("current-u-size"),!0),this.editCurrentPaddingChangeValue(this.getEditValue("current-u-offset"),!0),this.fixInputsPadding(),this.checkNoUnderline()},fixInputsPadding:function(){for(var t=["u-size","u-offset","hover-u-size","hover-u-offset","current-u-size","current-u-offset"],e=0;e<t.length;e++){var i=this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"] input');i.toggleClass("padding-for-one",Math.abs(i.val())%10==1)}},onEditCaptionChange:function(t){this.currentEditStyle._caption=Object(u.a)(t.target).val()},onEditInputChanged:function(t,e){this.currentEditStyle[t.closest(".edit-item").attr("data-field")]=e,this.fixInputsPadding(),this.refreshEditorCssDebounced()},onColorboxShowClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.attr("data-field"),n=e.attr("data-field-dop"),o=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),o=0}this.closeAllEditPopups(),this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(o),this.colorbox_for_field=i,this.colorbox_for_field_dop=n,this.synchonizeColors="color"==i&&this.getEditValue("color")==this.getEditValue("u-color")&&this.getEditValue("opacity")==this.getEditValue("u-opacity"),this.colorbox.setOpacity(this.getEditValue(n)/100),this.colorbox.setColor(this.getEditValue(i))},colorOpacityChanged:function(t,e,i,n){this.currentEditStyle[this.colorbox_for_field]=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle[this.colorbox_for_field_dop]=100*n,this.synchonizeColors&&(this.currentEditStyle["u-color"]=this.colorbox&&this.colorbox.rgb2hex([t,e,i]),this.currentEditStyle["u-opacity"]=100*n),this.setEditParams(),this.refreshEditorCssDebounced()},onUnderlineStyleShowClick:function(t){if(this.underline_style_visible)this.closeUnderlineStyle();else{this.closeAllEditPopups(),this.underline_style_visible=!0,this.$(".underline_style_container").fadeIn(200);var e=Object(u.a)(t.currentTarget).attr("data-field");this.underline_style_for_field=e,this.$('.underline_style_container .underline-style-item[data-type="'+this.getEditValue(e)+'"]').addClass("active").siblings(".underline-style-item").removeClass("active")}},underlineStyleChanged:function(t){this.currentEditStyle[this.underline_style_for_field]=Object(u.a)(t.currentTarget).attr("data-type"),this.setEditParams(),this.checkNoUnderline(),this.refreshEditorCssDebounced(),this.closeUnderlineStyle()},checkNoUnderline:function(){for(var t=["u-style","hover-u-style","current-u-style"],e=0;e<t.length;e++){var i=this.getEditValue(t[e]);this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"]').closest(".params-block").toggleClass("no-underline","none"==i)}},closeColorBox:function(t){this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(t?0:200)},closeUnderlineStyle:function(){this.underline_style_visible=!1,this.$(".underline_style_container").fadeOut(200)},closeAllEditPopups:function(t){if(t){if(Object(u.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(u.a)(t.target).closest(".color-click-area").length>0)return;if(Object(u.a)(t.target).closest(".underline_style_container").length>0)return;if(Object(u.a)(t.target).closest(".underline-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.underline_style_visible&&this.closeUnderlineStyle()},saveEditClick:function(){this.$('.link-style[data-id="'+this.getEditValue("_name")+'"]').find(".style-caption").text(this.getEditValue("_caption")),this.textStyles.changeStyle("link",this.getEditValue("_name")),this.editClose()},cancelEditClick:function(){this.textStyles.restoreStyle("link",this.getEditValue("_name"),this.originalEditStyle),this.editClose()},save:function(){o.a.isEqual(this.textStyles.getOrder("link"),this.textStyles.orderBefore.link)||this.textStyles.save()},deselect:function(){this.closeAllEditPopups(),this.placeholder_popup_visible&&this.closePlaceholderPopup(),this.anchorExitMode(),a.a.prototype.deselect.apply(this,arguments)},destroy:function(){this.$panel.hasClass("show-style-edit")&&this.saveEditClick(),this.anchorExitMode(),this.save(),a.a.prototype.destroy.apply(this,arguments)},select:function(){a.a.prototype.select.apply(this,arguments),this.block&&this.selectionStylesChanged(this.block.cur_selection_styles),this.resizableScroll&&this.resizableScroll.recalc(),this.repositionPanel(),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_link")}))},onClick:function(){if(this.selected){if(this.colorbox_visible||this.underline_style_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0);if(this.placeholder_popup_visible)return void this.closePlaceholderPopup()}a.a.prototype.onClick.apply(this,arguments)},onEscKey:function(){if(this.selected){if(this.colorbox_visible||this.underline_style_visible)return void this.closeAllEditPopups();if(this.$(".style-menu").hasClass("shown"))return void this.closeMenu(!0);if(this.placeholder_popup_visible)return void this.closePlaceholderPopup();if(this.isAnchorTargetMode)return void this.anchorExitTargetMode()}a.a.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible||this.underline_style_visible?(this.closeAllEditPopups(),!0):this.$(".style-menu").hasClass("shown")?(this.closeMenu(!0),!0):this.placeholder_popup_visible?(this.closePlaceholderPopup(),!0):!!this.isAnchorTargetMode||a.a.prototype.canControlBeClosed.apply(this,arguments)}}),We=i("s1Hx"),Ge=i.n(We),qe=a.a.extend({name:"text_color",className:"control text_color",initialize:function(t){this.template=Ge.a["template-constructor-control-text_color"],this.initControl(t)},bindLogic:function(){this.colorbox=new ke.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.blocks&&this.blocks[0].on("selection_styles_changed",this.selectionStylesChanged),this.blocks&&this.selectionStylesChanged(this.blocks[0].cur_selection_styles)},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.blocks&&this.blocks[0].off("selection_styles_changed",this.selectionStylesChanged)},selectionStylesChanged:function(t){if(this.blocks&&this.blocks[0].initiatorControl!=this.name){var e=t.color,i=t.opacity;if(e==this.blocks[0].params.multipleName){if(!(this.blocks[0].cur_selection_styles_all.length>0))return;e=this.blocks[0].cur_selection_styles_all[0].color}if(i==this.blocks[0].params.multipleName){if(!(this.blocks[0].cur_selection_styles_all.length>0))return;i=this.blocks[0].cur_selection_styles_all[0].opacity}this.updateIconState(e,i/100),this.updateColorboxState(e,i/100)}},updateIconState:function(t,e){t&&e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,n){var o="";o=n>.99?"rgb("+t+","+e+","+i+")":"rgba("+t+","+e+","+i+", "+n+")";var a=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.blocks&&(this.blocks[0].initiatorControl=this.name,this.blocks[0].trigger("changeStyleSpan",{color:o},{color:a,opacity:100*n})),this.updateIconState(a,n)}}),Ke=i("DA8H"),Xe=i.n(Ke),Ye=a.a.extend({name:"text_columns",className:"control text_columns",MAX_COLUMN_COUNT:12,initialize:function(t){this.template=Xe.a["template-constructor-control-text_columns"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_columns")}))},bindLogic:function(){this.$panel.on("click",".substract",this.substract),this.$panel.on("click",".add",this.add),this.$panel.on("click",".bg-color",this.toggleColorbox),this.$panel.on("click",this.closeColorBox),Object(u.a)(this.$(this.$panel.find(".gap"))).RMNumericInput({min:0,max:999,mouseDir:"h",mouseSpeed:1,onChange:this.onGapChanged}),this.colorbox=new ke.a({$parent:this.$(".colorbox_container"),type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.opacityChanged),this.blocks&&this.updateState({column_count:this.blocks[0].model.get("column_count"),column_gap:this.blocks[0].model.get("column_gap"),bg_color:this.blocks[0].model.get("bg_color"),bg_opacity:this.blocks[0].model.get("bg_opacity")})},unBindLogic:function(){this.$panel.off("click",".substract",this.substract),this.$panel.off("click",".add",this.add),this.$panel.off("click",".bg-color",this.toggleColorbox),this.$panel.off("click",this.closeColorBox),this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.opacityChanged),this.colorbox&&this.colorbox.destroy()},updateState:function(t){null!=t.column_count&&(this.$panel.find(".number").text(t.column_count),this.$panel.toggleClass("one-column",1==t.column_count),t.column_count>1?this.$panel.find(".gap, .grid").css("display","block"):setTimeout(o.a.bind((function(){this.$panel.find(".gap, .grid").css("display","none")}),this),500)),null!=t.column_gap&&this.$panel.find(".gap").val(t.column_gap),null!=t.bg_color&&null!=t.bg_opacity&&this.$(".bg-color .color").css({"background-color":"#"+t.bg_color,opacity:t.bg_opacity})},substract:function(t){var e=this.$panel.find(".number").text()-0;if(1!=e){--e<1&&(e=1);var i={column_count:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)}},add:function(t){var e=this.$panel.find(".number").text()-0;if(e!=this.MAX_COLUMN_COUNT){++e>this.MAX_COLUMN_COUNT&&(e=this.MAX_COLUMN_COUNT);var i={column_count:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)}},onGapChanged:function(t,e){var i={column_gap:e};this.updateState(i),this.blocks&&this.blocks[0].trigger("changeColumns",i)},toggleColorbox:function(t){this.colorbox_visible?this.closeColorBox():(this.colorbox_visible=!0,this.$(".colorbox_container").fadeIn(200),this.colorbox.setOpacity(this.blocks[0].model.get("bg_opacity")),this.colorbox.setColor(this.blocks[0].model.get("bg_color")))},closeColorBox:function(t){if(t){if(Object(u.a)(t.target).closest(".colorbox_container").length>0)return;if(Object(u.a)(t.target).closest(".bg-color").length>0)return}this.colorbox_visible=!1,this.$(".colorbox_container").fadeOut(200)},colorChanged:function(t,e,i,n){"ffffff"!=this.blocks[0].model.get("bg_color")||0!=this.blocks[0].model.get("bg_opacity")||this.firstColorChange||(this.firstColorChange=!0,this.colorbox.setOpacity(1,!0),n=1),this.colorOpacityChanged(t,e,i,n)},opacityChanged:function(t,e,i,n){this.colorOpacityChanged(t,e,i,n)},colorOpacityChanged:function(t,e,i,n){var o={bg_color:this.colorbox&&this.colorbox.rgb2hex([t,e,i]),bg_opacity:n};this.updateState(o),this.blocks&&this.blocks[0].trigger("changeColumns",o)},deselect:function(){this.colorbox_visible&&this.closeColorBox(),a.a.prototype.deselect.apply(this,arguments)},onClick:function(){this.selected&&this.colorbox_visible?this.closeColorBox():a.a.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&this.colorbox_visible?this.closeColorBox():a.a.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible?(this.closeColorBox(),!0):a.a.prototype.canControlBeClosed.apply(this,arguments)}}),Ze=i("oRHT"),Je=i.n(Ze),Qe=a.a.extend({name:"text_edit",className:"control text_edit",initialize:function(t){this.template=Je.a["template-constructor-control-text_edit"],this.initControl(t)},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_edit")})),o.a.defer(function(){this.blocks&&this.blocks[0].enterEditMode()}.bind(this))}}),ti=i("NEuE"),ei=i.n(ti),ii=a.a.prototype,ni=a.a.extend({name:"picture_crop",className:"control picture_crop",events:{"click .equilateral":"equilateral","click .fill":"fill","click .fit":"fit","click .scale":"setScale"},scaleParams:{min:.01,max:5},snapParams:{lastZoom:null,activeSnap:null,delta:.01,points:[.5,1]},HANDLER_SIZE:26,initialize:function(t){this.template=ei.a["template-constructor-control-picture_crop"],this.initControl(t),this.block=this.blocks[0],this.block.model.get("picture")||this.block.tempPicture||this.$el.hide(),this.onFullWidthChange(),this.onFullHeightChange()},onClick:function(){this.block.$picture&&(this.$el.hasClass("inactive")||ii.onClick.apply(this,arguments))},render:function(){ii.render.apply(this,arguments),this.initScale(),this.onScaleChange(),this.block.has_parent_block&&this.$el.addClass("hide-all-except-scale"),this.$equilateral=this.$(".equilateral")},select:function(){this.block.enterCropMode(),this.$el.removeClass("fade"),this.$handler.css("top",this.toScale(this.block.model.get("scale"))),this.$helper.text(Math.floor(100*this.block.model.get("scale"))+"%"),this.snapParams.lastZoom=Number((+this.block.model.get("scale")||0).toFixed(2)),this.snapParams.activeSnap=null,this.toggleSnappedStyle()},deselect:function(){this.block.leaveCropMode(),ii.deselect.apply(this,arguments)},toggleEnabled:function(t,e){clearTimeout(this.cancelLoadingTimeout),t&&e?this.block.originalLoaded||this.$el.addClass("loading"):(this.$el.addClass("checked"),this.$icon.addClass("rmalttext-disable"),this.cancelLoadingTimeout=setTimeout(o.a.bind((function(){this.$el.removeClass("loading")}),this),200),t&&ii.select.apply(this,arguments))},onPictureLoaded:function(){this.$el.show()},bindLogic:function(){this.block.model.on("change:scale",this.onScaleChange),this.block.model.on("change:w change:h",this.onSizeChange),this.block.model.on("change:is_full_width",this.onFullWidthChange),this.block.model.on("change:is_full_height",this.onFullHeightChange),this.block.on("picture_added",this.onPictureLoaded),this.$scale=this.$panel.find(".scale"),this.$handler=this.$panel.find(".handler"),this.$helper=this.$panel.find(".helper"),this.$handler.on("dragstart",this.onScaleStart),this.$handler.on("drag",this.onScale),this.$handler.on("dragend",this.onScaleStop),this.block.on("crop_click",this.onClick),this.block.on("transitionmode",this.toggleEnabled)},unBindLogic:function(){this.block.off("transitionmode",this.toggleEnabled),this.block.off("crop_click",this.onClick),this.$handler&&(this.$handler.off("dragstart",this.onScaleStart),this.$handler.off("drag",this.onScale),this.$handler.off("dragend",this.onScaleStop),this.block.model.off("change:scale",this.onScaleChange),this.block.model.off("change:w change:h",this.onSizeChange),this.block.model.off("change:is_full_width",this.onFullWidthChange),this.block.model.off("change:is_full_height",this.onFullHeightChange),this.block.off("picture_added",this.onPictureLoaded))},equilateral:function(){if(!this.$equilateral.hasClass("fade")){var t=this.block.getBoxData();if(t.w>t.h){var e={width:t.h,height:t.h,left:t.x+(t.w-t.h)/2,top:t.y};this.block.frame.doResize(e),this.block.onCropResize(e),this.block.onResizeEnd()}else{e={width:t.w,height:t.w,top:t.y+(t.h-t.w)/2,left:t.x};this.block.frame.doResize(e),this.block.onCropResize(e),this.block.onResizeEnd()}this.$equilateral.addClass("fade")}},fill:function(){this.block.fill()},fit:function(){this.block.fit()},toggleSnappedStyle:function(){this.$handler.toggleClass("snapped",Boolean(this.snapParams.activeSnap))},onScaleStart:function(t,e){e.offset=parseInt(this.$handler.css("top")),this.$handler.addClass("dragging")},onScale:function(t,e){var i=this,n=Number(this.fromScale(e.deltaY+e.offset).toFixed(2));n<this.scaleParams.min&&(n=this.scaleParams.min),n>this.scaleParams.max&&(n=this.scaleParams.max),this.snapParams.lastZoom!==n&&(this.snapParams.lastZoom=n,this.snapParams.activeSnap&&(n>this.snapParams.activeSnap+this.snapParams.delta||n<this.snapParams.activeSnap-this.snapParams.delta)?this.snapParams.activeSnap=null:this.snapParams.activeSnap&&(n=this.snapParams.activeSnap),this.snapParams.activeSnap=null,this.snapParams.points.forEach((function(t){n===t&&n!==i.snapParams.activeSnap&&(i.snapParams.activeSnap=t)})),this.toggleSnappedStyle(),this.block.rescale(n))},onScaleChange:function(t,e,i){var n=i&&i.smooth?"animate":"css";this.$handler[n]({top:this.toScale(e)}),this.$helper.text(Math.round(100*e)+"%")},onSizeChange:function(t,e,i){t.get("w")!==t.get("h")&&this.$equilateral.hasClass("fade")&&this.$equilateral.removeClass("fade")},onScaleStop:function(){this.$handler.removeClass("dragging"),this.snapParams.activeSnap=null},setScale:function(t){if(!Object(u.a)(t.target).closest(".handler").length){var e=t.pageY-Object(u.a)(t.target).offset().top-this.HANDLER_SIZE/2;this.block.rescale(this.fromScale(e).toFixed(2),{smooth:!0})}},initScale:function(){this._scaleHeight=parseInt(this.$scale.css("height"))-parseInt(this.$handler.css("height"))-4;var t=this.scaleParams.min,e=this.scaleParams.max,i=this._scaleHeight,n=Math.floor(this._scaleHeight/2),a=(1-t)*i/((e-1)*i/n-e+t),s=(e-1)*(a/n+1)*a,r=e-s/a;o.a.extend(this.scaleParams,{a:r,b:s,c:a})},toScale:function(t){(t-=0)>this.scaleParams.max&&(this.scaleParams.max=t,this.initScale());var e=this.scaleParams.a;return this.scaleParams.b/(t-e)-this.scaleParams.c},fromScale:function(t){return t<0?this.scaleParams.max:this.scaleParams.a+this.scaleParams.b/(this.scaleParams.c+t)},restrictions:function(t){var e=t.getSelectedBlocks();return!(1==e.length&&(e[0].isPictureEmpty&&e[0].isPictureEmpty()||e[0].isFullWidth()||e[0].isFullHeight()))},onEnterKey:function(){this.selected&&this.master.deselect()},onFullWidthChange:function(){this.$el.toggleClass("inactive",!!this.block.model.get("is_full_width"))},onFullHeightChange:function(){this.$el.toggleClass("inactive",!!this.block.model.get("is_full_height"))}}),oi=i("5jX/"),ai=i.n(oi),si=a.a.prototype,ri=a.a.extend({name:"picture_fwpos",className:"control picture_fwpos",initialize:function(t){this.template=ai.a["template-constructor-control-picture_fwpos"],this.initControl(t),this.block=this.blocks[0],this.block.model.get("picture")||this.block.tempPicture||this.$el.hide()},onClick:function(){this.block.$picture&&(this.$el.hasClass("inactive")||si.onClick.apply(this,arguments))},select:function(){this.block.enterFWPosMode(),this.$el.addClass("active"),si.select.apply(this,arguments)},deselect:function(){this.block.leaveFWPosMode(),this.$el.removeClass("active"),si.deselect.apply(this,arguments)},onPictureLoaded:function(){this.$el.show()},bindLogic:function(){this.block.on("picture_added",this.onPictureLoaded),this.block.on("fwpos_click",this.onClick)},unBindLogic:function(){this.block.off("crop_click",this.onClick),this.block.off("picture_added",this.onPictureLoaded)},restrictions:function(t){var e=t.getSelectedBlocks();return 1==e.length&&!(e[0].isPictureEmpty&&e[0].isPictureEmpty())&&(e[0].isFullWidth()||e[0].isFullHeight())},onEnterKey:function(){this.selected&&this.master.deselect()}}),li=Ve.extend({name:"picture_link",className:"control picture_link",saveOnDestroy:!1,bindLogicSpecific:function(){this.listenTo(this.blocks[0].model,"change:clickLink change:clickTarget",this.updateState),this.updateState()},unBindLogicSpecific:function(){this.stopListening(this.model)},onTargetInputChange:function(){var t=this.$target_input.prop("checked");this.models[0].save({clickTarget:t?"_blank":"_self"})},updateState:function(t){var e=this.models[0].get("clickLink"),i=this.models[0].get("clickTarget");if(this.$panel.toggleClass("collapsed",!e),this.placeholder_popup_visible&&this.closePlaceholderPopup(),e){if(this.$target_wrapper.addClass("disabled"),/^mailto\:/i.test(e)?this.setPlaceholder("email"):/^tel\:/i.test(e)?this.setPlaceholder("phone"):this.backRegexp.test(e)?this.setPlaceholder("back"):this.gobackRegexp.test(e)?this.setPlaceholder("goback"):this.mailchimpRegexp.test(e)?this.setPlaceholder("mailchimp"):this.anchorRegexp.test(e)?this.setPlaceholder("anchor"):(this.setPlaceholder("url"),this.$target_wrapper.removeClass("disabled")),e=(e=e.replace(/^mailto\:/i,"")).replace(/^tel\:/i,""),this.urlRegexp.test(e)||this.shortUrlRegexp.test(e)||y.default.isValidEmailLink(e)||this.telRegexp.test(e))this.$input.val(e);else if(this.backRegexp.test(e))this.setPlaceholder("back"),this.$input.val(this.backDisplayName);else if(this.gobackRegexp.test(e))this.setPlaceholder("goback"),this.$input.val(this.gobackDisplayName);else if(this.mailchimpRegexp.test(e))this.$input.val(this.mailchimpDisplayName);else if(this.anchorRegexp.test(e)){var n=this.models[0].get("anchor_link_pos")||0;this.anchorEnterMode(n),this.$input.val(n+"px")}else{this.setPlaceholder("page"),this.$target_wrapper.addClass("disabled");var o=RM.constructorRouter.mag.getPageUri(e);o?this.$input.val(o):(this.$input.val(""),this.setPlaceholder("no-page"))}this.onInputChange(),this.$action_icon.addClass("remove-icon"),this.$action_icon.removeClass("hidden"),this.$placeholder_icon.addClass("hidden"),this.$target_input.prop("checked","_blank"==i)}else this.$input.val(""),this.onInputChange(),this.setPlaceholder("initial");this.$icon.toggleClass("highlighted",!!e)},onInputKey:function(t){t.keyCode==u.a.keycodes.enter&&this.applyLink(),t.keyCode==u.a.keycodes.del&&""==this.$input.val()&&this.models[0].get("clickLink")&&this.removeLink()},applyLink:function(){var t=this.$input.val(),e={},i=this.getUrlData(t);if(i.result){i.isEmail&&(i.url="mailto:"+i.url),i.isTel&&(i.url="tel:"+i.url),i.isBack&&(i.url=this.backLink),i.isGoBack&&(i.url=this.gobackLink),i.isAnchor?(e.anchor_link_pos=parseInt(i.url,10)||0,i.url=this.anchorLink,i.page=this.blocks[0].workspace.page.id):this.anchorExitMode(),i.isValidPageNumber&&(i.url=RM.constructorRouter.mag.getPageId(i.url));var n=i.isURL?"_blank":"_self";o.a.extend(e,{clickLink:i.url,clickTarget:n}),i.page&&(e.clickPage=i.page),this.models[0].save(e),this.updateState(),Object(u.a)("#main").focus()}},removeLink:function(){this.models[0].unset("clickLink"),this.models[0].unset("clickTarget"),this.models[0].save(),this.updateState()},restrictions:function(t){var e=t.getSelectedBlocks();return 1!=e.length||"Picture"!=e[0].name||!e[0].isPictureEmpty()},save:function(){},destroy:function(){this.anchorExitMode(),a.a.prototype.destroy.apply(this,arguments)},select:function(){if(a.a.prototype.select.apply(this,arguments),this.isPreviewEnabled())return this.$panel.addClass("show-picture-preview-error");this.$panel.removeClass("show-picture-preview-error"),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-text_link")}))},isPreviewEnabled:function(){return!!this.model.get("preview_enabled")}}),ci=i("btdP"),di=i.n(ci),hi=a.a.extend({name:"picture_color",className:"control picture_color",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=di.a["template-constructor-control-picture-color"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.block.on("picture_added",(function(){this.$el.toggle(this.block.isVector())}),this),this.block.model.get("picture")||this.block.tempPicture||this.$el.hide()},bindLogic:function(){this.colorbox=new ke.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.model.on("change:pic_color",this.onColorChange),this.model.on("change:pic_opacity",this.onColorChange),this.updateState()},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.model.off("change:pic_color",this.onColorChange),this.model.off("change:pic_opacity",this.onColorChange)},updateIconState:function(t,e){t&&null!=e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,n){var o=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.updateIconState(o,n),this.model.set({pic_color:o,pic_opacity:n}),this.block.$svg&&this.block.setVectorColor(o,n)},updateState:function(){var t=this.model.get("pic_color")||"000000",e=this.model.get("pic_opacity")||1;this.updateIconState(t,e),this.updateColorboxState(t,e),this.block.$svg},onColorChange:function(t,e,i){(i.undo||i.redo)&&this.updateState()},save:function(){this.block.saveSvg(o.a.bind(this.model.save,this.model))}}),ui=me.extend({name:"picture_settings",alt:"Picture",panelComponent:"panel-picture-settings",select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-picture_settings")}))}}),pi=i("kwFJ"),gi=i.n(pi),mi=m.extend({name:"slideshow_manager",className:"control slideshow_manager",events:{},MIN_PANEL_HEIGHT:275,MAX_PANEL_HEIGHT:640,CREATE_SPEED:270,initialize:function(t){o.a.bindAll(this),this.template=gi.a["template-constructor-control-slideshow_manager"],this.image_template=gi.a["template-constructor-control-slideshow_manager-image"],this.initControl(t),this.block=this.blocks[0],this.block.manager=this,this.block.workspace.on("main-dragover",this.highlightDropZone),this.slideshowPlayer=this.block.slideshowPlayer},bindLogic:function(){this.block.on("addUpload",this.onAddImage,this),this.block.on("addUpload replaceUpload",this.showLoader,this),this.block.on("nowUploading",this.onStartUploading,this),this.block.on("doneUpload",this.onDoneUpload,this),this.block.on("failUpload",this.onFailUpload,this),this.block.model.on("change:pictures",this.redrawAll,this),this.block.on("clear",this.clearImages),this.$panel.on("click",".add-block .add",this.addClick),this.$panel.on("click",".slideshow-image-wrapper .remove",this.onRemoveImage),this.$panel.on("click",".slideshow-image-wrapper .update",this.onUpdateImage),this.$panel.on("mouseenter",".slideshow-image-wrapper .image",this.onImageMouseEnter),this.$panel.on("mouseleave",".slideshow-image-wrapper .image",this.onImageMouseLeave),this.$panel.on("click",".slideshow-image-wrapper .image",this.onImageClick),this.$resizableContent=Object(u.a)(this.$panel.find(".resizable-content")),this.block.on("reorder",this.reorder,this),this.$resizableContent.sortable({distance:10,axis:"y",scrollSpeed:20,containment:this.$(".resizable-scroll-wrapper"),tolerance:"pointer",cursorAt:{top:50},start:o.a.bind((function(t,e){this.onImageMouseLeave(),e.item.find(".slideshow-image").addClass("dragging"),this.$resizableContent.css("height",this.$resizableContent.height()+30)}),this),stop:o.a.bind((function(t,e){setTimeout(o.a.bind((function(){e.item.find(".slideshow-image").removeClass("dragging")}),this),50),e.position.top>this.$resizableContent.height()-30-e.item.height()&&e.item.detach().closest(".slideshow-image-wrapper").appendTo(this.$resizableContent),this.block.swapPictures(e.item.data("num"),e.item.index()+1),this.$resizableContent.css("height","auto")}),this)}),this.$uploadDropZone=this.$el,this.block.updateDropZone(),this.renderPictures(),this.slideshowPlayer&&this.slideshowPlayer.on("currentImageChanged",this.onCurrentImageChanged),this.block.queue.length&&this.showLoader()},unBindLogic:function(){this.block.off(null,null,this),this.$panel.off("click",".add-block .add",this.addClick),this.$panel.off("click",".slideshow-image-wrapper .remove",this.onRemoveImage),this.$panel.off("click",".slideshow-image-wrapper .update",this.onUpdateImage),this.$panel.off("mouseenter",".slideshow-image-wrapper .image",this.onImageMouseEnter),this.$panel.off("mouseleave",".slideshow-image-wrapper .image",this.onImageMouseLeave),this.$panel.off("click",".slideshow-image-wrapper .image",this.onImageClick),this.slideshowPlayer&&this.slideshowPlayer.off(),delete this.$uploadDropZone},renderPictures:function(t){var e=o.a.sortBy(this.block.getAllPics(),(function(t){return t.num})),i="";o.a.each(e,(function(t){i+=this.image_template({pic:t,thumbUrl:this.getThumbUrl(t)})}),this),t&&t.clear&&this.$panel.find(".resizable-content").html(""),this.$panel.find(".resizable-content").append(i);var n=this.block.queue[0];n&&this.onStartUploading(n),this.rendered=!0,this.resizableScroll&&this.resizableScroll.recalc(),Object(u.a)(this.$panel.find(".resizable-content")).sortable("refresh")},redrawAll:function(t,e,i){i&&(i.undo||i.redo)&&this.rendered&&(this.$el.addClass("updating"),setTimeout(o.a.bind((function(){this.renderPictures({clear:!0}),this.$el.removeClass("updating"),this.slideshowPlayer&&this.onCurrentImageChanged(this.slideshowPlayer.currentImageID,!1,"change-pictures")}),this),50)),o.a.isEmpty(t.get("pictures"))&&this.clearImages()},clearImages:function(){this.$(".resizable-content").empty(),this.resizableScroll&&this.resizableScroll.recalc();var t=Object(u.a)(this.$panel.find(".resizable-content"));t.data("ui-sortable")&&t.sortable("refresh")},reorder:function(){this.$(".slideshow-image-wrapper:not(.deleting)").each((function(t){Object(u.a)(this).data("num",t+1).find(".num").text(t+1)}))},onCurrentImageChanged:function(t,e,i){var n=this.$panel.find('.slideshow-image-wrapper .image[data-id="'+t+'"]');if(n.length||(n=this.$panel.find(".slideshow-image-wrapper .image:first")),n.length&&(this.$panel.find(".slideshow-image").removeClass("active"),n.closest(".slideshow-image").addClass("active"),"switch-to-image"==i||"control-show"==i)){n=n.closest(".slideshow-image-wrapper");var o,a=this.$panel.find(".resizable-content-wrapper"),s=n.position().top,r=a.height(),l=n.height();s+2*l-a.scrollTop()>r-8?o=s+2*l-r+8:s-l-a.scrollTop()<8&&(o=s-l-8),null!=o&&(e?a.stop().animate({scrollTop:o},200):a.scrollTop(o))}},onScrollRecalc:function(t){this.slideshowPlayer&&this.onCurrentImageChanged(this.slideshowPlayer.currentImageID,!1,t)},onImageClick:function(t){var e=Object(u.a)(t.target).attr("data-id");e&&this.slideshowPlayer&&this.slideshowPlayer.moveToImage(e,!0,"switch-to-image")},onImageMouseEnter:function(t){var e=Object(u.a)(t.currentTarget),i=e.closest(".slideshow-image-wrapper"),n=this.$(".error-panel");if(!e.closest(".slideshow-image").hasClass("dragging")&&i.hasClass("error")){var o=e.width(),a=e.offset().left-this.$panel.offset().left,s=e.offset().top-this.$panel.offset().top;n.find(".error-panel-text").text(i.attr("data-error")),n.addClass("shown").css({left:a+o/2,top:s-n.outerHeight()})}},onImageMouseLeave:function(t){this.$(".error-panel").removeClass("shown")},addClick:function(){this.block.$(".uploadInput").trigger("click","stop")},onAddImage:function(t){var e=Object(u.a)(this.image_template({pic:t,thumbUrl:this.getThumbUrl(t)}));e.appendTo(this.$panel.find(".resizable-content")),e.addClass("enable-transition").addClass("collapsed").addClass("collapsed-half"),setTimeout(o.a.bind((function(){e.removeClass("collapsed"),setTimeout(o.a.bind((function(){e.removeClass("collapsed-half"),setTimeout(o.a.bind((function(){e.removeClass("enable-transition"),this.resizableScroll&&this.resizableScroll.recalc(),Object(u.a)(this.$panel.find(".resizable-content")).sortable("refresh")}),this),this.CREATE_SPEED)}),this),this.CREATE_SPEED)}),this),50)},showLoader:function(){this.$el.addClass("loading")},onStartUploading:function(t){this.getImage(t).addClass("loading")},getThumbUrl:function(t){if(!vt.a.useLambdaUrl(t))return t.thumbUrl;var e={width:St.a.THUMB_SIZE_SLIDESHOW,height:St.a.THUMB_SIZE_SLIDESHOW,originalW:t.width,originalH:t.height};return vt.a.getThumbnailUrl(t,e)},onDoneUpload:function(t){var e=this.getImage(t);e.find(".rmpreloader").fadeOut("fast",(function(){e.removeClass("loading"),Object(u.a)(this).attr("style","")})),e.find(".image").css("background-image",'url("'.concat(this.getThumbUrl(t),'")')).attr("data-id",t.id),this.block.queue.length||this.$el.removeClass("loading")},onFailUpload:function(t,e){var i=this.getImage(t);t.error&&i.addClass("error").attr("data-error",e),this.block.queue.length||this.$el.removeClass("loading")},onRemoveImage:function(t){var e=Object(u.a)(t.target).closest(".slideshow-image-wrapper"),i=e.addClass("deleting").data("num");this.block.deletePic(i),e.addClass("enable-transition"),setTimeout(o.a.bind((function(){e.addClass("removed-half"),setTimeout(o.a.bind((function(){e.addClass("removed"),setTimeout(o.a.bind((function(){e.removeClass("enable-transition").remove(),this.resizableScroll&&this.resizableScroll.recalc()}),this),this.CREATE_SPEED)}),this),this.CREATE_SPEED)}),this),50)},getImage:function(t){return this.$(".slideshow-image-wrapper").filter((function(){return Object(u.a)(this).data("num")===t.num}))},onUpdateImage:function(t){var e=Object(u.a)(t.target).closest(".slideshow-image-wrapper").removeClass("error").data("error","").attr("style","").data("num");this.block.updatePic(e)},highlightDropZone:function(){this.$panel.addClass("show-dropzone"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(o.a.bind((function(){this.$panel.removeClass("show-dropzone")}),this),500)},select:function(){m.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-slideshow_manager")}))},restrictions:function(t){var e=o.a.pluck(t.getSelectedBlocks(),"model");return o.a.all(e,(function(t){return"slideshow"==!t.get("type")||(t.get("pictures")||[]).length>0}))},destroy:function(){m.prototype.destroy.apply(this,arguments),this.rendered=!1}}),fi=i("u/SR"),vi=i.n(fi),bi=a.a.extend({name:"shape_color",className:"control shape_color",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=vi.a["template-constructor-control-shape_color"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,o.a.bindAll(this)},bindLogic:function(){this.colorbox=new ke.a({$parent:this.$panel,type:"small"}),this.colorbox.on("colorchange",this.colorChanged),this.colorbox.on("opacitychange",this.colorChanged),this.model.on("change:bg_color",this.onColorChange),this.model.on("change:bg_opacity",this.onColorChange),this.updateState()},unBindLogic:function(){this.colorbox&&this.colorbox.off("colorchange",this.colorChanged),this.colorbox&&this.colorbox.off("opacitychange",this.colorChanged),this.colorbox&&this.colorbox.destroy(),this.model.off("change:bg_color",this.onColorChange),this.model.off("change:bg_opacity",this.onColorChange)},updateIconState:function(t,e){t&&null!=e&&this.$icon&&this.$icon.find(".color-circle").css({background:"#"+t,opacity:e})},updateColorboxState:function(t,e){t&&null!=e&&this.colorbox&&(this.colorbox.setOpacity(e),this.colorbox.setColor(t))},colorChanged:function(t,e,i,n){var o=this.colorbox&&this.colorbox.rgb2hex([t,e,i]);this.updateIconState(o,n),this.model.set({bg_color:o,bg_opacity:n})},updateState:function(){var t=this.model.get("bg_color"),e=this.model.get("bg_opacity");this.updateIconState(t,e),this.updateColorboxState(t,e)},onColorChange:function(t,e,i){(i.undo||i.redo)&&this.updateState()},save:function(){"icon"!==this.model.get("tp")?this.model.save({}):this.block.saveNewColor()}}),_i=me.extend({name:"shape_settings",alt:"Settings",panelComponent:"panel-shape-settings",onPanelChange:function(t){me.prototype.onPanelChange.apply(this,arguments)},select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-shape_settings")}))},deselect:function(){this.colorbox_visible&&this.closeColorBox(),this.stroke_popup_visible&&this.closeStrokePopup(),me.prototype.deselect.apply(this,arguments)}}),yi=i("2d4q"),wi=i.n(yi),ki=a.a.extend({name:"shape_1x1",className:"control shape_1x1",initialize:function(t){this.template=wi.a["template-constructor-control-shape_1x1"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.onScaleChange.__debounced=o.a.debounce(this.onScaleChange,100)},bindLogic:function(){this.model.on("change",this.onScaleChange.__debounced),this.onScaleChange()},unBindLogic:function(){this.model.off("change",this.onScaleChange.__debounced)},onScaleChange:function(){if(this.model){var t=this.model.get("h")==this.model.get("w");this.$el.toggleClass("inactive",t)}},onClick:function(){this.$el.hasClass("inactive")||(this.block.makeSquare(),this.model.save(),this.master.deselect())},restrictions:function(t){var e=t.getSelectedBlocks();return e.length&&!e[0].isFullWidth()&&!e[0].isFullHeight()}}),Si=i("voD7"),xi=i.n(Si),Ci=m.extend({name:"shape_icon",className:"control shape_icon",MIN_PANEL_HEIGHT:264,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:0,SCROLL_GAP_END:8,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,events:{"click .icon-item":"onIconItemClick"},initialize:function(t){this.template=xi.a["template-constructor-control-shape_icon"],this.templateItem=xi.a["template-constructor-control-shape_icon-item"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){m.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultCollection()},bindLogic:function(){this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.listenTo(this.block.model,"change:tp",this.onShapeTypeChange)},unBindLogic:function(){this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe").off("click",this.onLoupeClick),this.stopListening(this.block.model)},onSearchKeyUp:function(t){t.keyCode===u.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!=t&&!this.requestInProgress&&(this.search_string=t,this.$result.empty(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.empty(),this.getDefaultCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=u.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()},context:this})},getDefaultCollection:function(){this.drawSearchResults(this.defaultCollection)},drawSearchResults:function(t){o.a.isArray(t.icons)&&t.icons.length?(o.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){m.prototype.select.apply(this,arguments),o.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.model.save(),m.prototype.save.apply(this,arguments)},onIconItemClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.find(".noun-icon"),n=i.attr("data-id"),a=i.attr("data-rm_id"),s=i.attr("data-url");this.$(".resizable-content").hasClass("preloading")||(this.hideIconPreloader(),this.showIconPreloader(e),this.block.getIconSVG(n||a,s,function(t,i){var r;this.hideIconPreloader(),t||(this.$(".icon-item").removeClass("selected"),e.addClass("selected"),r={noun_url:s},n?o.a.extend(r,{noun_id:n,rm_id:null}):a&&o.a.extend(r,{noun_id:null,rm_id:a}),this.block.model.set(r))}.bind(this)))},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},onShapeTypeChange:function(){"icon"!==this.block.model.get("tp")&&this.abortRequests()},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(u.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},destroy:function(){this.abortRequests(),m.prototype.destroy.apply(this,arguments)}}),Oi=i("0SXY"),Pi=i.n(Oi),ji=a.a.extend({name:"gmaps_edit",className:"control gmaps_edit",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=Pi.a["template-constructor-control-gmaps_edit"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},select:function(){a.a.prototype.select.apply(this,arguments),this.block.enterEditState(),this.$(".icon").addClass("edit")},deselect:function(){this.block.exitEditState(),a.a.prototype.deselect.apply(this,arguments),this.$(".icon").removeClass("edit")},bindLogic:function(){this.block.on("editMapClick",this.onClick)},unBindLogic:function(){this.block.off("editMapClick",this.onClick)},save:function(){this.model.save({})}}),$i=me.extend({name:"gmaps_settings",alt:"Settings",panelComponent:"panel-gmaps-settings"}),Ti=i("TGSb"),Ii=i.n(Ti),Ei=a.a.extend({name:"common_lock",className:"control common_lock",initialize:function(t){this.template=Ii.a["template-constructor-control-common_lock"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){a.a.prototype.render.apply(this,arguments),this.updateState()},bindLogic:function(){RM.constructorRouter.bindGlobalKeyPress([{key:"l",handler:this.onClick}]),o.a.each(this.models,function(t){this.listenTo(t,"change:is_locked",this.onLockChange)}.bind(this))},unBindLogic:function(){RM.constructorRouter.unbindGlobalKeyPress("l",this.onClick),o.a.each(this.models,function(t){this.stopListening(t,"change:is_locked")}.bind(this))},onClick:function(){if(!this.isOnClickDisabled()){var t=o.a.all(this.models,(function(t){return!t.get("is_locked")})),e=o.a.map(this.models,(function(e){return{_id:e.id,is_locked:t}}));this.master.workspace.save_group(e),this.master.deselect()}},onLockChange:function(){this.updateState()},updateState:function(){var t=o.a.any(this.models,(function(t){return t.get("is_locked")}));this.$el.toggleClass("locked",t),this.$(".icon").attr("data-alt",t?"Unlock":"Lock"),o.a.each(this.models,(function(e){var i=e.get("pack_id");i&&Object(u.a)("#pack_"+i).toggleClass("no-drag",t)}))}}),Mi=i("ibKe"),Ri=i.n(Mi),Ai=a.a.extend({name:"button_edit",className:"control button_edit",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=Ri.a["template-constructor-control-button_edit"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-button_edit")}))},onClick:function(){if(!this.isOnClickDisabled()){var t=this.blocks&&this.blocks[0];t.isEditMode?t.leaveEditMode({deselectControl:!0}):t.enterEditMode()}},onEscKey:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},onEnterKey:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},save:function(){(this.blocks&&this.blocks[0]).saveWidgetData()},canControlBeClosed:function(){return!1},deselect:function(){var t=this.blocks&&this.blocks[0];t.isEditMode&&t.leaveEditMode(),a.a.prototype.deselect.apply(this,arguments)},destroy:function(){var t=this.blocks&&this.blocks[0];t&&t.isEditMode&&t.leaveEditMode(),a.a.prototype.destroy.apply(this,arguments)}}),Di=me.extend({name:"button_settings",alt:"Settings",panelComponent:"panel-button-settings"}),zi=i("a3mI"),Li=i.n(zi),Bi=m.extend({name:"button_icon",className:"control button_icon",MIN_PANEL_HEIGHT:274,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:4,SCROLL_GAP_END:4,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.template=Li.a["template-constructor-control-button_icon"],this.templateItem=Li.a["template-constructor-control-button_icon-item"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.applyIconSizeParamVisualState.__debounced=o.a.debounce(this.applyIconSizeParamVisualState,20),this.bindModelEvents()},render:function(){m.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultIconsCollection()},bindLogic:function(){this.$el.on("click",".icon-item",this.onIconItemClick),this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.$iconPositionParam=this.$panel.find('.edit-item[data-field="icon_pos"]'),this.$iconPositions=this.$iconPositionParam.find(".position"),this.$disableIcon=this.$panel.find(".disable-icon"),this.$lastIcon=this.$panel.find(".last-icon"),this.$disableIcon.on("click",this.onDisableIconClick),this.iconSizeEditParamInput=Object(u.a)(this.$panel.find('.edit-item[data-field="icon_h"] input')).RMNumericInput({min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}).data("changeValue"),this.$iconPositionParam.find(".position").on("click",this.onPositionClick),this.applyIconEnabledVisualState(),this.applyIconSizeParamVisualState(),this.applyIconPositionParamVisualState()},unBindLogic:function(){this.$el.off("click",".icon-item",this.onIconItemClick),this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").off("click",this.onLoupeClick),this.$iconPositions.off("click",this.onPositionClick),this.$disableIcon.off("click",this.onDisableIconClick),this.model&&this.model.off(null,null,this)},bindModelEvents:function(){this.model.on("change:icon_h",this.applyIconSizeParamVisualState.__debounced,this),this.model.on("change:icon_pos",this.applyIconPositionParamVisualState,this),this.model.on("change:icon_enabled",this.applyIconEnabledVisualState)},onEditInputChanged:function(t,e){this.model.set(t.closest(".edit-item").attr("data-field"),e)},onPositionClick:function(t){var e=Object(u.a)(t.currentTarget).data("position");this.model.set("icon_pos",e)},applyIconEnabledVisualState:function(){var t=this.model.get("icon_enabled");this.$disableIcon.add(this.$lastIcon).removeClass("active"),t?this.$lastIcon.addClass("active"):this.$disableIcon.addClass("active")},applyIconSizeParamVisualState:function(){this.iconSizeEditParamInput(this.model.get("icon_h"),!0)},applyIconPositionParamVisualState:function(){this.$iconPositionParam.find(".current").removeClass("current"),this.$iconPositionParam.find("."+this.model.get("icon_pos")).addClass("current")},onSearchKeyUp:function(t){t.keyCode===u.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!==t&&!this.requestInProgress&&(this.search_string=t,this.$result.find(".icon-item").remove(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.find(".icon-item").remove(),this.getDefaultIconsCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=u.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()}.bind(this),context:this})},getDefaultIconsCollection:function(){this.drawSearchResults(this.defaultIconsCollection)},drawSearchResults:function(t){o.a.isArray(t.icons)&&t.icons.length?(o.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){m.prototype.select.apply(this,arguments),o.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.block.saveWidgetData(),m.prototype.save.apply(this,arguments)},onIconItemClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.find(".noun-icon"),n=i.attr("data-id"),a=i.attr("data-rm_id"),s=i.attr("data-url");this.$(".resizable-content").hasClass("preloading")||(this.hideIconPreloader(),this.showIconPreloader(e),this.block.getIconSVG(n||a,s,function(t,i){var r,l=this.model.get("icon_enabled");this.hideIconPreloader(),t||(this.$(".icon-item.selected").removeClass("selected"),e.addClass("selected"),r={icon_noun_url:s},n?o.a.extend(r,{icon_noun_id:n,icon_rm_id:null}):a&&o.a.extend(r,{icon_noun_id:null,icon_rm_id:a}),l||o.a.extend(r,{icon_enabled:!0}),this.block.model.set(r),this.$lastIcon.find(".noun-icon").css({"background-image":'url("'+i.noun_url+'")'}))}.bind(this)))},onDisableIconClick:function(){var t=this.model.get("icon_enabled");this.$(".icon-item.selected").removeClass("selected"),t&&(this.model.set("icon_enabled",!1),this.block.$buttonIcon.empty(),this.block.recalcButtonSize())},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(u.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},destroy:function(){this.abortRequests(),m.prototype.destroy.apply(this,arguments)}});Bi.prototype.defaultIconsCollection={icons:[{rm_id:"rm0",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/00-star.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/01-bolt.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/02-bubble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/03-camera.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/04-cloud.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/05-download1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/06-download2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/07-globe2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/08-globe.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/09-pin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/10-share1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/11-share2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/12-send.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/14-x.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/15-minus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/16-plus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/17-mail1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/18-mail2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/19-user.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/20-clock.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/21-embed.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/22-flag.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/23-heart.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/24-itunes.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/25-like.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/26-music.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/27-play.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/28-video.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/29-facebook.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/30-twitter.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/33-instagram.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/36-youtube.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/38-flickr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/39-blogger.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/41-behance.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/42-rss.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/43-at.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/43-at.svg")}]};var Fi=Bi,Ni=i("sviH"),Ui=i("7TSX"),Hi=i.n(Ui),Vi=a.a.extend({name:"hotspot_add",className:"control hotspot_add",pin_attributes:["hotspots_group_id","pin_type","w","h","bg_color","bg_opacity","color","opacity","borders","noun_id","rm_id","noun_url","rasterUrl","raster2xUrl","raster3xUrl","tip_show_on","tip_background-color","tip_background-color-opacity","tip_border-radius","tip_box-shadow","is_global","is_above"],initialize:function(t){this.template=Hi.a["template-constructor-control-hotspot_add"],this.initControl(t)},onClick:function(){a.a.prototype.onClick.apply(this,arguments);var t=this.blocks[0],e=o.a.clone(t.model.attributes),i=Ni.a.hotspot.defaults,n={type:"hotspot"};o.a.extend(n,i);var s={};e.is_above&&(s={fixed_position:"n",x:0,y:460}),o.a.extend(n,o.a.pick(e,this.pin_attributes),s),RM.constructorRouter.workspace.addWidget(n)}}),Wi=i("Rn2B"),Gi=i.n(Wi),qi=m.extend({name:"hotspot_pin_settings",className:"control hotspot_pin_settings",MIN_PANEL_HEIGHT:274,MAX_PANEL_HEIGHT:640,SCROLL_GAP_START:4,SCROLL_GAP_END:4,API_URL:"/api/authservice/noun?uri=",LIMIT_TO_PUBLIC_DOMAIN:!1,DEFAULT_COLLECTION_ID:1335,saveOnDestroy:!0,saveOnDeselect:!0,initialize:function(t){this.template=Gi.a["template-constructor-control-hotspot-pin-settings"],this.templateItem=Gi.a["template-constructor-control-hotspot-pin-settings-icon-item"],t=t||{},this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){m.prototype.render.apply(this,arguments),this.$result=this.$(".panel .resizable-content"),window.prevSVGSearch?(this.nextPage=window.prevSVGSearch.nextPage,this.$(".search").val(window.prevSVGSearch.phrase),this.search_string=window.prevSVGSearch.phrase,this.drawSearchResults(window.prevSVGSearch),this.$(".loupe").addClass("clear")):this.getDefaultIconsCollection(),this.apply_type_related_visual_state(),this.apply_edit_params_visual_state()},bindLogic:function(){this.bind_model_events(),this.$el.on("click",".resizable-content .item",this.on_icon_click),this.$(".search").on("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").on("click",this.onLoupeClick),this.$rectangleIcon=this.$panel.find(".rectangle-icon"),this.$circleIcon=this.$panel.find(".circle-icon"),this.$border_edit_param=this.$panel.find('[data-field="borders"]'),this.$borderWidthInput=Object(u.a)(this.$border_edit_param.children("input")),this.$bg_color_edit_param=this.$panel.find('[data-field="bg_color"]'),this.$colorbox_container=this.$panel.find(".colorbox_container"),this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').on("click",this.toggleShowMode),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.on("click",".color-click-area",this.onColorboxShowClick),this.colorbox=new ke.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.on_color_or_opacity_changed),this.colorbox.on("opacitychange",this.on_color_or_opacity_changed),this.borderWidthEditParamInput=this.$borderWidthInput.RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.on_edit_input_changed}).data("changeValue")},unBindLogic:function(){this.$el.off("click",".resizable-content .item",this.on_icon_click),this.$(".search").off("keyup",this.onSearchKeyUp),this.$(".loupe:not(.preloading)").off("click",this.onLoupeClick),this.model&&this.model.off(null,null,this)},toggleShowMode:function(){var t=this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').attr("data-active");t="click"==t?"hover":"click";var e=[];this.block.hotspots_group_collection.models.forEach((function(i){e.push({_id:i.get("_id"),tip_show_on:t})})),this.block.workspace.set_group(e)},getEditValue:function(t){return this.model.get(t)},closeAllEditPopups:function(t){t&&Object(u.a)(t.target).closest(".color-click-area").length>0||this.colorbox_visible&&this.closeColorBox()},bind_model_events:function(){this.listenTo(this.model,"change:pin_type",this.apply_type_related_visual_state),this.listenTo(this.model,"change:bg_color change:bg_opacity change:color change:opacity change:borders change:tip_show_on",this.apply_edit_params_visual_state)},on_edit_input_changed:function(t,e){var i=[];this.block.hotspots_group_collection.models.forEach((function(t){i.push({_id:t.get("_id"),borders:e})})),this.block.workspace.set_group(i)},on_color_or_opacity_changed:function(t,e,i,n){var a={};a[this.colorbox_for_field]=this.colorbox.rgb2hex([t,e,i]),a[this.colorbox_for_field_dop]=n;var s=[];this.block.hotspots_group_collection.models.forEach((function(t){s.push(o.a.extend({_id:t.get("_id")},a))})),this.block.workspace.set_group(s),this.needRasterize=!0},onClick:function(){this.selected&&this.colorbox_visible?this.closeAllEditPopups():m.prototype.onClick.apply(this,arguments)},apply_edit_params_visual_state:function(){this.$panel.find('.edit-item[data-field="tip_show_on"] .switcher').attr("data-active",this.getEditValue("tip_show_on")),this.apply_type_related_visual_state(),this.$panel.find('.edit-item[data-field="bg_color"] .color-circle').css("background-color",y.default.getRGBA(this.getEditValue("bg_color"),this.getEditValue("bg_opacity"))),this.$panel.find('.edit-item[data-field="color"] .color-circle').css("background-color",y.default.getRGBA(this.getEditValue("color"),this.getEditValue("opacity"))),this.borderWidthEditParamInput(this.getEditValue("borders"),!0)},apply_type_related_visual_state:function(){var t=this.model.get("pin_type");this.$rectangleIcon.add(this.$circleIcon).removeClass("selected"),"ellipse"===t?(this.$circleIcon.addClass("selected"),this.$bg_color_edit_param.removeClass("hidden"),this.$border_edit_param.removeClass("hidden"),this.$(".icon-item").removeClass("selected")):"icon"===t?(this.$bg_color_edit_param.removeClass("hidden"),this.$border_edit_param.addClass("hidden")):"rectangle"===t&&(this.$rectangleIcon.addClass("selected"),this.$bg_color_edit_param.addClass("hidden"),this.$border_edit_param.addClass("hidden"),this.$(".icon-item").removeClass("selected"));var e=this.$(".params-wrapper"),i=0;e.children(".edit-item").filter(":not(.hidden)").each((function(){i+=Object(u.a)(this).height()})),e.height(i),this.$(".resizable-scroll-wrapper").height("calc(100% - "+i+"px)"),this.__scrollRecalc_debounced()},onSearchKeyUp:function(t){t.keyCode===u.a.keycodes.enter&&this.doSearch()},onLoupeClick:function(t){this.$(".loupe").hasClass("clear")?this.clearSearch():this.doSearch()},doSearch:function(){var t=this.$(".search").val().trim();t&&this.search_string!=t&&!this.requestInProgress&&(this.search_string=t,this.$result.find(".icon-item").remove(),delete window.prevSVGSearch,this.$(".loupe").addClass("clear"),this.nextPage=1,this.getDataPage(this.nextPage))},clearSearch:function(){this.$(".loupe").removeClass("clear"),delete window.prevSVGSearch,this.$(".search").val(""),this.search_string="",this.$result.find(".icon-item").remove(),this.getDefaultIconsCollection()},getDataPage:function(t){var e;this.search_string&&!this.requestInProgress&&(e="/icons/"+this.search_string+"?page="+t,this.LIMIT_TO_PUBLIC_DOMAIN&&(e+="&limit_to_public_domain=1"),this.requestIcons(e,function(t,e){t?delete this.nextPage:(window.prevSVGSearch=window.prevSVGSearch||{icons:[]},window.prevSVGSearch.icons=window.prevSVGSearch.icons.concat(e.icons),window.prevSVGSearch.phrase=this.search_string,window.prevSVGSearch.nextPage=this.nextPage,this.drawSearchResults(e))}.bind(this)))},requestIcons:function(t,e){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!0,this.showSearchPreloader(),this.searchXhr=u.a.ajax({method:"GET",url:this.API_URL+encodeURIComponent(t),dataType:"json",success:function(t){e(null,t)},error:function(t){e(t)},complete:function(){this.searchInProgress=!1,this.hideSearchPreloader()}.bind(this),context:this})},getDefaultIconsCollection:function(){this.drawSearchResults(this.defaultIconsCollection)},drawSearchResults:function(t){o.a.isArray(t.icons)&&t.icons.length?(o.a.each(t.icons,function(t){this.$result.append(this.templateItem({icon:t}))}.bind(this)),this.__scrollRecalc_debounced()):delete this.nextPage},select:function(){m.prototype.select.apply(this,arguments),o.a.delay(function(){this.$(".search").focus().select()}.bind(this),400)},save:function(){this.block.workspace.save_group(this.block.hotspots_group_collection.models),this.needRasterize&&(this.block.rasterize_icon_SVG(),delete this.needRasterize),m.prototype.save.apply(this,arguments)},on_icon_click:function(t){if(!this.$(".resizable-content").hasClass("preloading")){this.$(".resizable-content .item").removeClass("selected");var e,i,n=Object(u.a)(t.currentTarget),a=[];if(!n.hasClass("selected")&&(n.hasClass("icon-item")&&(e="icon"),n.hasClass("circle-icon")&&(e="ellipse"),n.hasClass("rectangle-icon")&&(e="rectangle"),"ellipse"!=e&&"rectangle"!=e||(n.addClass("selected"),this.block.icon_XHR&&this.block.icon_XHR.abort(),i={pin_type:e,noun_url:null,noun_id:null,rm_id:null},this.block.hotspots_group_collection.models.forEach((function(t){var n={};if("ellipse"==e){var s=t.get("x"),r=t.get("w"),l=t.get("h"),c=Math.floor((r-l)/2);n.w=l,n.x=s+c}a.push(o.a.extend({_id:t.get("_id")},i,n))})),this.block.workspace.set_group(a)),"icon"==e)){var s=n.find(".noun-icon"),r=s.attr("data-id"),l=s.attr("data-rm_id"),c=s.attr("data-url");this.hideIconPreloader(),this.showIconPreloader(n),this.block.get_icon_SVG(r||l,c,function(t,e){if(this.hideIconPreloader(),!t){n.addClass("selected"),i={pin_type:"icon",noun_url:c,noun_id:r||null,rm_id:l||null},this.block.render_pin_shape({pin_type:"icon"});var s=this.block.adjust_box_to_icon(),d=s.x-this.model.get("x"),h=s.y-this.model.get("y");this.block.hotspots_group_collection.models.forEach(function(t){a.push(o.a.extend({_id:t.get("_id")},i,s,{x:t.get("x")+d,y:t.get("y")+h}))}.bind(this)),this.block.workspace.set_group(a),this.needRasterize=!0}}.bind(this))}}},onColorboxShowClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.attr("data-field"),n=e.attr("data-field-dop"),o=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),o=0}this.closeAllEditPopups(),this.colorbox_visible=!0,"bg_color"!==i&&"color"!==i||("color"===i?this.$colorbox_container.css({top:e.parent(".edit-item").position().top-this.$colorbox_container.height()+this.$panel.find(".resizable-content-wrapper").height()+this.$panel.find(".common-wrapper").position().top+"px"}):this.$colorbox_container.css({top:e.position().top-this.$colorbox_container.height()+this.$panel.find(".resizable-content-wrapper").height()+this.$panel.find(".common-wrapper").position().top+"px"})),this.$colorbox_container.fadeIn(o),this.colorbox_for_field=i,this.colorbox_for_field_dop=n,this.colorbox.setOpacity(this.getEditValue(n)),this.colorbox.setColor(this.getEditValue(i))},closeColorBox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200)},onPanelScroll:function(t){this.selected&&t.content_size-t.container_size-t.scroll_pos<32&&this.nextPage&&!this.searchInProgress&&this.getDataPage(++this.nextPage)},abortRequests:function(){this.searchXhr&&this.searchXhr.abort(),this.searchInProgress=!1},showSearchPreloader:function(){this.$(".loupe").addClass("preloading")},hideSearchPreloader:function(){this.$(".loupe").removeClass("preloading")},showIconPreloader:function(t){t.append(Object(u.a)('<div class="rmpreloader"><div class="arc"></div></div>')),this.$(".resizable-content").add(t).addClass("preloading")},hideIconPreloader:function(t){this.$(".resizable-content").find(".rmpreloader").remove(),this.$(".resizable-content").add(this.$(".icon-item")).removeClass("preloading")},canControlBeClosed:function(){return this.colorbox_visible?(this.closeAllEditPopups(),!0):a.a.prototype.canControlBeClosed.apply(this,arguments)},deselect:function(){this.closeAllEditPopups(),a.a.prototype.deselect.apply(this,arguments)},destroy:function(){this.abortRequests(),m.prototype.destroy.apply(this,arguments)}});qi.prototype.defaultIconsCollection={icons:[{rm_id:"rm44",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/44-oval.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/44-oval.svg")},{rm_id:"rm45",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/45-plus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/45-plus.svg")},{rm_id:"rm46",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/46-expl.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/46-expl.svg")},{rm_id:"rm47",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/47-que.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/47-que.svg")},{rm_id:"rm48",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/48-photo1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/48-photo1.svg")},{rm_id:"rm49",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/49-photo2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/49-photo2.svg")},{rm_id:"rm50",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/50-info.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/50-info.svg")},{rm_id:"rm51",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/51-info2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/51-info2.svg")},{rm_id:"rm0",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/00-star.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/00-star.svg")},{rm_id:"rm1",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/01-bolt.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/01-bolt.svg")},{rm_id:"rm2",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/02-bubble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/02-bubble.svg")},{rm_id:"rm3",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/03-camera.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/03-camera.svg")},{rm_id:"rm4",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/04-cloud.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/04-cloud.svg")},{rm_id:"rm5",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/05-download1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/05-download1.svg")},{rm_id:"rm6",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/06-download2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/06-download2.svg")},{rm_id:"rm7",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/07-globe2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/07-globe2.svg")},{rm_id:"rm8",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/08-globe.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/08-globe.svg")},{rm_id:"rm9",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/09-pin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/09-pin.svg")},{rm_id:"rm10",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/10-share1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/10-share1.svg")},{rm_id:"rm11",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/11-share2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/11-share2.svg")},{rm_id:"rm12",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/12-send.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/12-send.svg")},{rm_id:"rm13",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/13-checkmark.svg")},{rm_id:"rm14",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/14-x.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/14-x.svg")},{rm_id:"rm15",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/15-minus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/15-minus.svg")},{rm_id:"rm16",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/16-plus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/16-plus.svg")},{rm_id:"rm17",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/17-mail1.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/17-mail1.svg")},{rm_id:"rm18",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/18-mail2.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/18-mail2.svg")},{rm_id:"rm19",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/19-user.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/19-user.svg")},{rm_id:"rm20",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/20-clock.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/20-clock.svg")},{rm_id:"rm21",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/21-embed.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/21-embed.svg")},{rm_id:"rm22",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/22-flag.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/22-flag.svg")},{rm_id:"rm23",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/23-heart.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/23-heart.svg")},{rm_id:"rm24",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/24-itunes.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/24-itunes.svg")},{rm_id:"rm25",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/25-like.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/25-like.svg")},{rm_id:"rm26",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/26-music.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/26-music.svg")},{rm_id:"rm27",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/27-play.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/27-play.svg")},{rm_id:"rm28",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/28-video.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/28-video.svg")},{rm_id:"rm29",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/29-facebook.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/29-facebook.svg")},{rm_id:"rm30",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/30-twitter.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/30-twitter.svg")},{rm_id:"rm31",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/31-linkedin.svg")},{rm_id:"rm32",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/32-pinterest.svg")},{rm_id:"rm33",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/33-instagram.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/33-instagram.svg")},{rm_id:"rm34",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/34-googleplus.svg")},{rm_id:"rm35",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/35-tumblr.svg")},{rm_id:"rm36",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/36-youtube.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/36-youtube.svg")},{rm_id:"rm37",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/37-vimeo.svg")},{rm_id:"rm38",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/38-flickr.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/38-flickr.svg")},{rm_id:"rm39",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/39-blogger.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/39-blogger.svg")},{rm_id:"rm40",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/40-dribbble.svg")},{rm_id:"rm41",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/41-behance.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/41-behance.svg")},{rm_id:"rm42",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/42-rss.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/42-rss.svg")},{rm_id:"rm43",icon_url:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/43-at.svg"),preview_url_42:Object(jt.findImagePath)("./constructor/blocks/button/default-icons-collection/43-at.svg")}]};var Ki=qi,Xi=i("s0L4"),Yi=i.n(Xi),Zi=a.a.extend({name:"hotspot_tip_settings",className:"control hotspot_tip_settings",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=Yi.a["template-constructor-control-hotspot-tip-settings"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.apply_edit_params_visual_state.__debounced=o.a.debounce(this.apply_edit_params_visual_state,20),this.bind_model_events()},bindLogic:function(){this.$colorbox_container=this.$(".colorbox_container"),this.$border_radius_param=this.$panel.find('.edit-wrapper .edit-item[data-field="tip_border-radius"]'),this.$shadow_param=this.$panel.find('.edit-wrapper .edit-item[data-field="tip_box-shadow"]'),this.$position_param=this.$panel.find('.edit-item[data-field="tip_pos"]'),this.$panel.on("click",".edit-wrapper",this.close_all_edit_popups),this.$position_param.find(".position").on("click",this.on_position_click),this.$panel.on("click",".edit-wrapper .color-click-area",this.on_colorbox_show_click),this.colorbox=new ke.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.color_opacity_changed),this.colorbox.on("opacitychange",this.color_opacity_changed),this.border_radius_edit_param_input=Object(u.a)(this.$border_radius_param.find("input")).RMNumericInput({min:0,max:999,mouseSpeed:4,onChange:this.on_edit_input_changed}).data("changeValue"),this.shadow_switcher=Object(u.a)(this.$shadow_param.find(".switcher")).RMSwitcher({state:this.model.get("tip_box-shadow"),width:50,height:28,"text-size-0":12,"text-size-1":12,"color-0":"#0078ff"},function(t){o.a.delay(function(){this.model.set("tip_box-shadow",t)}.bind(this),300)}.bind(this)).data("switcher"),this.apply_edit_params_visual_state(),this.apply_tip_position_param_visual_state(),this.bind_model_events()},unBindLogic:function(){},on_position_click:function(t){var e=Object(u.a)(t.currentTarget).data("position");this.model.set("tip_pos",e)},on_edit_input_changed:function(t,e){var i={};i[t.closest(".edit-item").attr("data-field")]=e,this.model.set(i),this.adjust_inputs_padding()},adjust_inputs_padding:function(){for(var t=["tip_border-radius"],e=0;e<t.length;e++){var i=this.$panel.find('.edit-wrapper .edit-item[data-field="'+t[e]+'"] input'),n=i.val();i.toggleClass("extra-padding-for-one-symbol",1===n.length),i.toggleClass("extra-padding-for-two-symbols",2===n.length)}},bind_model_events:function(){var t=["tip_pos","tip_background-color","tip_background-color-opacity","tip_border-radius"];t.forEach((function(t,e,i){i[e]="change:"+t})),t=t.join(" "),this.listenTo(this.model,t,this.apply_edit_params_visual_state),this.listenTo(this.model,"change:tip_pos",this.apply_tip_position_param_visual_state)},apply_edit_params_visual_state:function(){this.$panel.find(".edit-wrapper").find('.edit-item[data-field="tip_background-color"] .color-circle').css("background-color",y.default.getRGBA(this.get_edit_value("tip_background-color"),this.get_edit_value("tip_background-color-opacity")/100)),this.border_radius_edit_param_input(this.get_edit_value("tip_border-radius"),!0),this.adjust_inputs_padding()},apply_tip_position_param_visual_state:function(){this.$position_param.find(".current").removeClass("current"),this.$position_param.find("."+this.model.get("tip_pos")).addClass("current")},get_edit_value:function(t){return this.model.get(t)},on_colorbox_show_click:function(t){var e=Object(u.a)(t.currentTarget),i=e.attr("data-field"),n=e.attr("data-field-dop"),o=200;if(this.colorbox_visible){if(i===this.colorbox_for_field)return void this.close_colorbox();this.close_colorbox(!0),o=0}this.close_all_edit_popups(),this.colorbox_visible=!0,this.$colorbox_container.css({top:e.position().top+e.height()+"px"}),this.$colorbox_container.fadeIn(o),this.colorbox_for_field=i,this.colorbox_for_field_dop=n,this.colorbox.setOpacity(this.get_edit_value(n)/100),this.colorbox.setColor(this.get_edit_value(i))},close_colorbox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200)},color_opacity_changed:function(t,e,i,n){o.a.clone(this.model.attributes);var a=this.colorbox.rgb2hex([t,e,i]),s=100*n,r={};r[this.colorbox_for_field]=a,r[this.colorbox_for_field_dop]=s,this.model.set(r)},onClick:function(){this.selected&&this.colorbox_visible?this.close_all_edit_popups():a.a.prototype.onClick.apply(this,arguments)},close_all_edit_popups:function(t){t&&Object(u.a)(t.target).closest(".color-click-area").length>0||this.colorbox_visible&&this.close_colorbox()},select:function(){a.a.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-button_settings")}))},deselect:function(){this.close_all_edit_popups(),a.a.prototype.deselect.apply(this,arguments)},canControlBeClosed:function(){return this.colorbox_visible?(this.close_all_edit_popups(),!0):a.a.prototype.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save()},destroy:function(t){a.a.prototype.destroy.apply(this,arguments)}}),Ji=i("xka6"),Qi=i.n(Ji),tn={text:"Text",number:"Number",name:"Name",email:"Email",phone:"Phone number",dropdown:"Dropdown",dropdownEditMode:"Edit dropdown",submit:"Text",textAfterSubmit:"Text after submit",toUrlAfterSubmit:"URL",toPageAfterSubmit:"Jump to page",option:"Edit option",checkbox:"Checkbox"},en={text:"Text",number:"Number",name:"Name",email:"Email",phone:"Phone Number",dropdown:"Dropdown",checkbox:"Checkbox"};Object(n.a)("constructor.formsAddFile")&&(tn.file="File",en.file="File");var nn=function(t,e){return!e||on(t,e)?null:e},on=function(t,e){var i=e&&e.toLowerCase(),n=i===an(t).toLowerCase();return"dropdown"!==t&&"dropdownEditMode"!==t||(n=i===an("dropdown").toLowerCase()||i===an("dropdownEditMode").toLowerCase()),n||i==="Field Text".toLowerCase()},an=function(t){return tn[t]||"Field Text"},sn=function(t,e){var i=o.a.debounce(t,e||300);return function(e){13===e.keyCode?(t(e),Object(u.a)(e.target).blur()):i(e)}},rn=m.prototype,ln=m.extend({name:"form_content",className:"control form_content",events:{"click .js-panel":"onPanelClick","click .js-add":"onAddClick","click .js-field-type":"onFieldTypeClick","click .js-submit-field-type":"onSubmitFieldClick","click .js-dropdown-trigger":"onDropdownTriggerClick","click .js-settings-trigger":"onSettingsTriggerClick","click .js-delete-field":"onDeleteFieldClick","keydown .js-field-caption":"onFieldCaptionKeydown","click .js-submit-dropdown-trigger":"onSubmitArrowClick","click .action-icon:not(.remove-icon)":"onActionIconClick","click .remove-icon":"onRemoveIconClick","click .search-wrapper .placeholder-selector .placeholder-item":"clickPlaceholder","focus .form-fields-caption-submitAfter.toPageAfterSubmit ":"changeAfterSubmitToPageInput","focusout .form-fields-caption-submitAfter.toPageAfterSubmit ":"changeAfterSubmitToPageInput"},MIN_PANEL_HEIGHT:350,MAX_PANEL_HEIGHT:504,SCROLL_GAP_START:4,SCROLL_GAP_END:4,FIELD_TYPES:en,SUBMIT_FIELD_TYPES:{textAfterSubmit:"Text after submit",toUrlAfterSubmit:"Website URL",toPageAfterSubmit:"Jump to Page"},SUBMIT_MODES:{textAfterSubmit:"textAfterSubmit",toUrlAfterSubmit:"toUrlAfterSubmit",toPageAfterSubmit:"toPageAfterSubmit"},PAGE_AFTER_SUBMIT_SHORT_PLACEHOLDER:"Jump to p.",saveOnDestroy:!0,saveOnDeselect:!0,idMap:{},dropdownPanels:{},dropdownModels:[],initialize:function(t){this.template=Qi.a["template-constructor-control-form_content"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,o.a.bindAll(this)},bindLogic:function(){this.listenTo(this.model,"field:add",this.onFieldsChange),this.listenTo(this.model,"field:delete",this.onFieldsChange),this.listenTo(this.model,"field:tp:change",this.onFieldTypeChange),this.listenTo(this.model,"field:caption:change",this.onFieldCaptionChange),this.updateCaptionDebounced=sn(this.updateCaption.bind(this),300)},unBindLogic:function(){this.stopListening(this.model)},render:function(){rn.render.apply(this,arguments),this.$content=Object(u.a)(this.$el.find(".js-fields-container")),this.$settingsPopupContainer=this.$el.find(".js-settings-popup-container"),this.$dropdownPanelContainer=this.$el.find(".js-dropdown-panel-container"),this.$addBlock=this.$el.find(".js-add-block"),this.$scrollable=this.$el.find(".resizable-content-wrapper"),this.$content.sortable({items:".js-sortable",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onSortStart.bind(this),stop:this.onSortEnd.bind(this)}),this.renderContent(),this.updatePanelHeight(this.MIN_PANEL_HEIGHT),this.$addBlock.append(this.buildSettingsPopup({edit:!1})),this.$addSettingsPopup=this.$el.find(".js-add-settings"),this.$submitPopup=this.$el.find(".submit-wrapper"),this.isPageMode()&&this.changeAfterSubmitToPageInput()},select:function(){rn.select.apply(this,arguments),this.resizeToFit()},renderContent:function(){this.$content.empty().append(this.renderFields()),this.refreshSort(),this.resizableScroll&&this.resizableScroll.recalc(),this.renderFieldSettingsPopups(),this.$addBlock.append(this.renderSubmitPopup()),this.$dropdownPanelContainer.empty().append(this.renderDropdowns())},renderFields:function(){var t=Object(u.a)(document.createDocumentFragment());this.idMap={},o.a.each(this.model.get("fields"),function(e,i,n){var a="field-"+y.default.generateUUID();this.idMap[e.sort]=a;var s=this.renderField(o.a.extend({id:a,isOnly:1===n.length},e));t.append(s)}.bind(this)),t.append('<div class="button-header">Button</div>');var e=this.renderField({id:null,caption:this.model.get("button-caption"),tp:"submit"});t.append(e);var i=this.renderField({id:null,caption:this.model.get("button_caption_after_submit"),tp:"submitAfter"});return t.append(i),t},renderField:function(t){return"file"!==t.tp||Object(n.a)("constructor.formsAddFile")?(0,Qi.a["template-constructor-control-form_content-field"])({tp:t.tp,typeLetter:"number"===t.tp?"№":t.tp[0],text:nn("submitAfter"===t.tp?this.model.get("submit_mode"):t.tp,t.caption),sort:t.sort,id:t.id,placeholder:an("submitAfter"===t.tp?this.model.get("submit_mode"):t.tp),showSettings:"submit"!==t.tp&&"submitAfter"!==t.tp,showDelete:"submit"!==t.tp&&!t.isOnly&&"submitAfter"!==t.tp,isSortable:"submit"!==t.tp&&"submitAfter"!==t.tp,showSubmitAfterArrow:"submitAfter"===t.tp,mode:"submitAfter"===t.tp?this.model.get("submit_mode"):"",showRemoveArrow:this.model.get("submit_mode")!==this.SUBMIT_MODES.textAfterSubmit&&this.model.get("link_after_submit")}):""},reRenderField:function(t,e){var i=this.model.get("fields"),n=this.getPredicate(t),a=this.getField(n),s=this.$el.find(".js-field[data-id="+t+"]"),r=this.renderField(o.a.extend({id:t,isOnly:1===i.length},a));s.replaceWith(r),this.refreshSort(),"dropdown"!==a.tp&&"dropdown"!==e||this.$dropdownPanelContainer.empty().append(this.renderDropdowns())},buildFieldSettingsPopups:function(){var t=Object(u.a)(document.createDocumentFragment());return o.a.each(this.model.get("fields"),function(e){var i=this.idMap[e.sort],n=this.buildSettingsPopup({showOptionalSwitcher:!0,selectedType:e.tp,edit:!0,optional:e.optional,id:i});t.append(n)}.bind(this)),t},buildSettingsPopup:function(t){var e=Qi.a["template-constructor-control-form_content-settings"];(t=o.a.extend({types:this.FIELD_TYPES,showOptionalSwitcher:!1,selectedType:null,edit:!1,id:null,sort:null,_:o.a},t)).disabledTypes=this.isFileFieldExists()?["file"]:[];var i=e(t),n=Object(u.a)(i),a=Object(u.a)(n.find(".switcher"));return a.length&&a.RMSwitcher({state:t.optional,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent",id:t.id},this.onSwitcherChange.bind(this)),n},renderSettingsPopup:function(){var t=this.$addBlock.find(".js-add-settings");t&&t.remove(),this.$addBlock.append(this.buildSettingsPopup({edit:!1})),this.$addSettingsPopup=this.$el.find(".js-add-settings")},renderFieldSettingsPopups:function(){this.$settingsPopupContainer.empty().append(this.buildFieldSettingsPopups())},renderSubmitPopup:function(t){var e=(0,Qi.a["template-constructor-control-form_content-after-submit"])(t=o.a.extend({types:this.SUBMIT_FIELD_TYPES,selectedType:this.model.get("submit_mode")||this.SUBMIT_MODES.textAfterSubmit,edit:!1,id:null,sort:null,_:o.a},t));return Object(u.a)(e)},renderDropdowns:function(){var t=Object(u.a)(document.createDocumentFragment()),e=o.a.where(this.model.get("fields"),{tp:"dropdown"});return this.destroyDropdowns(),o.a.each(e,function(e){var i=this.idMap[e.sort],n=this.renderDropdown(e);this.dropdownPanels[i]=n,t.append(n.el)}.bind(this)),t},renderDropdown:function(t){var e=new g.a.Model(o.a.clone(t));this.dropdownModels.push(e),this.listenTo(e,"change:caption",this.onDropdownCaptionChange),this.listenTo(e,"change:items",this.onDropdownItemsChange),this.listenTo(e,"change:height",this.onDropdownHeightChange),this.listenTo(e,"save",this.onDropdownSave);var i=new cn({model:e});return i.render(),i},onSortStart:function(){this.hideSettingsPopups(),this.$el.find(":input").blur(),this.$el.addClass("grabbing")},onSortEnd:function(){this.$el.removeClass("grabbing"),this.reorder(),this.$el.find(".js-field").attr("style","")},onScrollRecalc:function(){o.a.each(this.dropdownPanels,(function(t){t.resizableScroll&&t.resizableScroll.recalc()}))},onSwitcherChange:function(t,e){var i=e.settings.id,n=this.getPredicate(i);this.block.changeField(n,{optional:t})},onPanelClick:function(t){Object(u.a)(t.target).closest(".js-settings-trigger, .js-add, .js-settings-popup, .js-submit-dropdown-trigger").length||this.hideSettingsPopups()},onAddClick:function(){this.toggleSettingsPopup(this.$addSettingsPopup)},onFieldTypeClick:function(t){t.stopPropagation();var e=Object(u.a)(t.target).closest(".js-field-type"),i=e.data("value"),n=e.data("action");if("file"!==i||!this.isFileFieldExists()){if("add"===n)this.addField({tp:i}),this.hideSettingsPopups(),this.scrollToBottom(),this.isPageMode()&&this.changeAfterSubmitToPageInput();else{var o=this.getPredicate(t.target);this.changeFieldType(o,i)}this.renderSettingsPopup(),this.renderFieldSettingsPopups()}},onSubmitFieldClick:function(t){t.stopPropagation();var e=Object(u.a)(event.target).data("value");e!==this.model.get("submit_mode")&&(this.setAfterSubmitMode(e),this.reRenderAfterSubmit(e)),this.hideSettingsPopups()},isFileFieldExists:function(){var t=this.model.get("fields");return o.a.find(t,(function(t){return"file"===t.tp}))},isPageMode:function(){return this.model.get("submit_mode")&&this.model.get("submit_mode")===this.SUBMIT_MODES.toPageAfterSubmit},reRenderAfterSubmit:function(t){var e=this.$el.find(".form-fields-item-submitAfter"),i={tp:"submitAfter",selectedType:t},n=this.renderField(o.a.extend(i));this.$el.find(".js-submit-field-type").removeClass("selected"),this.$el.find(".js-submit-field-type[data-value="+t+"]").addClass("selected"),e.replaceWith(n)},changeAfterSubmitToPageInput:function(t){var e=t?Object(u.a)(t.currentTarget):this.$el.find(".js-field-caption-submitAfter"),i=e.val(),n=this.PAGE_AFTER_SUBMIT_SHORT_PLACEHOLDER,o=-1!==i.indexOf(n)?u.a.trim(i.replace(n,"")):i;-1===i.indexOf(n)&&this.getUrlData(o).result?e.val(n+" "+i):e.val(o)},getUrlData:function(t){var e=this.model.get("submit_mode"),i=RM.constructorRouter.mag,n=od.text_link.prototype.getUrlData(t);return t=n.url,n.isValidPageNumber&&(t=i.getPageId(t)),{result:n.isURL&&e===this.SUBMIT_MODES.toUrlAfterSubmit||n.isValidPageNumber&&this.isPageMode(),url:t}},setAfterSubmitMode:function(t){this.model.set("submit_mode",t)},onDropdownTriggerClick:function(t){var e=Object(u.a)(t.target).closest("[data-id]").data("id"),i=this.dropdownPanels[e];this.hideSettingsPopups(),i&&i.show()},onSettingsTriggerClick:function(t){var e=Object(u.a)(t.target),i=e.closest("[data-id]").data("id"),n=this.$el.find(".js-settings-popup[data-id="+i+"]"),o=e.offset().top-this.$scrollable.offset().top+e.height()/2,a=this.$scrollable.height()-o;this.toggleSettingsPopup(n,{bottom:a})},onDeleteFieldClick:function(t){var e=this.getPredicate(t.target);this.deleteField(e),this.renderSettingsPopup(),this.isPageMode()&&this.changeAfterSubmitToPageInput()},onFieldCaptionKeydown:function(t){this.updateCaptionDebounced(t);var e=this.$el.find(".form-fields-placeholder-selector");t&&t.currentTarget&&Object(u.a)(t.currentTarget).hasClass("toPageAfterSubmit")&&e.hasClass("action-icon")&&13===t.keyCode&&this.onActionIconClick()},updateCaption:function(t){var e=Object(u.a)(t.target),i=this.getPredicate(e),n=e.closest(".js-field").data("type"),o=this.model.get("submit_mode"),a=e.val();if("submit"===n)this.changeButton(a||an("submit"));else if("submitAfter"===n)this.changeButtonAfterSubmit(a||""),o!==this.SUBMIT_MODES.textAfterSubmit&&this.updateClasses(a),!this.isPageMode()&&o!==this.SUBMIT_MODES.toUrlAfterSubmit||this.getUrlData(a).result||(this.changeButtonAfterSubmit(""),this.model.set("link_after_submit",""));else{var s=this.getField(i);a=a||an(s.tp),this.block.changeField(i,{caption:a})}},updateClasses:function(t){var e=this.$el.find(".form-fields-placeholder-selector");e.hasClass("remove-icon")&&e.removeClass("remove-icon"),e.toggleClass("js-submit-dropdown-trigger",!this.getUrlData(t).result),e.toggleClass("action-icon",this.getUrlData(t).result)},onActionIconClick:function(){var t=this.$el.find(".form-fields-placeholder-selector"),e=this.model.get("button_caption_after_submit");t.addClass("remove-icon"),this.model.set("link_after_submit",this.getUrlData(e).url)},onRemoveIconClick:function(){var t=this.$el.find(".form-fields-placeholder-selector"),e=this.$el.find(".form-fields-caption-submitAfter");t.removeClass("action-icon remove-icon").addClass("js-submit-dropdown-trigger"),e.val(""),this.changeButtonAfterSubmit(""),this.model.set("link_after_submit","")},onFieldsChange:function(){this.renderContent()},onFieldTypeChange:function(t,e){var i=this.idMap[t.sort],n=this.$el.find(".js-settings-popup[data-id="+i+"]");n.find(".js-field-type").removeClass("selected"),n.find(".js-field-type[data-value="+t.tp+"]").addClass("selected"),this.reRenderField(i,e)},onFieldCaptionChange:function(t){if("dropdown"===t.tp){var e=this.idMap[t.sort];this.$el.find(".js-field[data-id="+e+"]").find(".js-field-caption").val(nn(t.tp,t.caption))}},onDropdownItemsChange:function(t,e){this.block.changeField({sort:t.get("sort")},{items:o.a.clone(e)})},onDropdownHeightChange:function(t){(t>0||t<0&&this.getContentOverflow(t)<=0)&&this.updatePanelHeight(this.$panel.height()+t)},onDropdownCaptionChange:function(t,e){this.block.changeField({sort:t.get("sort")},{caption:e||an("dropdown")})},onDropdownSave:function(t){var e={caption:t.caption,items:o.a.clone(t.items)};this.block.changeField({sort:t.sort},e),this.save()},onPanelScroll:function(){this.hideSettingsPopups()},toggleSettingsPopup:function(t,e){t.is(".shown")?this.hideSettingsPopup(t):this.showSettingsPopup(t,e)},showSettingsPopup:function(t,e){this.hideSettingsPopups(),o.a.isUndefined(e)||(t.css(e),t.removeClass("below"),t[0].getBoundingClientRect().top<0&&t.addClass("below")),t.addClass("shown")},hideSettingsPopup:function(t){t.removeClass("shown")},hideSettingsPopups:function(){this.hideSettingsPopup(this.$el.find(".js-settings-popup"))},hasSettingsPopupsOpen:function(){return Boolean(this.$el.find(".js-settings-popup.shown").length)},onSubmitArrowClick:function(t){var e=Object(u.a)(t.target),i=e.offset().top-this.$scrollable.offset().top+1.5*e.height(),n=this.$scrollable.height()-i;this.toggleSettingsPopup(this.$submitPopup,{bottom:n})},hideDropdownPanels:function(){o.a.each(this.dropdownPanels,(function(t){t.hide()}))},hasDropdownPanelsOpen:function(){return Boolean(o.a.find(this.dropdownPanels,(function(t){return t.isShown()})))},getPredicate:function(t){var e=o.a.isString(t)?t:Object(u.a)(t).closest("[data-id]").data("id"),i=o.a.invert(this.idMap)[e];return{sort:i?parseInt(i):i}},addField:function(t){var e=o.a.clone(this.model.get("fields")),i=o.a.max(e,"sort").sort||0,n={tp:t.tp,caption:an(t.tp),optional:!1,sort:i+1};"dropdown"===n.tp&&(n.items=this.getDefaultDropdownItems()),e.push(n),this.model.set("fields",e),this.model.trigger("field:add",n),o.a.defer(function(){this.block.trigger("resize")}.bind(this))},changeField:function(t,e){var i=o.a.clone(this.model.get("fields")),n=o.a.findIndex(i,t),a=i[n],s={};o.a.each(e,(function(t,e){s[e]=o.a.clone(a[e])})),null===(a=o.a.extend(o.a.clone(a),e)).items&&delete a.items,i[n]=a,this.model.set("fields",i),o.a.each(e,function(t,e){this.model.trigger("field:"+e+":change",a,s[e])}.bind(this)),this.model.trigger("field:change",a)},changeFieldType:function(t,e){var i=this.getField(t);if(i&&i.tp!==e){var n={tp:e};on(i.tp,i.caption)&&(n.caption=an(e)),"dropdown"===e?n.items=this.getDefaultDropdownItems():"dropdown"===i.tp&&(n.items=null),this.block.changeField(t,n)}},getField:function(t){var e=o.a.find(this.model.get("fields"),t);return e?o.a.clone(e):e},getDefaultDropdownItems:function(){return[an("option"),an("option")]},changeButton:function(t){this.model.set("button-caption",t)},changeButtonAfterSubmit:function(t){this.model.set("button_caption_after_submit",t)},deleteField:function(t){var e=this.model.get("fields");e.length>1&&(e=o.a.reject(e,t),this.model.set("fields",e),this.model.trigger("field:delete",t))},reorder:function(){var t=[],e={};o.a.each(this.$content.find(".js-sortable"),function(i,n){var o=this.getPredicate(i),a=this.getField(o);e[n]=this.idMap[a.sort],a.sort=n,t.push(a)}.bind(this)),this.model.set("fields",t),this.idMap=e,this.$dropdownPanelContainer.empty().append(this.renderDropdowns()),this.model.trigger("fields:reorder")},refreshSort:function(){Object(u.a)(this.$content).sortable("refresh")},scrollToBottom:function(){this.$scrollable.animate({scrollTop:this.$content.height()-this.$scrollable.height()})},getContentOverflow:function(t){return this.$content.height()-(this.$content.parent().height()+(t||0))},resizeToFit:function(){var t=[];t.push(this.getContentOverflow()),o.a.each(this.dropdownPanels,(function(e){t.push(e.getContentOverflow())}));var e=Math.max.apply(null,t);this.updatePanelHeight(this.$panel.height()+e)},canControlBeClosed:function(){return this.hasSettingsPopupsOpen()?(this.hideSettingsPopups(),!0):rn.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save({})},destroyDropdowns:function(){o.a.each(this.dropdownPanels,(function(t){t.destroy()})),this.dropdownPanels={},o.a.each(this.dropdownModels,function(t){this.stopListening(t)}.bind(this)),this.dropdownModels=[]},destroy:function(){this.destroyDropdowns(),rn.destroy.apply(this,arguments)}}),cn=g.a.View.extend({SCROLL_GAP_START:4,SCROLL_GAP_END:4,originalState:null,events:{"click .js-add-option":"onAddOptionClick","click .js-delete-option":"onDeleteOptionClick","click .js-cancel-dropdown":"onCancelDropdownClick","click .js-save-dropdown":"onSaveDropdownClick","keydown .js-dropdown-caption":"onCaptionKeydown","keydown .js-dropdown-option-value":"onOptionKeydown"},initialize:function(t){this.model=t.model,this.template=Qi.a["template-constructor-control-form_content-dropdown"]},rememberState:function(){var t=this.model.attributes;this.originalState=JSON.parse(JSON.stringify(t))},render:function(){var t=this.template();return this.setElement(t),this.$scrollable=this.$el.find(".resizable-content-wrapper"),this.$content=this.$el.find(".js-dropdown-content"),this.$captionContainer=this.$el.find(".js-dropdown-caption-container"),this.$optionsContainer=Object(u.a)(this.$el.find(".js-dropdown-options-container")),this.resizableScroll=Object(u.a)(this.$el.find(".resizable-scroll-wrapper")).RMScroll({$container:this.$el.find(".resizable-content-wrapper"),$content:this.$el.find(".resizable-content"),$handle:this.$el.find(".resizable-scroll"),wheelScrollSpeed:.4,gap_start:this.SCROLL_GAP_START,gap_end:this.SCROLL_GAP_END}).data("scroll"),this.$optionsContainer.sortable({items:".js-sortable",distance:10,axis:"y",scrollSpeed:10,containment:"parent",tolerance:"pointer",start:this.onSortStart.bind(this),stop:this.onSortEnd.bind(this)}),this.renderContent(),this.bindLogic(),this},renderContent:function(){this.$captionContainer.empty().append(this.renderCaption()),this.$optionsContainer.empty().append(this.renderDropdownOptions()),this.refreshSort(),this.resizableScroll&&this.resizableScroll.recalc()},renderCaption:function(){var t=Qi.a["template-constructor-control-form_content-dropdown-caption"],e=this.model.get("caption");return t({text:nn("dropdownEditMode",e),placeholder:an("dropdownEditMode")})},renderDropdownOptions:function(){var t=Object(u.a)(document.createDocumentFragment()),e=Qi.a["template-constructor-control-form_content-dropdown-option"];return o.a.each(this.model.get("items"),function(i,n,o){var a=e({text:nn("option",i),number:n+1,placeholder:an("option"),showDelete:o.length>1});t.append(a)}.bind(this)),t},bindLogic:function(){this.listenTo(this.model,"item:add",this.onModelChange),this.listenTo(this.model,"item:delete",this.onModelChange),this.listenTo(this.model,"revert",this.onModelChange),this.listenTo(this.model,"reorder",this.onModelChange),this.updateCaptionDebounced=sn(this.updateCaption.bind(this),300),this.updateOptionDebounced=sn(this.updateOption.bind(this),300)},unbindLogic:function(){this.stopListening(this.model)},refreshSort:function(){Object(u.a)(this.$optionsContainer).sortable("refresh")},onSortStart:function(){this.$el.find(":input").blur(),this.$el.addClass("grabbing")},onSortEnd:function(){this.$el.removeClass("grabbing"),this.reorder(),this.$el.find(".js-dropdown-option").attr("style","")},onAddOptionClick:function(){this.addOption(),this.$el.find(".js-dropdown-option-value:last").focus();var t=this.getContentOverflow();t>0&&this.model.trigger("change:height",t),this.scrollToBottom()},onDeleteOptionClick:function(t){var e=Object(u.a)(t.target).closest("[data-number]").data("number"),i=e?parseInt(e)-1:-1;this.deleteOption(i)},onCancelDropdownClick:function(){this.revert(),this.hide()},onSaveDropdownClick:function(){this.save(),this.hide()},onCaptionKeydown:function(t){this.updateCaptionDebounced(t)},onOptionKeydown:function(t){this.updateOptionDebounced(t)},updateCaption:function(t){var e=Object(u.a)(t.target).val()||an("dropdown");this.model.set("caption",e)},updateOption:function(t){var e=Object(u.a)(t.target),i=e.val(),n=parseInt(e.data("number"))-1,a=o.a.clone(this.model.get("items"));a[n]=i||an("option"),this.model.set("items",a)},onModelChange:function(){this.renderContent()},addOption:function(){var t=o.a.clone(this.model.get("items")),e=an("option");t.push(e),this.model.set("items",t),this.model.trigger("item:add",e)},deleteOption:function(t){var e=o.a.clone(this.model.get("items"));e.splice(t,1),this.model.set("items",e),this.model.trigger("item:delete",t)},reorder:function(){var t=[],e=this.model.get("items");o.a.each(this.$optionsContainer.find(".js-sortable"),(function(i){var n=parseInt(Object(u.a)(i).data("number")),o=e[n-1];t.push(o)})),this.model.set("items",t),this.model.trigger("reorder")},scrollToBottom:function(){this.$scrollable.animate({scrollTop:this.$content.height()-this.$scrollable.height()})},getContentOverflow:function(t){return this.$content.height()-(this.$content.parent().height()+(t||0))},isShown:function(){return this.$el.is(".shown")},show:function(){this.$el.addClass("shown"),this.rememberState()},hide:function(){this.$el.removeClass("shown")},save:function(){this.model.trigger("save",this.model.attributes)},revert:function(){this.model.set("caption",this.originalState.caption),this.model.set("items",o.a.clone(this.originalState.items)),this.model.trigger("revert")},destroy:function(){this.unbindLogic()}}),dn=ln,hn=i("tzyo"),un=i.n(hn),pn=a.a.prototype,gn=a.a.extend({name:"form_endpoints",className:"control form_endpoints",events:{"click .connect-button:not(.disabled)":"onConnectButtonClick","click .action-icon":"onActionIconClick","input .reach-input":"onReachInputChange","change .list-select":"onListSelectChange","click .try-another":"tryAnotherClick","click .change-email":"changeEmailClick","click .cancel":"cancelRequestClick","click .resend":"resendCodeClick","click .back":"backClick","change .choice-email":"onEmailsSelectChange"},saveOnDeselect:!0,saveOnDestroy:!0,GOOGLE_DEFAULT_SHEET_NAME:"New Form",initialize:function(t){this.template=un.a["template-constructor-control-form_endpoints"],this.listOptionsTemplate=un.a["template-constructor-control-form_endpoints-list-selector"],this.options={flagFormsAddFile:Object(n.a)("constructor.formsAddFile")},this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.switchers={}},render:function(){var t=[],e=RM.constructorRouter.me.get("additionalEmails");e&&e.length>0&&(e.forEach((function(e){!0===e.confirmed&&t.push(e)})),this.model.set("endpoint_additonal_emails",t)),pn.render.apply(this,arguments),this.createSwitchers(),this.$confirmationView=this.$(".panel-section.second_email .confirmation"),this.$emailNew=this.$(".panel-section.second_email .new-email"),this.$inputWrapper=this.$(".panel-section.second_email .input-wrapper"),this.$selectWrapper=this.$(".panel-section.second_email .choice-email"),this.$changeEmail=this.$(".panel-section.second_email .change-email"),this.$(".current-email").text(RM.constructorRouter.me.get("email"));var i=this.$(".input-sheet-name"),n=this.getEndpointParam("google","sheet_name");n&&(i.val(n),this.setReachInputIcon(i,"remove-icon"));var o=this.$(".input-custom-url"),a=this.getEndpointParam("url","custom_url")||"";o.val(a),this.setReachInputIcon(o,a?"remove-icon":"hidden"),this.$panel=this.$(".panel"),RM.constructorRouter.mag.get("shared")&&this.$el.addClass("disabled no-hover"),this.setEmailsView(),Object(u.a)(window).on("resize",this.updateSwitchers)},renderListOptions:function(t,e){this.$(".list-select").html(this.listOptionsTemplate({lists:t,selected:e,_:o.a}))},setEndpointParam:function(t,e,i,n){var a,s="endpoint_"+t,r=this.model.get(s)||{},l={};if("google"===t&&"sheet_name"===e&&i!==r.sheet_name&&delete r.sheet_id,l[e]=i,"additonal_emails"===t)return(a=o.a.isEmpty(r)?[]:r).push(l),void this.model.set(s,a);this.model.set(s,o.a.extend({},r,l),n)},getEndpointParam:function(t,e){var i="endpoint_"+t;return(this.model.get(i)||{})[e]},onReachInputChange:function(t){var e=t instanceof u.a?t:Object(u.a)(t.currentTarget),i=e.val().trim();this.setReachInputIcon(e,i&&this.validateInput(e)?"apply-icon":"hidden")},validateInput:function(t){var e=t.val().trim(),i=t.attr("data-provider");return"url"===i?/http(s?):\/\/.+/i.test(e):"second_email"===i?/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e):"confirmation-code"!==i||4===e.length&&!isNaN(e)},setReachInputIcon:function(t,e){t.closest(".input-wrapper").find(".action-icon").removeClass(["apply-icon","remove-icon","preloader-icon","hidden"].join(" ")).addClass(e)},checkPanelPosition:function(t){if(Object(u.a)(".control.form_endpoints").hasClass("checked")){var e=Object(u.a)(".panel."+t).outerHeight();Object(u.a)(window).height()<=768&&e>=450&&Object(u.a)(".panel").css({top:-Math.round(e/2.3)}),e<450&&Object(u.a)(".panel").css({top:-149})}},createSwitchers:function(){this.model;var t=this.$(".switcher"),e=["google","mailchimp"];o.a.each(t,function(t){var i=Object(u.a)(t),n=i.attr("data-provider");this.switchers[n]=i.RMSwitcher({state:!1,height:26,width:44,"color-0":"#0078ff","color-1":"#c9c8c9","text-color-0":"transparent","text-color-1":"transparent"},this.getSwitcherHandler(n)).data("switcher"),o.a.contains(e,n)&&this.checkAccountConnected(n)}.bind(this)),this.updateState()},getSwitcherHandler:function(t){return function(e){o.a.delay(function(){this.setEndpointParam(t,"enabled",e)}.bind(this),300)}.bind(this)},checkAccountConnected:function(t,e){var i=this.$(".connect-button[data-provider="+t+"]");i.addClass("disabled"),this.xhr=u.a.ajax({dataType:"json",url:"/api/connect/forms/"+t+"/check",method:"GET",success:function(e){this.onSuccessfulConnect(t,e)}.bind(this),error:function(){this.switchers[t].setState(!1)}.bind(this),complete:function(){i.removeClass("disabled")}.bind(this)})},onSuccessfulConnect:function(t,e){e=e||{},this.$(".connect-button[data-provider="+t+"]").closest(".switcher-wrapper").removeClass("disconnected"),"mailchimp"==t&&e.accessToken&&this.updateMailchimpList(e)},updateMailchimpList:function(t){var e=this.$(".input-list-name"),i=this.$(".list-select");this.setReachInputIcon(e,"preloader-icon"),i.prop("disabled",!0),this.xhr=u.a.ajax({dataType:"json",url:"/api/connect/forms/mailchimp/lists",method:"GET",success:function(t){var n=(t=t||{}).lists||[];if(n.length){var o=this.getEndpointParam("mailchimp","list_id");this.renderListOptions(n,o),this.onListSelectChange(),i.prop("disabled",!1)}else e.val("No lists")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this),complete:function(){this.setReachInputIcon(e,"hidden")}.bind(this)})},onListSelectChange:function(){var t=this.$(".list-select"),e=t.val(),i=t.find("option:selected");e||(e=this.getEndpointParam("mailchimp","list_id"),i=t.find("option[value='"+e+"']")),this.$(".input-list-name").val(i.text()),this.setEndpointParam("mailchimp","list_id",i.val()),RM.analytics&&RM.analytics.sendEvent("Form Storage Delete Endpoint Param","mailchimp "+i.text())},processWindowMessage:function(t){var e;if((t=t.originalEvent||{}).origin==St.a.readymag_auth_host){try{e=JSON.parse(decodeURIComponent(t.data))}catch(t){}e&&"social-auth"==e.event&&(Object(u.a)(window).off("message",this.processWindowMessage),this.AuthWindow&&this.AuthWindow.close(),this.AuthWindow=null,this.handleAuthResult(e.message))}},startOauth:function(t){this.AuthWindow&&this.AuthWindow.close(),Object(u.a)(window).on("message",this.processWindowMessage);var e=screen.width,i=screen.height,n=Math.min(1e3,e),o=Math.min(700,i-40),a=Math.ceil((e-n)/2),s=Math.ceil((i-o)/2);this.AuthWindow=window.open("/api/connect/forms/"+t+"/connect","_blank",["toolbar=no","location="+(window.opera?"no":"yes"),"directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no","width="+n,"height="+o,"top="+s,"left="+a].join())},handleAuthResult:function(t){var e=((t=t||{}).data||{}).provider;e&&(this.onSuccessfulConnect(e,t.data),this.switchers[e].setState(!0),RM.analytics&&RM.analytics.sendEvent("Form Storage Successful OAuth Result",e))},onConnectButtonClick:function(t){var e=Object(u.a)(t.currentTarget).attr("data-provider");"google"===e&&this.startOauth("google"),"mailchimp"===e&&this.startOauth("mailchimp"),RM.analytics&&RM.analytics.sendEvent("Form Storage Connect Click",e)},onActionIconClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.closest(".input-wrapper").find("input"),n=i.val().trim(),o=i.attr("data-provider");if(e.hasClass("remove-icon"))i.val(""),this.onReachInputChange(i),"google"===o&&(this.setEndpointParam("google","sheet_name",null),this.setEndpointParam("google","sheet_id",null)),"url"===o&&this.setEndpointParam("url","custom_url",null),RM.analytics&&RM.analytics.sendEvent("Form Storage Delete Endpoint Param",o);else if(e.hasClass("apply-icon")){if(this.setReachInputIcon(i,"remove-icon"),"google"===o)this.getEndpointParam("google","sheet_name")===n||(this.setReachInputIcon(i,"preloader-icon"),this.createSheet(n,function(t,e){this.setReachInputIcon(i,t?"apply-icon":"remove-icon"),!t&&e.spreadsheetId?(this.setEndpointParam("google","sheet_name",n),this.setEndpointParam("google","sheet_id",e.spreadsheetId),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",o+' "'+n+'"')):RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",o+" error")}.bind(this)));"url"==o&&(this.setEndpointParam("url","custom_url",n),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",o+" "+n)),"second_email"==o&&(this.addEmail(n,i),RM.analytics&&RM.analytics.sendEvent("Form Storage Set Endpoint Param",o+" "+n)),"confirmation-code"==o&&this.checkConfirmationCode(n,i)}},addEmail:function(t,e){var i={additonal_email:t,mag_title:RM.constructorRouter.mag.get("title")?RM.constructorRouter.mag.get("title"):"Project Title",page_number:RM.constructorRouter.workspace.getPageNum()};this.xhr=u.a.ajax({dataType:"json",url:"/api/me/addemail",method:"POST",data:i,success:function(){this.$(".panel-section.second_email .back").hasClass("hidden")||this.$(".panel-section.second_email .back").addClass("hidden"),this.$confirmationView.removeClass("hidden"),e.val(""),this.$(".panel-section.second_email .email-for-confirmation").text(t),e.attr("data-provider","confirmation-code"),this.onReachInputChange(e),e.addClass("padding-right-zero"),e.attr("type","text"),e.attr("placeholder","and paste code"),this.checkPanelPosition("second_email")}.bind(this),error:function(e){this.$inputWrapper.addClass("hidden"),this.$(".panel-section.second_email .error.email-for-confirmation").text(t),this.$(".panel-section.second_email .error-block").removeClass("hidden"),console.log("xhr : ",e)}.bind(this)})},setEmailsView:function(t){var e,i,n,o,a=this.model.get("endpoint_additonal_emails")?this.model.get("endpoint_additonal_emails").length:0,s=this.getEndpointParam("selected_email","last_selected_email")?this.getEndpointParam("selected_email","last_selected_email"):"";if(t||(t=s),0===a)this.setInputView();else if(1===a)this.$emailNew.removeClass("hidden"),this.$emailNew.text(t),s||this.setEndpointParam("selected_email","last_selected_email",t),this.$inputWrapper.addClass("hidden"),this.$changeEmail.removeClass("hidden");else{e=this.model.get("endpoint_additonal_emails"),0!==(i=Object(u.a)(".panel-section.second_email .choice-email select")).children("option").length&&i.children("option").remove(),o=e.map((function(t){return t.additonal_email})),s&&!o.includes(s)&&o.push(s);for(var r=0;r<o.length;r++)n=Object(u.a)("<option></option>").text(o[r]),i[0].add(n[0]);i.children("option").filter((function(){return Object(u.a)(this).text()===t})).prop("selected",!0),this.setEndpointParam("selected_email","last_selected_email",t),this.$inputWrapper.addClass("hidden"),this.$changeEmail.removeClass("hidden"),this.$selectWrapper.removeClass("hidden")}},checkConfirmationCode:function(t,e){var i={confirmation_code:t},n=this.$(".panel-section.second_email .confirmation .confirmation.email-for-confirmation").text();this.xhr=u.a.ajax({dataType:"json",url:"/api/me/checkcode",method:"POST",data:i,success:function(){this.setEndpointParam("additonal_emails","additonal_email",n),this.setEmailsView(n),this.$confirmationView.addClass("hidden")}.bind(this),error:function(t){e.addClass("err-code"),setTimeout(o.a.bind((function(){e.removeClass("err-code"),e.val(""),this.$(".panel-section.second_email .input-wrapper .action-icon").removeClass("remove-icon").addClass("hidden")}),this),3e3),console.log("xhr : ",t)}.bind(this)})},backClick:function(){var t=this.getEndpointParam("selected_email","last_selected_email");this.setEmailsView(t),this.$(".panel-section.second_email .back").addClass("hidden")},tryAnotherClick:function(){this.$inputWrapper.removeClass("hidden"),this.$(".panel-section.second_email .error-block").addClass("hidden")},setInputView:function(){var t=this.$(".panel-section.second_email .input-second-email");t.val(""),t.removeClass("padding-right-zero"),t.attr("type","email"),t.attr("placeholder","Add email"),this.$inputWrapper.removeClass("hidden"),t.attr("data-provider","second_email"),this.$(".panel-section.second_email .input-wrapper .action-icon").removeClass("remove-icon").addClass("hidden")},changeEmailClick:function(){this.$(".panel-section.second_email .input-second-email");this.$(".panel-section.second_email .back").removeClass("hidden"),this.model.get("endpoint_additonal_emails").length>1&&this.$(".panel-section.second_email .back").text("Back to list"),this.$selectWrapper.hasClass("hidden")||this.$selectWrapper.addClass("hidden"),this.setInputView(),this.$emailNew.addClass("hidden"),this.$changeEmail.addClass("hidden")},onEmailsSelectChange:function(){var t;Object(u.a)(".choice-email option:selected").each((function(){t=Object(u.a)(this).val()})),this.setEndpointParam("selected_email","last_selected_email",t)},resendCodeClick:function(){var t={additonal_email:this.$(".panel-section.second_email .confirmation .email-for-confirmation").text(),mag_title:RM.constructorRouter.mag.get("title")?RM.constructorRouter.mag.get("title"):"Project Title",page_number:RM.constructorRouter.workspace.getPageNum()};this.xhr=u.a.ajax({dataType:"json",url:"/api/me/resendcode",method:"POST",data:t,success:function(){setTimeout(o.a.bind((function(){this.$(".panel-section.second_email .confirmation.resend").text("Resend confirmation")}),this),4e3),this.$(".panel-section.second_email .confirmation.resend").text("Confirmation sent")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this)})},cancelRequestClick:function(){var t={additonal_email:this.$(".panel-section.second_email .confirmation .email-for-confirmation").text()};this.xhr=u.a.ajax({dataType:"json",url:"/api/me/cancelrequest",method:"POST",data:t,success:function(){this.setEmailsView(),this.$confirmationView.addClass("hidden")}.bind(this),error:function(t){console.log("xhr : ",t)}.bind(this)})},createSheet:function(t,e){this.xhr=u.a.ajax({dataType:"json",url:"/api/connect/forms/google/createsheet",method:"POST",data:{title:t},success:function(t){e(null,t.sheet)}.bind(this),error:function(t){console.log("xhr : ",t),e(t.responseText)}.bind(this)})},setSectionCollapsed:function(t,e){this.$(".panel-section."+t).toggleClass("collapsed",e),this.$panel.toggleClass(t,!e)},hasMailchimpFields:function(){var t=this.model.get("fields");return o.a.any(t,(function(t){return"email"===t.tp&&!t.optional}))},onFieldsChange:function(){this.updateState()},onEndpointsChange:function(){this.updateState()},getEndpointProviders:function(){return o.a.map(this.$(".switcher"),(function(t){return Object(u.a)(t).attr("data-provider")}))},updateState:function(){var t=this.hasMailchimpFields(),e=this.getEndpointProviders();this.allExceptEmailDisabled=!0,o.a.each(o.a.without(e,"email"),function(e){var i=!!this.getEndpointParam(e,"enabled");"mailchimp"==e&&(t||(this.setEndpointParam(e,"enabled",!1,{silent:!0}),i=!1),this.$(".panel-section.mailchimp").find(".switcher-wrapper").toggleClass("forbidden",!t)),i&&(this.allExceptEmailDisabled=!1)}.bind(this)),this.allExceptEmailDisabled&&this.setEndpointParam("email","enabled",!0,{silent:!0}),this.updateSwitchers()},updateSwitchers:function(){o.a.each(o.a.keys(this.switchers),function(t){var e=this.switchers[t],i=!!this.getEndpointParam(t,"enabled");e.setState(i,!0),this.setSectionCollapsed(t,!i),"email"===t&&e.setDisabled(!!this.allExceptEmailDisabled),i&&this.checkPanelPosition(t)}.bind(this))},bindLogic:function(){this.listenTo(this.model,"change:fields",this.onFieldsChange),this.listenTo(this.model,"change:endpoint_email change:endpoint_second_email change:endpoint_google change:endpoint_mailchimp change:endpoint_url",this.onEndpointsChange)},unBindLogic:function(){this.stopListening(this.model)},save:function(){this.model.save({})},deselect:function(){this.getEndpointParam("google","sheet_id")||this.setEndpointParam("google","enabled",!1),this.getEndpointParam("mailchimp","list_id")||this.setEndpointParam("mailchimp","enabled",!1),this.getEndpointParam("url","custom_url")||this.setEndpointParam("url","enabled",!1),this.updateState(),pn.deselect.apply(this,arguments)},destroy:function(){this.xhr&&this.xhr.abort(),Object(u.a)(window).off("message",this.processWindowMessage),pn.destroy.apply(this,arguments)}}),mn=i("tVJf"),fn=i.n(mn),vn=a.a.extend({name:"form_styles",className:"control form_styles",saveOnDeselect:!0,saveOnDestroy:!0,initialize:function(t){this.template=fn.a["template-constructor-control-form_styles"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model,this.state="fields",this.buttonState="default"},bindLogic:function(){var t=this;function e(e,i,n){t.inputs[e][i]=Object(u.a)(t.$panel.find(".edit-wrapper .params-block.params-"+e+' .edit-item[data-field="'+i+'"] input')).RMNumericInput(n).data("changeValue")}this.$colorbox_container=this.$(".colorbox_container"),this.$panel.on("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.on("click",".edit-wrapper .layout-wrapper .layout-switcher",this.onLayoutSwitchClick),this.$panel.on("click",".edit-wrapper .style-wrapper .prev-style",this.onStyleSwitchClick),this.$panel.on("click",".edit-wrapper .style-wrapper .next-style",this.onStyleSwitchClick),this.$panel.on("click",".edit-wrapper .type-wrapper .type-switcher",this.onTypeSwitchClick),this.$panel.on("click",".edit-wrapper .button-switcher-wrapper .button-switcher",this.onButtonSwitchClick),this.$panel.on("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.colorbox=new ke.a({$parent:this.$colorbox_container,type:"small"}),this.colorbox.on("colorchange",this.colorOpacityChanged),this.colorbox.on("opacitychange",this.colorOpacityChanged),this.fontselector=new Se.a({$parent:this.$(".fontselector_container")}),this.fontselector.on("selectfont",this.fontChanged),this.$panel.on("click",".edit-wrapper .font-family-click-area",this.onFontSelectorShowClick),this.$panel.on("click",".edit-wrapper .font-style-click-area",this.onFontStyleShowClick),this.$panel.on("click",".edit-wrapper .align",this.onAlignChangeClick),this.model.on("change",this.onChange),this.inputs={fields:{},"button-default":{},"button-hover":{}},e("fields","gutter",{min:-99,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","border-radius",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","underline-width",{min:0,max:99,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","font-size",{min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}),e("fields","letter-spacing",{min:this.block.MIN_LETTER_SPACING,max:this.block.MAX_LETTER_SPACING,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","gutter",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","border-radius",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","font-size",{min:this.block.MIN_FONT_SIZE,max:this.block.MAX_FONT_SIZE,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-default","letter-spacing",{min:this.block.MIN_LETTER_SPACING,max:this.block.MAX_LETTER_SPACING,mouseDir:"h",useFloat:!0,step:.2,mouseSpeed:4,onChange:this.onEditInputChanged}),e("button-hover","border-width",{min:0,max:999,mouseSpeed:4,onChange:this.onEditInputChanged}),Object(u.a)(this.$panel.find('.edit-wrapper .params-block.params-button-hover .edit-item[data-field="transition"] .switcher')).RMSwitcher({state:this.getCurrentStyleParam("button-hover","transition"),width:44,height:26,"text-size-0":0,"text-size-1":0,"color-0":"#0078ff"},function(t){o.a.delay(function(){this.setCurrentStyleParam("button-hover","transition",t)}.bind(this),300)}.bind(this)).data("switcher"),this.setAlignText(),this.updateControlState(),this.updateStylesState()},unBindLogic:function(){this.$panel.off("click",".edit-wrapper",this.closeAllEditPopups),this.$panel.off("click",".edit-wrapper .layout-wrapper .layout-switcher",this.onLayoutSwitchClick),this.$panel.off("click",".edit-wrapper .style-wrapper .prev-style",this.onStyleSwitchClick),this.$panel.off("click",".edit-wrapper .style-wrapper .next-style",this.onStyleSwitchClick),this.$panel.off("click",".edit-wrapper .type-wrapper .type-switcher",this.onTypeSwitchClick),this.$panel.off("click",".edit-wrapper .button-switcher-wrapper .button-switcher",this.onButtonSwitchClick),this.$panel.off("click",".edit-wrapper .color-click-area",this.onColorboxShowClick),this.$panel.off("click",".edit-wrapper .align",this.onAlignChangeClick),this.colorbox&&(this.colorbox.off("colorchange",this.colorOpacityChanged),this.colorbox.off("opacitychange",this.colorOpacityChanged),this.colorbox.destroy(),this.colorbox=null),this.fontselector&&(this.fontselector.off("selectfont",this.fontChanged),this.$panel.off("click",".edit-wrapper .font-family-click-area",this.onFontSelectorShowClick),this.$panel.off("click",".edit-wrapper .font-style-click-area",this.onFontStyleShowClick),this.fontselector.destroy(),this.fontselector=null),this.model&&this.model.off(null,null,this)},onChange:function(t,e){(e.undo||e.redo)&&(this.updateControlState(),this.updateStylesState(e))},onAlignChangeClick:function(){var t=this.getCurrentStyleParam(this.getCurrentState(),"text-align")||"center";this.setCurrentStyleParam(this.getCurrentState(),"text-align","center"===t?"left":"center"),this.setAlignText(),this.updateControlState(),this.updateStylesState()},setAlignText:function(){var t=Object(u.a)(".edit-wrapper .align .caption"),e=this.getCurrentStyleParam(this.getCurrentState(),"text-align")||"center",i="center"===e?"center":"left";this.setCurrentStyleParam(this.getCurrentState(),"text-align",e),t.text("Aligned ".concat(i))},onLayoutSwitchClick:function(t){Object(u.a)(t.currentTarget).hasClass("layout-vertical")?this.model.set({layout:"vertical"}):this.model.set({layout:"horizontal"});var e=this.block.getDefaultDimensions();this.model.set({w:e.width,h:e.height}),this.updateControlState(),this.updateStylesState()},onStyleSwitchClick:function(t){var e=Object(u.a)(t.currentTarget).hasClass("prev-style")?-1:1,i=["colored","outlined","underlined"],n=(o.a.indexOf(i,this.model.get("style"))+i.length+e)%i.length;this.model.set("style",i[n]),this.setAlignText(),this.updateControlState(),this.updateStylesState()},onTypeSwitchClick:function(t){Object(u.a)(t.currentTarget).hasClass("type-fields")?this.state="fields":this.state="button",this.updateControlState(),this.updateStylesState()},onButtonSwitchClick:function(t){Object(u.a)(t.currentTarget).hasClass("button-default")?this.buttonState="default":this.buttonState="hover",this.updateControlState(),this.updateStylesState()},getCurrentStyleParam:function(t,e){var i="style-"+this.model.get("style")+"-"+t,n=this.model.get(i)[e];return"inherit"===n&&"button-default"==t&&(i="style-"+this.model.get("style")+"-fields",n=this.model.get(i)[e]),"inherit"===n&&"button-hover"==t&&(i="style-"+this.model.get("style")+"-button-default","inherit"===(n=this.model.get(i)[e])&&(i="style-"+this.model.get("style")+"-fields",n=this.model.get(i)[e])),n},setCurrentStyleParam:function(t,e,i){var n="style-"+this.model.get("style")+"-"+t,a=o.a.clone(this.model.get(n));if(a[e]=i,"font-family"==e){var s=this.getCurrentStyleParam(this.getCurrentState(),"font-weight"),r=this.getCurrentStyleParam(this.getCurrentState(),"font-style"),l=RM.constructorRouter.fonts.findFontByCSSName(i),c=("italic"==r.toLowerCase()?"i":"n")+Math.floor(s/100);o.a.contains(l.variations,c)||(a["font-weight"]=100*(l.variations[0]||"n4").slice(1))}this.model.set(n,a)},getCurrentState:function(){var t=this.state;return"button"==t&&(t+="-"+this.buttonState),t},updateControlState:function(){this.$(".edit-wrapper").attr("data-state",this.state).attr("data-button-state",this.buttonState).attr("data-style",this.model.get("style")).attr("data-layout",this.model.get("layout")),this.$(".style-wrapper .style-caption").text(y.default.capitalize(this.model.get("style"))),"button"==this.state&&"hover"==this.buttonState?this.block.setButtonHoverState():this.block.unsetButtonHoverState()},updateStylesState:function(t){t=t||{};var e=this.getCurrentState(),i=this.inputs[e],n=this.$panel.find(".edit-wrapper .params-block.params-"+e);if(["gutter","border-radius","border-width","underline-width","font-size","letter-spacing","text-align"].forEach(function(o){var a=n.find(".edit-item[data-field="+o+"] input"),s=i[o],r=this.getCurrentStyleParam(e,o);s&&(s(r,!0),t.undo||t.redo||this.onEditInputChanged(a,r))}.bind(this)),this.getCurrentStyleParam(e,"color")&&n.find('.edit-item[data-field="color"] .color-circle').css("background-color",y.default.getRGBA(this.getCurrentStyleParam(e,"color"),this.getCurrentStyleParam(e,"opacity")/100)),this.getCurrentStyleParam(e,"border-color")&&n.find('.edit-item[data-field="border-color"] .color-circle').css("background-color",y.default.getRGBA(this.getCurrentStyleParam(e,"border-color"),this.getCurrentStyleParam(e,"border-opacity")/100)),this.getCurrentStyleParam(e,"underline-color")&&n.find('.edit-item[data-field="underline-color"] .color-circle').css("background-color",y.default.getRGBA(this.getCurrentStyleParam(e,"underline-color"),this.getCurrentStyleParam(e,"underline-opacity")/100)),this.getCurrentStyleParam(e,"text-color")&&n.find('.edit-item[data-field="text-color"] .color-circle').css("background-color",y.default.getRGBA(this.getCurrentStyleParam(e,"text-color"),this.getCurrentStyleParam(e,"text-opacity")/100)),n.find(".font-family").length){var o=RM.constructorRouter.fonts.findFontByCSSName(this.getCurrentStyleParam(e,"font-family")),a=RM.constructorRouter.fonts.getStyleName(this.getCurrentStyleParam(e,"font-weight"),this.getCurrentStyleParam(e,"font-style"),o.name);n.find(".font-family").text(o.name).css("font-family",o.css_name),n.find(".font-style").text(a).css({"font-family":o.css_name,"font-style":this.getCurrentStyleParam(e,"font-style"),"font-weight":this.getCurrentStyleParam(e,"font-weight")})}},onEditInputChanged:function(t,e){var i=t.closest(".edit-item").attr("data-field"),n=(e-this.getCurrentStyleParam(this.getCurrentState(),i))*("fields"==this.state?this.model.get("fields").length:1),o="vertical"==this.model.get("layout")?"h":"w";if(this.setCurrentStyleParam(this.getCurrentState(),i,e),"gutter"==i&&this.model.set(o,this.model.get(o)+n),"font-size"==i||"underline-width"==i){var a=this.block.getMinimalDimensions();(a.width>this.model.get("w")||a.height>this.model.get("h"))&&this.model.set({w:Math.max(a.width,this.model.get("w")),h:Math.max(a.height,this.model.get("h"))})}},fontChanged:function(t){this.setCurrentStyleParam(this.getCurrentState(),"font-family",t),this.updateStylesState()},fontStyleChanged:function(t){this.setCurrentStyleParam(this.getCurrentState(),"font-weight",Object(u.a)(t.currentTarget).attr("data-font-weight")),this.setCurrentStyleParam(this.getCurrentState(),"font-style",Object(u.a)(t.currentTarget).attr("data-font-style")),this.closeFontStyle(),this.updateStylesState()},colorOpacityChanged:function(t,e,i,n){var o=this.colorbox.rgb2hex([t,e,i]),a=100*n;this.setCurrentStyleParam(this.getCurrentState(),this.colorbox_for_field,o),this.setCurrentStyleParam(this.getCurrentState(),this.colorbox_for_field_dop,a),this.updateStylesState()},onFontSelectorShowClick:function(t){this.fontselector_visible?this.closeFontSelector():(this.closeAllEditPopups(),this.fontselector_visible=!0,this.fontselector&&this.fontselector.show([this.getCurrentStyleParam(this.getCurrentState(),"font-family")]),this.positionPopup(this.$(".fontselector_container"),Object(u.a)(t.currentTarget)))},onFontStyleShowClick:function(t){if(this.fontstyle_visible)this.closeFontStyle();else{this.closeAllEditPopups();var e=this.$(".fontstyle_container .font-style-wrapper");e.empty();var i=RM.constructorRouter.fonts.findFontByCSSName(this.getCurrentStyleParam(this.getCurrentState(),"font-family"));i&&(o.a.each(i.variations,function(t){var n=100*(t.substr(1,1)-0),o="n"==t.substr(0,1)?"normal":"italic",a=RM.constructorRouter.fonts.getStyleName(n,o,i.name),s=Object(u.a)("<div>").appendTo(e).addClass("font-style-item").text(a).css({"font-family":i.css_name,"font-weight":n+"","font-style":o}).attr("data-font-weight",n).attr("data-font-style",o).on("click",this.fontStyleChanged);Object(u.a)("<div>").appendTo(s).addClass("point");n==this.getCurrentStyleParam(this.getCurrentState(),"font-weight")&&o==this.getCurrentStyleParam(this.getCurrentState(),"font-style")&&s.addClass("curr")}.bind(this)),this.fontstyle_visible=!0,this.$(".fontstyle_container").fadeIn(200),this.positionPopup(this.$(".fontstyle_container"),Object(u.a)(t.currentTarget)))}},onColorboxShowClick:function(t){var e=Object(u.a)(t.currentTarget),i=e.attr("data-field"),n=e.attr("data-field-dop"),o=200;if(this.colorbox_visible){if(i==this.colorbox_for_field)return void this.closeColorBox();this.closeColorBox(!0),o=0}this.closeAllEditPopups(),this.colorbox_visible=!0,this.$colorbox_container.fadeIn(o),"text-color"===i&&"fields"===this.state&&this.block.toggleInputValue(!0),this.colorbox_for_field=i,this.colorbox_for_field_dop=n,this.colorbox.setOpacity(this.getCurrentStyleParam(this.getCurrentState(),n)/100),this.colorbox.setColor(this.getCurrentStyleParam(this.getCurrentState(),i)),this.positionPopup(this.$colorbox_container,Object(u.a)(t.currentTarget))},positionPopup:function(t,e){var i=t.children().first().height(),n=this.$panel.height(),o=Math.floor((n-i)/2),a=e.offset().top-this.$panel.offset().top,s=Math.max(a+i-n+16,0);t.css({top:Math.max(o,a-s)})},closeFontSelector:function(){this.fontselector_visible=!1,this.fontselector.hide()},closeFontStyle:function(){this.fontstyle_visible=!1,this.$(".fontstyle_container").fadeOut(200)},closeColorBox:function(t){this.colorbox_visible=!1,this.$colorbox_container.fadeOut(t?0:200),"text-color"===this.colorbox_for_field&&"fields"===this.state&&this.block.toggleInputValue(!1)},onClick:function(){this.selected&&(this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible)?this.closeAllEditPopups():a.a.prototype.onClick.apply(this,arguments)},closeAllEditPopups:function(t){if(t){if(Object(u.a)(t.target).closest(".color-click-area").length>0)return;if(Object(u.a)(t.target).closest(".font-family-click-area").length>0)return;if(Object(u.a)(t.target).closest(".font-style-click-area").length>0)return}this.colorbox_visible&&this.closeColorBox(),this.fontselector_visible&&this.closeFontSelector(),this.fontstyle_visible&&this.closeFontStyle()},canControlBeClosed:function(){return this.colorbox_visible||this.fontselector_visible||this.fontstyle_visible?(this.closeAllEditPopups(),!0):a.a.prototype.canControlBeClosed.apply(this,arguments)},save:function(){this.model.save({})},select:function(){a.a.prototype.select.apply(this,arguments),this.updateControlState()},deselect:function(){this.closeAllEditPopups(),"button"==this.state&&"hover"==this.buttonState&&setTimeout(function(){this.block.unsetButtonHoverState()}.bind(this),250),a.a.prototype.deselect.apply(this,arguments)},destroy:function(t){"button"==this.state&&"hover"==this.buttonState&&setTimeout(function(){this.block.unsetButtonHoverState()}.bind(this),250),a.a.prototype.destroy.apply(this,arguments)}}),bn=me.extend({name:"video_settings",alt:"Video",panelComponent:"panel-video",select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-video_settings")}))},restrictions:function(t){var e=t.getSelectedBlocks();return 1===e.length&&"video"===e[0].model.get("type")},onPanelChange:function(t){me.prototype.onPanelChange.apply(this,arguments),this.model.changed.hasOwnProperty("video_id")&&this.model.save({})}}),_n=me.extend({name:"audio_settings",alt:"Settings",panelComponent:"panel-audio-settings",select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-audio_settings")}))}}),yn=me.extend({name:"twitter_settings",alt:"Settings",panelComponent:"panel-twitter-settings"}),wn=me.extend({name:"facebook_settings",alt:"Settings",panelComponent:"panel-facebook-settings"}),kn=me.extend({name:"iframe_edit",alt:"Edit Code",select:function(){me.prototype.select.apply(this,arguments),this.block.showPanel()},deselect:function(){this.block.hidePanel(),me.prototype.deselect.apply(this,arguments)},bindLogic:function(){this.block.on("editCodeClick",this.onClick)},unBindLogic:function(){this.block.off("editCodeClick")}}),Sn=me.extend({name:"cart_connections",alt:"Cart connections",panelComponent:"panel-cart-connections"}),xn=me.extend({name:"cart_settings",alt:"Settings",panelComponent:"panel-cart-settings"}),Cn=i("QP/g"),On=i.n(Cn),Pn=i("3ED2"),jn=i.n(Pn),$n=a.a.extend({name:"cart_add_product_widget",className:"control cart_add_product_widget",restrictions:function(t){return t.eCommerceManager.isMagConnectedToStripe()},initialize:function(t){this.template=On.a["template-constructor-control-cart_add_product_widget"],this.initControl(t),this.block=this.blocks[0],this.model=this.block.model},render:function(){a.a.prototype.render.apply(this,arguments);var t=this.$el.find(".svg");jn()(t)},onClick:function(){this.isOnClickDisabled()||this.block&&this.block.workspace&&this.block.workspace.createWidget(St.a.addToCartBlockName)}}),Tn=me.extend({name:"product_selector",alt:"Select product",panelComponent:"panel-product-selector"}),In=me.extend({name:"add_to_cart_settings",alt:"Settings",panelComponent:"panel-addtocart-settings"}),En=me.extend({name:"slideshow_settings",alt:"Settings",panelComponent:"panel-slideshow-settings",select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-slideshow_settings")})),this.block.updateDropZone()},setPopupToDefault:function(){this.model.set("current_mode","default")},onEscKey:function(){if(this.selected&&this.checkNeedClosePopup())return this.setPopupToDefault(),void this.closeColorBox();me.prototype.onEscKey.apply(this,arguments)},checkNeedClosePopup:function(){return"default"!==this.model.get("current_mode")||this.block.colorbox_visible},canControlBeClosed:function(){if(this.checkNeedClosePopup())return this.closeColorBox(),this.setPopupToDefault(),!0;me.prototype.canControlBeClosed.apply(this,arguments)},closeColorBox:function(){this.block.settingsPanel.closePopups(),this.block.colorbox_visible=!1},deselect:function(){this.setPopupToDefault(),me.prototype.deselect.apply(this,arguments)},destroy:function(){this.block.needRasterize&&(this.block.rasterizeIconsBeforeDestroy(),delete this.block.needRasterize),me.prototype.destroy.apply(this,arguments)}}),Mn=me.extend({name:"slideshow_transitions",alt:"Transitions",panelComponent:"panel-slideshow-transitions",onPanelChange:function(t){me.prototype.onPanelChange.apply(this,arguments)},select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-slideshow_transitions")}))},deselect:function(){me.prototype.deselect.apply(this,arguments)}}),Rn=i("RedZ"),An=i.n(Rn),Dn=i("udqo"),zn=a.a.extend({name:"picture_preview",className:"control picture_preview",initialize:function(t){var e=this;this.template=An.a["template-constructor-control-picture_preview"],this.initControl(t),this.updateState();var i=this.models[0];this.preview=new Dn.a({$container:Object(u.a)("#main"),$el:this.blocks[0].$el,overlayColor:i.get("preview_overlay_color"),picture:i.get("picture"),originalW:i.get("originalW"),width:i.get("w")}),this.saveDebounced=o.a.debounce((function(){e.master.workspace.save_group(o.a.pluck(e.blocks,"model"))}),1e3)},select:function(){if(!this.$preview){if(a.a.prototype.select.apply(this,arguments),this.hasOnClickAnimation())return this.$panel.addClass("show-animation-error");if(this.hasLink())return this.$panel.addClass("show-link-error");this.$panel.removeClass("show-animation-error show-link-error"),1===this.models.length&&this.models[0].get("preview_enabled")&&(this.$preview=this.preview.render())}},deselect:function(){var t=this;this.selected&&this.colorboxOpened?this.colorbox.hide():(this.preview.remove((function(){delete t.$preview})),this.colorbox.hide(),a.a.prototype.deselect.apply(this,arguments))},render:function(){a.a.prototype.render.apply(this,arguments);var t=this.$el.find(".svg");jn()(t)},bindLogic:function(){this.$(".icon-preview-toggle").on("click",this.previewToggle),this.$colorbox_container=this.$(".colorbox_container"),this.models[0].on("change",this.onPictureChange);var t=this.models[0].get("preview_overlay_color"),e=t?y.default.rgba2alpha(t):.6;if(!t){var i=this.models.map((function(t){return{_id:t.id,preview_overlay_color:"rgba(0, 0, 0, "+e+")"}}));this.master.workspace.set_group(i),this.saveDebounced()}var n=z.default.extend(et.a);this.colorbox=new n({el:this.$colorbox_container.get(0),propsData:{type:"small",color:t?y.default.rgba2hex(t).slice(1):"000000",alpha:100*e,hOffset:36,vOffset:-64}}),this.colorbox.$on("update:all",this.onColorChanged),this.colorbox.$on("showPopup",this.onColorboxOpened),this.colorbox.$on("hidePopup",this.onColorboxClosed)},onColorboxOpened:function(){this.colorboxOpened=!0},onColorboxClosed:function(){this.colorboxOpened=!1},unBindLogic:function(){var t=this;this.$(".icon-preview-toggle").off("click",this.previewToggle),this.models[0].off("change",this.onPictureChange),this.colorbox.$off("update:all",this.onColorChanged),this.preview.remove((function(){delete t.$preview}))},updateState:function(){this.previewEnabled=this.models[0].get("preview_enabled"),this.$el.toggleClass("enabled",!!this.previewEnabled)},onColorChanged:function(t){var e=y.default.hex2rgb(t.color),i="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+t.alpha/100+")",n=this.models.map((function(t){return{_id:t.id,preview_overlay_color:i}}));this.master.workspace.set_group(n),this.saveDebounced(),this.preview.changeColor(i)},restrictions:function(t){var e=t.getSelectedBlocks();return e.length<=1||e.map((function(t){return t.model.get("preview_enabled")})).every((function(t,e,i){return t===i[0]}))},previewToggle:function(){var t=this;if(!this.isOnClickDisabled()){this.previewEnabled=!this.previewEnabled,RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Picture Settings","Lightbox ".concat(this.previewEnabled?"enabled":"disabled"));var e=this.models.map((function(e){return{_id:e.id,preview_enabled:t.previewEnabled}}));this.master.workspace.set_group(e),this.saveDebounced(),this.updateState(),this.previewEnabled?1===this.models.length&&(this.$preview=this.preview.render()):(this.preview.remove((function(){delete t.$preview})),this.colorbox.hide())}},hasOnClickAnimation:function(){return this.models.reduce((function(t,e){return t||Boolean(e.getAnimations().find((function(t){return"click"===t.type&&t.steps&&t.steps.length})))}),!1)},hasLink:function(){return this.models.reduce((function(t,e){return t||!!e.get("clickLink")}),!1)},onPictureChange:function(){if(this.preview){var t=this.models[0].get("picture");this.preview.picture=t,this.preview.overlayColor=this.models[0].get("preview_overlay_color"),this.preview.originalW=this.models[0].get("originalW"),this.preview.height=this.models[0].get("h"),this.preview.width=this.models[0].get("w")}},onClick:function(){this.selected&&this.colorboxOpened?this.colorbox.hide():a.a.prototype.onClick.apply(this,arguments)},onEscKey:function(){this.selected&&this.colorboxOpened?this.colorbox.hide():a.a.prototype.onEscKey.apply(this,arguments)},canControlBeClosed:function(){if(this.colorboxOpened)return this.colorbox.hide(),!0;a.a.prototype.canControlBeClosed.apply(this,arguments)}}),Ln=me.extend({name:"picture_alt",alt:"Alt text for picture",panelComponent:"panel-picture-alt",select:function(){me.prototype.select.apply(this,arguments),Promise.resolve().then(i.bind(null,"Vxjr")).then((function(t){(0,t.default)("controls-picture_alt")}))},restrictions:function(t){var e=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions"),i=t.getSelectedBlocks();return 1===i.length&&i[0].isPictureEmpty&&!i[0].isPictureEmpty()&&e&&e.can_use_picture_alt}}),Bn=me.extend({name:"rmheader_settings",alt:"RM Header Settings",panelComponent:"panel-rmheader-settings"}),Fn=i("QNie"),Nn=i("q1tI"),Un=i.n(Nn),Hn=i("8AXF"),Vn=i("vOnD"),Wn=i("iC7s"),Gn=i("wEEd"),qn=Object(Vn.e)(Wn.m).withConfig({displayName:"Control___StyledBox"})(["transition:opacity 0.2s ease;"]),Kn=Object(Vn.e)(Wn.C).withConfig({displayName:"Control___StyledFlex"})(["&:hover{color:#1ce4c8;}"]),Xn=function(t,e){var i=t.children,n=t.onClick,o=t.onMouseEnter,a=t.onMouseLeave,s=t.label,r=Object(Nn.useContext)(Hn.BackboneContext).destroy,l=Object(Nn.useContext)(Fn.a).model,c=Object(Gn.d)(l.visible,null,{config:{duration:200},from:l.appearanceAnimation?{opacity:0,transform:"translateX(7px)"}:{},enter:{opacity:1,transform:"translateX(0px)"},leave:{opacity:0,transform:"translateX(-7px)"},onDestroyed:function(t){t&&r()}});return Un.a.createElement(qn,{ref:e,left:"0px",position:"absolute",top:l.y,width:30,height:30},c.map((function(t){var e=t.item,r=t.key,c=t.props;return e&&Un.a.createElement(Gn.a.div,{key:r,style:c},Un.a.createElement(Wn.Cb,{text:s,position:"left",indent:8,disabled:l.selected},Un.a.createElement(Kn,{as:"button",bg:"rgba(68, 68, 76, 0.95)",width:30,height:30,borderRadius:"50%",disabled:l.disabled,onClick:n,onMouseEnter:o,onMouseLeave:a,justifyContent:"center",alignItems:"center",border:"none",p:"0",color:"white",opacity:l.disabled?.3:l.faded?.4:1,cursor:l.disabled||l.faded?"default":"pointer"},i)))})))},Yn=Un.a.forwardRef(Xn),Zn=i("KFoM"),Jn=i("rJga"),Qn=i("9P9J"),to=i("Fi5S"),eo=i("3Qzt");function io(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function no(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?io(Object(i),!0).forEach((function(e){oo(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):io(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function oo(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ao(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return so(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return so(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function so(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ro=function(t){var e=t.control,i=t.panel,n=ao(Object(Nn.useState)(0),2),o=n[0],a=n[1],s=ao(Object(Nn.useState)(0),2),r=s[0],l=s[1],c=ao(Object(Nn.useState)(!1),2),d=c[0],h=c[1],u=Object(Nn.useContext)(Fn.a).model,p=ao(Object(Nn.useState)(!1),2),g=p[0],m=p[1],f=Object(Gn.c)({immediate:!u.selected||!u.visible||d,right:"".concat(g?r:o,"px"),config:{duration:250,easing:eo.a.easeInOutCubic}}),v=function(){h(!1),m(!0)},b=function(){h(!1),m(!1)},_=function(){h(!0)};return Object(Nn.useEffect)((function(){return to.a.on("constructorSettings:open",v),to.a.on("constructorSettings:close",b),window.addEventListener("resize",_,!1),function(){to.a.off("constructorSettings:open",v),to.a.off("constructorSettings:close",b),window.removeEventListener("resize",_,!1)}}),[]),Object(Nn.useEffect)((function(){var t=document.getElementById("constructor-settings-sidebar"),e=u.controlsManager&&u.controlsManager.$el?u.controlsManager.$el[0]:void 0,i=t&&t.getBoundingClientRect()&&t.getBoundingClientRect().width,n=t&&t.getBoundingClientRect()&&t.getBoundingClientRect().left,o=e&&e.getBoundingClientRect(),s=-(o.right-o.width-16),r=window.innerWidth;i&&n?(a(g||n===r?s:s-i),l(s+i)):a(s)}),[g]),Un.a.createElement(Zn.a,null,Un.a.createElement(Jn.a,null,e),Un.a.createElement(Qn.a,{placement:"left",modifiers:[{name:"offset",options:{offset:[0,16]}},{name:"computeStyles",options:{gpuAcceleration:!1}},{name:"preventOverflow",options:{padding:16}}]},(function(t){return i(no(no({},t),{},{style:Object.assign(t.style,d?{}:f)}))})))},lo=i("i8i4"),co=i.n(lo);function ho(){return(ho=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function uo(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function po(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?uo(Object(i),!0).forEach((function(e){go(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):uo(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function go(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function mo(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var fo=function(t,e){var i=t.children,n=(t.color,t.style),o=void 0===n?{}:n,a=mo(t,["children","color","style"]),s=Object(Nn.useContext)(Fn.a).model,r=Object(Gn.d)(s.selected,null,{config:{duration:200},from:{opacity:0,transform:"translateX(8px)"},enter:{opacity:1,transform:"translateX(0px)"},leave:{opacity:0,transform:"translateX(8px)"}}),l=document.getElementById("controls-portal");return l?co.a.createPortal(Un.a.createElement(Un.a.Fragment,null,r.map((function(t){var n=t.item,s=t.key,r=t.props;return n&&Un.a.createElement(Gn.a.div,{ref:e,key:s,style:po(po({width:a.width||170},r),o)},Un.a.createElement(Wn.m,ho({bg:"lightGray",borderRadius:8,border:"1px solid",borderColor:"#F0F0F0"},a),i))}))),l):null},vo=Un.a.forwardRef(fo),bo=i("za5s");function _o(){return(_o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function yo(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var wo=Vn.e.input.attrs({type:"range"}).withConfig({displayName:"PanelListItem__RangeInput"})(["display:block;-webkit-appearance:none;width:100%;margin:0;height:8px;background:transparent;&:focus{outline:none;}&::-webkit-slider-thumb{-webkit-appearance:none;width:8px;height:8px;background:",";border-radius:50%;cursor:ew-resize;}&::-moz-range-thumb{width:8px;height:8px;background:",";border-radius:50%;cursor:ew-resize;}&::-ms-thumb{width:8px;height:8px;background:",";border-radius:50%;cursor:ew-resize;}"],Object(bo.themeGet)("colors.blue"),Object(bo.themeGet)("colors.blue"),Object(bo.themeGet)("colors.blue")),ko=Object(Vn.e)(Wn.C).withConfig({displayName:"PanelListItem___StyledFlex"})(["pointer-events:",";"],(function(t){return t._css})),So=function(t,e){var i=t.children,n=t.showBorderBottom,o=void 0===n||n,a=t.showBorderTop,s=void 0===a||a,r=(t.color,t.small),l=t.isRange,c=t.value,d=t.max,h=t.min,u=t.onChange,p=t.disabled,g=yo(t,["children","showBorderBottom","showBorderTop","color","small","isRange","value","max","min","onChange","disabled"]);return Un.a.createElement(ko,_o({ref:e,borderBottom:"1px solid ".concat(o?"rgba(184, 184, 184, 0.24)":"transparent"),borderTop:"1px solid ".concat(s?"rgba(184, 184, 184, 0.24)":"transparent"),height:r?"40px":"auto",pb:r?void 0:16,mb:r?void 0:9,alignItems:"center",position:"relative",opacity:p?.4:1},g,{_css:p?"none":"initial"}),Un.a.createElement(Wn.m,{width:"100%"},i),l&&Un.a.createElement(Wn.m,{position:"absolute",bottom:"0",left:"0",width:"100%",mb:"-4px",height:"8px",zIndex:10},Un.a.createElement(wo,{value:c,max:d,min:h,onChange:u?function(t){u(parseInt(t.target.value))}:void 0})))},xo=Un.a.forwardRef(So),Co=i("IwqK");function Oo(){return(Oo=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Po(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return jo(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return jo(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jo(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var $o=Object(Vn.e)(Wn.m).withConfig({displayName:"PanelSelect___StyledBox"})(["transform:translateY(-50%);"]),To=Object(Vn.e)(Wn.zb).withConfig({displayName:"PanelSelect___StyledText"})(["",""],(function(t){return t._css})),Io=function(t){var e=t.selected,i=t.label,n=t.onClick,o=t.itemStyle,a=Po(Object(Nn.useState)(!1),2),s=a[0],r=a[1];return Un.a.createElement(Wn.m,{onClick:n,position:"relative",cursor:"pointer",pl:14,mb:"6px",onMouseEnter:function(){return r(!0)},onMouseLeave:function(){return r(!1)}},e&&Un.a.createElement($o,{bg:"black",borderRadius:"50%",width:6,height:6,position:"absolute",left:0,top:"50%"}),Un.a.createElement(To,{textStyle:"small",color:e||s?"black":"gray",_css:o},i))},Eo=Object(Vn.e)(Wn.n).withConfig({displayName:"PanelSelect___StyledButton"})(["line-height:1;"]),Mo=Object(Vn.e)(Wn.zb).withConfig({displayName:"PanelSelect___StyledText2"})(["display:block;",""],(function(t){return t._css2})),Ro=function(t){var e=t.value,i=t.items,n=void 0===i?[]:i,o=t.onSelect,a=t.labelStyle,s=t.itemStyleFn,r=t.rightIcon,l=t.container,c=t.children,d=e&&n.find((function(t){return t.value===e}))||n[0]||{label:"",value:""},h=Po(Object(Nn.useState)(!1),2),u=h[0],p=h[1],g=Po(Object(Nn.useState)(null),2),m=g[0],f=g[1],v=Po(Object(Nn.useState)(null),2),b=v[0],_=v[1],y=Object(Nn.useMemo)((function(){return m?m.getBoundingClientRect():{}}),[m]),w=Object(Co.a)(m,b,{placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,-1*y.height||0]}}]}),k=w.styles,S=w.attributes,x=function(t){m&&(t.target&&m&&m.contains(t.target)||p(!1))};Object(Nn.useEffect)((function(){return u?window.addEventListener("click",x):window.removeEventListener("click",x),function(){window.removeEventListener("click",x)}}),[u]);var C=Un.a.createElement(Wn.m,Oo({ref:_,bg:"white",width:"calc(100% + 16px + 16px)",borderRadius:8,border:"1px solid",borderColor:"#F0F0F0",py:16,px:10,zIndex:102,style:k.popper},S.popper),n.map((function(t,e){return Un.a.createElement(Io,{key:e,selected:d.value===t.value,label:t.label,itemStyle:s?s(t):void 0,onClick:function(){o(t),p(!1)}})}))),O=function(){p(!u)},P=Po(Object(Nn.useState)(!1),2),j=P[0],$=P[1];return Un.a.createElement(Un.a.Fragment,null,c&&"function"==typeof c?c({toggleDropdown:O,ref:f}):Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center",position:"relative",cursor:"pointer",ref:f,onClick:O,onMouseEnter:function(){return $(!0)},onMouseLeave:function(){return $(!1)}},Un.a.createElement(Eo,{display:"block",onClick:O,variant:"clean"},Un.a.createElement(Mo,{textStyle:"small",_css2:a||""},d.label)),Un.a.createElement(Wn.m,null,r||Un.a.createElement(Wn.n,{onClick:O,variant:"clean"},Un.a.createElement(Wn.Db,{color:j?"black":"gray"})))),u?l?co.a.createPortal(Un.a.createElement(Wn.m,{ref:f},C),l):C:null)},Ao=i("zjto"),Do=i("9Juw"),zo=i("A9VP"),Lo=i("ICos"),Bo=i("LDvm");function Fo(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function No(t){return function(t){if(Array.isArray(t))return Go(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Wo(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uo(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Ho(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){Uo(a,n,o,s,r,"next",t)}function r(t){Uo(a,n,o,s,r,"throw",t)}s(void 0)}))}}function Vo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Wo(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wo(t,e){if(t){if("string"==typeof t)return Go(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Go(t,e):void 0}}function Go(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var qo=function(t){var e=t.hex,i=t.borderColor,n=void 0===i?"white":i;return(Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"center"},Un.a.createElement(Wn.m,{width:24,height:24,borderRadius:"50%",border:"1px solid",borderColor:n,bg:e})))},Ko={h:180,s:0,v:0,a:1},Xo=function(t){var e=t.reduce((function(t,e,i){return null!==t||e?t:i}),null);return null!==e?e:t.length},Yo=function(t){var e=t.projectNumId,i=t.userId,n=t.onChangeComplete,o=t.color,a=t.setColor,s=Vo(Object(Nn.useState)({favourites:[],regular:[]}),2),r=s[0],l=s[1],c=Vo(Object(Nn.useState)({favourites:[],regular:[]}),2),d=c[0],h=c[1];return Object(Nn.useEffect)((function(){Object(Bo.i)(e).then((function(t){var e=t.data;l(e)})),Object(Bo.f)(i).then((function(t){var e=t.data;h(e)}))}),[e,i]),Un.a.createElement(Wn.s,{width:170,onChange:a,color:o,projectSwatches:r,globalSwatches:d,onChangeComplete:n,onSwatchAdd:function(){var t=Ho(regeneratorRuntime.mark((function t(n,o){var a,s,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n!==Wn.vb.project){t.next=8;break}return t.next=3,Object(Bo.I)({projectNumId:e,color:o,index:Xo(r.regular),type:Wn.ub.regular});case 3:a=t.sent,s=a.data,l(s),t.next=13;break;case 8:return t.next=10,Object(Bo.G)({userId:i,color:o,index:Xo(d.regular),type:Wn.ub.regular});case 10:c=t.sent,u=c.data,h(u);case 13:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),onSwatchRemove:function(){var t=Ho(regeneratorRuntime.mark((function t(n,o){var a,s,c,u,p,g,m,f,v;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n===Wn.vb.project?r:d,s=n===Wn.vb.project?l:h,c=n===Wn.vb.project?Bo.I:Bo.G,u=a.regular.findIndex((function(t){return t&&t.toLowerCase()===o.toLowerCase()})),p=a.favourites.findIndex((function(t){return t&&t.toLowerCase()===o.toLowerCase()})),!(u>-1)){t.next=13;break}return t.next=8,c({color:void 0,index:u,type:Wn.ub.regular,projectNumId:e,userId:i});case 8:g=t.sent,m=g.data,s(m),t.next=19;break;case 13:if(!(p>-1)){t.next=19;break}return t.next=16,c({color:void 0,index:p,type:Wn.ub.favourites,projectNumId:e,userId:i});case 16:f=t.sent,v=f.data,s(v);case 19:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),onMoveColors:function(){var t=Ho(regeneratorRuntime.mark((function t(n){var o,a,s,c,u,p,g,m,f,v,b,_,y,w,k;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.tab,s=n.from,c=n.to,u=n.color,p=n.newIndex,g=n.oldIndex,m=a===Wn.vb.project?r:d,f=a===Wn.vb.project?l:h,(v=No(m[s]))[g]=void 0,(b=No(m[c]))[p]=void 0,f((Fo(o={},s,v),Fo(o,c,b),o)),a!==Wn.vb.project){t.next=16;break}return t.next=11,Object(Bo.s)({projectNumId:e,from:s,to:c,color:u,newIndex:p,oldIndex:g});case 11:_=t.sent,y=_.data,l(y),t.next=21;break;case 16:return t.next=18,Object(Bo.r)({userId:i,from:s,to:c,color:u,newIndex:p,oldIndex:g});case 18:w=t.sent,k=w.data,h(k);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()})},Zo=i("a68n");function Jo(t){return function(t){if(Array.isArray(t))return ea(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||ta(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||ta(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ta(t,e){if(t){if("string"==typeof t)return ea(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ea(t,e):void 0}}function ea(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ia,na=function(){var t=Object(Nn.useContext)(Hn.BackboneContext).model,e=Object(Nn.useContext)(Fn.a).model,i=Qo(Object(Ao.useTextStylesStore)(),1)[0],n=Object(Nn.useMemo)((function(){return e.project.get("num_id")}),[e]),o=Object(Nn.useMemo)((function(){return e.user.get("_id")}),[e]),a=Qo(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(t._id)}),[t._id])(),2),s=a[0],r=a[1],l=Object(Nn.useMemo)((function(){return Object(Do.k)(s)}),[s]),c=Qo(Object(Nn.useState)(Ko),2),d=c[0],h=c[1],u=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:s})}),[s]),p=Object(Nn.useMemo)((function(){return[].concat(Jo(i.global),Jo(i.project)).find((function(t){return t.name===u}))}),[u,i]);Object(Nn.useEffect)((function(){var t=l.filter((function(t){return!!t&&t.startsWith(zo.b.Color)})).first();if(t){var e=t.replace("".concat(zo.b.Color).concat(zo.a),"");h(Object(Lo.d)(e))}else p&&p.cssProperties.color?h(Object(Lo.d)(p.cssProperties.color)):h(Ko)}),[l,p]);var g=Object(Nn.useMemo)((function(){return Object(Lo.f)(d)}),[d]);return(Un.a.createElement(ro,{control:function(t){var i=t.ref;return(Un.a.createElement(Yn,{ref:i,label:"Color",onClick:function(t){t.preventDefault(),e.disabled||e.select()}},Un.a.createElement(qo,{hex:"#"+g})))},panel:function(t){var i=t.ref,a=t.style;return e.selected?Un.a.createElement(vo,{ref:i,style:a,width:"auto",bg:"transparent",border:"none"},Un.a.createElement(Yo,{projectNumId:n,userId:o,color:d,setColor:h,onChangeComplete:function(t){var e=Object(zo.c)({key:zo.b.Color,value:Object(Lo.g)(t),editorState:s});r(e)}})):null}}))},oa=Fn.b.extend({name:"text_color_new",component:na}),aa=i("IrH7"),sa=i("8Tds");function ra(t){return function(t){if(Array.isArray(t))return da(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||ca(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function la(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||ca(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ca(t,e){if(t){if("string"==typeof t)return da(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?da(t,e):void 0}}function da(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function ha(){return(ha=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function ua(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}!function(t){t.top="top",t.left="left",t.center="center",t.right="right",t.justify="justify",t.fullJustify="full-justify",t.bottom="bottom"}(ia||(ia={}));var pa=function(t){var e=t.icon,i=t.isHovered,n=t.isActive,o=ua(t,["icon","isHovered","isActive"]),a=e===ia.top?Wn.h:e===ia.bottom?Wn.j:e===ia.left?Wn.e:e===ia.center?Wn.b:e===ia.right?Wn.f:e===ia.justify?Wn.d:Wn.c;return Un.a.createElement(Wn.m,ha({as:"button",border:"none",bg:"transparent",cursor:"pointer"},o),Un.a.createElement(a,{color:i||n?"blue":"darkGray"}))},ga=function(t,e){var i=t.style,n=Object(Nn.useContext)(Hn.BackboneContext),o=n.model,a=n.modelSet,s=la(Object(Ao.useTextStylesStore)(),1)[0],r=la(Object(Nn.useState)(null),2),l=r[0],c=r[1],d=la(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(o._id)}),[o._id])(),2),h=d[0],u=d[1],p=Object(Nn.useMemo)((function(){var t=Object(aa.c)({editorState:h});if(t)return t;var e=Object(Zo.b)({editorState:h});if(e){var i=[].concat(ra(s.global),ra(s.project)).find((function(t){return t.name===e}));if(i&&i.cssProperties.textAlign)return"align-".concat(i.cssProperties.textAlign)}}),[h,s]),g=o.verticalAlign,m=o.textDirection||sa.c.LTR,f=o.columns&&o.columns.count>1,v=o.overflow||sa.b.Visible;return Un.a.createElement(vo,{ref:e,style:i},Un.a.createElement(Wn.m,{p:"12px 9px"},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"center",mb:18},Un.a.createElement(pa,{icon:ia.top,isHovered:l===ia.top,isActive:!g||g===sa.f.top,onMouseEnter:function(){return c(ia.top)},onMouseLeave:function(){return c(null)},onClick:function(){a({verticalAlign:sa.f.top})}})),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between",mb:18},Un.a.createElement(pa,{icon:ia.left,isHovered:l===ia.left,isActive:p===aa.a.AlignLeft||!p,onMouseEnter:function(){return c(ia.left)},onMouseLeave:function(){return c(null)},onClick:function(){var t=Object(aa.d)({editorState:h,align:aa.a.AlignLeft});u(t)}}),Un.a.createElement(pa,{icon:ia.center,isHovered:l===ia.center,isActive:p===aa.a.AlignCenter,onMouseEnter:function(){return c(ia.center)},onMouseLeave:function(){return c(null)},onClick:function(){var t=Object(aa.d)({editorState:h,align:aa.a.AlignCenter});u(t)}}),Un.a.createElement(pa,{icon:ia.right,isHovered:l===ia.right,isActive:p===aa.a.AlignRight,onMouseEnter:function(){return c(ia.right)},onMouseLeave:function(){return c(null)},onClick:function(){var t=Object(aa.d)({editorState:h,align:aa.a.AlignRight});u(t)}}),Un.a.createElement(pa,{icon:ia.justify,isHovered:l===ia.justify,isActive:p===aa.a.AlignJustify,onMouseEnter:function(){return c(ia.justify)},onMouseLeave:function(){return c(null)},onClick:function(){var t=Object(aa.d)({editorState:h,align:aa.a.AlignJustify});u(t)}}),Un.a.createElement(pa,{icon:ia.fullJustify,isHovered:l===ia.fullJustify,isActive:p===aa.a.AlignFullJustify,onMouseEnter:function(){return c(ia.fullJustify)},onMouseLeave:function(){return c(null)},onClick:function(){var t=Object(aa.d)({editorState:h,align:aa.a.AlignFullJustify});u(t)}})),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"center"},Un.a.createElement(pa,{icon:ia.bottom,isHovered:l===ia.bottom,isActive:g===sa.f.bottom,onMouseEnter:function(){return c(ia.bottom)},onMouseLeave:function(){return c(null)},onClick:function(){a({verticalAlign:sa.f.bottom})}}))),Un.a.createElement(Wn.m,{px:16},Un.a.createElement(xo,{showBorderBottom:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Overflow"),Un.a.createElement(Wn.n,{onClick:function(){a({overflow:v===sa.b.Visible?sa.b.Hidden:sa.b.Visible})},disabled:f},Un.a.createElement(Wn.zb,{color:"blue",textStyle:"small"},f?sa.b.Hidden:v)))),Un.a.createElement(xo,{showBorderBottom:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Writing"),Un.a.createElement(Wn.n,{onClick:function(){a({textDirection:m===sa.c.LTR?sa.c.RTL:sa.c.LTR})}},Un.a.createElement(Wn.zb,{color:"blue",textStyle:"small"},m))))))},ma=Un.a.forwardRef(ga);function fa(t){return function(t){if(Array.isArray(t))return _a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||ba(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function va(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||ba(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ba(t,e){if(t){if("string"==typeof t)return _a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_a(t,e):void 0}}function _a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ya=function(){var t=Object(Nn.useContext)(Hn.BackboneContext).model,e=Object(Nn.useContext)(Fn.a).model,i=va(Object(Ao.useTextStylesStore)(),1)[0],n=va(Object(Nn.useState)(!1),2),o=n[0],a=n[1],s=va(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(t._id)}),[t._id])(),1)[0],r=Object(Nn.useMemo)((function(){var t=Object(aa.c)({editorState:s});if(t)return t;var e=Object(Zo.b)({editorState:s});if(e){var n=[].concat(fa(i.global),fa(i.project)).find((function(t){return t.name===e}));if(n&&n.cssProperties.textAlign)return"align-".concat(n.cssProperties.textAlign)}}),[s,i]),l=Object(Nn.useMemo)((function(){switch(r){case aa.a.AlignCenter:return Wn.b;case aa.a.AlignRight:return Wn.f;case aa.a.AlignJustify:return Wn.d;case aa.a.AlignFullJustify:return Wn.c;default:return Wn.e}}),[r]);return Un.a.createElement(ro,{control:function(t){var i=t.ref;return(Un.a.createElement(Yn,{ref:i,label:"Align",onMouseEnter:function(){a(!0)},onMouseLeave:function(){a(!1)},onClick:function(t){t.preventDefault(),e.disabled||e.select()}},Un.a.createElement(l,{color:o?"blue":"white"})))},panel:function(t){var i=t.ref,n=t.style;return e.selected?Un.a.createElement(ma,{ref:i,style:n}):null}})},wa=Fn.b.extend({name:"text_align_new",component:ya}),ka=i("zMlX"),Sa=i("NbUU"),xa=i("HjzJ"),Ca=i("w5C2");function Oa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Pa(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Pa(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pa(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function ja(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var $a={config:{duration:200},from:{opacity:0,transform:"translateY(-20px)"},enter:{opacity:1,transform:"translateY(-26px)"},leave:{opacity:0,transform:"translateY(-20px)"}},Ta=function(t){var e=t.title,i=t.projectNumId,n=t.userId,o=t.color,a=t.setColor,s=t.onChangeComplete,r=ja(t,["title","projectNumId","userId","color","setColor","onChangeComplete"]),l=Oa(Object(Nn.useState)(!1),2),c=l[0],d=l[1],h=Object(Gn.d)(c,null,$a),u=Object(Nn.useRef)(null),p=Oa(Object(Nn.useState)(""),2),g=p[0],m=p[1],f=function(t){c&&(t.target&&u.current&&u.current.contains(t.target)||d(!1))};return Object(Nn.useEffect)((function(){return c?window.addEventListener("click",f):window.removeEventListener("click",f),function(){window.removeEventListener("click",f)}}),[c]),Object(Nn.useEffect)((function(){if(o){var t=Object(Lo.f)(o);t!==g&&m(t)}}),[o]),Un.a.createElement(xo,r,Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},e)),Un.a.createElement(Wn.m,{position:"relative"},Un.a.createElement(Wn.n,{onClick:function(){return d(!c)}},Un.a.createElement(qo,{hex:g?"#"+g:"#F4F4F4",borderColor:"#DCDCDC"})),h.map((function(t){var e=t.item,r=t.key,l=t.props;return e&&Un.a.createElement(Gn.a.div,{key:r,style:l},Un.a.createElement(Wn.m,{position:"absolute",bottom:"100%",right:"0",mr:"-17px",ref:u},Un.a.createElement(Yo,{projectNumId:i,userId:n,color:o||Ko,setColor:a,onChangeComplete:function(t){t&&(m(Object(Lo.f)(t)),s(t))}})))})))))};function Ia(t){return function(t){if(Array.isArray(t))return Ra(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Ma(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ea(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Ma(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ma(t,e){if(t){if("string"==typeof t)return Ra(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ra(t,e):void 0}}function Ra(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Aa=Object(Vn.e)(Wn.hb).withConfig({displayName:"TextAdvancedTypography___StyledRoundButton"})(["&:hover g{fill:#fff;}"]),Da=Object(Vn.e)(Wn.hb).withConfig({displayName:"TextAdvancedTypography___StyledRoundButton2"})(["&:hover g{fill:#fff;}"]),za=Object(Vn.e)(Wn.hb).withConfig({displayName:"TextAdvancedTypography___StyledRoundButton3"})(["&:hover g{fill:#fff;}"]),La=function(t,e){var i=t.style,n=t.onHeightChanged,o=Object(Nn.useContext)(Hn.BackboneContext),a=o.model,s=o.modelSet,r=Object(Nn.useContext)(Fn.a).model,l=Object(Nn.useMemo)((function(){return r.project.get("num_id")}),[r]),c=Object(Nn.useMemo)((function(){return r.user.get("_id")}),[r]),d=Ea(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(a._id)}),[a._id])(),2),h=d[0],u=d[1],p=Ea(Object(Nn.useState)([]),2),g=p[0],m=p[1],f=Ea(Object(Nn.useState)([]),2),v=f[0],b=f[1],_=Ea(Object(Nn.useState)([]),2),y=_[0],w=_[1],k=Ea(Object(Nn.useState)(!1),2),S=k[0],x=k[1],C=Object(Nn.useMemo)((function(){return Object(zo.d)(h,zo.b.FontFamily)}),[h]),O=Ea(Object(Nn.useState)(Ca.b.fontFamily),2),P=O[0],j=O[1];Object(Nn.useEffect)((function(){var t=C[0];t&&t!==P?j(t):t||Ca.b.fontFamily===P||j(Ca.b.fontFamily)}),[C]);var $=Object(Nn.useMemo)((function(){return Object(zo.d)(h,zo.b.FontStyle)}),[h]),T=Ea(Object(Nn.useState)(Ca.b.fontStyle),2),I=T[0],E=T[1];Object(Nn.useEffect)((function(){var t=$[0];t&&t!==I?E(t):t||Ca.b.fontStyle===I||E(Ca.b.fontStyle)}),[$]);var M=Object(Nn.useMemo)((function(){return Object(zo.d)(h,zo.b.FontWeight)}),[h]),R=Ea(Object(Nn.useState)(Ca.b.fontWeight),2),A=R[0],D=R[1];Object(Nn.useEffect)((function(){var t=parseInt(M[0]);t&&t!==A?D(t):t||Ca.b.fontWeight===A||D(Ca.b.fontWeight)}),[M]);var z=function(t){var e=Object(Sa.d)(t);m(e);var i=Object(Sa.f)(t);b(i);var n=Object(Sa.e)(t);w(n);var o=t.includes(ka.a.Fractions);x(o)};Object(Nn.useEffect)((function(){Object(Sa.a)({fontFamily:P,fontWeight:A,fontStyle:I}).then((function(t){var e=t.features;z(e&&e.length?e:[])}))}),[P,A,I]);var L=Object(Nn.useMemo)((function(){return Object(zo.d)(h,zo.b.FontFeature)}),[h]),B=Object(Nn.useMemo)((function(){return Object(zo.d)(h,zo.b.Stroke)}),[h]),F=!(!B||!B.length),N=Object(Nn.useMemo)((function(){return Object(Do.j)(h)}),[h]),U=Object(Nn.useMemo)((function(){return Object(xa.c)(N)}),[N]);Object(Nn.useEffect)((function(){n()}),[U,F]);var H=Object(Nn.useMemo)((function(){return v.find((function(t){return L.includes(t)}))}),[v,L]),V=Object(Nn.useMemo)((function(){return y.find((function(t){return L.includes(t)}))}),[y,L]),W=Object(Nn.useMemo)((function(){return a.bgColor}),[a.bgColor]),G=Ea(Object(Nn.useState)(W?Object(Lo.d)(W):null),2),q=G[0],K=G[1];Object(Nn.useEffect)((function(){if(a.bgColor){var t=Object(Lo.d)(a.bgColor);!q||t.h===q.h&&t.s===q.s&&t.v===q.v||K(t)}else K(Object(Lo.d)("#ffffff64"))}),[W]);var X=Ea(Object(Nn.useState)(1),2),Y=X[0],Z=X[1],J=Ea(Object(Nn.useState)(F&&B[1]?Object(Lo.d)(B[1]):Ko),2),Q=J[0],tt=J[1],et=Ea(Object(Nn.useState)(""),2),it=et[0],nt=et[1];Object(Nn.useEffect)((function(){if(B&&B.length){var t=Ea(B,2),e=t[0],i=t[1];Number(e)!==Y&&Z(Number(e));var n=Object(Lo.c)(i);n!==it&&(tt(Object(Lo.d)(i)),nt(n))}}),[B,F]);var ot=Ea(Object(Ao.useTextStylesStore)(),1)[0],at=[].concat(Ia(ot.global),Ia(ot.project)),st=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:h})}),[h]),rt=Object(Nn.useMemo)((function(){return at.find((function(t){return t.name===st}))}),[st]),lt=Object(zo.d)(h,zo.b.Decoration),ct=Object(zo.d)(h,zo.b.Transform),dt=Object(zo.d)(h,zo.b.Features),ht=Object(zo.d)(h,zo.b.FontKerning),ut=dt&&"superscript"===dt[0],pt=dt&&"subscript"===dt[0],gt=ht&&"autokerning"===ht[0],mt=lt&&"overline"===lt[0],ft=!!rt&&"uppercase"===rt.cssProperties.textTransform,vt=ct&&ct[0]?"uppercase"===ct[0]:ft,bt=ct&&"lowercase"===ct[0],_t=ct&&"capitalize"===ct[0],yt=!!rt&&"underline"===rt.cssProperties.textDecoration,wt=lt&&lt[0]?"underline"===lt[0]:yt,kt=!!rt&&"line-through"===rt.cssProperties.textDecoration,St=lt&&lt[0]?"line-through"===lt[0]:kt,xt=Object(zo.d)(h,zo.b.FontWeight),Ct=!!rt&&700===rt.cssProperties.fontWeight,Ot=xt&&xt[0]?"700"===xt[0]:Ct,Pt=Object(zo.d)(h,zo.b.FontStyle),jt=!!rt&&"italic"===rt.cssProperties.fontStyle,$t=Pt&&Pt[0]?"italic"===Pt[0]:jt;return Un.a.createElement(vo,{ref:e,style:i,px:16,py:10},Un.a.createElement(xo,{showBorderTop:!1},Un.a.createElement(Wn.m,{mb:"8px"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Transform")),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between",mb:"8px"},Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Uppercase"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:vt?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Transform,value:vt?"none":"uppercase"});u(t)}},Un.a.createElement(Wn.Kb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Capitalize"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:_t?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Transform,value:_t?"none":"capitalize"});u(t)}},Un.a.createElement(Wn.o,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Lowercase"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:bt?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Transform,value:bt?"none":"lowercase"});u(t)}},Un.a.createElement(Wn.S,{color:"white"}))))),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Bold"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:Ot?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.FontWeight,value:Ot?Ca.b.fontWeight:"700"});u(t)}},Un.a.createElement(Wn.l,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Italic"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:$t?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.FontStyle,value:$t?Ca.b.fontStyle:"italic"});u(t)}},Un.a.createElement(Wn.K,{color:"white"})))),Un.a.createElement(Wn.m,{width:40}))),Un.a.createElement(xo,{showBorderTop:!1},Un.a.createElement(Wn.m,{mb:"8px"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Decoration")),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Underline"},Un.a.createElement(Aa,{hoverColor:"black",size:40,color:wt?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Decoration,value:wt?"none":"underline"});u(t)}},Un.a.createElement(Wn.Jb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Strikethrough"},Un.a.createElement(Da,{hoverColor:"black",size:40,color:St?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Decoration,value:St?"none":"line-through"});u(t)}},Un.a.createElement(Wn.pb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Overline"},Un.a.createElement(za,{hoverColor:"black",size:40,color:mt?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Decoration,value:mt?"none":"overline"});u(t)}},Un.a.createElement(Wn.Z,{color:"white"})))))),Un.a.createElement(xo,{showBorderTop:!1,mb:"0px"},Un.a.createElement(Wn.m,{mb:"8px"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Features")),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between",mb:"8px"},Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Superscript"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:ut?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Features,value:ut?"none":"superscript"});u(t)}},Un.a.createElement(Wn.tb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Subscript"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:pt?"black":"gray",onClick:function(){var t=Object(zo.c)({editorState:h,key:zo.b.Features,value:pt?"none":"subscript"});u(t)}},Un.a.createElement(Wn.sb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Fractions"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,disabled:!S,color:L.includes(ka.a.Fractions)?"black":"gray",onClick:function(){var t=Ia(L),e=t.indexOf(ka.a.Fractions);e>-1?t.splice(e,1):t.push(ka.a.Fractions),u(Object(zo.c)({key:zo.b.FontFeature,value:t,editorState:h}))}},Un.a.createElement(Wn.F,{color:"white"}))))),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Small caps"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,color:L.includes(ka.a.Smallcaps)?"black":"gray",onClick:function(){var t=Ia(L),e=t.indexOf(ka.a.Smallcaps);e>-1?t.splice(e,1):t.push(ka.a.Smallcaps),u(Object(zo.c)({key:zo.b.FontFeature,value:t,editorState:h}))}},Un.a.createElement(Wn.mb,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Ligatures"},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,disabled:!g||!g.length,color:L.includes(ka.a.StandardLigatures)?"black":"gray",onClick:function(){var t=Ia(L),e=t.indexOf(ka.a.StandardLigatures);e>-1?t.splice(e,1):t.push(ka.a.StandardLigatures),u(Object(zo.c)({key:zo.b.FontFeature,value:t,editorState:h}))}},Un.a.createElement(Wn.L,{color:"white"})))),Un.a.createElement(Wn.m,{width:40},Un.a.createElement(Wn.Cb,{text:"Stylistic set".concat(H?" ".concat(H.replace(/\D/g,"")):"")},Un.a.createElement(Wn.hb,{hoverColor:"black",size:40,disabled:!v||!v.length,color:H?"black":"gray",onClick:function(){var t=Ia(L),e=H?t.indexOf(H):null;if(null!==e&&e>-1&&t.splice(e,1),H){var i=v.indexOf(H);if(i>-1){var n=v[i+1];n&&t.push(n)}}else t.push(v[0]);u(Object(zo.c)({key:zo.b.FontFeature,value:t,editorState:h}))}},Un.a.createElement(Wn.Lb,{color:"white"})))))),y&&y.length?Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Ro,{items:[{label:"Default figure",value:"default"}].concat(Ia(y.map((function(t){return{label:ka.b[t],value:t}})))),value:V||"default",onSelect:function(t){var e=Ia(L),i=V?e.indexOf(V):null;null!==i&&i>-1&&e.splice(i,1),"default"!==t.value&&e.push(t.value),u(Object(zo.c)({key:zo.b.FontFeature,value:e,editorState:h}))}})):void 0,Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"List")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.wb,{checked:U,backgroundChecked:"black",onChange:function(){var t=U?N:xa.a.Unordered,e=Object(Do.v)(h,t);u(e)}})))),U&&Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.m,{pl:"8px"},Un.a.createElement(Wn.m,{mr:2,display:"inline-block"},Un.a.createElement(Wn.n,{color:N===xa.a.Unordered?"black":"gray",textStyle:"small",onClick:function(){var t=Object(Do.v)(h,xa.a.Unordered);u(t)}},"Unordered")),Un.a.createElement(Wn.m,{display:"inline-block"},Un.a.createElement(Wn.n,{color:N===xa.a.Ordered?"black":"gray",textStyle:"small",onClick:function(){var t=Object(Do.v)(h,xa.a.Ordered);u(t)}},"Ordered")))),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Auto kerning")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.wb,{checked:gt,backgroundChecked:"black",onChange:function(){var t=Object(zo.c)({editorState:h,key:zo.b.FontKerning,value:gt?"none":"autokerning"});u(t)}})))),Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!F,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Outline")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.wb,{checked:F,backgroundChecked:"black",onChange:function(){Q&&u(Object(zo.c)({key:zo.b.Stroke,value:F?void 0:"".concat(Y).concat(zo.a).concat(Object(Lo.g)(Q)),editorState:h}))}})))),F&&Un.a.createElement(Un.a.Fragment,null,Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Width")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.X,{value:Y,min:1,max:999,positive:!0,textAlign:"right",onChange:function(t){var e=Q||Ko;if(e){var i=Object(Lo.g)(e),n=t;Z(n),u(Object(zo.c)({key:zo.b.Stroke,value:"".concat(n).concat(zo.a).concat(i),editorState:h}))}}})))),Un.a.createElement(Ta,{showBorderTop:!1,small:!0,title:"Color",projectNumId:l,userId:c,color:Q,setColor:tt,onChangeComplete:function(t){var e=Object(Lo.g)(t);u(Object(zo.c)({key:zo.b.Stroke,value:"".concat(Y).concat(zo.a).concat(e),editorState:h}))}})),Un.a.createElement(Ta,{showBorderTop:!1,showBorderBottom:!1,small:!0,title:"Box Color",projectNumId:l,userId:c,color:q,setColor:K,onChangeComplete:function(t){s({bgColor:Object(Lo.g)(t)})}}))},Ba=Un.a.forwardRef(La);function Fa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Na(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Na(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Na(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Ua=function(){var t=Fa(Object(Nn.useState)(!1),2),e=t[0],i=t[1],n=Object(Nn.useContext)(Fn.a).model;return Un.a.createElement(ro,{control:function(t){var o=t.ref;return(Un.a.createElement(Yn,{ref:o,label:"Advanced Typography",onMouseEnter:function(){i(!0)},onMouseLeave:function(){i(!1)},onClick:function(t){t.preventDefault(),n.disabled||n.select()}},Un.a.createElement(Wn.kb,{color:e?"blue":"white"})))},panel:function(t){var e=t.ref,i=t.style,o=t.update;return n.selected?Un.a.createElement(Ba,{ref:e,style:i,onHeightChanged:o}):null}})},Ha=Fn.b.extend({name:"text_advanced_typography",component:Ua});function Va(t){return function(t){if(Array.isArray(t))return qa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Ga(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Ga(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ga(t,e){if(t){if("string"==typeof t)return qa(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?qa(t,e):void 0}}function qa(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Ka=Object(Nn.createContext)({}),Xa=function(t,e){var i=t.initialScreen,n=t.children,o=t.childRef,a=t.onNavigate,s=t.onStackUpdated,r=Wa(Object(Nn.useState)([i]),2),l=r[0],c=r[1],d=l[l.length-1],h=l[l.length-2];Object(Nn.useEffect)((function(){s&&s(l)}),[l]);var u=function(t){c([].concat(Va(l),[t])),a&&a({prev:d,next:t})},p=function(){if(l.length){var t=Va(l);t.pop(),c(t),a&&a({prev:d,next:t[t.length-1]})}},g=function(){c([i]),a&&a({prev:d,next:i})};Object(Nn.useImperativeHandle)(e,(function(){return{stack:l,prevScreen:h,currentScreen:d,navigate:u,goBack:p,goHome:g}}));var m=(n||[]).find((function(t){return t.key===d}));return(Un.a.createElement(Ka.Provider,{value:{stack:l,prevScreen:h,currentScreen:d,navigate:u,goBack:p,goHome:g}},m?Un.a.cloneElement(m,{ref:o}):null))},Ya=Object(Nn.forwardRef)(Xa),Za=function(t){var e=Wa(Object(Nn.useState)([]),2),i=e[0],n=e[1];return{onStackUpdated:function(t){n(t)},canControlBeClosed:function(){return!!(t&&i&&i.length>1)&&(t.goBack(),!0)}}},Ja=i("nnuN");function Qa(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function ts(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Qa(Object(i),!0).forEach((function(e){es(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Qa(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function es(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function is(t){return function(t){if(Array.isArray(t))return as(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||os(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ns(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||os(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function os(t,e){if(t){if("string"==typeof t)return as(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?as(t,e):void 0}}function as(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ss=Object(Vn.e)(Wn.n).withConfig({displayName:"FontSelectPanel___StyledButton"})(["line-height:1;text-align:left;white-space:nowrap;overflow:hidden;width:100%;text-overflow:ellipsis;font-family:",",sans-serif;"],(function(t){return t._css})),rs=Object(Vn.e)(Wn.zb).withConfig({displayName:"FontSelectPanel___StyledText"})(["display:block;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"]),ls=function(t){var e=t.onHeightChanged,i=t.textStyle,n=t.onChangeTextStyle,o=Object(Nn.useContext)(Hn.BackboneContext).model,a=ns(Object(Ao.useTextStylesStore)(),1)[0],s=ns(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(o._id)}),[o._id])(),2),r=s[0],l=s[1],c=ns(Object(Nn.useState)(Ca.b),2),d=c[0],h=c[1],u=Object(Nn.useContext)(Ka).navigate,p=ns(Object(Nn.useState)(d.fontWeight),2),g=p[0],m=p[1],f=ns(Object(Nn.useState)(d.fontWeights),2),v=f[0],b=f[1],_=ns(Object(Nn.useState)(d.fontStyle),2),y=_[0],w=_[1],k=ns(Object(Nn.useState)(d.fontFamily),2),S=k[0],x=k[1],C=ns(Object(Nn.useState)(d.fontFamily),2),O=C[0],P=C[1],j=Object(Nn.useMemo)((function(){return i?i.cssProperties.fontVariationSettings&&i.cssProperties.fontVariationSettings.split(", ")||[]:Object(zo.d)(r,zo.b.FontVariable)}),[i||r]),$=ns(Object(Nn.useState)({}),2),T=$[0],I=$[1];Object(Nn.useEffect)((function(){var t={};is(j).forEach((function(e){var n,o;if(i){var a=ns(e.split(" "),2);n=a[0],o=a[1],n=n.replace(/['"]+/g,"")}else{var s=ns(e.split("|"),2);n=s[0],o=s[1]}n&&o&&("number"==typeof T[n]&&T[n]!==Number(o)||"number"!=typeof T[n])&&(t[n]=Number(o))})),Object.keys(t).length>0&&I(ts(ts({},T),t))}),[j]);var E=Object(Nn.useMemo)((function(){return i?[String(i.cssProperties.fontWeight)]:Object(zo.d)(r,zo.b.FontWeight)}),[i||r]);Object(Nn.useEffect)((function(){var t=E[0],e=t?parseInt(t)||t:void 0;e&&e!==g?m(e):t||d.fontWeight===g||m(d.fontWeight)}),[E]);var M=Object(Nn.useMemo)((function(){return i?[i.cssProperties.fontStyle]:Object(zo.d)(r,zo.b.FontStyle)}),[i||r]);Object(Nn.useEffect)((function(){var t=M[0];t&&t!==y?w(t):t||d.fontStyle===y||w(d.fontStyle)}),[M]);var R=Object(Nn.useMemo)((function(){return i?[String(i.cssProperties.fontFamily)]:Object(zo.d)(r,zo.b.FontFamily)}),[i||r]);Object(Nn.useEffect)((function(){var t=R[0];if(t&&t!==S?t:t||S?null:d.fontFamily){x(t);var e=window.RM.constructorRouter.fonts.findFontByCSSName(t);if(P(e?e.name:t),b(e?e.variations:[]),e.variations&&e.variations[0]){var o=e.variations.includes("n4")?"n4":e.variations[0],a=Object(Sa.b)(o),s=a.style,c=a.weight;if(i&&n)s!==y&&n({fontStyle:s}),c!==g&&n({fontWeight:c});else{var h=r;s!==y&&(h=Object(zo.c)({key:zo.b.FontStyle,value:s,editorState:h}),w(s)),c!==g&&(h=Object(zo.c)({key:zo.b.FontWeight,value:c,editorState:h}),m(c)),l(h)}}}}),[R]);var A=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:r})}),[r]);Object(Nn.useEffect)((function(){var t=[].concat(is(a.global),is(a.project)).find((function(t){return t.name===A})),e=ts({},Ca.b);if(t&&t.name!==Ca.a.Unstyled){if(t.cssProperties.fontFamily&&!R.length){e.fontFamily=t.cssProperties.fontFamily,x(t.cssProperties.fontFamily);var i=window.RM.constructorRouter.fonts.findFontByCSSName(t.cssProperties.fontFamily);P(i?i.name:t.cssProperties.fontFamily),b(i?i.variations:[])}if(t.cssProperties.fontWeight&&!E.length){var n="initial"===t.cssProperties.fontWeight?t.cssProperties.fontWeight:Object(Zo.c)(t.cssProperties.fontWeight);e.fontWeight=n,m(n)}if(t.cssProperties.fontStyle&&!M.length){var o=t.cssProperties.fontStyle;e.fontStyle=o,w(o)}}else{var s=ts({},Ca.b);if(h(s),!R.length){x(s.fontFamily);var r=window.RM.constructorRouter.fonts.findFontByCSSName(s.fontFamily);P(r?r.name:s.fontFamily),b(r?r.variations:[])}}}),[A,a,r]);var D=ns(Object(Nn.useState)([]),2),z=D[0],L=D[1];Object(Nn.useEffect)((function(){S&&g&&y&&S!==d.fontFamily&&Object(Sa.a)({fontFamily:S,fontWeight:g,fontStyle:y}).then((function(t){var i=t.variations;if(!R.length||S===R[0]){var n=i&&i.length?i:[];L(n),I(function(t,e){return Object.keys(t).reduce((function(i,n){return e.findIndex((function(t){return t.code===n}))>-1?ts(ts({},i),{},es({},n,t[n])):i}),{})}(T,n)),(n.length||n.length!==z.length)&&e()}})).catch((function(){L([]),e()}))}),[S,g,y]);var B=ns(Object(Nn.useState)(!1),2),F=B[0],N=B[1];return(Un.a.createElement(Un.a.Fragment,null,Un.a.createElement(xo,{showBorderTop:!1,small:!0,onMouseEnter:function(){return N(!0)},onMouseLeave:function(){return N(!1)}},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center",position:"relative",cursor:"pointer",onClick:function(){return u(Mr.FontsList)}},Un.a.createElement(ss,{onClick:function(){return u(Mr.FontsList)},textStyle:"small",display:"block",variant:"clean",_css:S},O||S),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{onClick:function(){return u(Mr.FontsList)},variant:"clean"},Un.a.createElement(Wn.Db,{color:F?"black":"gray"}))))),z.length?Un.a.createElement(Un.a.Fragment,null,z.map((function(t,e){var o=T[t.code]||t.defaultValue,a=function(e){I(ts(ts({},T),{},es({},t.code,e)));var o=i?"'".concat(t.code,"' ").concat(e):[t.code,e].join("|"),a=is(j),s=a.findIndex((function(e){return e.includes(t.code)}));s>-1?a[s]=o:a.push(o),i&&n?n({fontVariationSettings:a.join(", ")}):l(Object(zo.c)({key:zo.b.FontVariable,value:a,editorState:r}))};return Un.a.createElement(xo,{key:e,showBorderTop:!1,small:!0,isRange:!0,min:t.min,max:t.max,value:o,onChange:a},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(rs,{textStyle:"small"},t.name),Un.a.createElement(Wn.I,{textAlign:"right",textStyle:"small",value:o,min:t.min,max:t.max,onChange:function(t){a(Number(t.target.value))},p:0,border:"none !important"})))}))):v&&v.length>1?Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Ro,{items:v.map((function(t){return{value:t,label:Ja.WEIGHTS[t]}})),value:Object(Sa.c)(g,y),labelStyle:"\n              font-family: ".concat(S,", sans-serif;\n              font-weight: ").concat(g,";\n              font-style: ").concat(y,";\n              line-height: 1;\n            "),itemStyleFn:function(t){var e=Object(Sa.b)(t.value),i=e.style,n=e.weight;return"\n                font-family: ".concat(S,", sans-serif;\n                font-weight: ").concat(n,";\n                font-style: ").concat(i,";\n              ")},onSelect:function(t){var e=Object(Sa.b)(t.value),o=e.style,a=e.weight;if(w(o),m(a),i&&n)n({fontWeight:a,fontStyle:o});else{var s=Object(zo.c)({key:zo.b.FontStyle,value:o,editorState:r}),c=Object(zo.c)({key:zo.b.FontWeight,value:a,editorState:s});l(c)}}})):void 0))},cs=i("38uW"),ds=i("w+s/");function hs(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function us(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function ps(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?us(Object(i),!0).forEach((function(e){gs(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):us(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function gs(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ms(t){return function(t){if(Array.isArray(t))return bs(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||vs(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||vs(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vs(t,e){if(t){if("string"==typeof t)return bs(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?bs(t,e):void 0}}function bs(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var _s=Object(Vn.e)(Wn.hb).withConfig({displayName:"TypographyPanel___StyledRoundButton"})(["&:hover g{fill:none;stroke:",";}"],(function(t){return t._css})),ys=function(t){var e=t.isLinked,i=t.onClick,n=fs(Object(Nn.useState)(!1),2),o=n[0],a=n[1];return Un.a.createElement(Wn.m,{display:"inline-block",onMouseEnter:function(){return a(!0)},onMouseLeave:function(){return a(!1)}},Un.a.createElement(_s,{color:e?"blue":"white",hoverColor:e?"blue":"white",activeColor:e?"blue":"white",mr:0,size:32,onClick:i,_css:e&&!o?"none":"white"},e?o?Un.a.createElement(Wn.P,{color:"white"}):Un.a.createElement(Wn.Q,{color:"white"}):o?Un.a.createElement(Wn.Q,{color:"gray"}):Un.a.createElement(Wn.P,{color:"gray"})))},ws=function(t){var e=t.letterSpacing,i=t.fontSize,n=e+e/i*(t.newFontSize-i);return parseFloat((Math.round(100*n)/100).toFixed(2))},ks=Object(Vn.e)(Wn.n).withConfig({displayName:"TypographyPanel___StyledButton"})(["text-overflow:ellipsis;overflow:hidden;white-space:nowrap;text-align:left;line-height:1;"]),Ss=Object(Vn.e)(Wn.k).withConfig({displayName:"TypographyPanel___StyledArrowUndoIcon"})(["position:relative;left:-1px;"]),xs=Object(Vn.e)(Wn.i).withConfig({displayName:"TypographyPanel___StyledArrowRightRoundedIcon"})(["position:relative;top:0px;left:1px;"]),Cs=Object(Vn.e)(Wn.m).withConfig({displayName:"TypographyPanel___StyledBox"})(["user-select:none;"]),Os=function(t,e){var i=t.style,n=t.onHeightChanged,o=Object(Nn.useContext)(qr).selectedFont,a=Object(Nn.useContext)(Hn.BackboneContext).model,s=fs(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(a._id)}),[a._id])(),2),r=s[0],l=s[1],c=fs(Object(Ao.useTextStylesStore)(),2),d=c[0],h=c[1],u=fs(Object(Nn.useState)(Ca.b),2),p=u[0],g=u[1],m=Object(Nn.useContext)(Fn.a).model,f=Object(Nn.useMemo)((function(){return m.project.get("_id")}),[m]),v=Object(Nn.useMemo)((function(){return m.user.get("_id")}),[m]),b=fs(Object(Nn.useState)(!1),2),_=b[0],y=b[1],w=fs(Object(Nn.useState)(p.fontSize),2),k=w[0],S=w[1],x=fs(Object(Nn.useState)(p.lineHeight),2),C=x[0],O=x[1],P=fs(Object(Nn.useState)(p.lineHeight/p.fontSize),2),j=P[0],$=P[1],T=fs(Object(Nn.useState)(!1),2),I=T[0],E=T[1],M=fs(Object(Nn.useState)(0),2),R=M[0],A=M[1],D=Object(Nn.useContext)(Ka).navigate,z=Object(Nn.useMemo)((function(){return Object(Do.i)(r)}),[r]);Object(Nn.useEffect)((function(){o&&l(Object(zo.c)({editorState:r,key:zo.b.FontFamily,value:o.css_name}))}),[o]);var L=Object(Nn.useMemo)((function(){return Object(zo.d)(r,zo.b.FontSize)}),[r]);Object(Nn.useEffect)((function(){var t=L[0];t&&parseInt(t)!==k?(I&&A(ws({letterSpacing:R,fontSize:k,newFontSize:parseInt(t)})),S(parseInt(t))):t||p.fontSize===k||S(p.fontSize)}),[L]);var B=Object(Nn.useMemo)((function(){return Object(cs.a)({block:z})}),[z]);Object(Nn.useEffect)((function(){var t=B;"number"==typeof t&&t!==C?O(t):t||p.lineHeight===C||O(p.lineHeight)}),[B]);var F=Object(Nn.useMemo)((function(){return Object(zo.d)(r,zo.b.LetterSpacing)}),[r]);Object(Nn.useEffect)((function(){var t=F[0];t&&parseFloat(t)!==R?A(parseFloat(t)):t||0===R||A(0)}),[F]);var N=Object(Nn.useMemo)((function(){return Object(zo.d)(r,zo.b.IsLinkedFontSize)}),[r]);Object(Nn.useEffect)((function(){var t=N[0];if(t){var e="true"===t;e!==_&&y(e)}else _&&y(!1)}),[N]);var U=Object(Nn.useMemo)((function(){return Object(zo.d)(r,zo.b.IsLinkedLetterSpacing)}),[r]);Object(Nn.useEffect)((function(){var t=U[0];if(t){var e="true"===t;e!==I&&E(e)}else I&&E(!1)}),[U]);var H=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:r})}),[r]),V=fs(Object(Nn.useState)(),2),W=V[0],G=V[1];Object(Nn.useEffect)((function(){var t=[].concat(ms(d.global),ms(d.project)).find((function(t){return t.name===H})),e=ps({},Ca.b);if(t&&t.name!==Ca.a.Unstyled){if(t.cssProperties.fontSize&&!L.length){var i=Object(Zo.c)(t.cssProperties.fontSize);e.fontSize=i,S(i)}if(t.cssProperties.lineHeight&&"number"!=typeof B){var n=Object(Zo.c)(t.cssProperties.lineHeight);e.lineHeight=n,O(n)}t.cssProperties.letterSpacing&&!F.length&&A(Object(Zo.c)(t.cssProperties.letterSpacing,!0)),G(t),g(e)}else{var o=ps({},Ca.b);G(void 0),g(o),L.length||S(o.fontSize),"number"!=typeof B&&O(o.lineHeight),F.length||A(0)}}),[H,d,r]);var q=Object(Nn.useMemo)((function(){var t=Object(Do.m)(r);return W?{hasOneEditedStyle:Boolean(t&&Object.keys(t).length),hasMultipleEditedStyles:Object(Do.d)(r)}:{hasOneEditedStyle:!1,hasMultipleEditedStyles:!1}}),[r,W,d.global,d.project]),K=q.hasOneEditedStyle,X=q.hasMultipleEditedStyles,Y=Object(Nn.useMemo)((function(){var t=Object(Do.l)(r),e=r.getCurrentContent(),i=t.map((function(t){var i=e.getBlockForKey(t);return Object(Zo.b)({editorState:r,block:i})}));return{isMultipleBlockSelected:i.length>1,hasDifferentStyles:i.some((function(t){return t!==i[0]}))}}),[W,r]),Z=Y.isMultipleBlockSelected,J=Y.hasDifferentStyles,Q=function(t){return d.global.includes(t)?sa.d.global:sa.d.project},tt=function(){var t=function(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){hs(a,n,o,s,r,"next",t)}function r(t){hs(a,n,o,s,r,"throw",t)}s(void 0)}))}}(regeneratorRuntime.mark((function t(e){var i,n,o,a,s,c,u,p,g;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Q(e),n=ms(d[i]),o=Object(Do.m)(r),a=Object.keys(o).reduce((function(t,e){return ps(ps({},t),{},gs({},e,Object(Zo.g)(e,o[e])))}),{}),1===(s=Object(Do.l)(r)).length&&s[0]&&(c=r.getCurrentContent().getBlockForKey(s[0]),(u=Object(ds.a)({block:c}))&&(a.paddingTop=u.top,a.paddingLeft=u.left,a.paddingRight=u.right,a.paddingBottom=u.bottom)),(p=n.findIndex((function(t){return t.name===e.name})))>-1&&(n[p]=ps(ps({},n[p]),{},{cssProperties:ps(ps({},n[p].cssProperties),a||{})})),t.next=10,h(ps(ps({},d),{},gs({},i,n)));case 10:if(i!==sa.d.global){t.next=15;break}return t.next=13,Object(Bo.L)({userId:v,styles:n});case 13:t.next=17;break;case 15:return t.next=17,Object(Bo.J)({projectId:f,styles:n});case 17:g=Object(Do.b)({editorState:r}),l(Object(Do.g)(g,r.getSelection()));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),et=(K||X)&&!(Z&&J),it=fs(Object(Nn.useState)(!1),2),nt=it[0],ot=it[1];return Un.a.createElement(vo,{ref:e,style:i,px:16,pb:10},Un.a.createElement(xo,{showBorderTop:!1,small:!0,onMouseEnter:function(){return ot(!0)},onMouseLeave:function(){return ot(!1)}},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center",position:"relative",zIndex:1,cursor:"pointer"},Un.a.createElement(ks,{display:"block",onClick:function(){return D(Mr.TextStylesList)},variant:"clean",width:"100%"},Un.a.createElement(Wn.zb,{textStyle:"small",color:et?"tomato":"black"},W?Z&&J?"...":W.label:"No style")),Un.a.createElement(Wn.m,null,et?Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"flex-end"},Un.a.createElement(Wn.Cb,{text:"Reset selection to style"},Un.a.createElement(Wn.hb,{mr:2,hoverColor:"black",color:"gray",size:24,unstyledHover:!0,onClick:function(){return W&&function(t){var e=Object(Do.b)({editorState:r});e=Object(Zo.h)({editorState:e,styleName:t.name}),e=Object(aa.d)({editorState:e,align:void 0}),l(Object(Do.g)(e,r.getSelection()))}(W)}},Un.a.createElement(Ss,{color:"lightGray"}))),Un.a.createElement(Wn.Cb,{text:"Update style"},Un.a.createElement(Wn.hb,{disabled:X&&!K,mr:0,hoverColor:"black",color:"gray",size:24,unstyledHover:!0,onClick:function(){return W&&tt(W)}},Un.a.createElement(xs,{color:"lightGray"})))):Un.a.createElement(Wn.n,{onClick:function(){return D(Mr.TextStylesList)},variant:"clean"},Un.a.createElement(Wn.Db,{color:nt?"black":"gray"}))))),Un.a.createElement(Wn.m,{mb:16,position:"relative"},Un.a.createElement(ls,{onHeightChanged:n})),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"center"},Un.a.createElement(Wn.m,{textAlign:"center",width:"100%"},Un.a.createElement(Wn.C,{justifyContent:"center"},Un.a.createElement(Wn.D,{color:"gray"}))),Un.a.createElement(Wn.m,{width:"100%"},Un.a.createElement(Wn.C,{width:58,justifyContent:"center"},Un.a.createElement(ys,{isLinked:_,onClick:function(){var t=!_;y(t),l(Object(zo.c)({key:zo.b.IsLinkedFontSize,value:String(t),editorState:r}))}}))),Un.a.createElement(Wn.m,{textAlign:"center",width:"100%"},Un.a.createElement(Wn.C,{justifyContent:"center"},Un.a.createElement(Wn.N,{color:"gray"})))),Un.a.createElement(Cs,{mx:-1},Un.a.createElement(Wn.E,{ratio:j,fontSize:k,lineHeight:C,linked:_,fontSizeLinked:I,onChange:function(t){var e=r;if(I){var i=ws({letterSpacing:R,fontSize:k,newFontSize:t.fontSize});A(i),e=Object(zo.c)({key:zo.b.LetterSpacing,value:i,editorState:e})}S(t.fontSize),t.fontSize!==k&&(e=Object(zo.c)({key:zo.b.FontSize,value:t.fontSize,editorState:e})),O(t.lineHeight),t.lineHeight!==C&&(e=Object(cs.d)({editorState:e,lineHeight:t.lineHeight})),l(e)},onChangeRatio:$})),Un.a.createElement(Wn.C,{justifyContent:"center",mb:"8px"},Un.a.createElement(Wn.m,{width:32},Un.a.createElement(ys,{isLinked:I,onClick:function(){var t=!I;E(t),l(Object(zo.c)({key:zo.b.IsLinkedLetterSpacing,value:String(t),editorState:r}))}}))),Un.a.createElement(Wn.C,{alignItems:"flex-end",justifyContent:"center"},Un.a.createElement(Wn.m,{textAlign:"right"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"gray"},"a")),Un.a.createElement(Wn.m,{width:58},Un.a.createElement(Wn.X,{textAlign:"center",placeholder:"LetterSpacing",textStyle:"regular",direction:"x",value:R,step:.1,min:-99,max:999,color:I?"blue":void 0,onChange:function(t){var e=t||0;A(e),l(Object(zo.c)({key:zo.b.LetterSpacing,value:e,editorState:r}))}})),Un.a.createElement(Wn.m,{textAlign:"left"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"gray"},"b"))))},Ps=Un.a.forwardRef(Os),js=i("YqYG");function $s(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Ts(t){return function(t){if(Array.isArray(t))return Ms(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Es(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Is(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Es(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Es(t,e){if(t){if("string"==typeof t)return Ms(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ms(t,e):void 0}}function Ms(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Rs=function(t){var e={color:"gray"};switch(t.provider){case"google":return Un.a.createElement(Wn.G,e);case"typekit":return Un.a.createElement(Wn.Hb,e);case"typetoday":return Un.a.createElement(Wn.Gb,e);case"webtype":return Un.a.createElement(Wn.Nb,e);default:return null}},As=Object(Vn.e)(Wn.C).withConfig({displayName:"FontsList___StyledFlex"})(["border-radius:8px 8px 0 0;"]),Ds=Object(Vn.e)(Wn.m).withConfig({displayName:"FontsList___StyledBox"})(["transform:translateY(-50%);"]),zs=Object(Vn.e)(Wn.n).withConfig({displayName:"FontsList___StyledButton"})(["font-family:",",sans-serif;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;text-align:left;"],(function(t){return t._css})),Ls=function(t,e){var i=t.style,n=t.headerSlot,o=t.currentFontFamily,a=Object(Nn.useContext)(Fn.a).model,s=Object(Nn.useContext)(Ka),r=s.goBack,l=s.navigate,c=Object(Nn.useContext)(qr).setSelectedFont,d=a.project.get("num_id"),h=a.user.get("_id"),u=Is(Object(Nn.useState)([]),2),p=u[0],g=u[1],m=window.RM.constructorRouter.fonts.edit_params;m.on("change",(function(t){_()}));var f=Is(Object(Nn.useState)(null),2),v=f[0],b=f[1],_=function(){g(Ts(m.get("fonts")).sort((function(t,e){return t.name.localeCompare(e.name)})))};Object(Nn.useEffect)((function(){_()}),[]);var y=function(){var t=function(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){$s(a,n,o,s,r,"next",t)}function r(t){$s(a,n,o,s,r,"throw",t)}s(void 0)}))}}(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.is_personal){t.next=6;break}return t.next=3,Object(Bo.B)({_id:e._id,hidden:!0});case 3:window.RM.constructorRouter.fonts.changeFontHidden(e.css_name,!0,h,d),t.next=7;break;case 6:window.RM.constructorRouter.fonts.removeFonts([e.css_name]);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),w=new js.default({$parent:document.querySelector("body > .popups"),router:window.RM.constructorRouter,opts:{type:"type-upload-fonts",is_contributor:!window.RM.constructorRouter.isOwner,owner_email:a.user.get("email")},alert_source:"use custom font"});return Un.a.createElement(vo,{ref:e,style:i},Un.a.createElement(As,{flexDirection:"column",bg:"white"},n||null,Un.a.createElement(Wn.m,{maxHeight:460,height:"100%"},Un.a.createElement(Wn.ib,null,(function(t){var e=t.ref;return(Un.a.createElement(Wn.m,{ref:e,pt:10},p.filter((function(t){return!t.hidden})).map((function(t,e){return Un.a.createElement(Wn.m,{key:"".concat(t.css_name,"-").concat(e),pr:16,mb:"6px",position:"relative"},o&&(o===t.name||o===t.css_name)&&Un.a.createElement(Ds,{bg:"black",borderRadius:"50%",width:6,height:6,position:"absolute",left:6,top:"50%"}),Un.a.createElement(Wn.C,{pl:16,height:20,alignItems:"center",justifyContent:"space-between",onMouseEnter:function(){return b(e)},onMouseLeave:function(){return b(null)}},Un.a.createElement(zs,{textStyle:"small",onClick:function(){return function(t){c(t),r()}(t)},width:"100%",variant:"clean",_css:t.css_name},t.name),v===e&&Un.a.createElement(Wn.C,{height:16,width:84,alignItems:"center",justifyContent:"flex-end"},Un.a.createElement(Un.a.Fragment,null,t.is_personal?Un.a.createElement(Wn.m,{mr:12},Un.a.createElement(Wn.n,{onClick:function(){c(t),l(Mr.FontUploader)},display:"flex",height:16,variant:"clean"},"‎",Un.a.createElement(Wn.kb,{color:"gray"}))):Un.a.createElement(Wn.C,{mr:12,height:16,alignItems:"center"},Un.a.createElement(Rs,{provider:t.provider})),Un.a.createElement(Wn.n,{onClick:function(){return y(t)},display:"flex",height:12,variant:"clean"},Un.a.createElement(Wn.x,{color:"gray"}))))))}))))})))),Un.a.createElement(Wn.C,{alignItems:"center",py:10},Un.a.createElement(Wn.m,{width:80,textAlign:"center"},Un.a.createElement(Wn.n,{textStyle:"small",color:"black",onClick:function(){window.RM.views.fontExplorer.toggle()},variant:"clean"},"Library")),Un.a.createElement(Wn.m,{width:"2px",height:24,borderRadius:2,bg:"gray"}),Un.a.createElement(Wn.m,{width:80,textAlign:"center"},Un.a.createElement(Wn.n,{textStyle:"small",color:"black",onClick:function(){(window.RM.constructorRouter.isOwner?(window.RM.constructorRouter.me&&window.RM.constructorRouter.me.get("permissions")||{}).can_use_custom_fonts:a.user.get("permissions").can_use_custom_fonts)?l(Mr.FontUploader):w.render()},variant:"clean"},"Upload"))))},Bs=Un.a.forwardRef(Ls);function Fs(){return(Fs=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Ns(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var Us=function(t){var e=t.cancelText,i=void 0===e?"Cancel":e,n=t.doneText,o=void 0===n?"Done":n,a=t.cancelAction,s=t.doneAction,r=t.cancelDisabled,l=t.doneDisabled,c=Ns(t,["cancelText","doneText","cancelAction","doneAction","cancelDisabled","doneDisabled"]);return(Un.a.createElement(Wn.C,Fs({alignItems:"flex-end",justifyContent:"space-between",height:64,pb:10},c),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{variant:"clean",onClick:a,disabled:r},i)),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{variant:"clean",onClick:s,disabled:l,color:l?void 0:"blue"},o))))};function Hs(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Vs(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Hs(Object(i),!0).forEach((function(e){Ws(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Hs(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ws(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Gs(t){return function(t){if(Array.isArray(t))return Zs(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Ys(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qs(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Ks(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){qs(a,n,o,s,r,"next",t)}function r(t){qs(a,n,o,s,r,"throw",t)}s(void 0)}))}}function Xs(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Ys(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ys(t,e){if(t){if("string"==typeof t)return Zs(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Zs(t,e):void 0}}function Zs(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Js=Object.keys(Ja.WEIGHTS),Qs=Object(Vn.e)(Wn.I).withConfig({displayName:"FontUploader___StyledInlineInput"})(["border-bottom:none !important;padding:0;"]),tr=function(t,e){var i=t.style,n=Object(Nn.useContext)(Ka).goBack,o=Object(Nn.useContext)(qr).selectedFont,a=Xs(Object(Nn.useState)(null),2),s=a[0],r=a[1],l=Xs(Object(Nn.useState)(""),2),c=l[0],d=l[1],h=Xs(Object(Nn.useState)([]),2),u=h[0],p=h[1],g=Xs(Object(Nn.useState)(null),2),m=g[0],f=g[1],v=Xs(Object(Nn.useState)(!1),2),b=v[0],_=v[1];Object(Nn.useEffect)((function(){o&&(r(o._id),Object(Bo.e)(o._id).then((function(t){var e=t.data;d(e.name),p(e.variations)})))}),[]),Object(Nn.useEffect)((function(){m&&setTimeout((function(){f(null)}),4e3)}),[m]);var y=Xs(Object(Nn.useState)(null),2),w=y[0],k=y[1],S=function(){var t=Ks(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return _(!0),t.prev=1,t.next=4,Object(Bo.N)(e);case 4:(i=t.sent)&&(i.woffUrl||i.woff2Url||i.ttfUrl||i.otfUrl)?(n={type:w||"n4"},i.woffUrl?n.woff=i.woffUrl:i.woff2Url?n.woff2=i.woff2Url:i.otfUrl?n.otf=i.otfUrl:i.ttfUrl&&(n.ttf=i.ttfUrl),p([].concat(Gs(u),[n]))):f("Uploading error"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),f("Uploading error");case 11:_(!1),k(null);case 13:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}(),x=function(){var t=Ks(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Bo.b)({is_personal:!0,name:c,variations:u});case 2:if(e=t.sent,!(i=e.data)||!i._id){t.next=10;break}return t.next=7,window.RM.constructorRouter.fonts.addFonts([Vs(Vs({},i),{},{variations:i.variations.map((function(t){return t.type}))})],"font-upload");case 7:n(),t.next=11;break;case 10:f("Saving error");case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=Ks(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=12;break}return t.next=3,Object(Bo.E)(s,{name:c,variations:u});case 3:if(e=t.sent,!(i=e.data)||!i._id){t.next=11;break}return t.next=8,window.RM.constructorRouter.fonts.addFonts([Vs(Vs({},i),{},{variations:i.variations.map((function(t){return t.type}))})],"font-upload");case 8:n(),t.next=12;break;case 11:f("Update error");case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),O=u.map((function(t){return t.type})),P=new Set(O).size!==O.length,j=u.some((function(t){return"v"===t.type})),$=Js.filter((function(t){return u.length>1&&!j?"v"!==t:t})).map((function(t){return{value:t,label:Ja.WEIGHTS[t]}})),T=Object(Nn.useRef)(null);return Un.a.createElement(vo,{ref:e,style:i,px:16},Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Qs,{textStyle:"small",value:c,onChange:function(t){return d(t.target.value)},placeholder:"Font name"})),u.map((function(t,e){return Un.a.createElement(xo,{key:e,showBorderTop:!1,small:!0},Un.a.createElement(Ro,{items:$,value:t.type,onSelect:function(t){var i=Gs(u);i[e].type=t.value,p(i)},rightIcon:Un.a.createElement(Wn.n,{onClick:function(){var t=Gs(u);t.splice(e,1),p(t)},variant:"clean"},Un.a.createElement(Wn.x,{color:"gray"}))}))})),j?void 0:Un.a.createElement(Un.a.Fragment,null,Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!1,small:!0},Un.a.createElement(Ro,{items:$,value:void 0,onSelect:function(t){k(t.value),T.current&&T.current.click()}},(function(t){var e=t.toggleDropdown,i=t.ref;return(Un.a.createElement(Wn.m,{ref:i},Un.a.createElement(Wn.n,{variant:"clean",onClick:b?void 0:e},Un.a.createElement(Wn.zb,{textStyle:"small",color:m?"red":"gray"},m||(b?"Uploading...":u.length?"Add another weight":"Add weight")))))}))),Un.a.createElement(Wn.B,{ref:T,onChange:S,dropFile:!0,readFileData:!1,accept:"font/ttf,font/otf,font/woff,font/woff2"})),Un.a.createElement(Us,{cancelAction:n,doneDisabled:!u.length||!c.length||P,doneAction:s?C:x}))},er=Un.a.forwardRef(tr),ir=i("xk4V"),nr=i.n(ir);function or(){return(or=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function ar(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return sr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return sr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var rr=Object(Vn.e)(Wn.m).withConfig({displayName:"PanelDropdown___StyledBox"})(["opacity:0.24;"]),lr=Object(Vn.e)(Wn.n).withConfig({displayName:"PanelDropdown___StyledButton"})(["text-align:left;width:100%;"]),cr=function(t){var e=t.container,i=t.listItems,n=t.headerIcons,o=t.children,a=t.isCleanVariant,s=void 0===a||a,r=t.p,l=t.width,c=ar(Object(Nn.useState)(!1),2),d=c[0],h=c[1],u=ar(Object(Nn.useState)(null),2),p=u[0],g=u[1],m=ar(Object(Nn.useState)(null),2),f=m[0],v=m[1],b=Object(Nn.useMemo)((function(){return p?p.getBoundingClientRect():{}}),[p]),_=Object(Co.a)(p,f,{placement:"bottom",modifiers:[{name:"offset",options:{offset:[0,-1*b.height||0]}}]}),y=_.styles,w=_.attributes,k=function(t){t.target&&p&&p.contains(t.target)||h(!1)};Object(Nn.useEffect)((function(){return d?window.addEventListener("click",k):window.removeEventListener("click",k),function(){window.removeEventListener("click",k)}}),[d]);var S=Un.a.createElement(Wn.m,or({bg:"white",width:l||"calc(100% + 8px + 8px)",borderRadius:8,border:"1px solid",borderColor:"#F0F0F0",p:r||"16px 24px",zIndex:105,ref:v,style:y.popper},w.popper),n&&n.length?Un.a.createElement(Wn.C,{borderBottom:"1px solid",borderColor:"#EEEEEE",alignItems:"center",justifyContent:"flex-start",pb:14,mb:2},n.map((function(t,e){return Un.a.createElement(Wn.hb,{mr:e===n.length-1?0:3,key:e,onClick:t.onClick,hoverColor:"black",color:"gray",size:24,unstyledHover:!0},t.icon)}))):void 0,Un.a.createElement(Wn.m,null,i.map((function(t,e){return function(t){return!!t.separator}(t)?Un.a.createElement(rr,{key:e,mt:2,mb:1,height:2,bg:"gray"}):Un.a.createElement(Wn.m,{key:e,mb:1},Un.a.createElement(lr,{onClick:t.onClick,variant:s?"clean":"unstyled"},"string"==typeof t.title?Un.a.createElement(Wn.zb,{textStyle:"small"},t.title):t.title))}))));return Un.a.createElement(Un.a.Fragment,null,Un.a.createElement(Wn.m,{position:"relative",cursor:"pointer",ref:g},o({toggleDropdown:function(){h(!d)}})),d?e?co.a.createPortal(S,e):S:null)};function dr(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function hr(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?dr(Object(i),!0).forEach((function(e){ur(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dr(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ur(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function pr(t){return function(t){if(Array.isArray(t))return br(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||vr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gr(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function mr(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){gr(a,n,o,s,r,"next",t)}function r(t){gr(a,n,o,s,r,"throw",t)}s(void 0)}))}}function fr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||vr(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vr(t,e){if(t){if("string"==typeof t)return br(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?br(t,e):void 0}}function br(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var _r,yr=Object(Vn.e)(Wn.m).withConfig({displayName:"TextStylesList___StyledBox"})(["user-select:none;"]),wr=Object(Vn.e)(Wn.n).withConfig({displayName:"TextStylesList___StyledButton"})(["vertical-align:middle;"]),kr=function(t,e){var i=t.style,n=t.onHeightChanged,o=Object(Nn.useContext)(Ka).navigate,a=Object(Nn.useContext)(qr),s=a.setSelectedTextStyle,r=a.setSelectedTextStyleSection,l=a.selectedTextStyleSection,c=Object(Nn.useContext)(Hn.BackboneContext).model,d=Object(Nn.useContext)(Fn.a).model,h=Object(Nn.useMemo)((function(){return d.project.get("_id")}),[d]),u=Object(Nn.useMemo)((function(){return d.user.get("_id")}),[d]),p=fr(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(c._id)}),[c._id])(),2),g=p[0],m=p[1],f=Object(Nn.useRef)(null),v=fr(Object(Nn.useState)(l||sa.d.project),2),b=v[0],_=v[1],y=fr(Object(Ao.useTextStylesStore)(),2),w=y[0],k=y[1],S=Object(Nn.useMemo)((function(){return b===sa.d.global?w.global:w.project}),[b,w]),x=fr(Object(Nn.useState)(null),2),C=x[0],O=x[1],P=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:g})}),[g]);Object(Nn.useEffect)((function(){n()}),[]);var j=function(t){var e=Object(Do.l)(g).reduce((function(e,i){var n=e,o=n.getCurrentContent().getBlockForKey(i);return null===t?n=Object(Zo.h)({editorState:n,block:o,styleName:Ca.a.Unstyled}):t.name!==P&&(n=Object(Zo.h)({editorState:n,block:o,styleName:t.name})),o=n.getCurrentContent().getBlockForKey(i),n=Object(aa.d)({block:o,editorState:n,align:void 0})}),g);m(Object(Do.g)(e,g.getSelection()))},$=function(){var t=mr(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=pr(S),(n=i.findIndex((function(t){return t.name===e.name})))>-1&&i.splice(n,0,hr(hr({},e),{},{name:"style-".concat(nr()()),label:"".concat(e.label," (Copy)")})),t.next=5,k(hr(hr({},w),{},ur({},b,i)));case 5:if(b!==sa.d.global){t.next=10;break}return t.next=8,Object(Bo.L)({userId:u,styles:i});case 8:t.next=12;break;case 10:return t.next=12,Object(Bo.J)({projectId:h,styles:i});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),T=function(){var t=mr(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=pr(S),(n=i.findIndex((function(t){return t.name===e.name})))>-1&&i.splice(n,1),t.next=5,k(hr(hr({},w),{},ur({},b,i)));case 5:if(b!==sa.d.global){t.next=10;break}return t.next=8,Object(Bo.L)({userId:u,styles:i});case 8:t.next=12;break;case 10:return t.next=12,Object(Bo.J)({projectId:h,styles:i});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),I=function(){var t=mr(regeneratorRuntime.mark((function t(e,i){var n,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],o=[],i===sa.d.global?(n=pr(S),(a=n.findIndex((function(t){return t.name===e.name})))>-1&&n.splice(a,1),o=[].concat(pr(w.global),[e])):(o=pr(S),(s=o.findIndex((function(t){return t.name===e.name})))>-1&&o.splice(s,1),n=[].concat(pr(w.project),[e])),t.next=5,k({global:o,project:n});case 5:return t.next=7,Object(Bo.J)({projectId:h,styles:n});case 7:return t.next=9,Object(Bo.L)({userId:u,styles:o});case 9:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}();return Un.a.createElement(vo,{ref:e,style:i},Un.a.createElement(Wn.C,{flexDirection:"column",justifyContent:"space-between"},Un.a.createElement(Wn.m,{px:16},Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){return _(sa.d.project)},mr:2},Un.a.createElement(Wn.zb,{textStyle:"small",color:b===sa.d.project?"black":"darkGray"},"Project")),Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){return _(sa.d.global)}},Un.a.createElement(Wn.zb,{textStyle:"small",color:b===sa.d.global?"black":"darkGray"},"Global")))),Un.a.createElement(Wn.m,{maxHeight:328},Un.a.createElement(Wn.ib,null,(function(t){var e=t.ref;return(Un.a.createElement(Wn.m,{ref:e},Un.a.createElement(Wn.m,{px:16,position:"relative",onMouseEnter:function(){return O(-1)},onMouseLeave:function(){return O(null)},onClick:function(){return j(null)},cursor:"pointer"},Un.a.createElement(Wn.m,{bg:P?"blue":"gray",opacity:-1!==C&&P&&P!==Ca.a.Unstyled?0:.2,position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!1,small:!0},Un.a.createElement(Wn.zb,{textStyle:"small"},"No style"))),S.map((function(t,e){var i=[{title:"Edit",onClick:function(){!function(t){s(t),r(b),o(Mr.TextStyle)}(t)}},{title:"Duplicate",onClick:function(){$(t)}},{title:"Move to ".concat(b===sa.d.global?"Project":"Global"),onClick:function(){I(t,b===sa.d.global?sa.d.project:sa.d.global)}},{title:"Delete",onClick:function(){T(t)}}];return(Un.a.createElement(cr,{container:f?f.current:void 0,key:e,listItems:i},(function(i){var n=i.toggleDropdown;return(Un.a.createElement(yr,{position:"relative",onMouseEnter:function(){return O(e)},onMouseLeave:function(){return O(null)},cursor:"pointer",maxHeight:"80px",minHeight:"34px",overflow:"hidden"},Un.a.createElement(Wn.m,{bg:P===t.label?"gray":"blue",opacity:C===e||P===t.name?.2:0,position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),Un.a.createElement(Wn.C,{maxHeight:"80px",minHeight:"34px",px:16,py:"8px",justifyContent:"space-between",alignItems:"center",position:"relative"},Un.a.createElement("div",{className:t.name,onClick:function(){return j(t)},style:{width:"100%",padding:0,textAlign:"left",maxWidth:108,overflow:"hidden",whiteSpace:"nowrap",lineHeight:1}},t.label),Un.a.createElement(Wn.m,null,C===e?Un.a.createElement(Wn.n,{height:16,onClick:n,variant:"clean"},Un.a.createElement(Wn.Eb,{color:"black"})):void 0))))})))}))))}))),Un.a.createElement(Wn.m,{px:16},Un.a.createElement(xo,{showBorderBottom:!1,small:!0},Un.a.createElement(Wn.m,{width:"100%",textAlign:"center"},Un.a.createElement(wr,{onClick:function(){s(void 0),r(b),o(Mr.TextStyle)},variant:"clean",height:18},Un.a.createElement(Wn.db,{color:"black"})))))),Un.a.createElement(Wn.m,{ref:f}))},Sr=Un.a.forwardRef(kr);function xr(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Cr(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){xr(a,n,o,s,r,"next",t)}function r(t){xr(a,n,o,s,r,"throw",t)}s(void 0)}))}}function Or(t){return function(t){if(Array.isArray(t))return $r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||jr(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||jr(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(t,e){if(t){if("string"==typeof t)return $r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?$r(t,e):void 0}}function $r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Tr(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Ir(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Tr(Object(i),!0).forEach((function(e){Er(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Tr(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Er(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.SetInfo="SetInfo",t.SetCss="SetCss",t.Reset="Reset"}(_r||(_r={}));var Mr,Rr=function(t,e){switch(e.type){case _r.Reset:return Ir({},e.payload);case _r.SetInfo:return Ir(Ir({},t),e.payload);case _r.SetCss:return Ir(Ir({},t),{},{cssProperties:Ir(Ir({},t.cssProperties),e.payload)});default:return t}},Ar=function(t,e){var i=t.style,n=t.onHeightChanged,a=Object(Nn.useContext)(Hn.BackboneContext).model,s=Object(Nn.useContext)(Ka).goBack,r=Object(Nn.useContext)(Fn.a).model,l=Object(Nn.useMemo)((function(){return r.project.get("num_id")}),[r]),c=Object(Nn.useMemo)((function(){return r.project.get("_id")}),[r]),d=Object(Nn.useMemo)((function(){return r.user.get("_id")}),[r]),h=Pr(Object(Ao.useTextStylesStore)(),2),u=h[0],p=h[1],g=Pr(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(a._id)}),[a._id])(),1)[0],m=Object(Nn.useMemo)((function(){var t=Object(Do.i)(g),e=Object(Zo.b)({block:t}),i={label:"New style",name:"style-".concat(nr()()),cssProperties:{fontFamily:Ca.b.fontFamily,fontWeight:String(Ca.b.fontWeight),fontSize:Ca.b.fontSize,lineHeight:Ca.b.lineHeight},tag:"p"};if(e){var n=[].concat(Or(u.project),Or(u.global)).find((function(t){return t.name===e}));n&&(i.cssProperties=n.cssProperties)}var o=g.getCurrentInlineStyle(),a=Object(zo.g)(o);i.cssProperties=Ir(Ir({},i.cssProperties),a);var s=Object(ds.a)({block:t}),r=Object(aa.c)({block:t}),l=Object(cs.a)({block:t});return i.cssProperties=Ir(Ir({},i.cssProperties),{},{color:a.color?Object(Lo.i)(Object(Lo.h)(a.color)):i.cssProperties.color,paddingLeft:s&&s.left||i.cssProperties.left,paddingRight:s&&s.right||i.cssProperties.right,paddingBottom:s&&s.bottom||i.cssProperties.bottom,paddingTop:s&&s.top||i.cssProperties.top,textAlign:r&&r.replace("align-","")||i.cssProperties.textAlign||"left",lineHeight:l||i.cssProperties.lineHeight}),i}),[]),f=Object(Nn.useContext)(qr),v=f.selectedFont,b=f.selectedTextStyle,_=f.selectedTextStyleSection,y=f.setChangedStyle,w=f.changedStyle,k=f.setSelectedFont,S=Object(Nn.useMemo)((function(){return b||Ir({},m)}),[b]),x=Object(Nn.useMemo)((function(){return _||sa.d.project}),[_]),C=Pr(Object(Nn.useReducer)(Rr,S),2),O=C[0],P=C[1],j=x===sa.d.global?u.global:u.project;Object(Nn.useEffect)((function(){P({type:_r.Reset,payload:Ir({},S)})}),[b]);Object(Nn.useEffect)((function(){!function(){var t=j.findIndex((function(t){return t.name===O.name}));if(t>-1){var e=Or(j);e[t]=Ir({},O),p(Ir(Ir({},u),{},Er({},x,e)))}}(),y(O)}),[O]);var $=Pr(Object(Nn.useState)(!1),2),T=$[0],I=$[1],E=Pr(Object(Nn.useState)([]),2),M=E[0],R=E[1];Object(Nn.useEffect)((function(){var t=!o.a.isEqual(S,O);t!==T&&I(t);var e=[];Object.keys(O).forEach((function(t){O[t]!==S[t]&&e.push(t)})),Object.keys(O.cssProperties).forEach((function(t){O.cssProperties[t]!==S.cssProperties[t]&&e.push(t)})),R(e)}),[O]);var A=Object(Nn.useCallback)(Cr(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(T){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,P({type:_r.Reset,payload:Ir({},S)});case 4:return t.next=6,I(!1);case 6:case"end":return t.stop()}}),t)}))),[T,S]),D=function(){var t=Cr(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Or(j),i=e.findIndex((function(t){return t.name===O.name})),y(void 0),i<0&&(e.push(O),p(Ir(Ir({},u),{},Er({},x,e)))),x!==sa.d.global){t.next=9;break}return t.next=7,Object(Bo.L)({userId:d,styles:e});case 7:t.next=11;break;case 9:return t.next=11,Object(Bo.J)({projectId:c,styles:e});case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),z=Pr(Object(Nn.useState)(O.cssProperties.color?Object(Lo.d)(O.cssProperties.color):Ko),2),L=z[0],B=z[1],F=Object(Nn.useMemo)((function(){switch("align-".concat(O.cssProperties.textAlign)){case aa.a.AlignCenter:return Wn.b;case aa.a.AlignRight:return Wn.f;case aa.a.AlignJustify:return Wn.d;case aa.a.AlignFullJustify:return Wn.c;default:return Wn.e}}),[O.cssProperties.textAlign]),N=Object(Nn.useMemo)((function(){return"uppercase"===O.cssProperties.textTransform}),[O.cssProperties.textTransform]);Object(Nn.useEffect)((function(){w&&P({type:_r.Reset,payload:w}),v&&(P({type:_r.SetCss,payload:{fontFamily:v.css_name}}),k(void 0))}),[]);var U=function(t){return M.includes(t)};return(Un.a.createElement(vo,{ref:e,style:i,px:16},Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.I,{placeholder:"Style Name",value:O.label,onChange:function(t){P({type:_r.SetInfo,payload:{label:t.target.value}})},p:"0 !important",border:"none !important",color:U("label")?"blue":"black"})),Un.a.createElement(ls,{textStyle:O,onChangeTextStyle:function(t){P({type:_r.SetCss,payload:t})},onHeightChanged:n}),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Text size"),Un.a.createElement(Wn.m,{width:50},Un.a.createElement(Wn.X,{textAlign:"right",min:8,max:999,value:Object(Zo.c)(O.cssProperties.fontSize),color:U("fontSize")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{fontSize:t}})}})))),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Line height"),Un.a.createElement(Wn.m,{width:50},Un.a.createElement(Wn.X,{min:8,max:999,textAlign:"right",value:Object(Zo.c)(O.cssProperties.lineHeight),color:U("lineHeight")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{lineHeight:t}})}})))),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.zb,{textStyle:"small"},"Letter spacing"),Un.a.createElement(Wn.m,{width:50},Un.a.createElement(Wn.X,{textAlign:"right",min:-99,max:999,step:.1,direction:"y",value:Object(Zo.c)(O.cssProperties.letterSpacing,!0),color:U("letterSpacing")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{letterSpacing:t}})}})))),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"flex-start"},Un.a.createElement(Wn.n,{variant:"clean",ml:"-6px",onClick:function(){P({type:_r.SetCss,payload:{textTransform:N?void 0:"uppercase"}})}},Un.a.createElement(Wn.mb,{color:N?"blue":"black",width:32,height:32})),Un.a.createElement(Wn.n,{variant:"clean",ml:"-6px",onClick:function(){P({type:_r.SetCss,payload:{fontWeight:700===O.cssProperties.fontWeight?400:700}})}},Un.a.createElement(Wn.l,{color:700===O.cssProperties.fontWeight?"blue":"black",width:28,height:28,viewBox:"-11 -9 30 30"})),Un.a.createElement(Wn.n,{variant:"clean",ml:"-6px",onClick:function(){P({type:_r.SetCss,payload:{fontStyle:"italic"===O.cssProperties.fontStyle?"normal":"italic"}})}},Un.a.createElement(Wn.K,{color:"italic"===O.cssProperties.fontStyle?"blue":"black",width:28,height:28,viewBox:"-13 -8 30 30"})),Un.a.createElement(Wn.n,{variant:"clean",ml:"-6px",onClick:function(){P({type:_r.SetCss,payload:{textDecoration:"underline"===O.cssProperties.textDecoration?void 0:"underline"}})}},Un.a.createElement(Wn.Jb,{color:"underline"===O.cssProperties.textDecoration?"blue":"black",width:30,height:30})),Un.a.createElement(Wn.n,{variant:"clean",ml:"-6px",onClick:function(){P({type:_r.SetCss,payload:{textDecoration:"line-through"===O.cssProperties.textDecoration?void 0:"line-through"}})}},Un.a.createElement(Wn.pb,{color:"line-through"===O.cssProperties.textDecoration?"blue":"black",width:30,height:30})))),Un.a.createElement(Ta,{showBorderTop:!1,small:!0,title:"Color",projectNumId:l,userId:d,color:L,setColor:B,onChangeComplete:function(t){P({type:_r.SetCss,payload:{color:Object(Lo.g)(t)}})}}),Un.a.createElement(Wn.m,{pt:25,pb:22},Un.a.createElement(Wn.C,{justifyContent:"center",mb:16},Un.a.createElement(Wn.X,{textAlign:"center",min:0,max:999,value:Object(Zo.c)(O.cssProperties.paddingTop),color:U("paddingTop")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{paddingTop:t}})}})),Un.a.createElement(Wn.C,{alignItems:"center",flexDirection:"row",mb:18},Un.a.createElement(Wn.m,{mr:19},Un.a.createElement(Wn.X,{textAlign:"right",min:0,max:999,value:Object(Zo.c)(O.cssProperties.paddingLeft),color:U("paddingLeft")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{paddingLeft:t}})}})),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){var t,e,i;P({type:_r.SetCss,payload:{textAlign:(t=O.cssProperties.textAlign||"left",e=["left","center","right","justify","full-justify"],i=e.indexOf(t),i>-1?e[i+1]||e[0]:t)}})}},Un.a.createElement(F,{color:U("textAlign")?"blue":"black"}))),Un.a.createElement(Wn.m,{ml:19},Un.a.createElement(Wn.X,{textAlign:"left",min:0,max:999,value:Object(Zo.c)(O.cssProperties.paddingRight),color:U("paddingRight")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{paddingRight:t}})}}))),Un.a.createElement(Wn.C,{justifyContent:"center",mb:14},Un.a.createElement(Wn.X,{textAlign:"center",min:0,max:999,value:Object(Zo.c)(O.cssProperties.paddingBottom),color:U("paddingBottom")?"blue":"black",onChange:function(t){P({type:_r.SetCss,payload:{paddingBottom:t}})}}))),Un.a.createElement(xo,{small:!0},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"HTML tag")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{onClick:function(){return P({type:_r.SetInfo,payload:{tag:(t=O.tag,e=St.a.AVAILABLE_TEXT_TAGS,i=e.indexOf(t),i>-1?e[i+1]||e[0]:t)}});var t,e,i},variant:"clean"},Un.a.createElement(Wn.zb,{textStyle:"small",color:U("tag")?"blue":"black"},"<",O.tag,">"))))),Un.a.createElement(Us,{cancelAction:Cr(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,A();case 2:s();case 3:case"end":return t.stop()}}),t)}))),doneDisabled:!T,doneAction:Cr(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D();case 2:s();case 3:case"end":return t.stop()}}),t)})))})))},Dr=Un.a.forwardRef(Ar),zr=function(t){var e=t.leftSlot,i=t.centerSlot,n=t.rightSlot;return(Un.a.createElement(Wn.m,{height:40,px:16,bg:"lightGray",borderRadius:"8px 8px 0 0"},Un.a.createElement(Wn.C,{height:40,justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,{width:"20%"},e),Un.a.createElement(Wn.m,{width:"100%",textAlign:"center"},i),Un.a.createElement(Wn.m,{width:"20%"},n))))},Lr=i("JW7n");function Br(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Fr(t){return function(t){if(Array.isArray(t))return Hr(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Ur(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Ur(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ur(t,e){if(t){if("string"==typeof t)return Hr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Hr(t,e):void 0}}function Hr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Vr(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Wr(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Vr(Object(i),!0).forEach((function(e){Gr(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Vr(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Gr(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Typography="Typography",t.FontsList="FontsList",t.FontUploader="FontUploader",t.TextStylesList="TextStylesList",t.TextStyle="TextStyle"}(Mr||(Mr={}));var qr=Un.a.createContext({}),Kr=function(t,e){return Wr(Wr({},t),e||{})},Xr=function(){var t=Object(Nn.useContext)(Hn.BackboneContext).model,e=Nr(Object(Nn.useState)(!1),2),i=e[0],n=e[1],o=Object(Nn.useContext)(Fn.a).model,a=Nr(Object(Ao.useTextStylesStore)(),2),s=a[0],r=a[1],l=Nr(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(t._id)}),[t._id])(),1)[0],c=Object(Nn.useMemo)((function(){return Object(Zo.b)({editorState:l})}),[l]),d=Object(Nn.useMemo)((function(){return[].concat(Fr(s.global),Fr(s.project)).find((function(t){return t.name===c}))}),[c,s]),h=Nr(Object(Nn.useReducer)(Kr,{setSelectedFont:function(t){p({selectedFont:t})},setSelectedTextStyle:function(t){p({selectedTextStyle:t})},setSelectedTextStyleSection:function(t){p({selectedTextStyleSection:t})},setChangedStyle:function(t){p({changedStyle:t})}}),2),u=h[0],p=h[1],g=Object(Nn.useRef)(),m=Nr(Object(Nn.useState)(""),2),f=m[0],v=m[1],b=function(){var t=function(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){Br(a,n,o,s,r,"next",t)}function r(t){Br(a,n,o,s,r,"throw",t)}s(void 0)}))}}(regeneratorRuntime.mark((function t(){var e,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Lr.b)();case 2:e=t.sent,i=e.textStyles,p({changedStyle:void 0,selectedTextStyle:void 0}),r(Wr({},i));case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();Object(Nn.useEffect)((function(){o.visible&&o.selected||!u.changedStyle||b()}),[o.selected,o.visible,u.changedStyle]);var _=f===Mr.TextStyle?Un.a.createElement(zr,{leftSlot:Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){return g.current&&g.current.goBack()}},Un.a.createElement(Wn.p,null)),centerSlot:Un.a.createElement(Wn.zb,{textStyle:"small"},"Edit style")}):void 0,y=Object(Nn.useMemo)((function(){if(u.selectedTextStyle)return u.selectedTextStyle.cssProperties.fontFamily||Ca.b.fontFamily;var t=Object(zo.d)(l,zo.b.FontFamily);return t.length&&t[0]?t[0]:d?String(d.cssProperties.fontFamily):Ca.b.fontFamily}),[d,l,u.selectedTextStyle]),w=Za(g.current),k=w.canControlBeClosed,S=w.onStackUpdated;return o.injectedRefs.canControlBeClosed=k,Un.a.createElement(ro,{control:function(t){var e=t.ref;return(Un.a.createElement(Yn,{ref:e,label:"Typography",onMouseEnter:function(){n(!0)},onMouseLeave:function(){n(!1)},onClick:function(t){if(t.preventDefault(),!o.disabled){if(g.current&&g.current.currentScreen!==Mr.Typography){if(o.selected)return void g.current.goBack();p(Wr(Wr({},u),{},{selectedFont:void 0,selectedTextStyle:void 0})),g.current.goHome()}o.select()}}},Un.a.createElement(Wn.Ib,{color:i?"blue":"white"})))},panel:function(t){var e=t.ref,i=t.style,n=t.update;return o.selected?Un.a.createElement(qr.Provider,{value:u},Un.a.createElement(Ya,{ref:g,initialScreen:Mr.Typography,onStackUpdated:S,onNavigate:function(t){var e,i,o;i=(e=t).prev,o=e.next,v(i),i===Mr.TextStyle&&o!==Mr.FontsList&&u.changedStyle&&b(),n()},childRef:e},Un.a.createElement(Ps,{key:Mr.Typography,style:i,onHeightChanged:n}),Un.a.createElement(Bs,{key:Mr.FontsList,style:i,headerSlot:_,currentFontFamily:y}),Un.a.createElement(er,{key:Mr.FontUploader,style:i}),Un.a.createElement(Sr,{key:Mr.TextStylesList,style:i,onHeightChanged:n}),Un.a.createElement(Dr,{key:Mr.TextStyle,style:i,onHeightChanged:n}))):null}})},Yr=Fn.b.extend({name:"text_typography_new",component:Xr});function Zr(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Jr(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Jr(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jr(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Qr=Object(Vn.e)(Wn.m).withConfig({displayName:"ShotsSettings___StyledBox"})(["cursor:default;"]),tl=Object(Vn.e)(Wn.B).withConfig({displayName:"ShotsSettings___StyledFileInput"})(["cursor:",";"],(function(t){return t._css})),el=Object(Vn.e)(Wn.C).withConfig({displayName:"ShotsSettings___StyledFlex"})(["cursor:default;"]),il=Object(Vn.e)(Wn.zb).withConfig({displayName:"ShotsSettings___StyledText"})(["width:100%;&:hover{color:white;}"]),nl=Object(Vn.e)(Wn.m).withConfig({displayName:"ShotsSettings___StyledBox2"})(["text-align:",";"],(function(t){return t._css2})),ol=Object(Vn.e)(Wn.m).withConfig({displayName:"ShotsSettings___StyledBox3"})(["label{cursor:default;}"]),al=Object(Vn.e)(Wn.C).withConfig({displayName:"ShotsSettings___StyledFlex2"})(["border:1px solid rgba(64,64,64,0.08);&:hover{color:",";}"],(function(t){return t._css3})),sl=function(t){var e=Object(Nn.useContext)(Hn.BackboneContext).model,i=e.basePath,n=e.imageHeight,o=e.imageWidth,a=e.totalSize,s=e.numberOfImages,r=e._id,l=Object(Nn.useContext)(Hn.BackboneContext),c=(l.model,l.modelSet,l.modelSave,Object(Nn.useContext)(Fn.a).model),d=Zr(Object(Nn.useState)(!1),2),h=d[0],u=d[1],p=Zr(Object(Nn.useState)(!1),2),g=p[0],m=p[1],f=i&&n&&o&&a&&s,v=Zr(t.useSharedState(),2),b=v[0],_=b.isUploading,y=b.uploadError,w=v[1];Object(Nn.useEffect)((function(){y&&y.length&&setTimeout((function(){w({uploadError:""})}),4e3)}),[y]);var k=c&&c.page&&c.page.workspace&&c.page.workspace.controls&&c.page.workspace.controls.findControl("playback_settings");Object(Nn.useEffect)((function(){i&&n&&o&&s&&a&&"boolean"==typeof _&&!_&&!y&&k&&c&&c.selected&&k.master.select(k)}),[_]);var S=function(t){t.size<=St.a.UPLOAD_SHOTS_SIZE_LIMIT?w({videoFile:t,isUploading:!0}):(alert(St.a.MSG_UPLOAD_SHOTS_SIZE_ERROR),g&&m(!1))},x=Boolean(_||y||!i||!n||!o||!s||!a);return Un.a.createElement(ro,{control:function(t){var e=t.ref;return(Un.a.createElement(Yn,{ref:e,label:"Shots settings",onClick:function(t){t.preventDefault(),c.disabled||c.select()}},Un.a.createElement(Wn.kb,null)))},panel:function(t){var e=t.ref,i=t.style;return(Un.a.createElement(vo,{ref:e,style:i},x?Un.a.createElement(Qr,{p:"8px 8px ".concat(_?"21px":y?"0":"40px"),onDragLeaveCapture:function(t){var e=t&&t.relatedTarget;e&&e.classList&&e.classList.contains("workspace")&&m(!1)},onDragOver:function(t){m(!0)},userSelect:"none",width:"100%",height:"100%"},Un.a.createElement(tl,{onClick:function(t){_&&t.preventDefault()},id:"rm-shots-panel-main-file-upload-".concat(r),readFileData:!1,onChange:function(t){S(t)},dropFile:!_,accept:"video/*,.mkv",_css:_?"default":"pointer"},Un.a.createElement(el,{justifyContent:"space-between",flexDirection:y&&y.length?"column":"row",p:"0 8px 7px"},(!g||_)&&Un.a.createElement(Wn.zb,{fontSize:"regular",color:"black",lineHeight:"1.5"},_?f?"Replacing...":"Uploading...":f?"Replace shots":"Shots"),y&&y.length&&Un.a.createElement(Wn.m,{pt:"47px",pb:"12px"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"tomato",lineHeight:"1.5"},y)),!f&&!_&&!y&&!g&&Un.a.createElement(Wn.rb,{href:"https://help.readymag.com/hc/en-us/articles/360045455132",target:"_blank"},Un.a.createElement(Wn.hb,{color:"transparent",mr:0,size:24,hoverColor:"darkGray"},Un.a.createElement(il,{color:"gray",lineHeight:"1.5",textStyle:"small"},"?")))),_&&Un.a.createElement(Wn.C,{flexDirection:"column",pl:"8px",pt:"44px",cursor:"default"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"blue"},"It might take some time")),!_&&!y&&Un.a.createElement(nl,{position:"relative",top:g?"32px":"42px",height:"max-content",pl:g?0:"8px",pb:g?"44px":"20px",onMouseEnter:function(){u(!0)},onMouseLeave:function(){u(!1)},_css2:g?"center":"left"},Un.a.createElement(Wn.zb,{textStyle:"small",cursor:"pointer",color:h?"gray":"blue"},g?"Drop file here":h?"or drop media here":"Upload video")))):Un.a.createElement(ol,{userSelect:"none"},Un.a.createElement(Wn.B,{id:"rm-shots-panel-replace-file-upload-".concat(r),readFileData:!1,onChange:function(t){S(t)},dropFile:!0,onClick:function(t){t.preventDefault()},accept:"video/*,.mkv"},Un.a.createElement(Wn.C,{p:"8px 15px 40px",flexDirection:"column"},Un.a.createElement(Wn.m,{pb:"5px"},Un.a.createElement(Wn.zb,{fontSize:"regular",color:"black"},function(t){if(null!==t)return t.toString().split("").reverse().map((function(t,e){return 0!==e&&e%3==0?"".concat(t,"."):t})).reverse().join("")}(s)," shots loaded")),Un.a.createElement(Wn.C,{flexDirection:"column"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"darkGray"},o,"×",n," px"),Un.a.createElement(Wn.zb,{textStyle:"small",color:"darkGray"},function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";var i=1024,n=e<0?0:e,o=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],a=Math.floor(Math.log(t)/Math.log(i));return parseFloat((t/Math.pow(i,a)).toFixed(n))+" "+o[a]}(a)," total size")))),Un.a.createElement(Wn.C,{px:"15px",pb:"16px"},Un.a.createElement(Wn.B,{id:"rm-shots-button-replace-file-upload-".concat(r),readFileData:!1,dropFile:!0,onChange:function(t){S(t)},accept:"video/*,.mkv"},Un.a.createElement(al,{width:"136px",justifyContent:"center",alignItems:"center",height:"40px",bg:"transparent",borderRadius:"8px",cursor:"pointer",color:"darkGray",_css3:Wn.Rb.black},Un.a.createElement(Wn.zb,{textStyle:"small"},"Replace shots")))))))}})},rl=Fn.b.extend({name:"shots_settings",component:sl}),ll=i("saLn"),cl=i("fEUr");function dl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return hl(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return hl(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hl(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ul=Object(Vn.e)(Wn.C).withConfig({displayName:"StartPopup___StyledFlex"})(["box-shadow:0 0 0 1px rgba(0,0,0,0.0672);"]),pl=Object(Vn.e)(Wn.C).withConfig({displayName:"StartPopup___StyledFlex2"})(["cursor:pointer;line-height:24px;transition:all 0.1s ease-out;font-size:14px;&:hover:before{background:",";}&:before{content:'';position:absolute;top:8px;left:-28px;border-radius:100%;background:",";height:6px;width:6px;}"],(function(t){return t._css}),(function(t){return t._css2})),gl=Object(Vn.e)(Wn.m).withConfig({displayName:"StartPopup___StyledBox"})(["&:after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient( to right,rgba(61,61,61,0.18) 0%,rgba(61,61,61,0.18) 50%,transparent 50%,transparent 100% );background-size:2px 1px;background-position:0 100%;background-repeat:repeat-x;}"]),ml=Object(Vn.e)(Wn.C).withConfig({displayName:"StartPopup___StyledFlex3"})(["&:hover{color:tomato;}"]),fl=Object(Vn.e)(Wn.X).withConfig({displayName:"StartPopup___StyledNumericInput"})(["transition:all 0.1s ease-out;"]),vl=Object(Vn.e)(Wn.zb).withConfig({displayName:"StartPopup___StyledText"})(["transition:all 0.1s ease-out;"]),bl=Object(Vn.e)(Wn.C).withConfig({displayName:"StartPopup___StyledFlex4"})(["box-shadow:inset 0 0 0 1px #e5e5e5;"]),_l=Object(Vn.e)(Wn.m).withConfig({displayName:"StartPopup___StyledBox2"})(["background:linear-gradient(to right,#2c9672 0%,#2c9672 50%,transparent 50%,transparent 100%);background-size:2px 1px;background-position:0 100%;background-repeat:repeat-x;"]),yl=Object(Vn.e)(Wn.m).withConfig({displayName:"StartPopup___StyledBox3"})(["clip:rect(0,111px,6px,-99px);"]),wl=Object(Vn.e)(Wn.m).withConfig({displayName:"StartPopup___StyledBox4"})(["transform:rotate(45deg);"]),kl=function(t){var e=t.onEditScrollSettings,i=t.curOffset,n=t.curStartPoint,o=dl(Object(Nn.useState)(0),2),a=o[0],s=o[1],r=dl(Object(Nn.useState)(""),2),l=r[0],c=r[1],d=dl(Object(Nn.useState)(!1),2),h=d[0],u=d[1],p=Object(Nn.useRef)(null);Object(Nn.useEffect)((function(){n&&c(n),i&&s(i)}),[]);var g=63*{top:0,center:.5,bottom:1}[l],m=-63*a/window.innerHeight,f=Math.max(Math.min(g+m,63),0);return Un.a.createElement(ul,{position:"absolute",flexDirection:"column",alignItems:"center",bg:"white",zIndex:102,userSelect:"none",borderRadius:"3px",height:"222px",width:"120px",left:"24px",top:"31px",onClick:function(t){t.stopPropagation()}},Un.a.createElement(Wn.C,{flexDirection:"column",pt:"8px"},["top","center","bottom"].map((function(t,i){var n=l===t;return(Un.a.createElement(pl,{color:n?"#2c9672":"black",position:"relative",justifyContent:"center",key:i,onClick:function(){c(t),e({offset:a,selectedPoint:t===cl.c.bottom?cl.c.bottom:t===cl.c.center?cl.c.center:cl.c.top})},_css:n?"#2c9672":"rgba(182, 182, 188, 0.48)",_css2:n?"#2c9672":"transparent"},y.default.capitalize(t)))}))),Un.a.createElement(Wn.C,{width:"100%",flexDirection:"column",pt:"8px",ref:p,textAlign:"center"},Un.a.createElement(gl,{position:"relative",m:"0 8px",pt:"11px"},Un.a.createElement(Wn.zb,{fontSize:"14px",color:a>0||a<0?"tomato":"black"},"Offset")),Un.a.createElement(ml,{justifyContent:"center"},Un.a.createElement(fl,{step:1,value:a,autoWidth:!0,focusOnClick:!0,onChange:function(t){s(t),e({offset:t,selectedPoint:l===cl.c.bottom?cl.c.bottom:l===cl.c.center?cl.c.center:cl.c.top})},placeholder:"0",min:-9999,max:9999,labelRef:p,height:"24px",color:0!==a||h?"tomato":"rgba(68, 68, 76, 0.32)",fontSize:"22px",onMouseEnter:function(){u(!0)},onMouseLeave:function(){u(!1)}}),Un.a.createElement(vl,{onMouseEnter:function(){u(!0)},onMouseLeave:function(){u(!1)},fontSize:"22px",color:0!==a||h?"tomato":"rgba(68, 68, 76, 0.32)"},"px"))),Un.a.createElement(bl,{width:"104px",height:"64px",position:"relative",m:"7px auto 0"},Un.a.createElement(_l,{position:"absolute",left:"0",right:"0",height:"1px",top:g}),Un.a.createElement(Wn.m,{position:"absolute",left:"50%",width:"1px",bg:"tomato",top:Math.min(g,f),bottom:63-Math.max(g,f)}),Un.a.createElement(Wn.m,{position:"absolute",left:"0",right:"0",height:"1px",bg:"#2c9672",top:f})),Un.a.createElement(yl,{position:"absolute",left:"50%",width:"12px",height:"6px",top:"-6px",ml:"-6px"},Un.a.createElement(wl,{position:"absolute",width:"8px",height:"8px",left:"2px",top:"2px",bg:"white"})))};function Sl(t){return function(t){if(Array.isArray(t))return Ol(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Cl(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Cl(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cl(t,e){if(t){if("string"==typeof t)return Ol(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ol(t,e):void 0}}function Ol(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Pl=Object(Vn.e)(Wn.bb).withConfig({displayName:"PlaybackSettings___StyledPlaybackIcon"})(["padding-left:2px;"]),jl=Object(Vn.e)(Wn.m).withConfig({displayName:"PlaybackSettings___StyledBox"})({userSelect:"none"}),$l=Object(Vn.e)(Wn.m).withConfig({displayName:"PlaybackSettings___StyledBox2"})(["&:hover{*{color:",";}}"],(function(t){return t._css})),Tl=Object(Vn.e)(Wn.m).withConfig({displayName:"PlaybackSettings___StyledBox3"})(["&:hover{*{color:",";}}"],(function(t){return t._css2})),Il=Object(Vn.e)(Wn.m).withConfig({displayName:"PlaybackSettings___StyledBox4"})(["border-bottom-color:transparent;transition:background-color 0.1s;&:hover{background-color:#fff;border-bottom-left-radius:",";border-bottom-right-radius:",";}"],(function(t){return t._css3}),(function(t){return t._css4})),El=Object(Vn.e)(Wn.Db).withConfig({displayName:"PlaybackSettings___StyledTriangleIcon"})(["position:relative;top:2px;left:1px;"]),Ml=Object(Vn.e)(Wn.zb).withConfig({displayName:"PlaybackSettings___StyledText"})(["overflow:hidden;text-overflow:ellipsis;white-space:nowrap;&:hover{cursor:default;color:",";}"],(function(t){return t._css5})),Rl=Object(Vn.e)(Wn.zb).withConfig({displayName:"PlaybackSettings___StyledText2"})(["cursor:",";&:hover{opacity:1;}"],(function(t){return t._css6})),Al=Object(Vn.e)(Wn.zb).withConfig({displayName:"PlaybackSettings___StyledText3"})(["writing-mode:vertical-rl;text-orientation:mixed;"]),Dl=function(t){var e=xl(Object(Nn.useState)(!1),2),i=e[0],n=e[1],o=xl(Object(Nn.useState)(!1),2),a=o[0],s=o[1],r=xl(Object(Nn.useState)("none"),2),l=r[0],c=r[1],d=xl(Object(Nn.useState)(0),2),h=d[0],u=d[1],p=xl(Object(Nn.useState)(!1),2),g=p[0],m=p[1],f=Object(Nn.useRef)(null),v=Object(Nn.useRef)(null),b=Object(Nn.useContext)(Fn.a).model,_=Object(Nn.useContext)(Hn.BackboneContext),w=_.model,k=_.modelSet,S=_.modelSave,x=Object(Nn.useContext)(Hn.BackboneContext).model,C=x.playbackType,O=x.hoverDirection,j=x.triggers,$=x.scrollSpeed,T=x.scrollStartPoint,I=x._id,E=x.startPointOffset,M=x.scrollDelay,R=x.useEasing,A=xl(t.useSharedState(),1)[0].viewport,D=A===ve.a.Default,z=xl(Object(ll.a)((function(t){k(t),S()}),1e3),1)[0];Object(Nn.useEffect)((function(){b&&b.selected&&z(w)}),[C,O,j,$,T,E,M]);var L=C,B=O,F=j,N=$,U=T,H=E,V=M;Object(Nn.useEffect)((function(){var t=Math.min(84*M/window.innerHeight,84);u(t)}),[M]);var W=function(t){k({scrollStartPoint:t.selectedPoint}),k({startPointOffset:t.offset})};b.injectedRefs.canControlBeClosed=function(){return g?(m(!1),!0):"pending"===l};var G=Object(Nn.useRef)(null),q=function(t){k({triggers:[].concat(Sl(F||[]),[t])}),setTimeout((function(){c("none")}),0)};Object(Nn.useEffect)((function(){return"pending"===l&&P.a.enterPickTriggerMode(b.page.workspace,K,F,q),function(){P.a.leavePickTriggerMode(b.page.workspace)}}),[l]),Object(Nn.useEffect)((function(){D||O===cl.a.horizontally||k({hoverDirection:cl.a.horizontally})}),[A]);var K=Object(Nn.useMemo)((function(){return b.page.workspace.findBlock(w._id)}),[w._id]);return(Un.a.createElement(Un.a.Fragment,null,Un.a.createElement(ro,{control:function(t){var e=t.ref;return(Un.a.createElement(Yn,{ref:e,label:"Playback settings",onClick:function(t){t.preventDefault(),b.disabled||b.select()}},Un.a.createElement(Pl,null)))},panel:function(t){var e=t.ref,o=t.style;return(Un.a.createElement(vo,{ref:e,border:"none",style:o},Un.a.createElement(jl,null,Un.a.createElement(Wn.m,{position:"relative",zIndex:105},Un.a.createElement(cr,{container:G?G.current:void 0,isCleanVariant:!1,p:"10px 22px",width:"calc(100% + 6px + 6px)",listItems:[{title:Un.a.createElement($l,{_css:Object(bo.themeGet)("colors.tomato")},Un.a.createElement(Wn.zb,{color:L===cl.b.hover?"tomato":"black"},D?"Hover":"Touchmove")),onClick:function(){k({playbackType:cl.b.hover})}},{title:Un.a.createElement(Tl,{_css2:Object(bo.themeGet)("colors.tomato")},Un.a.createElement(Wn.zb,{color:L===cl.b.scroll?"tomato":"black"},"Scroll")),onClick:function(){k({playbackType:cl.b.scroll})}}]},(function(t){var e=t.toggleDropdown;return(Un.a.createElement(Il,{position:"relative",cursor:"pointer",bg:"lightGray",width:"100%",borderRadius:"8px 8px 0 0",p:"10px 18px 10px 16px",zIndex:102,border:"1px solid",borderColor:"lightGray",_css3:C===cl.b.hover?"8px":"0",_css4:C===cl.b.hover?"8px":"0"},Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between",onClick:e},Un.a.createElement(Wn.zb,{color:"tomato",fontSize:"regular"},D||C!==cl.b.hover?y.default.capitalize(C):"Touchmove"),Un.a.createElement(El,{color:"gray"}))))}))),L===cl.b.scroll?Un.a.createElement(Wn.m,{position:"relative"},g&&!w.fixed_position&&Un.a.createElement(kl,{curOffset:H,curStartPoint:U,onEditScrollSettings:W}),Un.a.createElement(Wn.m,{onClick:function(){g&&m(!1)}},w.fixed_position?Un.a.createElement(Wn.C,{flexDirection:"column",ref:v,position:"relative",textAlign:"center",height:"84px",bg:"#5f5f69"},Un.a.createElement(Wn.C,{position:"absolute",height:h,width:"100%",bg:"tomato",bottom:"0",left:"0"}),Un.a.createElement(Wn.m,{position:"relative",top:"10px",zIndex:100},Un.a.createElement(Wn.zb,{textStyle:"small",color:"white"},"Delay")),Un.a.createElement(Wn.C,{zIndex:100,pl:"36px",pt:"11px",justifyContent:"center",alignItems:"center"},Un.a.createElement(Wn.X,{step:1,value:V||0,autoWidth:!0,focusOnClick:!0,hideCursor:!0,onChange:function(t){k({scrollDelay:t})},labelRef:v,placeholder:"0",min:0,max:9999,height:"40px",color:"white",fontSize:"34px"}),Un.a.createElement(Wn.C,{position:"relative",top:"1px",left:"-1px"},Un.a.createElement(Wn.zb,{fontSize:"34px",lineHeight:"1",color:"white",opacity:"0.3"},"px")))):Un.a.createElement(Wn.C,{cursor:"pointer",pt:"12px",position:"relative",zIndex:101,flexDirection:"column",textAlign:"center",height:"68px",bg:"#2C9773",onClick:function(){return m(!g)}},Un.a.createElement(Wn.zb,{textStyle:"small",color:"white"},"Start Point"),Un.a.createElement(Wn.zb,{fontSize:"subheading",lineHeight:"1.05",color:"white"},y.default.capitalize(U))),Un.a.createElement(Wn.C,{flexDirection:"column",pt:"12px",textAlign:"center",height:"84px",ref:f,bg:"#4E4E56"},Un.a.createElement(Wn.zb,{textStyle:"small",color:"white"},"Speed"),Un.a.createElement(Wn.C,{pl:"27px",pt:"1px",justifyContent:"center",alignItems:"center"},Un.a.createElement(Wn.X,{step:.01,value:N||1,autoWidth:!0,focusOnClick:!0,hideCursor:!0,labelRef:f,mouseSpeed:5,onChange:function(t){k({scrollSpeed:t})},placeholder:"1",min:.1,max:999,height:"40px",color:"white",fontSize:"34px"}),Un.a.createElement(Wn.C,{position:"relative",top:"1px",left:"-3px"},Un.a.createElement(Wn.zb,{fontSize:"34px",lineHeight:"1",color:"white",opacity:"0.3"},"×")))))):Un.a.createElement(Wn.C,{flexDirection:"column"},Un.a.createElement(Wn.C,{flexDirection:"column",p:"0 0 12px"},F&&F.length>0&&F.map((function(t,e){var i=function(t){var e=b.page.workspace.findBlock(t);return I===t?"Self":e?e.model.get("name")||e.getStandardName():void 0}(t);return i&&Un.a.createElement(Wn.C,{p:"6px 30px 0 16px",key:e,mt:e>0?"4px":0,position:"relative"},Un.a.createElement(Ml,{textStyle:"small",color:"black",onMouseOver:function(){return P.a.highlightActiveTriggerBlock(b.page.workspace,K,t,!0)},onMouseOut:function(){return P.a.highlightActiveTriggerBlock(b.page.workspace,K,t,!1)},_css5:Wn.Rb.blue},i),Un.a.createElement(Wn.n,{position:"absolute",top:"7px",right:"18px",onMouseOver:function(){return P.a.highlightActiveTriggerBlock(b.page.workspace,K,t,!0,!0)},onMouseOut:function(){return P.a.highlightActiveTriggerBlock(b.page.workspace,K,t,!1,!0)},onClick:function(){return function(t){P.a.highlightActiveTriggerBlock(b.page.workspace,K,t,!1,!0),k({triggers:F&&F.filter((function(e){return e!==t}))})}(t)},display:"flex",height:16},Un.a.createElement(Wn.x,{color:"gray"})))})),F&&F.length<3&&Un.a.createElement(Wn.C,{p:"6px 30px 0 16px",mt:"4px",position:"relative"},Un.a.createElement(Rl,{onClick:function(){"none"===l&&c("pending")},textStyle:"small",opacity:"none"===l?"0.2":"1",color:"pending"===l?"blue":"black",_css6:"none"===l?"pointer":"default"},"none"===l?"Add":"Choose"," Trigger"),"pending"===l&&Un.a.createElement(Wn.n,{position:"absolute",top:"7px",right:"18px",onClick:function(){return c("none")},display:"flex",height:16},Un.a.createElement(Wn.x,{color:"gray"})))),Un.a.createElement(Wn.C,{justifyContent:"center",alignItems:"center",height:"68px",cursor:"pointer",bg:"horizontally"===B?"#2C9773":"#4E4E56",onClick:function(){k({hoverDirection:cl.a.horizontally})},onMouseEnter:function(){return s(!0)},onMouseLeave:function(){return s(!1)}},Un.a.createElement(Wn.zb,{fontSize:"subheading",color:"white",opacity:"horizontally"===B||a?1:.4},"Horizontal")),D&&Un.a.createElement(Wn.C,{justifyContent:"center",alignItems:"center",height:"168px",cursor:"pointer",bg:"vertically"===B?"#2C9773":"#4E4E56",onClick:function(){k({hoverDirection:cl.a.vertically})},onMouseEnter:function(){return n(!0)},onMouseLeave:function(){return n(!1)}},Un.a.createElement(Al,{fontSize:"subheading",color:"white",opacity:"vertically"===B||i?1:.4},"Vertical"))),Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center",px:3},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Easing")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.wb,{backgroundChecked:"tomato",checked:R,onChange:function(t){return k({useEasing:t})}}))))),Un.a.createElement(Wn.m,{ref:G})))}})))},zl=Fn.b.extend({name:"playback_settings",component:Dl});function Ll(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Bl(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ll(Object(i),!0).forEach((function(e){Fl(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ll(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Fl(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Nl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ul(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ul(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ul(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Hl=function(){var t=Nl(Object(Nn.useState)(!1),2),e=t[0],i=t[1],n=Object(Nn.useContext)(Hn.BackboneContext),o=n.model,a=n.modelSet,s=Object(Nn.useContext)(Fn.a).model,r=Object(Nn.useMemo)((function(){return o.columns||{count:1,gap:0}}),[o.columns]),l=function(t,e){a({columns:Bl(Bl({},r),{},Fl({},t,e))})};return Un.a.createElement(ro,{control:function(t){var n=t.ref;return(Un.a.createElement(Yn,{ref:n,label:"Columns",onMouseEnter:function(){i(!0)},onMouseLeave:function(){i(!1)},onClick:function(t){t.preventDefault(),s.disabled||s.select()}},Un.a.createElement(Wn.u,{color:e?"blue":"white"})))},panel:function(t){var e=t.ref,i=t.style;return s.selected?Un.a.createElement(vo,{ref:e,style:i,px:16,py:12},Un.a.createElement(Wn.m,{mb:24},Un.a.createElement(Wn.zb,{textStyle:"regular"},"Columns")),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between",mb:18},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.m,{width:100},Un.a.createElement(Wn.t,{value:r.count,columns:12,onChange:function(t){return l("count",t)}}))),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.X,{value:r.count,onChange:function(t){return l("count",t)},min:1,max:12,positive:!0,textAlign:"right"}))),Un.a.createElement(Wn.C,{alignItems:"center",justifyContent:"space-between"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Gap")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.X,{value:r.gap,onChange:function(t){return l("gap",t)},min:0,max:100,positive:!0,textAlign:"right"})))):null}})},Vl=Fn.b.extend({name:"text_columns_new",component:Hl});function Wl(){return(Wl=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function Gl(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}var ql=Object(Vn.e)(Wn.zb).withConfig({displayName:"Glyphs___StyledText"})(["font-family:",",sans-serif;font-weight:",";font-style:",";"],(function(t){return t._css}),(function(t){return t._css2}),(function(t){return t._css3})),Kl=Un.a.memo((function(t){var e=t.item,i=t.onSelect,n=t.fontFamily,o=t.fontWeight,a=t.fontStyle,s=String.fromCharCode(e);return Un.a.createElement(Wn.m,{textAlign:"center"},Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){return i(s)}},Un.a.createElement(ql,{"data-char":e,textStyle:"small",_css:n,_css2:o,_css3:a},s)))})),Xl=Un.a.memo((function(t){var e=t.items,i=Gl(t,["items"]);return(Un.a.createElement(Wn.H,{gridTemplateColumns:"repeat(6, 1fr)",gridRowGap:4},e.map((function(t,e){return Un.a.createElement(Kl,Wl({item:t,key:e},i))}))))})),Yl=function(t){return Un.a.createElement(Wn.ib,null,(function(e){var i=e.ref;return(Un.a.createElement(Wn.m,{ref:i,px:2,py:2},Un.a.createElement(Xl,t)))}))},Zl=Un.a.memo(Yl);function Jl(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return Ql(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Ql(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ql(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var tc=[{name:"No-break space",char:String.fromCharCode(160)},{name:"Narrow no-break space",char:String.fromCharCode(8239)},{name:"Figure space",char:String.fromCharCode(8199)},{name:"Word joiner",char:String.fromCharCode(8288)}],ec=function(t,e){var i=t.style,n=Object(Nn.useContext)(Hn.BackboneContext).model,o=Jl(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(n._id)}),[n._id])(),2),a=o[0],s=o[1],r=Jl(Object(Nn.useState)([]),2),l=r[0],c=r[1],d=Object(Nn.useMemo)((function(){return Object(zo.d)(a,zo.b.FontFamily)[0]||Ca.b.fontFamily}),[a]),h=Object(Nn.useMemo)((function(){return Object(zo.d)(a,zo.b.FontWeight)[0]||Ca.b.fontWeight}),[a]),u=Object(Nn.useMemo)((function(){return Object(zo.d)(a,zo.b.FontStyle)[0]||Ca.b.fontStyle}),[a]);Object(Nn.useEffect)((function(){d&&h&&u&&Object(Sa.a)({fontFamily:d,fontWeight:h,fontStyle:u}).then((function(t){var e=t.characters;c(e&&e.length?e:[])})).catch((function(t){c([])}))}),[d,h,u]);var p=function(t){s(Object(Do.p)(a,t))};return(Un.a.createElement(vo,{ref:e,style:i,pt:"6px"},Un.a.createElement(Wn.m,{mb:12,px:16},Un.a.createElement(Wn.zb,{textStyle:"regular"},"Insert")),Un.a.createElement(Wn.a,{dynamicHeight:!0},Un.a.createElement(Wn.r,{renderButton:function(t){var e=t.isActive;return(Un.a.createElement(Wn.m,{px:16},Un.a.createElement(xo,{small:!0,showBorderTop:!1,showBorderBottom:!e},Un.a.createElement(Wn.n,{variant:"clean"},Un.a.createElement(Wn.zb,{textStyle:"small",color:e?"black":"gray"},"Glyphs")))))},open:!0},(function(t){return Un.a.createElement(Wn.m,{ref:t,bg:"white",borderRadius:"0 0 8px 8px",height:320},Un.a.createElement(Zl,{items:l,onSelect:p,fontFamily:d,fontWeight:h,fontStyle:u}))})),Un.a.createElement(Wn.r,{renderButton:function(t){var e=t.isActive;return(Un.a.createElement(Wn.m,{px:3},Un.a.createElement(xo,{small:!0,showBorderTop:!1,showBorderBottom:!1},Un.a.createElement(Wn.n,{variant:"clean"},Un.a.createElement(Wn.zb,{textStyle:"small",color:e?"black":"gray"},"Space")))))}},(function(t){return Un.a.createElement(Wn.m,{ref:t,bg:"white",py:2,px:3,borderRadius:"0 0 8px 8px"},tc.map((function(t,e){var i=e===tc.length-1;return(Un.a.createElement(Wn.m,{key:e,pb:i?void 0:"10px",mb:i?void 0:2,borderBottom:"1px solid",borderColor:i?"transparent":"lightGray"},Un.a.createElement(Wn.n,{variant:"clean",onClick:function(){return p(t.char)}},Un.a.createElement(Wn.zb,{textStyle:"small"},t.name))))})))})))))},ic=Un.a.forwardRef(ec);function nc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return oc(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return oc(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oc(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var ac,sc=Object(Vn.e)(Wn.xb).withConfig({displayName:"TextInsert___StyledSymbolIcon"})(["position:relative;left:-1px;"]),rc=function(){var t=Object(Nn.useContext)(Fn.a).model,e=nc(Object(Nn.useState)(!1),2),i=e[0],n=e[1];return Un.a.createElement(ro,{control:function(e){var o=e.ref;return(Un.a.createElement(Yn,{ref:o,label:"Insert",onMouseEnter:function(){n(!0)},onMouseLeave:function(){n(!1)},onClick:function(e){e.preventDefault(),t.disabled||t.select()}},Un.a.createElement(sc,{color:i?"blue":"white"})))},panel:function(e){var i=e.ref,n=e.style;return t.selected?Un.a.createElement(ic,{ref:i,style:n}):null}})},lc=Fn.b.extend({name:"text_insert",component:rc}),cc=i("uU7u");function dc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function hc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?dc(Object(i),!0).forEach((function(e){bc(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):dc(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function uc(t){return function(t){if(Array.isArray(t))return vc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||fc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pc(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function gc(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){pc(a,n,o,s,r,"next",t)}function r(t){pc(a,n,o,s,r,"throw",t)}s(void 0)}))}}function mc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||fc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fc(t,e){if(t){if("string"==typeof t)return vc(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?vc(t,e):void 0}}function vc(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function bc(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var _c,yc=(bc(ac={},cc.a.URL,"Website URL"),bc(ac,cc.a.ScrollToTop,"Scroll to top"),bc(ac,cc.a.GoBack,"Go back"),bc(ac,cc.a.Anchor,"Anchor"),bc(ac,cc.a.Email,"Email"),bc(ac,cc.a.Page,"Go to page"),bc(ac,cc.a.Phone,"Phone number"),ac);!function(t){t[t.Project=0]="Project",t[t.Global=1]="Global"}(_c||(_c={}));var wc=Object(Vn.e)(Wn.m).withConfig({displayName:"TextLink___StyledBox"})(["transform:translateY(-50%);"]),kc=Object(Vn.e)(Wn.n).withConfig({displayName:"TextLink___StyledButton"})(["display:block;"]),Sc=Object(Vn.e)(Wn.I).withConfig({displayName:"TextLink___StyledInlineInput"})(["box-sizing:border-box;background-color:white;border-radius:8px;"]),xc=Object(Vn.e)(Wn.m).withConfig({displayName:"TextLink___StyledBox2"})(["transform:translateY(-50%);"]),Cc=Object(Vn.e)(Wn.hb).withConfig({displayName:"TextLink___StyledRoundButton"})(["display:block;transform:rotate(-90deg);"]),Oc=Object(Vn.e)(Wn.Db).withConfig({displayName:"TextLink___StyledTriangleIcon"})(["display:inline;"]),Pc=Object(Vn.e)(Wn.m).withConfig({displayName:"TextLink___StyledBox3"})(["",""],(function(t){return t._css})),jc=Object(Vn.e)(Wn.C).withConfig({displayName:"TextLink___StyledFlex"})(["white-space:nowrap;"]),$c=Object(Vn.e)(Wn.zb).withConfig({displayName:"TextLink___StyledText"})(["pointer-events:none;"]),Tc=Object(Vn.e)(Wn.n).withConfig({displayName:"TextLink___StyledButton2"})(["vertical-align:middle;"]),Ic=function(t,e){var i,n=t.style,o=Object(Nn.useContext)(Ka).navigate,a=Object(Nn.useContext)(Hn.BackboneContext).model,s=Object(Nn.useContext)(ed),r=s.setSelectedStyle,l=s.currentTab,c=s.setCurrentTab,d=Object(Nn.useContext)(Fn.a),h=d.model,u=d.modelSet,p=Object(Nn.useMemo)((function(){return h.project.get("_id")}),[h]),g=Object(Nn.useMemo)((function(){return h.user.get("_id")}),[h]),m=window.RM.constructorRouter,f=m.mag,v=m.getCurrentPageId,b=Object(Nn.useMemo)((function(){return v()}),[]),_=mc(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(a._id)}),[a._id])(),2),w=_[0],k=_[1],S=mc(Object(Nn.useState)(""),2),x=S[0],C=S[1],O=mc(Object(Nn.useState)(""),2),P=O[0],j=O[1],$=mc(Object(Nn.useState)(!1),2),T=$[0],I=$[1],E=mc(Object(Nn.useState)(!1),2),M=E[0],R=E[1],A=mc(Object(Nn.useState)(!1),2),D=A[0],z=A[1],L=mc(Object(Nn.useState)(0),2),B=L[0],F=L[1],N=mc(Object(Nn.useState)(null),2),U=N[0],H=N[1],V=Object(Nn.useRef)(null),W=(bc(i={},cc.a.URL,(function(t){return/^http(s?)\:\/\//i.test(t)||/^[\da-z\.-]+\.[a-z-]{2,}.*/i.test(t)})),bc(i,cc.a.ScrollToTop,(function(t){return/^(back|scroll)\sto\stop$/i.test(t)})),bc(i,cc.a.GoBack,(function(t){return/^(__rm_goback|go\sback)$/i.test(t)})),bc(i,cc.a.Anchor,(function(t){return/^(__rm_anchor|\d+px)$/i.test(t)})),bc(i,cc.a.Email,(function(t){return y.default.isValidEmailLink(t)})),bc(i,cc.a.Page,(function(t){return!!f.getPageId(t)})),bc(i,cc.a.Phone,(function(t){return/\+(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{1,14}$/i.test(t)})),i),G=function(t){return t?Object.keys(W).reduce((function(e,i){if(null===e){var n=i;return W[n](t)?n:null}return e}),null):null};Object(Nn.useEffect)((function(){var t=Object(cc.c)(w);t?(C(t.url),H(t.type),R("_blank"===t.target),at(t.linkStyle||cc.b.name),"number"==typeof t.anchorPosition&&F(t.anchorPosition),t.pageId&&t.type===cc.a.Page&&j(t.pageId),I(t.url?!(!t.url||!t.type):Y.includes(t.type))):t||(C(""),at(null),H(null),I(!1),j(""),R(!1))}),[w]),Object(Nn.useEffect)((function(){if(U===cc.a.Page&&x&&W[cc.a.Page](x)){var t=f.getPageId(x);t&&t!==P&&j(t)}}),[x,U,P]);var q,K=(q=cc.a,Object.keys(q).filter((function(t){return"number"!=typeof t||!Number.isInteger(t)})).map((function(t){return q[t]}))).map((function(t){return{label:yc[t],value:t}})),X=Object(Nn.useMemo)((function(){return null!==U?yc[U]:"URL, page number..."}),[U]),Y=[cc.a.GoBack,cc.a.ScrollToTop,cc.a.Email],Z=Object(Nn.useMemo)((function(){return null!==U&&(x.length?G(x)===U:Y.includes(U))}),[x,U]),J=Boolean(T&&U);Object(Nn.useEffect)((function(){if(T&&Z&&U){var t=U===cc.a.Anchor?b:U===cc.a.Page?P:void 0;k(Object(cc.g)({editorState:w,url:x,anchorPosition:B,pageId:t,type:U,target:M?"_blank":"_self",linkStyle:ot||void 0}))}}),[Z,T,x,U,B,M]);var Q=document.querySelector("#main"),tt=mc(Object(Nn.useState)(null),2),et=tt[0],it=tt[1],nt=mc(Object(Nn.useState)(null),2),ot=nt[0],at=nt[1],st=mc(Object(Ao.useLinkStylesStore)(),2),rt=st[0],lt=st[1],ct=Object(Nn.useMemo)((function(){return l===_c.Project?rt.project:rt.global}),[rt,l]),dt=function(){var t=gc(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=uc(ct),(n=i.findIndex((function(t){return t.name===e.name})))>-1&&i.splice(n,0,hc(hc({},e),{},{name:"link-style-".concat(nr()()),label:"".concat(e.label," (Copy)")})),t.next=5,lt(hc(hc({},rt),{},bc({},l===_c.Global?"global":"project",i)));case 5:if(l!==_c.Global){t.next=10;break}return t.next=8,Object(Bo.K)({userId:g,styles:i});case 8:t.next=12;break;case 10:return t.next=12,Object(Bo.H)({projectId:p,styles:i});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ht=function(){var t=gc(regeneratorRuntime.mark((function t(e){var i,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=uc(ct),(n=i.findIndex((function(t){return t.name===e.name})))>-1&&i.splice(n,1),t.next=5,lt(hc(hc({},rt),{},bc({},l===_c.Global?"global":"project",i)));case 5:if(l!==_c.Global){t.next=10;break}return t.next=8,Object(Bo.K)({userId:g,styles:i});case 8:t.next=12;break;case 10:return t.next=12,Object(Bo.H)({projectId:p,styles:i});case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Un.a.createElement(Un.a.Fragment,null,U===cc.a.Anchor&&h.selected&&Un.a.createElement(Wn.g,{container:Q,isVisible:U===cc.a.Anchor,isActive:D,value:B,considerScroll:!0,onChange:function(t){F(t),C("".concat(t,"px")),z(!1),I(!0),u({preventClose:!1})}}),Un.a.createElement(vo,{ref:e,style:n,pt:"6px"},Un.a.createElement(Wn.m,{mb:12,px:16},Un.a.createElement(Wn.zb,{textStyle:"regular"},"Link")),Un.a.createElement(Wn.m,{mb:T&&U&&!Y.includes(U)&&U!==cc.a.Anchor?"0":12,px:2},Un.a.createElement(Wn.m,{ref:V}),Un.a.createElement(Ro,{container:V&&V.current,items:K,value:null!==U?U:void 0,onSelect:function(t){var e=t.value;Y.includes(e)&&I(!0),H(e);var i=e===cc.a.Anchor;setTimeout((function(){z(i),u({preventClose:i})}),0)}},(function(t){var e=t.toggleDropdown;return(Un.a.createElement(Wn.m,{position:"relative"},U===cc.a.Anchor&&Un.a.createElement(wc,{ml:12,position:"absolute",top:"50%",left:0},Un.a.createElement(kc,{onClick:function(){setTimeout((function(){z(!0),u({preventClose:!0})}),0)}},Un.a.createElement(Wn.kb,{color:"gray"}))),Un.a.createElement(Sc,{textStyle:"small",p:"0 28px 0 ".concat(U===cc.a.Anchor?"36px":"8px"),border:"none !important",height:40,value:x,placeholder:X,onChange:function(t){var e=t.target.value;C(e);var i=G(e);H(i),i===cc.a.Anchor&&F(parseInt(e))},onBlur:function(){!x&&T&&U&&!Y.includes(U)&&I(!1)}}),Un.a.createElement(xc,{position:"absolute",top:"50%",right:0},Z?J?Un.a.createElement(Wn.m,{mr:14},Un.a.createElement(Wn.n,{onClick:function(){I(!1),C(""),H(null),k(Object(cc.f)(w))},variant:"clean"},Un.a.createElement(Wn.x,{color:"gray"}))):Un.a.createElement(Wn.m,{mr:1},Un.a.createElement(Cc,{size:24,onClick:function(){return I(!0)},color:"gray",hoverColor:"blue"},Un.a.createElement(Oc,{color:"white"}))):Un.a.createElement(Wn.m,{mr:14},Un.a.createElement(Wn.n,{onClick:e,variant:"clean"},Un.a.createElement(Wn.Db,{color:"gray"}))))))}))),T?Un.a.createElement(Un.a.Fragment,null,U&&!Y.includes(U)&&U!==cc.a.Anchor?Un.a.createElement(Wn.m,{px:16,mb:2},Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Open in tab")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.wb,{checked:M,backgroundChecked:"black",onChange:function(){return R(!M)}}))))):null,Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.m,{px:16},Un.a.createElement(Wn.yb,{items:[{title:"Project"},{title:"Global"}],activeIndex:l,onChange:c,borderColor:"rgba(184, 184, 184, 0.24)",textStyle:{textStyle:"small"}})),Un.a.createElement(Wn.m,{maxHeight:180},Un.a.createElement(Wn.ib,null,(function(t){var e=t.ref;return(Un.a.createElement(Wn.m,{ref:e},(ct||[]).map((function(t,e){var i=ot?ot===t.name:t.name===cc.b.name;return(Un.a.createElement(cr,{container:V?V.current:void 0,key:e,listItems:[{title:"Edit",onClick:function(){!function(t){r(t),o(Hc.EditStyle)}(t)}},{title:"Duplicate",onClick:function(){dt(t)}},{title:"Delete",onClick:function(){ht(t)}}]},(function(n){var o=n.toggleDropdown;return(Un.a.createElement(Pc,{position:"relative",onMouseEnter:function(){return it(e)},onMouseLeave:function(){return it(null)},cursor:"pointer",_css:"user-select: none"},Un.a.createElement(Wn.m,{bg:i?"gray":"blue",opacity:et===e||i?.2:0,position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0}),Un.a.createElement(Wn.C,{px:16,py:"8px",justifyContent:"space-between",alignItems:"center",position:"relative"},Un.a.createElement(jc,{width:"100%",maxWidth:108,overflow:"hidden",onClick:function(){return function(t){U&&k(Object(cc.g)({editorState:w,url:x,anchorPosition:B,pageId:U===cc.a.Anchor?b:U===cc.a.Page?P:void 0,type:U,target:M?"_blank":"_self",linkStyle:t.name}))}(t)}},Un.a.createElement($c,{textStyle:"small",className:t.name},t.label)),et===e?Un.a.createElement(Wn.n,{height:16,onClick:o,variant:"clean"},Un.a.createElement(Wn.Eb,{color:"black"})):void 0)))})))}))))}))),Un.a.createElement(Wn.m,{px:16},Un.a.createElement(xo,{showBorderBottom:!1,small:!0},Un.a.createElement(Wn.m,{width:"100%",textAlign:"center"},Un.a.createElement(Tc,{onClick:function(){r(void 0),o(Hc.EditStyle)},variant:"clean",height:18},Un.a.createElement(Wn.db,{color:"black"}))))))):null))},Ec=Un.a.forwardRef(Ic),Mc=i("8RDp");function Rc(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function Ac(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){Rc(a,n,o,s,r,"next",t)}function r(t){Rc(a,n,o,s,r,"throw",t)}s(void 0)}))}}function Dc(t){return function(t){if(Array.isArray(t))return Uc(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Nc(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Lc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?zc(Object(i),!0).forEach((function(e){Bc(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):zc(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Bc(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Fc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||Nc(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nc(t,e){if(t){if("string"==typeof t)return Uc(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Uc(t,e):void 0}}function Uc(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var Hc,Vc=Object(Vn.e)(Wn.C).withConfig({displayName:"TextLinkStyle___StyledFlex"})(["&:hover{opacity:0.8;}"]),Wc=function(t){var e=t.type,i=t.size;return(Un.a.createElement(Vc,{width:"100%",height:16,alignItems:"center",justifyContent:"center",cursor:"pointer"},Un.a.createElement(Mc.a,{type:e,size:i})))},Gc=Object(Vn.e)(Wn.zb).withConfig({displayName:"TextLinkStyle___StyledText"})(["display:block;"]),qc=Object(Vn.e)(Wn.zb).withConfig({displayName:"TextLinkStyle___StyledText2"})(["white-space:nowrap;"]),Kc=function(t,e){var i=t.style,n=Object(Nn.useContext)(Ka).goBack,a=[{title:"None",onClick:function(){return L(sa.a.None)}},{title:Un.a.createElement(Wc,{size:2,type:sa.a.Solid}),onClick:function(){return L(sa.a.Solid)}},{title:Un.a.createElement(Wc,{size:2,type:sa.a.Dotted}),onClick:function(){return L(sa.a.Dotted)}},{title:Un.a.createElement(Wc,{size:2,type:sa.a.Dashed}),onClick:function(){return L(sa.a.Dashed)}}],s=Object(Nn.useContext)(Fn.a).model,r=Object(Nn.useMemo)((function(){return s.project.get("num_id")}),[s]),l=Object(Nn.useMemo)((function(){return s.project.get("_id")}),[s]),c=Object(Nn.useMemo)((function(){return s.user.get("_id")}),[s]),d=Object(Nn.useRef)(null),h=Object(Nn.useContext)(Hn.BackboneContext).model,u=Fc(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(h._id)}),[h._id])(),1)[0],p=Fc(Object(Nn.useState)(null),2),g=p[0],m=p[1];Object(Nn.useEffect)((function(){var t=Object(cc.c)(u);m(t&&t.type||null)}),[u]);var f=Object(Nn.useMemo)((function(){var t=h.is_global,e=s.workspace&&s.workspace.block&&s.workspace.block.model&&s.workspace.block.model.get("is_global");return Boolean(t||e)&&g===cc.a.Page}),[h,s.workspace,g]),v=Object(Nn.useContext)(ed),b=v.selectedStyle,_=(v.setSelectedStyle,v.currentTab),y=Fc(Object(Nn.useState)(),2),w=y[0],k=y[1],S=Fc(Object(Nn.useState)(b?b.name:"link-style-".concat(nr()())),1)[0],x=Fc(Object(Nn.useState)(b?b.label:""),2),C=x[0],O=x[1],P=Fc(Object(Nn.useState)(Ko),2),j=P[0],$=P[1],T=Fc(Object(Nn.useState)(Ko),2),I=T[0],E=T[1],M=Fc(Object(Nn.useState)(1),2),R=M[0],A=M[1],D=Fc(Object(Nn.useState)(sa.a.None),2),z=D[0],L=D[1],B=Fc(Object(Nn.useState)(0),2),F=B[0],N=B[1],U=Fc(Object(Nn.useState)(0),2),H=U[0],V=U[1],W=Object(Nn.useMemo)((function(){var t=[{title:"Link"},{title:"Hover"}];return f?[].concat(t,[{title:"Current"}]):t}),[f]),G=Fc(Object(Nn.useState)(!b),2),q=G[0],K=G[1],X=z===sa.a.None,Y=Fc(Object(Ao.useLinkStylesStore)(),2),Z=Y[0],J=Y[1],Q=_===_c.Global?Z.global:Z.project;Object(Nn.useEffect)((function(){var t=W[H]&&W[H].title&&W[H].title.toLowerCase(),e=w||b;if(e&&t){var i=e.style[t];i&&($(i.textColor?Object(Lo.d)(i.textColor):Ko),E(i.color?Object(Lo.d)(i.color):Ko),L(i.type||sa.a.None),A(i.size||1),N(i.padding||0))}}),[w,b,H]);var tt=Object(Nn.useMemo)((function(){var t={padding:F,size:R,type:z,color:I?Object(Lo.g)(I):"",textColor:j?Object(Lo.g)(j):""};return Lc(Lc({},w||b||{}),{},{name:S,label:C,style:{link:Lc(Lc({},w?w.style.link:b?b.style.link:{}),0===H?t:{}),hover:Lc(Lc({},w?w.style.hover:b?b.style.hover:{}),1===H?t:{}),current:Lc(Lc({},w?w.style.current:b?b.style.current:{}),2===H?t:{})}})}),[w,b,C,S,F,R,z,I,j]),et=Object(Nn.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Dc(Q),i=e.findIndex((function(t){return t.name===S}));return i>-1?(e[i]=tt,J(Lc(Lc({},Z),{},Bc({},_===_c.Global?"global":"project",e)))):t||(e.push(tt),J(Lc(Lc({},Z),{},Bc({},_===_c.Global?"global":"project",e)))),b||o.a.isEqual(tt,w)||k(tt),e}),[b,w,tt,S,Q]);Object(Nn.useEffect)((function(){if(tt){et(!0);var t=!o.a.isEqual(b,tt);t!==q&&K(t)}}),[b,tt,q]);var it=Object(Nn.useCallback)(Ac(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=et(),_!==_c.Global){t.next=6;break}return t.next=4,Object(Bo.K)({userId:c,styles:e});case 4:t.next=8;break;case 6:return t.next=8,Object(Bo.H)({projectId:l,styles:e});case 8:case"end":return t.stop()}}),t)}))),[Q,tt]),nt=Object(Nn.useCallback)((function(){if(q&&b){var t=Dc(Q),e=t.findIndex((function(t){return t.name===S}));e>-1&&(t[e]=b,J(Lc(Lc({},Z),{},Bc({},_===_c.Global?"global":"project",t))))}}),[b,q]);return Un.a.createElement(vo,{ref:e,style:i},Un.a.createElement(Wn.m,{px:16},Un.a.createElement(Wn.m,{mb:"7px"},Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.I,{textStyle:"regular",value:C,onChange:function(t){return O(t.target.value)},p:0,border:"none !important",placeholder:"Style Name"}))),Un.a.createElement(Wn.m,{position:"relative",zIndex:0},Un.a.createElement(Wn.yb,{items:W,activeIndex:H,onChange:V,textStyle:{textStyle:"small"}})),Un.a.createElement(Ta,{showBorderTop:!1,small:!0,title:"Text color",projectNumId:r,userId:c,color:j,setColor:$,onChangeComplete:function(t){Object(Lo.g)(t)}}),Un.a.createElement(Wn.m,{ref:d}),Un.a.createElement(cr,{listItems:a,container:d?d.current:void 0},(function(t){var e=t.toggleDropdown;return(Un.a.createElement(xo,{showBorderTop:!1,small:!0},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Underline")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.n,{onClick:e,variant:"clean",width:46},X?Un.a.createElement(Gc,{textStyle:"small"},"None"):Un.a.createElement(Wc,{size:2,type:z}))))))})),Un.a.createElement(Ta,{disabled:X,showBorderTop:!1,small:!0,title:"Underline color",projectNumId:r,userId:c,color:I,setColor:E,onChangeComplete:function(t){Object(Lo.g)(t)}}),Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!0,small:!0,disabled:X},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(qc,{textStyle:"small"},"Underline width")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.X,{min:1,max:99,value:R,positive:!0,textAlign:"right",onChange:function(t){A(t)}})))),Un.a.createElement(xo,{showBorderTop:!1,showBorderBottom:!0,small:!0,disabled:X},Un.a.createElement(Wn.C,{justifyContent:"space-between",alignItems:"center"},Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.zb,{textStyle:"small"},"Padding")),Un.a.createElement(Wn.m,null,Un.a.createElement(Wn.X,{min:-99,max:99,value:F,textAlign:"right",onChange:function(t){N(t)}})))),Un.a.createElement(Us,{cancelAction:Ac(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,nt();case 2:n();case 3:case"end":return t.stop()}}),t)}))),doneDisabled:!q,doneAction:Ac(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,it();case 2:n();case 3:case"end":return t.stop()}}),t)})))})))},Xc=Un.a.forwardRef(Kc);function Yc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Zc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Yc(Object(i),!0).forEach((function(e){Jc(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Yc(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Jc(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Qc(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return td(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return td(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function td(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}!function(t){t.EditInfo="EditInfo",t.EditStyle="EditStyle"}(Hc||(Hc={}));var ed=Un.a.createContext({}),id=function(){var t=Qc(Object(Nn.useState)(!1),2),e=t[0],i=t[1],n=Object(Nn.useContext)(Hn.BackboneContext).model,o=Object(Nn.useContext)(Fn.a).model,a=Qc(Object(Nn.useMemo)((function(){return Object(Ao.useTextWidgetStore)(n._id)}),[n._id])(),1)[0],s=Object(cc.c)(a),r=Qc(Object(Nn.useState)({currentTab:_c.Project}),2),l=r[0],c=r[1],d=Object(Nn.useCallback)((function(t){return c(Zc(Zc({},l),{},{selectedStyle:t}))}),[l]),h=Object(Nn.useCallback)((function(t){return c(Zc(Zc({},l),{},{currentTab:t}))}),[l]),u=Object(Nn.useRef)(),p=Za(u.current),g=p.canControlBeClosed,m=p.onStackUpdated;return o.injectedRefs.canControlBeClosed=g,Un.a.createElement(ro,{control:function(t){var n=t.ref;return(Un.a.createElement(Yn,{ref:n,label:"Link",onMouseEnter:function(){i(!0)},onMouseLeave:function(){i(!1)},onClick:function(t){if(t.preventDefault(),!o.disabled){if(u.current&&u.current.currentScreen!==Hc.EditInfo){if(o.selected)return void u.current.goBack();c(Zc(Zc({},l),{},{selectedStyle:void 0})),u.current.goHome()}o.select()}}},Un.a.createElement(Wn.O,{color:e||s?"blue":"white"})))},panel:function(t){var e=t.ref,i=t.style,n=t.update;return o.selected?Un.a.createElement(ed.Provider,{value:Zc(Zc({},l),{},{setSelectedStyle:d,setCurrentTab:h})},Un.a.createElement(Ya,{ref:u,initialScreen:Hc.EditInfo,onStackUpdated:m,onNavigate:function(){n()},childRef:e},Un.a.createElement(Ec,{key:Hc.EditInfo,style:i}),Un.a.createElement(Xc,{key:Hc.EditStyle,style:i}))):null}})},nd=Fn.b.extend({name:"text_link_new",component:id}),od=e.default={common_layer:l,common_align:h,common_animation:D,common_pack:F,common_unpack:H,common_rotation:fe,common_position:we,text_styles:Oe,text_typography:$e,text_bius:Ee,text_align:Ae,text_autosize:Le,anchor_picker:Ne,text_link:Ve,text_color:qe,text_columns:Ye,text_edit:Qe,picture_crop:ni,picture_fwpos:ri,picture_link:li,picture_color:hi,picture_settings:ui,slideshow_manager:mi,shape_color:bi,shape_settings:_i,shape_1x1:ki,shape_icon:Ci,gmaps_edit:ji,gmaps_settings:$i,common_lock:Ei,button_edit:Ai,button_settings:Di,button_icon:Fi,hotspot_add:Vi,hotspot_pin_settings:Ki,hotspot_tip_settings:Zi,form_content:dn,form_endpoints:gn,form_styles:vn,video_settings:bn,audio_settings:_n,twitter_settings:yn,facebook_settings:wn,iframe_edit:kn,cart_connections:Sn,cart_settings:xn,cart_add_product_widget:$n,product_selector:Tn,add_to_cart_settings:In,slideshow_settings:En,slideshow_transitions:Mn,picture_preview:zn,picture_alt:Ln,rmheader_settings:Bn,text_color_new:oa,text_align_new:wa,text_advanced_typography:Ha,text_typography_new:Yr,shots_settings:rl,playback_settings:zl,text_columns_new:Vl,text_insert:lc,text_link_new:nd}},hdsW:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW");i("eN9J"),i("l2W4");var r=window.SC,l=window.soundcloud;delete window.SC,delete window.soundcloud;var c=i("tZHv"),d=i("gobI"),h=i("csmR"),u=i.n(h),p=i("QNiq"),g=i("Vxjr"),m=a.a.View.extend({initialize:function(t,e,i){s.a.bindAll(this),this.params=t,this.$container=e,this.readyCallback=i||function(){},!Object(s.a)(["standard","visual"]).contains(t.current_type)&&!Modernizr.opera||Modernizr.msie?this.player=new v(t,e,i,this):this.player=new f(t,e,i,this),this.render()},render:function(){this.player&&this.player.render()},show:function(){this.player&&this.player.show()},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},applyPlayerStyle:function(t){this.player&&this.player.applyPlayerStyle&&this.player.applyPlayerStyle(t)},destroy:function(){this.player&&(this.player.isDestroyed=!0,this.player&&this.player.destroy(),this.player=null)}}),f=a.a.View.extend({initialize:function(t,e,i,n){s.a.bindAll(this),this.inner_template=u.a["template-common-audio-player-standard"],this.parent=n,this.params=t,this.$container=e,this.readyCallback=i||function(){}},render:function(){var t=[];t.push("auto_play=false"),t.push("buying="+this.params.socials),t.push("liking="+this.params.socials),t.push("download="+this.params.socials),t.push("sharing="+this.params.socials),t.push("show_artwork="+this.params.artwork),t.push("show_comments="+this.params.comments),t.push("show_playcount="+this.params.playcount),t.push("color="+this.params.color),t.push("auto_advance=true"),t.push("show_user=true"),"visual"==this.params.current_type&&t.push("visual=true"),this.params.parsed_url=this.params.parsed_url.replace(/^http:/,"https:");var e=this.params.parsed_url+"&"+t.join("&");this.setElement(Object(n.a)(this.inner_template({src:e}))),this.$container.append(this.$el),this.player=r.Widget(this.$el[0]),this.player.bind("ready",s.a.bind((function(){setTimeout(s.a.bind((function(){this.readyCallback(this.parent)}),this),500)}),this)),setTimeout(s.a.bind((function(){this.readyCallback(this.parent)}),this),2e3)},show:function(){this.$el&&this.$el.css("opacity",1)},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},destroy:function(){this.player.unbind("ready"),this.$el&&this.$el.remove(),this.player=null}}),v=a.a.View.extend({apiKey:c.a.SOUNDCLOUD_API,defaultCover:Object(g.findImagePath)("./common/audio-player/cover.png"),initialize:function(t,e,i,n){s.a.bindAll(this),this.inner_template=u.a["template-common-audio-player-minimal"],this.parent=n,this.params=t,this.$container=e,this.readyCallback=i||function(){},this.isHTHML5=this.html5AudioAvailable()},render:function(){this.setElement(Object(n.a)(this.inner_template({src:this.params.url}))),this.$container.append(this.$el),this.applyPlayerStyle(this.params),this.isHTHML5?this.audioEngine=new b(this.$container,this):this.audioEngine=new _(this.$container,this),this.loadTracksData([{url:this.params.url}])},applyPlayerStyle:function(t){this.$el&&(this.$el.toggleClass("no-artwork",!t.artwork),this.$el.toggleClass("no-info",!t.info),this.$el.toggleClass("no-transitions",d.a.isOn()),this.$(".sc-info").css("color",t.artwork?"#fff":"#"+t.color),this.$(".sc-left").css("color","#"+t.color),this.$(".sc-button svg path").css("fill","#"+t.color))},tracksIsLoaded:function(t){if(this.tracks=null,this.audioEngine){var e=t.playerObj.tracks;if(!e.length)return this.$el.remove(),this.ready=!0,void this.readyCallback(this.parent);this.tracks=e,this.currentTrackNum=0,this.$el.removeClass("loading"),this.audioEngine.on("scPlayer:onAudioReady",this.onAudioReady).on("scPlayer:onMediaPlay",this.onMediaPlay).on("scPlayer:onMediaPause",this.onMediaPause).on("scPlayer:onMediaEnd",this.onMediaEnd).on("scPlayer:onMediaBuffering",this.onMediaBuffering),this.$elements={},this.$elements.scrubber=this.$(".sc-scrubber"),this.$elements.play_button=Object(n.a)(this.$(".sc-button")),this.$elements.play_wrapper=this.$(".sc-button-wrapper"),this.$elements.buffer=this.$(".sc-buffer"),this.$elements.played=this.$(".sc-played"),this.$elements.time=this.$(".sc-left");var i=this.updateTrackInfo(this.currentTrackNum);if(this.$elements.play_button.on("click",this.onPlayClick),p.a.isDesktop&&(this.$elements.scrubber.on("mousemove",this.onScrubberMouseMove),this.$elements.scrubber.on("click",this.onScrubberClick)),this.$(".sc-artwork-list").on("click",this.onPlayClick),p.a.isDesktop&&this.$elements.play_button.RMDrag({move:this.moveHandleDrag,end:this.endHandleDrag,silent:!1,preventDefault:!0}),RM.screenshot)var o=Object(n.a)("<img/>").load(s.a.bind((function(){setTimeout(s.a.bind((function(){this.ready=!0,!this.isDestroyed&&this.readyCallback(this.parent),o.remove()}),this),100)}),this)).attr("src",i);else this.ready=!0,this.readyCallback(this.parent)}},moveHandleDrag:function(t){this.playing&&this.pause(),this.isDragging=!0,this.$el.addClass("dragging"),this.scrub(t.pageX)},endHandleDrag:function(t){t.moved&&this.play(),this.$el.removeClass("dragging"),setTimeout(s.a.bind((function(){this.isDragging=!1}),this),0)},onScrubberMouseMove:function(t){var e=Object(n.a)(t.currentTarget),i=e.find(".sc-hover-indicator"),o=d.a.getNormalizedBox(e.get(0)),a=t.pageX-o.left;i.css("left",a/d.a.getRatio()+"px")},onScrubberClick:function(t){return this.playing||this.play(),this.scrub(t.pageX),!1},onPlayClick:function(t){if(!this.isDragging)return this.playing?this.pause():this.play(),t.stopPropagation(),!1},onAudioReady:function(){this.audioEngine&&this.audioEngine.play(),this.audioEngine&&this.audioEngine.setVolume(100)},onMediaPlay:function(){this.$el.addClass("playing"),this.playing=!0,clearInterval(this.positionPoll),this.positionPoll=setInterval(this.updatePlayState,500)},onMediaPause:function(){this.$el.removeClass("playing"),this.playing=!1,clearInterval(this.positionPoll),this.positionPoll=null},onMediaEnd:function(){this.$elements.played.css("width","0%"),this.$elements.play_button.css("left","0%"),this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.stop();var t=(this.currentTrackNum+1)%this.tracks.length;this.play(t),0==t&&(this.pause(),this.updateTrackInfo(0))},onMediaBuffering:function(t){this.$elements.buffer.css("width",t+"%")},play:function(t){if(this.tracks&&(null==t&&(t=this.currentTrackNum),this.audioEngine&&(!this.playing||t!=this.currentTrackNum))){var e=this.tracks[t];this.$el.addClass("playing"),this.playing=!0,t==this.currentTrackNum&&this.audioEngine.firstLoad?this.audioEngine&&this.audioEngine.play():(this.updateTrackInfo(t),this.currentTrackNum=t,this.audioEngine&&this.audioEngine.load(e,this.apiKey))}},pause:function(){this.audioEngine&&this.playing&&(this.$el.removeClass("playing"),this.playing=!1,this.audioEngine&&this.audioEngine.pause())},scrub:function(t){if(this.audioEngine){var e=d.a.getNormalizedBox(this.$elements.play_wrapper.get(0)),i=d.a.getNormalizedBox(this.$elements.play_button.get(0)),n=(t-e.left-i.width/2)/e.width;n=Math.min(Math.max(Math.min(n,.999),0),this.$elements.buffer.width()/this.$elements.scrubber.width()),this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*n)+"px"),this.audioEngine&&this.audioEngine.seek(n)}},updatePlayState:function(){if(this.audioEngine){var t=this.audioEngine.getDuration(),e=this.audioEngine.getPosition(),i=e/t;this.$elements.played.css("width",100*i+"%"),this.$elements.play_button.css("left",Math.floor(this.$elements.play_wrapper.width()*i)+"px"),t&&this.$elements.time.html(this.timecode(t-e))}},updateTrackInfo:function(t){if(this.tracks){var e,i=this.tracks[t];this.$(".sc-info h3").html('<a target="_blank" href="'+i.permalink_url+'">'+i.title+"</a>"),this.$(".sc-info h4").html('by <a target="_blank" href="'+i.user.permalink_url+'">'+i.user.username+"</a>"),e=i.artwork_url?i.artwork_url.replace("-large","-t300x300"):i.user&&i.user.avatar_url?i.user.avatar_url.replace("-large","-t300x300"):this.defaultCover,this.$(".sc-artwork-list .sc-loaded-artwork").css("background-image",'url("'+e+'")'),this.$elements.time.html(this.timecode(i.duration));var n=(t+1)%this.tracks.length,o=(t-1+this.tracks.length)%this.tracks.length,a=this.tracks[n],s=this.tracks[o];return!a.preload&&a.artwork_url&&(a.preload=new Image,a.preload.src=a.artwork_url.replace("-large","-t300x300")),!s.preload&&s.artwork_url&&(s.preload=new Image,s.preload.src=s.artwork_url.replace("-large","-t300x300")),e}},loadTracksData:function(t){var e=0,i={tracks:[]},o=this;!function a(s){if(!o.isDestroyed){var r=o.scApiUrl(s.url);fetch(r).then((function(t){return t.json()})).then((function(l){o.isDestroyed||(e+=1,l.tracks?i.tracks=i.tracks.concat(l.tracks):l.duration?(l.permalink_url=s.url,i.tracks.push(l)):l.creator?t.push({url:l.uri+"/tracks"}):l.username?/favorites/.test(s.url)?t.push({url:l.uri+"/favorites"}):t.push({url:l.uri+"/tracks"}):n.a.isArray(l)&&(i.tracks=i.tracks.concat(l)),t[e]?a(t[e]):o.tracksIsLoaded({playerObj:i,url:r}))})).catch((function(){!o.isDestroyed&&o.readyCallback(o.parent)}))}}(t[e])},scApiUrl:function(t){var e="https:"===document.location.protocol,i=(e||/^https/i.test(t)?"https":"http")+"://api.soundcloud.com/resolve?url=",n="format=json&client_id="+this.apiKey;return e&&(t=t.replace(/^http:/,"https:")),/api\./.test(t)?t+"?"+n:i+t+"&"+n},html5AudioAvailable:function(){var t=!1;try{var e=new Audio;t=e.canPlayType&&/maybe|probably/.test(e.canPlayType("audio/mpeg"))}catch(t){}return t},timecode:function(t){var e={h:Math.floor(t/36e5),m:Math.floor(t/6e4%60),s:Math.floor(t/1e3%60)},i=[];return e.h>0&&i.push(e.h),i.push(e.m<10&&e.h>0?"0"+e.m:e.m),i.push(e.s<10?"0"+e.s:e.s),i.join(":")},show:function(){this.$el&&this.$el.css("opacity",1)},destroy:function(){this.pause(),this.audioEngine&&this.audioEngine.off(),this.audioEngine&&this.audioEngine.destroy(),this.audioEngine=null,this.$el&&this.$el.remove()}}),b=a.a.View.extend({initialize:function(t,e){s.a.bindAll(this),this.inner_template=u.a["template-common-audio-player-engine-html5"],this.parent=e,this.$container=t,this.firstLoad=!1;var i=this;this.callbacks={onReady:function(){i.player&&i.trigger("scPlayer:onAudioReady")},onPlay:function(){i.player&&i.trigger("scPlayer:onMediaPlay")},onPause:function(){i.player&&i.trigger("scPlayer:onMediaPause")},onEnd:function(){i.player&&i.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){i.player&&i.trigger("scPlayer:onMediaBuffering",t)}},this.render()},render:function(){this.setElement(Object(n.a)(this.inner_template({}))),this.$container.append(this.$el),this.player=this.$el.find("audio")[0],this.player.addEventListener("play",this.callbacks.onPlay,!1),this.player.addEventListener("pause",this.callbacks.onPause,!1),this.player.addEventListener("timeupdate",this.onTimeUpdate,!1),this.player.addEventListener("progress",this.onProgress,!1)},onTimeUpdate:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e),this.player.currentTime===this.player.duration&&this.callbacks.onEnd()}},onProgress:function(t){if(this.player){var e=(this.player.buffered.length&&this.player.buffered.end(0))/this.player.duration*100;this.callbacks.onBuffer(e)}},load:function(t,e){this.player&&(this.firstLoad=!0,this.player.pause(),this.player.src=t.stream_url+(/\?/.test(t.stream_url)?"&":"?")+"client_id="+e,this.player.load(),this.player.play())},play:function(){this.player&&this.player.play()},pause:function(){this.player&&this.player.pause()},stop:function(){this.player&&this.player.currentTime&&(this.player.currentTime=0,this.player.pause())},seek:function(t){if(this.player&&this.player.src)try{this.player.currentTime=this.player.duration*t}catch(t){}},getDuration:function(){return this.player?1e3*this.player.duration:0},getPosition:function(){return this.player?1e3*this.player.currentTime:0},setVolume:function(t){this.player&&(this.player.volume=t/100)},destroy:function(){this.$el.remove(),this.player=null}}),_=a.a.View.extend({initialize:function(t,e){s.a.bindAll(this),this.inner_template_flash=u.a["template-common-audio-player-engine-flash"],this.inner_template_flash_ie=u.a["template-common-audio-player-engine-flash-ie"],this.parent=e,this.$container=t,this.firstLoad=!1;var i=this;this.callbacks={onReady:function(){i.player&&i.trigger("scPlayer:onAudioReady")},onPlay:function(){i.player&&i.trigger("scPlayer:onMediaPlay")},onPause:function(){i.player&&i.trigger("scPlayer:onMediaPause")},onEnd:function(){i.player&&i.trigger("scPlayer:onMediaEnd")},onBuffer:function(t){i.player&&i.trigger("scPlayer:onMediaBuffering",t)}}},render:function(t){var e="soundcloud_"+this.parent.parent.params._id,i=("https:"===document.location.protocol?"https":"http")+"://player.soundcloud.com/player.swf?url="+t+"&amp;enable_api=true&amp;player_type=engine&amp;object_id="+e;Modernizr.msie?this.setElement(Object(n.a)(this.inner_template_flash_ie({id:e,swf:i}))):this.setElement(Object(n.a)(this.inner_template_flash({id:e,swf:i}))),this.$container.append(this.$el),this.$el.find("object").on("soundcloud:onPlayerReady",s.a.bind((function(t,i){this.player=l.getPlayer(e),this.callbacks.onReady()}),this)).on("soundcloud:onMediaBuffering",s.a.bind((function(t,e){this.callbacks.onBuffer(e.percent)}),this)).on("soundcloud:onMediaEnd",this.callbacks.onEnd).on("soundcloud:onMediaPlay",this.callbacks.onPlay).on("soundcloud:onMediaPause",this.callbacks.onPause)},load:function(t){this.firstLoad?this.player&&this.player.api_load(t.uri):(this.firstLoad=!0,this.render(t.uri))},play:function(){this.player&&this.firstLoad&&this.player.api_play()},pause:function(){this.player&&this.firstLoad&&this.player.api_pause()},stop:function(){this.player&&this.firstLoad&&this.player.api_stop()},seek:function(t){this.player&&this.firstLoad&&this.player.api_seekTo(this.player.api_getTrackDuration()*t)},getDuration:function(){return this.player&&this.firstLoad&&this.player.api_getTrackDuration&&1e3*this.player.api_getTrackDuration()},getPosition:function(){return this.player&&this.firstLoad&&this.player.api_getTrackPosition&&1e3*this.player.api_getTrackPosition()},setVolume:function(t){this.player&&this.player.api_setVolume&&this.player.api_setVolume(t)},destroy:function(){this.player=null,this.$el&&this.$el.remove()}});e.a=m},i0ke:function(t,e,i){"use strict";var n=i("v83y"),o=i("uU7u"),a=i("vOnD"),s=i("q1tI"),r=i.n(s),l=i("9Juw"),c=i("iC7s"),d=Object(a.e)(c.m).withConfig({displayName:"nbsp___StyledBox"})(["position:relative;z-index:-1;&:before{content:'⋀';position:absolute;color:var(--editor-nbsp-highlight-color);font-size:0.4em;font-weight:bold;left:0;top:0.7em;}"]),h={strategy:function(t,e){Object(l.f)(t,String.fromCharCode(160)).forEach((function(t){e(t,t+1)}))},component:function(t){return r.a.createElement(d,{as:"span"},t.children)}},u=i("zZDe");i.d(e,"a",(function(){return p}));var p=new n.CompositeDecorator([o.d,h,u.a])},i7aS:function(t,e,i){"use strict";var n=i("Kf/z"),o=i("tZHv"),a=i("mkcP");function s(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function l(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var d=Boolean(window&&window.viewerConfig&&window.viewerConfig.homepageRewrite),h=Boolean(window&&window.viewerConfig&&window.viewerConfig.isDownloadedSource)&&!d,u=function(){return!h&&Object(n.a)("constructor.imageLambda")},p=function(){return!h&&Object(n.a)("viewer.imageLambdaOldProjects")},g=function(t){return o.a.allowedLambdaExt.includes(t)},m=function(t){return Boolean(u()&&t&&t.lambdaUrl&&g(t.type))},f=function(t,e){switch(e){case"video":case"slideshow":return Boolean(p()&&t&&t.url&&g(t.type));case"background":return Boolean(p()&&t&&(t.url||t.finalUrl)&&g(t.type));default:return Boolean(p()&&t&&t.unscaledUrl&&g(t.type))}},v=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,n=t.cropX,a=t.cropY,s=t.cropW,r=t.cropH,l=t.originalW,c=void 0===l?9999:l,d=t.originalH,h=void 0===d?9999:d,u=t.quality,p=t.ext,g=t.scale,m=t.animationScale,f=t.isStretched,v=t.dpr,b=t.fit,_=void 0===b?"none":b,y=window.devicePixelRatio||o.a.minDpr,w=v||(y<o.a.minDpr?o.a.minDpr:y),k=[],S=g||1,x=m||1;if(!f&&e){var C=Math.min(Math.round(e*w*S*x),c);C<c&&k.push("w=".concat(C))}if(!f&&!e&&i){var O=Math.min(Math.round(i*w*S*x),h);O<h&&k.push("h=".concat(O))}if(u&&k.push("q=".concat(u)),p&&k.push("e=".concat(p)),"auto"===_&&e&&i){var P=Math.min(Math.round(i*w*S*x),h);P<h&&k.push("h=".concat(P))}return void 0!==n&&void 0!==a&&s&&r&&(s!==c||r!==h)&&(k.push("cX=".concat(n)),k.push("cY=".concat(a)),k.push("cW=".concat(s)),k.push("cH=".concat(r))),k.length?"?".concat(k.join("&")):""},b=function(t){return t?"".concat(t.lambdaUrl||function(t){if(!t)return"";try{var e=new URL(t.unscaledUrl||t.url||t.finalUrl);return"".concat(o.a.readymag_lambda_host).concat(e.pathname)}catch(t){return""}}(t)):""},_=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";var i=l({},e);return f(t)&&!m(t)&&(i.cropX=void 0,i.cropY=void 0,i.cropW=e.originalW,i.cropH=e.originalH),a.a.isSupported("webp")&&(i.ext="webp"),"".concat(b(t)).concat(v(i))};e.a={flagLambda:u,flagLQIP:function(){return Object(n.a)("constructor.imageLqip")},flagLambdaOldProjects:p,allowedLambdaExt:g,useLambdaUrl:m,useLambdaUrlOldProjects:f,useLqipUrl:function(t){return Boolean(t&&t.lqipUrl||m(t))},getLambdaUrl:_,getOriginalLambdaUrl:b,getLambdaParams:v,getSrcset:function(t,e){var i=e.dprSet,n=void 0===i?[2,3]:i,o=s(e,["dprSet"]),a=[];(n||[]).forEach((function(e){o.dpr=e;var i=_(t,o);i!==a[a.length-1]&&a.push({dpr:e,url:i})}));var r=a.map((function(t){return"".concat(t.url," ").concat(t.dpr,"x")}));return r.length>1?r.join(", "):void 0},getLqipUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";if(t.lqipUrl)return t.lqipUrl;var i=l({dpr:1,width:o.a.lqipWidth,quality:o.a.lqipQuality},e);return _(t,i)},getThumbnailUrl:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return"";var i=l({width:o.a.THUMB_SIZE,height:o.a.THUMB_SIZE,quality:o.a.THUMB_QUALITY,fit:"auto"},e);return _(t,i)}}},ibKe:function(module,exports){module.exports={"template-constructor-control-button_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Edit Text" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel"></div>\n\n';return __p}}},"j/3K":function(t,e,i){},j0jp:function(module,exports){module.exports={"template-constructor-control-common_animation":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Animation" data-alt-pos="left" data-alt-offset="9" data-name="animation-control-icon"></div>\n\n\t<div class="panel" data-name="animation-panel">\n\t\t<div class="panel-caption">Animation</div>\n\n\t\t<div class="mixed-types">\n\t\t\t<div class="message-text">Nope, you can’t mix fixed, full width, full height, sticky and normal widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fixeds">\n\t\t\t<div class="message-text">Nope, you can’t animate multiple fixed widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-stickeds">\n\t\t\t<div class="message-text">Nope, you can’t animate multiple sticky widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullwidths">\n\t\t\t<div class="message-text">Nope, you can’t animate multiple full width widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="multiple-fullheights">\n\t\t\t<div class="message-text">Nope, you can’t animate multiple full height widgets at a time.</div>\n\t\t</div>\n\n\t\t<div class="non-animatable">\n\t\t\t<div class="message-text">Nope, you can’t animate Facebook or Twitter widgets.</div>\n\t\t</div>\n\n\t\t<div class="multiple-animations">\n\t\t\t<div class="message-text">There’re different animations in this selection. Merge them?</div>\n\t\t\t<div class="unite-button">Yes</div>\n\t\t</div>\n\n\t\t<div class="requires-trigger">\n\t\t\t<div class="message-text">A video widget can be&nbsp;animated on&nbsp;click only with&nbsp;another widget as&nbsp;a&nbsp;trigger.</div>\n\t\t</div>\n\n\t\t<div class="cannot-use-with-picture-preview">\n\t\t\t<div class="message-text">Oops, you can’t currently add this animation since Lightbox is enabled</div>\n\t\t</div>\n\n\t\t<div class="top-block js-top-block">\n\t\t\t'+(null==(__t=renderInitialTypePopup())?"":__t)+'\n\t\t</div>\n\n\t\t<div class="step-selector js-step-selector">\n\t\t\t<div class="prev-step js-prev-step"></div>\n\t\t\t<div class="step-caption js-step-caption"></div>\n\t\t\t<div class="next-step js-next-step"></div>\n\n\t\t\t<div class="step-popup js-step-popup">\n\t\t\t\t<div class="step-popup-content js-step-popup-content"></div>\n\t\t\t\t<div class="corner-wrapper">\n\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t<div class="effects-presets-wrapper">\n\t\t\t\t\t\t<div class="effects-caption">Choose Effect</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_move">Move</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t\t<div class="effects-item" data-value="use_scale">Scale</div>\n\n\t\t\t\t\t\t<div class="presets-caption">Presets</div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-and-scale">Fade&Scale<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="fade-in">Fade In<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="scale-big">Scale Big<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="move-and-fade">Move&Fade<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="pulse">Pulse<div class="preview"></div></div>\n\t\t\t\t\t\t<div class="presets-item" data-value="rotate">Rotate<div class="preview"></div></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\n\t\t<div class="bottom-block">\n\t\t\t<div class="add-effect">\n\t\t\t\t<span>Add Effect</span>\n\t\t\t\t<div class="effect-popup">\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_move">Move</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_opacity">Opacity</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_rotate">Rotate</div>\n\t\t\t\t\t<div class="effect-popup-item" data-value="use_scale">Scale</div>\n\t\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="loop-types js-loop-types">\n\t\t\t\t<div class="loop-type loop-type-swing js-loop-swing" data-value="swing" data-alt="Reverse">\n\t\t\t\t\t<svg class="loop-type-swing-icon" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path d="M23 4H7V1.124A1 1 0 005.309.401L1.257 4.277a1 1 0 000 1.446L5.31 9.599A1 1 0 007 8.876V6h16v2.876a1 1 0 001.691.723l4.052-3.876a1 1 0 000-1.446L24.69.401A1 1 0 0023 1.124V4z" fill-rule="nonzero"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t\tLoop\n\t\t\t\t<div class="loop-type loop-type-repeat js-loop-repeat" data-value="repeat" data-alt="Cycle">\n\t\t\t\t\t<svg class="loop-type-repeat-icon" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path d="M12 6v2.876a1 1 0 001.691.723l4.052-3.876a1 1 0 000-1.446L13.69.401A1 1 0 0012 1.124V4H5a5 5 0 00-.217 9.995L5 14h18a5 5 0 00.217-9.995L23 4h-3a1 1 0 00-.117 1.993L20 6h3a3 3 0 01.176 5.995L23 12H5a3 3 0 01-.176-5.995L5 6h7z" fill-rule="nonzero"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="play-once">\n\t\t\t\t<div class="play-once-title js-play-once">Once per user</div>\n\t\t\t\t<div class="help">\n\t\t\t\t\t<div class="help-popup">\n\t\t\t\t\t\t<div class="help-body-wrapper">\n\t\t\t\t\t\t\t<div class="help-body">\n\t\t\t\t\t\t\t\t<span class="help-text">Plays animation once to&nbsp;each person.<br />Hides animated blocks on&nbsp;consequent refreshes. <br/><a href="http://help.readymag.com/hc/en-us/articles/360021875712-Settings" target="_blank">Learn more</a></span>\n\t\t\t\t\t\t\t\t<div class="help-popup-corner">\n\t\t\t\t\t\t\t\t\t<div class="corner"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="hover-spacer"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="preview">Preview</div>\n\t\t</div>\n\n\t\t<div class="animation-add js-add-animation">\n\t\t\tAdd\n\t\t\t'+(null==(__t=renderAddTypePopup())?"":__t)+"\n\t\t</div>\n\n\t</div>\n";return __p},"template-constructor-control-common_animation-trigger":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="trigger js-trigger-button" data-id="'+(null==(__t=id)?"":__t)+'">\n\t\t',"onOtherPage"===status?__p+='\n\t\t\t<div class="trigger-other-page">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\tTrigger on p. '+(null==(__t=pageNumber)?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<svg class="trigger-remove-button js-remove-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':"pending"===status?__p+='\n\t\t\t<div class="trigger-pending">\n\t\t\t\tChoose Trigger\n\t\t\t\t<svg class="trigger-remove-button js-cancel-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':"active"===status?__p+='\n\t\t\t<div class="trigger-active js-trigger-active">\n\t\t\t\t<div class="trigger-name js-trigger-name">\n\t\t\t\t\t'+(null==(__t=isSelf?"Self":triggerBlockName||"Trigger")?"":__t)+'\n\t\t\t\t</div>\n\t\t\t\t<svg class="trigger-remove-button js-remove-trigger" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t<path d="M6 4.467l4.15-4.15a1.084 1.084 0 011.533 1.533L7.533 6l4.15 4.15a1.084 1.084 0 11-1.533 1.533L6 7.533l-4.15 4.15A1.084 1.084 0 01.317 10.15L4.467 6 .317 1.85A1.084 1.084 0 111.85.317L6 4.467z" fill-rule="evenodd"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t':__p+='\n\t\t\t<div class="trigger-none">\n\t\t\t\t<div class="trigger-none-caption">Add Trigger</div>\n\t\t\t\t<div class="trigger-arrow"></div>\n\t\t\t</div>\n\t\t',__p+="\n\t</div>\n";return __p},"template-constructor-control-common_animation-step":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step">\n\n\t\t<div class="param-wrapper start-block">\n\t\t\t<div class="caption">Start Point</div>\n\t\t\t<div class="start-value">'+(null==(__t=start_point)?"":__t)+'</div>\n\t\t\t<div class="start-popup">\n\t\t\t\t<div class="start-popup-item" data-value="top">Top<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="center">Center<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-item" data-value="bottom">Bottom<div class="point"></div></div>\n\t\t\t\t<div class="start-popup-caption">Offset</div>\n\n\t\t\t\t<div class="input-wrapper">\n\t\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="start_offset" data-min="-9999" data-max="9999" data-mouseSpeed="1" type="text"/>\n\t\t\t\t\t<div class="units">px</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="start-preview">\n\t\t\t\t\t<div class="start-point"></div>\n\t\t\t\t\t<div class="start-dist"></div>\n\t\t\t\t\t<div class="start-offset"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper duration-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Durat.</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">s</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="duration" data-min="0" data-max="99" data-useFloat="true" data-shiftStep="1" data-step="0.1" data-mouseSpeed="5" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">s</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper delay_px-block">\n\t\t\t<div class="bg"></div>\n\t\t\t<div class="caption">Delay</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">px</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="delay_px" data-min="0" data-max="9999" data-mouseSpeed="1" data-labelSelector="<.param-wrapper" type="text"/>\n\t\t\t\t<div class="units">px</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t',0===index&&(__p+='\n\t\t\t<div class="param-wrapper start-condition-block">\n\t\t\t\t<div class="caption">Start when in view</div>\n\t\t\t\t<div class="switcher start-when-in-view-switcher js-start-when-in-view-switcher"></div>\n\t\t\t</div>\n\t\t'),__p+='\n\n\t\t<div class="param-wrapper speed-block">\n\t\t\t<div class="caption">Speed</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<div class="units for-centering">×</div>\n\t\t\t\t<input class="numeric-input" spellcheck="false" data-param="speed"  data-min="0.01" data-floatDigits="2" data-max="999" data-useFloat="true" data-shiftStep="0.1" data-step="0.01" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="units">×</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper move-block">\n\t\t\t<div class="remove-effect" data-value="use_move"></div>\n\t\t\t<div class="caption">Move</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="dx" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator move-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="dy" data-min="-99999" data-max="99999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper opacity-block">\n\t\t\t<div class="remove-effect" data-value="use_opacity"></div>\n\t\t\t<div class="caption">Opacity</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="opacity" data-min="0" data-max="100"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t\t',isSwitcherVisible&&(__p+='\n\t\t\t\t<div class="param-wrapper hide-in-editor-switcher-wrapper">\n\t\t\t\t\t<div class="caption">Hide in Editor</div>\n\t\t\t\t\t<div class="switcher hide-in-editor-switcher js-hide-in-editor-switcher"></div>\n\t\t\t\t</div>\n\t\t\t'),__p+='\n\t\t</div>\n\n\t\t<div class="param-wrapper rotate-block">\n\t\t\t<div class="remove-effect" data-value="use_rotate"></div>\n\t\t\t<div class="caption">Rotate</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="rotate" data-min="-9999" data-max="9999"  data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper scale-block">\n\t\t\t<div class="remove-effect" data-value="use_scale"></div>\n\t\t\t<div class="caption">Scale</div>\n\t\t\t<div class="input-wrapper">\n\t\t\t\t<input class="numeric-input left-align" spellcheck="false" data-param="from_scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t\t<div class="separator from-icon"></div>\n\t\t\t\t<input class="numeric-input right-align" spellcheck="false" data-param="scale" data-min="0" data-max="9999" data-mouseSpeed="5" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="param-wrapper acceleration-block">\n\t\t\t<div class="caption">Acceleration</div>\n\t\t\t<div class="acceleration-value">'+(null==(__t=acceleration)?"":__t)+'</div>\n\t\t\t<div class="acceleration-popup">\n\t\t\t\t<div class="acceleration-popup-preview"><div class="ball"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="none">None<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-in">Ease In<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-out">Ease Out<div class="point"></div></div>\n\t\t\t\t<div class="acceleration-popup-item" data-value="ease-both">Ease Both<div class="point"></div></div>\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-common_animation-step-popup-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="step-popup-item js-step-popup-item '+(null==(__t=isSelected?"selected":"")?"":__t)+" "+(null==(__t=isInLoop?"looped":"")?"":__t)+'" data-ind="'+(null==(__t=index)?"":__t)+'">'+(null==(__t=text)?"":__t)+"</div>\n";return __p},"template-constructor-control-common_animation-type-popup":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="type-popup '+(null==(__t=isInitial?"initial":"")?"":__t)+" "+(null==(__t=uuid?"":"new")?"":__t)+" "+(null==(__t=cssClass)?"":__t)+'">\n\t\t',isInitial&&(__p+='\n\t\t\t<div class="type-popup-header">Animate</div>\n\t\t'),__p+='\n\t\t<div class="type-popup-content">\n\t\t\t',uuid&&(__p+='\n\t\t\t\t<div class="type-popup-item js-type-popup-item none" data-value="none" data-uuid="'+(null==(__t=uuid)?"":__t)+'">\n\t\t\t\t\t<div class="type-popup-text">none</div>\n\t\t\t\t</div>\n\t\t\t'),__p+="\n\t\t\t",_.each(availableTypes,(function(t){__p+="\n\t\t\t\t",(uuid||t!==currentType)&&(__p+='\n\t\t\t\t\t<div class="type-popup-item js-type-popup-item '+(null==(__t=t===currentType?"current":"")?"":__t)+'" data-value="'+(null==(__t=t)?"":__t)+'" data-uuid="'+(null==(__t=uuid)?"":__t)+'">\n\t\t\t\t\t\t',!isInitial&&uuid||(__p+='\n\t\t\t\t\t\t\t<div class="type-popup-prefix">'+(null==(__t=isInitial?"on":uuid?"":"Add")?"":__t)+"</div>\n\t\t\t\t\t\t"),__p+='\n\t\t\t\t\t\t<div class="type-popup-text">'+(null==(__t=t)?"":__t)+"</div>\n\t\t\t\t\t</div>\n\t\t\t\t"),__p+="\n\t\t\t"})),__p+="\n\t\t</div>\n\t</div>\n";return __p},"template-constructor-control-common_animation-type":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="animation-type js-animation-type '+(null==(__t=animation.UUID===currentUuid?"current":"")?"":__t)+" "+(null==(__t="none"===animation.type?"none":"")?"":__t)+" "+(null==(__t=allowTriggers(animation)||"none"===animation.type?"has-extra":"")?"":__t)+" "+(null==(__t=0===index?"first":index===total-1?"last":"")?"":__t)+'" data-type="'+(null==(__t=animation.type)?"":__t)+'">\n\t\t<div class="animation-type-header">\n\t\t\t<div class="animation-type-caption '+(null==(__t=animation.UUID===currentUuid?"js-change-type":"js-change-animation")?"":__t)+'" data-uuid="'+(null==(__t=animation.UUID)?"":__t)+'">\n\t\t\t\t<div class="animation-type-text">\n\t\t\t\t\t'+(null==(__t=animation.type)?"":__t)+"\n\t\t\t\t</div>\n\t\t\t\t",animation.UUID===currentUuid&&(__p+='\n\t\t\t\t\t<svg class="animation-type-dropdown-arrow" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t<path d="M3.206 5.46L.257 1.609A1 1 0 011.051 0H6.95a1 1 0 01.794 1.608L4.794 5.46a1 1 0 01-1.588 0z" fill-rule="evenodd"/>\n\t\t\t\t\t</svg>\n\t\t\t\t'),__p+="\n\t\t\t</div>\n\n\t\t\t","none"===animation.type&&animation.UUID===currentUuid&&(__p+='\n\t\t\t\t<div class="animation-none-controls">\n\t\t\t\t\t<div class="animation-remove js-remove-animation" data-uuid="'+(null==(__t=animation.UUID)?"":__t)+'">Delete</div>\n\t\t\t\t</div>\n\t\t\t'),__p+="\n\t\t\t",animation.UUID===currentUuid&&(__p+="\n\t\t\t\t"+(null==(__t=renderTypePopup({type:animation.type,isInitial:!1,uuid:animation.UUID,cssClass:"js-change-type-popup"}))?"":__t)+"\n\t\t\t"),__p+="\n\t\t</div>\n\t\t",animation.UUID===currentUuid&&allowTriggers(animation)&&(__p+='\n\t\t\t<div class="trigger-buttons-container js-trigger-buttons-container"></div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},"j6/F":function(module,exports){module.exports={"template-constructor-control-common_align":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon" data-alt="Align" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="bottom" title="Align Bottom Edges"></div>\n\t\t<div class="middle" title="Align Vertical Centers"></div>\n\t\t<div class="top" title="Align Top Edges"></div>\n\t\t<div class="left" title="Align Left Edges"></div>\n\t\t<div class="center" title="Align Horizontal Centers"></div>\n\t\t<div class="right" title="Align Right Edges"></div>\n\t</div>\n';return __p}}},jamO:function(t,e,i){"use strict";i.d(e,"a",(function(){return w})),i.d(e,"b",(function(){return k}));var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("jeLO"),l=i("Fi5S"),c=i("mT3t"),d=i("tf3M"),h=i("v92f"),u=i("OTSC"),p=i("DqjY"),g=i("onY4"),m=i("sviH"),f=i("Kf/z"),v=i("Wwwp");function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var _=r.a.extend({sync:function(){return{error:n.a.noop,success:n.a.noop}},idAttribute:"_id",skipMagChanging:!0,fakeSave:!0,isNew:function(){return!1},getPageId:function(){return this.page.id},parse:function(t){return t.page&&(this.page=t.page,delete t.page),t}}),y=r.a.extend({idAttribute:"_id",urlRoot:"/api/page/",undoKeys:["wids","order"],mergeUndoSteps:!1,name:"Page",initialize:function(t,e){s.a.bindAll(this),e=e||{},this.loaded=!0,this._saveQueue=[],this._saveInProgress=!1,this.trigger("loaded"),this.on("change:wids",this.onChange),this.widgets=this.widgets||new d.WidgetsCollection([],{page:this}),this.widgets.on("change",this.setEdited,this),this.on("change:wids",this.setEdited,this),this.viewportStub=new _({viewport:"default",page:this,_id:this.id+"_viewport"},{parse:!0}),this.viewportStub.on("change:viewport",(function(t,e,i){i&&(i.undo||i.redo)&&(this.get("viewport_"+e)&&this.get("viewport_"+e).enabled||this.save("viewport_"+e,{enabled:!0},{patch:!0}),this.workspace.setViewport(e,i))}),this),this.on("change:viewport",(function(t,e,i){i&&(i.undo||i.redo)||this.viewportStub.save({viewport:this.get("viewport")})}),this),l.a.trigger("ready:model",this.viewportStub),l.a.trigger("ready:model",this)},sync:function(t,e,i){var n=(i=i||{}).success;return i.success=function(t){e.previousAttributes();e.changed.wids&&(t.wids=s.a.union(e.get("wids"),t.wids)),n&&n.apply(this,arguments)},c.a.prototype.sync.apply(this,arguments)},save:function(t,e,i){var n,o,a=this;if(!Object(f.a)("constructor.zIndex"))return r.a.prototype.save.apply(this,arguments);if(null==t||"object"===b(t)?(n=t,i=e):(n={})[t]=e,this._saveInProgress){this.set(n,i);var s={attrs:n,options:i,fakeXhr:{abort:function(){var t=a._saveQueue.indexOf(s);-1!==t&&a._saveQueue.splice(t,1)}}};return this._saveQueue.push(s),s.fakeXhr}this._saveInProgress=!0,o=r.a.prototype.save.call(this,n,i);var l=function(){if(a._saveInProgress=!1,a._saveQueue.length){var t=a._saveQueue.shift(),e=a.save(t.attrs,t.options);t.fakeXhr.abort=function(){return e.abort()}}};return o?o.always((function(){l()})):l(),o},parse:function(t,e){e&&(e.undo||e.redo)&&(t.num=this.get("num"));var i=s.a.clone(t),n=i.widgets||i.wids||[];return e=e||{},n=this.sanitizeWidgets(n),s.a.isEmpty(n)||(this.widgets=this.widgets||new d.WidgetsCollection([],{page:this}),this.widgets.reset(n,{page:this,parse:e.parse}),i.wids=s.a.pluck(n,"_id"),this.checkEmpty()),delete i.widgets,r.a.prototype.parse.call(this,i,e)},setEdited:function(t,e){this.isEmptyPage=!1},checkEmpty:function(){return!(this.widgets.length>1)&&(!!this.widgets.length&&("background"==this.widgets.at(0).get("type")&&("ffffff"==this.widgets.at(0).get("color")&&void 0===this.widgets.at(0).get("selectedType")&&(this.isEmptyPage=!0,!0))))},toJSON:function(){var t=r.a.prototype.toJSON.apply(this,arguments);return delete t.viewport,t},addWidget:function(t,e){var i;if(e=e||{},t instanceof d.default)i=t,this.widgets.add(i);else{if(!t||!t.type)return void console.error("Adding widget with no type");if(!m.a[t.type])return void console.error("Adding unknown widget");t.pid=this.id;var n=this.getCurrentViewport();if("default"!=n&&(t.hidden=!0),s.a.each(h.b.viewport_list,(function(e){t[e]&&-1==e.indexOf(n)&&"default"!=n&&(t[e].hidden=!0)})),"gmaps"===t.type){var o=this.workspace&&this.workspace.mag&&this.workspace.mag.get("opts");o&&o.gmaps_key&&(t.api_key=o.gmaps_key)}i=this.widgets.add(t)}if(i.id)e.nosave?this.getAddCallback(e)(i):i.fetch({success:this.getAddCallback(e),error:e.error});else{i.created=!e.copy&&!e.clone;"default"!=this.getCurrentViewport()&&(i.initViewport(e),i["viewport_"+this.getCurrentViewport()].hidden=!1),i.save({},{success:this.getAddCallback(e),error:e.error,clone:e.clone})}},onAdd:function(t,e){if(!t.get("type"))return!1;var i;Object(f.a)("constructor.zIndex")&&RM.constructorRouter.indexController.updateIndex(this,[t],!1);var n,o=this;return(i=s.a.clone(this.get("wids"))).push(t.id),i=Object(s.a)(i).chain().uniq().compact().value(),e&&(e.group||e.nosave)?this.set({wids:i},{copy:e.copy,silent:!!e.silent,isMultiple:e.isMultiple}):n=new Promise((function(t,e){o.save({wids:i},{success:t,error:e})})),!e.silent&&t.is_global&&t.triggerGlobalAppear(),this.sendAnalyticsEvent("Create Widget",{_widget_type:t.get("type"),label:t.get("type")}),n},getAddCallback:function(t){t=t||{};var e=this;return function(i){var n=e.onAdd(i,t);n instanceof Promise?(n.then((function(){if(Object(f.a)("constructor.zIndex"))return RM.constructorRouter.indexController.saveAffectedPages()})),n.finally((function(){t.success&&t.success(i,t)}))):t.success&&t.success(i,t)}},onChange:function(t,e,i){var n=t.changedAttributes().wids,o=t.previous("wids")||[];if(n){var a=s.a.difference(n,o),r=s.a.difference(o,n);s.a.each(a,(function(e){var n=t.widgets.get(e);i.is_new_global=n.isGlobal(),i.isMultiple=a.length>1||i.isMultiple,n&&this.trigger("widget:create",n,i),s.a.defer(function(){n&&n.isGlobal()&&n.get("pid")==this.id&&n.triggerGlobalAppear()}.bind(this))}),this),s.a.each(r,(function(e){var n=t.widgets.get(e);n&&this.trigger("widget:remove",n,i),s.a.defer(function(){n&&n.isGlobal()&&n.get("pid")==this.id&&n.triggerGlobalDisappear()}.bind(this))}),this)}},duplicate:function(t,e){var i=this,o=[];RM.constructorRouter.mag.globalWidgets.each((function(t){o.push(t.get("_id"))})),n.a.ajax({url:this.urlRoot+"duplicate/",type:"POST",dataType:"json",data:{_id:this.get("_id"),num:e&&e.num?e.num:parseInt(this.get("num"),10)+1,mid:this.get("mid"),globalWidgets:o},success:function(e){var o=e.page;e.widgets&&s.a.each(e.widgets,(function(t){var e=RM.constructorRouter.mag.globalWidgets.find({_id:t._id}),i=e.collection.page.getCurrentViewport();e.storeViewport(i),e.restoreViewport("default"),s.a.each(h.b.viewports,(function(i){"default"!==i.name?s.a.isEmpty(t["viewport_"+i.name])||s.a.isEmpty(e["viewport_"+i.name])||s.a.extend(e["viewport_"+i.name],t["viewport_"+i.name]):e.set(JSON.parse(JSON.stringify(t)))})),e.storeViewport("default"),e.restoreViewport(i),s.a.each(h.b.viewports,(function(i){if("default"===i.name)return e.restoreViewport("default"),e.set(JSON.parse(JSON.stringify(t))),void e.storeViewport("default");s.a.isEmpty(t["viewport_"+i.name])||(e.restoreViewport(i.name),e.set(JSON.parse(JSON.stringify(t["viewport_"+i.name]))),e.storeViewport(i.name))})),e.restoreViewport(i),e.save({},{silent:!0,skipHistory:!0})})),n.a.get("/api/pageFullById/"+o._id,function(e){var o=new y(e,{parse:!0});o.set("screenshot",i.get("screenshot")),this.sendAnalyticsEvent("Create Page",{_page_type:"duplicate",label:"Duplicate"}),n.a.ajax({method:"get",url:"/api/packs/"+RM.constructorRouter.mag.get("_id"),success:function(e){RM.constructorRouter.mag.set("packs",e),t&&t(o)},error:function(){t&&t(o)}})}.bind(this)).fail((function(e,i){alert(i.responseText),t(new Error("Сould not get page data"))}))},error:function(e){try{var i=JSON.parse(e.responseText);t(new Error("Server error: ".concat(i&&i.err?i.err:"unknown")))}catch(i){t(new Error("Server error: could not parse it")),alert(e.responseText)}},context:this})},sendAnalyticsEvent:function(t,e){var i=RM.constructorRouter||RM.collectorRouter||RM.viewerRouter||RM.homepageRouter;i&&i.analytics&&i.analytics.sendEvent(t,e)},getEffectiveHeight:function(){var t=this.getCurrentViewportSetting("min_height");return Math.round(this.widgets.reduce((function(t,e){return"background"==e.get("type")?t:Math.max((e.get("y")||0)+(e.get("h")||0),t)}),t))},getWidgetsQuantity:function(){return this.get("wids").length},removeWidgets:function(t,e){if(e=e||{},!s.a.isEmpty(t))if("default"==(e.viewport||this.getCurrentViewport())||e.forceRemove){this.trigger("widgets:remove",t,e);var i=s.a.difference(this.get("wids"),t);e.nosave?this.set({wids:i},{silent:!!e.silent}):this.save({wids:i})}else this.trigger("toggleWidgets",{wids:t,hidden:!0})},validate:function(t){if(s.a.isArray(t.tags)&&(t.tags=s.a.uniq(t.tags)),t.uri){if(/(^\-)|(\-$)/.test(t.uri))return{hyphen:!0};if(/^[0-9]+$/.test(t.uri))return{onlyNumbers:!0};if(t.uri.length>128)return{uriLength:!0};var e=this;if(this.collection&&this.collection.any((function(i){if(i!=e)return Object(f.a)("constructor.newProjectSettings")?(i.get("uri")||"").toLowerCase()===t.uri.toLowerCase()&&i.get("parentPage")===t.parentPage:(i.get("uri")||"").toLowerCase()===t.uri.toLowerCase()})))return{used:!0}}},groupSaveWids:function(t,e){var i=s.a.pluck(t,"id"),n=s.a.clone(this.get("wids"));e=e||{},this.set("wids",i,{silent:!0}),this.save({wids:n},e)},sanitizeWidgets:function(t){var e=t.filter((function(t){return!!m.a[t.type]}));return this.migrateWidgets(e)},getPageId:function(){return this.id},renewScreenshot:function(){return delete this.specialScreenshot,this},getScreenshot:function(t){return this.specialScreenshot?this.specialScreenshot:(t=u.default.screenshotSize(t||256),this.get("screenshot")?u.default.addFilenameComponent(this.get("screenshot"),t):["/api/screenshot/renew",RM.constructorRouter.mag.get("num_id"),this.get("_id"),"?redirect=true&size="+t].join("/"))},requestNewScreenshot:function(t){n.a.get(["/api/screenshot/renew",RM.constructorRouter.mag.get("num_id"),this.get("_id")].join("/"),s.a.bind((function(e){var i=e.screenshot;i&&(this.save("screenshot",i,{patch:!0}),t())}),this))},requestActualScreenshot:function(t){n.a.get(this.urlRoot+this.id+"/screenshot",s.a.bind((function(e){var i=e.screenshot;i&&(this.save("screenshot",i,{patch:!0}),t())}),this))},getCurrentViewportSetting:function(t,e){return e=e||this.getCurrentViewport(),(s.a.findWhere(h.b.viewports,{name:e})||{})[t]},getViewportParam:function(t,e){var i=this.get("viewport_"+t)||{};return void 0!==i[e]?i[e]:this.get(e)},setViewportParam:function(t,e,i,n){var o=s.a.clone(this.get("viewport_"+t)||{}),a={};o[e]=i,"default"===t?a[e]=i:a["viewport_"+t]=o,this.set(a,n||{})},getCurrentViewportParam:function(t){return this.getViewportParam(this.getCurrentViewport(),t)},setCurrentViewportParam:function(t,e,i){this.setViewportParam(this.getCurrentViewport(),t,e,i)},getViewport:function(){return this.getCurrentViewport()},getCurrentViewport:function(){return this.get("viewport")||"default"},getPreviousViewport:function(){return this.previous("viewport")||"default"},getUsedFonts:function(t){t=t||{};var e=[];return s.a.each(this.widgets.models,(function(t){e.push(t)})),p.a.getUsedFontsFromWidgetsModels(s.a.extend(t,{models:e}))},getOwnGlobalWidgets:function(){return this.widgets.filter(function(t){return t.isGlobal()&&t.get("pid")===this.id}.bind(this))},hasChildren:function(){var t=this;return RM.constructorRouter.mag.pages.some((function(e){return e.get("parentPage")===t.attributes._id}))},isChild:function(){return Boolean(this.attributes.parentPage)},migrateWidgets:function(t){var e=s.a.clone(t);if(Object(f.a)("constructor.textv3"))for(var i=0;i<e.length;i++){var n=e[i];"text"===n.type&&3!==n.version&&(e[i]=Object(v.c)(n))}return e}},{getViewportSetting:function(t,e){return(s.a.findWhere(h.b.viewports,{name:e})||{})[t]}}),w=a.a.Collection.extend({model:y,comparator:function(t){return t.get("num")},fetchFullPage:function(t,e){e=e||{},this.fetchingPageXHR||(this.fetchingPageXHR=n.a.get("/api/pageFullById/"+t,s.a.bind((function(i){var n=this.get(t);n||(n=new y(i,{parse:!0}),RM.constructorRouter.mag.onAdd(n,e)),delete n.needUpdate,g.a.clearHistory(n.get("_id")),n.widgets.set(i.wids,{parse:!0,resetPage:!0});var o=s.a.pluck(i.wids,"_id");console.log("RESET"),n.set(s.a.extend({},i,{wids:o}),{resetPage:!0}),e.success&&e.success(),delete this.fetchingPageXHR}),this)).fail(s.a.bind((function(){delete this.fetchingPageXHR,alert("failed to load page, please, refresh the page"),e.success&&e.success()}),this)))}}),k=a.a.Collection.extend({model:y,name:"TrashPages",initialize:function(){this.on("remove",(function(){this.triggerSocketUpdate(this,this.pluck("_id"))}),this)},triggerSocketUpdate:c.a.prototype.triggerSocketUpdate});e.c=y},jcqt:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i("q1tI");function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return a(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return a(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function s(t){var e=t,i=[];function a(t){var n=e;e=t,i.forEach((function(e){var i=e.update,o=e.options;(!o||!o.shouldUpdate||!o.shouldUpdate(n,t))&&i()}))}return[function(t){var s,r=(s=o(Object(n.useState)({}),2)[1],Object(n.useCallback)((function(){s({})}),[]));return Object(n.useEffect)((function(){var e={options:t,update:r};return i.push(e),function(){!function(t,e){var i=t.indexOf(e);if(-1===i)return;t.splice(i,1)}(i,e)}})),[e,a]},a,function(){return e}]}},jeLO:function(t,e,i){"use strict";var n=i("q1z7"),o=i.n(n),a=i("rFsW"),s=i("mT3t"),r=i("Fi5S"),l=s.a.prototype,c=s.a.extend({save:function(t,e,i){var n,o=this;if(a.a.isObject(t)||null==t?(n=t,i=e):(n={})[t]=e,i&&i.skipMagChanging&&this.urlRoot&&(i.url=this.url()+(this.url().indexOf("?")>-1?"&":"?")+"skip_changed=true"),!(i=i?a.a.clone(i):{}).skipPersist)var s=l.save.apply(this,arguments);if(s)return s.error((function(t,e){"abort"!=e&&(t.status&&t.status<500||(o.wasNotSaved=!0,RM.constructorRouter.raiseConnectionError()))})),s.success((function(){o.wasNotSaved&&o.trigger("re-saved"),o.wasNotSaved=!1})),this.skipResponse&&(s.skipResponse=!0),r.a.trigger("save:model",{model:this,setAttrs:n,options:i}),!this.skipMagChanging&&!i.skipMagChanging&&RM.constructorRouter.mag&&RM.constructorRouter.mag.set("changed",!0),s},sync:function(t,e,i){if("patch"==t.toLowerCase()&&e.collection&&e.collection.page){var n=e.collection.page.getCurrentViewport();if(!("default"==n||i&&i.forceDefaultViewport||this.isNested)){var o=e.toJSON(),s={};s["viewport_"+n]=a.a.pick(o["viewport_"+n],a.a.keys(i.attrs)),a.a.isEmpty(s["viewport_"+n])&&delete s["viewport_"+n];var r=a.a.difference(a.a.keys(i.attrs),a.a.keys(s["viewport_"+n]));a.a.extend(s,a.a.pick(e.attributes,r)),i.attrs=s}}return l.sync.apply(this,arguments)},parse:function(t,e){return e&&e.xhr&&e.xhr.skipResponse?(l.parse.apply(this,arguments),this.isNew()?t:void 0):l.parse.apply(this,arguments)},set:function(t,e,i){var n,s;if(a.a.isObject(t)||null==t?(n=t,s=e):((n={})[t]=e,s=i),(s=s||{}).viewport&&!s.forceDefaultViewport&&!s.xhr&&this.getViewport&&this.getViewport()!=s.viewport)return this["viewport_"+s.viewport]=a.a.extend(this["viewport_"+s.viewport]||{},n),this;var l=this.cloneJSON(),c=o.a.Model.prototype.set.apply(this,arguments);return r.a.trigger("set:model",{model:this,prevAttrs:l,setAttrs:n,options:s}),c},cloneJSON:function(){var t=this.toJSON();return a.a.each(t,(function(e,i){t[i]=a.a.cloneWithObjects(e)})),t}});e.a=c},kwFJ:function(module,exports){module.exports={"template-constructor-control-slideshow_manager":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon preloader noarrow" data-alt="Images" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Add Images"></div>\n\t\t</div>\n\n\t\t<div class="error-panel">\n\t\t\t<div class="error-panel-text"></div>\n\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t</div>\n\n\t\t<div class="drop-text">Drop here</div>\n\t</div>\n';return __p},"template-constructor-control-slideshow_manager-image":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="slideshow-image-wrapper '+(null==(__t=pic.error?"error":"")?"":__t)+'" data-num="'+(null==(__t=pic.num)?"":__t)+'" ',pic.errorText&&(__p+='data-error="'+(null==(__t=pic.errorText)?"":__t)+'" '),__p+=' >\n\t\t<div class="slideshow-image">\n\t\t\t<div class="num">'+(null==(__t=pic.num)?"":_.escape(__t))+'</div>\n\t\t\t<div class="image"',thumbUrl&&(__p+=" style=\"background-image: url('"+(null==(__t=thumbUrl)?"":__t)+"')\" "),__p+=' data-id="'+(null==(__t=pic.id)?"":_.escape(__t))+'">\n\t\t\t\t<div class="rmpreloader">\n\t\t\t\t\t<div class="shadow"></div>\n\t\t\t\t\t<div class="arc"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="remove" title="Delete"></div>\n\t\t\t<div class="update" title="Replace"></div>\n\t\t</div>\n\t</div>\n';return __p}}},l2W4:function(t,e){var i;i=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent),window.soundcloud={version:"0.1",debug:!1,_listeners:[],_redispatch:function(t,e,i){var n,o=this._listeners[t]||[],a="soundcloud:"+t;try{n=this.getPlayer(e)}catch(n){return void(this.debug&&window.console&&console.error("unable to dispatch widget event "+t+" for the widget id "+e,i,n))}window.jQuery?jQuery(n).trigger(a,[i]):window.Prototype&&$(n).fire(a,i);for(var s=0,r=o.length;s<r;s+=1)o[s].apply(n,[n,i]);this.debug&&window.console&&console.log(a,t,e,i)},addEventListener:function(t,e){this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)},removeEventListener:function(t,e){for(var i=this._listeners[t]||[],n=0,o=i.length;n<o;n+=1)i[n]===e&&i.splice(n,1)},getPlayer:function(t){var e;try{if(!t)throw"The SoundCloud Widget DOM object needs an id atribute, please refer to SoundCloud Widget API documentation.";if(e=i?window[t]:document[t]){if(e.api_getFlashId)return e;throw"The SoundCloud Widget External Interface is not accessible. Check that allowscriptaccess is set to 'always' in embed code"}throw"The SoundCloud Widget with an id "+t+" couldn't be found"}catch(t){throw console&&console.error&&console.error(t),t}},onPlayerReady:function(t,e){this._redispatch("onPlayerReady",t,e)},onMediaStart:function(t,e){this._redispatch("onMediaStart",t,e)},onMediaEnd:function(t,e){this._redispatch("onMediaEnd",t,e)},onMediaPlay:function(t,e){this._redispatch("onMediaPlay",t,e)},onMediaPause:function(t,e){this._redispatch("onMediaPause",t,e)},onMediaBuffering:function(t,e){this._redispatch("onMediaBuffering",t,e)},onMediaSeek:function(t,e){this._redispatch("onMediaSeek",t,e)},onMediaDoneBuffering:function(t,e){this._redispatch("onMediaDoneBuffering",t,e)},onPlayerError:function(t,e){this._redispatch("onPlayerError",t,e)}}},lRGI:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("zw1n"),l=i.n(r),c=i("M9xF"),d=i.n(c),h=i("3XvJ"),u=i.n(h),p=i("OTSC"),g={STYLE_PREFIXES:{viewer:[".rmwidget.widget-button .common-button"],viewerCurrentLink:[".maglink.current .widget-button .common-button"],constructor:[".block.button .common-button"]},generateIndividualStyleCSS:function(t){var e=this.STYLE_PREFIXES[t.env],i=t.model,o=i.tp,a=this,r=function(n){n=n||"default";var r={default:"",hover:"hovered",current:"current"},l={default:"",hover:"hover-",current:"current-"},c=s.a.isUndefined(r[n])?r.default:r[n],d=s.a.isUndefined(l[n])?l.default:l[n],h=s.a.map(e,(function(t){return t+'[data-id="'+i._id+'"]'+(c?"."+c:"")})).join(",\n")+" {\n";return h+=a.generateStylesStr({model:i,attrPrefix:d,indentation:!0,lineBreaks:!0,env:t.env,state:n}),h+="}\n\n","viewer"===t.env&&("current"===n&&(h+=a.STYLE_PREFIXES.viewerCurrentLink+'[data-id="'+i._id+'"] {\n',h+=a.generateStylesStr({model:i,attrPrefix:d,indentation:!0,lineBreaks:!0}),h+="}\n\n"),"icon"!==o&&"text_and_icon"!==o||(h+=s.a.map(e,(function(t){return t+'[data-id="'+i._id+'"]'+(c?"."+c:"")+" .icon"})).join(",\n")+" {\n",h+='\t background-image: url("'+(Modernizr.retina?i[d+"icon_raster2xUrl"]:i[d+"icon_rasterUrl"])+'");\n',h+="}\n\n","current"===n&&(h+=a.STYLE_PREFIXES.viewerCurrentLink+'[data-id="'+i._id+'"] .icon {\n',h+='\t background-image: url("'+(Modernizr.retina?i[d+"icon_raster2xUrl"]:i[d+"icon_rasterUrl"])+'");\n',h+="}\n\n"))),h},l=r("default");s.a.find(s.a.keys(i),(function(t){return/^current/.test(t)}))&&(l+=r("current")),l+=r("hover");var c="individual_button_style_"+i._id+"_"+t.env;Object(n.a)("#"+c).remove();var d=document.createElement("style");d.type="text/css",d.id=c,d.className="button_styles",d.appendChild(document.createTextNode(l)),document.getElementsByTagName("head")[0].appendChild(d)},generateStylesStr:function(t){var e="",i=t.model,n=t.indentation?"\t":"",o=";"+(t.lineBreaks?"\n":""),a=t.attrPrefix||"";return e+=n+"background-color: "+p.default.getRGBA(s("background-color"),s("background-color-opacity")/100)+o,e+=n+"border-radius: "+r(s("border-radius"))+o,e+=n+"border-width: "+r(s("border-width"))+o,e+=n+"border-color: "+p.default.getRGBA(s("border-color"),s("border-color-opacity")/100)+o,e+=n+"font-family: "+s("font-family")+o,e+=n+"font-weight: "+s("font-weight")+o,e+=n+"font-style: "+s("font-style")+o,e+=n+"color: "+p.default.getRGBA(s("color"),s("color-opacity")/100)+o,e+=n+"font-size: "+r(s("font-size"))+o,e+=n+"letter-spacing: "+r(s("letter-spacing"))+o,i["hover-tansition-duration"]&&(e+=n+"transition: ".concat(i["hover-tansition-duration"],"s")+o),t.env&&t.state&&"viewer"===t.env&&"hover"===t.state&&i["hover-cursor"]&&(e+=n+"cursor: ".concat(i["hover-cursor"])+o),e;function s(t){var e=i[a+t];return("inherit"===e&&a||void 0===e)&&(e=i[t]),"border-color"===t&&"hover-"===a?0==i["hover-border-width"]&&(e=i["border-color"]):"border-color"===t&&"current-"!==a&&0==i["border-width"]&&(e=i["hover-border-color"]),"border-color-opacity"===t&&"hover-"===a?0==i["hover-border-width"]&&(e=i["border-color-opacity"]):"border-color-opacity"===t&&0==i["border-width"]&&(e=i["hover-border-color-opacity"]),e}function r(t){return t+(/px/i.test(t)?"":"px")}},destroyIndividualStyleCSS:function(t){var e="individual_button_style_"+t.model._id+"_"+t.env;Object(n.a)("#"+e).remove()}};function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){v(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var b=f(f(f({},l.a),d.a),u.a),_=a.a.View.extend({MIN_ICON_MARGIN:8,initialize:function(t){t&&(s.a.bindAll(this),this.block=t.block,this.model=t.block&&t.block.model,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,s.a.extend(this.model,{env:this.environment}),this.generateIndividualStyleCSS({env:this.environment,model:this.model}),this.template=b["template-common-button-widget"],"constructor"===this.environment?this.text_template=b["template-constructor-block-button"]:this.text_template=b["template-viewer-widget-button"],this.render())},render:function(){this.model.tp;var t=g.generateStylesStr({model:this.model});this.setElement(Object(n.a)(this.template({data:this.model}))),Object(n.a)(this.text_template({data:this.model})).appendTo(this.$el),this.$text=this.$(".text"),this.$icon=this.$(".icon"),this.$button=this.$text.closest(".common-button"),this.$button.attr("style",t),this.applyButtonType(this.model.tp),"circle"===this.model.form&&this.applyCircleRadius(this.model.w),this.applyTextContainerSize(this.model),this.applyIconContainerSize(this.model),this.applyIconPosition(this.model),"viewer"===this.environment&&this.$container.css("border-radius",this.$button.css("border-radius")),this.$el.appendTo(this.$container),this.renderFinishTimeout=setTimeout(function(){var t=["background-color","background-color-opacity","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing"];"circle"!==this.model.form&&t.push("border-radius"),t.forEach(function(t){this.$button.css(t,"")}.bind(this)),this.applyTransition()}.bind(this),500)},renderButtonText:function(t){this.$el.find(".text").val(t)},renderButtonTextWithSizes:function(t,e){e&&this.applyTextContainerSize(e),this.$el.find(".text").val(t).css({display:t?"block":"none"})},applyTransition:function(){"viewer"!==this.environment||Modernizr.touch||this.model.transition&&this.$button.addClass("transition")},applyButtonType:function(t){"text"===t?(this.$text.css("display","inline-block"),this.$icon.css("display","none")):"icon"===t?(this.$icon.css("display","inline-block"),this.$text.css("display","none")):"text_and_icon"===t&&this.$icon.add(this.$text).css("display","inline-block")},applyCircleRadius:function(t){this.$button.css("border-radius","100%")},applyTextContainerSize:function(t){var e=t["letter-spacing"],i=0,n=0;e>0?i=e:e<0&&(n=e),this.$text.css({width:t.text_w+"px","padding-left":i+"px","text-indent":n+"px",height:"viewer"===this.environment?"".concat(t.h,"px"):"".concat(t.text_h,"px"),"line-height":"viewer"===this.environment?"".concat(t.h,"px"):"".concat(t.text_h,"px")})},applyIconContainerSize:function(t){t.tp;var e=t.icon_w,i=t.icon_h;t.icon_pos;this.$icon.css({width:e+"px",height:i+"px","margin-right":"0px","margin-left":"0px"})},calcIconMarginFromText:function(t){return Math.ceil(t/4)},calcIconTopBottomMargin:function(t){return Math.ceil(t/3)},calcTextTopBottomMargin:function(t){return Math.ceil(t/6)},applyIconPosition:function(t){var e=t.icon_pos;"left"===e?this.$button.css({"flex-direction":"row","-webkit-flex-direction":"row"}):"right"===e&&this.$button.css({"flex-direction":"row-reverse","-webkit-flex-direction":"row-reverse"})},generateIndividualStyleCSS:function(t){g.generateIndividualStyleCSS({env:t.env,model:t.model})},destroy:function(){clearTimeout(this.renderFinishTimeout),g.destroyIndividualStyleCSS({env:this.environment,model:this.model}),this.$el&&this.$el.remove()}});e.a=_},m41J:function(t,e,i){"use strict";var n=i("rFsW"),o=(i("Kf/z"),i("gobI")),a={sideAngles:{top:0,right:.5*Math.PI,bottom:Math.PI,left:1.5*Math.PI},calcOrientedTriangleSquare:function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(e.y-t.y)*(i.x-t.x)},intersectsOnAxisProjection:function(t,e,i,n){var o;return t>e&&(o=t,t=e,e=o),i>n&&(o=i,i=n,n=o),t<i&&(t=i),e>n&&(e=n),t<=e},isLinesIntersects:function(t,e,i,n){return a.intersectsOnAxisProjection(t.x,e.x,i.x,n.x)&&a.intersectsOnAxisProjection(t.y,e.y,i.y,n.y)&&a.calcOrientedTriangleSquare(t,e,i)*a.calcOrientedTriangleSquare(t,e,n)<=0&&a.calcOrientedTriangleSquare(i,n,t)*a.calcOrientedTriangleSquare(i,n,e)<=0},isConvexPolygonContainsPoint:function(t,e){for(var i=0;i<t.length;i++){var n=(i+1)%t.length;if(a.calcOrientedTriangleSquare(t[i],t[n],e)<0)return!1}return!0},isConvexPolygonsIntersects:function(t,e){var i,n,o,s;for(i=0;i<t.length;i++)if(a.isConvexPolygonContainsPoint(e,t[i]))return!0;for(i=0;i<e.length;i++)if(a.isConvexPolygonContainsPoint(t,e[i]))return!0;for(i=0;i<t.length;i++)for(n=(i+1)%t.length,o=0;o<e.length;o++)if(s=(o+1)%e.length,a.isLinesIntersects(t[i],t[n],e[o],e[s]))return!0;return!1},doBoundingBoxesIntersect:function(t,e){return t&&e&&!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)},calcBoundingBox:function(t,e,i){var o=a.calcRotatedBox(t),s=n.a.pluck(o,"x"),r=n.a.pluck(o,"y"),l=Math.min.apply(null,s),c=Math.max.apply(null,s),d=Math.min.apply(null,r),h=l,u=d,p=c-l,g=Math.max.apply(null,r)-d;return e&&(["n","c","s"].indexOf(e)>-1&&(h=t.left),["w","c","e"].indexOf(e)>-1&&(u=t.top)),i?{width:p,height:g,left:h,top:u}:{bb_width:p,bb_height:g,bb_left:h,bb_top:u}},boxToRect:function(t){return{width:t.width,height:t.height,top:t.top,bottom:t.top+t.height,left:t.left,right:t.left+t.width}},getBoundingBoxOfElements:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=t.map((function(t){return t.parentElement?1!==e?o.a.getBox(t,e):t.getBoundingClientRect():{bottom:0,height:0,left:0,right:0,top:0,width:0}}));return a.getBoundingBoxOfBoxes(i)},getBoundingBoxOfBoxes:function(t){var e=[],i=[];n.a.each(t,(function(t){var o=void 0!==t.right?n.a.extend({},t):a.boxToRect(t);e.push(o.left),e.push(o.right),i.push(o.top),i.push(o.bottom)}));var o={top:Math.min.apply(null,i),right:Math.max.apply(null,e),bottom:Math.max.apply(null,i),left:Math.min.apply(null,e)};return o.width=o.right-o.left,o.height=o.bottom-o.top,o},getBoundingBoxOfBlocks:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.map((function(t){var e=t.getBoxData({includeBoundingBox:!0,checkFixedPosition:!0});return{width:e.bb_w,height:e.bb_h,top:e.bb_y,left:e.bb_x}}));return a.getBoundingBoxOfBoxes(e)},calcRotatedBox:function(t){var e=[],i=[0,1,1,0],o=[0,0,1,1],a=t.left+t.width/2,s=t.top+t.height/2,r=t.sinAngle,l=t.cosAngle;return n.a.each(i,(function(n,c){var d=t.left+t.width*i[c],h=t.top+t.height*o[c],u=d-a,p=s-h;d=a+l*u+r*p,h=s+r*u-l*p;e.push({x:d,y:h})})),e},getDistance:function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},getBestPoints:function(t,e){for(var i,n,o,s=["right","left","bottom","top"],r={distance:1/0,fromPoint:{},toPoint:{}},l=0;l<s.length;l++)for(var c=0;c<s.length;c++)n=a.getSideCenter(t,s[l]),o=a.getSideCenter(e,s[c]),r=(i=a.getDistance(n,o))<r.distance?{distance:i,fromSide:s[l],fromPoint:n,toSide:s[c],toPoint:o}:r;return r},getSideCenter:function(t,e){var i;switch(e){case"left":i={x:t.left,y:t.top+t.height/2};break;case"top":i={x:t.left+t.width/2,y:t.top};break;case"bottom":i={x:t.left+t.width/2,y:t.top+t.height};break;case"right":default:i={x:t.left+t.width,y:t.top+t.height/2}}return i={x:(i.x-t.centerX)*t.cos-(i.y-t.centerY)*t.sin+t.centerX,y:(i.y-t.centerY)*t.cos+(i.x-t.centerX)*t.sin+t.centerY}},getPerpendicularEnd:function(t,e,i,n){var o=i.angle+a.sideAngles[t];return{x:n*Math.sin(o)+e.x,y:-n*Math.cos(o)+e.y}},getBox:function(t){var e=(t.$el&&t.$el[0]||t.length&&t[0]||t).getBoundingClientRect(),i=t.model?(t.model.attributes.angle||0)*Math.PI/180:0;return e=n.a.extend(e,{angle:i,sin:Math.sin(i),cos:Math.cos(i)}),e=n.a.extend(e,{centerX:e.left+e.width/2,centerY:e.top+e.height/2})},getResizedBoxNested:function(t,e,i,n){var o=i.width/e.width,a=i.height/e.height;return o="height"===n?a:o,a="width"===n?o:a,{left:(t.left-e.left)*o+i.left,top:(t.top-e.top)*a+i.top,width:t.width*o,height:t.height*a}},getResizedBoxByBB:function(t,e,i){var n=i.left+i.width/2,o=i.top+i.height/2,a=i.width/e.width,s=i.height/e.height,r=t.width*a,l=t.height*s;return{left:n-r/2,top:o-l/2,width:r,height:l}},getBoxLimits:function(t,e){var i=t.width/t.height>1,n=i?e.minheight/t.height:e.minwidth/t.width,o=i?e.maxwidth/t.width:e.maxheight/t.height;return{minwidth:e.minwidth?Math.round(t.width*n):1,minheight:e.minheight?Math.round(t.height*n):1,maxwidth:e.maxwidth?Math.round(t.width*o):1/0,maxheight:e.maxheight?Math.round(t.height*o):1/0}}};e.a=a},mIwl:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=["The follies of others are obvious, but our own hide from us; we love to parse others’ missteps but we cover up our own, as the cheat conceals the false die. It is in the nature of men to lay blame: we see others’ mistakes while our own passions swell, carrying us ever farther from improvement. — Buddhist wisdom","No one can long stand on tiptoe. He who thrusts himself forward is not a source of light. No glory comes to the self-satisfied, no honor to the boastful. The proud will not rise high. In the court of good sense, such people are like table discards, repellent to all. The sensible person does not rely on self. — Lao-Tzu","Simplicity in life, language and habits strengthens a nation, but a life of luxury, fancy language and effeminate habit leads to weakness and death. — John Ruskin","Truth is not a matter of talking but comes only through labor and observation. And when you have one truth in hand, two others, like the first leaves of a dicotyledonous plant, will probably appear. — John Ruskin","All things have a beginning and an end. So it is with mankind: there is a beginning and end to all  human affairs. He who understands what is a beginning and what is an end is closer to the truth. — Confucius","Most people are dismayed if deprived of their pleasures. The right course belongs to him who relishes even the passing away of the reason for his joy and is not bitter. — Pascal","When we are clear about things, we have knowledge; with knowledge, we seek the path of truth; when the search is rewarded, the heart becomes good; with the heart made good, the moral view of things that leads to virtue is attained. — Confucius","Wisdom has three faces: when seen from afar, it is grand and severe; on closer approach, it is tender and welcoming; when we are close enough to hear it, the words of  wisdom are severe and demanding. — Chinese wisdom","The sun constantly floods the world with its light, but its light is not exhausted; so your mind should send its light in all directions and not be exhausted. It should flow everywhere, without diminishment, and when it encounters an obstacle, it should react, not with annoyance or anger but should serenely clarify all that yearns to accept it, without any lessening or weariness, bringing light to all that is turned to it, leaving in shadow only that which turns its face away. — Marcus Aurelius","As torches and fireworks pale to invisibility in the sun, so the mind, even the mind of genius, and beauty pale and are eclipsed by the heart’s goodness. — Schopenhauer","Music and sweet treats bring the wanderer to a stop, but wisdom has neither flavor nor smell. When looked for, it is invisible; when listened for, it is inaudible, yet its goodness is inexhaustible. The most powerful thing in the world cannot be seen, heard or touched. — Lao-Tzu","The best ideas are usually those that come without effort, out of the blue. The great intellectual creations come easily. Only a great person can create something great, and such a one works without strain. — John Ruskin","He who talks much rarely puts his words into action. But the wise person fears that his words may not be translated into action. The wise do not utter empty words, lest their actions be inconsistent with their words. — Chinese wisdom","Fear ignorance, but fear false knowledge even more. Turn your eyes from the deceptive world and do not trust your feelings, for they lie; rather look inward to the impersonal, eternal self. Truly, ignorance is like a sealed and airless chamber; in it, the soul sits like a caged bird, neither singing nor spreading its wings. But ignorance is better than any school of thought that is not guided by the wisdom of the soul. — Buddhist wisdom","Some seek their good or happiness in power; others in science, and others in the pleasures of the flesh. But those who come truly close to the good understand that it cannot consist in what can only be mastered by a few. They understand that the true good of humankind is that which can be achieved by all people, without division and without envy; its nature  is such that none can lose it if they do not so choose. — Pascal","The wise person asks only of himself; the unwise man demands everything from others. — Chinese wisdom","To know much and not to put one’s self forward as knowing is the height of morality. To know little and put one’s self forward as knowledgeable is an illness. Only by understanding the disease can one expunge it. — Lao-Tzu","Speak only of that which is as clear to you as the morning, or be silent. — Talmud","Conquer ferocity with love, evil with good, miserliness with generosity, the liar with truth. — Buddhist wisdom","People seek satisfaction, throwing themselves from one thing to another because they feel the emptiness of their lives but do not yet realize the emptiness of the new delight that attracts them. — Pascal","The skilled warrior does not rage. The skilled fighter is not angry. He who is skilled in the use of people is not provocative. This is the virtue of non-resistance. This is being in agreement with Heaven. — Lao-Tzu","The first and principal characteristic of a good and wise person is his consciousness that he knows very little, that many people know more and he seeks always to learn, to study, and not to teach. Those who wish to teach or direct neither teach nor lead well. — John Ruskin","The virtuous person seeks to follow the direct path to the end. What is to be feared is to go halfway and then to weaken. — Chinese wisdom"],o=function(){return n[Math.floor(Math.random()*n.length)]}},mT3t:function(t,e,i){"use strict";var n=i("q1z7"),o=i.n(n),a=i("rFsW"),s=o.a.Model.extend({parse:function(t,e){return!e||!e.xhr||this.isNew()||e&&e.noSocketUpdate||(a.a.isEmpty(t)&&(t=this.toJSON(a.a.pick(e,"viewport","fixViewports"))),this.triggerSocketUpdate(t,e)),o.a.Model.prototype.parse.apply(this,arguments)},triggerSocketUpdate:function(t,e){var i=t;if(e&&e.patch&&(i=a.a.extend({},e.attrs,this.pick("_id","pid"))),i=this.getChangedAttributes?this.getChangedAttributes():i,a.a.isEmpty(i)&&(i=this.toJSON()),!i.pid&&this.getPageId&&"Page"==!this.name&&(i.pid=this.getPageId()),this.getViewport&&"default"!=this.getViewport()){var n=i.pid||this.getPageId&&this.getPageId();return this.triggerViewportUpdate(n)}RM.constructorRouter.trigger("update_from_server",this.name,i)},triggerViewportUpdate:function(t){RM.constructorRouter.trigger("update_from_server","Viewport",t)}});e.a=s},"mX/r":function(t,e,i){"use strict";var n=i("E913");i.n(n).a},muOB:function(t,e,i){"use strict";var n=i("IzrY");i.n(n).a},n1zk:function(t,e,i){},nnuN:function(t,e,i){"use strict";i.r(e),i.d(e,"WEIGHTS",(function(){return s})),i.d(e,"PROVIDERS",(function(){return r}));var n=i("rFsW"),o=i("DqjY"),a=i("xi34"),s={n1:"Thin",n2:"ExtraLight",n3:"Light",n4:"Regular",n5:"Medium",n6:"SemiBold",n7:"Bold",n8:"ExtraBold",n9:"Black",i1:"Thin Italic",i2:"ExtraLight Italic",i3:"Light Italic",i4:"Italic",i5:"Medium Italic",i6:"SemiBold Italic",i7:"Bold Italic",i8:"ExtraBold Italic",i9:"Black Italic",v:"Variable"},r={system:{title:"System Fonts",url:""},google:{title:"Google Fonts",url:"http://www.google.com/fonts"},typekit:{title:"Typekit",url:"http://www.typekit.com/"},webtype:{title:"<Webtype>",url:"http://www.webtype.com/"},typetoday:{title:"Type.today",url:"https://type.today/"},custom:{title:"Custom web font",url:""}},l=function(t){this.edit_params=t,this.proxyMethods(["set","get","fetch","on","off","save"]),this.updateTypetodayVariations()};l.prototype={id:"_fonts",MAX_VISIBLE_TYPEKIT_FONTS:5,FVD_NAMES:s,PROVIDERS:r,proxyMethods:function(t){var e=this,i=this.edit_params;n.a.each(t,(function(t){e[t]=function(){return i[t].apply(i,arguments)}}))},updateTypetodayVariations:function(){var t=!1,e=n.a.map(this.get("fonts"),(function(e){if("typetoday"===e.provider){var i=n.a.find(o.a.fontsShortList.typetoday,{name:e.css_name}),a=Boolean(i&&n.a.difference(i.variations,e.variations).length);return t=t||a,a?n.a.extend({},e,{variations:n.a.union(e.variations,i&&i.variations)}):e}return e}));t&&this.save({fonts:e},{silent:!0})},appendFontsCssToDocument:function(t,e){return o.a.appendFontsCssToDocument(n.a.extend({fonts:this.get("fonts")},t),e)},findFontByCSSName:function(t){return n.a.find(this.get("fonts"),(function(e){return e.css_name.toLowerCase()===t.toLowerCase()}))||{css_name:t,name:t}},getProviderData:function(t){var e=this.PROVIDERS[t]||{};return n.a.defaults(e,{title:"",url:""}),e},getStyleName:function(t,e,i){var n,a=("italic"===e.toLowerCase()?"i":"n")+t/100;return i&&(n=o.a.getCustomVariationNameByFVD(i,a)),n||this.FVD_NAMES[a]},getVisualRenderedFontStyles:function(t,e,i){var o={"font-weight":e};o["font-style"]=i;var a=this.findFontByCSSName(t),s=9999;return a&&(o["font-family"]=t,n.a.each(a.variations,(function(t){var i=100*(t.substr(1,1)-0),n=Math.abs(i-e);n<s&&(o["font-weight"]=i,s=n)})),Math.abs(700-e)<s&&(o["font-weight"]=700)),o},findCommonFontsStylesAvailable:function(t){var e=[];return n.a.each(t,n.a.bind((function(t){var i=this.findFontByCSSName(t);if(i){var o=[];n.a.each(i.variations,(function(t){var e=100*(t.substr(1,1)-0),i="n"===t.substr(0,1)?"normal":"italic";o.push(e+"-"+i)})),e.push(o)}}),this)),e.length>0&&(e=n.a.intersection.apply(this,e)),e},typekitFontsCount:function(t){var e=n.a.where(t,{provider:"typekit"}).length,i=n.a.where(t,{provider:"typekit",hidden:!0}).length;return{visible:e-i,hidden:i}},changeFontHidden:function(t,e,i,o){var s=n.a.cloneWithObjects(this.get("fonts")),r=n.a.find(s,(function(e){return e.css_name.toLowerCase()===t.toLowerCase()}))||{};return r.hidden=e,r._id&&r.is_personal&&a.a.ajax({url:"/api/customfonts",method:"PATCH",dataType:"json",contentTypeType:"application/json",data:{_id:r._id,hidden:r.hidden,mag_user:i,mag_num_id:o}}),this.typekitFontsCount(s).visible>this.MAX_VISIBLE_TYPEKIT_FONTS?{error:"typekit-full-house"}:(this.save("fonts",s),{})},getUsedFontsCache:function(){var t={};return n.a.each(this.get("fonts"),(function(e){t[e.css_name]={temporary:e.temporary,hidden:e.hidden}})),t},addFonts:function(t,e){var i,o,a=n.a.cloneWithObjects(this.get("fonts"));return n.a.each(t,n.a.bind((function(o){n.a.contains(["template","paste"],e)&&delete o.used_variations,i=n.a.find(a,(function(t){return t.css_name.toLowerCase()===o.css_name.toLowerCase()})),n.a.contains(["font-explorer","manual"],e)&&(i?i.hidden=!1:a.push(o)),"font-upload"===e&&(i?n.a.extend(i,t[0]):a.push(o)),n.a.contains(["template","paste"],e)&&(i||(o.hidden=!0,a.push(o)))}),this)),"font-explorer"===e&&this.typekitFontsCount(a).visible>this.MAX_VISIBLE_TYPEKIT_FONTS?{error:"typekit-full-house"}:((o=RM.constructorRouter)&&(o=o.workspace)&&(o=o.controls)&&(o=o.findControl("text_typography"))&&o.plusAnimation(),this.save({fonts:a},{silent:n.a.contains(["template","paste","manual"],e)}),this.appendFontsCssToDocument({version:"edit"},(function(){window.RM.constructorRouter.trigger("font-added")})),{})},removeFonts:function(t){var e=n.a.cloneWithObjects(this.get("fonts"));n.a.each(e,(function(e){n.a.each(t,(function(t){e.css_name.toLowerCase()===t.toLowerCase()&&(e.hidden=!0)}))})),this.save("fonts",e)},clearTempFonts:function(){if(n.a.findWhere(this.get("fonts"),{temporary:!0})){var t=n.a.cloneWithObjects(this.get("fonts"));t=n.a.filter(t,(function(t){var e=!(t.temporary&&t.hidden);return delete t.temporary,e})),this.save("fonts",t)}}},e.default=l},o3C3:function(module,exports){module.exports={"template-constructor-helpers-font-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rmfontselector">\n\n\t\t<div class="tabs-switcher">\n\t\t\t<div class="caption-system">System</div>\n\t\t\t<div class="caption-custom">Custom</div>\n\t\t</div>\n\n\t\t<div class="categories">\n\n\t\t\t<div class="scroll-wrapper system">\n\t\t\t\t<div class="category-wrapper">\n\t\t\t\t\t<div class="category">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\n\t\t\t<div class="scroll-wrapper custom">\n\t\t\t\t<div class="category-wrapper">\n\t\t\t\t\t<div class="category">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="add-font">\n\t\t\t<div class="add-font-button" data-type="upload">Upload</div>\n\t\t\t<div class="add-font-button" data-type="library">Library</div>\n\t\t</div>\n\n\t\t<div class="upload-font invisible"></div>\n\t</div>\n\n';return __p},"template-constructor-helpers-font-selector-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="category-element icon-'+(null==(__t=font.provider)?"":__t)+" ",font.hidden&&(__p+="hidden"),__p+="  "+(null==(__t=font.is_personal&&!canUploadFonts?"disabled":"")?"":__t)+" "+(null==(__t=font.is_personal?"personal":"")?"":__t)+'" data-css_name="'+(null==(__t=font.css_name)?"":__t)+'" data-provider="'+(null==(__t=font.provider)?"":__t)+'">\n\t\t',"system"==font.provider||"custom"==font.provider&&!font.is_personal||(__p+="\n\n\t\t\x3c!-- Не даем удалять/восстанавливать коллабораторам --\x3e\n\t\t",("custom"!=font.provider||canEditCustomFonts)&&(__p+='\n\t\t<div class="action"></div>\n\t\t'),__p+="\n\n\t\t\t","custom"==font.provider&&font.is_personal&&canEditCustomFonts?__p+='\n\t\t\t\t<div class="edit-custom-font"></div>\n\t\t\t':__p+='\n\t\t\t\t<a class="tp-icon" target="_blank" title="'+(null==(__t=provider_data.title)?"":_.escape(__t))+'" '+(null==(__t=provider_data.url?'href="'+provider_data.url+'"':"")?"":__t)+"></a>\n\t\t\t",__p+="\n\t\t"),__p+='\n\t\t<div style="font-family:'+(null==(__t=font.css_name)?"":__t)+'" class="caption">'+(null==(__t=font.name)?"":__t)+"</div>\n\t</div>\n\n";return __p},"template-constructor-helpers-font-selector-upload":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="uf-section font-name">\n\t\t<input type="text" name="font-name-input" class="font-name-input" placeholder="Enter font name" value="'+(null==(__t=name)?"":_.escape(__t))+'"/>\n\t</div>\n\n\t<div class="uf-section weight-list invisible">\n\t\t<div class="uf-panel weights">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="results-wrapper">\n\t\t\t\t\t<div class="results">\n\t\t\t\t\t\t<div class="list">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button add-weight">Add weight</div>\n\t\t\t\t\t\t<a class="uf-link add-tracking-code" href="http://help.readymag.com/hc/en-us/articles/360018417451-Text" target="_blank"><span>Add tracking code</span></a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="gutter"></div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="uf-panel selector invisible">\n\t\t\t<div class="available-list">\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n1">Thin</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i1">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n2">ExtraLight</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i2">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n3">Light</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i3">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n4">Regular</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i4">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n5">Medium</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i5">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n6">SemiBold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i6">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n7">Bold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i7">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n8">ExtraBold</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i8">Italic</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="available-weight">\n\t\t\t\t\t<div class="bullet"></div>\n\t\t\t\t\t<div class="weight-item name" data-var="n9">Black</div>\n\t\t\t\t\t<div class="weight-item italic" data-var="i9">Italic</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="uf-panel uploader invisible">\n\t\t\t<div class="button select">Regular</div>\n\t\t\t<div class="button upload">\n\t\t\t\t<span>Upload .woff</span>\n\t\t\t\t<input class="font-file-upload" id="font-file-upload" type="file" accept=".woff" data-url="/api/upload/font"/>\n\t\t\t</div>\n\t\t\t<div class="disclaimer">By uploading webfonts you<br/>agree that you own or have<br/>the necessary license.</div>\n\t\t</div>\n\t</div>\n\n\t<div class="uf-section actions">\n\t\t<div class="done disabled"><span class="caption">Done</span></div>\n\t</div>\n\t<div class="dragover-overlay"></div>\n';return __p},"template-constructor-helpers-font-selector-upload-weights":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="\n\t",_.each(weights,(function(t){__p+='\n\t\t<div class="weight" data-type="'+(null==(__t=t.type)?"":__t)+'">\n\t\t\t<div class="name">'+(null==(__t=names[t.type])?"":__t)+'</div>\n\t\t\t<div class="reupload-weight">\n\t\t\t\t<input class="font-file-re-upload" id="font-file-re-upload" type="file" accept=".woff" data-url="/api/upload/font"/>\n\t\t\t</div>\n\t\t\t<div class="delete-weight"></div>\n\t\t</div>\n\t'})),__p+="\n";return __p}}},oR3H:function(t,e,i){"use strict";var n=i("LEh1");i.n(n).a},oRHT:function(module,exports){module.exports={"template-constructor-control-text_edit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Edit" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t</div>\n';return __p}}},onY4:function(t,e,i){"use strict";var n=i("q1z7"),o=i.n(n),a=i("rFsW"),s=i("OTSC"),r=i("v92f"),l=i("Kf/z"),c=a.a.extend({},o.a.Events,{initialize:function(t){return this.undoStacks={},this.redoStacks={},this.pendingTransactions={},this.syncManager=t,this},add:function(t,e){if(e=e||{},a.a.defaults(e,{redo:!1,undo:!1}),!e.page){var i=a.a.groupBy(t,(function(t){return t.model.getPageId()}));if(a.a.keys(i)>1)return void a.a.each(i,(function(t,i){this.add(t,e)}))}if(!e.replace){var n=e.page||t[0].model.getPageId();if(!n)return console.error("cannot save history without pageId",t);this.redoStacks[n]=this.redoStacks[n]||[],this.undoStacks[n]=this.undoStacks[n]||[];var o={widgetsOrder:RM.constructorRouter.indexController.snapshot(n),actions:t};e.undo?this.redoStacks[n].push(o):(this.undoStacks[n].push(o),e.redo||(this.redoStacks[n]=[])),this.triggerChange(n)}},transactionStart:function(t,e){e=e||{},t=a.a.isArray(t)?t:[t];var i=s.default.generateUUID();return this.pendingTransactions[i]={entry:t&&t.length?this.syncManager.getHistoryDict(this.syncManager.getChangeset(t)):[],options:e},i},addToTransaction:function(t,e){e=a.a.isArray(e)?e:[e];var i=this.pendingTransactions[t]||{};if(e&&e.length){var n=this.syncManager.getHistoryDict(this.syncManager.getChangeset(e));this.pendingTransactions[t].entry=[].concat(i.entry||[],n)}},transactionEnd:function(t){var e=this.pendingTransactions[t];e&&(this.syncManager.addHistoryStep(e.entry,e.options),delete this.pendingTransactions[t])},undo:function(t){if(!t)return console.error("cannot undo without pageId parameter");if(a.a.isEmpty(this.undoStacks[t]))return this.triggerChange(t);var e=this.undoStacks[t].pop(),i=e.actions,n={undo:!0,page:t,applySnapshot:function(){Object(l.a)("constructor.zIndex")&&RM.constructorRouter.indexController.applySnapshot(e.widgetsOrder,t)}};this.fillUndoKeys(i),this.syncManager.saveGroup(a.a.pluck(i,"attrs"),n),this.triggerUndo(t)},redo:function(t){if(!t)return console.error("cannot redo without pageId parameter");if(a.a.isEmpty(this.redoStacks[t]))return this.triggerChange(t);var e=this.redoStacks[t].pop(),i=e.actions,n={redo:!0,page:t,applySnapshot:function(){Object(l.a)("constructor.zIndex")&&RM.constructorRouter.indexController.applySnapshot(e.widgetsOrder,t)}};this.fillUndoKeys(i),this.syncManager.saveGroup(a.a.pluck(i,"attrs"),n),this.triggerRedo(t)},fillUndoKeys:function(t){a.a.each(t,(function(t){var e=t.model.toJSON();if(a.a.each(t.model.nonUndoKeys,(function(i){if(t.attrs[i]=e[i],"Widget"==t.model.name){var n=r.b.widgetViewportFields(t.model.get("type"));a.a.each(r.b.viewport_list,(function(o){e[o]&&-1!=n.indexOf(i)&&(t.attrs[o]=t.attrs[o]||{},t.attrs[o][i]=e[o][i])}))}})),!a.a.isEmpty(t.model.undoKeys)){e=t.model.toJSON();e=a.a.extend(e,t.attrs),t.attrs=e}}))},clearHistory:function(t){this.redoStacks[t]=[],this.undoStacks[t]=[],this.triggerChange(t)},triggerChange:function(t){this.trigger("change",this.getLength(t))},triggerUndo:function(t){this.trigger("undo",t)},triggerRedo:function(t){this.trigger("redo",t)},getLength:function(t){return{undo:(this.undoStacks[t]||[]).length,redo:(this.redoStacks[t]||[]).length,page:t}},setCustomHandlers:function(t){if(!this.saved){var e=RM.constructorRouter.workspace.page.id;return this.saved={undo:this.undo,redo:this.redo,getLength:this.getLength},this.undo=t.undo,this.redo=t.redo,this.getLength=t.getLength,this.triggerChange(e),{triggerChange:a.a.bind(this.triggerChange,this),triggerUndo:a.a.bind(this.triggerUndo,this),triggerRedo:a.a.bind(this.triggerRedo,this)}}},removeCustomHandlers:function(){if(this.saved){a.a.extend(this,this.saved),this.saved=void 0;var t=RM.constructorRouter.workspace.page.id;this.triggerChange(t)}},setEmptyHandlers:function(){this.setCustomHandlers({undo:function(){},redo:function(){},getLength:function(t){return{undo:0,redo:0,page:t}}})}});RM.HistoryModel=c,e.a=c},phNm:function(t,e,i){"use strict";i.d(e,"c",(function(){return _})),i.d(e,"a",(function(){return y}));var n=i("q1z7"),o=i.n(n),a=i("rFsW"),s=i("xi34"),r=i("Fi5S"),l=i("tZHv");function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function u(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(t){var e="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return g(t,arguments,v(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,t)})(t)}function g(t,e,i){return(g=m()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return i&&f(o,i.prototype),o}).apply(null,arguments)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(){return{skus:{},prices:{},uniqSkusCount:0,uniqPricesCount:0,shippableProducts:0,changed:(new Date).toISOString(),order:null}},_={outOfStock:"outOfStock",nothingToInvoice:"nothingToInvoice"},y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(o,t);var e,i,n=(e=o,i=m(),function(){var t,n=v(e);if(i){var o=v(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return u(this,t)});function o(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=n.call(this,t)).type=e,i}return o}(p(Error)),w=function(t,e,i,n){return RM.screenshot&&(this.page=n),this.isMagLoaded=!1,this.haveEcommerceCartWidget=!1,this.isCartSidebarHidden=!0,this.productsLoading=!1,this.productsLoaded=!1,this.productsLoadingError=!1,this.cancelingOrder=!1,this.products=null,this.storageKey="_rmcartdata",this.environment=i,this.mag=e,this.router=t,this.events=a.a.extend({},o.a.Events),this.cartData=b(),this.cartItemsLimit=25,this.isConstructor()?this.mag.has("_id")?this.onMagFullLoaded():r.a.once("mag:loadfull:complete",this.onMagFullLoaded,this):(this.mag.model.has("_id")&&this.onMagFullLoaded(),this.restoreBackupCartData()),this};a.a.extend(w.prototype,{CONNECTION_TIMEOUT:5e3,stripeJsSrc:"https://js.stripe.com/v3/",isConstructor:function(){return this.environment===l.a.environment.constructor},isViewer:function(){return this.environment===l.a.environment.viewer},isPreview:function(){return this.environment===l.a.environment.preview},getStorageKey:function(){return"".concat(this.storageKey,"_").concat(this.mag.num_id)},onMagFullLoaded:function(){this.isMagLoaded||(this.isMagLoaded=!0,this.haveEcommerceCartWidget=this.hasEcommerceWidget(),this.isMagConnectedToStripe()&&!this.productsLoading&&(this.addStripeLibrary(),this.getProducts()))},hasEcommerceWidget:function(){var t=this.isConstructor()?this.mag.globalWidgets:RM.screenshot?this.page.widgetsData:[].concat(d(this.mag.staticGlobalWidgetsData),d(this.mag.aboveGlobalWidgetsData));return w.hasEcommerceWidget(this.environment,t)},getEcommerceData:function(){var t=null;return this.isConstructor()?this.mag.has("ecommerce_data")&&(t=this.mag.get("ecommerce_data")):this.mag.model.has("ecommerce_data")&&(t=this.mag.model.get("ecommerce_data")),t},getStripeConnectedUserId:function(){if(!this.isMagLoaded)return null;var t=this.getEcommerceData();return t&&t.stripe&&t.stripe.stripe_data&&t.stripe.stripe_data.stripe_user_id?t.stripe.stripe_data.stripe_user_id:null},getProducts:function(){this.productsLoading=!0;var t=this.isConstructor()?this.mag.get("num_id"):this.mag.model.get("num_id"),e=this.isViewer()?"published_projects":"projects";s.a.ajax({type:"GET",url:"/api/"+e+"/"+t+"/ecommerce/stripe/products/",success:function(t){t&&t.data&&(this.products=t.data),this.productsLoading=!1,this.productsLoaded=!0,this.events.trigger("ecommerce:loadproducts:complete")},error:function(t){t.status,this.productsLoading=!1,this.productsLoadingError=!0,this.events.trigger("ecommerce:loadproducts:complete")},context:this})},addStripeLibrary:function(){if(!(this.isConstructor()||window.Stripe&&window.Stripe.version)){var t=document.createElement("script"),e=document.getElementsByTagName("body")[0];t.setAttribute("async","async"),t.setAttribute("src",this.stripeJsSrc),e.appendChild(t)}},isMagConnectedToStripe:function(){if(!this.isMagLoaded)return!1;var t=this.getEcommerceData();return!!t&&!!(t.stripe&&t.stripe.status&&"connected"===t.stripe.status&&t.stripe.stripe_data&&t.stripe.stripe_data.stripe_user_id)},connectToStripe:function(){return new Promise(function(t,e){window.open("/api/connect/ecommerce/stripe/connect?num_id="+this.mag.get("num_id"),"_blank"),this.initSocket().then(function(e){this.mag.set({ecommerce_data:e},{silent:!0}),t()}.bind(this)).catch((function(t){e(t)}))}.bind(this))},disconnectFromStripe:function(){return new Promise(function(t,e){s.a.ajax({type:"GET",url:"/api/connect/ecommerce/stripe/disconnect?num_id="+this.mag.get("num_id"),success:function(e){e&&e.status&&(this.products=null,this.mag.set({ecommerce_data:{stripe:e}},{silent:!0})),t(e)},error:function(t){e(t)},context:this})}.bind(this))},initSocket:function(){return new Promise(function(t,e){var i=window.location.origin===l.a.readymag_auth_host&&l.a.stripe_live?"sockets.readymag.com/stripe-auth":"/stripe-auth",n=io(i,{timeout:this.CONNECTION_TIMEOUT});n.on("connect",function(){n.emit("wainting for mag stripe auth update",{num_id:this.mag.get("num_id"),user:this.router.me.pick("name","email","_id"),hash:this.mag.get("socket_hash")}),n.on("state-update",(function(i){n.disconnect(),i.error?e(i.error):t(i.ecommerce_data)}))}.bind(this))}.bind(this))},checkCartDisabledControls:function(){if(this.haveEcommerceCartWidget){var t=this.getEcommerceCartBlock(),e=this.getEcommerceData();t&&t.checkDisabledControls(e.stripe&&e.stripe.status&&"connected"===e.stripe.status)}},getEcommerceCartBlock:function(){return this.haveEcommerceCartWidget&&this.isConstructor()?this.router.workspace.findBlockByFunction((function(t){return t.attributes.type===l.a.ecommerceCartBlockName})):null},getCartWidgetData:function(){if(!this.isConstructor()){var t=this.mag.staticGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}));return t||this.mag.aboveGlobalWidgetsData.find((function(t){return t.type===l.a.ecommerceCartBlockName}))}return null},getProductsLikeOptionsList:function(t){var e=[];return this.products&&Array.isArray(this.products)&&(e=this.products.filter((function(e){return e.active&&(e.articles&&e.articles.length||e.prices&&e.prices.length)||t&&t===e.id})).map((function(t){return{value:t.id,caption:t.name}}))),e.unshift({value:"default",caption:"None"}),e},isProductActive:function(t){if(!t)return!1;if("default"===t)return!0;var e=this.getProductById(t);return!!e&&(e.active&&(this.productHasActiveArticle(e)||this.productHasActivePrice(e)))},productHasActiveArticle:function(t){return t&&t.articles&&t.articles.length&&t.articles.some((function(t){return t.active}))},productHasActivePrice:function(t){return t&&t.prices&&t.prices.length&&t.prices.some((function(t){return t.active}))},isSkuAvailable:function(t){return!!t.active&&("infinite"===t.inventory.type||("finite"===t.inventory.type&&t.inventory.quantity>0||"bucket"===t.inventory.type&&("in_stock"===t.inventory.value||"limited"===t.inventory.value)))},getProductById:function(t){return this.products&&Array.isArray(this.products)?this.products.find((function(e){return e.id===t})):null},getProductsStatus:function(){return this.productsLoading?"loading":this.productsLoaded?"loaded":"failed"},getSkusByProductId:function(t){var e=this.getProductById(t);return e?e.articles:null},getFirstAvailableSku:function(t){return t?t.find(function(t){return this.isSkuAvailable(t)}.bind(this)):null},getFirstAvailableSkuForProductId:function(t){return this.getFirstAvailableSku(this.getSkusByProductId(t))},changeCartSidebarVisibility:function(){return this.isCartSidebarHidden=!this.isCartSidebarHidden,this.events.trigger("ecommerce:cartsidebar:visibility:changed",this.isCartSidebarHidden),this.isCartSidebarHidden},checkItemQuantity:function(t){if("string"!=typeof t){var e=t;return!!("infinite"===e.inventory.type||"finite"===e.inventory.type&&e.inventory.quantity||"bucket"===e.inventory.type&&"out_of_stock"!==e.inventory.value)}if(this.cartData.skus[t]){var i=this.cartData.skus[t];return"infinite"===i.inventory.type||"finite"===i.inventory.type&&i.cart_count<i.inventory.quantity||"bucket"===i.inventory.type&&"out_of_stock"!==i.inventory.value}return!1},checkItemQuantityOnUpdate:function(t){if(this.cartData.skus[t]){var e=this.cartData.skus[t];return"infinite"===e.inventory.type||"finite"===e.inventory.type&&e.cart_count<=e.inventory.quantity||"bucket"===e.inventory.type&&"out_of_stock"!==e.inventory.value}return!1},getCartData:function(){return this.cartData},markCartChange:function(){this.cartData.changed=(new Date).toISOString()},addToCart:function(t){if(!t||!t.id)return new y("Sku data isn't valid or doesn’t have an id");if(this.cartData.skus[t.id]){if(!this.checkItemQuantity(t.id))return new y("You can’t add this product with attribute "+t.id+". It's out of stock",_.outOfStock);this.cartData.skus[t.id]=Object.assign({},t,{cart_count:this.cartData.skus[t.id].cart_count+1})}else{if(this.cartData.uniqSkusCount+1>this.cartItemsLimit)return new y("You can’t add more than "+this.cartItemsLimit+" items to the cart");if(!this.checkItemQuantity(t))return new y("You can’t add this product with attribute "+t.id+". It's out of stock",_.outOfStock);this.cartData.skus[t.id]=Object.assign({},t,{cart_count:1}),this.cartData.uniqSkusCount+=1,t.productObject.shippable&&(this.cartData.shippableProducts+=1)}return this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData),this.cartData},addPriceToCart:function(t){if(!t||!t.id||!t.active)return new y("Price data isn't valid or doesn’t have an id");if(this.cartData.prices[t.id])this.cartData.prices[t.id]=Object.assign({},t,{cart_count:this.cartData.prices[t.id].cart_count+1});else{if(this.cartData.uniqPricesCount+1>this.cartItemsLimit)return new y("You can’t add more than "+this.cartItemsLimit+" items to the cart");this.cartData.prices[t.id]=Object.assign({},t,{cart_count:1}),this.cartData.uniqPricesCount+=1}return this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData),this.cartData},increaseCartItem:function(t){this.cartData.prices[t]&&(this.cartData.prices[t].cart_count+=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},increaseSkuCartItem:function(t){if(this.cartData.skus[t]){if(!this.checkItemQuantity(t))return new y("You can’t add more this product with attribute "+t+". It's out of stock",_.outOfStock);this.cartData.skus[t].cart_count+=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData)}},decreaseCartItem:function(t){this.cartData.prices[t]&&this.cartData.prices[t].cart_count>1&&(this.cartData.prices[t].cart_count-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},decreaseSkuCartItem:function(t){this.cartData.skus[t]&&this.cartData.skus[t].cart_count>1&&(this.cartData.skus[t].cart_count-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},removeFromCart:function(t){this.cartData.prices[t]&&(delete this.cartData.prices[t],this.cartData.uniqPricesCount-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},removeSkuFromCart:function(t){this.cartData.skus[t]&&(this.cartData.skus[t].productObject.shippable&&(this.cartData.shippableProducts-=1),delete this.cartData.skus[t],this.cartData.uniqSkusCount-=1,this.markCartChange(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData))},clearCart:function(){this.cartData=b(),this.backupCartData(),this.events.trigger("ecommerce:cartdata:changed",this.cartData)},updateCartSkus:function(t){var e=this,i=[];if(t.forEach((function(t){e.cartData.skus[t.id]&&(e.cartData.skus[t.id]=Object.assign({},e.cartData.skus[t.id],t),e.checkItemQuantityOnUpdate(t.id)||i.push(e.cartData.skus[t.id].productObject.name))})),this.backupCartData(),i.length)return i},updateCartData:function(){return new Promise(function(t,e){this.cartData&&this.cartData.skus||e(new y("Empty cart"));var i=[];for(var n in this.cartData.skus)this.cartData.skus.hasOwnProperty(n)&&i.push(n);var o=i.length?a.a.uniq(i).join(","):null;s.a.ajax({type:"GET",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/skus/"+(o?"?skus_ids="+o:""),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){if(i&&i.data){var n=this.updateCartSkus(i.data);if(n){var o=n.length>1;e(new y("This item".concat(o?"s":""," cannot be used to create an order: ").concat(n.join(", ")," ").concat(o?"are":"is"," out of stock"),_.outOfStock))}t(this.cartData)}}.bind(this),error:function(){e(new y("Error occurred while updating the skus:",i))}})}.bind(this))},hasShippableProducts:function(){return!!this.cartData.shippableProducts||!!this.cartData.uniqPricesCount},setShippingForm:function(t){this.cartData.shippingForm=a.a.cloneWithObjects(t),this.markCartChange(),this.backupCartData()},getShippingForm:function(){return a.a.cloneWithObjects(this.cartData.shippingForm)},getShippingOptions:function(){return this.cartData.order&&this.cartData.order.shipping_methods?this.cartData.order.shipping_methods.map((function(t){return{id:t.id,label:t.description,amount:t.amount}})):null},setOrder:function(t){this.cartData.order=t,this.backupCartData()},getOrder:function(){return this.cartData.order},deleteOrder:function(){this.cartData.order=null,this.backupCartData()},cancelOrder:function(){return this.changeOrder({status:"canceled"})},changeShippingMethod:function(t){return this.changeOrder({selected_shipping_method:t})},changeOrder:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(e,i){this.cartData.order||i(new y("No order")),this.cancelingOrder&&i(),this.cancelingOrder=!0,s.a.ajax({type:"PATCH",url:"/api/projects/"+this.mag.num_id+"/ecommerce/stripe/orders/"+this.cartData.order.id+"/",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){this.cancelingOrder=!1,e(t)}.bind(this),error:function(t){this.cancelingOrder=!1,i(new y(t.responseText))}})}.bind(this))},setCustomer:function(t){this.cartData.customer=t,this.backupCartData()},createOrUpdateCustomer:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"POST",url:"/api/projects/".concat(t,"/ecommerce/stripe/customers/"),data:JSON.stringify({customer_data:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){i(t)},error:function(t){n(new y(t.responseText))}})}))},getCustomer:function(){return this.cartData.customer},setInvoiceItems:function(t){this.cartData.invoiceItems=t,this.backupCartData()},unsetInvoiceItems:function(){delete this.cartData.invoiceItems,this.backupCartData()},createInvoiceItems:function(t,e,i){return new Promise((function(n,o){s.a.ajax({type:"POST",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoice_items/"),data:JSON.stringify({customer_id:e,prices:i}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){n(t)},error:function(t){o(new y(t.responseText))}})}))},setInvoice:function(t){this.cartData.invoice=t,this.backupCartData()},unsetInvoice:function(){delete this.cartData.invoice,this.backupCartData()},createInvoice:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"POST",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoices/"),data:JSON.stringify({invoiceData:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){i(t)},error:function(t){t.responseJSON&&"invoice_no_customer_line_items"===t.responseJSON.code?n(new y(t.responseJSON.message,_.nothingToInvoice)):n(new y(t.responseText))}})}))},getInvoice:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"GET",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoices/").concat(e,"/"),contentType:"application/json; charset=utf-8",success:function(t){t&&t.data?i(t.data):n(new y("Not valid response, getInvoice"))},error:function(t){n(new y(t.responseText))}})}))},deleteDraftInvoice:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"DELETE",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoices/").concat(e,"/"),contentType:"application/json; charset=utf-8",success:function(t){t&&t.data?i(t.data):n(new y("Not valid response"))},error:function(t){n(new y(t.responseText))}})}))},voidDraftInvoice:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"POST",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoices/").concat(e,"/void/"),contentType:"application/json; charset=utf-8",success:function(t){t&&t.data?i(t.data):n(new y("Not valid response"))},error:function(t){n(new y(t.responseText))}})}))},finalizeInvoice:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"POST",url:"/api/projects/".concat(t,"/ecommerce/stripe/invoices/").concat(e,"/finalize/"),contentType:"application/json; charset=utf-8",success:function(t){t&&t.data?i(t.data):n(new y("Not valid response"))},error:function(t){n(new y(t.responseText))}})}))},getPaymentIntent:function(t,e){return new Promise((function(i,n){s.a.ajax({type:"GET",url:"/api/projects/".concat(t,"/ecommerce/stripe/payment_intents/").concat(e,"/"),contentType:"application/json; charset=utf-8",success:function(t){t&&t.data?i(t.data):n(new y("Not valid response"))},error:function(t){n(new y(t.responseText))}})}))},updatePaymentIntent:function(t,e,i){return new Promise((function(n,o){s.a.ajax({type:"PATCH",url:"/api/projects/".concat(t,"/ecommerce/stripe/payment_intents/").concat(e,"/"),contentType:"application/json; charset=utf-8",data:JSON.stringify({paymentIntentData:i}),dataType:"json",success:function(t){t&&t.data?n(t.data):o(new y("Not valid response"))},error:function(t){o(new y(t.responseText))}})}))},validateCartData:function(t){return!(!t||"object"!==c(t)||isNaN(Date.parse(t.changed))||isNaN(Date.parse(t.backuped))||"number"!=typeof t.uniqSkusCount||"number"!=typeof t.uniqPricesCount||"object"!==c(t.skus)||"object"!==c(t.prices)||"object"!==c(t.order)&&null!==t.order)},restoreBackupCartData:function(){if(Modernizr.localstorage){var t=localStorage.getItem(this.getStorageKey());if(t){var e=JSON.parse(t),i=((Date.now()-Date.parse(e.backuped))/1e3/60/60).toFixed(2);this.validateCartData(e)&&i<=24?this.cartData=e:this.clearBackup()}}},backupCartData:function(){Modernizr.localstorage&&(this.cartData.backuped=(new Date).toISOString(),localStorage.setItem(this.getStorageKey(),JSON.stringify(this.cartData)))},clearBackup:function(){Modernizr.localstorage&&localStorage.removeItem(this.getStorageKey())}}),w.hasEcommerceWidget=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t===l.a.environment.constructor?Boolean(e.find((function(t){return t.get("type")===l.a.ecommerceCartBlockName}))):Boolean(e.find((function(t){return t.type===l.a.ecommerceCartBlockName})))},e.b=w},pv3P:function(t,e,i){},q5gH:function(t,e,i){"use strict";var n,o=i("xi34"),a=i("q1z7"),s=i.n(a),r=i("rFsW"),l=i("m41J"),c=i("OTSC"),d=i("Fi5S"),h=i("q7tt"),u=i("Kf/z"),p=s.a.View.extend({minwidth:1,minheight:1,maxwidth:9999,maxheight:9999,FLIP_H:{ne:"nw",n:"n",nw:"ne",w:"e",sw:"se",s:"s",se:"sw",e:"w"},FLIP_V:{sw:"nw",s:"n",se:"ne",e:"e",ne:"se",n:"s",nw:"sw",w:"w"},DOTS:["nw","n","ne","e","se","s","sw","w"],DOTS_POS_X:[0,.5,1,1,1,.5,0,0],DOTS_POS_Y:[0,0,0,.5,1,1,1,.5],FIXED_DOTS:{nw:"se",n:"sw",ne:"sw",e:"nw",se:"nw",s:"nw",sw:"ne",w:"ne"},initialize:function(t){r.a.bindAll(this),n=i("dptL").WidgetPack,this.block=t.block,this.setElement(this.block.$el),this.$dots=this.$(".dot"),this.$triangles=this.$(".triangle"),this.$dots.drag("start",this.onDotDragStart).drag(this.onDotDrag).drag("end",this.onDotDragEnd),this.$triangles.on("mouseenter",this.onTriangleMouseEnter).drag("start",this.onTriangleDragStart).drag(this.onTriangleDrag).on("mouseleave",this.onTriangleMouseLeave).drag("end",this.onTriangleDragEnd),this.recalcDotsSizes({pageX:0,pageY:0}),this.mouseProceeding=!0,this.listenTo(this.block,"textWidgetMouseSelectionStart",this.disableMouseProceeding),this.listenTo(this.block,"textWidgetMouseSelectionEnd",this.enableMouseProceeding),this.listenTo(this.block,"textWidgetMarginDragStart",this.disableMouseProceeding),this.listenTo(this.block,"textWidgetMarginDragEnd",this.enableMouseProceeding),this.onSizeInputChangeStart.__debounced=r.a.debounce(this.onSizeInputChangeStart,200,!0),this.onSizeInputChangeEnd.__debounced=r.a.debounce(this.onSizeInputChangeEnd,200)},disableMouseProceeding:function(){this.$dots.animate({width:0,height:0,margin:0},"fast"),this.mouseProceeding=!1},enableMouseProceeding:function(){this.mouseProceeding=!0},show:function(t){this.$el.addClass("frame"),t&&this.$el.addClass("frameWB"),this.bindMouseMove(),this.mouseProceeding=!0,this.frameVisible=!0,this.recalcPointsDirections(),this.showSizes(),this.isRedBorderNeeded()&&this.checkHeightOfTextWidget()},hide:function(){this.$el.removeClass("frame"),this.$el.removeClass("frameWB"),this.unbindMouseMove(),this.frameVisible=!1,this.hideSizes()},isFrameVisible:function(){return this.frameVisible},bindMouseMove:function(){Object(o.a)(document).on("mousemove",this.recalcDotsSizes)},unbindMouseMove:function(){Object(o.a)(document).off("mousemove",this.recalcDotsSizes)},showSizes:function(){this.areSizesShown||!this.canChangeDimension("width")&&!this.canChangeDimension("height")||this.block.has_parent_block||(this.$el.children(".frameborder").after('<div id="sizes_input">'),this.sizes=new RM.vue.Sizes({el:"#sizes_input",propsData:{block:this.block,frame:this,zoom:RM.constructorRouter.zoom.getZoom()}}),this.sizes.$on("beforeChange",this.onSizeInputChangeStart.__debounced),this.sizes.$on("afterChange",this.onSizeInputChangeEnd.__debounced),this.sizes.$on("change",this.onSizeInputChange),this.areSizesShown=!0,d.a.trigger("sizes:shown"))},hideSizes:function(){this.sizes&&this.areSizesShown&&(this.sizes.$destroy(),this.sizes.$el.remove(),this.areSizesShown=!1,d.a.trigger("sizes:hidden"))},onSizeInputChangeStart:function(){this.onResizeStart()},onSizeInputChangeEnd:function(){this.block.saveBox(),this.onResizeEnd()},onSizeInputChange:function(t,e){this.block.recalcFixedLine(),this.block.recalcStickedLine(),this.doResize(t,!1,e)},setResizeBottomPlus:function(t){this.$el.toggleClass("resize-bottom-plus",t),1!==this.block.model.get("column_count")||this.block.$el.hasClass("text-autosize")||this.checkHeightOfTextWidget()},setEditorState:function(){this.block.workspace.disableDragging=!0,this.$el.addClass("editor-state"),this.resetRotation()},removeEditorState:function(){this.$el.removeClass("editor-state"),this.block.workspace.disableDragging=!1,this.restoreRotation(),this.block.css()},setRotationState:function(){this.rotationState||(this.rotationState=!0,this.$el.addClass("rotation-state"),this.block.workspace.redrawBottomShiftLine({tp:"rotation"}))},removeRotationState:function(){this.rotationState&&(this.rotationState=!1,this.$el.removeClass("rotation-state"),this.block.workspace.redrawBottomShiftLine({tp:"rotation"}))},resetRotation:function(){var t=r.a.pick(this.block.latestPosSizeAngle,"angle","flip_h","flip_v");(t.angle||t.flip_h||t.flip_v)&&(this.block.$el.flashClass("transitions",500),this.block.forbidVisualRotation=!0,this.block.css(),this.recalcPointsDirections())},restoreRotation:function(){this.block.forbidVisualRotation&&(this.block.$el.flashClass("transitions",500),this.block.forbidVisualRotation=!1,this.block.css(),this.recalcPointsDirections())},recalcDotsSizes:function(t){if(this.mouseProceeding){var e=this.block.getBoxData({includeRotationData:!0,checkFixedPosition:!0}),i=t.pageX/RM.constructorRouter.zoom.getZoom(),n=t.pageY/RM.constructorRouter.zoom.getZoom(),o=99999,a=0,s=0,r=0,l=this.$el.parent().offset(),c=e.x+l.left,d=e.y+l.top,h=e.w,u=e.h,p=this.$el.hasClass("editor-state"),g=[-13,0,14,14,14,0,-13,-13],m=[-13,-13,-13,0,14,14,14,0],f=["left","left","right","right","right","left","left","left"],v=["top","top","top","top","bottom","bottom","bottom","top"],b=this.block.latestPosSizeAngle.sinAngle,_=this.block.latestPosSizeAngle.cosAngle,y=this,w={},k=0,S=0,x=0,C=0,O=-1,P=99999999,j=0,$=-1;if(this.block.model.get("fixed_position")){var T=this.$el.offset();c=T.left,d=T.top}var I=h<=this.block.SUPER_SMALL_TRESHOLD&&u<=this.block.SUPER_SMALL_TRESHOLD;if(I?(k=[-1,-1,1,1,1,0,-1,-1][a=this.lastResizePointIndex||4],S=[-1,-1,-1,-1,1,1,1,-1][a]):this.$dots.each((function(){var t=c+h*y.DOTS_POS_X[r]+(p?g[r]:0),s=d+u*y.DOTS_POS_Y[r]+(p?m[r]:0);if((e.angle||e.flip_v||e.flip_h)&&!y.block.forbidVisualRotation){var l=c+h/2,f=d+u/2,v=t-l,w=f-s,k=e.flip_h?-v:v,S=e.flip_v?-w:w;t=l+_*k+b*S,s=f+b*k-_*S}var T=Math.sqrt(Math.pow(t-i,2)+Math.pow(s-n,2))-13;T<o&&(o=T,a=r),(s>C&&Math.abs(s-C)>.5||Math.abs(s-C)<.5&&r%2==1)&&(C=s,O=r,x=t),(s<P&&Math.abs(s-P)>.5||Math.abs(s-P)<.5&&r%2==1)&&(P=s,$=r,j=t),r++})),O===a||$===a){P-=20,C+=20;var E=$===a?j:x,M=$===a?P:C,R=Math.sqrt(Math.pow(E-i,2)+Math.pow(M-n,2))-13;R<o&&(o=R)}s=(s=I?13:(70-o)/70*12+1)<2?0:s>13?13:2*Math.floor(s/2)+1,this.denyRecalcDotSize||(this.$dots.attr("style",""),this.$triangles.attr("style","")),w.width=s,w.height=s,w["margin-"+f[a]]=I?-10:-Math.floor(s/2)+k,w["margin-"+v[a]]=I?-10:-Math.floor(s/2)+S;var A=["left","","right","right","right","","left","left"],D=["top","top","top","","bottom","bottom","bottom",""],z=Math.min(1,Math.max(70-o,0)/70),L=(Math.floor(19*z/2),Math.floor(17*z/2),{transform:"scale("+z+") rotateZ("+-this.block.latestPosSizeAngle.angle+"deg)"});this.block.frameColor&&(w["background-color"]=this.block.frameColor,L["border-top-color"]=this.block.frameColor,L["border-color"]=this.block.frameColor);var B=this.block.latestPosSizeAngle.angle>0?this.block.latestPosSizeAngle.angle:360+this.block.latestPosSizeAngle.angle;B>90&&B<180&&(B=180-B),B>270&&B<360&&(B=360-B);var F=Math.sin(B%180/180*Math.PI),N=Math.cos(B%180/180*Math.PI),U=this.$dots.eq(a),H=O===a?12:8;""===A[a]?L.left="calc(50% - 9px)":L[A[a]]=-9,""===D[a]?L.top="calc(50% - 8px)":L[D[a]]=-8,L["margin-"+f[a]]=-Math.floor((H+s)*F),L["margin-"+v[a]]=-Math.floor((H+s)*N),this.denyRecalcDotSize||(U.css(w),O!==a&&$!==a||this.block.model.get("fixed_position")||!this.block.workspace||"basic"===this.block.workspace.page.get("type")||!(O===a&&this.$el.hasClass("bundle-allow-bottom")||$===a&&this.$el.hasClass("bundle-allow-top"))||this.$triangles.eq(a).css(L).data("bundle-align",O===a?"bottom":"top"))}},recalcPointsDirections:function(){var t=this.block.getBoxData({includeRotationData:!0}),e=this.block.forbidVisualRotation?0:-t.angle,i=Math.floor((e+360+22.5)/45)%8;this.$dots.each(r.a.bind((function(e,n){var a=this.DOTS[e];t.flip_v&&!this.block.forbidVisualRotation&&(a=this.FLIP_V[a]),t.flip_h&&!this.block.forbidVisualRotation&&(a=this.FLIP_H[a]),a=this.DOTS[(r.a.indexOf(this.DOTS,a)-i+8)%8],Object(o.a)(n).attr("data-visual-direction",a)}),this))},onDotDragStart:function(){if(this.rotationState)return this.onRotateStart.apply(this,arguments);this.onResizeStart.apply(this,arguments)},onDotDrag:function(){if(this.rotationState)return this.onRotate.apply(this,arguments);this.onResize.apply(this,arguments),Object(u.a)("constructor.distance")&&this.block.workspace.distance.update([this.block])},onDotDragEnd:function(){if(this.rotationState)return this.onRotateEnd.apply(this,arguments);this.block.workspace.checkBundleDragAbility(),this.onResizeEnd.apply(this,arguments),Object(u.a)("constructor.distance")&&this.block.workspace.distance.hide()},onTriangleMouseEnter:function(t){var e=Object(o.a)(t.currentTarget);this.block.workspace._inTriangleBundleDrag||this.denyRecalcDotSize||this.block.workspace.checkBundleDragMode(t,e.data("bundle-align"))},onTriangleMouseLeave:function(t){Object(o.a)(t.currentTarget);this.block.workspace._inTriangleBundleDrag||this.denyRecalcDotSize||this.block.workspace.checkBundleDragMode(t,!0)},onTriangleDragStart:function(t){if(this.rotationState)return this.onRotateStart.apply(this,arguments);var e=Object(o.a)(t.currentTarget);this.denyRecalcDotSize=!0,e.addClass("moved"),this.block.workspace._inTriangleBundleDrag=!0,this.block.workspace.checkBundleDragMode(t,e.data("bundle-align")),this.block.workspace.$el.addClass("bundle-drag-cursor"),this.block.onDragStart.apply(this.block,arguments)},onTriangleDrag:function(){if(this.rotationState)return this.onRotate.apply(this,arguments);this.block.onDragMove.apply(this.block,arguments)},onTriangleDragEnd:function(t){if(this.rotationState)return this.onRotateEnd.apply(this,arguments);this.block.workspace._inTriangleBundleDrag=!1;var e=Object(o.a)(t.currentTarget);e.removeClass("moved"),this.denyRecalcDotSize=!1,this.block.workspace.checkBundleDragMode(t,!0),this.block.workspace.$el.removeClass("bundle-drag-cursor"),this.block.onDragEnd.apply(this.block,arguments)},onResizeStart:function(t,e,i){i=i||{},this.block.storeFixedPosition(),Object(o.a)("html").addClass("blocks-is-resizing"),this.denyRecalcDotSize=!0,this.$el.find(".frameborder").css("outline","1px solid transparent"),Object(o.a)("html").removeClass("alt-key-pressed"),this._dragEvent=t,this.block.workspace.on("specialKeydown specialKeyup",this.onSpecialKey),!RM.constructorRouter.gg.snap||this.block.model.get("fixed_position")||i.isGroupResize||RM.constructorRouter.gg.handleMoveStart(this.block instanceof n?this.block.blocks:[this.block]),this.block.onResizeStart&&this.block.onResizeStart(t,e),t&&(this.currentResizePoint=["nw","n","ne","e","se","s","sw","w"][Object(o.a)(t.currentTarget).attr("data-ind")]),this.block.workspace.widgetResizingOrRotating=!0,t&&(this.lastResizePointIndex=parseInt(Object(o.a)(t.currentTarget).attr("data-ind"))||0),e&&(e.scrollTop=this.block.workspace.$container.scrollTop())},customResizeHandler:function(t,e){return t},applyExtraConstraints:function(t,e){var i=this.block.getFullWidthDims(),n=this.block.getFullHeightDims();return this.block.model.get("is_full_width")&&r.a.extend(t,{left:i.x,width:i.w}),this.block.model.get("is_full_height")&&r.a.extend(t,{top:n.y,height:n.h}),t},applyConstraints:function(t,e){return e=r.a.extend({direction:"se",fromCenter:!1,isSidePointProportional:!1,currentResizePoint:this.currentResizePoint,isProportional:this.block.proportional,initialBox:this.block.getModelBox(),constraints:this.constraints,minwidth:this.minwidth,minheight:this.minheight,maxwidth:this.maxwidth,maxheight:this.maxheight,ratio:this.block.ratio,aspect:this.block.model.get("aspect")},e),p.applyConstraintsAbstract.apply(this,[t,e,this.applyExtraConstraints.bind(this)])},onRotateStart:function(t,e){this.block.storeFixedPosition();var i=this.block.getBoxData({includeRotationData:!0}),n=this.$el.parent().offset(),a=RM.constructorRouter.zoom.getZoom();this.rotationData={center:{x:i.x+n.left+i.w/2,y:i.y+n.top+i.h/2},x:t.pageX/a,y:t.pageY/a,initialAngle:i.angle,prevAngle:i.angle},Object(o.a)("body").addClass("grabbing-cursor"),this.block.workspace.widgetResizingOrRotating=!0},onRotate:function(t,e){var i,n,o,a,s,r,l,c=this.rotationData,d=RM.constructorRouter.zoom.getZoom();i={x:t.pageX/d-c.center.x,y:t.pageY/d-c.center.y},n={x:c.x-c.center.x,y:c.y-c.center.y},l=i.x*n.y-i.y*n.x<0?-1:1,o=(o=(i.x*n.x+i.y*n.y)/(Math.sqrt(i.x*i.x+i.y*i.y)*Math.sqrt(n.x*n.x+n.y*n.y)))>1?1:o,a=l*Math.acos(o)/Math.PI*180,s=c.prevAngle-a,r=t.shiftKey?15*Math.floor(s/15)+c.initialAngle%15:s,s=(s=s>=360?s-360:s)<=-360?s+360:s,r=(r=r>=360?r-360:r)<=-360?r+360:r,r=Math.floor(r),this.block.css({angle:r}),this.block.trigger("rotate",{angle:r}),this.block.model.set({angle:r}),c.x=t.pageX/d,c.y=t.pageY/d,c.prevAngle=s},onRotateEnd:function(t,e){Object(o.a)("body").removeClass("grabbing-cursor"),this.block.workspace.widgetResizingOrRotating=!1,this.block.restoreFixedPosition(),this.block.workspace.checkBundleDragAbility()},checkHeightOfTextWidget:function(t){var e=this.block.getAllowableHeight(),i=t?t.height:this.block.getModelBox().height;t&&r.a.contains(["sw","se","s"],this.currentResizePoint)&&this.stickBtmBorderOfText(e,t),this.$el.find(".frameborder").toggleClass("red-border",i<e)},stickBtmBorderOfText:function(t,e){var i,n=p.ceilObject({width:e.width,top:e.top,left:e.left});Math.abs(e.height-t)<8&&(n.height=t,i=this.customResizeHandler(o.a.extend(i,n),this.currentResizePoint),this.block.css(i,this.currentResizePoint))},onResize:function(t,e){e.deltaX=e.deltaX/RM.constructorRouter.zoom.getZoom(),this.block._saveXHR&&(this.block._saveXHR.abort&&this.block._saveXHR.abort(),delete this.block._saveXHR);var i=this.block.workspace,a=this.block instanceof n?this.block.blocks:[this.block];!i||this.block instanceof n||h.a.prototype.collectBottomBloсks(i,a,t);var s=this.block.resizeFromCenter||t.altKey,d=t.shiftKey;if(this._dragEvent=t,!Object(o.a)("html").hasClass("blocks-is-moving")){var u=e.startY+e.scrollTop,g=t.pageY+this.block.workspace.$container.scrollTop();e.deltaY=(g-u)/RM.constructorRouter.zoom.getZoom(),c.default.autoWindowScroll(t,this.block.workspace.$container,r.a.bind((function(){this.onResize(t,e)}),this));var m=this.block.getModelBox(),f=r.a.clone(m),v=this.block.latestPosSizeAngle.sinAngle,b=this.block.latestPosSizeAngle.cosAngle,_=this.block.getBoxData({includeRotationData:!0}),y=e.deltaX,w=e.deltaY;if(_.angle&&!this.block.forbidVisualRotation){var k=b*e.deltaX+v*e.deltaY,S=-v*e.deltaX+b*e.deltaY;e.deltaY=S,e.deltaX=k}var x=this.DOTS[Object(o.a)(t.currentTarget).attr("data-ind")];_.flip_v&&!this.block.forbidVisualRotation&&(x=this.FLIP_V[x]),_.flip_h&&!this.block.forbidVisualRotation&&(x=this.FLIP_H[x]);var C=r.a.contains(["w","e","n","s"],x)&&Boolean(d||this.block.proportional);if(x=this.modifyOnShift(t,e,m,{direction:x,isSidePointProportional:C}),s){switch(x){case"nw":case"ne":case"n":m.top+=e.deltaY,m.height-=2*e.deltaY;break;case"sw":case"se":case"s":m.top-=e.deltaY,m.height+=2*e.deltaY}switch(x){case"nw":case"sw":case"w":m.left+=e.deltaX,m.width-=2*e.deltaX;break;case"se":case"ne":case"e":m.left-=e.deltaX,m.width+=2*e.deltaX}}else{switch(x){case"nw":case"ne":case"n":m.top+=e.deltaY,m.height-=e.deltaY;break;case"sw":case"se":case"s":m.height+=e.deltaY}switch(x){case"nw":case"sw":case"w":m.left+=e.deltaX,m.width-=e.deltaX;break;case"se":case"ne":case"e":m.width+=e.deltaX}if(C)switch(x){case"e":m.top-=e.deltaY/2,m.height+=e.deltaY;break;case"w":m.top+=e.deltaY/2,m.height-=e.deltaY;break;case"n":m.left+=e.deltaX/2,m.width-=e.deltaX;break;case"s":m.left-=e.deltaX/2,m.width+=e.deltaX}}RM.constructorRouter.gg.snap&&!t.ctrlKey&&((_.angle||_.flip_v||_.flip_h)&&!this.block.forbidVisualRotation||(m=RM.constructorRouter.gg.handleSnapResize(m,this.block.model,x)));var O=this.FIXED_DOTS[x],P=r.a.indexOf(this.DOTS,O);if(m=this.applyConstraints(m,{boxOrig:f,direction:x,fromCenter:s,isSidePointProportional:C,fixedDot:O,fixedDotInd:P,DOTS_POS_Y:this.DOTS_POS_Y[P],DOTS_POS_X:this.DOTS_POS_X[P],sinAngle:v,cosAngle:b}),_.angle&&!s&&!this.block.forbidVisualRotation){var j=p.getRotatedBoxDelta(f,m,_.angle,x);m.left+=j.left,m.top+=j.top}if(RM.constructorRouter.gg.snap&&!t.ctrlKey&&!e.disableSnap&&(_.angle||_.flip_v||_.flip_h)&&!this.block.forbidVisualRotation){var $=r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},m),T=l.a.calcBoundingBox($);T.left=T.bb_left,T.top=T.bb_top,T.width=T.bb_width,T.height=T.bb_height;var I=Object(o.a)(t.currentTarget).attr("data-visual-direction"),E=r.a.indexOf(this.DOTS,I),M=T.left+T.width*this.DOTS_POS_X[E],R=T.top+T.height*this.DOTS_POS_Y[E],A=RM.constructorRouter.gg.handleSnapResize(T,this.block.model,I),D=A.left+A.width*this.DOTS_POS_X[E]-M,z=A.top+A.height*this.DOTS_POS_Y[E]-R;if(D||z)return e.deltaX=y+D,e.deltaY=w+z,e.disableSnap=!0,void this.onResize(t,e)}e.disableSnap=!1,this.block.recalcFixedLine(),this.block.recalcStickedLine();var L=this.doResize(m,!0,x,s);if(i&&!(this.block instanceof n)){var B=i.bottomBlocksToMove,F=l.a.calcBoundingBox(r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},f)),N=l.a.calcBoundingBox(r.a.extend({sinAngle:this.block.latestPosSizeAngle.sinAngle,cosAngle:this.block.latestPosSizeAngle.cosAngle},m)),U=N.bb_top-F.bb_top;B&&B.vPressed&&(U+=N.bb_height-F.bb_height),h.a.prototype.moveBottomBlocks(i,U,!1,{y:0})}return this.isRedBorderNeeded()&&this.checkHeightOfTextWidget(L),L}},doResize:function(t,e,i,n){var a=p.ceilObject({height:t.height,width:t.width,top:t.top,left:t.left});return t=this.customResizeHandler(o.a.extend(t,a),this.currentResizePoint,e),this.block.css(t,this.currentResizePoint),this.block.trigger("resize",t),t},isRedBorderNeeded:function(){return!(!this.block.$el.hasClass("block-text")||1!==this.block.model.get("column_count")||this.block.$el.hasClass("text-autosize"))},modifyOnShift:function(t,e,i,n){var o=t.shiftKey,a=n.direction;if(o&&!this.block.proportional||n.isSidePointProportional){var s=this.block.model.get("aspect")||i.width/i.height,l=1/s;if(r.a.contains(["w","e"],a))return e.deltaY=e.deltaX*l,a;if(r.a.contains(["n","s"],a))return e.deltaX=e.deltaY*s,a;if(r.a.contains(["nw","se"],a))var c=l;r.a.contains(["sw","ne"],a)&&(c=-l);var d=e.deltaY+e.deltaX/c;return e.deltaX=d/(c+1/c),e.deltaY=e.deltaX*c,a}return a},onResizeEnd:function(t,e,i){if(i=i||{},c.default.autoWindowScrollClear(),this.block.restoreFixedPosition(),this.block.recalcFixedLine(),this.block.recalcStickedLine(),this.block._justResized=!0,this.$el.find(".frameborder").css("outline",""),!this.block.dontSaveOnResize){var a=this.block instanceof n,s=this.block.workspace.bottomBlocksToMove,l=this.block.workspace.spacesController&&this.block.workspace.spacesController.getBlocksToSave()||[],d=r.a.extend({resizePoint:this.currentResizePoint},i),h=a?this.block.blocks:[this.block],u=r.a.map([].concat(h,s&&s.tosave||[],l),(function(t){return r.a.extend({_id:t.id},t.getSaveBoxData(d))}));s&&s.initPageHeight!=this.block.workspace.page.getCurrentViewportParam("height")&&s.tosave&&s.tosave.length&&this.block.workspace.page.save(),a?this.block.saveBox(r.a.extend({resizePoint:this.currentResizePoint},i),u):this.block.workspace.save_group(u),this.block.workspace.clearBottomBlocksToMove()}this.currentResizePoint=void 0,this.denyRecalcDotSize=!1,Object(o.a)("html").removeClass("blocks-is-resizing"),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveEnd(),this.block.onResizeEnd&&this.block.onResizeEnd(t,e,i),this.block.workspace.off("specialKeydown specialKeyup",this.onSpecialKey),this.block.workspace.widgetResizingOrRotating=!1,this.block.workspace.checkBundleDragAbility()},onSpecialKey:function(t){t.keyCode==o.a.keycodes.shift&&this.block.proportional||("keydown"==t.type&&(this._dragEvent.altKey=t.altKey,this._dragEvent.shiftKey=t.shiftKey),"keyup"==t.type&&(t.keyCode==o.a.keycodes.shift&&(this._dragEvent.shiftKey=!1),t.keyCode==o.a.keycodes.alt&&(this._dragEvent.altKey=!1)),this.$dots.trigger(this._dragEvent))},canChangeDimension:function(t){if(this.block.canChangeDimension&&"function"==typeof this.block.canChangeDimension)return this.block.canChangeDimension(t);switch(t){case"width":return!this.block.isFullWidth()&&(r.a.isUndefined(this.minwidth)||this.minwidth!==this.maxwidth);case"height":return!this.block.isFullHeight()&&(r.a.isUndefined(this.minheight)||this.minheight!==this.maxheight);default:return!0}},destroy:function(){this.hide(),this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.stopListening(this.block,"textWidgetMouseSelectionStart",this.disableMouseProceeding),this.stopListening(this.block,"textWidgetMouseSelectionEnd",this.enableMouseProceeding),this.stopListening(this.block,"textWidgetMarginDragStart",this.disableMouseProceeding),this.stopListening(this.block,"textWidgetMarginDragEnd",this.enableMouseProceeding),this.block.workspace.off(null,null,this)}},{applyConstraintsAbstract:function(t,e,i){var n=(e=e||{}).direction,o=e.fromCenter;e.isProportional&&(e=r.a.extend({},e,l.a.getBoxLimits(e.initialBox,{minwidth:e.minwidth,maxwidth:e.maxwidth,minheight:e.minheight,maxheight:e.maxheight})));var a=e.isSidePointProportional&&("n"===n||"s"===n),s=e.isSidePointProportional&&("e"===n||"w"===n);if(t.width<e.minwidth){if(r.a.contains(["nw","sw","w"],n)||a){var c=t.width-e.minwidth;t.left+=o||a?c/2:c}r.a.contains(["se","ne","e"],n)&&o&&(t.left+=(t.width-e.minwidth)/2),t.width=e.minwidth}if(t.height<e.minheight&&((r.a.contains(["nw","ne","n"],n)||s)&&(c=t.height-e.minheight,t.top+=o||s?c/2:c),r.a.contains(["sw","se","s"],n)&&o&&(t.top+=(t.height-e.minheight)/2),t.height=e.minheight),e.maxwidth&&t.width>e.maxwidth&&((r.a.contains(["nw","sw","w"],n)||a)&&(c=e.maxwidth-t.width,t.left-=o||a?c/2:c),r.a.contains(["ne","se","e"],n)&&o&&(t.left-=(e.maxwidth-t.width)/2),t.width=e.maxwidth),e.maxheight&&t.height>e.maxheight&&((r.a.contains(["nw","ne","n"],n)||s)&&(c=e.maxheight-t.height,t.top-=o||s?c/2:c),r.a.contains(["sw","se","s"],n)&&o&&(t.top-=(e.maxheight-t.height)/2),t.height=e.maxheight),e.isProportional&&(t=p.makeProportional(t,e)),i&&r.a.isFunction(i)&&(t=i(t,e.currentResizePoint)),e.constraints&&(t.left<e.constraints.left&&(t.width+=t.left-e.constraints.left,t.left=e.constraints.left),t.top<e.constraints.top&&(t.height+=t.top-e.constraints.top,t.top=e.constraints.top),t.left+t.width>e.constraints.left+e.constraints.width&&(t.width=e.constraints.left+e.constraints.width-t.left),t.top+t.height>e.constraints.top+e.constraints.height&&(t.height=e.constraints.top+e.constraints.height-t.top)),e.packBox){var d=Math.min(e.packBox.width,t.width),h=Math.min(e.packBox.height,t.height);t={width:d,height:h,top:Math.min(e.packBox.top+e.packBox.height-h,Math.max(t.top,e.packBox.top)),left:Math.min(e.packBox.left+e.packBox.width-d,Math.max(t.left,e.packBox.left))}}return this.block.workspace.spacesController&&!e.isSizes&&(t=this.block.workspace.spacesController.recalcBoxOnResize(t,e,this.block.model)),t},makeProportional:function(t,e){var i,n,o=e.initialBox||{},a=e.direction,s=e.fromCenter;switch(a){case"n":case"s":i="height",n="width";break;case"e":case"w":i="width",n="height";break;default:t.width/o.width>t.height/o.height?(i="width",n="height"):(i="height",n="width")}e.baseDimension&&(i=e.baseDimension,n="width"===e.baseDimension?"height":"width");var l=o[n]/o[i];e.ratio&&(l="width"==n?e.ratio:1/e.ratio),e.aspect&&(l="width"==n?e.aspect:1/e.aspect);var c=Math.round(t[i]*l);if(r.a.contains(["nw","sw","w"],a)&&"width"==n){var d=c-t[n];t.left-=s?d/2:d}return r.a.contains(["ne","se","e"],a)&&"width"==n&&s&&(t.left-=(c-t[n])/2),r.a.contains(["nw","ne","n"],a)&&"height"==n&&(d=c-t[n],t.top-=s?d/2:d),r.a.contains(["sw","se","s"],a)&&"height"==n&&s&&(t.top-=(c-t[n])/2),r.a.contains(["n","s"],a)&&s&&(d=c-t[n],t.left-=d/2),r.a.contains(["w","e"],a)&&s&&(d=c-t[n],t.top-=d/2),t[n]=c,t},getRotatedBoxDelta:function(t,e,i,n){var o=p.prototype.DOTS_POS_X,a=p.prototype.DOTS_POS_Y,s=p.prototype.FIXED_DOTS,l=p.prototype.DOTS,c=Math.sin((i||0)*Math.PI/180),d=Math.cos((i||0)*Math.PI/180),h=r.a.indexOf(l,s[n]),u=t.left+t.width*o[h],g=t.top+t.height*a[h],m=t.left+t.width/2,f=t.top+t.height/2,v=u-m,b=f-g,_=m+d*v+c*b,y=f+c*v-d*b,w=e.left+e.width*o[h],k=e.top+e.height*a[h],S=e.left+e.width/2,x=e.top+e.height/2,C=w-S,O=x-k;return{left:_-(S+d*C+c*O),top:y-(x+c*C-d*O)}},ceilObject:function(t){for(var e in t)t.hasOwnProperty(e)&&(t[e]=Math.ceil(t[e]));return t}});e.a=p},q7tt:function(t,e,i){"use strict";var n=i("xi34"),o=i("Kw5r"),a=i("q1z7"),s=i.n(a),r=i("rFsW"),l=i("v92f"),c=i("UeZx"),d=i.n(c),h=i("MAfP"),u=i.n(h),p=i("q5gH"),g={components:{NumericInput:i("tRog").a},props:{block:Object,frame:Object,zoom:Number},data:function(){return{minwidth:this.frame.minwidth,maxwidth:this.frame.maxwidth,minheight:this.frame.minheight,maxheight:this.frame.maxheight}},computed:{w:function(){return parseInt(this.block.latestPosSizeAngle.width)},h:function(){return parseInt(this.block.latestPosSizeAngle.height)},x:function(){return parseInt(this.block.latestPosSizeAngle.left)},y:function(){return parseInt(this.block.latestPosSizeAngle.top)},angle:function(){return this.block.latestPosSizeAngle.angle},sin:function(){return this.block.latestPosSizeAngle.sinAngle},cos:function(){return this.block.latestPosSizeAngle.cosAngle},fixed_position:function(){return this.block.model.get("fixed_position")},is_visible:function(){return!this.block.forbidVisualRotation&&this.block.workspace.mag.edit_params.get("sizes")},is_width_disabled:function(){return!this.frame.canChangeDimension("width")},is_height_disabled:function(){return!this.frame.canChangeDimension("height")}},watch:{angle:"applyPosition",x:"applyPosition",y:"applyPosition",w:"applyPosition",h:"applyPosition",fixed_position:"applyPosition",is_visible:function(t){t&&r.a.delay(function(){this.$refs.widthInput.updateSize(),this.$refs.heightInput.updateSize()}.bind(this))}},mounted:function(){var t=this,e=function(e){return t.$children.find((function(t){return t.$el.classList.contains(e)}))};this.$w=e("width"),this.$h=e("height"),this.applyPosition()},methods:{resize:function(t,e){var i="width"===t,n=i?e:parseInt(this.$w.$el.value),o=i?parseInt(this.$h.$el.value):e,a=i?"e":"s";this.$emit("beforeChange");var s=this.frame.applyConstraints({left:this.angle?this.block.latestPosSizeAngle.left:this.block.model.attributes.x,top:this.angle?this.block.latestPosSizeAngle.top:this.block.model.attributes.y,width:n,height:o},{direction:a,isSidePointProportional:!1,isSizes:!0});if(this.angle){var r=p.a.getRotatedBoxDelta({left:this.block.latestPosSizeAngle.left,top:this.block.latestPosSizeAngle.top,width:this.block.latestPosSizeAngle.width,height:this.block.latestPosSizeAngle.height},s,this.angle,a);s.left+=r.left,s.top+=r.top}s.width=Math.round(s.width),s.height=Math.round(s.height),this.minwidth=i&&n<s.width?s.width:this.frame.minwidth,this.maxwidth=i&&n>s.width?s.width:this.frame.maxwidth,this.minheight=!i&&o<s.height?s.height:this.frame.minheight,this.maxheight=!i&&o>s.height?s.height:this.frame.maxheight,(i&&s.width!==this.w||!i&&s.height!==this.h)&&this.$emit("change",s,"se"),this.$emit("afterChange")},applyPosition:function(){var t,e,i=this.h+8,n=this.w+8,o=this.w/2,a=this.h/2,s=8*(this.zoom-1);i-=a;var r=(n-=o)*this.cos-i*this.sin,l=n*this.sin+i*this.cos;n=r+o,i=l+a,this.$el.style.left=Math.round(n*this.zoom)+"px",this.$el.style.top=Math.round(i*this.zoom)+"px";var c=this.$el.getBoundingClientRect(),d=this.angle>=0?this.angle:360+this.angle;t=0,e=0,d>0&&d<=90?t=d/90*-c.width:d>90&&d<=180?(t=-c.width,e=(d-90)/90*-c.height):d>180&&d<=270?(t=(270-d)/90*-c.width,e=-c.height):d>270&&d<=360&&(e=(360-d)/90*-c.height),this.$el.style.transform="translateX("+(t-s)+"px) translateY("+(e-s)+"px)",c=this.$el.getBoundingClientRect();var h=this.block.workspace.$container.width()-this.block.workspace.$container[0].clientWidth,u=window.innerWidth-h,p=window.innerHeight;c.left<8?t=t-c.left+8:c.left+c.width+8>u&&(t+=u-c.left-c.width-8),c.top<8?e=e-c.top+8:c.top+c.height+8>p&&(e+=p-c.top-c.height-8),this.$el.style.transform="translateX("+(t-s)+"px) translateY("+(e-s)+"px)"}}},m=(i("5EAR"),i("KHd+")),f=Object(m.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.is_visible,expression:"is_visible"}],staticClass:"size-tool skip-rotate",on:{click:function(t){return t.stopPropagation()},dblclick:function(t){return t.stopPropagation()}}},[i("numeric-input",{ref:"widthInput",staticClass:"input width",attrs:{value:t.w,autosize:!0,disabled:t.is_width_disabled,"mouse-use":!t.is_width_disabled,"debounce-keyboard":500,min:t.minwidth,max:t.maxwidth},on:{change:function(e){return t.resize("width",e)}}}),t._v(" "),i("span",[t._v("×")]),t._v(" "),i("numeric-input",{ref:"heightInput",staticClass:"input height",attrs:{value:t.h,autosize:!0,disabled:t.is_height_disabled,"mouse-use":!t.is_height_disabled,"debounce-keyboard":500,min:t.minheight,max:t.maxheight},on:{change:function(e){return t.resize("height",e)}}})],1)}),[],!1,null,null,null).exports,v=i("OTSC"),b=(i("tZHv"),i("m41J")),_=i("roQd"),y=i("jamO"),w=i("G3+Z"),k=i("Vxjr"),S=i("Kf/z"),x=i("Fi5S"),C=i("9Juw"),O=i("zjto"),P=i("jcqt");function j(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||M(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function T(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(Object(i),!0).forEach((function(e){I(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||M(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){if(t){if("string"==typeof t)return R(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?R(t,e):void 0}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var A=s.a.View.extend({SUPER_SMALL_TRESHOLD:10,MAX_Z_INDEX:2e3,TOOLTIP_OFFSET:16,outofbox:!1,excludedFromLib:!1,immortal:!1,template:null,events:{},viewport_fields:l.b.viewport_fields_common,controls:["common_animation","common_position","common_layer","common_lock"],settingsOnCreate:!0,initialize:function(t,e){this.initBlock(t,e)},initBlock:function(t,e){r.a.bindAll(this),this.model=t;var i=E(Object(P.a)(this.initialSaredState),3),o=i[0],a=i[1],s=i[2];this._useSharedState=o,this.nonReactSetSharedState=a,this.nonReactGetSharedState=s,this.isLoading=!1,this.selected=!1,this.forbidVisualRotation=!1,this.triggerAssets={},t.get("hidden")&&this.triggerReady(),this.workspace=e,this.workspace.on("deselect",this.deselect),this.model.on("change",this.onModelChange),this.model.on("change:pack_id",this.onPackChange),this.model.on("change:is_locked",this.updateLockDragState),this.model.on("change:hidden",this.onBlockVisibilityChange),this.model.on("change:fixed_position",this.onFixPosition),Object(S.a)("constructor.zIndex")&&(x.a.on("index:changed",this.onIndexChange),this.workspace.page.on("change:viewport",this.onIndexChange),this.on("select",this.onIndexChange),this.on("deselect",this.onIndexChange)),this.listenTo(this.model,"animation:trigger:add",this.onAnimationTriggerAdd),this.listenTo(this.model,"animation:trigger:remove",this.onAnimationTriggerRemove),this.listenTo(this.model,"animation:type:change",this.resetAnimationTriggers),this.latestPosSizeAngle=this.getModelBox();var l=this.getStickedSide();"left"==l||"right"==l?this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width):"top"!=l&&"bottom"!=l||(this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height)),this.$document=Object(n.a)(document),r.a.extend(this.latestPosSizeAngle,b.a.calcBoundingBox(this.latestPosSizeAngle)),this.has_parent_block=!!this.model.get("parent_wid")},initialSaredState:{},useSharedState:function(){var t=this,e=E(this._useSharedState(),1)[0];return[e,function(i){return t.nonReactSetSharedState(T(T({},e),i))}]},render:function(){this.create()},triggerReady:function(){this.model.triggerReady()},init_as_child_block:function(){this.$el.addClass("no-transitions").addClass("has-parent-block"),"picture"===this.model.get("type")&&this.model.on("change:picture",this.workspace.determine_column_widgets_height_fitting)},onModelChange:function(t,e){this.redraw(t,e),this.checkDisabledControls(t),this.checkNeedChangeVisibility()},create:function(){this.setElement(Object(n.a)(this.template({block:this.model.attributes,templates:T({},u.a)}))),this.has_parent_block?this.$el.appendTo(this.workspace.$blocksWrapper):this.isStandalone?this.$el.appendTo(this.$standaloneContainer):this.$el.appendTo(this.workspace.$el.children().first()),this.toggleInPackClass(),this.$content=this.$(".content");var t=this.frameClass||p.a;this.frame=new t({block:this}),this.frameColor&&this.$(".frameborder").css({"border-color":this.frameColor}),this.bindEvents(),this.rendered=!0,this.checkRetargetScroll(),this.workspace.on("workspace-resize",this.onWorkspaceResize),this.model.get("is_full_width")&&this.$el.addClass("full-width"),this.model.get("is_full_height")&&this.$el.addClass("full-height"),this.has_parent_block&&this.init_as_child_block(),this.checkDisabledControls(this.model,!0),Object(S.a)("constructor.zIndex")&&this.onIndexChange(),this.model.getAnimations().find((function(t){return t&&t.steps&&t.steps[0]&&t.steps[0].hideInEditor}))&&this.$el.addClass("hidden-by-trigger")},toggleInPackClass:function(t){var e=Boolean(t||this.model.get("pack_id"));this.$el.toggleClass("in-pack",e)},onIndexChange:function(){if("background"!==this.model.get("type")&&this.rendered){var t=RM.constructorRouter.indexController.getZIndex(this.id,this.workspace.page.id,this.workspace.page.getCurrentViewport());if(this.model.get("fixed_position")&&this.selected&&(t+=1e3),this.currentZ!==t){this.currentZ=t;var e=this.model.get("fixed_position")?t:"",i=e?"":t,n=e?"fixed":"";this.$el.css({"z-index":e,position:n}),this.$content.css({"z-index":i})}}},css:function(t,e){var i,n=(t=t||{}).clone?this.$cloneEl:this.$el;if(t["z-index"]){var o=this.model.get("fixed_position")?t["z-index"]:"",a=o?"":t["z-index"],s=o?"fixed":"";n.css({"z-index":o,position:s}),this.$content.css({"z-index":a})}var l=r.a.extend(r.a.clone(this.latestPosSizeAngle),t);i=!(l.angle||l.flip_v||l.flip_h)||this.forbidVisualRotation||this.isFullWidth()||this.isFullHeight()?"":(l.angle?" rotateZ("+l.angle+"deg)":"")+(l.flip_v?"scaleY(-1)":"")+(l.flip_h?"scaleX(-1)":""),v.default.applyTransform(n.children("div:not(.skip-rotate)"),i),t.clone||(r.a.extend(this.latestPosSizeAngle,r.a.pick(t,"width","height","left","top","angle","flip_v","flip_h","z-index")),null!=t.angle&&(this.latestPosSizeAngle.sinAngle=Math.sin(t.angle*Math.PI/180),this.latestPosSizeAngle.cosAngle=Math.cos(t.angle*Math.PI/180)),null==t.angle&&null==t.flip_v&&null==t.flip_h||this.frame&&this.frame.recalcPointsDirections(),r.a.extend(this.latestPosSizeAngle,b.a.calcBoundingBox(this.latestPosSizeAngle)));var c={};if(c=this.latestPosSizeAngle.angle&&this.latestPosSizeAngle.angle%90==0&&Math.round(this.latestPosSizeAngle.height)%2!=Math.round(this.latestPosSizeAngle.width)%2?r.a.extend(r.a.pick(t,"width","height","left","top","margin-top","margin-left"),{height:Math.round(this.latestPosSizeAngle.height),width:Math.round(this.latestPosSizeAngle.width)+1}):r.a.pick(t,"width","height","left","top","margin-top","margin-left"),this.model.get("fixed_position")&&"pack"!==this.model.get("type")&&!r.a.isEmpty(c)){var d=r.a.pick(this.latestPosSizeAngle,"width","height");r.a.extend(c,d),"default"!=this.model.getViewport()&&(s=this.workspace.position,-1==["n","c","s"].indexOf(this.model.get("fixed_position"))&&(c.left+=s.left),-1==["e","c","w"].indexOf(this.model.get("fixed_position"))&&(c.top+=s.top)),r.a.extend(c,v.default.getFixedPositionCSS(this.model.get("fixed_position"),c,1))}var h=this.getStickedSide();"left"==h||"right"==h?this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width):"top"!=h&&"bottom"!=h||(this.latestPosSizeAngle.sticked_margin=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height)),n.css(c),this.has_parent_block||this.isStandalone||(t.doNotRedrawPacksFrames||this.workspace.redrawPacksFrames({tp:"css"}),t.doNotRedrawBottomShiftLine||this.workspace.redrawBottomShiftLine({tp:"css"}));var u=this.latestPosSizeAngle,p=u.width>=0&&u.width<=this.SUPER_SMALL_TRESHOLD&&u.height>=0&&u.height<=this.SUPER_SMALL_TRESHOLD;this.$el.toggleClass("super-small",p)},onWorkspaceResize:function(){this.model.get("is_full_width")&&this.model.set(this.getFullWidthDims()),this.model.get("is_full_height")&&this.model.set(this.getFullHeightDims()),this.model.get("sticked")&&this.setStickedDims(),this.frame.sizes&&(this.frame.sizes.zoom=RM.constructorRouter.zoom.getZoom(),this.frame.sizes.applyPosition())},getCachedSizes:function(){var t=this;return this.cachedSizes||(this.cachedSizes={width:this.workspace.$container.width(),height:this.workspace.$container.height(),clientWidth:this.workspace.$container[0].clientWidth},setTimeout((function(){t.cachedSizes=null}),0)),this.cachedSizes},getFullWidthDims:function(t){var e,i=this.model.get("fixed_position"),n={},o=!1,a=this.getCachedSizes(),s=a.width-a.clientWidth,l=RM.constructorRouter.zoom.getZoom(),c=y.c.getViewportSetting("width",this.workspace.page.getCurrentViewport());return null==t&&(t=parseInt(this.model.get("full_width_margin"),10)||0),i?(e=["s","c","n"].indexOf(i)>-1,o=r.a.contains(i,"e")||r.a.contains(i,"w"),n.x=(e?0:t)-Math.ceil((o?0:s)/2),n.w=a.width/l-2*t-(o?0:s)):(n.x=-this.workspace.position.left+t,n.w=Math.max(a.width/l,c)-2*t-(o?0:s)),n},getFullHeightDims:function(t){var e,i=this.model.get("fixed_position"),n={},o=this.getCachedSizes().height,a=this.workspace.page.getCurrentViewportParam("height"),s=RM.constructorRouter.zoom.getZoom(),r=this.workspace.page.getCurrentViewportParam("height");return null==t&&(t=parseInt(this.model.get("full_height_margin"),10)||0),i?(e=["w","c","e"].indexOf(i)>-1,n.y=e?0:t,n.h=o/s-2*t):(n.y=-this.workspace.position.top+t,n.h=Math.max(Math.max(o,a)/s,r)-2*t),n},getStickedDims:function(t,e){var i=t||this.model.get("sticked"),n=null!=e?e:parseInt(this.model.get("sticked_margin"),10)||0,o=this.workspace.$container.width(),a=this.workspace.$container.height(),s=y.c.getViewportSetting("width",this.workspace.page.getCurrentViewport()),r=this.workspace.page.getCurrentViewportParam("height"),l=o-this.workspace.$container[0].clientWidth,c="default"!==this.model.getViewport(),d={},h=RM.constructorRouter.zoom.getZoom();return"left"==i?(d.x=-this.workspace.position.left+n,d.y=this.model.get("y")):"right"==i?(d.x=Math.max(o/h,s)-l-n-this.model.get("w")-this.workspace.position.left,d.y=this.model.get("y")):"top"==i?(d.x=this.model.get("x"),d.y=n+(r<a/h?0:-this.workspace.position.top)):"bottom"==i&&(d.x=this.model.get("x"),d.y=(r<a/h||c?r-this.workspace.position.top:r)-n-this.model.get("h")+this.workspace.position.top),d},setStickedDims:function(){var t=this.model.get("sticked");t&&"bottom"!==t&&"default"!==this.model.getViewport()&&this.model.unset("sticked"),this.model.get("sticked")&&this.model.set(this.getStickedDims())},calcStickedMargin:function(t,e){var i=this.model.get("sticked"),n=this.workspace.$container.width(),o=this.workspace.$container.height(),a=y.c.getViewportSetting("width",this.workspace.page.getCurrentViewport()),s=this.workspace.page.getCurrentViewportParam("height"),r=n-this.workspace.$container[0].clientWidth,l="default"!==this.model.getViewport(),c=0,d=RM.constructorRouter.zoom.getZoom();return"left"==i?c=t+this.workspace.position.left:"right"==i?c=Math.max(n/d,a)-r-e-t-this.workspace.position.left:"top"==i?c=t+(s<o/d?0:-this.workspace.position.top):"bottom"==i&&(c=(s<o/d||l?s-this.workspace.position.top:s)-e-t+this.workspace.position.top),c},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/";return t.small&&this.icon_color?(e["background-color"]=this.icon_color,e):(e["background-image"]="url(".concat(Object(k.findImagePath)(i+this.model.get("type")+".svg"),")"),e)},bindEvents:function(){this.$el.on("click",this.onClick),this.$el.on("dblclick",this.onDblClick),this.has_parent_block||(Object(n.a)(this.$el).drag("start",this.onDragStart,{not:".no-drag, :input:not([readonly]), .size-tool"}).drag(this.onDragMove,{delay:100}).drag("end",this.onDragEnd),this.workspace.on("select",this.onWorkspaceBlocksSelect),this.updateLockDragState())},updateControls:function(t){var e,n;if(t=t||{},this.has_parent_block?(e=this.workspace&&this.workspace.page_workspace&&this.workspace.page_workspace.controls,n=this.workspace.page_workspace):(e=this.workspace&&this.workspace.controls,n=this.workspace),e&&e.selectedBlocks&&1==e.selectedBlocks.length&&e.selectedBlocks[0].id==this.id){var o=r.a.pluck(e.controls,"name"),a=i("hQZz").default,s=r.a.filter(this.controls,function(t){return!a[t].prototype.restrictions||!!a[t].prototype.restrictions.call(this,n)}.bind(this));(r.a.difference(s,o).length||r.a.difference(o,s).length)&&e.setControls(this.controls,this,t)}},scrollTo:function(){var t=this.$el.offset().top>document.body.clientHeight;if(this.$el.offset().top<0||t){var e=Object(n.a)("#main");e.stop().animate({scrollTop:e.scrollTop()+this.$el.offset().top-100},"200","swing",function(){r.a.delay(function(){this.frame.sizes&&this.frame.sizes.applyPosition()}.bind(this),400)}.bind(this))}},selectFromWidgetBar:function(t,e){if(t||(t={shiftKey:!1,ctrlKey:!1}),this.workspace.trigger("block:click",this,t),t.shiftKey||t.ctrlKey||t.metaKey||this.workspace.trigger("deselect",this),(t.ctrlKey||t.metaKey)&&this.selected&&!r.a.isEmpty(this.workspace.getSelectedBlocks()))return this.deselect(),void(r.a.isEmpty(this.workspace.getSelectedBlocks())?this.workspace.trigger("deselect",this):this.workspace.trigger("select",this.workspace.getSelectedBlocks(),[this],!0));if(this.select(!e),!r.a.isEmpty(this.workspace.getSelectedBlocks())){var i={selected:this.workspace.getSelectedBlocks(),deselected:[]};e&&(i=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks())),this.workspace.trigger("select",i.selected,i.deselected,!0)}},onDblClick:function(){this.isStandalone||!this.has_parent_block&&this.model.get("pack_id")&&this.selectFromWidgetBar()},blockBoxToCommonCoords:function(){var t=this.getBoxData({includeBoundingBox:!0}),e=this.workspace.getViewportPosition(),i=this.model.get("fixed_position"),n=t.bb_x,o=t.bb_y,a=t.bb_w,s=t.bb_h;switch(i){case"nw":case"n":case"ne":o+=e.top;break;case"e":case"c":case"w":o+=e.top+e.height/2-s/2;break;case"sw":case"s":case"se":o=e.top+e.height-o-s}switch(i){case"nw":case"w":case"sw":n-=(e.viewportWidth-e.width)/2;break;case"n":case"c":case"s":n+=e.width/2-a/2;break;case"ne":case"e":case"se":n=e.width+(e.viewportWidth-e.width)/2-n-a}return{x:n,y:o,w:a,h:s}},onClick:function(t,e){if(this.workspace.trigger("block:click",this,t),!this.isStandalone)if(this.has_parent_block){if(this._justResized)return void(this._justResized=!1);if(window.suppressClick&&window.suppressClick>+new Date)return;if(!e&&this.workspace.page_workspace.controls&&!this.workspace.page_workspace.controls.canControlsBeClosed())return;this.workspace.trigger("deselect",this),this.select(),this.workspace.trigger("select")}else{if(this.outofbox)return;if(window.suppressClick&&window.suppressClick>+new Date)return;if(this.model.get("hidden"))return;if(this._justResized)return void(this._justResized=!1);if(t||(t={shiftKey:!1}),this.frame&&this.frame.rotationState)return;if((t.metaKey||t.ctrlKey)&&!this.model.get("pack_id")){var i=this.workspace.getViewportPosition(),n=t.clientX-(i.viewportWidth-i.width)/2,o=t.clientY+i.top,a=r.a.chain(this.workspace.blocks).filter((function(t){if(t.outofbox)return!1;var e=t.blockBoxToCommonCoords();return e.x<n&&e.x+e.w>n&&e.y<o&&e.y+e.h>o})).sortBy((function(t){return Object(S.a)("constructor.zIndex")?-RM.constructorRouter.indexController.getZIndex(t.id,t.workspace.page.id,t.workspace.page.getCurrentViewport()):-t.model.get("z")})).value(),s=r.a.find(a,(function(t){return t.selected}));if(s){var l=(a.indexOf(s)+1)%a.length;if(a[l])return void a[l].onClick()}}if(this.selected&&!t.shiftKey&&1==this.workspace.getSelectedBlocks().length)return void(this.child_workspace&&(this.child_workspace.trigger("deselect"),this.workspace.controls.onSelect([this])));if(!e&&this.workspace.controls&&!this.workspace.controls.canControlsBeClosed())return;if(t.shiftKey&&this.selected&&!r.a.isEmpty(this.workspace.getSelectedBlocks()))return void this.cutFromSelection();if(t.shiftKey||this.workspace.trigger("deselect",this),this.select(!(!this.model.get("pack_id")||!t.metaKey&&!t.ctrlKey),{noFrame:this.workspace.getSelectedBlocks().length>0||this.model.get("pack_id")&&!(t.metaKey||t.ctrlKey)}),!r.a.isEmpty(this.workspace.getSelectedBlocks()))if(t.metaKey)this.workspace.trigger("select",this.workspace.getSelectedBlocks(),[],!0);else{var c=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks());this.workspace.trigger("select",c.selected,c.deselected)}}},cutFromSelection:function(){if(!this.isStandalone&&this.selected&&this.workspace)if(this.deselect(),0==this.workspace.getSelectedBlocks().length)this.workspace.controls.hide(),this.workspace.trigger("deselect");else if(this.workspace.redefineSelectionWithPacks){var t=this.workspace.redefineSelectionWithPacks(this.workspace.getSelectedBlocks(),this);r.a.isEmpty(t.selected)||this.workspace.trigger("select",t.selected,t.deselected),r.a.isEmpty(t.selected)&&this.workspace.trigger("deselect")}},checkNeedChangeVisibility:function(t){var e=this,i=this.getAnimatedBlocks(),n=this.getTriggerBlocks();n.length>0&&(this.checkTriggerBlocks(n,t),r.a.each(n,(function(i){e.checkBothTypesOfBlocks(i,t)}))),i.length>0&&(this.checkAnimatedBlocks(i,t),r.a.each(i,(function(i){e.checkBothTypesOfBlocks(i,t)}))),this.model.getAnimations().find((function(t){return t.steps&&t.steps[0]}))&&this.changeVisibility(this,t)},checkBothTypesOfBlocks:function(t,e){t.getTriggerBlocks().length>0&&this.checkTriggerBlocks(t.getTriggerBlocks(),e),t.getAnimatedBlocks().length>0&&this.checkAnimatedBlocks(t.getAnimatedBlocks(),e)},checkTriggerBlocks:function(t,e){var i=this;r.a.each(t,(function(t){t.model.getAnimations().find((function(t){return t.steps&&t.steps[0]}))&&i.changeVisibility(t,e)}))},checkAnimatedBlocks:function(t,e){var i=this;r.a.each(t,(function(t){i.changeVisibility(t,e)}))},changeVisibility:function(t,e){"select"===e?t.$el.removeClass("hidden-by-trigger"):t.$el.toggleClass("hidden-by-trigger",!!t.model.getAnimations().find((function(t){return t.steps&&t.steps[0]&&t.steps[0].hideInEditor})))},select:function(t,e){e=e||{},this.isSelectable()&&(this.has_parent_block||this.recalcFixedLine(!0),this.setupAnimationTriggers(t),this.listenTo(this.workspace,"paste-animation",this.resetAnimationTriggers),this.selected||(e.noFrame||this.frame&&this.frame.show(t),this.selected=!0,this.workspace.restoreFocusForCopyPaste.__debounced(),this.trigger("select"),this.workspace.checkBundleDragAbility&&this.workspace.checkBundleDragAbility(),this.checkNeedChangeVisibility("select")))},addToSelection:function(){this.selected=!0,this.frame&&this.frame.show()},deselect:function(t){t!=this&&this.selected&&(this.frame&&this.frame.hide(),this.hidePanel(),this.frame&&this.frame.removeRotationState(),this.selected=!1,this.toggleInPackClass(!1),this.removeFixedLine(),this.teardownAnimationTriggers(),this.stopListening(this.workspace,"paste-animation",this.resetAnimationTriggers),this.child_workspace&&this.child_workspace.trigger("deselect"),this.trigger("deselect"),this.checkNeedChangeVisibility())},isSelectable:function(){return!this.outofbox},isLocked:function(){return!!this.model.get("is_locked")},isFullWidth:function(){return!!this.model.get("is_full_width")},isFullHeight:function(){return!!this.model.get("is_full_height")},onDragStart:function(t,e){if(!this.workspace.disableDragging&&(this.workspace.freezeDeltaX=void 0,e.blocks=this.isStandalone?[this]:this.workspace.getSelectedBlocks(),!r.a.any(e.blocks,(function(t){return t.disableDragging})))){var i=this.model.get("pack_id")?this.workspace.getPackBlocks(this.model.get("pack_id")):[this];if(Object(n.a)("html").addClass("blocks-is-moving"),r.a.isEmpty(e.blocks))e.blocks=i;else if(!this.selected){var o=this.workspace.$container.scrollTop(),a=this.workspace.position;r.a.any(e.blocks,(function(t){return t.contains({x:e.startX-a.left,y:e.startY-a.top+o})}))||(e.blocks=i)}var s=!1;r.a.each(e.blocks,(function(t){t.initialBoxData=t.getBoxData({includeBoundingBox:!0}),t._maxShift=0,s=s||!!t.selected})),s||this.workspace.redrawBottomShiftLine({tp:"move-unselected-start",blocks:e.blocks}),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveStart(e.blocks,t.altKey),e.scrollTop=this.workspace.$container.scrollTop(),this.isDragging=!0,this.workspace.bottomBlocksToMove&&!this.workspace.bottomBlocksToMove.active&&delete this.workspace.bottomBlocksToMove}},onDragMove:function(t,e){var i;if(!r.a.any(e.blocks,(function(t){return t.disableDragging}))&&!this.workspace.disableDragging){e.isClone||this.isStandalone||(e.isClone=t.altKey,e.isClone&&r.a.each(e.blocks,(function(t){t.clone()}))),i=r.a.filter(e.blocks,(function(t){return!t.isLocked()}));var n=e.startY+e.scrollTop,o=t.pageY+this.workspace.$container.scrollTop();e.deltaY=o-n;var a=RM.constructorRouter.zoom.getZoom();e.deltaX=e.deltaX/a,e.deltaY=e.deltaY/a,this.moveBlocks(this.workspace,i,e,t),Object(S.a)("constructor.distance")&&this.workspace.distance.update(i),this.isStandalone||(this.workspace.redrawPacksFrames({tp:"move"}),this.workspace.redrawBottomShiftLine({tp:"move"})),v.default.autoWindowScroll(t,this.workspace.$container,r.a.bind((function(){this.onDragMove(t,e)}),this))}},moveBottomBlocks:function(t,e,i,n){var o=t.bottomBlocksToMove;if(o){var a=e+n.y-(o.deltaYcorrection||0);i&&(a=Math.max(a,0)),o.active&&(r.a.each(o.list,(function(t,e){var i=o.initial[e],n=a+i.y;t.css({doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0,left:i.x,top:n}),t.trigger("move",{left:i.x,top:n,width:i.w,height:i.h})})),o.list&&o.list.length&&(t.page.setCurrentViewportParam("type","scroll"),t.page.setCurrentViewportParam("height",Math.ceil(Math.max(o.initPageHeight+a,o.minPageHeight))))),o.prevDeltaY=e}t.checkBundleDragAbility()},"collectBottomBloсks":function(t,e,i){var n=t.bottomBlocksToMove;n&&(n.kbActivate&&"keydown"==i.type||"drag"==i.type)&&(n.list||(r.a.extend(n,t.calcBottomBlocksToMove(e,n)),n.tosave=r.a.uniq((n.tosave||[]).concat(n.list)),n.deltaYcorrection=n.prevDeltaY||0))},resizeBlocks:function(t,e,i,n){r.a.each(e,(function(t){var e=t.model.get("h"),o=t.model.get("w");t.onResizeStart&&t.onResizeStart(n,i);var a=t.getModelBox();if(t.proportional){var s=o/e,r=i.deltaX?o+i.deltaX:(e+i.deltaY)*s,l=i.deltaY?e+i.deltaY:(o+i.deltaX)/s;a.height=l,a.width=r}else a.height=e+i.deltaY,a.width=o+i.deltaX;a.height=Math.round(a.height),a.width=Math.round(a.width),t.frame.doResize(a,!1,"se"),t.onResizeEnd&&t.onResizeEnd(n,i)}));var o=r.a.map(e,function(t){return r.a.extend({},t.getSaveBoxData(),{_id:t.id})}.bind(this));t.set_group(o,r.a.extend({isGroupResize:!0})),t.save_group(o,r.a.extend({isGroupResize:!0}))},moveBlocks:function(t,e,i,o){var a=999999,s=999999,l=-999999,c=-999999,d=o&&"keydown"==o.type,h=null,u=r.a.any(e,(function(t){return t.isFullWidth()})),p=r.a.any(e,(function(t){return!!t.constraintHorzMove})),g=r.a.any(e,(function(t){return t.isFullHeight()})),m=r.a.any(e,(function(t){return!!t.constraintVertMove}));t&&A.prototype.collectBottomBloсks(t,e,o);var f=t&&t.spacesController&&t.spacesController.checkAllBlocksNear(e),v=!1,b=0,_=t&&t.getViewportPosition();r.a.each(e,(function(n){var r=t&&void 0!==t.freezeDeltaX?t.freezeDeltaX:i.deltaX,y=i.deltaY-(n.resetDelta||0),w=n.initialBoxData||n.getBoxData({includeBoundingBox:!0});t&&t._inTriangleBundleDrag&&(r=0);var k=n.model.get("fixed_position");if(t&&t.spacesController&&!k){var x=t.spacesController.getRestriction(n.model,f?e:[]),C=y+w.bb_y,O=y+w.bb_y+w.bb_h,P=y;C<x.top?(y=Math.floor(x.top-w.bb_y),void 0===t.freezeDeltaX&&f&&t.spacesController.needFreeze(n)&&(t.freezeDeltaX=r)):O>x.bottom?(y=Math.floor(x.bottom-(w.bb_y+w.bb_h)),void 0===t.freezeDeltaX&&f&&t.spacesController.needFreeze(n)&&(t.freezeDeltaX=r)):t.freezeDeltaX=void 0,Math.abs(P-y)&&"drag"===o.type&&f&&(v=!0,b=P-y)}k&&(o&&"keydown"!==o.type&&(y=(o.pageY-i.startY)/RM.constructorRouter.zoom.getZoom()),k.indexOf("e")>-1&&(r=-r),k.indexOf("s")>-1&&(y=-y)),k={x:r+w.x,y:y+w.y,w:w.w,h:w.h};var j={x:r+w.bb_x,y:y+w.bb_y};if(o&&o.shiftKey){var $=Math.abs(r),T=Math.abs(y);if(n._shiftDirection||d||($>=4&&(n._shiftDirection="horz"),T>=4&&(n._shiftDirection="vert"),($>=4||T>=4)&&r/y<2&&r/y>.5&&(n._shiftDirection="diag1"),($>=4||T>=4)&&r/y>-2&&r/y<-.5&&(n._shiftDirection="diag2"),n._maxShift=Math.max($,T)),(u||p)&&(n._shiftDirection="vert"),(g||m)&&(n._shiftDirection="horz"),n._shiftDirection&&!d){var I=r;"horz"!=n._shiftDirection&&"vert"!=n._shiftDirection||(Math.abs(r)>n._maxShift&&(n._maxShift=Math.abs(r),n._shiftDirection="horz"),Math.abs(y)>n._maxShift&&(n._maxShift=Math.abs(y),n._shiftDirection="vert")),t.spacesController||("horz"==n._shiftDirection&&(k.y=w.y,j.y=w.bb_y),"vert"==n._shiftDirection&&(k.x=w.x,j.x=w.bb_x),"diag1"==n._shiftDirection&&(k.x=w.x+I,k.y=w.y+I,j.x=w.bb_x+I,j.y=w.bb_y+I),"diag2"==n._shiftDirection&&(k.x=w.x+I,k.y=w.y-I,j.x=w.bb_x+I,j.y=w.bb_y-I)),h=n._shiftDirection}}var E=n.model.get("fixed_position");if(E&&_&&Object(S.a)("constructor.snapFixed")){var M=j.x,R=j.y;switch(E){case"nw":case"n":case"ne":R+=_.top;break;case"e":case"c":case"w":R+=_.top+_.height/2-w.bb_h/2;break;case"sw":case"s":case"se":R=_.top+_.height-R-w.bb_h}switch(E){case"nw":case"w":case"sw":M-=(_.viewportWidth-_.width)/2;break;case"n":case"c":case"s":M+=_.width/2-w.bb_w/2;break;case"ne":case"e":case"se":M=_.width+(_.viewportWidth-_.width)/2-M-w.bb_w}a=Math.min(a,M),s=Math.min(s,R),l=Math.max(l,M+w.bb_w),c=Math.max(c,R+w.bb_h)}else a=Math.min(a,j.x),s=Math.min(s,j.y),l=Math.max(l,j.x+w.bb_w),c=Math.max(c,j.y+w.bb_h);(u||p)&&(k.x=w.x),(g||m)&&(k.y=w.y),n._position=k})),v&&!o.altKey?t&&t.spacesController.updateGhost(e,b,i.deltaX-t.freezeDeltaX,Object(n.a)("> .workspace",t.$el),o):t&&t.spacesController&&t.spacesController.removeGhost();var y={x:0,y:0};!RM.constructorRouter.gg.snap||r.a.all(e,(function(t){return t.model.get("fixed_position")}))&&!Object(S.a)("constructor.snapFixed")||(y=RM.constructorRouter.gg.handleSnapMove({x:a,y:s},l-a,c-s,i.isClone,"keydown"===o.type),"horz"==h&&(y.y=0),"vert"==h&&(y.x=0),(u||p)&&(y.x=0),(g||m)&&(y.y=0),"keydown"===o.type&&Object(S.a)("constructor.distance")&&(y.x=0,y.y=0,RM.constructorRouter.gg.hideLinesWithDelay()));var w={};if(i.isClone&&(w.clone=!0),r.a.each(e,(function(t){var e=t.model.get("fixed_position"),i=e in{ne:1,e:1,se:1}?-y.x:y.x,n=e in{se:1,s:1,sw:1}?-y.y:y.y;t.css(r.a.extend({doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0,left:Math.ceil(t._position.x+i),top:Math.ceil(t._position.y+n)},w)),t.recalcFixedLine(),t.recalcStickedLine(),t.trigger("move",{left:Math.ceil(t._position.x+i),top:Math.ceil(t._position.y+n),width:Math.ceil(t._position.w),height:Math.ceil(t._position.h)})})),t){var k=i.isCloneByKeys?i.deltaYOrig:i.deltaY;A.prototype.moveBottomBlocks(t,k,i.isClone,y)}},onDragEnd:function(t,e){if(v.default.autoWindowScrollClear(),Object(S.a)("constructor.distance")&&this.workspace.distance.hide(),!r.a.any(e.blocks,(function(t){return t.disableDragging}))&&!this.workspace.disableDragging){var i=!1;if(r.a.each(e.blocks,(function(t){t.initialBoxData=null,t.resetDelta=null,t._shiftDirection=null,i=i||!!t.selected})),i||this.workspace.redrawBottomShiftLine({tp:"move-unselected-end"}),e.isClone)this.workspace.cloneBlocks(r.a.filter(e.blocks,(function(t){return!t.isLocked()})));else if(this.isStandalone)r.a.first(e.blocks).saveBox();else{this.workspace.spacesController&&this.workspace.spacesController.moveBlocksToHighlighted(e.blocks),this.workspace.spacesController&&this.workspace.spacesController.removeGhost();var o=this.workspace.bottomBlocksToMove,a=this.workspace.spacesController&&this.workspace.spacesController.getBlocksToSave()||[],s=r.a.map([].concat(e.blocks,o&&o.tosave||[],a),function(t){return r.a.extend({_id:t.id},t.getBoxData({includeFreeze:e.deltaX-this.workspace.freezeDeltaX}))}.bind(this));o&&o.initPageHeight!=this.workspace.page.getCurrentViewportParam("height")&&o.tosave&&o.tosave.length&&this.workspace.page.save(),this.workspace.page.getCurrentViewportParam("height")>2e3&&e.deltaY>0&&e.deltaY>Math.abs(e.deltaX)&&(!o||!o.active)&&e.blocks.length>5&&RM.constructorRouter.helpPanel.showTip({name:"bottom-blocks-to-move",showOnce:!0}),this.workspace.save_group(s)}Object(n.a)("html").removeClass("blocks-is-moving"),RM.constructorRouter.gg.snap&&RM.constructorRouter.gg.handleMoveEnd(),e.isClone||this.triggerRedraw(),this.isDragging=!1,"hotspot"===this.model.get("type")&&Object(n.a)(t.target).one("click",(function(t){t.stopImmediatePropagation()})),this.workspace.clearBottomBlocksToMove(),this.workspace.checkBundleDragAbility()}},triggerRedraw:function(){this.isStandalone||this.workspace.trigger("redraw",{is_global:this.model.get("is_global")})},recalcFixedLine:function(t){var e=this.model.get("fixed_position")||this.restoreFixed,i=this.model.get("pack_id"),n=i&&this.workspace.packs&&this.workspace.packs[i],o=this.selected||t;e&&!n&&o?this.updateFixedLine(e):this.removeFixedLine()},updateFixedLine:function(t){this.$fixed_svg||(this.$fixed_svg=Object(n.a)('<svg class="fixed-line"><line /></svg>'),this.workspace.$(".workspace").append(this.$fixed_svg));var e,i,o,a,s,r,l=this.frame.$el.offset(),c=this.getBoxData(),d=this.$fixed_svg.find("line").get(0),h=RM.constructorRouter.zoom.getZoom(),u=this.isFullHeight(),p=this.workspace.$container.width()/h,g=this.workspace.$container.height()/h;s=r=0,"default"!=this.model.getViewport()&&(s=this.workspace.position.left,r=this.workspace.position.top),e=s,o=r,i=l.left,a=l.top,t.indexOf("s")>-1&&(o=g-r,a+=c.h),t.indexOf("e")>-1&&(e=p-s,i+=c.w),["n","c","s"].indexOf(t)>-1&&(e=p/2,i+=c.w/2),["w","c","e"].indexOf(t)>-1&&(o=g/2,a+=c.h/2),u&&(a=o),d.setAttributeNS(null,"x1",e),d.setAttributeNS(null,"x2",i),d.setAttributeNS(null,"y1",o),d.setAttributeNS(null,"y2",a)},removeFixedLine:function(){this.$fixed_svg&&this.$fixed_svg.remove(),delete this.$fixed_svg},recalcStickedLine:function(){var t=this.model.get("sticked"),e={left:"",right:"",top:"",bottom:"",width:"",height:""};if(t){var i="left"==t||"right"==t;this.$stickedLine||(this.$stickedLine=Object(n.a)("<div>").addClass("sticked-line skip-rotate").appendTo(this.$el)),this.$stickedLine.removeClass("line-horizontal line-vertical"),this.$stickedLine.addClass(i?"line-horizontal":"line-vertical"),i?(e.width=this.calcStickedMargin(this.latestPosSizeAngle.left,this.latestPosSizeAngle.width),e[t]=-e.width):(e.height=this.calcStickedMargin(this.latestPosSizeAngle.top,this.latestPosSizeAngle.height),e[t]=-e.height),this.$stickedLine.css(e)}else this.$stickedLine&&(this.$stickedLine.remove(),delete this.$stickedLine)},clone:function(){this.isLocked()||(this.$cloneEl=Object(n.a)(n.a.clone(this.$el.get(0))),this.$cloneEl.data("id",this.$cloneEl.data("id")+"-clone"),this.$cloneEl.insertAfter(this.$el)),this.deselect()},blink:function(){var t=this.$el;t.addClass("frame-blink"),v.default.waitForTransitionEnd(t,2500,"opacity",(function(){t.removeClass("frame-blink")}))},getStandardName:function(){var t=this.model.get("type");if("text"===t)return this.model.get("version")===O.version?Object(C.n)(this.model):Object(n.a)(this.model.get("text")).text();if("shape"===t){var e=this.model.get("tp");return v.default.capitalize({ellipse:"oval"}[e]||e)}return"button"===t&&"text"===this.model.get("tp")?this.model.get("text"):this.name?this.name:v.default.capitalize(t)},highlight:function(t,e){var i=this.animationMode?(this.workspace.animationSteps.currentStep||this.workspace.animationSteps.initialStep).$el:this.$el;e&&i&&i.toggleClass(e,Boolean(t))},getTriggerBlocks:function(){var t=this;return this.getAllTriggers().reduce((function(e,i){var n=t.workspace.findBlock(i);return n?[].concat(j(e),[n]):e}),[])},getAnimationTriggers:function(t){var e=this.model.getAnimations().find((function(e){return e.UUID===t}));return _.a.normalizeAnimationTriggers(e&&e.trigger)},getAllAnimationTriggers:function(){return this.model.getAnimations().reduce((function(t,e){return e.trigger?[].concat(j(t),j(_.a.normalizeAnimationTriggers(e&&e.trigger))):t}),[])},getAllTriggers:function(){return r.a.unique([].concat(j(this.getAllAnimationTriggers()),j(this.model.get("triggers")||[])))},setAnimationTriggers:function(t,e){var i=this.model.getAnimations().map((function(i){return i.UUID===t?T(T({},i),{},{trigger:e&&!r.a.isArray(e)?[e]:e||[]}):i}));this.model.set("animation",i)},removeAllAnimationTriggers:function(){var t=this;this.model.getAnimations().forEach((function(e){t.getAnimationTriggers(e.UUID).forEach((function(i){return t.removeAnimationTrigger(e.UUID,i)}))}))},removeAnimationTrigger:function(t,e){var i=this.getAnimationTriggers(t);-1!==i.indexOf(e)&&(this.setAnimationTriggers(t,r.a.without(i,e)),this.model.trigger("animation:trigger:remove",e))},isPackAlreadySetUp:function(t){return Boolean(t&&this.workspace.getPackBlocks&&r.a.find(this.workspace.getPackBlocks(t),(function(t){return t.ownTooltip})))},getAnimatedBlocks:function(){var t=r.a.reduce(this.workspace.blocks,function(t,e){if(e.getAllTriggers().includes(this.id)){var i=this.model.get("pack_id")||e.id;t[i]=t[i]||e}return t}.bind(this),{});return r.a.values(t)},getTooltipTarget:function(t){var e=this.model.get("pack_id"),i=e&&this.workspace.$("#pack_"+e);return this.animationMode?this.workspace.animationSteps.initialStep.$el:i&&i.length&&!t?i.find(".content"):this.$el},getTooltipContainer:function(){return this.workspace.$(".workspace")},setupAnimationTriggers:function(t){var e=this.getAnimatedBlocks(),i=this.getTriggerBlocks();r.a.each(e,this.setupAnimationTrigger.bind(this,!0)),r.a.each(i,this.setupAnimationTrigger.bind(this,!1)),!(e.length&&(e.length>1||e[0].id!==this.id))&&!i.length||this.isPackAlreadySetUp(this.model.get("pack_id"))||this.ownTooltip||(this.ownTooltip=this.getTooltipTarget(t).RMAltText({text:e.length&&i.length?"Animated / Trigger":e.length?"Trigger":"Animated",offset:this.TOOLTIP_OFFSET,manual:!0,cssClass:"animation-trigger-tooltip animation-trigger-own-tooltip skip-rotate",container:this.getTooltipTarget(t),keepInBounds:!0,targetZoom:RM.constructorRouter.zoom.getZoom()}),this.ownTooltip.show(),this.bindAnimationTriggerHandlers())},teardownAnimationTriggers:function(){var t=r.a.keys(this.triggerAssets);r.a.each(t,this.teardownAnimationTrigger.bind(this)),this.ownTooltip&&this.ownTooltip.destroy(),delete this.ownTooltip,this.unbindAnimationTriggerHandlers()},setupAnimationTrigger:function(t,e){if(e){var i=this.model.get("pack_id"),n=e.id,o=e.model.get("pack_id"),a=o&&this.workspace.$("#pack_"+o);this.triggerAssets[n]=this.triggerAssets[n]||{},this.triggerAssets[n].tooltip||n===this.id||i&&o===i||e.ownTooltip||(this.triggerAssets[n].tooltip=(a||e.$content).RMAltText({text:a||t?"Animated":"Trigger",offset:this.TOOLTIP_OFFSET,manual:!0,cssClass:"animation-trigger-tooltip skip-rotate",container:a||e.$el,keepInBounds:!0,targetZoom:RM.constructorRouter.zoom.getZoom()}),this.triggerAssets[n].tooltip.show(),a?a.addClass(_.a.ACTIVE_TRIGGER_CLASS):e.highlight(!0,_.a.ACTIVE_TRIGGER_CLASS),this.triggerAssets[n].updateLinkedTooltipBound=this.updateLinkedTooltip.bind(this,n),this.listenTo(e,"move resize",this.triggerAssets[n].updateLinkedTooltipBound),this.listenTo(e&&e.model,"change:x change:y change:w change:h",this.triggerAssets[n].updateLinkedTooltipBound))}},teardownAnimationTrigger:function(t){var e=this.workspace.findBlock(t);e&&e.highlight(!1,_.a.ACTIVE_TRIGGER_CLASS),this.workspace.$("."+_.a.ACTIVE_TRIGGER_CLASS).removeClass(_.a.ACTIVE_TRIGGER_CLASS),this.triggerAssets[t]&&(this.triggerAssets[t].tooltip&&this.triggerAssets[t].tooltip.destroy(),this.stopListening(e,"move resize",this.triggerAssets[t].updateLinkedTooltipBound),this.stopListening(e&&e.model,"change:x change:y change:w change:h",this.triggerAssets[t].updateLinkedTooltipBound),delete this.triggerAssets[t])},bindAnimationTriggerHandlers:function(){this.animationTriggerHandlersBound||(this.listenTo(this,"move resize",this.updateOwnTooltip),this.listenTo(this,"animationMode",this.resetAnimationTriggers),this.listenTo(this,"animation:stepsPopup:open",this.onStepsPopupOpen),this.listenTo(this,"animation:stepsPopup:closed",this.onStepsPopupClosed),this.listenTo(this.model,"change:angle change:x change:y change:w change:h change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateOwnTooltip),x.a.on("zoom",this.updateTooltips),Object(n.a)("#main").on("scroll",this.updateTooltips),this.animationTriggerHandlersBound=!0)},unbindAnimationTriggerHandlers:function(){this.stopListening(this,"move resize",this.updateOwnTooltip),this.stopListening(this,"animationMode",this.resetAnimationTriggers),this.stopListening(this,"animation:stepsPopup:open",this.onStepsPopupOpen),this.stopListening(this,"animation:stepsPopup:closed",this.onStepsPopupClosed),this.stopListening(this.model,"change:angle change:x change:y change:w change:h change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateOwnTooltip),this.stopListening(this.workspace,"workspace-resize",this.updateTooltips),Object(n.a)("#main").off("scroll",this.updateTooltips),delete this.animationTriggerHandlersBound},updateTooltips:function(){window.requestAnimationFrame(function(){r.a.each(this.getAllTriggers(),this.recalcLinkedTooltip),this.recalcOwnTooltip()}.bind(this))},updateLinkedTooltip:function(t){window.requestAnimationFrame(this.recalcLinkedTooltip.bind(this,t))},updateOwnTooltip:function(){window.requestAnimationFrame(this.recalcOwnTooltip.bind(this))},recalcLinkedTooltip:function(t){this.triggerAssets[t]&&this.triggerAssets[t].tooltip&&(this.triggerAssets[t].tooltip.setTargetZoom(RM.constructorRouter.zoom.getZoom()),this.triggerAssets[t].tooltip.update())},recalcOwnTooltip:function(){this.ownTooltip&&(this.ownTooltip.setTargetZoom(RM.constructorRouter.zoom.getZoom()),this.ownTooltip.update())},onStepsPopupOpen:function(t){var e,i=this.ownTooltip&&this.ownTooltip.getElement(),n=i&&i[0]&&i[0].getBoundingClientRect();if(t){var o=t.find(".js-steps-popup");e=o&&o.length&&o[0].getBoundingClientRect()}n&&e&&b.a.doBoundingBoxesIntersect(n,e)&&this.ownTooltip.hide()},onStepsPopupClosed:function(){this.ownTooltip&&!this.ownTooltip.getElement()&&this.ownTooltip.show()},getSaveBoxData:function(t){var e=this.getBoxData();return this.model.get("is_full_width")&&(e=r.a.omit(e,"x")),this.model.get("is_full_height")&&(e=r.a.omit(e,"y")),e},getSaveBoxOptions:function(t){return t||{}},saveBox:function(t){this._saveXHR&&this._saveXHR.abort(),this._saveXHR=this.model.save(this.getSaveBoxData(t),this.getSaveBoxOptions(t))},getBoxData:function(t){t=t||{};var e=this.latestPosSizeAngle,i=this.model.get("is_full_width"),n=this.model.get("is_full_height"),o={w:e.width,h:e.height,x:e.left,y:e.top};if(t.includeFreeze&&(o.x+=t.includeFreeze),t.includeRotationData&&(o.angle=e.angle,o.flip_v=e.flip_v,o.flip_h=e.flip_h),t.includeBoundingBox&&(o.bb_w=e.bb_width,o.bb_h=e.bb_height,o.bb_x=e.bb_left,o.bb_y=e.bb_top),this.model.get("fixed_position")&&t.checkFixedPosition){var a=r.a.clone(o),s=this.$el.offset(),l=this.workspace.position;o.y=s.top-l.top,o.x=s.left-l.left,t.includeBoundingBox&&(o.bb_x=o.x+(o.bb_x-a.x),o.bb_y=o.y+(o.bb_y-a.y))}if(i){var c=this.getFullWidthDims();o.x=c.x,o.w=c.w}if(n){var d=this.getFullHeightDims();o.y=d.y,o.h=d.h}return this.model.get("sticked")&&(o.sticked_margin=e.sticked_margin),o},getModelBox:function(){var t=this.model.get("angle")||0,e=t?t*Math.PI/180:0;return{left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h"),angle:t,flip_v:!!this.model.get("flip_v"),flip_h:!!this.model.get("flip_h"),sinAngle:Math.sin(-e),cosAngle:Math.cos(-e)}},getPack:function(){var t=this.model.get("pack_id");return t&&this.workspace.packs[t]},onPackChange:function(t,e,i){this.toggleInPackClass(),r.a.isEmpty(this.workspace.getSelectedBlocks())||this.workspace.trigger("select",this.workspace.getSelectedBlocks()),this.workspace.redrawPacksFrames({tp:"pack-change"}),this.isLocked()&&(i.undo||i.redo)&&t.save({is_locked:!1},{patch:!0,skipHistory:!0}),this.recalcFixedLine(),this.selected&&this.resetAnimationTriggers()},checkNeedRedraw:function(t,e){e=e||{};var i=t.changedAttributes();return(!e.pid||!this.workspace||this.workspace.page.id===e.pid)&&(!!this.workspace.rendered&&(1!=r.a.keys(i).length||!i.animation))},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&this.redrawPosition(t,r.a.extend(e,{forceRedraw:!1}))},updateLockDragState:function(){this.$el.toggleClass("no-drag",this.isLocked())},redrawPosition:function(t,e){e=e||{},t=t||this.model;var i={},n=e.forceRedraw?{}:this.getBoxData({includeRotationData:!0}),o=this.model.changedAttributes(),a=r.a.has(o,"is_full_width"),s=r.a.has(o,"is_full_height");a&&this.$el.toggleClass("full-width",!!this.model.get("is_full_width")),s&&this.$el.toggleClass("full-height",!!this.model.get("is_full_height"));var l=t.get("fixed_position"),c=!!t.get("is_full_width"),d=!!t.get("is_full_height");if((t.get("x")!=n.x||l)&&(i.left=t.get("x")),c){var h=this.getFullWidthDims();i.left=h.x}if((t.get("y")!=n.y||l)&&(i.top=t.get("y")),d){var u=this.getFullHeightDims();i.top=u.y}if((t.get("w")!=n.w||l||c)&&(i.width=t.get("w")),e.socketUpdate&&c&&(i.width=h.w),e.socketUpdate&&d&&(i.height=u.h),(t.get("h")!=n.h||l||d)&&(i.height=t.get("h")),Object(S.a)("constructor.zIndex")||t.get("z")!=this.$content.css("z-index")&&(i["z-index"]=t.get("z")),(t.get("angle")||0)!=n.angle&&(i.angle=t.get("angle")||0),!!t.get("flip_v")!=n.flip_v&&(i.flip_v=!!t.get("flip_v")),!!t.get("flip_h")!=n.flip_h&&(i.flip_h=!!t.get("flip_h")),r.a.isEmpty(i)||(e.doNotRedrawPacksFrames&&(i.doNotRedrawPacksFrames=!0),e.doNotRedrawBottomShiftLine&&(i.doNotRedrawBottomShiftLine=!0),this.css(i)),(l||e.undo||e.redo)&&this.recalcFixedLine(),(t.get("sticked")||r.a.has(o,"sticked"))&&(this.recalcStickedLine(),(o.x||o.y)&&!r.a.has(o,"sticked")&&this.workspace.page.getPreviousViewport()===this.workspace.page.getCurrentViewport())){var p=this.getBoxData().sticked_margin;p&&!isNaN(p)&&this.model.get("sticked_margin")!=p&&this.model.set({sticked_margin:p},{first:!0})}e.skipTriggerRedraw||e.forceRedraw||this.triggerRedraw()},showPanel:function(){this.workspace.controls.selectFirst()},hidePanel:function(){this.panel&&this.panel.hide()},inArea:function(t){if(!this.model.get("hidden")){var e=this.model.get("fixed_position"),i=this.getBoxData({includeBoundingBox:!0,includeRotationData:!0,checkFixedPosition:!0});if(e){var n=RM.constructorRouter.zoom.getZoom();i.bb_y+=this.workspace.$container.scrollTop()/n,i.bb_x+=this.workspace.$container.scrollLeft()/n}var o=Math.max(t.x,i.bb_x)<Math.min(t.x+t.w,i.bb_x+i.bb_w)&&Math.max(t.y,i.bb_y)<Math.min(t.y+t.h,i.bb_y+i.bb_h);if(o&&i.angle){var a;if(e){var s=RM.constructorRouter.zoom.getZoom();a={top:i.y+this.workspace.$container.scrollTop()/s,left:i.x+this.workspace.$container.scrollLeft()/s,width:i.w,height:i.h,sinAngle:this.latestPosSizeAngle.sinAngle,cosAngle:this.latestPosSizeAngle.cosAngle}}var r=b.a.calcRotatedBox(a||this.latestPosSizeAngle);o=b.a.isConvexPolygonsIntersects(r,[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h},{x:t.x,y:t.y+t.h}])}return o}},contains:function(t){if(!this.model.get("hidden")){var e=this.getBoxData({includeBoundingBox:!0,includeRotationData:!0}),i=e.bb_x<t.x&&e.bb_x+e.bb_w>t.x&&e.bb_y<t.y&&e.bb_y+e.bb_h>t.y;if(i&&e.angle){var n=b.a.calcRotatedBox(this.latestPosSizeAngle);i=b.a.isConvexPolygonContainsPoint(n,t)}return i}},showIconLoader:function(){this.isLoading=!0},hideIconLoader:function(){this.isLoading=!1},onBlockVisibilityChange:function(t){var e=!!t.get("hidden");this.$el.toggleClass("invisible",e),e&&(this.triggerRedraw(),this.cutFromSelection())},storeFixedPosition:function(){if(this.model.get("fixed_position")){this.restoreFixed=this.model.get("fixed_position");var t=RM.constructorRouter.zoom.getZoom(),e=this.getBoxData({checkFixedPosition:!0});e.y=e.y+this.workspace.$container.scrollTop()/t,e.x=e.x+this.workspace.$container.scrollLeft()/t,this.model.set(r.a.extend(e,{fixed_position:""}),{skipHistory:!0})}},restoreFixedPosition:function(){if(this.restoreFixed){var t=this.getBoxData(),e=this.$el.offset(),i="default"!=this.model.getViewport()?this.workspace.position.left:0,o="default"!=this.model.getViewport()?this.workspace.position.top:0,a=RM.constructorRouter.zoom.getZoom(),s={x:(this.restoreFixed.indexOf("e")>-1?Object(n.a)(window).width()/a-e.left-t.w:e.left)-i,y:(this.restoreFixed.indexOf("s")>-1?Object(n.a)(window).height()/a-e.top-t.h:e.top)-o,w:t.w,h:t.h,fixed_position:this.restoreFixed};["n","c","s"].indexOf(this.restoreFixed)>-1&&(s.x-=Object(n.a)("#main").width()/2/a-t.w/2-i),["e","c","w"].indexOf(this.restoreFixed)>-1&&(s.y-=Object(n.a)("#main").height()/2/a-t.h/2-o),this.model.set(s,{skipHistory:!0}),delete this.restoreFixed}},resetFullWidth:function(){this.model.get("is_full_width")&&this.model.set({is_full_width:!1,x:this.model.get("full_width_initial_x")||this.model.get("x"),w:this.model.get("full_width_initial_w")||this.model.get("w")})},resetFullHeight:function(){this.model.get("is_full_height")&&this.model.set({is_full_height:!1,y:this.model.get("full_height_initial_y")||this.model.get("y"),h:this.model.get("full_height_initial_h")||this.model.get("h")})},onFixPosition:function(t,e,i){Object(S.a)("constructor.zIndex")?this.css({"z-index":RM.constructorRouter.indexController.getZIndex(this.model.id,this.workspace.page.id,this.workspace.page.getCurrentViewport()),width:this.model.get("w"),height:this.model.get("h"),top:this.model.get("y"),left:this.model.get("x"),"margin-left":0,"margin-top":0}):this.css({"z-index":this.model.get("z"),width:this.model.get("w"),height:this.model.get("h"),top:this.model.get("y"),left:this.model.get("x"),"margin-left":0,"margin-top":0}),i&&(i.redo||i.undo)&&!r.a.isEmpty(this.workspace.getSelectedBlocks())&&this.workspace.trigger("select",this.workspace.getSelectedBlocks()),this.checkRetargetScroll(),this.recalcFixedLine()},onAnimationTriggerAdd:function(){this.resetAnimationTriggers()},onAnimationTriggerRemove:function(t){this.resetAnimationTriggers()},resetAnimationTriggers:function(){var t=this;this.teardownAnimationTriggers(),window.requestAnimationFrame((function(){t.selected&&t.setupAnimationTriggers()}))},checkRetargetScroll:function(){this.retargetScroll&&this.retargetScroll.restore&&this.retargetScroll.restore(),this.model.get("fixed_position")&&(this.retargetScroll=Object(w.a)(this.$el.get(0),this.workspace.$container.get(0)))},onWorkspaceBlocksSelect:function(t,e,i){this.isStandalone||(t&&1==t.length&&t[0]==this?(this.frame&&!this.frame.isFrameVisible()&&this.frame.show(i),this.toggleInPackClass(!1)):(this.frame&&this.frame.removeRotationState(),this.toggleInPackClass(!0)))},isRealChangeByMe:function(t){return!((t=t||{}).socketUpdate||this.workspace!=RM.constructorRouter.workspace||!RM.constructorRouter.workspace.page||!RM.constructorRouter.isPageLockedByMe(RM.constructorRouter.workspace.page.get("_id")))},toggleAnimationMode:function(t){this.$el.toggleClass("animation-mode",!!t),this.animationMode=!!t,this.model.get("pack_id")&&(this.isPackFrameHidden=t,this.workspace.redrawPacksFrames({tp:"animation-mode"})),this.workspace.redrawBottomShiftLine({tp:"animation-mode"}),this.trigger("animationMode",t)},getStickedSide:function(){var t=this.model.get("sticked");if(t)return"default"!==this.model.getViewport()&&"bottom"!==t&&(this.model.set("sticked",void 0),t=void 0),t},checkDisabledControls:function(t,e){return[]},destroy:function(){this.frame&&this.frame.removeRotationState(),this.frame&&this.frame.destroy(),this.workspace.off("select",this.onWorkspaceBlocksSelect),this.destroyed=!0,this.cutFromSelection(),this.$el.empty().remove(),this.stopListening(this.model,"change"),this.model.isGlobal&&!this.model.isGlobal()&&this.triggerRedraw(),this.rendered=!1,this.workspace.off("deselect",this.deselect),this.model.off("change",this.onModelChange),this.model.off("change:pack_id",this.onPackChange),this.model.off("change:is_locked",this.updateLockDragState),this.model.off("change:fixed_position",this.onFixPosition),this.model.off("change:hidden",this.onBlockVisibilityChange),Object(S.a)("constructor.zIndex")&&(x.a.off("index:changed",this.onIndexChange),this.workspace.page.off("change:viewport",this.onIndexChange)),this.stopListening(this.model,"animation:trigger:add"),this.stopListening(this.model,"animation:trigger:remove"),this.stopListening(this.model,"animation:type:change"),this.workspace.off("workspace-resize",this.onWorkspaceResize),this.$el.off(),this.panel&&(this.panel.destroy(),delete this.panel),this.trigger("destroy")}},{getViewportDefaults:function(t,e,i){i=i||{};var n,o=y.c.getViewportSetting("width","default"),a=y.c.getViewportSetting("width",e),s=Math.round((a-o)/2),r=t.get("is_full_width")&&"default"!==e,l=t.get("is_full_height")&&"default"!==e,c=t.get("fixed_position");return n={x:t.get("x"),y:t.get("y")},(i.clone||i.copy)&&(s=0),c?(n.x=n.x-RM.constructorRouter.workspace.position.left,n.y=n.y-RM.constructorRouter.workspace.position.top,["n","c","s"].indexOf(i.fixed||c)>-1&&delete n.x,["w","c","e"].indexOf(i.fixed||c)>-1&&delete n.y):n.x=n.x+s,r&&(n.is_full_width=!1,n.w=t.get("full_width_initial_w")||t.get("w"),c||(n.x=(t.get("full_width_initial_x")||t.get("x"))+s)),l&&(n.is_full_height=!1,n.h=t.get("full_height_initial_h")||t.get("h"),c||(n.y=t.get("full_height_initial_y")||t.get("y"))),t.get("triggers")&&(n.triggers=j(t.get("triggers"))),n}});A.prototype.template=d.a["template-constructor-block"],RM.vue=RM.vue||{},RM.vue.Sizes=o.default.extend(f);e.a=A},qOkM:function(module,exports){module.exports={"template-constructor-control-text_styles":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Styles" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-scroll-wrapper">\n\t\t\t\t<div class="edit-content-wrapper">\n\t\t\t\t\t<div class="edit-content">\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="caption" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item font-family-click-area">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item font-style-click-area">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item color-click-area">\n\t\t\t\t\t\t\t<div class="color-value"></div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item ">\n\t\t\t\t\t\t\t<input class="font-size" data-param="font-size" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="font-size-icon" title="Font Size"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="line-height" data-param="line-height" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="line-height-icon" title="Line Height"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<input class="letter-spacing" data-param="letter-spacing" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<div class="letter-spacing-icon" title="Tracking"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<div class="text-align-left switcher" title="Left Align" data-param="text-align" data-val="left"></div>\n\t\t\t\t\t\t\t<div class="text-align-center switcher" title="Center" data-param="text-align" data-val="center"></div>\n\t\t\t\t\t\t\t<div class="text-align-right switcher" title="Right Align" data-param="text-align" data-val="right"></div>\n\t\t\t\t\t\t\t<div class="text-align-justify switcher" title="Justify" data-param="text-align" data-val="justify"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item">\n\t\t\t\t\t\t\t<div class="text-transform switcher" title="All Caps" data-param="text-transform" data-val="uppercase"></div>\n\t\t\t\t\t\t\t<div class="text-underline switcher" title="Underline" data-param="text-decoration" data-val="underline"></div>\n\t\t\t\t\t\t\t<div class="text-strike switcher" title="Strike" data-param="text-decoration" data-val="line-through"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item paddings">\n\t\t\t\t\t\t\t<div class="padding-icon"></div>\n\t\t\t\t\t\t\t<input class="padding-left" title="Left Margin" data-param="padding-left" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-right" title="Right Margin" data-param="padding-right" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-top" title="Top Margin" data-param="padding-top" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t\t<input class="padding-bottom" title="Bottom Margin" data-param="padding-bottom" spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="tag-changer">\n\t\t\t\t\t\t\t&lt;<span>p</span>&gt; tag\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="edit-scroll"></div>\n\t\t\t</div>\n\n\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t\t<div class="paragraph-style" data-id="paragraph-none">\n\t\t\t\t\t\t\t<div class="style-caption paragraph-none">None</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="styles-wrapper"></div>\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\n\t\t<div class="add-block">\n\t\t\t<div class="add" title="Create Style from Selection"></div>\n\t\t\t<div class="save">Save</div>\n\t\t\t<div class="cancel" title="Cancel Changes"></div>\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="fontselector_container"></div>\n\n\t\t<div class="fontstyle_container">\n\t\t\t<div class="font-style-wrapper">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="style-menu transition-enable">\n\t\t\t<div class="top-block">\n\t\t\t\t<div class="redefine-button">Redefine Style</div>\n\t\t\t\t<div class="text-block">from selection</div>\n\t\t\t\t<div class="revert-block"><div class="revert-button">Revert</div> to original</div>\n\t\t\t</div>\n\n\t\t\t<div class="separator top-separator"></div>\n\t\t\t<div class="edit-button">Edit Style</div>\n\t\t\t<div class="separator"></div>\n\t\t\t<div class="duplicate-button">Duplicate</div>\n\t\t\t<div class="separator separator-delete"></div>\n\t\t\t<div class="delete-button">Delete</div>\n\n\t        <div class="corner-wrapper">\n\t            <div class="corner"></div>\n\t        </div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-text_styles-style":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="\n\t";var currentTag="undefined"!=typeof tag?tag:"p";__p+='\n\t<div class="paragraph-style" data-id="'+(null==(__t=_name)?"":_.escape(__t))+'" data-tag="'+(null==(__t=currentTag)?"":_.escape(__t))+'">\n\t\t<div class="style-caption '+(null==(__t=_name)?"":_.escape(__t))+'">'+(null==(__t=_caption)?"":_.escape(__t))+'</div>\n\t\t<div class="tag-changer">'+(null==(__t=currentTag)?"":_.escape(__t))+'</div>\n\t\t<div class="menu-button"></div>\n\t</div>\n'}return __p}}},rDYU:function(module,exports){module.exports={"template-constructor-block-slideshow":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<input class="uploadInput" type="file" name="upload" multiple="multiple" data-url="/api/upload/" />\n\t<div class="slideshow-overlay jsSlideshowOverlay"></div>\n\n\t<div class="drop-text"></div>\n\n';return __p}}},rH4x:function(t,e,i){},rVpV:function(t,e,i){"use strict";var n=i("rFsW"),o=i("roQd"),a=i("OTSC"),s=i("v92f"),r={GLOBAL_UNIQUE_KEYS:["hidden","z"],GLOBAL_UNIQUE_KEY_PREFIX:"_",FADE_DURATION:200,getUniqueValue:function(t,e,i){var o=e[this.GLOBAL_UNIQUE_KEY_PREFIX+t]||[],a=n.a.findWhere(o,{pid:i});return void 0===(a=a||n.a.findWhere(o,{pid:"default"})||{}).value?e[t]:a.value},resetGlobalData:function(t,e){var i=this;return n.a.each(s.b.viewport_listall,(function(o){n.a.each(i.GLOBAL_UNIQUE_KEYS,(function(a){o==="viewport_"+e?t.set(i.GLOBAL_UNIQUE_KEY_PREFIX+a,[]):n.a.isEmpty(t[o])||(t[o][i.GLOBAL_UNIQUE_KEY_PREFIX+a]=[])}))})),{}},isGlobalKey:function(t){return-1!==this.GLOBAL_UNIQUE_KEYS.indexOf(t)},getGlobalPrefixedKey:function(t){return this.isGlobalKey(t)?this.GLOBAL_UNIQUE_KEY_PREFIX+t:null},fillUniqueAttributeSets:function(t,e,i){var o={};return e.is_global?(Object(n.a)(this.GLOBAL_UNIQUE_KEYS).each(function(a){if(n.a.has(t,a)&&void 0!==t[a]){var s=e[this.GLOBAL_UNIQUE_KEY_PREFIX+a]||[],r=n.a.findWhere(s,{pid:i}),l=n.a.findWhere(s,{pid:"default"});r?r.value=t[a]:s.push({pid:i,value:t[a]}),l||s.push({pid:"default",value:void 0===e[a]?null:e[a]}),o[this.GLOBAL_UNIQUE_KEY_PREFIX+a]=s}}.bind(this)),o):t},ensurePageDefRecord:function(t){Object(n.a)(this.GLOBAL_UNIQUE_KEYS).each(function(e){var i=t[this.GLOBAL_UNIQUE_KEY_PREFIX+e]||[];n.a.findWhere(i,{pid:"default"})||i.push({pid:"default",value:void 0===t[e]?null:t[e]}),t[this.GLOBAL_UNIQUE_KEY_PREFIX+e]=i}.bind(this))},fillUniqueValues:function(t,e,i){i=i||{},n.a.each(t,(function(o,a){if(n.a.contains(this.GLOBAL_UNIQUE_KEYS,a)&&(!i.props||n.a.contains(i.props,a))){var s=this.getUniqueValue(a,t,e);t[a]=void 0===s?o:s}}),this)},isHidden:function(t,e,i){return this.getUniqueValue("hidden",t,e)||!i&&o.a.hasExpired(t)},show:function(t,e){e=Boolean(e),t.$el.toggleClass("no-transition",e),t.$el.addClass("above-all-fade"),t.$el.hasClass("fade-in")&&!e||(t.cancelHide&&t.cancelHide(),t.show(),n.a.delay((function(){t.$el.addClass("fade-in")}),50))},hide:function(t,e){return e=Boolean(e),t.$el.addClass("above-all-fade"),new window.Promise((function(i){t.$el.hasClass("fade-in")||e?(t.$el.toggleClass("no-transition",e),t.$el.removeClass("fade-in"),e?(t.hide(),i()):t.cancelHide=a.default.waitForTransitionEnd(t.$el,r.FADE_DURATION,"opacity",(function(){t.hide(),i()}))):i()}))}};e.a=r},rgKy:function(module,exports){module.exports={"template-constructor-helpers-upload-input":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<input class="rm-upload-input"\n\t       type="file"\n\t       name="upload"\n\t       data-url="/api/upload/" />\n\n';return __p}}},roQd:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("gobI"),l=i("OTSC"),c=i("QNiq");function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function u(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var g={LOOP_TYPES:{swing:"swing",repeat:"repeat"},EVENT_TYPES:["load","scroll","hover","click"],POINTER_EVENTS:["click","hover"],EXTERNAL_TRIGGER_BLOCK_EXCLUDE:["facebook","twitter","form","gmaps","slideshow","audio","video"],ANIMATION_BLOCK_EXCLUDE:["facebook","twitter"],POINTER_EVENTS_BLOCK_EXCLUDE:["form","gmaps","slideshow","audio","video"],DEFAULT_LOOP_TYPE:"swing",ACTIVE_TRIGGER_CLASS:"active-trigger",ACTIVE_TRIGGER_REMOVE_CLASS:"active-trigger-remove",ACTIVE_TRIGGER_HIGHLIGHT_CLASS:"active-trigger-highlight",ANIMATIONS_PLAYED_STORAGE_KEY:"animationsPlayed",DEG_TO_RAD:Math.PI/180,ANIMATION_PROPERTIES:function(){var t=!1,e="animation",i="AnimationIteration",n="AnimationEnd",o="animation-timing-function",a="@keyframes",s="transform",r="transform",l="Webkit Moz O ms Khtml".split(" "),c="webkit moz o MS кhtml".split(" "),d=document.createElement("div");if(null!=d.style.animationName)t=!0,i=i.toLowerCase(),n=n.toLowerCase();else for(var h=0;h<l.length;h++)if(null!=d.style[l[h]+"AnimationName"]){e=l[h]+"Animation",i=c[h]+i,n=c[h]+n,o="-"+l[h].toLowerCase()+"-"+o,a="@-"+l[h].toLowerCase()+"-keyframes",t=!0;break}if(null==d.style.transform)for(h=0;h<l.length;h++)if(null!=d.style[l[h]+"Transform"]){s=l[h]+"Transform",r="-"+l[h].toLowerCase()+"-transform";break}return d=null,{animationSupported:t,animationJS:e,animationIterationJS:i,animationEndJS:n,animationTimingFunctionCSS:o,keyframeCSS:a,transformJS:s,transformCSS:r}}(),createAnimationTimeline:function(t){return new b(t)},getNormalizedAnimation:function(t,e,i,n,o){var a={dx:0,dy:0,from_opacity:100,opacity:100,from_rotate:0,rotate:0,from_scale:100,scale:100},l={use_move:["dx","dy"],use_opacity:["from_opacity","opacity"],use_rotate:["from_rotate","rotate"],use_scale:["from_scale","scale"]},c=s.a.extend({},t),d=c.loop;c.loop=!1,c.steps=[];for(var h={dx:0,dy:0},u=0;u<t.steps.length;u++){var p=s.a.extend({},t.steps[u]);s.a.each(l,s.a.bind((function(t,e){p[e]?(a[t[0]]=p[t[0]],a[t[1]]=p[t[1]]):(p[t[0]]=a[t[0]],p[t[1]]=a[t[1]])}),this)),i&&(p.dx=0,p.rotate=0,p.from_rotate=0),n&&(p.dy=0,p.rotate=0,p.from_rotate=0),"scroll"!=c.type||e||0!=u||(p.delay_px=0),1!=o&&e&&(p.dx*=o,p.dy*=o),"scroll"==c.type?(p.calcedDuration=g(p,h),p.calcedDelay=p.delay_px?p.delay_px*r.a.normalize(o):0):(p.calcedDuration=p.duration||.001,p.calcedDelay=p.delay||0),p.acceleration=p.acceleration||"none","scroll"===c.type?p.loop=!1:d&&0===u&&(p.loop=d),c.steps.push(p),h=p}return c.trigger=t.trigger&&!s.a.isArray(t.trigger)?[t.trigger]:s.a.clone(t.trigger)||[],c;function g(t,e){var i,n=t.dx-e.dx,o=t.dy-e.dy;return i=0!=n||0!=o?Math.pow(n*n+o*o,.5)/t.speed:300/t.speed,Math.ceil(i)}},normalizeLoopValue:function(t){return!!t&&(this.LOOP_TYPES[t]||this.DEFAULT_LOOP_TYPE)},isExternalTriggerAllowed:function(t){return this.isPointerEvent(t)},normalizeAnimationTriggers:function(t){return t&&!s.a.isArray(t)?[t]:s.a.clone(t)||[]},normalizeAnimations:function(t){return t&&!s.a.isArray(t)?[t]:t||[]},isEmpty:function(t){return!(t&&t.type&&"none"!==t.type&&t.steps&&t.steps.length)},isMoveOnly:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.steps&&t.steps.length&&t.steps.every((function(t){return t.use_move&&!t.use_scale&&!t.use_rotate}))},isNonMove:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.steps&&t.steps.length&&t.steps.every((function(t){return!t.use_move}))},getUuidHash:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.map((function(t){return t.UUID})).filter((function(t){return t})).sort().join(",")},isPointerEvent:function(t){return-1!==this.POINTER_EVENTS.indexOf(t)},canHaveAnimation:function(t){var e=t.attributes||t.model&&t.model.attributes||{};return e.type&&-1===this.ANIMATION_BLOCK_EXCLUDE.indexOf(e.type)},arePointerEventsAllowed:function(t){var e=t.attributes||t.model&&t.model.attributes||{};return e.type&&-1===this.POINTER_EVENTS_BLOCK_EXCLUDE.indexOf(e.type)},getBlocksContainingTriggers:function(t){var e=s.a.map(t,(function(t){return t.id||t._id}));return s.a.reduce(t,function(t,i){var n=this.normalizeAnimations(i.model?i.model.get("animation"):i.animation),o=[].concat(u(n.reduce((function(t,e){return e.trigger?[].concat(u(t),u(g.normalizeAnimationTriggers(e&&e.trigger))):t}),[])),u(i.triggers||i.model&&i.model.get("triggers")||[]));return o.length&&s.a.intersection(e,o).length&&t.push(i.id?i.id:i._id),t}.bind(this),[])},restoreTriggers:function(t,e,i){var n=[];return s.a.each(t,function(t){var o=this,a=e[t],r=s.a.find(i,{id:a});if(r&&r.getAllTriggers().length){n.push(r),r.model.getAnimations().forEach((function(t){var i=o.normalizeAnimationTriggers(t&&t.trigger);t.trigger=i.reduce((function(t,i){return e[i]?[].concat(u(t),[e[i]]):t}),[])}));var l=r.model.get("triggers");l&&r.model.set("triggers",l.reduce((function(t,i){return e[i]?[].concat(u(t),[e[i]]):t}),[]))}}.bind(this)),n},isScaleUp:function(t){return Boolean(s.a.find(t&&t.steps,(function(t,e){return t.use_scale&&(0===e&&t.from_scale>100||t.scale>100)})))},maxScaleAnimation:function(t){return t&&t.steps&&t.steps.length?t.steps.reduce((function(t,e){return Math.max(t,e.from_scale||0,e.scale||0)}),0):0},canBeAccelerated:function(t){return!c.a.isDesktop||!this.isScaleUp(t)},getPermanentAnimationId:function(t,e){return t.fixed_position||t.is_full_width||t.is_full_height||t.sticked?t._id:e},getAnimationsPlayed:function(){if(s.a.isUndefined(this._animationsPlayed))try{var t=Modernizr.localstorage?window.localStorage.getItem(this.ANIMATIONS_PLAYED_STORAGE_KEY):l.default.getCookie(this.ANIMATIONS_PLAYED_STORAGE_KEY),e=t&&JSON.parse(t);this._animationsPlayed=s.a.isArray(e)?e:[]}catch(t){this._animationsPlayed=[]}return this._animationsPlayed},persistHasPlayed:function(t){if(!this.hasPlayed(t))try{var e=JSON.stringify([].concat(this.getAnimationsPlayed(),t));Modernizr.localstorage?window.localStorage.setItem(this.ANIMATIONS_PLAYED_STORAGE_KEY,e):l.default.createCookie(this.ANIMATIONS_PLAYED_STORAGE_KEY,e),delete this._animationsPlayed}catch(t){}},hasPlayed:function(t){return t&&-1!==this.getAnimationsPlayed().indexOf(t)},hasExpired:function(t){var e=this,i=this.normalizeAnimations(t.animation);return Boolean(i.length)&&i.every((function(i){var n=e.getPermanentAnimationId(t,i.UUID);return i.playOnce&&e.hasPlayed(n)}))}},m=0,f=g.ANIMATION_PROPERTIES,v=function(){function t(e){var i=e.id,n=e.steps,o=e.initialStep;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),h(this,"name",void 0),h(this,"duration",void 0),h(this,"iterationCount",void 0),h(this,"fillMode","none"),h(this,"css",void 0),h(this,"hasRotation",!1),h(this,"force3d",void 0),h(this,"loop",void 0),this.name="animation_".concat(i);var a=n.find((function(t){return t.loop}));this.loop=!!a&&g.normalizeLoopValue(a.loop),this.iterationCount=this.loop?"infinite":1,this.hasRotation=n.find((function(t,e){return Boolean(t.use_rotate&&(0===e&&0!==t.from_rotate||0!==t.rotate))})),this.duration=n.reduce((function(t,e){return t+e.calcedDelay+e.calcedDuration}),0),this.css=t.getKeyframes(i,n,this.duration,this.hasRotation,this.force3d,o)}var e,i,n;return e=t,n=[{key:"getKeyframes",value:function(t,e,i,n,o,a){for(var s=0,r=[[0]],l=e.length,c=0;c<l;c++){var d=e[c].calcedDelay/i,h=e[c].calcedDuration/i;d>=1e-4?r[r.length-1].push(s+d):d=0,s+=d+h,c==l-1&&(s=1),r.push([s])}var u="".concat(f.keyframeCSS," animation_").concat(t," {\n"),p={none:"linear","ease-in":"ease-in","ease-out":"ease-out","ease-both":"ease-in-out"};for(u+=this.getKeyframe(r[0],{dx:a?a.dx:0,dy:a?a.dy:0,opacity:a?a.opacity:e[0].from_opacity,rotate:a?a.rotate:e[0].from_rotate,scale:a?a.scale:e[0].from_scale},p[e[0].acceleration],n,o),c=0;c<l;c++)u+=this.getKeyframe(r[c+1],e[c],e[c+1]?p[e[c+1].acceleration]:void 0,n,o);return u+="}\n"}},{key:"getKeyframe",value:function(t,e,i,n,o){var a="\t";return a+=s.a.map(t,(function(t){return 100*t+"%"})).join(", ")+" {",a+=f.transformCSS+": "+this.getTransformString({x:e.dx,y:e.dy,angle:e.rotate,scale:e.scale/100,hasRotation:n,isKeyframe:!0,force3d:o})+"; ",a+="opacity: "+(0===e.opacity?0:e.opacity/100)+"; ",i&&(a+=f.animationTimingFunctionCSS+": "+i),a+="}\n"}},{key:"getTransformString",value:function(t){var e,i=t.x,n=t.y,o=t.angle,a=t.scale,s=t.hasRotation,l=t.isKeyframe,c=t.force3d;if(a<.001&&(a=.001),s&&l)e=c?"translate3d(".concat(i,"px, ").concat(n,"px, 0) rotate(").concat(o,"deg) scale(").concat(a,")"):"translate(".concat(i,"px, ").concat(n,"px) rotate(").concat(o,"deg) scale(").concat(a,")");else{var d=a,h=0;o&&(o*=g.DEG_TO_RAD,d=Math.cos(o)*a,h=Math.sin(o)*a),d=Math.abs(d)<1e-6?0:d,h=Math.abs(h)<1e-6?0:h,Modernizr.edge&&(n*=r.a.getMag().getScale(r.a.getViewport()));var u=d+","+h,p=-h+","+d,m=i+","+n;e=c?"matrix3d(".concat(u,",0,0,").concat(p,",0,0,0,0,1,0,").concat(m,",0,1)"):"matrix(".concat(u).concat(",").concat(p).concat(",").concat(m,")")}return e}}],(i=[{key:"getDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t?this.loop===g.LOOP_TYPES.repeat?"reverse":"alternate-reverse":this.loop===g.LOOP_TYPES.repeat?"normal":"alternate"}}])&&d(e.prototype,i),n&&d(e,n),t}(),b=a.a.View.extend({initialize:function(t){s.a.bindAll(this),s.a.extend(this,t),f.animationSupported&&(this.active=!1,this.reversed=!1,this.$el.toggleClass("force3d",!!this.force3d),"scroll"!==this.type?(this.generateKeyframeAnimation(),this.duration=this.sequences.reduce((function(t,e){return t+e.duration}),0)):(this.duration=this.steps.reduce((function(t,e){return t+e.calcedDelay+e.calcedDuration}),0),this.generateFrameByFrameAnimation()))},generateKeyframeAnimation:function(){var t=this;m+=1,this.id=m,this.sequences=this.steps.reduce((function(e,i,n){var o=t.steps.slice(n+1),a=o.findIndex((function(t){return t.loop}));return 0===n||i.loop?[].concat(u(e),[new v({id:"".concat(t.id,"_").concat(e.length+1),steps:[i].concat(u(o.slice(0,-1!==a?a:o.length))),force3d:t.force3d,initialStep:e.length?t.steps[n-1]:void 0})]):e}),[]),this.loop=this.sequences.map((function(t){return t.loop})).find((function(t){return t})),this.isFullLoop=1===this.sequences.length&&Boolean(this.sequences[0].loop),this.keyframesStyle=document.createElement("style"),this.keyframesStyle.innerHTML=this.sequences.reduce((function(t,e){return t+e.css}),""),this.$el.append(this.keyframesStyle),this.$el.on(f.animationIterationJS,(function(e){e.stopPropagation();var i=t.sequences.find((function(t){return t.name===e.originalEvent.animationName}));i&&t.onAnimationIteration(e,i)})),this.$el.on(f.animationEndJS,(function(e){e.stopPropagation();var i=t.sequences.find((function(t){return t.name===e.originalEvent.animationName})),n=t.reversed?u(t.sequences).reverse():t.sequences;i&&i.name===n[n.length-1].name&&t.onAnimationEnd(e,i)})),this.applyStepState(this.screenshotMode&&"load"===this.type?this.steps.length-1:"initial",!0)},generateFrameByFrameAnimation:function(){var t=0,e={dx:0,dy:0,opacity:this.steps[0].from_opacity,rotate:this.steps[0].from_rotate,scale:this.steps[0].from_scale};this.frames=[],this.frames.push({ind:0,isDelay:!1,params:e});for(var i=0;i<this.steps.length;i++){var n=this.steps[i];n.calcedDelay&&(this.frames.push({ind:t+1,isDelay:!0,params:e}),t+=n.calcedDelay),e={dx:n.dx,dy:n.dy,opacity:n.opacity,rotate:n.rotate,scale:n.scale,acceleration:n.acceleration},this.frames.push({ind:t+1,isDelay:!1,params:e}),t+=n.calcedDuration}this.seek(0)},applyStepState:function(t,e){var i;if(this.$el.removeClass("invisible"),"initial"===t)this.$el[0].style[f.transformJS]=v.getTransformString({x:0,y:0,angle:this.steps[0].from_rotate,scale:this.steps[0].from_scale/100,hasRotation:this.hasRotation,isKeyframe:e,force3d:this.force3d}),i=this.steps[0].from_opacity,this.$el[0].style.opacity=0===i?0:i/100;else{var n=this.steps[t];this.$el[0].style[f.transformJS]=v.getTransformString({x:n.dx,y:n.dy,angle:n.rotate,scale:n.scale/100,hasRotation:this.hasRotation,isKeyframe:e,force3d:this.force3d}),i=n.opacity,this.$el[0].style.opacity=0===i?0:i/100}var o="hover"===this.type&&this.animationTrigger.length>0&&!this.selfTriggered,a="hover"!==this.type&&("initial"!==t||this.animationTrigger.length>0);0===i&&(o||a)&&this.$el.addClass("invisible")},play:function(){if(!this.screenshotMode&&f.animationSupported){var t=f.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight(),window.requestAnimationFrame(function(){var e=this;this.$el[0].style[t+"Name"]=this.sequences.map((function(t){return t.name})).join(", "),this.$el[0].style[t+"Duration"]=this.sequences.map((function(t){return t.duration+"s"})).join(", "),this.$el[0].style[t+"Delay"]=this.sequences.reduce((function(t,i,n){var o=e.sequences[n-1];return[].concat(u(t),[o?"".concat(o.duration,"s"):"0s"])}),[]).join(", "),this.$el[0].style[t+"IterationCount"]=this.sequences.map((function(t){return t.iterationCount})).join(", "),this.$el[0].style[t+"Direction"]=this.sequences.map((function(t){return t.getDirection()})).join(", "),this.$el[0].style[t+"FillMode"]=this.sequences.map((function(t){return t.fillMode})).join(", "),this.$el[0].style[t+"PlayState"]=""}.bind(this)),this.active=!0,this.reversed=!1}},reverse:function(){if(!this.screenshotMode&&f.animationSupported){var t=f.animationJS;this.stop(),this.$el.removeClass("invisible"),this.$el.outerHeight();var e=u(this.sequences).reverse().filter((function(t){return t.loop!==g.LOOP_TYPES.swing}));this.$el[0].style[t+"Name"]=e.map((function(t){return t.name})).join(", "),this.$el[0].style[t+"Duration"]=e.map((function(t){return t.duration+"s"})).join(", "),this.$el[0].style[t+"Delay"]=e.reduce((function(t,i,n){var o=e[n-1];return[].concat(u(t),[o?"".concat(o.duration,"s"):"0s"])}),[]).join(", "),this.$el[0].style[t+"IterationCount"]=e.map((function(){return 1})).join(", "),this.$el[0].style[t+"Direction"]=e.map((function(t){return t.getDirection(!0)})).join(", "),this.$el[0].style[t+"FillMode"]=e.map((function(t){return t.fillMode})).join(", "),this.$el[0].style[t+"PlayState"]="",this.active=!0,this.reversed=!0}},stop:function(){this.$el.removeClass("invisible"),this.$el[0].style[f.animationJS]="",this.active=!1,this.reversed=!1},onAnimationEnd:function(){this.reversed=!this.reversed,this.active=!1,this.$el[0].style[f.animationJS]="",this.applyStepState(this.reversed?this.steps.length-1:"initial",!0),this.trigger("full-cycle-end")},onAnimationIteration:function(t,e){this.loop===g.LOOP_TYPES.swing?Math.round(t.originalEvent.elapsedTime/e.duration)%2?this.reversed=!0:(this.reversed=!1,this.trigger("full-cycle-end")):this.trigger("full-cycle-end")},resume:function(){this.screenshotMode||f.animationSupported&&(c.a.isDesktop?this.$el[0].style[f.animationJS+"PlayState"]="running":this.play(),this.active=!0)},pause:function(){f.animationSupported&&(c.a.isDesktop?this.$el[0].style[f.animationJS+"PlayState"]="paused":this.stop(),this.active=!1)},seek:function(t){if(f.animationSupported){t=Math.max(Math.min(t,this.duration),0);var e,i,n,o,a=this.frames.length;for(e=0;e<a&&!(this.frames[e].ind>t);e++);e--,this.frames[e].isDelay?i=s(this.frames[e].params,this.frames[e].params,0,1):(n=e?this.frames[e].ind-1:0,o=e==a-1?this.duration:this.frames[e+1].ind-1,i=s(this.frames[e?e-1:0].params,this.frames[e].params,t-n,o-n+1)),this.$el[0].style[f.transformJS]=v.getTransformString({x:i.dx,y:i.dy,angle:i.rotate,scale:i.scale/100,hasRotation:this.hasRotation,isKeyframe:!1,force3d:this.force3d}),this.$el[0].style.opacity=0==i.opacity?0:i.opacity/100,this.$el.toggleClass("invisible",0==i.opacity)}function s(t,e,i,n){if(0==i)return t;if(i==n-1)return e;var o=i/(n-1);return{dx:t.dx==e.dx?t.dx:r(t.dx,e.dx,o,e.acceleration),dy:t.dy==e.dy?t.dy:r(t.dy,e.dy,o,e.acceleration),opacity:t.opacity==e.opacity?t.opacity:r(t.opacity,e.opacity,o,e.acceleration),rotate:t.rotate==e.rotate?t.rotate:r(t.rotate,e.rotate,o,e.acceleration),scale:t.scale==e.scale?t.scale:r(t.scale,e.scale,o,e.acceleration)}}function r(t,e,i,n){return t+(e-t)*(n&&"none"!=n?"ease-in"==n?i*i:"ease-out"==n?i*(2-i):i<.5?i*i*2:2*i*(2-i)-1:i)}},destroy:function(){this.$el.off(f.animationIterationJS,this.onAnimationIteration),this.$el.off(f.animationEndJS,this.onAnimationEnd),this.$el[0].style[f.animationJS]="",this.$el[0].style[f.transformJS]="",this.$el[0].style.opacity="",this.$el.removeClass("force3d"),this.keyframesStyle&&Object(n.a)(this.keyframesStyle).remove(),this.reversed=!1,this.active=!1}});e.a=g},rwzP:function(t,e,i){},s0L4:function(module,exports){module.exports={"template-constructor-control-hotspot-tip-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Tip Settings" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper default-state">\n\n\t\t\t\t<div class="params-wrapper clearfix">\n\n\t\t\t\t\t<div class="edit-item" data-field="tip_pos">\n\t\t\t\t\t\t<div class="caption">Position</div>\n\t\t\t\t\t\t<div class="positions">\n\t\t\t\t\t\t\t<div class="top position" data-position="top">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="right position" data-position="right">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bottom position" data-position="bottom">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="left position" data-position="left">\n\t\t\t\t\t\t\t\t<div class="fill"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="tip_background-color" data-field-dop="tip_background-color-opacity">\n\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator" data-field="tip_border-radius">\n\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t</div>\n\n\n\t\t\t\t\t<div class="edit-item separator clearfix" data-field="tip_box-shadow">\n\t\t\t\t\t\t<div class="caption">Shadow</div>\n\t\t\t\t\t\t<div class="switcher"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t</div>\n\n';return __p}}},s1Hx:function(module,exports){module.exports={"template-constructor-control-text_color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},secl:function(module,exports){module.exports={"template-viewer-page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="page hidden">\n\t\t<div class="page-fixed-bg-container polyfill-sticky"></div>\n\t\t<div class="fixed-position-container-top polyfill-sticky"></div>\n\t\t<div class="fixed-position-container polyfill-sticky"></div>\n\t\t<div class="content-scroll-wrapper '+(null==(__t=isStickyVerticalViewer?"":"has-vertical-scroll")?"":__t)+'">\n\t\t\t<div class="content-bounds">\n\t\t\t\t<div class="page-content-container" tabindex="-1"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},skB9:function(t,e,i){},sn3M:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(t){var e,i,n,o=t.className,a=t.selector,s=t.label,r=t.styles,l=String(o||a);return e={},i=l,n={label:s,style:"".concat(a||"."+o," { ").concat(r," }")},i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}},sviH:function(t,e,i){"use strict";var n=i("q1z7"),o=i.n(n),a=i("q1tI"),s=i.n(a),r=i("xi34"),l=i("q7tt"),c=i("Kf/z"),d=i("8AXF"),h=i("zjto"),u=i("8Tds"),p=i("onY4"),g=i("v92f"),m=i("9Juw"),f=i("DwEc"),v=i("OTSC"),b=i("q5gH");function _(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?_(Object(i),!0).forEach((function(e){w(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):_(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function k(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var S,x,C=l.a.extend({name:"Text",thumb:"text",icon_color:"#fff",sort_index:1,controls:["text_edit","common_animation","common_rotation","common_position","common_layer","common_lock"],edit_controls:["text_typography_new","text_align_new","text_advanced_typography","text_insert","text_link_new","text_color_new","text_columns_new"],viewport_fields:g.b.viewport_fields.text,restrictions:function(){return Object(c.a)("constructor.textv3")},initialize:function(t,e){var i=this;if(t.get("version")!==h.version)throw new Error("Old text widget model is here.");this.initBlock(t,e),this.page=e.page,this.propsModel=new o.a.Model({viewport:this.page.getCurrentViewport(),isEditMode:!1,fontStyles:[],isResizing:!1,workspace:e,leaveEditMode:function(){i.leaveEditMode()}}),this.page.on("change:viewport",this.onViewportChange),this.onFontsChanged(),window.RM.constructorRouter.on("font-added",this.onFontsChanged)},render:(S=regeneratorRuntime.mark((function t(){var e,n,o,a,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.create(),this.$el.addClass("text-v3"),e=i("8AXF"),n=e.renderReact,t.next=5,Promise.resolve().then(i.bind(null,"zjto"));case 5:o=t.sent,a=o.TextConstructor,n({component:function(){return s.a.createElement(d.CreateContextProvider,{context:f.a,model:r.propsModel},s.a.createElement(a,null))},domElement:this.$content[0],model:this.model}),this.reactContainer=this.$content.find("div").first(),this.rendered=!0,this.triggerReady();case 12:case"end":return t.stop()}}),t,this)})),x=function(){var t=this,e=arguments;return new Promise((function(i,n){var o=S.apply(t,e);function a(t){k(o,i,n,a,s,"next",t)}function s(t){k(o,i,n,a,s,"throw",t)}a(void 0)}))},function(){return x.apply(this,arguments)}),destroy:function(){return this.leaveEditMode(),this.page.off("change:viewport",this.onViewportChange),window.RM.constructorRouter.on("font-added",this.onFontsChanged),l.a.prototype.destroy.apply(this,arguments)},deselect:function(){l.a.prototype.deselect.apply(this,arguments),this.isEditMode&&this.leaveEditMode()},onDblClick:function(){this.selected&&(this.model.get("pack_id")&&1!==this.workspace.getSelectedBlocks().length?l.a.prototype.onDblClick.apply(this,arguments):this.enterEditMode())},enterEditMode:function(){this.isEditMode=!0,this.frame&&(this.frame.setEditorState(),this.frame.removeRotationState(),this.frame.resetRotation()),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.edit_controls,this);var t=r.a.event.special.drag;t.toggle.call(Object(r.a)("#main")[0],!1),t.toggle.call(this.$el[0],!1),p.a.setEmptyHandlers(),window.RM.common.disableShortcuts["text-v3"]=!0,this.workspace.trigger("w-text-entered-edit-mode"),this.propsModel.set({isEditMode:!0})},leaveEditMode:function(){this.isEditMode=!1,this.workspace.trigger("w-text-before-leave-edit-mode"),this.frame&&(this.frame.removeEditorState(),this.frame.restoreRotation()),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.controls,this);var t=r.a.event.special.drag;t.toggle.call(Object(r.a)("#main")[0],!0),t.toggle.call(this.$el[0],!0),p.a.removeCustomHandlers(),delete window.RM.common.disableShortcuts["text-v3"],this.workspace.trigger("w-text-leaved-edit-mode"),this.propsModel.set({isEditMode:!1}),v.default.getFocusBack()},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1===t.length&&t[0]===this;this.isEditMode&&!e&&this.leaveEditMode()}},onViewportChange:function(){var t=this.page.getCurrentViewport();this.propsModel.set({viewport:t})},isAutosizeEnabled:function(){var t=this.model.get("overflow"),e=this.model.get("columns");return!(e&&e.count>1)&&t===u.b.Visible},fitContentToBox:function(){},redraw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.checkNeedRedraw(t,e)&&(l.a.prototype.redraw.apply(this,arguments),e.viewportChange&&this.propsModel.set("newStyles",t.get("styles")))},onFontsChanged:function(){var t=Array.from(document.querySelectorAll("link.fonts, style.fonts")),e=function(t){if(Modernizr.safari){var e=new URL(t);return e.searchParams.append("edit_mode","true"),e.toString()}return t},i=t.map((function(t){var i=t.tagName.toLowerCase();return"style"===i?{tag:i,style:t.innerHTML}:{tag:i,href:e(t.getAttribute("href")),type:t.getAttribute("type")}}));this.propsModel.set("fontStyles",i)},onResizeStart:function(){this.propsModel.set("isResizing",!0)},css:function(t){this.propsModel.get("isResizing")&&"number"==typeof t.width&&"number"==typeof t.height&&this.propsModel.set("resizingDimensions",{width:t.width,height:t.height}),l.a.prototype.css.apply(this,arguments)},onResizeEnd:function(){this.propsModel.set("isResizing",!1),this.propsModel.set("resizingDimensions",void 0)},canChangeDimension:function(t){if("height"===t){var e=this.isAutosizeEnabled();if(e)return!1}return b.a.prototype.canChangeDimension.bind(this.frame,arguments)}},{getViewportDefaults:function(t,e,i){return y(y({},l.a.getViewportDefaults(t,e,i)),{},{styles:t.get("styles"),blocks:t.get("blocks"),entityMap:t.get("entityMap")})},defaults:{version:h.version,verticalAlign:u.f.top,textDirection:u.c.LTR,overflow:u.b.Visible,blocks:function(){var t=Object(m.c)().blocks;return t},styles:[],entityMap:{}}}),O=i("rFsW"),P=i("DqjY"),j=i("D12m"),$=i("5DNN"),T=i.n($),I=i("7jD/"),E=i.n(I),M=i("RX7I"),R=i("gobI"),A=i("Fi5S"),D=["The follies of others are obvious, but our own hide from us; we love to parse others’ missteps but we cover up our own, as the cheat conceals the false die. It is in the nature of men to lay blame: we see others’ mistakes while our own passions swell, carrying us ever farther from improvement. — Buddhist wisdom","No one can long stand on tiptoe. He who thrusts himself forward is not a source of light. No glory comes to the self-satisfied, no honor to the boastful. The proud will not rise high. In the court of good sense, such people are like table discards, repellent to all. The sensible person does not rely on self. — Lao-Tzu","Simplicity in life, language and habits strengthens a nation, but a life of luxury, fancy language and effeminate habit leads to weakness and death. — John Ruskin","Truth is not a matter of talking but comes only through labor and observation. And when you have one truth in hand, two others, like the first leaves of a dicotyledonous plant, will probably appear. — John Ruskin","All things have a beginning and an end. So it is with mankind: there is a beginning and end to all  human affairs. He who understands what is a beginning and what is an end is closer to the truth. — Confucius","Most people are dismayed if deprived of their pleasures. The right course belongs to him who relishes even the passing away of the reason for his joy and is not bitter. — Pascal","When we are clear about things, we have knowledge; with knowledge, we seek the path of truth; when the search is rewarded, the heart becomes good; with the heart made good, the moral view of things that leads to virtue is attained. — Confucius","Wisdom has three faces: when seen from afar, it is grand and severe; on closer approach, it is tender and welcoming; when we are close enough to hear it, the words of  wisdom are severe and demanding. — Chinese wisdom","The sun constantly floods the world with its light, but its light is not exhausted; so your mind should send its light in all directions and not be exhausted. It should flow everywhere, without diminishment, and when it encounters an obstacle, it should react, not with annoyance or anger but should serenely clarify all that yearns to accept it, without any lessening or weariness, bringing light to all that is turned to it, leaving in shadow only that which turns its face away. — Marcus Aurelius","As torches and fireworks pale to invisibility in the sun, so the mind, even the mind of genius, and beauty pale and are eclipsed by the heart’s goodness. — Schopenhauer","Music and sweet treats bring the wanderer to a stop, but wisdom has neither flavor nor smell. When looked for, it is invisible; when listened for, it is inaudible, yet its goodness is inexhaustible. The most powerful thing in the world cannot be seen, heard or touched. — Lao-Tzu","The best ideas are usually those that come without effort, out of the blue. The great intellectual creations come easily. Only a great person can create something great, and such a one works without strain. — John Ruskin","He who talks much rarely puts his words into action. But the wise person fears that his words may not be translated into action. The wise do not utter empty words, lest their actions be inconsistent with their words. — Chinese wisdom","Fear ignorance, but fear false knowledge even more. Turn your eyes from the deceptive world and do not trust your feelings, for they lie; rather look inward to the impersonal, eternal self. Truly, ignorance is like a sealed and airless chamber; in it, the soul sits like a caged bird, neither singing nor spreading its wings. But ignorance is better than any school of thought that is not guided by the wisdom of the soul. — Buddhist wisdom","Some seek their good or happiness in power; others in science, and others in the pleasures of the flesh. But those who come truly close to the good understand that it cannot consist in what can only be mastered by a few. They understand that the true good of humankind is that which can be achieved by all people, without division and without envy; its nature  is such that none can lose it if they do not so choose. — Pascal","The wise person asks only of himself; the unwise man demands everything from others. — Chinese wisdom","To know much and not to put one’s self forward as knowing is the height of morality. To know little and put one’s self forward as knowledgeable is an illness. Only by understanding the disease can one expunge it. — Lao-Tzu","Speak only of that which is as clear to you as the morning, or be silent. — Talmud","Conquer ferocity with love, evil with good, miserliness with generosity, the liar with truth. — Buddhist wisdom","People seek satisfaction, throwing themselves from one thing to another because they feel the emptiness of their lives but do not yet realize the emptiness of the new delight that attracts them. — Pascal","The skilled warrior does not rage. The skilled fighter is not angry. He who is skilled in the use of people is not provocative. This is the virtue of non-resistance. This is being in agreement with Heaven. — Lao-Tzu","The first and principal characteristic of a good and wise person is his consciousness that he knows very little, that many people know more and he seeks always to learn, to study, and not to teach. Those who wish to teach or direct neither teach nor lead well. — John Ruskin","The virtuous person seeks to follow the direct path to the end. What is to be feared is to go halfway and then to weaken. — Chinese wisdom"],z='<p style="line-height: 22px; padding: 16px 16px; text-align: center; font-family: Georgia; font-size: 16px;" data-size-leading-linked="false" data-size-leading-ratio="1.25"><span></span></p>',L=l.a.extend({name:"Text",thumb:"text",sort_index:1,icon_color:"#FFFFFF",controls:["text_edit","text_autosize","common_animation","common_rotation","common_position","common_layer","common_lock"],edit_controls:["text_styles","text_typography","text_bius","text_align","text_link","text_color","text_columns"],viewport_fields:g.b.viewport_fields.text,text_viewport_attributes:[],validElements:{"#span":["style","id","class","data-id","data-url","data-start","data-end","data-plays"],"#p":["style","class","data-size-leading-linked","data-size-leading-ratio"],br:[],a:["data-pid","data-uuid","style","class","href","target","data-anchor-link-pos"]},params:{multipleName:"multiple values",tabIndent:28,fontSizeLineHeightRatio:1.25,minFontSize:8,maxFontSize:999,minLineHeight:8,maxLineHeight:999,minLetterSpacing:-99,maxLetterSpacing:999},zoom:1,EDITOR_STYLES:':root { --editor-zoom: 1; }body {width: 100%;height: 100%;overflow: hidden;margin:0;padding:0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;word-wrap: break-word;white-space: pre-wrap;background: transparent;-webkit-font-smoothing: antialiased;text-rendering: optimizeLegibility !important;-webkit-column-fill: auto !important;-moz-column-fill: auto !important;column-fill: auto !important;-webkit-nbsp-mode: normal;transform: scale(var(--editor-zoom));transform-origin: left top;}body.v1 {font-family: "Source Sans Pro";font-weight: 400;font-style: normal;font-size: 16px;line-height: 20px;}body.v2 {font-family: "Roboto";font-weight: 400;font-style: normal;font-size: 18px;line-height: 26px;}span.nbsp {position: relative;z-index: -1;}span.nbsp:before {content: "⋀";position: absolute;color: #1cdeb4;font-size: .4em;font-weight: bold;left: 0;top: .7em;}h1, h2 {margin: 0;}p {color: #000000;margin: 0;padding: 0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;}.margin-st, .margin-ed {margin: 0;padding: 0;-webkit-margin-before: 0em;-webkit-margin-after: 0em;-webkit-margin-start: 0px;-webkit-margin-end: 0px;height: 1px;}.margin-st {margin-bottom: -1px;}.margin-ed {margin-top: -1px;}a {color: inherit;text-decoration: underline;}a * {text-decoration: underline;}a, span {line-height: 1px !important;font-size: inherit !important;}span.soundcite {position: relative;padding: 0 0.2em 0 1.3em;display: inline;line-height: 120% !important;background: rgba(0, 0, 0, 0.1);}span.soundcite:before {content: "";position: absolute;top: 0.21em;left: 0.3em;border-width: 0.4em;border-style : solid;border-right-color: transparent;border-bottom-color: transparent;border-top-color: transparent;border-left-width : 0.6em;}',initialize:function(t,e){t.get("version"),this.initBlock(t,e),this.frameClass=V,this.pid=e.page.id,this.page=e.page,this.setEditorZoom(RM.constructorRouter.zoom.getZoom()),this.inner_template=T.a["template-constructor-block-text"],this.setInitialParams(),this.changeStyleParagraph.__debounced=O.a.debounce(this.changeStyleParagraph,40),this.changeClassParagraph.__debounced=O.a.debounce(this.changeClassParagraph,40),this.changeStyleSpan.__debounced=O.a.debounce(this.changeStyleSpan,40),this.changeColumns.__debounced=O.a.debounce(this.changeColumns,40),this.changeLink.__debounced=O.a.debounce(this.changeLink,40),this.onChangeInEditor_throttle500=O.a.throttle(this.onChangeInEditor.bind(this),500),this.onChangeInEditor_throttle1500=O.a.throttle(this.onChangeInEditor.bind(this),1500),this.onChangeInEditor_throttle=function(){this.onChangeInEditor_throttle500(),this.onChangeInEditor_throttle1500()}.bind(this),this.recalcStyleDebounced=O.a.debounce(this.recalcStyle,50),this.model.on("change",this.onModelChange),RM.constructorRouter.on("font-added",this.onFontAdd),!this.model.isNested&&this.page.on("change:viewport",this.onViewportChange),this.has_parent_block&&(this.needSideMarginsSynhronized=!0,this.needClearMarginsOnEnter=!0,this.needPreserveLastPadding=!0,this.needIgnoreSlylesMargins=!0),A.a.on("zoom",this.setEditorZoom)},onFontAdd:function(){this.isEditorActive()&&P.a.appendFontsCssToIFrame(this.iframe_document)},setEditorZoom:function(t){this.zoom=t,this.$iframe_document&&this.$iframe_document[0].documentElement.style.setProperty("--editor-zoom",t)},switchTextToViewport:function(t,e){},switchTextToDefault:function(t){t=t||"";var e=this.model.isNested?"default":this.page.getCurrentViewport();if("default"==e)return t;var i=Object(r.a)("<div>").html(t),n=this.text_viewport_attributes,o=this;i.find("*").each((function(){var t=Object(r.a)(this);O.a.each(n,(function(i){var n=o.getViewportAttributeName(i,e),a=o.getViewportAttributeName(i,"default"),s=t.attr(a),r=t.attr(i);t.removeAttr(i),t.removeAttr(a),s&&t.attr(i,s),t.attr(n,r||"empty")}))}));var a=i.html();return i.empty().remove(),a},generateValidElementsList:function(){var t=O.a.pluck(g.b.viewports,"name"),e=this;return O.a.each(this.validElements,(function(i,n){var o=[];O.a.each(i,(function(i){O.a.indexOf(e.text_viewport_attributes,i)>=0&&Array.prototype.push.apply(o,O.a.map(t,(function(t){return e.getViewportAttributeName(i,t)})))})),Array.prototype.push.apply(i,o)})),O.a.map(this.validElements,(function(t,e){return e+(t.length?"["+t.join("|")+"]":"")})).join(",")},getViewportAttributeName:function(t,e){},setInitialParams:function(){this.editor=null,this.editorState=0,this.isEditMode=!1,this.cur_selection_styles={},this.cur_selection_styles_all=[],this.oldChangeParam={}},validate:function(){var t={};O.a.each(["bg_color","bg_opacity","column_count","column_gap"],O.a.bind((function(e){null==this.model.get(e)&&(t[e]=L.defaults[e])}),this)),O.a.isEmpty(t)||this.model.set(t,{silent:!0})},render:function(){if(!this.rendered){this.create(),this.setInitialParams(),this.validate();var t=O.a.pick(this.model.attributes,["_id","w","h","text"]);t.text=this.switchTextToViewport(t.text,this.page.getCurrentViewport()),this.model.created&&this.has_parent_block&&(t.text='<p style="line-height: 22px; padding: 16px 16px; text-align: center; font-family: Georgia; font-size: 16px;" data-size-leading-linked="false" data-size-leading-ratio="1.25"><span>Text</span></p>',this.model.save({text:t.text},{silent:!0})),this.selectOnEnter=this.model.created,Object(r.a)(this.inner_template(t)).appendTo(this.$content);var e=T.a["template-constructor-block-text-bg"];this.$bg=Object(r.a)(e({})).prependTo(this.$el),Object(c.a)("constructor.zIndex")?this.model.get("fixed_position")||this.$bg.css({"z-index":RM.constructorRouter.indexController.getZIndex(this.model.id,this.workspace.page.id,this.workspace.page.getCurrentViewport())}):this.$bg.css({"z-index":this.model.get("z")}),this.$el.addClass("block-text"),this.$el.toggleClass("text-autosize",!!this.model.get("autosize")),this.$preview=this.$(".text-preview"),this.$preview_mask=this.$(".text-mask"),this.$preview.addClass("v"+(this.model.get("version")||1)),this.model.created&&2==this.model.get("version")&&RM.constructorRouter.fonts.addFonts([{provider:"google",css_name:"Roboto",name:"Roboto",variations:["n1","i1","n3","i3","n4","i4","n5","i5","n7","i7","n9","i9"]}],"manual"),this.applyCssColumnCount(this.$preview,this.model.get("column_count")),this.applyCssColumnGap(this.$preview,this.model.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity")),this.model.created&&(this.model.created=!1,this.enterEditMode(),this.frame&&this.frame.show()),this.triggerReady()}},onIndexChange:function(){Object(c.a)("constructor.zIndex")&&this.$bg&&!this.model.get("fixed_position")&&this.$bg.css({"z-index":RM.constructorRouter.indexController.getZIndex(this.model.id,this.workspace.page.id,this.workspace.page.getCurrentViewport())}),l.a.prototype.onIndexChange.apply(this,arguments)},destroy:function(){this.model.off("change",this.onModelChange),this.off("resize",this.onChangeInEditor_throttle),RM.constructorRouter.off("font-added",this.onFontAdd),this.page.off("change:viewport",this.onViewportChange),this.leaveEditMode(!0),this.deleted=!0,l.a.prototype.destroy.apply(this,arguments)},createEditor:function(){var t=this;this.editorState=1,i.e(12).then(i.t.bind(null,"BZWO",7)).then((function(e){e.default.init({mode:"exact",theme:"simple",popup_css:!1,elements:"textarea_"+t.model.id,accessibility_warnings:!1,custom_shortcuts:!1,language_load:!1,doctype:"<!doctype html>",init_instance_callback:t.editorIsReady,verify_css_classes:!1,custom_undo_redo:!1,convert_urls:!1,valid_elements:t.generateValidElementsList(),plugins:"paste",paste_auto_cleanup_on_paste:!0,paste_max_consecutive_linebreaks:99,paste_text_sticky:!0,paste_text_sticky_default:!0,paste_beforegrab:O.a.bind((function(){this.workspaceScrollBeforePaste=Object(r.a)("#main").scrollTop()}),t),paste_postprocess:O.a.bind((function(){Object(r.a)("#main").scrollTop(this.workspaceScrollBeforePaste),this.somethingChangedInEditor("paste")}),t),paste_text_linebreaktype:"custom"})}))},css:function(t){void 0!==(t=t||{})["z-index"]&&this.$bg.css({"z-index":this.model.get("fixed_position")?"":t["z-index"]}),l.a.prototype.css.apply(this,arguments),t=O.a.pick(t,"width","height"),O.a.isEmpty(t)||(this.$editor&&this.$editor.css(t),this.$iframe_body&&this.$iframe_body.css(t),this.somethingChangedInEditor("dimensions"))},doesContentFit:function(){var t=!0;if(this.$iframe_document&&this.$iframe_document){var e=this.$iframe_document.width()/this.zoom,i=this.$iframe_document.height()/this.zoom,n=this.$iframe_body.width(),o=this.$iframe_body.height();e-n==1&&1==this.model.get("column_count")&&e--,t=!(e>n||i>o)}return t},"сheckContentFitToBox":function(){if(this.$iframe_document&&this.$iframe_body){var t=this.doesContentFit();this.frame&&this.frame.setResizeBottomPlus(!t),this.has_parent_block&&this.workspace.fit_text_to_content()}},getAllowableHeight:function(){var t=this.isEditMode?this.$iframe_body.find("p"):this.$preview.find("p"),e=t.length,i=0,n=0,o=0;return t.each(O.a.bind((function(t,a){i+=parseInt(Object(r.a)(a).outerHeight(),10),t===e-1&&(n=parseInt(Object(r.a)(a).css("line-height"),10)/2,Object(r.a)(a).find(".link-1").length&&(o=parseInt(Object(r.a)(a).find(".link-1").css("padding-bottom"),10)))}),this)),i+n+o},getContentBoxHeight:function(){var t=0;if(this.isEditMode)for(var e,i=Math.pow(2,16),n=function(t){this.$editor&&this.$editor.css({height:t}),this.$iframe_body&&this.$iframe_body.css({height:t})}.bind(this);t!==i;)n(e=t+Math.floor((i-t)/2)),this.doesContentFit()?i=e:t=e+1;else{var o=this.$preview[0].style.cssText;this.$preview.css({height:"auto","-moz-column-fill":"balance","column-fill":"balance"}),t=this.$preview.height(),this.$preview[0].style.cssText=o}return t},fitContentToBox:function(t){this.model.set({h:this.getAllowableHeight()}),t&&"keydown"===t.type&&RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","fit frame to text"),this.saveBox()},select:function(){l.a.prototype.select.apply(this,arguments),RM.constructorRouter.bindGlobalKeyPress([{key:"x",handler:this.fitContentToBox,optionKeys:Modernizr.mac?["meta","shift"]:["ctrl","shift"]}])},deselect:function(t){l.a.prototype.deselect.apply(this,arguments),RM.constructorRouter.unbindGlobalKeyPress("x",this.fitContentToBox),t!=this&&this.isEditMode&&(this.leaveEditMode(),this.workspace.trigger("redraw"))},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;this.isEditMode&&!e&&(this.leaveEditMode(),this.workspace.trigger("redraw"))}},onChangeInEditor:function(){this.model.get("autosize")&&(this.fitContentToBox(),this.trigger("resizeOnFit",this.model))},editorIsReady:function(t){if(t&&!this.deleted){this.editor=t,this.editor.onChange.add(this.onChangeInEditor_throttle),this.editor.onNodeChange.add(this.onChangeInEditor_throttle),this.editor.onKeyPress.add(this.onChangeInEditor_throttle),this.$editor=this.$("textarea").add(this.$("table")).add(this.$("iframe")),this.$iframe_body=this.$("iframe").contents().find("body"),this.iframe_document=this.$("iframe").contents()[0],this.$iframe_document=Object(r.a)(this.iframe_document),this.iframe=this.$("iframe")[0],this.$iframe_body.addClass("v"+(this.model.get("version")||1));var e=this.iframe_document.createElement("style");e.type="text/css",e.appendChild(this.iframe_document.createTextNode(this.EDITOR_STYLES)),this.iframe_document.getElementsByTagName("head")[0].appendChild(e),this.setEditorZoom(RM.constructorRouter.zoom.getZoom()),this.on("changeStyleParagraph",this.onChangeStyleParagraph),this.on("changeClassParagraph",this.onChangeClassParagraph),this.on("changeStyleSpan",this.onChangeStyleSpan),this.on("changeColumns",this.onChangeColumns),this.on("changeLink",this.onChangeLink),this.applyCssColumnCount(this.$iframe_body,this.model.get("column_count")),this.applyCssColumnGap(this.$iframe_body,this.model.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity")),this.css({width:this.model.get("w"),height:this.model.get("h")}),this.marginController=new B(this),this.columnsController=new H(this),this.undoController=new U(this),this.$iframe_body.on("mousemove mouseup",O.a.bind((function(t){t.pageX=this.$el.offset().left*this.zoom+t.clientX,t.pageY=this.$el.offset().top*this.zoom+t.clientY,this.disableMouseEventsRedirection||Object(r.a)(document).trigger(t)}),this)),this.$iframe_document.on("paste",O.a.bind((function(){O.a.defer(O.a.bind((function(){var t,e=this.editor.selection,i=e.getBookmark();t=this.$iframe_body[0].innerHTML,this.$iframe_body[0].innerHTML=t,e.moveToBookmark(i)}),this))}),this)),this.$iframe_document.on("mouseup",O.a.bind((function(t){this.mouseSelectionStart&&(this.somethingChangedInEditor("mouseup"),this.trigger("textWidgetMouseSelectionEnd"),this.mouseSelectionStart=!1)}),this)),this.$iframe_document.on("mousedown",O.a.bind((function(t){this.somethingChangedInEditor("mousedown"),this.trigger("textWidgetMouseSelectionStart"),this.mouseSelectionStart=!0}),this)),this.$iframe_document.on("keydown",O.a.bind((function(t){this.somethingChangedInEditor("keydown"),RM.constructorRouter.zoom.onZoomKey(RM.constructorRouter,t)}),this)),this.editor.onKeyDown.addToTop(O.a.bind((function(t,e){if(this.isCollapsedBeforeKeyProceed=this.editor&&this.editor.selection&&this.editor.selection.isCollapsed(),13==e.keyCode&&3==e.location&&(e.preventDefault(),e.stopPropagation(),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","quit edit mode"),this.isEditMode&&(this.leaveEditMode(),this.workspace.trigger("redraw"),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.controls,this))),8==e.keyCode){var i=3==(o=E.a.getSelection(this.iframe)).anchorNode.nodeType?o.anchorNode.parentNode:o.anchorNode,n=Object(r.a)(i).closest("span.soundcite");o.isCollapsed&&n.length&&(0==n.text().length||1==n.text().length&&8203==n.text().charCodeAt(0))&&n.remove()}if(this.needPreserveLastPadding&&(delete this.$paragraphsBeforeRemove,(8==e.keyCode||46==e.keyCode||this.editor&&this.editor.selection&&!this.editor.selection.isCollapsed())&&(this.$paragraphsBeforeRemove=this.$iframe_body.find("p"))),13==e.keyCode&&0==e.location){var o;i=3==(o=E.a.getSelection(this.iframe)).anchorNode.nodeType?o.anchorNode.parentNode:o.anchorNode;o.isCollapsed&&Object(r.a)(i).closest("span.soundcite").length&&(e.preventDefault(),e.stopPropagation())}}),this)),this.editor.onKeyDown.add(O.a.bind((function(t,e){if(this.needPreserveLastPadding){var i=O.a.bind((function(){if(this.$paragraphsBeforeRemove&&this.$paragraphsBeforeRemove.length){var t=this.$iframe_body.find("p"),e=this.$paragraphsBeforeRemove.first()[0],i=this.$paragraphsBeforeRemove.last()[0];t.length&&(1!=t.length||t.eq(0).text()||t[0]==e||t[0]==i)||(this.editor.setContent(z),t=this.$iframe_body.find("p"));var n=t.first()[0],o=t.last()[0];o!=i&&(n.style.paddingTop=e.style.paddingTop,n.style.paddingLeft=e.style.paddingLeft,n.style.paddingRight=e.style.paddingRight,o.style.paddingLeft=i.style.paddingLeft,o.style.paddingRight=i.style.paddingRight,o.style.paddingBottom=i.style.paddingBottom,n.setAttribute("data-mce-style",n.getAttribute("style")),o.setAttribute("data-mce-style",o.getAttribute("style")))}}),this);i(),8==e.keyCode||46==e.keyCode||13==e.keyCode||this.isCollapsedBeforeKeyProceed||O.a.defer(i)}if(this.needClearMarginsOnEnter&&13==e.keyCode&&3!==e.location&&!e.shiftKey){var n,o=E.a.getSelection(this.iframe);if(this.isCollapsedBeforeKeyProceed){try{n=o.getRangeAt(0)}catch(t){}if(n){var a=this.getClosestParagraph(n.startContainer);if(a){a.style.paddingTop=0,a.setAttribute("data-mce-style",a.getAttribute("style"));var s=Object(r.a)(a).prev("p");s.length&&(s[0].style.paddingBottom=0,s[0].setAttribute("data-mce-style",s[0].getAttribute("style")))}}}}}),this)),this.editor.dom.bind(this.editor.getBody(),["dragend","dragover","draggesture","dragdrop","drop","drag"],O.a.bind((function(t){return"dragend"==t.type&&this.mouseSelectionStart&&(this.somethingChangedInEditor("mouseup"),this.trigger("textWidgetMouseSelectionEnd"),this.mouseSelectionStart=!1),t.preventDefault(),t.stopPropagation(),!1}),this)),this.$("iframe").bind("mousewheel",this.onMouseWheel),setTimeout(O.a.bind((function(){this.deleted||(this.editorState=2,this.leaveEditorBeforeItIsLoaded||(this.enterEditMode(),this.editor.show()),this.somethingChangedInEditor("editorIsReady"))}),this),100),setTimeout(O.a.bind((function(){this.selectOnEnter&&(this.editor.selection.select(this.editor.getBody(),!0),delete this.selectOnEnter)}),this),200),this.bindShortcuts()}},onResizeStart:function(t,e){this.disableMouseEventsRedirection=!0,this.$preview_mask.addClass("visible-while-resizing")},onResizeEnd:function(t,e){this.disableMouseEventsRedirection=!1,this.$preview_mask.removeClass("visible-while-resizing")},onMouseWheel:function(t,e){var i=-Math.ceil(.5*e);if(i)if(i>0&&i<1&&(i=1),i<0&&i>-1&&(i=-1),this.model.get("column_count")>1){var n=this.$iframe_document.scrollLeft();this.$iframe_document.scrollLeft(i+n),t.preventDefault()}else{var o=this.$iframe_document.scrollTop();this.$iframe_document.scrollTop(i+o),o!=this.$iframe_document.scrollTop()&&t.preventDefault()}},onDblClick:function(){this.selected&&(this.model.get("pack_id")&&1!==this.workspace.getSelectedBlocks().length?l.a.prototype.onDblClick.apply(this,arguments):this.enterEditMode())},getClosestParagraph:function(t){var e;if(!t)return e;for(;;){var i=t.tagName;if("P"==i||"p"==i){e=t;break}if(!(t=t.parentNode)||!t.tagName)break}return e},selectNodesBoundingSelection:function(t,e){var i,n,o,a,s;this.editor.selection.select(t),n=(i=this.editor.selection.getRng(!0)).startContainer,o=i.startOffset,this.editor.selection.select(e),a=(i=this.editor.selection.getRng(!0)).endContainer,s=i.endOffset,(i=this.iframe_document.createRange()).setStart(n,o),i.setEnd(a,s),this.editor.selection.setRng(i)},bindShortcuts:function(){var t=this;function e(){if(t.workspace&&t.workspace.controls){var e=t.workspace.controls.findControl("text_typography");e&&e.onClick.apply(e)}return!1}function i(){if(t.workspace&&t.workspace.controls){var e=t.workspace.controls.findControl("text_link");e&&(e.onClick.apply(e),e.focusInputField.apply(e))}return RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","create a link"),!1}function n(e){var i;return t.cur_selection_styles&&null!=t.cur_selection_styles[e]&&(i=t.cur_selection_styles[e])==t.params.multipleName&&(i=t.cur_selection_styles_all&&t.cur_selection_styles_all.length>0&&null!=t.cur_selection_styles_all[0][e]?t.cur_selection_styles_all[0][e]:void 0),i}function o(){var e=n("font-weight");return e&&t.trigger("changeStyleSpan",{"font-weight":700==e?"400":"700"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make bold"),!1}function a(){var e=n("font-style");return e&&t.trigger("changeStyleSpan",{"font-style":"italic"==e?"normal":"italic"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make italic"),!1}function s(){var e=n("text-decoration");return e&&t.trigger("changeStyleSpan",{"text-decoration":"underline"==e?"none":"underline"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","make underlined"),!1}function l(){var e=n("font-size");return e&&(++e>t.params.maxFontSize&&(e=t.params.maxFontSize),t.trigger("changeStyleParagraph",{"font-size":e+"px"})),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","increase font size"),!1}function c(){var e=n("font-size");return e&&(--e<t.params.minFontSize&&(e=t.params.minFontSize),t.trigger("changeStyleParagraph",{"font-size":e+"px"})),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","decrease font size"),!1}function d(){if(t.editor&&t.editor.selection&&t.isEditorActive()){RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","select current paragraph");var e,i=E.a.getSelection(t.iframe);try{e=i.getRangeAt(0)}catch(t){return}var n=t.getClosestParagraph(e.startContainer),o=t.getClosestParagraph(e.endContainer);return t.selectNodesBoundingSelection(n,o),!1}}function h(){return t.trigger("changeStyleParagraph",{"text-align":"left"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align left"),!1}function u(){return t.trigger("changeStyleParagraph",{"text-align":"right"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align right"),!1}function p(){return t.trigger("changeStyleParagraph",{"text-align":"center"}),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","align center"),!1}function g(e){if(t.editor&&t.editor.selection&&t.editor.selection.isCollapsed()){var i=t.editor.selection.getRng(),n=t.editor.selection.getNode(),o=i.startOffset;if(n&&!(o>0)){for(;n&&Object(r.a)(n)[0].tagName&&"p"!=Object(r.a)(n)[0].tagName.toLowerCase();){if(Object(r.a)(n).index()>0)return;n=n.parentNode}if(n&&Object(r.a)(n)[0].tagName&&"p"==Object(r.a)(n)[0].tagName.toLowerCase()){var a=0;if(t.iframe_document.defaultView&&t.iframe_document.defaultView.getComputedStyle){var s=t.iframe_document.defaultView.getComputedStyle(n,null);s&&(a=parseInt(s.getPropertyValue("text-indent"),10)),isNaN(a)&&(a=0)}if(!(e<0&&0==a))return(a+=t.params.tabIndent*e)<0&&(a=0),t.trigger("changeStyleParagraph",{"text-indent":a+"px"}),!1}}}}this.$iframe_body.bind("keydown","tab",(function(){return g(1),!1})).bind("keydown","backspace",(function(t){return g(-1)})).bind("keydown","alt+up",(function(){var e=n("line-height");e&&(--e<t.params.minLineHeight&&(e=t.params.minLineHeight),t.trigger("changeStyleParagraph",{"line-height":e+"px"}));RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","decrease line height");return!1})).bind("keydown","alt+down",(function(){var e=n("line-height");e&&(++e>t.params.maxLineHeight&&(e=t.params.maxLineHeight),t.trigger("changeStyleParagraph",{"line-height":e+"px"}));RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","increase line height");return!1})).bind("keydown","alt+left",(function(){if(!t.editor||!t.editor.selection||t.editor.selection.isCollapsed())return;var e=n("letter-spacing");null!=e&&((e=v.default.decimals(e-.2,2))<t.params.minLetterSpacing&&(e=t.params.minLetterSpacing),t.trigger("changeStyleSpan",{"letter-spacing":e+"px"}));return!1})).bind("keydown","alt+right",(function(){if(!t.editor||!t.editor.selection||t.editor.selection.isCollapsed())return;var e=n("letter-spacing");null!=e&&((e=v.default.decimals(e+.2,2))>t.params.maxLetterSpacing&&(e=t.params.maxLetterSpacing),t.trigger("changeStyleSpan",{"letter-spacing":e+"px"}));return!1})),this.$iframe_body.bind("keydown","alt+ctrl+t",e).bind("keydown","ctrl+shift+x",this.fitContentToBox.bind(this)).bind("keydown","ctrl+k",i).bind("keydown","ctrl+b",o).bind("keydown","ctrl+i",a).bind("keydown","ctrl+u",s).bind("keydown","ctrl+shift+¾",l).bind("keydown","ctrl+shift+¼",c).bind("keydown","ctrl+shift+a",d).bind("keydown","ctrl+shift+l",h).bind("keydown","ctrl+shift+r",u).bind("keydown","ctrl+shift+c",p),this.$iframe_body.bind("keydown","alt+meta+t",e).bind("keydown","meta+shift+x",this.fitContentToBox.bind(this)).bind("keydown","meta+k",i).bind("keydown","meta+b",o).bind("keydown","meta+i",a).bind("keydown","meta+u",s).bind("keydown","meta+shift+¾",l).bind("keydown","meta+shift+¼",c).bind("keydown","meta+shift+a",d).bind("keydown","meta+shift+l",h).bind("keydown","meta+shift+r",u).bind("keydown","meta+shift+c",p),this.bindSymbolShortcuts()},bindSymbolShortcuts:function(){var t=Modernizr.mac;O.a.each({"&ensp;":"alt+shift+space","&nbsp;":"alt+ctrl+space","&thinsp;":"alt+ctrl+shift+space"},function(e,i){-1!==e.indexOf("ctrl")&&t?this.$iframe_body.bind("keydown",e.replace("ctrl","meta"),this.insertCharacter.bind(this,i)):this.$iframe_body.bind("keydown",e,this.insertCharacter.bind(this,i))}.bind(this))},enterEditMode:function(t){t&&t.shiftKey||1!=this.editorState&&(0!=this.editorState?(this.$editor&&this.$editor.css("display","block"),this.frame&&this.frame.setEditorState(),this.$preview&&this.$preview.css("display","none"),this.$preview_mask&&this.$preview_mask.css("display","none"),this.initiatorControl="user",this.isEditMode=!0,this.marginController&&this.marginController.show(),this.columnsController&&this.columnsController.show(),this.frame.removeRotationState(),this.frame.resetRotation(),this.undoController.historyTriggers=p.a.setCustomHandlers({undo:this.undoController.undo,redo:this.undoController.redo,getLength:this.undoController.getLength}),this.prevModelAttributes=O.a.clone(this.model.attributes),clearInterval(this.intermediateSaveInterval),this.intermediateSaveInterval=setInterval(this.intermediateSave,2e4),RM.constructorRouter.textStyles.generateCSS("paragraph","editor",this.iframe_document),RM.constructorRouter.textStyles.generateCSS("link","editor",this.iframe_document),P.a.appendFontsCssToIFrame(this.iframe_document),setTimeout(O.a.bind((function(){this.isEditorActive()&&(this.editor.focus(),this.editor.setContent(this.switchTextToViewport(this.model.get("text"),this.model.isNested?"default":this.page.getCurrentViewport())),this.somethingChangedInEditor("enterEditMode"))}),this),0),this.workspace&&this.workspace.controls&&this.workspace.controls.setControls(this.edit_controls,this),this.workspace.trigger("w-text-entered-edit-mode")):this.createEditor())},isEditorActive:function(){return!this.deleted&&(!!this.isEditMode&&(!!this.editor&&2==this.editorState))},applyCssColumnCount:function(t,e){var i=1==e?"auto":e;t&&t.css({"-webkit-column-count":i+"","-moz-column-count":i+"","column-count":i+""})},applyCssColumnGap:function(t,e){t&&t.css({"-webkit-column-gap":e,"-moz-column-gap":e,"column-gap":e})},applyCssBgColor:function(t,e){var i="",n=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];i=e>.99?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgba("+n[0]+","+n[1]+","+n[2]+", "+e+")",this.$bg.css("background",i)},leaveEditMode:function(t){0!=this.editorState&&(1!=this.editorState?this.isEditorActive()&&(this.changeSpanToNbsp(),this.workspace.trigger("w-text-before-leave-edit-mode"),this.isEditMode=!1,clearInterval(this.intermediateSaveInterval),v.default.getFocusBack(),this.$editor&&this.$editor.css("display","none"),this.frame&&this.frame.removeEditorState(),this.$preview&&this.$preview.css("display","block"),this.$preview_mask&&this.$preview_mask.css("display","block"),this.marginController&&this.marginController.hide(),this.columnsController&&this.columnsController.hide(),this.frame.restoreRotation(),p.a.removeCustomHandlers(),this.undoController.historyTriggers={},t||this.saveWidgetData(),this.workspace.trigger("w-text-leaved-edit-mode")):this.leaveEditorBeforeItIsLoaded=!0)},getSaveBoxOptions:function(t){return O.a.extend({patch:!0},t)},saveWidgetData:function(){var t=this.switchTextToDefault(this.editor.getContent()),e=Object(r.a)("<div>").html(t);for(e.find("div").remove();;){var i=e.html();if(e.find("span:econtains( ), a:econtains( )").filter((function(){return" "!=Object(r.a)(this).closest("p").text()})).remove(),e.find("span:econtains(''), a:econtains('')").filter((function(){return""!=Object(r.a)(this).closest("p").text()})).remove(),i==e.html())break}!(t=e.html())&&this.has_parent_block&&(t=z),t==this.prevModelAttributes.text&&O.a.isEqual(O.a.omit(this.model.attributes,"text","x","y","w","h","z","angle","flip_h","flip_v"),O.a.omit(this.prevModelAttributes,"text","x","y","w","h","z","angle","flip_h","flip_v"))||this.model.save({text:t}),this.prevModelAttributes=O.a.clone(this.model.attributes),e.empty().remove()},intermediateSave:function(){this.isEditorActive()?this.saveWidgetData():clearTimeout(this.intermediateSaveInterval)},onViewportChange:function(){if(this.rendered){var t=this.switchTextToViewport(this.model.get("text"),this.page.getCurrentViewport());this.setPreviewHtml(t),this.editor&&this.editor.setContent(t)}},onModelChange:function(t){var e;if(l.a.prototype.onModelChange.apply(this,arguments),this.rendered){if(this.validate(),O.a.has(t.changedAttributes(),"text")){var i=this.switchTextToViewport(t.get("text"),this.model.isNested?"default":this.page.getCurrentViewport());this.setPreviewHtml(i),this.isEditorActive()||this.editor&&this.editor.setContent(i)}"autosize"in t.changed&&(e=this.$el.find(".frameborder"),this.$el.toggleClass("text-autosize",!!this.model.get("autosize")),e.hasClass("red-border")&&this.model.get("autosize")&&e.removeClass("red-border"),O.a.defer(function(){this.fitContentToBox(),this.trigger("resizeOnFit",this.model)}.bind(this))),this.applyCssColumnCount(this.$preview,t.get("column_count")),this.applyCssColumnCount(this.$iframe_body,t.get("column_count")),this.applyCssColumnGap(this.$preview,t.get("column_gap")),this.applyCssColumnGap(this.$iframe_body,t.get("column_gap")),this.applyCssBgColor(this.model.get("bg_color"),this.model.get("bg_opacity"))}},setPreviewHtml:function(t){this.$preview&&this.$preview.html(t),this.$preview.find("span.soundcite").each((function(t,e){M.a&&M.a.setElementsColor(e)}))},calcColumnsPositions:function(){var t,e,i,n=this.$el[0].offsetWidth,o=this.$iframe_document.width()/this.zoom,a=this.model.get("column_gap"),s=(n+a)/this.model.get("column_count")-a,r=Math.round((o+a)/(s+a)),l=(o+a)/r-a,c=[],d=0;for(t=0;t<r;t++)e=Math.round(d),i=Math.round(d+l),c.push({st:e,ed:i,w:i-e}),d+=l+a;return c},sanitizeContent:function(){if("1"!=this.$iframe_body.attr("data-pasting-in-action")){this.$iframe_body.find('span[data-mce-type="bookmark"]').remove();var t=this.editor.selection.getBookmark();this.$iframe_body.find('span[data-mce-type="bookmark"]').removeAttr("data-mce-type").addClass("bookmark");var e=this.editor.getContent();this.editor.setContent(e),this.$iframe_body.find("span.bookmark").attr("data-mce-type","bookmark").removeClass("bookmark").text(""),this.editor.selection.moveToBookmark(t)}},removeRedundandNBSPs:function(){var t,e=this.$iframe_body[0].innerHTML,i=n(e);function n(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/\>&nbsp;\</gim,">{{{NBSP_PLACEHOLDER}}}<")).replace(/([^\>])&nbsp;([^\<])/gim,"$1{{{NBSP_PLACEHOLDER}}}$2")).replace(/([^\>\<$|\s])&nbsp;/gim,"$1{{{NBSP_PLACEHOLDER}}}")).replace(/\<\/p\>/gim,"</p>\n")).replace(/([^\s\>])((?:<[^\>]*?>)*)&nbsp;((?:<[^\>]*?>)*)([^\s\<])/gi,"$1$2 $3$4")).replace(/\{\{\{NBSP_PLACEHOLDER\}\}\}/gim,"&nbsp;")).replace(/\<\/p\>\n+/gim,"</p>")}i!=e&&(t=this.editor.selection.getBookmark(),this.$iframe_body.find('span[data-mce-type="bookmark"]').html(""),i=n(e=this.$iframe_body[0].innerHTML),this.$iframe_body[0].innerHTML=i,this.editor.selection.moveToBookmark(t))},somethingChangedInEditor:function(t,e){if("dimensions"==t||"margins"==t||"enterEditMode"==t)return this.recalcStyle(t,e),void("enterEditMode"==t&&-1!==this.$iframe_body[0].innerHTML.indexOf("&nbsp;")&&this.changeNbspToSpan());"paste"==t&&setTimeout(this.sanitizeContent,0),this.recalcStyleDebounced(t,e)},recalcStyle:function(t,e){if(this.isEditorActive()&&"1"!=this.$iframe_body.attr("data-pasting-in-action")&&(this.$iframe_body.find(":not(p,span,a,br)").length>0&&this.sanitizeContent(),this.сheckContentFitToBox(),"dimensions"==t?setTimeout(O.a.bind((function(){this.marginController&&this.marginController.recalc(),this.columnsController&&this.columnsController.recalc()}),this),0):(this.marginController&&this.marginController.recalc(),this.columnsController&&this.columnsController.recalc()),"dimensions"!=t)){this.removeRedundandNBSPs(),"keydown"==t&&this.changeNbspToSpan();var i=this.editor.getContent();if("BODY"==(d=this.editor.selection.getRng(!0)).startContainer.tagName||"BODY"==d.endContainer.tagName)var n=!0;var o=E.a.getSelection(this.iframe);if(n){d=o.getRangeAt(0);var a=this.editor.dom.createRng();a.setStart(d.startContainer,d.startOffset),a.setEnd(d.endContainer,d.endOffset),this.editor.selection.setRng(a)}"undo"!=t&&"redo"!=t&&this.undoController.add(i,"margins"==t?"formatApplied":t,o,e),"user"==this.initiatorControl&&(this.oldChangeParam={});var s=[];if("[object HTMLDocument]"!=(b=3==o.anchorNode.nodeType?o.anchorNode.parentNode:o.anchorNode).toString()){var l,c;if(o.isCollapsed)s.push(b),l=b,c=b;else if(o.rangeCount){var d,h=(d=o.getRangeAt(0)).getNodes([3]);l=d.startContainer,c=d.endContainer;for(var u,p=0;u=h[p];p++)""!=u.nodeValue&&s.push(u.parentNode);s=r.a.unique(s)}l=3==l.nodeType?l.parentNode:l,c=3==c.nodeType?c.parentNode:c;var g,m,f=[];for(p=0;p<s.length;p++)for(var v,b=s[p];"P"!=(v=b.tagName)&&"p"!=v;){if("A"==v||"a"==v){f.push(b),s[p]==l&&(g=b),s[p]==c&&(m=b);break}if(!(b=b.parentNode)||!b.tagName)break}var _=this.workspace&&this.workspace.controls&&this.workspace.controls.findControl("text_color");g&&m&&Object(r.a)(g).attr("data-uuid")==Object(r.a)(m).attr("data-uuid")?_&&_.setDisabled():_&&_.setEnabled(),this.calcSelectionStyle(s,f),this.collapsedSelection=o.isCollapsed,o.isCollapsed&&this.cur_selection_styles&&this.$iframe_body.css("color","#"+this.cur_selection_styles.color)}}},getComputedStyle:function(t,e){var i=[];if(t&&this.iframe_document.defaultView&&this.iframe_document.defaultView.getComputedStyle){var n=this.iframe_document.defaultView.getComputedStyle(t,null);if(!n)return[];O.a.each(e,(function(e){var o=n.getPropertyValue(e).toLowerCase();t.tagName&&"A"==t.tagName&&"text-decoration"==e&&(o="none"),i.push({prop:e,val:o})}))}return i},calcSelectionStyle:function(t,e){if(this.cur_selection_styles_all=[],O.a.each(t,O.a.bind((function(t){var e=this.getComputedStyle(t,["text-align","color","text-transform","vertical-align","font-weight","font-style","text-decoration","letter-spacing","font-family"]),i=this.getClosestParagraph(t);if(i){var n=this.getComputedStyle(i,["font-size","line-height","padding-top","padding-left","padding-right","padding-bottom"]);(e=O.a.union(e,n)).push({prop:"paragraph-class",val:i.className});var o=i.getAttribute("data-size-leading-linked");e.push({prop:"size-leading-linked",val:!o||"true"==o}),e.push({prop:"size-leading-ratio",val:(i.getAttribute("data-size-leading-ratio")||this.params.fontSizeLineHeightRatio)-0})}e.length>0&&(!function(t){O.a.each(t,(function(e){if("font-weight"==e.prop&&("normal"==e.val&&(e.val="400"),"bold"==e.val&&(e.val="700")),"color"==e.prop){var i,n,o=e.val.match(/\s*rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*/);o||(o=e.val.match(/\s*rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d+|\d*\.\d+)\s*\)\s*/)),o&&(a=o[1]-0,s=o[2]-0,r=o[3]-0,l=a.toString(16),c=s.toString(16),d=r.toString(16),i=(1==l.length?"0"+l:l)+(1==c.length?"0"+c:c)+(1==d.length?"0"+d:d),n=Math.round(100*(o[4]||1))),e.val=i,t.push({prop:"opacity",val:n})}var a,s,r,l,c,d;if("font-size"==e.prop&&(e.val=parseInt(e.val,10)),"line-height"==e.prop&&(e.val=parseInt(e.val,10)),"text-align"==e.prop&&"start"!=e.val&&"left"!=e.val&&"right"!=e.val&&"justify"!=e.val&&"center"!=e.val&&(e.val="start"),"text-decoration"==e.prop){var h=e.val.split(" ");e.val=h.length?h[0]:e.val}if("padding-left"!=e.prop&&"padding-right"!=e.prop&&"padding-top"!=e.prop&&"padding-bottom"!=e.prop||(e.val=parseInt(e.val,10)),"letter-spacing"==e.prop&&("normal"==e.val&&(e.val="0"),e.val=parseFloat(e.val)),"font-family"==e.prop){e.val=e.val.replace(/\'|\"/gim,"");var u=RM.constructorRouter.fonts.findFontByCSSName(e.val);u&&u.css_name&&(e.val=u.css_name)}}))}(e),this.cur_selection_styles_all.push(e))}),this)),0!=this.cur_selection_styles_all.length){var i=this.cur_selection_styles;this.cur_selection_styles={};var n=[],o=!0;O.a.each(this.cur_selection_styles_all,O.a.bind((function(t){var e={};O.a.each(t,O.a.bind((function(t){e[t.prop]=t.val,this.cur_selection_styles[t.prop]!=t.val&&(this.cur_selection_styles[t.prop]=this.params.multipleName),o&&(this.cur_selection_styles[t.prop]=t.val)}),this)),n.push(e),o=!1}),this)),this.cur_selection_styles_all=n;for(var a in this.cur_selection_styles)if(this.cur_selection_styles[a]!=i[a]){!1;break}this.cur_selection_styles.link_nodes=e,this.trigger("selection_styles_changed",this.cur_selection_styles),this.trigger("selection_styles_all_changed",this.cur_selection_styles_all),this.initiatorControl="user"}},onChangeStyleParagraph:function(t){this.checkForParamUpdateNeeded(this.changeStyleParagraph,t)},onChangeClassParagraph:function(t){this.checkForParamUpdateNeeded(this.changeClassParagraph,t)},onChangeStyleSpan:function(t){this.checkForParamUpdateNeeded(this.changeStyleSpan,t)},onChangeColumns:function(t){this.checkForParamUpdateNeeded(this.changeColumns,t)},onChangeLink:function(t){this.checkForParamUpdateNeeded(this.changeLink,t)},checkForParamUpdateNeeded:function(t,e){if(!O.a.isEqual(this.oldChangeParam,e)){var i=O.a.keys(this.oldChangeParam),n=O.a.keys(e);0==O.a.difference(i,n).length?t.__debounced(e):t(e)}this.oldChangeParam=e,e&&e.url&&(/^back\sto\stop$/i.test(e.url)||(e.url=encodeURI(e.url))),this.somethingChangedInEditor("formatApplied",e)},changeStyleParagraph:function(t){if(t&&this.isEditorActive()){var e=O.a.pick(t,"size-leading-linked","size-leading-ratio"),i=O.a.omit(t,"size-leading-linked","size-leading-ratio"),n={selector:"p"};O.a.isEmpty(e)||(n.attributes=O.a.object(O.a.map(O.a.keys(e),(function(t){return"data-"+t})),O.a.map(O.a.values(e),(function(t){return t+""})))),!Modernizr.webkit||Modernizr.safari||Modernizr.safari5?i["white-space"]=Object.values(i).indexOf("justify")>-1?"normal":"pre-wrap":i["white-space"]="inherit",O.a.isEmpty(i)||(n.styles=i),this.editor.formatter.register("temp",n),this.editor.formatter.apply("temp")}},changeClassParagraph:function(t){t&&(this.isEditorActive()&&(this.editor.formatter.register("temp",{selector:"p",classes:"temp-class"}),this.editor.formatter.apply("temp"),Object(r.a)(".temp-class",this.iframe_document).each(O.a.bind((function(e,i){var n=Object(r.a)(i);if(this.needIgnoreSlylesMargins){var o,a={};o=i.style.paddingLeft,a.paddingLeft=parseInt(o,10)?o:0,o=i.style.paddingTop,a.paddingTop=parseInt(o,10)?o:0,o=i.style.paddingBottom,a.paddingBottom=parseInt(o,10)?o:0,o=i.style.paddingRight,a.paddingRight=parseInt(o,10)?o:0}t.class&&(i.className=t.class),t.remove&&(i.className="none"),n.removeAttr("style").removeAttr("data-mce-style"),t.override&&n.find("*").removeAttr("style").removeAttr("data-mce-style");for(var s=i.firstChild;s&&(3!=s.nodeType||""==s.nodeValue);s=s.nextSibling);if(!s&&!t.override){var l={};!function t(e,i){if(e.childNodes.length>0)for(var n=0;n<e.childNodes.length;n++)t(e.childNodes[n],i);3==e.nodeType&&""!=e.nodeValue&&i(e)}(i,O.a.bind((function(t){var e=this.getComputedStyle(t.parentNode,["font-weight","font-style","font-family","letter-spacing","color","text-transform","vertical-align","text-decoration"]);O.a.each(e,(function(t,e){l[t.prop]||(l[t.prop]={}),l[t.prop][t.val]=!0}))}),this));var c=[];O.a.each(l,(function(t,e){1==O.a.keys(t).length&&c.push(e)})),n.find("*").each(O.a.bind((function(t,e){if(e.tagName&&"br"!=e.tagName.toLowerCase()){O.a.each(c,(function(t,i){e.style.removeProperty(t)}));var i=r.a.trim(e.style.cssText);i?Object(r.a)(e).attr("data-mce-style",i):Object(r.a)(e).removeAttr("style").removeAttr("data-mce-style")}}),this))}this.needIgnoreSlylesMargins&&(i.style.paddingLeft=a.paddingLeft,i.style.paddingTop=a.paddingTop,i.style.paddingBottom=a.paddingBottom,i.style.paddingRight=a.paddingRight,i.setAttribute("data-mce-style",i.getAttribute("style")))}),this))))},changeStyleSpan:function(t){t&&this.isEditorActive()&&(this.editor.formatter.register("temp",{inline:"span",styles:t}),this.editor.formatter.apply("temp"))},changeColumns:function(t){t&&this.isEditorActive()&&(null!=t.column_count&&(this.model.set({column_count:t.column_count}),this.applyCssColumnCount(this.$iframe_body,t.column_count)),null!=t.column_gap&&(this.model.set({column_gap:t.column_gap}),this.applyCssColumnGap(this.$iframe_body,t.column_gap)),null!=t.bg_color&&null!=t.bg_opacity&&(this.model.set({bg_color:t.bg_color,bg_opacity:t.bg_opacity}),this.applyCssBgColor(t.bg_color,t.bg_opacity)))},changeLink:function(t){if(t&&this.isEditorActive()){var e,i,n=this.cur_selection_styles&&this.cur_selection_styles.link_nodes||[],o=this.collapsedSelection;if("remove"==t.action&&(o&&n.length&&(e=Object(r.a)(n[0]).attr("data-uuid"),i=this.$iframe_body.find("a[data-uuid='"+e+"']"),this.selectNodesBoundingSelection(i[0],i[i.length-1])),this.editor.execCommand("mceInsertLink",!1,"")),"create"==t.action){o&&n.length?(e=Object(r.a)(n[0]).attr("data-uuid"),i=this.$iframe_body.find("a[data-uuid='"+e+"']")):(e=v.default.generateUUID(),this.editor.execCommand("mceInsertLink",!1,"temp-url"),i=this.$iframe_body.find('a[href="temp-url"]'));var a={};t.clickPage&&(a["data-page-uri"]=t.clickPage),i.attr(O.a.extend({href:t.url,"data-mce-href":t.url,"data-uuid":e,"data-pid":RM.constructorRouter.mag.getPageId(t.url)||null,class:t.class,"data-mce-class":t.class,target:t.target,"data-anchor-link-pos":t.anchor_pos||null},a)),i.length>0&&this.selectNodesBoundingSelection(i[0],i[i.length-1])}"change-class"==t.action&&n.length&&Object(r.a)(n).attr({class:t.class,"data-mce-class":t.class}),"change-target"==t.action&&n.length&&Object(r.a)(n).attr({target:t.target})}},changeNbspToSpan:function(){var t,e=this.editor.selection.getBookmark();t=(t=this.$iframe_body[0].innerHTML.replace(/<span class="nbsp">(&nbsp;)?(.*?)<\/span>/g,"$1$2")).replace(/&nbsp;/g,'<span class="nbsp">&nbsp;</span>'),this.$iframe_body[0].innerHTML=t,this.editor.selection.moveToBookmark(e)},changeSpanToNbsp:function(){var t;t=this.$iframe_body[0].innerHTML.replace(/<span class="nbsp">(&nbsp;)?(.*?)<\/span>/g,"$1$2"),this.$iframe_body[0].innerHTML=t},insertCharacter:function(t,e){this.editor.execCommand("mceInsertContent",!1,t),"&nbsp;"===t&&(this.changeNbspToSpan(),RM&&RM.constructorRouter&&RM.constructorRouter.analytics&&RM.constructorRouter.analytics.sendEvent("Key Press","insert non-breaking space")),e.preventDefault()}},{defaults:{text:function(){return"<p>"+D[Math.floor(Math.random()*D.length)]+"</p>"},column_count:1,column_gap:16,bg_color:"ffffff",bg_opacity:0,version:2}}).extend(j.a.prototype),B=o.a.View.extend({params:{maxTopMargin:999,maxBottomMargin:999,maxLeftMargin:999,maxRightMargin:999,handleThreshold:4,minHandleSize:43},initialize:function(t){O.a.bindAll(this),this.block=t,this.block.$iframe_document.on("scroll",this.onScroll),this.marginBlocks=new F(this,this.block.$(".margins-wrapper-inner")[0]),this.marginHandle=new N(this,this.block.$el[0]),this.onScroll()},onScroll:function(){this.scrollTop=this.block.$iframe_document.scrollTop(),this.scrollLeft=this.block.$iframe_document.scrollLeft(),this.marginBlocks.onScroll(this.scrollTop,this.scrollLeft),this.marginHandle.onScroll(this.scrollTop,this.scrollLeft)},recalc:function(){if(this.block.isEditorActive()){this.dw=this.block.$iframe_document.width()/this.block.zoom,this.dh=this.block.$iframe_document.height()/this.block.zoom;var t,e=E.a.getSelection(this.block.iframe);try{t=e.getRangeAt(0)}catch(t){return}var i=this.block.getClosestParagraph(t.startContainer),n=this.block.getClosestParagraph(t.endContainer);if(!i&&"BODY"!=t.startContainer.tagName||!n&&"BODY"!=t.endContainer.tagName)return this.marginBlocks.proceed([]),void this.marginHandle.proceed([],[]);if(!i||!n){var o=this.block.$iframe_body.find("p");if(0==o.length)return this.marginBlocks.proceed([]),void this.marginHandle.proceed([],[]);i||(i=o.get(0)),n||(n=o.get(-1))}for(var a=[{paragraph:i}];i&&i!==n;)"P"==(i=i.nextSibling).tagName&&a.push({paragraph:i});if(this.block.model.get("column_count")>1){var s=this.insertDiv("margin-st","before",a[0].paragraph);a[0].st=s;for(var r=0;r<a.length;r++){s=this.insertDiv("margin-ed","after",a[r].paragraph);a[r].ed=s,r+1<a.length&&(a[r+1].st=s)}var l=this.block.calcColumnsPositions()}var c=[],d=[];if(O.a.each(a,O.a.bind((function(t){var e=this.calcParagraphDimensions(t,l);O.a.each(e.marginBlocks,O.a.bind((function(t){c.push(t)}),this)),O.a.each(e.marginHandles,O.a.bind((function(t){d.push(t)}),this))}),this)),this.block.model.get("column_count")>1){var h=a[0].paragraph.parentNode;h.removeChild(a[0].st);for(r=0;r<a.length;r++)h.removeChild(a[r].ed)}this.marginBlocks.proceed(c),this.marginHandle.proceed(d,O.a.pluck(a,"paragraph"))}},insertDiv:function(t,e,i){var n=this.block.iframe_document.createElement("div");return n.className=t,"before"==e?i.parentNode.insertBefore(n,i):i.parentNode.insertBefore(n,i.nextSibling),n},getColumnIndex:function(t,e){for(var i,n=9999,o=0,a=0;a<t.length;a++)(i=Math.abs(e-t[a].st))<n&&(n=i,o=a);return o},calcParagraphDimensions:function(t,e){var i=t.paragraph,n=this.block.iframe_document.defaultView.getComputedStyle(i,null),o=parseInt(n.getPropertyValue("padding-top"),10),a=parseInt(n.getPropertyValue("padding-right"),10),s=parseInt(n.getPropertyValue("padding-bottom"),10),r=parseInt(n.getPropertyValue("padding-left"),10),l=o,c=s;if(1==this.block.model.get("column_count"))var d=R.a.getBox(i,1/this.block.zoom),h=(m=d.width,f=d.left+this.scrollLeft),u=(v=d.top+this.scrollTop)+d.height;else{var p=R.a.getBox(t.st,1/this.block.zoom),g=R.a.getBox(t.ed,1/this.block.zoom),m=p.width,f=(g.width,p.left+this.scrollLeft),v=(h=g.left+this.scrollLeft,p.top+this.scrollTop+("margin-ed"==t.st.className?1:0));u=g.top+this.scrollTop+1}var b=[];if(this.block.model.get("column_count")>1)for(var _=this.getColumnIndex(e,f),y=this.getColumnIndex(e,h),w=_;w<=y;w++){var k,S=e[w];k=_==y?u-v:w==_?this.dh-v:w==y?u:this.dh;var x={x:S.st,w:S.w,y:w==_?v:0,h:k};b.push(x)}else{x={x:f,y:v,w:m,h:u-v};b.push(x)}var C=b.length;for(w=0;w<C;w++){r+a>(T=b[w]).w&&(r>T.w?(r=T.w,a=0):a=T.w-r),T.mr=a,T.ml=r,T.mt=o,T.h<o&&(T.mt=T.h),o=Math.max(o-T.h,0)}for(w=C-1;w>=0;w--){(T=b[w]).mb=s,T.h<s&&(T.mb=T.h),s=Math.max(s-T.h,0)}var O,P=[],j=[],$=!1;for(w=0;w<C;w++){var T,I={ox:(T=b[w]).x,oy:T.y,ow:T.w,oh:T.h,mt:T.mt,mb:T.mb,ml:T.ml,mr:T.mr},E=T.w-T.ml-T.mr,M=T.x+T.ml;0==E?(E=2,M--):1==E&&(E=2),M+E>T.x+T.w&&(M=T.x+T.w-E),M<T.x&&(M=T.x),I.ix=M,I.iy=T.y+T.mt,I.iw=E,I.ih=T.h-T.mt-T.mb,P.push(I),!$&&I.oh-I.mt-I.mb>0&&(O={tp:"top",column:w,p:i,val:l,max:this.params.maxTopMargin,x:I.ix,y:I.iy,size:I.iw},j.push(O),$=!0),w==C-1&&(O={tp:"bottom",column:w,p:i,val:c,max:this.params.maxBottomMargin,x:I.ox,y:I.oy+I.oh-1,size:I.ow},j.push(O)),I.oh-I.mt-I.mb>0&&(O={tp:"left",column:w,p:i,val:T.ml,max:Math.min(I.ow-I.mr,this.params.maxLeftMargin),x:I.ix,y:I.iy,size:I.ih},j.push(O),O={tp:"right",column:w,p:i,val:T.mr,max:Math.min(I.ow-I.ml,this.params.maxRightMargin),x:I.ix+I.iw-1,y:I.iy,size:I.ih},j.push(O))}return{marginBlocks:P,marginHandles:j}},show:function(){this.marginBlocks.show(),this.marginHandle.show(),this.onScroll()},hide:function(){this.marginBlocks.hide(),this.marginHandle.hide()}}),F=o.a.Model.extend({initialize:function(t,e){O.a.bindAll(this),this.controller=t,this.container=e,this.marginBlocks=[]},onScroll:function(t,e){Object(r.a)(this.container).css({top:-t,left:-e})},proceed:function(t){for(var e=this.prevUsedBlocks?this.prevUsedBlocks:this.marginBlocks.length,i=0;i<e;i++)this.clear(this.marginBlocks[i]);for(i=0;i<t.length;i++){var n=t[i];this.marginBlocks[i]||(this.marginBlocks[i]=this.createNewMarginBlock()),this.render(this.marginBlocks[i],n)}this.prevUsedBlocks=t.length},createNewMarginBlock:function(){var t={};function e(t,e){var i=document.createElement("div");return i.className=t,e.appendChild(i),i}return t.t=e("margin-top-block",this.container),t.b=e("margin-bottom-block",this.container),t.l=e("margin-left-block",this.container),t.r=e("margin-right-block",this.container),t.outer=e("margin-outer-frame",this.container),e("frameborder",t.outer),t.inner=e("margin-inner-frame",this.container),e("frameborder",t.inner),t},render:function(t,e){function i(t,e,i,n,o){var a=t.style;a.left=e+"px",a.top=i+"px",a.width=n<0?0:n+"px",a.height=o<0?0:o+"px",a.display="block"}i(t.outer,e.ox,e.oy,e.ow,e.oh),0==e.mb&&0==e.mt&&0==e.mr&&0==e.ml||i(t.inner,e.ix,e.iy,e.iw,e.ih),0!=e.mt&&i(t.t,e.ox,e.oy,e.ow,e.mt),0!=e.mb&&i(t.b,e.ox,e.oy+e.oh-e.mb,e.ow,e.mb),0!=e.ml&&i(t.l,e.ox,e.oy+e.mt,e.ml,e.oh-e.mt-e.mb),0!=e.mr&&i(t.r,e.ox+e.ow-e.mr,e.oy+e.mt,e.mr,e.oh-e.mt-e.mb)},clear:function(t){t.inner.style.display="none",t.outer.style.display="none",t.t.style.display="none",t.b.style.display="none",t.l.style.display="none",t.r.style.display="none"},show:function(){this.container.parentNode.style.display="block"},hide:function(){this.container.parentNode.style.display="none"}}),N=o.a.View.extend({initialize:function(t,e){O.a.bindAll(this),this.controller=t,this.container=e,this.template=T.a["template-constructor-block-text-margins"],this.setElement(Object(r.a)(this.template({})).appendTo(this.container)),this.initialData=void 0,this.data=void 0,this.mx=0,this.my=0,this.mxOnFocusEnter=0,this.myOnFocusEnter=0,this.scrollLeft=0,this.scrollTop=0,this.marginHandles=[],this.state="idle",this.paragraphs=[],this.mouseProceeding=!0,this.$el.RMDrag({start:this.startHandleDrag,move:this.moveHandleDrag,end:this.endHandleDrag,silent:!0,preventDefault:!0}),this.controller.block.on("textWidgetMouseSelectionStart",this.onMouseSelectionStart),this.controller.block.on("textWidgetMouseSelectionEnd",this.onMouseSelectionEnd),this.$marginInput=this.$el.find(".margin-input"),this.$marginInput.RMNumericInput({needMinMaxCurChanger:!0,min:0,max:999,onChange:this.onInputChange,mouseUse:!1}),this.inputChangeValue=this.$marginInput.data("changeValue"),this.inputChangeMinMax=this.$marginInput.data("changeMinMax"),this.$marginInput.on("focus",this.onInputFocus).on("blur",this.onInputBlur)},onMouseSelectionStart:function(){this.hideHandle(),this.mouseProceeding=!1},onMouseSelectionEnd:function(){this.mouseProceeding=!0,this.onMouseMove()},startHandleDrag:function(t){this.$marginInput.blur(),this.state="dragging",this.oldDelta=0,this.showHandle("show"),this.onMouseMove(),this.controller.block.trigger("textWidgetMarginDragStart")},moveHandleDrag:function(t){if(this.data){var e="top"==this.data.tp||"bottom"==this.data.tp?Math.round(t.deltaY/this.controller.block.zoom):Math.round(t.deltaX/this.controller.block.zoom),i="right"==this.data.tp?-1:1,n=this.data.val+(e-this.oldDelta)*i;n<0?(this.applyStyle(this.data.tp,0),this.oldDelta=e-n*i):n>this.data.max?(this.applyStyle(this.data.tp,this.data.max),this.oldDelta=e+(this.data.max-n)*i):(this.applyStyle(this.data.tp,n),this.oldDelta=e)}},endHandleDrag:function(t){this.controller.block.trigger("textWidgetMarginDragEnd"),t.moved?(this.hideHandle(),this.state="idle",this.onMouseMove()):(this.mxOnFocusEnter=this.mx,this.myOnFocusEnter=this.my,this.$marginInput.focus(),this.$marginInput.select())},onInputFocus:function(){this.state="focus"},onInputBlur:function(){this.state="idle",this.controller.block.isEditMode&&this.controller.block.editor.focus()},onInputChange:function(t,e){this.data&&this.applyStyle(this.data.tp,e)},applyStyle:function(t,e){for(var i=this.controller.block.needSideMarginsSynhronized,n=!i||"left"!=t&&"right"!=t?this.paragraphs:this.controller.block.$iframe_body.find("p"),o=0;o<n.length;o++){var a=n[o];"top"==t&&(a.style.paddingTop=e+"px"),"bottom"==t&&(a.style.paddingBottom=e+"px"),"left"==t&&(a.style.paddingLeft=e+"px",i&&(a.style.paddingRight=e+"px")),"right"==t&&(a.style.paddingRight=e+"px",i&&(a.style.paddingLeft=e+"px")),a.setAttribute("data-mce-style",a.getAttribute("style"))}var s={};s["padding-"+t]=e+"px",this.controller.block.somethingChangedInEditor("margins",s)},onMouseMove:function(t){if(this.shown&&(t&&(this.mx=t.pageX/this.controller.block.zoom,this.my=t.pageY/this.controller.block.zoom),this.mouseProceeding)){if(this.getEditorDimensions(),"idle"==this.state){var e=this.controller.params.handleThreshold;if(this.mx<this.editorLeft-e||this.mx>=this.editorLeft+this.editorWidth+e||this.my<this.editorTop-e||this.my>=this.editorTop+this.editorHeight+e)this.hideHandle();else{for(var i=!1,n=0;n<this.marginHandles.length;n++){var o,a,s=this.marginHandles[n],r=this.editorLeft-this.scrollLeft+s.x,l=this.editorTop-this.scrollTop+s.y;if("top"==s.tp&&(a=e,o=s.size,l-=e-1),"bottom"==s.tp&&(a=e,o=s.size),"left"==s.tp&&(o=e,a=s.size,r-=e-1),"right"==s.tp&&(o=e,a=s.size),!(this.mx<r||this.mx>=r+o||this.my<l||this.my>=l+a)){this.curHoverMarginHandle!=s&&(this.data=O.a.clone(s),this.initialData=O.a.clone(s),this.showHandle("only-line"),this.curHoverMarginHandle=s),i=!0;break}}i||this.hideHandle()}}"dragging"==this.state&&this.updateHandleLabelPos()}},getEditorDimensions:function(){var t=this.controller.block.$el[0].getBoundingClientRect();this.editorWidth=t.width,this.editorHeight=t.height,this.editorLeft=t.left,this.editorTop=t.top},showHandle:function(t){var e=this.data;if(e){var i,n,o=e.x-this.scrollLeft,a=e.y-this.scrollTop;if(e.limited_x=e.x,e.limited_y=e.y,e.limited_size=e.size,"top"==e.tp||"bottom"==e.tp){var s=!1;(a<0||a>=this.editorHeight)&&(s=!0),(o>=this.editorWidth||o+e.size<=0)&&(s=!0),this.$el.toggleClass("out-of-box",s),o<0?(e.limited_x=e.x-o,e.limited_size=e.size+o,o=0):o+e.size>this.editorWidth&&(e.limited_size=this.editorWidth-o)}if("left"==e.tp||"right"==e.tp){s=!1;(o<0||o>=this.editorWidth)&&(s=!0),(a>=this.editorHeight||a+e.size<=0)&&(s=!0),this.$el.toggleClass("out-of-box",s),a<0&&a+e.size>this.editorHeight?(e.limited_y=e.y-a,e.limited_size=this.editorHeight,a=0):a<0?(e.limited_y=e.y-a,e.limited_size=e.size+a,a=0):a+e.size>this.editorHeight&&(e.limited_size=this.editorHeight-a)}var r=this.controller.params.handleThreshold;"top"==e.tp&&(n=r,i=e.limited_size,a-=r-1),"bottom"==e.tp&&(n=r,i=e.limited_size),"left"==e.tp&&(i=r,n=e.limited_size,o-=r-1),"right"==e.tp&&(i=r,n=e.limited_size),this.$el.toggleClass("small",e.limited_size<this.controller.params.minHandleSize),this.$el.css({left:o,top:a,width:i,height:n}),"show"!=t&&"update"!=t||(this.inputChangeValue&&this.inputChangeValue(e.val,!0),this.inputChangeMinMax&&this.inputChangeMinMax(0,e.max)),"show"!=t&&"only-line"!=t||this.$el.removeClass("margin-top").removeClass("margin-bottom").removeClass("margin-left").removeClass("margin-right").addClass("margin-"+e.tp),"show"==t&&this.$el.removeClass("inactive"),"only-line"==t&&this.$el.addClass("only-line")}},hideHandle:function(){this.$el.addClass("inactive"),this.$el.removeClass("only-line"),this.$el.removeClass("out-of-box"),this.data=void 0,this.initialData=void 0,this.state="idle",this.curHoverMarginHandle=void 0,this.mouseProceeding=!0},updateHandleLabelPos:function(t){if(this.data){var e=this.$el.find(".margin-handle-label-wrapper"),i=t?this.mxOnFocusEnter:this.mx,n=t?this.myOnFocusEnter:this.my;if("top"==this.data.tp||"bottom"==this.data.tp){var o=i-(this.editorLeft-this.scrollLeft+this.data.limited_x),a=e.width();o-=Math.round(a/2),o=Math.min(Math.max(o,0),this.data.limited_size-a),e.css({left:Math.round(o),top:"auto"})}else{var s=n-(this.editorTop-this.scrollTop+this.data.limited_y),r=e.height();s-=Math.round(r/2),s=Math.min(Math.max(s,0),this.data.limited_size-r),e.css({top:Math.round(s),left:"auto"})}}},proceed:function(t,e){this.marginHandles=t,this.paragraphs=e,this.initialData&&(this.data=this.getClosestDataToInitial(),this.data?(this.getEditorDimensions(),this.showHandle("update"),"focus"==this.state&&this.updateHandleLabelPos(!0)):this.hideHandle()),this.onMouseMove()},getClosestDataToInitial:function(){for(var t=[],e=0;e<this.marginHandles.length;e++){var i=this.marginHandles[e];i.p==this.initialData.p&&i.tp==this.initialData.tp&&t.push(i)}if(t.length){var n=99999,o=-1;for(e=0;e<t.length;e++){var a=Math.abs(t[e].column-this.initialData.column);a<n&&(n=a,o=e)}return O.a.clone(t[o])}},onScroll:function(t,e){this.scrollTop=t,this.scrollLeft=e,this.showHandle("update")},show:function(){this.shown=!0,Object(r.a)(document).on("mousemove",this.onMouseMove),this.onMouseMove(),this.$el.removeClass("hidden")},hide:function(){this.shown=!1,Object(r.a)(document).off("mousemove",this.onMouseMove),this.$el.addClass("hidden"),this.hideHandle()}}),U=o.a.Model.extend({initialize:function(t){O.a.bindAll(this),this.block=t,this.undoIndex=-1,this.undoStack=[],this.add.__debounced=O.a.debounce(this.add,50),this.historyTriggers={},this.block.$iframe_body.bind("keydown","ctrl+z",this.undo).bind("keydown","ctrl+shift+z",this.redo),this.block.$iframe_body.bind("keydown","meta+z",this.undo).bind("keydown","meta+shift+z",this.redo)},add:function(t,e,i,n){if(this.block.isEditorActive()){var o,a=this,s=a.block.page.getCurrentViewport(),r=function(t){return t.split("<").length-1}(t=t||"<p></p>"),l=this.undoStack[this.undoIndex];if(-1==this.undoIndex||l.content!=t||s!=l.viewport){if("enterEditMode"==e&&(this.undoIndex>=0&&l.start&&(this.undoIndex--,this.undoStack.length=this.undoIndex+1,l=this.undoStack[this.undoIndex]),-1!=this.undoIndex&&s==l.viewport||_({mergable:!1,start:!0}),this.historyTriggers&&this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid)),"paste"==e&&_({mergable:!1}),"formatApplied"==e)if(this.undoIndex>=0&&l.formatParams&&s==l.viewport){var c=O.a.keys(l.formatParams),d=O.a.keys(n);if(0==O.a.difference(c,d).length&&(o=d,0!=O.a.intersection(o,["font-size","line-height","letter-spacing","color","padding-top","padding-bottom","padding-left","padding-right"]).length)){var h=f(),u=l.initialSelection;h.startOffset==u.startOffset&&h.endOffset==u.endOffset&&O.a.isEqual(h.startNodePosition,u.startNodePosition)&&O.a.isEqual(h.endNodePosition,u.endNodePosition)?(l.content=t,l.formatParams=n,l.selection=f(),l.initialSelection=O.a.clone(l.selection),this.undoStack.length=this.undoIndex+1):_({mergable:!1,formatParams:n})}else _({mergable:!1,formatParams:n})}else _({mergable:!1,formatParams:n});if("keydown"==e&&this.undoIndex>=0)if(l.tagsCount!=r)_({mergable:!1});else{var p=b(l.content),g=b(t),m=p.length<=g.length;if(l.mergable)if(Math.abs(p.length-g.length)>2)_({mergable:!0,increasing:m});else if(m!=l.increasing||s!=l.viewport)_({mergable:!0,increasing:m});else{h=f(),u=l.initialSelection;Math.abs(h.startOffset-u.startOffset)>2||!O.a.isEqual(h.startNodePosition,u.startNodePosition)?_({mergable:!0,increasing:m}):(l.content=t,l.selection=f(),l.initialSelection=O.a.clone(l.selection),this.undoStack.length=this.undoIndex+1)}else _({mergable:!0,increasing:m})}}else this.undoIndex>=0&&(l.selection=f())}function f(){var t=i.getRangeAt(0)||{};if(t.startContainer&&"BODY"!=t.startContainer.tagName){var e={};return e.startOffset=t.startOffset,e.endOffset=t.endOffset,t.startContainer==t.endContainer?(e.sameNode=!0,e.startNodePosition=v(t.startContainer),e.endNodePosition=e.startNodePosition):(e.sameNode=!1,e.startNodePosition=v(t.startContainer),e.endNodePosition=v(t.endContainer)),e}}function v(t){for(var e=[];;){if("BODY"==t.tagName)break;if(e.push(i(t)),!(t=t.parentNode)||!t.tagName)break}return e;function i(t){for(var e=0;null!=(t=t.previousSibling);)t.textContent&&++e;return e}}function b(t){return t.replace(/&\S+?;/gim,"$")}function _(e){e=e||{},a.undoIndex++,a.undoStack[a.undoIndex]={content:t,mergable:e.mergable,tagsCount:r,increasing:e.increasing,formatParams:e.formatParams,viewport:s,start:e.start,selection:f()},a.undoStack[a.undoIndex].initialSelection=O.a.clone(a.undoStack[a.undoIndex].selection),a.undoStack.length=a.undoIndex+1,l=a.undoStack[a.undoIndex],a.historyTriggers&&a.historyTriggers.triggerChange&&a.historyTriggers.triggerChange(a.block.pid)}},undo:function(t){if(t&&t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.block.isEditorActive()&&this.undoIndex>0){if(this.undoStack[this.undoIndex-1].viewport!=this.block.page.getCurrentViewport())return;this.undoIndex--,this.restoreState(this.undoIndex),this.block.somethingChangedInEditor("undo"),this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid),this.historyTriggers.triggerUndo&&this.historyTriggers.triggerUndo(this.block.pid)}},redo:function(t){if(t&&t.stopPropagation&&(t.stopPropagation(),t.preventDefault()),this.block.isEditorActive()&&this.undoIndex<this.undoStack.length-1){if(this.undoStack[this.undoIndex+1].viewport!=this.block.page.getCurrentViewport())return;this.undoIndex++,this.restoreState(this.undoIndex),this.block.somethingChangedInEditor("redo"),this.historyTriggers.triggerChange&&this.historyTriggers.triggerChange(this.block.pid),this.historyTriggers.triggerRedo&&this.historyTriggers.triggerRedo(this.block.pid)}},getLength:function(t){for(var e=0,i=this.block.page.getCurrentViewport();this.undoIndex-e>=0&&this.undoStack[this.undoIndex-e].viewport==i;)e++;return{undo:e-1,redo:this.undoStack.length-1-this.undoIndex,page:t}},restoreState:function(t){this.block.editor.setContent(this.undoStack[t].content||"");var e=this.undoStack[t].selection,i=this;if(e){var n,o=s(e.startNodePosition);if(n=e.sameNode?o:s(e.endNodePosition),o&&n)try{var a=this.block.iframe_document.createRange();a.setStart(o,e.startOffset),a.setEnd(n,e.endOffset),this.block.editor.selection.setRng(a)}catch(t){}}function s(t){for(var e=i.block.$iframe_body[0],n=t.length-1;n>=0;n--){if(!(e&&e.childNodes&&e.childNodes.length&&e.childNodes.length>=t[n]+1)){e=void 0;break}e=e.childNodes[t[n]]}return e}}}),H=o.a.View.extend({initialize:function(t){O.a.bindAll(this),this.block=t,this.container=this.block.$(".columns-wrapper-inner")[0],this.columnBlocks=[],this.block.$iframe_document.on("scroll",this.onScroll),this.onScroll()},onScroll:function(){this.scrollTop=this.block.$iframe_document.scrollTop(),this.scrollLeft=this.block.$iframe_document.scrollLeft(),Object(r.a)(this.container).css({top:-this.scrollTop,left:-this.scrollLeft})},recalc:function(){if(this.block.isEditorActive())if(this.block.model.get("column_count")>1){this.block.$(".columns-wrapper").removeClass("single-column");for(var t=this.block.calcColumnsPositions(),e=t.length-1,i=this.prevUsedBlocks?this.prevUsedBlocks:this.columnBlocks.length,n=0;n<i;n++)this.columnBlocks[n].style.display="none";for(n=0;n<e;n++)this.columnBlocks[n]||(this.columnBlocks[n]=this.createNewColumnBlock()),this.render(this.columnBlocks[n],t[n].ed,t[n+1].st-t[n].ed);this.prevUsedBlocks=e}else this.block.$(".columns-wrapper").addClass("single-column")},createNewColumnBlock:function(){var t=document.createElement("div");t.className="gap",this.container.appendChild(t);var e=document.createElement("div");return e.className="frameborder",t.appendChild(e),t},render:function(t,e,i){var n=t.style;n.left=e+"px",n.width=i+"px",n.display="block"},show:function(){this.block.$(".columns-wrapper").removeClass("hidden"),this.onScroll()},hide:function(){this.block.$(".columns-wrapper").addClass("hidden")}}),V=b.a.extend({customResizeHandler:function(t){return this.block.model.get("autosize")&&(this.block.$el.css("width",t.width),t.height=this.block.getContentBoxHeight()),t}}),W=L,G=Object(c.a)("constructor.textv3")?C:W,q=i("gdoY"),K=i("PhV8"),X=i("Vxjr"),Y=l.a.extend({name:"Video",sort_index:4,thumb:"video",icon_color:"#1877F2",MIN_WIDTH:85,MIN_HEIGHT:85,video_controls:["video_settings"],settingsOnCreate:!0,initialize:function(t,e){this.controls=O.a.union(this.video_controls,this.controls),this.initBlock(t,e),void 0===this.model.get("info")&&this.model.set("info",!0,{silent:!0}),t.on("change:video_id",this.draw),this.getEmbed=q.a.video.prototype.getEmbed,this.getCustomVideoPoster=q.a.video.prototype.getCustomVideoPoster,this.getCustomThumbnail=q.a.video.prototype.getCustomThumbnail,O.a.bindAll(this),this.saveDebounced=O.a.debounce(O.a.bind((function(){this.panel?this.panel.save():t.save()}),this),2e3)},render:function(){this.create(),this.frame.minwidth=this.MIN_WIDTH,this.frame.minheight=this.MIN_HEIGHT,this.$el.addClass("video"),this.draw(),this.triggerReady()},draw:function(){var t=Object(r.a)("<div>").css({width:"100%",height:"100%",position:"absolute"});this.$content.empty().append(t).append(this.getEmbed(O.a.extend(O.a.clone(this.model.attributes),{real:!1}))),this.$iframe=this.$("iframe"),this.$poster=this.$(".poster"),this.$f=null,this.model.get("video_id")&&(this.$el.removeClass("empty"),"Vimeo"===this.model.get("provider_name")&&(this.$f=Object(K.a)(this.$iframe.get(0)),this.$f.addEvent("ready",this.setColor)))},redraw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.checkNeedRedraw(t,e)&&(l.a.prototype.redraw.apply(this,arguments),(t.hasChanged("info")||t.hasChanged("theme"))&&this.draw(),t.hasChanged("color")&&this.setColor(),(t.hasChanged("picture")||t.hasChanged("custom_thumbnail"))&&this.onCustomThumbnailChange(t),this.workspace.trigger("redraw"))},onCustomThumbnailChange:function(t){!0===t.changed.custom_thumbnail&&t.attributes.picture&&t.attributes.picture.url||t.changed.picture?this.draw():(this.$iframe&&this.$iframe.css("visibility","visible"),this.$poster&&(this.$poster.off(),this.$poster.remove()))},setColor:function(t){this.model.get("provider_name")&&"vimeo"!==this.model.get("provider_name").toLowerCase()||(this.$f||(this.$f=Object(K.a)(this.$iframe.get(0))),this.$f.api("setColor",this.model.get("color")),this.model.hasChanged("color")&&this.saveDebounced())},css:function(t){l.a.prototype.css.apply(this,arguments),t.width&&(this.$iframe&&this.$iframe.attr("width",t.width),this.$poster&&this.$poster.css({width:t.width})),t.height&&(this.$iframe&&this.$iframe.attr("height",t.height),this.$poster&&this.$poster.css({height:t.height}))},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/",n=this.model.get("thumbnail_url");t.small&&this.icon_color&&(e["background-color"]=this.icon_color),t.small||(e["border-radius"]="8px");var o=Object(X.findImagePath)("".concat(i,"video.svg"));return n&&(o=n,e["background-size"]="auto 150%"),e["background-image"]="url(".concat(o,")"),e}},{defaults:{thumbnail_url:""}}),Z=i("hdsW"),J=i("HlXo"),Q=i.n(J),tt=l.a.extend({name:"Music",sort_index:6,thumb:"audio",icon_color:"#EC520B",initialize:function(t,e){this.initBlock(t,e),this.inner_template=Q.a["template-constructor-block-audio"],this.frameClass=et,this.controls=["audio_settings","common_animation","common_position","common_layer","common_lock"],this.drawDebounced=O.a.debounce(this.draw,500)},render:function(){this.create(),this.applySizeConstraints(),Object(r.a)(this.inner_template(this.model.attributes)).appendTo(this.$content),this.currentPlayer=null,this.lastPlayer=null,this.$el.addClass("audio"),this.draw(),this.$el.addClass("empty"),this.triggerReady()},applySizeConstraints:function(){var t,e,i;"visual"==this.model.get("current_type")&&(t=200,e=200),"standard"==this.model.get("current_type")&&(t=200,e=166,166==this.model.get("embed_height")&&(i=166)),"minimal"==this.model.get("current_type")&&(t=200,e=224,this.model.get("artwork")||(e=83,i=83),this.model.get("artwork")||this.model.get("info")||(e=26,i=26)),this.$el.toggleClass("no-height-resize",e==i),O.a.extend(this.frame,{minwidth:t,maxwidth:void 0,minheight:e,maxheight:i}),this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),!this.model.get("resized")&&"standard"==this.model.get("current_type")&&this.model.get("embed_height")>166&&this.model.set("h",Math.min(this.model.get("embed_height"),450),{silent:!0}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},draw:function(t){this.model.get("parsed_url")?this.lastPlayer=new Z.a(O.a.clone(this.model.attributes),this.$content.find(".player-wrapper"),this.playerReady.bind(this)):(this.lastPlayer&&this.lastPlayer.destroy(),this.currentPlayer&&this.lastPlayer!=this.currentPlayer&&this.currentPlayer.destroy(),this.currentPlayer=null,this.lastPlayer=null,this.$el.addClass("empty")),t&&t.triggerRedraw&&this.workspace.trigger("redraw")},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/",n=this.model.get("thumbnail_url");t.small&&this.icon_color&&(e["background-color"]=this.icon_color),t.small||(e["border-radius"]="8px");var o=Object(X.findImagePath)("".concat(i,"audio.svg"));return n&&(o=n,e["background-size"]="cover"),e["background-image"]="url(".concat(o,")"),e},applyMinimalPlayerStyle:function(t){this.currentPlayer&&this.currentPlayer.applyPlayerStyle&&this.currentPlayer.applyPlayerStyle(t),this.workspace.trigger("redraw")},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){l.a.prototype.redraw.apply(this,arguments);var i=this.model.changedAttributes(),n=O.a.isObject(i)&&0==O.a.without(O.a.keys(i),"w","h","x","y","z").length;if(n||this.applySizeConstraints(),O.a.isObject(i))if(null==i.url)if(i.current_type)this.drawDebounced();else{var o=["comments","artwork","socials","playcount","color"],a=["artwork","info","color"];Object(O.a)(["standard","visual"]).contains(this.model.get("current_type"))&&O.a.intersection(O.a.keys(i),o).length&&this.drawDebounced(),"minimal"==this.model.get("current_type")&&O.a.intersection(O.a.keys(i),a).length&&this.applyMinimalPlayerStyle(O.a.clone(this.model.attributes))}else this.draw({triggerRedraw:!0});else this.drawDebounced()}},playerReady:function(t){this.$el.removeClass("empty"),this.lastPlayer==t?(this.currentPlayer&&t!=this.currentPlayer&&this.currentPlayer.destroy(),this.model.get("parsed_url")&&(this.currentPlayer=t,this.currentPlayer.show())):t.destroy()},getBoxData:function(){return O.a.extend(l.a.prototype.getBoxData.apply(this,arguments),{resized:!0})}},{defaults:{current_type:"visual",autoplay:!1,comments:!1,artwork:!0,socials:!0,playcount:!0,info:!0,color:"ff5100",thumbnail_url:"",w:400,x:"center",h:400}}),et=b.a.extend({customResizeHandler:function(t,e,i){if("minimal"==this.block.model.get("current_type")&&this.block.model.get("artwork"))if(e){if("n"!=e&&"s"!=e||(t.width=t.height-24),"w"!=e&&"e"!=e||(t.height=t.width+24),"se"==e&&(t.width>t.height-24?t.height=t.width+24:t.width=t.height-24),"nw"==e||"ne"==e||"sw"==e||"se"==e){var n=t.width+t.left,o=t.height+t.top;t.width>t.height-24?t.height=t.width+24:t.width=t.height-24,"nw"==e&&(t.left=n-t.width,t.top=o-t.height),"ne"==e&&(t.top=o-t.height),"sw"==e&&(t.left=n-t.width)}}else t.height=t.width+24;if(!i){var a=O.a.pick(this.block.model.attributes,"x","y","w","h");a.x==t.left&&a.y==t.top&&a.w==t.width&&a.h==t.height||(this.block._saveXHR&&this.block._saveXHR.abort(),this.block._saveXHR=this.block.model.save({x:t.left,y:t.top,w:t.width,h:t.height}))}return t}}),it=tt,nt=o.a.View.extend({excludedFromLib:!0,initialize:function(t){this.parent=t.block,this.getEmbed=q.a.video.prototype.getEmbed,this.getCustomVideoPoster=q.a.video.prototype.getCustomVideoPoster,this.getCustomThumbnail=q.a.video.prototype.getCustomThumbnail},render:function(){if(this.setElement(this.parent.$el.find(".video")),this.parent.model.get("video")){var t=O.a.extend({real:!1,id:this.parent.id},this.parent.model.get("video"));this.$el.css({opacity:this.parent.model.get("videoopacity")}),this.$el.find(".container").html(this.getEmbed(t)),this.rendered=!0}},show:function(){this.rendered||this.render(),this.$el.stop().animate({opacity:this.parent.model.get("videoopacity")})},hide:function(){this.$el.stop().animate({opacity:0},{queue:!1})},toggle:function(){this.rendered||this.render(),this.$el.stop().toggleFade()}}),ot=i("tZHv"),at=i("i7aS"),st=i("roQd"),rt=l.a.extend({RESCALE_URL:"/api/imagescale",FINAL_URL:"/api/imagefinal",PREVIEW_URL:"/api/imagepreview",SEARCH_URL:"/api/upload/fromurl",LAMBDA_FROM_URL:"/api/upload/lambda/fromurl",SVG_URL:"/api/imagesvg",flagLambda:function(){return at.a.flagLambda()},allowedLambdaExt:function(){var t=this.model.get("picture");return t?at.a.allowedLambdaExt(t.type):void 0},useLambdaUrl:function(){return at.a.useLambdaUrl(this.model.get("picture"))},getLambdaUrl:function(){var t=st.a.normalizeAnimations(this.model.get("animation")).reduce((function(t,e){return Math.max(t,st.a.maxScaleAnimation(e))}),0);return at.a.getLambdaUrl(this.model.get("picture"),{width:this.model.get("w"),height:this.model.get("h"),cropX:this.model.get("cropX"),cropY:this.model.get("cropY"),cropW:this.model.get("cropW"),cropH:this.model.get("cropH"),originalW:this.model.get("originalW"),originalH:this.model.get("originalH"),scale:RM.constructorRouter.zoom.getZoom(),animationScale:t&&t/100,isStretched:this.model.get("is_full_width")||this.model.get("is_full_height")})},getOriginalLambdaUrl:function(){return at.a.getOriginalLambdaUrl(this.model.get("picture"))},getLqipUrl:function(){return at.a.getLqipUrl(this.model.get("picture"),{cropX:this.model.get("cropX"),cropY:this.model.get("cropY"),cropW:this.model.get("cropW"),cropH:this.model.get("cropH"),originalW:this.model.get("originalW"),originalH:this.model.get("originalH")})},getThumbnailUrl:function(){return at.a.getThumbnailUrl(this.model.get("picture"))},removePicture:function(){this.model.unset("picture"),this.model.save({},{silent:!0,toHistory:!0}),this._fromUrlXHR&&this._fromUrlXHR.abort(),this._getFinalRequest&&this._getFinalRequest.abort()},getPictureUrl:function(){var t=this.model.get("picture");return t?this.useLambdaUrl()?this.getLambdaUrl():Modernizr.retina&&t.final2xUrl||t.finalUrl||t.unscaledOptimizedUrl||t.url:""},getVectorUrl:function(){var t=this.model.get("picture");return t?t.editedVectorUrl||t.url:""},getOpacity:function(){var t=this.model.get("opacity");return O.a.isNumber(t)?t:1},getFinalImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.useLambdaUrl()){var i=this.model.get("picture"),n=this.model.isNested?"default":e.viewport||this.model.collection.page.getCurrentViewport(),o=this.model.get("w");if(o!==this.model.get("w"))return;this.isFullWidth()&&this.model.set("w",this.getFullWidthDims().w,{silent:!0}),this.isFullHeight()&&this.model.set("h",this.getFullHeightDims().h,{silent:!0}),this.model.save("picture",i,O.a.extend(e||{},{viewport:n})),t&&t(null)}else{var a=this.model.get("picture");if(!a||!a.url)return t&&t(null);var s=this.model.isNested?"default":e.viewport||this.model.collection.page.getCurrentViewport(),l=this.model.get("w");this._getFinalRequest&&this._getFinalRequest.abort(),this.showTempPreloader&&this.showTempPreloader(),this._getFinalRequest=r.a.ajax({type:"POST",data:this.model.attributes,url:this.FINAL_URL,success:function(i){this.hideTempPreloader()&&this.hideTempPreloader(),l===this.model.get("w")&&(this.isFullWidth()&&this.model.set("w",this.getFullWidthDims().w,{silent:!0}),this.isFullHeight()&&this.model.set("h",this.getFullHeightDims().h,{silent:!0}),this.model.save("picture",O.a.extend({},a,i),O.a.extend(e||{},{viewport:s})),t&&t(null,i))},error:function(e){t&&t(e.responseText)},context:this})}},requestFinalImage:function(t,e){r.a.ajax({type:"POST",data:t,url:this.FINAL_URL,success:function(t){e&&e(t)}})},loadPreviewUrl:function(t,e){var i=this.model.get("picture");i&&r.a.ajax({type:"GET",data:{width:t.w,height:t.h,url:i.rasterUrl||i.url,mid:this.workspace.mag.get("num_id")},url:this.PREVIEW_URL,success:O.a.bind((function(t){i.previewUrl=t&&t.previewUrl,this.model.save({picture:i},{silent:!0,toHistory:!0}),e&&e.success(t)}),this)})},loadFromUrl:function(t,e){var i=e||{};return this._fromUrlXHR&&this._fromUrlXHR.abort(),this._fromUrlXHR=r.a.ajax({type:"POST",data:{url:t,id:this.model.id,name:this.name,uploadType:"picture",mid:this.workspace.mag.get("num_id")},url:this.flagLambda()?this.LAMBDA_FROM_URL:this.SEARCH_URL,context:this,success:function(t){this.changePicture(t,i),i.success&&"function"==typeof i.success&&i.success()},error:function(t,e){if(i.error&&"function"==typeof i.error&&i.error(),!e||"abort"!==e)return t&&413===t.status?alert(ot.a.MSG_UPLOAD_IMAGE_SIZE_ERROR):void alert("There's something wrong with this picture. Please, try the different one.")}}),this._fromUrlXHR},isVector:function(t,e){var i=this.model.get("picture"),n=t||i&&i.url;return"svg"===(e||i&&i.type||this.tempPicture&&this.tempPicture.type)||n&&0===O.a.last(n.split(".")).indexOf("svg")},isAnimated:function(t){var e=this.model.get("picture");return"gif"===(t||e&&e.type||this.tempPicture&&this.tempPicture.type)},loadVector:function(t){if(t=t||{},this.svgAjax&&this.svgAjax.abort(),this.$svg&&this.$svg.remove(),delete this.$svg,delete this.$svgColoredElems,delete this.originalSvg,delete this.originalSize,this.isVector()){var e=this.getVectorUrl();e&&(this.svgAjax=r.a.get(e+"?c",O.a.bind((function(i){this.$svg=Object(r.a)(i).find("svg"),this.originalSize={width:this.$svg.attr("width"),height:this.$svg.attr("height")},this.$svg.removeAttr("width").removeAttr("height");var n=Object(r.a)(i).find("svg").get(0).cloneNode(!0),o=new Image;Object(r.a)(o).on("load error",O.a.bind((function(){Object(r.a)(o).appendTo(window.document.body).css({width:"100%",height:"100%"});var t=Object(r.a)(n);t.get(0).setAttribute("viewBox","0 0 "+Object(r.a)(o).width()+" "+Object(r.a)(o).height()),t.appendTo(window.document.body);var e=t.get(0).getBBox();this.$svg.get(0).setAttribute("viewBox",e.x+" "+e.y+" "+e.width+" "+e.height),this.$svg.get(0).setAttribute("preserveAspectRatio","xMidYMid meet"),Object(r.a)(o).remove(),t.remove()}),this)),o.src=this.getVectorUrl(),this.originalSvg=i,this.getVectorUrl()===e&&(t.success&&t.success(this.$svg),this.model.get("picture").editedVectorUrl||this.pickVectorColor(t))}),this)).always(O.a.bind((function(){delete this.svgAjax}),this)).fail(t.error||r.a.noop))}},pickVectorColor:function(t){if(this.$svg){var e=[],i=[],n=[],o=function(t,o){var a=e.indexOf(t);t&&/^#\w+$/.test(t)&&(-1==a?(e.push(t),i.push(1)):i[a]++),n.push(o)},a=Object(r.a)("<div></div>");this.$svg.find("*").each((function(){a.attr("style",Object(r.a)(this).attr("style"));var t=a.css("fill");return t?o(t,Object(r.a)(this)):Object(r.a)(this).attr("fill")?o(Object(r.a)(this).attr("fill"),Object(r.a)(this)):void 0}));var s=i.indexOf(O.a.max(i)),l=e[s];l&&/^#?\w\w\w$/.test(l)&&(l=[l[0],l[1],l[1],l[2],l[2],l[3],l[3]].join("")),l||(l="#ffffff"),l=l&&l.toLowerCase(),this.model.get("pic_color")||(l&&this.model.set({pic_color:l.substr(1),pic_opacity:1},{patch:!0,skipTriggerRedraw:!0}),this.changeControls&&this.changeControls()),l&&(this.$svgColoredElems=n)}},setVectorColor:function(t,e){if(this.$svgColoredElems){var i=Object(r.a)("<div></div>");O.a.each(this.$svgColoredElems,(function(t){i.attr("style",t.attr("style")),i.css({fill:"","fill-opacity":""}),t.get(0).setAttributeNS(null,"style",i.attr("style")),t.get(0).setAttributeNS(null,"fill",""),t.get(0).setAttributeNS(null,"fill-opacity","")})),delete this.$svgColoredElems}this.$svg.get(0).setAttributeNS(null,"fill","#"+t),this.$svg.get(0).setAttributeNS(null,"fill-opacity",e)},saveSvg:function(t){if(this.originalSvg&&this.originalSize){var e=this.originalSvg.importNode(this.$svg[0],!0);return Object(r.a)(e).attr("width",this.originalSize.width).attr("height",this.originalSize.height).css("display",""),r.a.ajax({url:this.SVG_URL,type:"POST",data:{svg:(new XMLSerializer).serializeToString(e),mid:this.workspace.mag.get("num_id")},success:function(e){this.model.get("picture").editedVectorUrl=e&&e.editedVectorUrl,delete this.model.get("picture").finalUrl,delete this.model.get("picture").final2xUrl,t&&t()},context:this})}}}),lt=i("0zSa"),ct=i("tf3M"),dt=i("WoDZ"),ht=rt.extend({name:"Background",thumb:"bg",outofbox:!0,excludedFromLib:!0,immortal:!0,controls:[],defaultSlideshow:{delay:4,crossfade:.5,pictures:[]},viewport_fields:g.b.viewport_fields.background,initialize:function(t,e){this.initBlock(t,e),void 0===this.model.get("mute")&&this.model.set("mute",!0,{silent:!0}),void 0===this.model.get("loop")&&this.model.set("loop",!0,{silent:!0}),this.createEl(),this.hide(),this.workspace.on("show",this.show),this.workspace.on("hide",this.hide),this.workspace.$el.parent().on("scroll",this.onScroll),this.on("loadimage",this.onLoadImage),this.on("unloadimage",this.onUnloadImage)},createEl:function(){this.setElement(Object(r.a)('<div class="background"><div class="picture smooth3d"></div>       <div class="slideshow-container"></div><div class="slideshow-preload"></div><div class="video">       <div class="overlay"></div>       <div class="container"></div>       </div></div></div>').appendTo(Object(r.a)("#main-background"))),this.$picture=this.$(".picture"),this.$video=this.$(".video"),this.$color=this.$el,this.$slideshow=this.$(".slideshow-container"),this.$slideshowPreload=this.$(".slideshow-preload"),this.video=new nt({block:this}),this.slideshowWidget=new lt.a({data:this.model.get("slideshow"),container:this.$slideshow,preloadContainer:this.$slideshowPreload})},validate:function(){var t=O.a.difference(g.b.viewport_fields.background,g.b.viewport_fields_common);this.model.fillMissingFieldsFromDefaultViewport(t)},render:function(){this.updateBGColor(),"picture"===this.model.get("selectedType")&&this.loadPic({success:this.showPic}),"video"===this.model.get("selectedType")&&(this.video.render(),this.onResize()),"slideshow"===this.model.get("selectedType")&&this.slideshowWidget.render(!0),this.rendered=!0,this.triggerReady()},updateBGColor:function(){var t=this.model.get("color")||"FFFFFF";this.$color.css({"background-color":"#"+t})},onViewportUpdate:function(t){"default"===t.viewport?(this.$el.removeClass("is-viewport"),this.$picture.css({width:"",height:"",top:"",left:"","margin-left":"","margin-top":""}),this.$slideshow.css({width:"",height:"",top:"",left:"","margin-left":"","margin-top":""})):(this.$el.addClass("is-viewport"),this.$picture.css({width:t.width,height:t.min_height,top:"50%",left:"50%","margin-left":-t.width/2,"margin-top":-t.min_height/2}),this.$slideshow.css({width:t.width,height:t.min_height,top:"50%",left:"50%","margin-left":-t.width/2,"margin-top":-t.min_height/2})),this.lastViewportParams=t},getPictureUrl:function(){var t=this.model.get("picture");return t?at.a.useLambdaUrl(t)?at.a.getLambdaUrl(t):t.finalUrl||t.unscaledOptimizedUrl||t.url:""},getThumbnailUrl:function(t){return t?at.a.useLambdaUrl(t)?at.a.getThumbnailUrl(t):t.thumbUrl:""},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.model.get("video"),i=this.model.get("selectedType"),n={background:"#".concat(this.model.get("color"))};if(t.small)return n;if("picture"===i){var o=this.model.get("picture"),a=this.getThumbnailUrl(o);if(a)return{"background-image":"url(".concat(a,")")}}else if("video"===i){if(e&&e.thumbnail_url)return{"background-image":"url(".concat(e.thumbnail_url,")")}}else if("slideshow"===i){var s=this.model.get("slideshow");if(s&&s.pictures&&Array.isArray(s.pictures)&&s.pictures.length){var r=this.getThumbnailUrl(O.a.sortBy(s.pictures,"num")[0]);return{"background-image":"url(".concat(r,")")}}}return n},changePicture:function(t,e){var i=this.workspace.page.getCurrentViewport();e=O.a.defaults(e||{},{save:!0});var n={picture:t.picture};"default"===i&&O.a.each(ct.default.viewports,function(t){O.a.isEmpty(this.model[t])||this.model.set({picture:n.picture},{viewport:t.replace(/^viewport_/,""),silent:!0})}.bind(this)),e.save?this.model.save(n,e):this.model.set(n,e)},onResize:function(){if("video"===this.model.get("selectedType")){var t=this.model.get("video"),e=this.$el.find(".container");!O.a.isEmpty(t)&&t.provider_name&&dt.a.setVideoPosition({$container:e,$media:e.find("iframe"),provider:t.provider_name,aspect_poster:t.aspect_poster,aspect_real:"vimeo"==t.provider_name.toLowerCase()?t.aspect_real:t.aspect_poster,controls_remove:!0})}},show:function(){var t=this.$el.parent();this.$el.detach().appendTo(t).stop().animate({opacity:1}),this.onResize(),Object(r.a)(window).on("resize",this.onResize)},hide:function(){this.$el.stop().animate({opacity:0}),"slideshow"===this.model.get("selectedType")&&this.slideshowWidget&&this.slideshowWidget.isAnimationRunning&&this.slideshowWidget.stopAnimationLoop(),Object(r.a)(window).off("resize",this.onResize)},saveSlideshowPicture:function(t,e){var i,n,o=this.workspace.page.getCurrentViewport(),a=this.model.get("slideshow"),s=a&&a.pictures&&Array.isArray(a.pictures)&&a.pictures.length,r=Object.assign({},t.picture,t.size),l=1;s?(n=O.a.cloneWithObjects(a),l=this.getMaxNum(a.pictures)+1,i=Object.assign(r,{num:l,uuid:v.default.generateUUID()}),n.pictures.push(i),n.pictures=O.a.sortBy(n.pictures,"num")):(n=O.a.cloneWithObjects(this.defaultSlideshow),i=Object.assign(r,{num:l,uuid:v.default.generateUUID()}),n.pictures=[i]);var c={slideshow:n};"default"==o&&O.a.each(ct.default.viewports,function(t){O.a.isEmpty(this.model[t])||this.model.set({slideshow:c.slideshow},{viewport:t.replace(/^viewport_/,""),silent:!0})}.bind(this)),e.save?this.model.save(c,e):this.model.set(c,e),this.addPictureToSlideshow(i)},updateSlideshowPicture:function(t,e){var i=this.model.get("slideshow"),n=i.pictures.findIndex((function(t){return t.uuid===e.id})),o=Object.assign({},i.pictures[n],t.picture,t.size),a=O.a.cloneWithObjects(i);a.pictures[n]=o;var s={slideshow:a};this.model.save(s,e),this.slideshowWidget.updatePicture(o)},selectSlideshowPicture:function(t){this.slideshowWidget.selectSlide(t)},deleteSlideshowPicture:function(t){this.slideshowWidget.removePicture(t)},updateSlideshowPicturePosition:function(t){this.slideshowWidget.updatePicturePosition(t)},getMaxNum:function(t){return O.a.isEmpty(t)?0:O.a.max(O.a.pluck(t,"num"))},addPictureToSlideshow:function(t){this.slideshowWidget.addPicture(t)},updateSideshowDelay:function(t){this.slideshowWidget.setDelay(t)},updateSideshowCrossfade:function(t){this.slideshowWidget.setCrossfade(t)},runSlideshow:function(){this.slideshowWidget&&this.slideshowWidget.runAnimation()},stopSlideshow:function(){this.slideshowWidget&&this.slideshowWidget.stopAnimationLoop()},loadPic:function(t){t=t||{},this.cancelPictureLoading(),t.url||(t.url=this.getPictureUrl()),this.picUrl=t.url;var e=O.a.isFunction(t.success)?t.success:r.a.noop,i=O.a.isFunction(t.error)?t.error:r.a.noop;if(!this.picUrl)return e();var n=this._loadingPic=Object(r.a)("<img>").addClass("preload_image").appendTo("body").attr("src",this.picUrl).on("load",e).on("error",i).on("load",O.a.bind((function(){this.trigger("loadimage","main"),O.a.defer(function(){n==this._loadingPic&&this.cancelPictureLoading(),n=null}.bind(this))}),this)).on("error",O.a.bind((function(){O.a.defer(function(){n==this._loadingPic&&this.cancelPictureLoading(),n=null}.bind(this))}),this))},cancelPictureLoading:function(){this._loadingPic&&this._loadingPic.off("load").off("error").removeAttr("src").remove(),this._loadingPic=void 0},previewPic:function(t,e){if(t&&"svg"===O.a.last(t.split(".")))return e&&e.error&&e.error();e=e||{},this.loadPic({url:t,error:e.error,success:O.a.bind((function(){this.renewPic(),O.a.isFunction(e.success)&&e.success()}),this)})},onLoadImage:function(t){"preview"==t&&(this.previewLoaded=!0),"main"==t&&(this.mainLoaded=!0),this.panel?this.previewLoaded&&this.mainLoaded&&this.trigger("imagesReady"):this.mainLoaded&&this.trigger("imagesReady")},onUnloadImage:function(t){"preview"==t&&(this.previewLoaded=!1),"main"==t&&(this.mainLoaded=!1)},showPic:function(){this.$picture.stop().animate({opacity:this.model.get("opacity")}),this.$picture.css({"background-image":this.picUrl?"url("+this.picUrl+")":""})},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&(O.a.isEmpty(t.changed)||(this.validate(),t.hasChanged("color")&&this.updateBGColor(),e.viewportChange&&!e.first&&"slideshow"===t.get("selectedType")&&this.slideshowWidget.rerender(t.get("slideshow")),t.hasChanged("picture")&&this.getPictureUrl()!=this.picUrl&&"picture"==t.get("selectedType")&&(this.getPictureUrl()?(this.trigger("unloadimage","main"),this.on("imagesReady",this.renewPic),this.loadPic()):this.loadPic({success:this.showPic})),t.hasChanged("opacity")&&this.$picture.css("opacity",this.model.get("opacity")),"video"===t.get("selectedType")&&(t.hasChanged("videoopacity")&&this.$video.css("opacity",this.model.get("videoopacity")),t.hasChanged("video")&&this.onResize()),t.hasChanged("selectedType")&&("picture"===this.model.get("selectedType")?this.loadPic({success:O.a.bind((function(){this.video.hide(),this.$slideshow.animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.showPic()}),this)}):"video"===this.model.get("selectedType")&&e.viewportChange&&!e.first?(this.$picture.stop().animate({opacity:0}),this.$slideshow.animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.video.show(),this.onResize()):"slideshow"===this.model.get("selectedType")?(this.$picture.stop().animate({opacity:0}),this.video.hide(),this.$slideshow.animate({opacity:1}),this.slideshowWidget.runAnimation()):(this.video.hide(),this.$picture.stop().animate({opacity:0}),this.slideshowWidget.stopAnimationLoop(),this.$slideshow.animate({opacity:0}),this.model.get("selectedType")||this.model.set("selectedType","color",{first:!0}))),this.workspace.trigger("redraw")))},renewPic:function(){if(this.off("imagesReady",this.renewPic),this.skipRenew)this.skipRenew=!1;else{var t=this.$el;this.createEl(),this.onViewportUpdate(this.lastViewportParams),this.updateBGColor(),this.$el.css({opacity:0}),this.$el.find(".picture").css({"background-image":this.picUrl?'url("'+this.picUrl+'")':"",opacity:this.model.get("opacity")});var e=this.workspace!=RM.constructorRouter.workspace?0:1;this.$el.animate({opacity:e},(function(){t.remove()}))}},removePicture:function(){this.model.set("picture",null),this.model.save({},{silent:!0,toHistory:!0}),this.$picture.stop().css("background-image","")},preload:function(){this.preloaded||(this.preloaded=!0,this.loadPic({success:O.a.bind((function(){"picture"===this.model.get("selectedType")&&O.a.delay(this.showPic,1e3)}),this)}))},onScroll:function(){if(!Modernizr.mac||!Modernizr.webkit)return!0;var t=this.$picture;t.removeClass("smooth3d"),clearTimeout(this._remove3dTimeout),this._remove3dTimeout=setTimeout((function(){t.addClass("smooth3d")}),1e3)},setTempPicture:function(t){t&&t.content&&this.loadPic({url:t.content,success:this.renewPic})}},{getViewportDefaults:function(t,e,i){var n=l.a.getViewportDefaults(t,e,i);return"video"===t.get("selectedType")&&(n=O.a.extend(n,{selectedType:"color"})),n},defaults:{slideshow:null}}),ut=i("rgKy"),pt=i.n(ut),gt=i("a/+O"),mt=i.n(gt),ft=i("TBxE");function vt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function bt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(i),!0).forEach((function(e){_t(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):vt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function _t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var yt=bt(bt({},mt.a),pt.a),wt=rt.extend({name:"Picture",sort_index:2,thumb:"picture",icon_color:"#009274",proportional:!0,dontSaveOnResize:!0,tempPicture:null,$preloader:null,initial_controls:["picture_settings","picture_fwpos","picture_crop","common_animation","picture_link","picture_preview","common_rotation","common_position","common_layer","picture_alt","common_lock"],animated_controls:["picture_settings","picture_fwpos","picture_link","picture_preview","common_animation","common_rotation","common_position","common_layer","picture_alt","common_lock"],vector_controls:["picture_settings","picture_color","picture_link","picture_preview","common_animation","common_rotation","common_position","common_layer","picture_alt","common_lock"],commonControls:["picture_preview"],commonControlsPositions:[4],viewport_fields:g.b.viewport_fields.picture,initialize:function(t,e){this.initBlock(t,e),this._imgsPreload=[],this._actualPreload=[],this.frameClass=kt,this._css=function(t){return parseInt(this.css(t),10)},this.setControls(),this.picloaded={},this.setScaledImage.__debounced=O.a.debounce(this.setScaledImage,500),this.setFinal.__debounced=O.a.debounce(this.setFinal,1e3),this.model.skipResponse=!0,this.listenTo(e,"workspace-resize",this.onWorkspaceResizePicture)},initVector:function(){this.setControls(),this.updateControls(),this.loadVector({setColor:!0})},updatePicture:function(t){var e,i=this.isFullWidth()||this.isFullHeight();if((t=t||{}).load||(t.load="finalUrl"),Modernizr.retina&&"finalUrl"===t.load&&(t.load="final2xUrl"),i&&(t.load="unscaledUrl"),!this.cropmode&&RM.constructorRouter.zoom.getZoom()>1&&(t.load="unscaledUrl"),(this.isVector()||this.isAnimated())&&(t.load="editedVectorUrl",this.model.get("picture")[t.load]||(t.load="url")),!this.flagLambda()&&this.model.get("picture")&&this.model.get("picture").lambdaUrl&&(t.load="unscaledUrl"),this.useLambdaUrl()&&(t.load="lambdaUrl"),this.cropmode||this.fakingMode||this.fwposmode||this.changeControls({viewportChange:t.viewportChange}),this.useLambdaUrl()?e=this.cropmode||this.in_constrained_crop_mode?this.getOriginalLambdaUrl():this.getLambdaUrl():(e=this.model.get("picture")&&this.model.get("picture")[t.load],i&&!e&&(e=this.model.get("picture")&&this.model.get("picture").url)),!e&&!this.model.get("picture"))return this.$picture&&this.$picture.remove(),this.model.get("hiddenBeforeUpload")?(this.$el.addClass("hidden"),this.model.unset("hiddenBeforeUpload",{skipHistory:!0,silent:!0})):this.$el.addClass("empty"),void this.has_parent_block;if(this.flagLambda()||e||(e=this.model.get("picture").url,t.renewRatio=!0),t.renewRatio)O.a.defer(function(){this.fixSize(t)}.bind(this));else{var n=this,o=this.$content;this.$el.removeClass("empty"),this.$el.removeClass("hidden"),t.skipAnimation&&o.children().remove(),this._preload(t.load,(function(i){if((n.isVector||!n.cropmode&&!n.in_constrained_crop_mode||"url"===t.load)&&!n.fakingMode&&(!n.useLambdaUrl()||e===n._actualPreload.lambdaUrl)&&(n.flagLambda()||e===(n.model.get("picture")&&n.model.get("picture")[t.load]))){var a=function(){n.$picture=i,t.complete&&t.complete.call(),i.css({opacity:1}),o.children().not(":last").remove(),n.updateSettings()};if(o.children().stop(!1,!0).css({opacity:1}),t.prepare&&t.prepare(i),n.$picture&&!t.skipAnimation&&i.css("opacity",0),n.isVector()){var s=document.importNode(i.get(0),!0),l=Object(r.a)('<div class="svg-scale-wrapper"></div>');l.append(s),o.append(l),n.$svg=Object(r.a)(s),i=n.$svg}else i.appendTo(o);at.a.flagLQIP()&&!this.cropmode&&o.css("border-radius",""),n.unsetTempPicture(),n.updateSettings(i),n.$picture&&!t.skipAnimation?i.animate({opacity:1},200,a):a(),n.hideIconLoader(),t.toggledHidden||n.cropmode||O.a.defer(O.a.bind((function(){RM.constructorRouter.workspace.hideLoader()}),n))}}))}},render:function(){this.create(),this.$el.addClass("picture"),this.proportional=!!this.getPictureUrl(),this.useLambdaUrl()&&at.a.flagLQIP()&&((this.model.get("border_radius")||this.model.get("border_radius_max")||this.model.get("border_radius_independent"))&&this.$content.css("border-radius",this.getBorderRadius()),Object(r.a)("<div/>").addClass("lqip").css({"background-image":"url(".concat(this.getLqipUrl(),")"),opacity:void 0===this.model.get("opacity")?1:this.model.get("opacity")}).appendTo(this.$content));var t=this.model.changed&&!1===this.model.changed.hidden;!this.has_parent_block&&this.updatePicture({isNew:this.model.created,isFirst:!0,toggledHidden:t,renewRatio:!this.model.get("ratio")}),this.preloadHiRes(),this.$el.off("dblclick"),this.$el.on("dblclick",this.onDblClick),this.triggerReady(),t||(this.frame.recalcPointsDirections(),this.updateSettings(),this.has_parent_block&&(this.init_file_uploading(),this.enter_constrained_crop_mode()))},init_file_uploading:function(){var t,e;this.has_parent_block?this.$upload_input=this.workspace.$picture_upload_input:(t=yt["template-constructor-helpers-upload-input"],this.$upload_input=Object(r.a)(t())),e=yt["template-constructor-helpers-upload-button"],this.$upload_button=Object(r.a)(e()),this.uploader=new ft.a(this,{fileInput:this.$upload_input}),this.bindUploader(this.uploader),this.$upload_button.on("click",function(){this.$upload_input.trigger("click","stop")}.bind(this)),this.model.on("change:picture",this.toggle_loaded),this.$upload_input.add(this.$upload_button).appendTo(this.$el)},bindUploader:function(t){t.on("start",this.on_start_upload),t.on("done",this.on_done_upload),t.on("fail",this.on_fail_upload)},on_start_upload:function(t,e){this.showIconLoader(),this.originalLoaded=!1,this.workspace.trigger("loading_original_picture")},on_done_upload:function(t,e){e&&e.result?this.changePicture(e.result,{toHistory:this.model.get("picture")}):console.error("error file upload!")},on_fail_upload:function(){this.hideIconLoader()},toggle_loaded:function(){this.model.get("picture")&&(this.isNew=!1),this.model.get("picture")&&(this.$upload_button.removeClass("uploading"),this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode())},getIconData:function(){return this.isVector()?this:null},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/";this.icon_color&&(e["background-color"]=this.icon_color);var n="";return this.model.get("picture")?(this.isVector()||(n=this.useLambdaUrl()?this.getThumbnailUrl():this.model.get("picture").thumbUrl,e["background-size"]="cover"),t.small||(e["border-radius"]="8px")):n=Object(X.findImagePath)(i+"picture.svg"),e["background-image"]="url(".concat(n,")"),e},controlsIconClasses:function(){return{"panel-picture-alt":this.model.get("alt")?"highlighted":null}},enterCropMode:function(){if(!this.cropmode&&this.model.get("picture"))if(this.$content.css({"border-radius":this.getBorderRadius()}),this.in_constrained_crop_mode){if(!this.originalLoaded)return;this._beforeCropAttrs=O.a.clone(this.model.attributes),this.cropmode=!0,this.disableDragging=!0,this.$el.addClass("crop"),p.a.setEmptyHandlers(),Object(r.a)("#main").css("overflow-y","hidden"),this._modeTransition=!1;var t=this.workspace.get_box_data();this.initialCrop={left:t.left_abs+parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale")),top:t.top_abs+parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale"))};var e=O.a.clone(this.$picture);e.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.frame.constraints={top:this.initialCrop.top,left:this.initialCrop.left,width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale"))},this.showBackPic(e),this.bindPictureDrag(),this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition)}else this.storeFixedPosition(),this._beforeCropAttrs=O.a.clone(this.model.attributes),this._getFinalRequest&&this._getFinalRequest.abort(),this.transitionMode(!0),this.frame.removeRotationState(),this.frame.resetRotation(),this.updatePicture({load:"url",prepare:O.a.bind((function(t){this.initialCrop={top:parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale")),left:parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale"))},t.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.showBackPic(t)}),this),complete:O.a.bind((function(){this.frame.enableMouseProceeding(),this.proportional=!1,this.isLocked()&&this.$el.removeClass("no-drag"),this.bindPictureDrag(),this.frame.setConstraints(this.$backpic),this.originalLoaded=!0,this._modeTransition=!1,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition)}),this)})},enter_constrained_crop_mode:function(){!this.in_constrained_crop_mode&&this.model.get("picture")&&(this.in_constrained_crop_mode=!0,this.proportional=!1,this.originalLoaded=!1,this.workspace.trigger("loading_original_picture"),this.$upload_button.addClass("uploading"),this.updatePicture({load:"url",skipAnimation:!0,prepare:function(t){var e=this.workspace.get_box_data();this.initialCrop={left:e.left_abs+parseInt(this.$el.css("left"))-Math.round(this.model.get("cropX")*this.model.get("scale")),top:e.top_abs+parseInt(this.$el.css("top"))-Math.round(this.model.get("cropY")*this.model.get("scale"))},t.css({width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale")),top:-Math.round(this.model.get("cropY")*this.model.get("scale")),left:-Math.round(this.model.get("cropX")*this.model.get("scale"))}),this.frame.constraints={top:this.initialCrop.top,left:this.initialCrop.left,width:Math.round(this.model.get("originalW")*this.model.get("scale")),height:Math.round(this.model.get("originalH")*this.model.get("scale"))}}.bind(this),complete:function(){this.originalLoaded=!0,this.workspace.trigger("loading_original_picture"),this.$upload_button.removeClass("uploading")}.bind(this)}))},leaveCropMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.noSave,i=t.viewportChange;if(this.hideBackPic(),this.cropmode&&this.model.get("picture"))if(this.$content.css({"border-radius":""}),this.in_constrained_crop_mode)this.leave_crop_mode_to_constrained_crop_mode(e);else{this.isLocked()&&this.$el.addClass("no-drag"),this.unbindPictureDrag(),this.disableDragging=!1,this.proportional=!0,this.frame.constraints=null,this.transitionMode(!1),this.frame.restoreRotation();var n={top:this.$picture.position().top,left:this.$picture.position().left,width:this.$picture.width(),height:this.$picture.height()};if(this.$picture.css({width:"100%",height:"100%",left:0,top:0,"background-size":n.width+"px "+n.height+"px","background-position":n.left+"px "+n.top+"px"}),this.restoreFixedPosition(!0),e)this.onLeavingCropMode();else{var o=this;if(this.ratio=this.model.get("cropW")/this.model.get("cropH"),O.a.isEqual(this._beforeCropAttrs,this.model.attributes))return void this.updatePicture({complete:O.a.bind((function(){this.onLeavingCropMode()}),this)});this.getFinalImage((function(){i&&o.useLambdaUrl()?o.onLeavingCropMode():o.updatePicture({complete:o.onLeavingCropMode})}))}}},leave_crop_mode_to_constrained_crop_mode:function(t){this.unbindPictureDrag(),this._modeTransition=!1,this.disableDragging=!0,this.cropmode=!1,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition),p.a.removeCustomHandlers(),Object(r.a)("#main").css("overflow-y","auto"),this.$el.removeClass("crop"),this.hideBackPic(),t||(this.ratio=this.model.get("cropW")/this.model.get("cropH"),this.isAnimated()||this.useLambdaUrl()?this.model.save({},{silent:!0,skipHistory:!0}):this.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,skipHistory:!0}))},onLeavingCropMode:function(){this.$picture.css({width:"100%",height:"100%",left:0,top:0}),this._modeTransition=!1,this._waitingForRescale&&(this._waitingForRescale=!1,this.setScaledImage())},onLeavingCropResize:function(t){if(!this.cropmode){var e=t.width/this.model.get("cropW");this.$picture.css({left:-this.model.get("cropX")*e,top:-this.model.get("cropY")*e,width:this.model.get("originalW")*e,height:this.model.get("originalH")*e})}},toggleCropMode:function(){this.isVector()||this.trigger("crop_click")},toggleFWPosMode:function(){this.isVector()||this.trigger("fwpos_click")},onDblClick:function(){var t=this.model.get("is_full_width")||this.model.get("is_full_height");t?this.toggleFWPosMode():this.toggleCropMode(),l.a.prototype.onDblClick.apply(this,arguments)},enterFWPosMode:function(){!this.fwposmode&&this.model.get("picture")&&(this.disableDragging=!0,this.fwposmode=!0,this.$el.addClass("fwpos"),this.$el.on("dragend",this.dragFWPosPictureStop),this.$el.on("dragstart",this.dragFWPosPictureStart),this.$el.on("drag",this.dragFWPosPicture))},leaveFWPosMode:function(){this.fwposmode&&this.model.get("picture")&&(this.disableDragging=!1,this.fwposmode=!1,this.$el.removeClass("fwpos"),this.$el.off("dragend",this.dragFWPosPictureStop),this.$el.off("dragstart",this.dragFWPosPictureStart),this.$el.off("drag",this.dragFWPosPicture))},dragFWPosPictureStart:function(t,e){var i=this.model.get("is_full_height"),n=this.model.get("is_full_width");this.frame.disableMouseProceeding(),this.$el.addClass("grabbing"),n&&(e.prev_offsetY=e.offsetY),i&&(e.prev_offsetX=e.offsetX)},dragFWPosPicture:function(t,e){var i=this.model.get("is_full_height"),n=this.model.get("is_full_width"),o=this.model.get("fwpos"),a=this.model.get("fhpos");n&&void 0===e.prev_offsetY&&this.dragFWPosPictureStart(t,e),i&&void 0===e.prev_offsetX&&this.dragFWPosPictureStart(t,e),n&&(o=null==o?50:o,o-=(e.offsetY-e.prev_offsetY)/5,o=Math.min(Math.max(o,0),100),this.model.set({fwpos:o}),e.prev_offsetY=e.offsetY,e.last_fwpos=o),i&&(a=null==a?50:a,a-=(e.offsetX-e.prev_offsetX)/5,a=Math.min(Math.max(a,0),100),this.model.set({fhpos:a}),e.prev_offsetX=e.offsetX,e.last_fhpos=a)},dragFWPosPictureStop:function(t,e){var i=this.model.get("is_full_height"),n=this.model.get("is_full_width");this.frame.enableMouseProceeding(),n&&null!=e.last_fwpos&&this.model.save({fwpos:e.last_fwpos}),i&&null!=e.last_fhpos&&this.model.save({fhpos:e.last_fhpos}),this.$el.removeClass("grabbing")},transitionMode:function(t){this._modeTransition=!0,this.disableDragging=t,this.cropmode=t,this.trigger("modechanged transitionmode",this.cropmode,this._modeTransition),t?(this._scaledimageXHR&&this._scaledimageXHR.abort(),this.frame.disableMouseProceeding(),this.$el.addClass("crop"),this.model.off("change",this.onModelChange),p.a.setEmptyHandlers(),Object(r.a)("#main").css("overflow-y","hidden")):(this.$el.removeClass("crop"),this.model.on("change",this.onModelChange),p.a.removeCustomHandlers(),Object(r.a)("#main").css("overflow-y","auto"))},onCropResize:function(t){if((this.cropmode||this.in_constrained_crop_mode)&&!this._modeTransition){var e,i=this.initialCrop;if(this.in_constrained_crop_mode){var n=this.workspace.get_box_data();e={left:n.left_abs+t.left-i.left,top:n.top_abs+t.top-i.top}}else e={left:t.left-i.left,top:t.top-i.top};this.$picture.css({left:-e.left,top:-e.top});var o=this.model.get("scale"),a=function(t){return t/o},s=Math.max(0,Math.round(a(e.left))),r=Math.max(0,Math.round(a(e.top))),l=this.fixCropDimensions(s,Math.round(a(t.width)),this.model.get("originalW")),c=this.fixCropDimensions(r,Math.round(a(t.height)),this.model.get("originalH"));this.model.set({cropX:s,cropY:r,cropW:l,cropH:c,ratio:(t.width/t.height).toFixed(5)})}},showBackPic:function(t){this.hideBackPic(),t=t||this.$picture,this.$backpic=t.clone().css({position:"absolute",opacity:.5,"z-index":(this.$content.css("z-index")||this.model.get("z"))-1}).css(this.initialCrop).addClass("backpic").hide().appendTo(this.$el.closest(".workspace")).fadeIn(200),this.$backpic.on("dblclick",this.toggleCropMode)},hideBackPic:function(){this.$el.closest(".workspace").find(".backpic").animate({opacity:0},200,(function(){Object(r.a)(this).remove()}))},bindPictureDrag:function(){this.$el.add(this.$backpic).on("dragend",this.dragCropPictureStop),this.$el.add(this.$backpic).on("dragstart",this.dragCropPictureStart),this.$el.add(this.$backpic).on("drag",this.dragCropPicture)},unbindPictureDrag:function(){this.$el.add(this.$backpic).off("dragend",this.dragCropPictureStop),this.$el.add(this.$backpic).off("dragstart",this.dragCropPictureStart),this.$el.add(this.$backpic).off("drag",this.dragCropPicture)},dragCropPictureStart:function(t,e){var i=O.a.bind(this._css,this.$el),n=O.a.bind(this._css,this.$backpic);if(e.offset={back:{top:n("top"),left:n("left"),width:n("width"),height:n("height")},el:{top:i("top"),left:i("left"),width:i("width"),height:i("height")}},this.has_parent_block){var o=this.workspace.get_box_data();e.offset.el.top+=o.top_abs,e.offset.el.left+=o.left_abs}this.frame.disableMouseProceeding(),this.$el.add(this.$backpic).addClass("grabbing")},dragCropPicture:function(t,e){e.offset||this.dragCropPictureStart(t,e);var i={top:e.offset.back.top+e.deltaY,left:e.offset.back.left+e.deltaX};i.top>e.offset.el.top&&(i.top=e.offset.el.top),i.left>e.offset.el.left&&(i.left=e.offset.el.left),i.left+e.offset.back.width<e.offset.el.left+e.offset.el.width&&(i.left=e.offset.el.left+e.offset.el.width-e.offset.back.width),i.top+e.offset.back.height<e.offset.el.top+e.offset.el.height&&(i.top=e.offset.el.top+e.offset.el.height-e.offset.back.height),this.$backpic.css({top:i.top,left:i.left}),this.$picture.css({top:i.top-e.offset.el.top,left:i.left-e.offset.el.left})},dragCropPictureStop:function(t,e){this.initialCrop={top:parseInt(this.$backpic.css("top")),left:parseInt(this.$backpic.css("left"))},this.frame.enableMouseProceeding(),this.frame.setConstraints(this.$backpic);var i=O.a.bind(this._css,this.$picture),n=parseFloat(this.model.get("scale"),10),o=Math.max(0,Math.round(-i("left")/n)),a=Math.max(0,Math.round(-i("top")/n)),s=this.fixCropDimensions(o,this.model.get("cropW"),this.model.get("originalW")),r=this.fixCropDimensions(a,this.model.get("cropH"),this.model.get("originalH"));this.model.set({cropX:o,cropY:a,cropW:s,cropH:r}),this.$el.add(this.$backpic).removeClass("grabbing")},fixCropDimensions:function(t,e,i){var n=t+e-i;return n>0?e-n:e},setActualScale:function(t){this.storeFixedPosition();var e=(t=t||{}).retina?2:1;this._preload("url",O.a.bind((function(t){var i={picture:this.model.get("picture")},n={x:parseInt(this.$el.css("left"))+this.model.get("w")/2-this.model.get("originalW")/2/e,y:parseInt(this.$el.css("top"))+this.model.get("h")/2-this.model.get("originalH")/2/e,w:this.model.get("originalW")/e,h:this.model.get("originalH")/e},o=0,a=0;i.picture.finalUrl=this.model.get("picture").url,i.picture.final2xUrl=i.picture.finalUrl,i.picture.unscaledUrl=i.picture.finalUrl;var s={};s.w=this.model.get("originalW"),s.h=this.model.get("originalH");var r=this.$picture.parent();this.updateSettings(t),t.css({opacity:0}).appendTo(r).animate({opacity:1},200,O.a.bind((function(){this.$picture=t,r.children().not(":last").remove(),this.updateSettings()}),this)),this.$el.animate({top:n.y,left:n.x,width:n.w,height:n.h},O.a.bind((function(){this.model.set(O.a.extend({cropX:o,cropY:a,cropW:n.w*e,cropH:n.h*e,scale:1/e,ratio:n.w/n.h},n,i)),this.restoreFixedPosition(),this.model.save()}),this))}),this))},rescale:function(t,e){e=e||{};var i=O.a.bind(this._css,this.$el),n=e.smooth?"animate":"css",o=this.model.get("originalW")*t,a=this.model.get("originalH")*t;o<i("width")&&(t=(o=i("width"))/this.model.get("originalW"),a=this.model.get("originalH")*t),a<i("height")&&(t=(a=i("height"))/this.model.get("originalH"),o=this.model.get("originalW")*t);var s,r,l=i("width")/2,c=i("height")/2,d=this.model.get("scale"),h=(this.model.get("cropX")*d+l)*t/d-l,u=(this.model.get("cropY")*d+c)*t/d-c;if(h+2*l>o&&(h=o-2*l),h<0&&(h=0),u+2*c>a&&(u=a-2*c),u<0&&(u=0),this.in_constrained_crop_mode){var p=this.workspace.get_box_data();s=p.left_abs+i("left")-h,r=p.top_abs+i("top")-u}else s=i("left")-h,r=i("top")-u;this.$backpic[n]({left:s,top:r,width:o,height:a}),this.initialCrop={left:s,top:r},this.$picture[n]({left:-h,top:-u,width:o,height:a});var g=Math.max(0,Math.round(h/t)),m=Math.max(0,Math.round(u/t)),f=this.fixCropDimensions(g,Math.round(this.model.get("w")/t),this.model.get("originalW")),v=this.fixCropDimensions(m,Math.round(this.model.get("h")/t),this.model.get("originalH"));this.model.set({scale:t,cropX:g,cropY:m,cropW:f,cropH:v},e),this.frame.setConstraints(this.$backpic)},fill:function(){if(this.cropmode&&!this._modeTransition){var t=parseInt(this.$el.css("left")),e=parseInt(this.$el.css("top")),i=parseInt(this.$el.height()),n=parseInt(this.$el.width()),o={},a=null,s={},r=this.model.get("originalW")/this.model.get("originalH");this.model.get("ratio")>r?(a=n/this.model.get("originalW"),o={cropX:0,cropY:Math.round((this.model.get("originalH")-i/a)/2),cropW:this.model.get("originalW"),cropH:Math.round(i/a)},s={width:n,height:Math.round(n/r),top:-Math.round(o.cropY*a),left:0}):(a=i/this.model.get("originalH"),o={cropX:Math.round((this.model.get("originalW")-n/a)/2),cropY:0,cropW:Math.round(n/a),cropH:this.model.get("originalH")},s={width:Math.round(i*r),height:i,top:0,left:-Math.round(o.cropX*a)}),this.model.set(O.a.extend({x:t,y:e,w:n,h:i,scale:a},o)),this.redrawPosition(this.model,{forceRedraw:!1}),this.$picture.animate(s),this.$backpic.animate({width:s.width,height:s.height,top:e+s.top,left:t+s.left},O.a.bind((function(){var t=O.a.bind(this._css,this.$backpic);this.initialCrop={top:t("top"),left:t("left")},this.frame.setConstraints(this.$backpic)}),this))}},fit:function(){if(this.cropmode&&!this._modeTransition){var t=parseInt(this.$el.css("left")),e=parseInt(this.$el.css("top")),i=parseInt(this.$el.height()),n=parseInt(this.$el.width()),o={cropX:0,cropY:0,cropW:this.model.get("originalW"),cropH:this.model.get("originalH")},a={left:t,top:e,width:n,height:i},s=null,r={},l=this.model.get("originalW")/this.model.get("originalH");this.model.get("ratio")<l?(s=n/this.model.get("originalW"),r={width:n,height:Math.round(n/l),top:Math.round((i-n/l)/2),left:0},a.top=e+r.top,a.height=r.height):(s=i/this.model.get("originalH"),r={width:Math.round(i*l),height:i,top:0,left:Math.round((n-i*l)/2)},a.left=t+r.left,a.width=r.width),this.$picture.animate(r),this.$backpic.animate({width:r.width,height:r.height,top:e+r.top,left:t+r.left},O.a.bind((function(){var t=O.a.bind(this._css,this.$backpic);this.initialCrop={top:t("top"),left:t("left")},this.$el.css(a),this.$picture.css({top:0,left:0}),this.model.set(O.a.extend({x:a.left,y:a.top,w:a.width,h:a.height,ratio:l,scale:s},o)),this.frame.setConstraints(this.$backpic)}),this))}},setControls:function(){this.isVector()?this.controls=this.vector_controls:this.isAnimated()?this.controls=this.animated_controls:this.controls=this.initial_controls},changePicWithoutRescale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.flagLambda()||this.isVector(t.picture.url,t.picture.type)||(t.picture.unscaledUrl=t.picture.coalesceUrl||t.picture.url);var i={originalW:t.size.width,originalH:t.size.height};if(t.picture&&(i.picture=t.picture),this.model.set(i,{silent:!0}),this.trigger("picture_added"),e.first=!0,this.fixSize(e),O.a.each(g.b.viewport_list,(function(t){O.a.isEmpty(this.model.get(t))&&O.a.isEmpty(this.model[t])||this.model.set(i,{viewport:t.split("viewport_")[1],silent:!0})}),this),this.has_parent_block){this.model.save();var n={};n.tip_w=this.workspace.block.model.get("tip_w"),n.tip_h=this.workspace.block.model.get("tip_h"),this.workspace.block.model.save(n,{patch:!0,skipHistory:!0}),this.workspace.blocks.forEach((function(t){t.saveBox({patch:!0,skipHistory:!0})}))}},setTempPicture:function(t){this.$el.removeClass("hidden");var e=this.$el.find(".content");if(t&&t.content&&e){this.$el.removeClass("empty"),this.proportional=!0,this.tempPicture={$el:Object(r.a)("<div>").css({"background-image":'url("'.concat(t.content,'")'),"background-position":"50% 50%"}).appendTo(e),type:t.ext},this.model.get("picture")&&(e.children().not(":last").remove(),this.$picture&&this.$picture.remove(),this.$picture=null,this.model.unset("picture",{skipHistory:!0,silent:!0}));var i={size:{width:t.width,height:t.height}};this.changePicWithoutRescale(i),this.showTempPreloader(),this.changeControls()}},unsetTempPicture:function(){this.tempPicture&&this.tempPicture.$el&&this.tempPicture.$el.remove(),this.tempPicture=null},removeTempPicture:function(){this.unsetTempPicture(),this.$picture&&this.$picture.remove(),this.$content.children().remove(),this.$el.addClass("empty"),this.$el.removeClass("hidden"),this.hideTempPreloader(),this.removePicture(),this.changeControls()},showTempPreloader:function(){this.$preloader||(this.$preloader=Object(r.a)("<div/>",{class:"rmpreloader",html:Object(r.a)("<div/>",{class:"arc"})}),this.$el.addClass("preloader"),this.$preloader.appendTo(this.$el))},hideTempPreloader:function(){this.$preloader&&!this.preloaderTimeout&&(this.$el.removeClass("preloader"),this.$preloader.css("opacity",0),this.preloaderTimeout=setTimeout(function(){this.$preloader.remove(),this.$preloader=null,this.preloaderTimeout=null}.bind(this),200))},changePicture:function(t,e){var i=this.model.attributes,n=this.model.getViewport(),o=this.isFullWidth(),a=this.isFullHeight();if(e=O.a.extend(e||{},{isNew:!0}),this.flagLambda()&&t.picture&&this.hideTempPreloader(),!i.picture&&!i.scale||!this.has_parent_block&&"gif"===t.picture.type)return this.changePicWithoutRescale(t,e);var s=this,r=function(e){var i,n,r;return e.ratio=e.ratio||e.w/e.h,o?(i=e.full_width_initial_w,n=e.full_width_initial_w/e.ratio):a?(n=e.full_height_initial_h,i=e.full_height_initial_h*e.ratio):(i=e.w,n=e.h),r={originalW:t.size.width,originalH:t.size.height,w:i,h:n,ratio:e.ratio,x:e.x,y:e.y},t.size.width/t.size.height>parseFloat(e.ratio)?(r.scale=r.h/r.originalH,r.cropY=0,r.cropH=r.originalH,r.cropX=Math.max(0,(r.originalW-r.w/r.scale)/2),r.cropW=r.w/r.scale):t.size.width/t.size.height<parseFloat(e.ratio)?(r.scale=r.w/r.originalW,r.cropX=0,r.cropY=Math.max(0,(r.originalH-r.h/r.scale)/2),r.cropW=r.originalW,r.cropH=r.h/r.scale):(r.scale=r.w/r.originalW,r.cropX=0,r.cropY=0,r.cropW=r.originalW,r.cropH=r.originalH),r.picture=O.a.clone(t.picture),s.isVector(t.picture.url,t.picture.type)||(r.picture.unscaledUrl=t.picture.coalesceUrl||t.picture.url),r},l=r(i);if(this.model.set(l,{silent:!0,toHistory:e.toHistory}),this.isVector(l.picture.url,l.picture.type))return this.model.set({pic_color:"",pic_opacity:1},{silent:!0}),this.fixSize();this.isAnimated()?(this.model.save({},e),this.model.trigger("change:picture")):(e.viewport=n,this.getFinalImage(O.a.bind((function(){this.updatePicture.apply(this,arguments);var t=[],e=!1,i=this.model,o=function(o){(t[o]=!0,O.a.all(t)&&e)&&(i.save({},{skipHistory:!0,first:!0}),this.model.getViewport()!==n&&this.updatePicture())}.bind(this),a=O.a.without(O.a.union(ct.default.viewports,["viewport_default"]),"viewport_"+this.model.getViewport());O.a.each(a,(function(e,i){return t[i]=!1})),O.a.each(a,(function(i,n){if(t[n]=!1,O.a.isEmpty(this.model[i]))return o(n);var a=r(O.a.extend({},this.model.attributes,this.model[i]));this.useLambdaUrl()?(this.model.set(a,{viewport:i.split("viewport_")[1],silent:!0}),e=!0,o(n)):this.requestFinalImage(O.a.extend({},this.model.attributes,a),O.a.bind((function(t){O.a.extend(a.picture,t),this.model.set(a,{viewport:i.split("viewport_")[1],silent:!0}),e=!0,o(n)}),this))}),this)}),this),e))},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){this.proportional=!!this.getPictureUrl()||this.tempPicture;var i=t.hasChanged("is_full_width")&&t.get("is_full_width")&&!e.viewportChange,n=t.hasChanged("is_full_width")&&!t.get("is_full_width")&&!e.viewportChange,o=t.hasChanged("is_full_height")&&t.get("is_full_height")&&!e.viewportChange,a=t.hasChanged("is_full_height")&&!t.get("is_full_height")&&!e.viewportChange,s=function(){n&&this.model.set({h:this.model.get("w")/this.model.get("ratio")},{silent:!!i}),a&&this.model.set({w:this.model.get("h")*this.model.get("ratio")},{silent:!!o})}.bind(this);this.isDragging||this.isScaling||(this.redrawPosition(t,O.a.extend(e,{forceRedraw:!1})),(i||n||o||a)&&(s(),this.updatePicture(),this.changeControls()),(n||a)&&this.setScaledImage(null,{skipHistory:!0})),t.hasChanged("picture")||t.hasChanged("cropX")||t.hasChanged("cropY")||t.hasChanged("cropW")||t.hasChanged("cropH")?e.undo||e.redo?this.onHistoryPictureChange(t,e):e.viewportChange||e.socketUpdate?(this.hideBackPic(),this.updatePicture({skipAnimation:!0,viewportChange:!0})):(this.onPictureChange(t,e),this.isVector()&&this.initVector()):this.has_parent_block&&(e.undo||e.redo)?(this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode()):e.viewportChange&&this.useLambdaUrl()&&this.updatePicture({skipAnimation:!0,viewportChange:!0}),this.ratio=t.get("ratio")}},redrawPosition:function(t,e){t=t||this.model,rt.prototype.redrawPosition.apply(this,arguments),(t.hasChanged("border_size")||t.hasChanged("border_color")||t.hasChanged("border_radius")||t.hasChanged("border_radius_max")||t.hasChanged("border_radius_tl")||t.hasChanged("border_radius_tr")||t.hasChanged("border_radius_bl")||t.hasChanged("border_radius_br")||t.hasChanged("border_radius_independent")||t.hasChanged("opacity")||t.hasChanged("fwpos")||t.hasChanged("fhpos"))&&this.updateSettings()},setPreviewImage:function(t,e){var i=(e=e||{}).success||r.a.noop,n=e.error||r.a.noop,o=this;if(this.previewUrl=t,this._loadingPic&&this._loadingPic.off("load").off("error").removeAttr("src").remove(),this._loadingPic=void 0,!t)return this.$preview&&this.$preview.detach(),void i();this._loadingPic=Object(r.a)("<img>").addClass("preload_image").appendTo("body").attr("src",t).on("load",(function(){o.previewUrl===t&&(o.$preview||(o.$preview=Object(r.a)("<div>")),o.$preview.css({"background-image":'url("'+t+'")',"background-size":"cover","background-position":"50% 50%"}).appendTo(o.$el.find(".content"))),i(),Object(r.a)(this).remove()})).on("error",(function(){n(),Object(r.a)(this).remove()}))},getBorderRadius:function(){return this.model.get("border_radius_independent")?"".concat(this.model.get("border_radius_tl")||0,"px ").concat(this.model.get("border_radius_tr")||0,"px ").concat(this.model.get("border_radius_bl")||0,"px ").concat(this.model.get("border_radius_br")||0,"px"):"".concat(this.model.get("border_radius_max")?"9999":this.model.get("border_radius")||0,"px")},updateSettings:function(t){if(t=t||this.$picture){var e=this.model,i=e.get("fwpos"),n=e.get("fhpos");i=void 0===i?50:i,n=void 0===n?50:n,this.isVector()?(t.css({"box-shadow":"none","border-radius":"0"}),this.$content.css("opacity",1)):(t.css({"box-shadow":e.get("border_size")>0?"inset 0 0 0 "+e.get("border_size")+"px #"+(e.get("border_color")||"000000"):"none","border-radius":this.getBorderRadius(),"background-position":n+"% "+i+"%","-webkit-mask-image":e.get("border_size")>0?"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)":""}),this.$content.css("opacity",void 0===e.get("opacity")?1:e.get("opacity")))}},onPictureChange:function(t,e){var i=this.model.previous("picture"),n=this.model.get("picture"),o=e&&e.isNew;(n&&i&&n.url!=i.url||o)&&this.model.set({pic_color:"",pic_opacity:1},{silent:!0})},onHistoryPictureChange:function(t,e){var i={},n=this.model.previous("picture"),o=this.model.get("picture");if(!o)return this.updatePicture();!n&&o&&this.trigger("picture_added"),this._modeTransition&&!this.cropmode&&(i.complete=this.onLeavingCropMode),this.has_parent_block?(this.in_constrained_crop_mode=!1,this.enter_constrained_crop_mode()):this.updatePicture(i)},setFinal:function(){this.fakingMode=!1,this.getFinalImage(this.updatePicture,{silent:!0})},changeControls:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewportChange;this.setControls(),this.updateControls({noSelect:e||this._deselectOnViewportChange}),this._deselectOnViewportChange=!1},preloadHiRes:function(){this.isVector()||this.flagLambda()||(this._preload("unscaledUrl"),this._preload("url"))},_preload:function(t,e){var i=this.model.get("picture");if(i){var n,o=this;if(!(n=this.useLambdaUrl()?o.cropmode||o.in_constrained_crop_mode?this.getOriginalLambdaUrl():this.getLambdaUrl():i[t]))return e&&e.apply(this);if(this.isVector())return this.loadVector({success:e});this._actualPreload[t]=n,this._imgsPreload[t]=Object(r.a)(new Image).attr({src:n}).one("load",(function(){if(o._imgsPreload[t]=!1,e){var i=Object(r.a)("<div/>").css("background-image","url("+n+")");if(!o.rendered)return;e.apply(o,[i,n])}Object(r.a)(this).remove()}))}},onResizeStart:function(t,e){this.cropmode||this.isVector()||(this._scaledimageXHR&&this._scaledimageXHR.abort(),this._modeTransition||(this._getFinalRequest&&this._getFinalRequest.abort(),!this.useLambdaUrl()&&!this.tempPicture&&this.updatePicture({load:"unscaledUrl"})),this.isScaling=!0)},onResizeEnd:function(t,e,i){this.isScaling=!1;var n=O.a.extend({scale:1},this.getBoxData());if(this.model.set(n,i),!this.getPictureUrl()||this.isVector())return this.saveBox();this.cropmode||(this._modeTransition?this._waitingForRescale=!0:this.setScaledImage(null,O.a.omit(i,"skipPersist")))},restoreFixedPosition:function(t){!t&&this.cropmode||rt.prototype.restoreFixedPosition.apply(this,arguments)},getBoxData:function(){var t=rt.prototype.getBoxData.apply(this,arguments);return this.model.get("cropW")?t.scale=(t.w/this.model.get("cropW")).toFixed(15):void 0!==t.scale&&(t.scale=1..toFixed(15)),t},setScaledImage:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=O.a.clone(this.model.attributes),n=function(t){if("default"!==this.model.getViewport()&&O.a.isEmpty(this.model.viewport_default.picture)){var e=O.a.cloneWithObjects(O.a.extend({},this.model.attributes,{picture:t}));e.hidden=this.model.viewport_default.hidden,this.model.storeViewport("default",e)}}.bind(this);if((this.flagLambda()||this.model.get("picture")&&this.model.get("picture").url)&&(!this.tempPicture||this.model.get("picture"))){if(e.viewport=this.model.getViewport(),this.isVector()||this.isAnimated()||this.useLambdaUrl())return n(i.picture),this.model.save("picture",i.picture,e),this.updatePicture({complete:t});var o=this.model.get("w");this.showTempPreloader(),this._scaledimageXHR=r.a.ajax({type:"POST",data:i,url:this.RESCALE_URL,success:O.a.bind((function(i){if(this.hideTempPreloader(),o==this.model.get("w")){var a=O.a.extend({},this.model.get("picture"),i);a.url&&(n(a),this.model.save("picture",a,e),this.updatePicture({complete:t}))}}),this)})}},fixSize:function(t){if(this.model.get("originalW")){var e=parseInt(this.model.get("originalW"),10),i=parseInt(this.model.get("originalH"),10),n=this.model.get("w"),o=this.model.get("h"),a=n/e,s=o/i,r=n,l=o,c={x:this.model.get("x"),y:this.model.get("y")};this.has_parent_block?l=i*a:this.isVector()&&this.isFullWidth()?r=this.getFullWidthDims().w:this.isVector()&&this.isFullHeight()?l=this.getFullHeightDims().h:Math.abs(1-a)<.05&&Math.abs(1-s)<.05||a>1.05&&s>1.05?(r=e,l=i,c.x+=n/2-e/2,c.y+=o/2-i/2):a>s?(r=e*s,c.x+=n/2-r/2):(l=i*a,c.y+=o/2-l/2),this.model.set({w:r,h:l,x:c.x,y:c.y,ratio:e/i,scale:r/e,cropX:0,cropY:0,cropW:e,cropH:i},{first:t&&t.first}),this.setScaledImage(O.a.bind((function(){this.isVector()&&this.fixVectorScale()}),this),t),this.model.created=!1}},fixVectorScale:function(){var t,e=this.$svg.get(0).getBBox(),i=this.getBoxData(),n=e.width/e.height,o=i.w/i.h;Math.abs(n-o)<.05||(t=this.isFullWidth()?{h:i.w/n,originalW:this.model.get("full_width_initial_w"),originalH:this.model.get("full_width_initial_w")/n}:n>1?{h:i.h/n,originalH:i.h/n,ratio:n}:{w:i.w*n,originalW:i.w*n,ratio:n},this.model.save(t,{skipHistory:!0}))},showIconLoader:function(){this.has_parent_block?this.$upload_button.addClass("uploading"):l.a.prototype.showIconLoader.apply(this,arguments),this.showTempPreloader()},hideIconLoader:function(){this.has_parent_block?this.$upload_button.removeClass("uploading"):l.a.prototype.hideIconLoader.apply(this,arguments),this.hideTempPreloader()},deselect:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.deselectOnViewportChange&&(this._deselectOnViewportChange=!0),l.a.prototype.deselect.apply(this,arguments),this.leaveCropMode({viewportChange:this._deselectOnViewportChange}),this.leaveFWPosMode()},onWorkspaceBlocksSelect:function(t){l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments);var e=t&&1==t.length&&t[0]==this;e||(this.leaveCropMode(),this.leaveFWPosMode())},onWorkspaceResizePicture:function(){var t=this;RM.constructorRouter.zoom.getZoom()>1&&!this.tempPicture&&!this.originalLoaded&&this.updatePicture({load:"unscaledUrl",complete:function(){return t.originalLoaded=!0}})},isPictureEmpty:function(){return O.a.isEmpty(this.model.get("picture"))&&!this.tempPicture},destroy:function(){this.uploader&&this.uploader.destroy(),this.leaveCropMode(),this.leaveFWPosMode(),l.a.prototype.destroy.apply(this,arguments),this.hideIconLoader(),this.model.off("change:picture",this.toggle_loaded),this.$upload_button&&this.$upload_button.off("click"),this.off(),this.$el.off()}}),kt=b.a.extend({maxwidth:9999,maxheight:9999,onResize:function(t,e){var i=b.a.prototype.onResize.apply(this,arguments);this.block.cropmode?this.block.onCropResize(i):this.block._modeTransition&&this.block.onLeavingCropResize(i)},setConstraints:function(t){this.constraints={top:parseInt(t.css("top")),left:parseInt(t.css("left")),width:parseInt(t.css("width")),height:parseInt(t.css("height"))}}}),St=wt,xt=i("tcpm"),Ct=i("rDYU"),Ot=i.n(Ct);function Pt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var jt={rasterize:function(t){var e;if(t&&t.widgets&&t.mid&&t.svg&&t.viewport&&t.size&&t.size.height&&t.size.width){var i,n=document.importNode(t.svg[0],!0),o=(new XMLSerializer).serializeToString(n),a="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(o))),s=(Pt(e={},t.prefix?t.prefix+"_rasterUrl":"rasterUrl",a),Pt(e,t.prefix?t.prefix+"_raster2xUrl":"raster2xUrl",a),Pt(e,t.prefix?t.prefix+"_raster3xUrl":"raster3xUrl",a),e);t.activeArrow?("left_arrow_noun"===t.activeArrow&&t.widgets.forEach((function(t){i=t.get("theme_data"),t.unset("left_arrow_noun",{skipHistory:!0,silent:!0,patch:!0}),t.save({theme_data:O.a.extend(i,{left_icon_noun:O.a.extend(i.left_icon_noun,s)})},{skipHistory:!0,silent:!0,patch:!0})})),"right_arrow_noun"===t.activeArrow&&t.widgets.forEach((function(t){i=t.get("theme_data"),t.unset("right_arrow_noun",{skipHistory:!0,silent:!0,patch:!0}),t.save({theme_data:O.a.extend(i,{right_icon_noun:O.a.extend(i.right_icon_noun,s)})},{skipHistory:!0,silent:!0,patch:!0})}))):t.widgets.forEach((function(t){t.save(s,{skipHistory:!0,silent:!0})}));var l={wids:t.widgets.map((function(t){return t.get("_id")})),svg:o,size:t.size,viewport:t.viewport,mid:t.mid,prefix:t.prefix,arrow:t.activeArrow};return r.a.ajax({url:"/api/images/rasterize",type:"POST",data:l,success:t.onSuccess,error:t.onError})}}},$t=rt.extend({name:"Slideshow",sort_index:6,thumb:"slideshow",icon_color:"#0052A8",initial_controls:["slideshow_settings","slideshow_transitions","slideshow_manager","text_typography","text_bius","text_color","common_animation","common_position","common_layer","common_lock"],viewport_fields:g.b.viewport_fields.slideshow,MIN_IMAGES_WIDTH:100,MIN_IMAGES_HEIGHT:100,MIN_CAPTIONS_HEIGHT:14,ARROW_NOUN_ICON_WIDTH:18,ARROW_NOUN_ICON_HEIGHT:18,DEFAULT_ARROWS_CONTAINER:{LEFT:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40"><path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path></svg>',RIGHT:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40"><path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path></svg>'},MAX_ICON_CACHE_SIZE:30,params:{multipleName:"multiple values",tabIndent:28,fontSizeLineHeightRatio:1.25,minFontSize:8,maxFontSize:999,minLineHeight:10,maxLineHeight:999,minLetterSpacing:-99,maxLetterSpacing:999},initialize:function(t,e){this.initBlock(t,e),this.inner_template=Ot.a["template-constructor-block-slideshow"],this.cur_selection_styles={},this.cur_selection_styles_all={},this.queue=[],this.frameClass=Tt,this._imgsPreload=[],this.picloaded={},this.model.on("change:theme_data",this.onThemeParamsChange),this.currentIconsData={},this.workspace.on("main-dragover",this.highlightDropZone),this.model.skipResponse=!0,this.fillTextStyles(),this.workspace.on("deselect",this.showOverlay),this.workspace.on("deselect",this.setToDefaultArrows),this.workspace.on("select",this.hideOverlay),this.saveDebounced=O.a.debounce((function(){this.model.save()}),2e3),this.renderCorrectIconsDebounced=O.a.debounce(this.renderCorrectIcons,10)},render:function(){this.create(),Object(r.a)(this.inner_template(this.model.attributes)).appendTo(this.$content),this.$el.addClass("slideshow can-drop"),this.model.get("theme_data")&&(this.setControls(),this.slideshowPlayer=new xt.a(O.a.clone(this.model.attributes),this.$content,"constructor",this,this.workspace&&this.workspace.mag),this.onThemeParamsChange(),!this.uploader&&at.a.flagLambda()&&this.$(".uploadInput")&&this.$(".uploadInput").attr("data-url","/api/upload/lambda/"),this.uploader=new ft.a(this,{fileInput:this.$(".uploadInput"),unique:!0}),this.bindUploader(this.uploader),this.on("changeStyleSpan",this.textStyleChanged),this.on("changeStyleParagraph",this.textStyleChanged),"default"!==this.model.get("theme_data").arrows_type&&this.renderCorrectIcons(),this.listenTo(this,"arrow_type_changed",this.renderCorrectIconsDebounced),this.listenTo(this,"captions_changed",this.onCaptionsStatusChange),this.triggerReady())},renderCorrectIcons:function(){var t,e,i=this.model.get("theme_data"),n=i.arrows_type;"default"===n?(t=i.controls_color,e=i.controls_opacity,this.renderIcon({$svg:Object(r.a)(this.DEFAULT_ARROWS_CONTAINER.LEFT),activeArrow:"left_arrow_default"}),this.renderIcon({$svg:Object(r.a)(this.DEFAULT_ARROWS_CONTAINER.RIGHT),activeArrow:"right_arrow_default"}),this.slideshowPlayer.colorArrows(t,e)):"library"!==n&&"noun"!==n||this.getNounArrows()},hideOverlay:function(){this.$(".jsSlideshowOverlay").hide()},showOverlay:function(){this.$(".jsSlideshowOverlay").show()},setToDefaultArrows:function(){var t=this,e=this.model.get("theme_data"),i=e.arrows_type,n=e.left_icon_noun,o=e.right_icon_noun;O.a.defer((function(){"library"!==i&&"noun"!==i||!O.a.isEmpty(n)&&!O.a.isEmpty(o)||t.model.save({theme_data:O.a.extend(t.model.get("theme_data"),{arrows_type:"default"})})}))},bindUploader:function(t){t.on("add",this.onAddUpload),t.on("send",this.onSendUpload),t.on("done",this.onDoneUpload),t.on("fail",this.onFailUpload)},getNounArrows:function(){var t=this.model.get("theme_data").left_icon_noun,e=this.model.get("theme_data").right_icon_noun;O.a.isEmpty(t)&&O.a.isEmpty(e)||(O.a.isEmpty(t)||this.getIconSVG(t.noun_id||t.rm_id,t.noun_url,"left_arrow_noun",function(t,e){!t&&e.$svg}.bind(this)),O.a.isEmpty(e)||this.getIconSVG(e.noun_id||e.rm_id,e.noun_url,"right_arrow_noun",function(t,e){!t&&e.$svg}.bind(this)))},rasterizeIconsBeforeDestroy:function(){O.a.isEmpty(this.currentIconsData.left_arrow_noun)||this.rasterizeIconSVG({$svg:this.getСoloredIconSVG("left_arrow_noun"),activeArrow:"left_arrow_noun"}),O.a.isEmpty(this.currentIconsData.right_arrow_noun)||this.rasterizeIconSVG({$svg:this.getСoloredIconSVG("right_arrow_noun"),activeArrow:"right_arrow_noun"})},renderIcon:function(t){var e=t.$svg,i=t.activeArrow;["left_arrow_noun","left_arrow_default"].includes(i)&&(this.$el.find(".prev-picture-arrow-bottom").empty().html(e.clone()).toggleClass("noun","left_arrow_noun"===i),this.$el.find(".prev-picture-arrow-middle").empty().html(e.clone()).toggleClass("noun","left_arrow_noun"===i)),["right_arrow_noun","right_arrow_default"].includes(i)&&(this.$el.find(".next-picture-arrow-bottom").empty().html(e.clone()).toggleClass("noun","right_arrow_noun"===i),this.$el.find(".next-picture-arrow-middle").empty().html(e.clone()).toggleClass("noun","right_arrow_noun"===i))},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(r.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var n=e.get(0).getBBox();return e.remove(),i.data("aspect_ratio",n.width/n.height),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",n.x+" "+n.y+" "+n.width+" "+n.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){window.iconSVGCache.push(t),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift()},getSVGCacheItem:function(t){return window.iconSVGCache&&O.a.findWhere(window.iconSVGCache,{id:t})},"getСoloredIconSVG":function(t){var e,i=this.model.get("theme_data").controls_color,n=this.model.get("theme_data").controls_opacity,o=this.currentIconsData[t].$svg.clone();return e=v.default.getRGBA(i,1),o.find("*:not(.fixed-color)").each((function(){var t=Object(r.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),o.get(0).setAttribute("fill",e),o.get(0).setAttribute("fill-opacity",n),o},rasterizeIconSVG:function(t){this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=jt.rasterize({widgets:[this.model],svg:t.$svg,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.ARROW_NOUN_ICON_WIDTH,height:this.ARROW_NOUN_ICON_HEIGHT},activeArrow:t.activeArrow})},getIconSVG:function(t,e,i,n){var o,a,s,l=i.includes("left"),c=l?"iconXhrLeft":"iconXhrRight",d=l?"iconLeftRequestInProgress":"iconRightRequestInProgress";if(this[c]&&this[c].abort(),o=this.getSVGCacheItem(t))return s={$svg:o.$svg,noun_url:o.noun_url,aspect_ratio:o.$svg.data("aspect_ratio")},this.currentIconsData[i]=s,this.renderIcon({$svg:this.getСoloredIconSVG(i),activeArrow:i}),n(null,s);var h=function(e){var o=Object(r.a)("<div></div>").append(Object(r.a)(e.svg)).find("svg");if(o.length)return o=this.prepareIconSVG(o),s={id:t,$svg:o,noun_url:e.new_url,aspect_ratio:o.data("aspect_ratio")},this.currentIconsData[i]=s,this.cacheSVGData(s),this.renderIcon({$svg:this.getСoloredIconSVG(i),activeArrow:i}),n(null,{$svg:o,noun_url:e.new_url})}.bind(this);a={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this[d]=!1,h(t)},error:function(t){return this[d]=!1,n(t)},context:this},/^rm/.test(t)&&O.a.extend(a,{method:"GET",url:e,cache:!1,success:function(t){this[d]=!1,h({svg:Object(r.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this[d]=!0,this[c]=r.a.ajax(a)},fillTextStyles:function(){var t={"size-leading-linked":!0,"size-leading-ratio":this.params.fontSizeLineHeightRatio};this.cur_selection_styles=O.a.defaults(O.a.clone(this.model.get("text_style")),t),this.cur_selection_styles_all=[O.a.defaults(O.a.clone(this.model.get("text_style")),t)]},onCaptionsStatusChange:function(t){this.setControls(t),this.updateControls()},setControls:function(t){t=void 0===t?this.model.get("theme_data").captions:t,this.controls=t?this.initial_controls:O.a.without(this.initial_controls,"text_typography","text_bius","text_color")},onAddUpload:function(t,e){var i=null;if(this.replacingPic){for(var n in this.queue.indexOf(this.replacingPic)>-1&&this.cancelUpload(this.replacingPic),this.replacingPic)"num"!=n&&"id"!=n&&"text"!=n&&delete this.replacingPic[n];this.replacingPic.name=e.files&&e.files[0]&&e.files[0].name,this.replacingPic.uploadData=e,i=this.replacingPic,this.replacingPic=null,this.trigger("replaceUpload",i)}else{i={num:this.getMaxNum()+1,name:e.files&&e.files[0].name,uploadData:e},this.trigger("addUpload",i)}this.queue.push(i)},onSendUpload:function(t,e){this.trigger("nowUploading",this.queue[0])},onDoneUploadFinish:function(t){var e=this.queue.shift();if(t){var i=O.a.clone(this.model.get("pictures"))||[],n=!i.length,o=O.a.indexOf(i,e),a=O.a.extend({num:e.num},t.picture,t.size);o>-1?i[o]=O.a.extend(a,{id:i[o].id,text:i[o].text}):i.push(O.a.extend(a,{id:v.default.generateUUID(),text:""})),this.tempSave({pictures:i}),this.queue=this.queue||[],this.trigger("doneUpload",a),n&&this.updateControls()}else this.trigger("failUpload",e)},onDoneUpload:function(t,e){var i=this;if(!e.result)return this.onDoneUploadFinish(null);var n=e.result,o=O.a.clone(this.model.attributes);return at.a.useLambdaUrl(n&&n.picture)?this.onDoneUploadFinish(n):o&&o._id&&n.picture.type&&["jpg","png"].includes(n.picture.type.toLowerCase())?void(this._optimizedImageXHR=r.a.ajax({type:"POST",data:{_id:o._id,picture:n.picture},url:"/api/imageoptimize",success:function(t){n.picture=O.a.extend(n.picture,t),i.onDoneUploadFinish(n)},error:function(){i.onDoneUploadFinish(n)}})):this.onDoneUploadFinish(n)},onFailUpload:function(t,e,i){var n=this.queue.shift(),o=O.a.clone(this.model.get("pictures"))||[],a=O.a.indexOf(o,n);n.error=!0,n.errorText=i,a>-1?o[a]=O.a.omit(O.a.extend(n,{id:o[a].id,text:o[a].text}),"uploadData"):o.push(O.a.omit(O.a.extend(n,{id:v.default.generateUUID(),text:""}),"uploadData")),this.model.set("pictures",o),this.queue=this.queue||[],this.updateControls(),this.trigger("failUpload",n,i),this.tempSave({pictures:o})},deletePic:function(t){var e=O.a.findWhere(this.queue,{num:t});e?this.cancelUpload(e):(e=O.a.findWhere(this.model.get("pictures"),{num:t}),this.model.set("pictures",O.a.without(this.model.get("pictures"),e))),O.a.each(this.getAllPics(),(function(t){t.num>e.num&&(t.num-=1)})),this.trigger("reorder"),this.model.save({},{silent:!O.a.isEmpty(this.queue)}),0==(this.model.get("pictures")||[]).length&&this.updateControls()},updatePic:function(t){this.replacingPic=Object(O.a)(this.getAllPics()).findWhere({num:t}),this.uploader.$uploader.trigger("click","stop")},cancelUpload:function(t){0===this.queue.indexOf(t)&&(t.uploadData.abort(),this.queue[1]&&this.trigger("nowUploading",this.queue[1])),this._optimizedImageXHR&&this._optimizedImageXHR.abort(),t.uploadData.files[0].skipped=!0,this.queue=O.a.without(this.queue,t)},removePictures:function(){this.uploader.abort(),this.model.unset("pictures"),this.model.save({},{silent:!0}),this.queue=[],this.trigger("clear")},swapPictures:function(t,e){for(var i=Object(O.a)(this.getAllPics()).sortBy((function(t){return t.num})),n=O.a.findWhere(i,{num:t}),o=t;o!=e+(t<e?1:-1);t<e?o++:o--)o!=t&&(i[o-1].num=t<e?i[o-1].num-1:i[o-1].num+1);n.num=e,this.trigger("reorder"),this.fixPicturesOrder(i),this.saveXHR&&this.saveXHR.abort(),this.saveXHR=this.model.save({},{silent:!O.a.isEmpty(this.queue)}),this.workspace.trigger("redraw"),this.slideshowPlayer.applyPictures(O.a.clone(this.model.attributes))},tempSave:function(t){this.tempSaveXHR&&(this.tempSaveXHR.abort(),delete this.tempSaveXHR),t&&t.pictures&&this.fixPicturesOrder(t.pictures),this.tempSaveXHR=this.model.save(t,{patch:!0,skipHistory:!O.a.isEmpty(this.queue)}).success(O.a.bind((function(){delete this.tempSaveXHR}),this))},fixPicturesOrder:function(t){for(var e=O.a.sortBy(t,"num"),i=0;i<e.length;i++)e[i].num=i+1},getMaxNum:function(){var t=this.getAllPics();return O.a.isEmpty(t)?0:O.a.max(O.a.pluck(t,"num"))},getAllPics:function(){return O.a.union(this.model.get("pictures")||[],this.queue)},updateDropZone:function(){var t=this.$el;this.manager&&(t=t.add(this.manager.$uploadDropZone)),this.settingsPanel&&this.settingsPanel.canUpload()&&(t=t.add(this.settingsPanel.$el)),this.uploader.setOptions({dropZone:t})},getThemeData:function(){var t={theme:this.model.get("current_theme"),thumbnails:this.model.get("theme_data").thumbnails,counters:this.model.get("theme_data").counters,images_h:this.model.get("images_h"),captions_h:this.model.get("captions_h"),left_arrow_noun:this.model.get("left_arrow_noun"),right_arrow_noun:this.model.get("right_arrow_noun"),current_mode:this.model.get("current_mode"),arrows_type:this.model.get("theme_data").arrows_type,captions:this.model.get("theme_data").captions,counters_type:this.model.get("theme_data").counters_type,counters_position:this.model.get("theme_data").counters_position,active_arrows:this.model.get("active_arrows")};return t.showThumbnails=t.thumbnails,t.showCounters=t.counters,t.showCaptions=t.captions||"theme_captions"===t.theme,t.showBottomDots=t.counters&&(("middle"===t.active_arrows||"outside"===t.counters_position)&&"dots"===t.counters_type||"theme_captions"===t.theme),t},getNewBlockHeight:function(){var t=this.getThemeData();return t.images_h+(t.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)+(t.showCaptions?t.captions_h:0)+(t.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0)},getNewInnerElementsHeight:function(t,e){var i=this.getThemeData(),n=i.images_h,o=i.captions_h;return"s"===e&&i.captions?o=t-i.images_h-(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0):n=t-(i.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)-(i.showCaptions?i.captions_h:0)-(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0),{images_h:n,captions_h:o}},getSaveBoxData:function(t){t=t||{};var e=l.a.prototype.getSaveBoxData.apply(this,arguments),i=this.getNewInnerElementsHeight(e.h,t.resizePoint);return e.images_h=i.images_h,e.captions_h=i.captions_h,e},saveBox:function(t){l.a.prototype.saveBox.apply(this,arguments),this.setSizeConstraints()},textStyleChanged:function(t,e){var i=O.a.clone(this.model.get("text_style")),n=O.a.extend(i,t);e&&(n=O.a.extend(n,e)),this.model.set({text_style:n}),this.saveDebounced()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){l.a.prototype.redraw.apply(this,arguments);var i=this.model.changedAttributes();if(O.a.isObject(i)){var n=["captions_h","images_h","w","h","theme_data","left_arrow_noun","right_arrow_noun","transition_type","play_method"];O.a.intersection(O.a.keys(i),n).length&&this.slideshowPlayer.applyVisualState(this.model.attributes),this.model.hasChanged("pictures")&&this.slideshowPlayer.applyPictures(this.model.attributes),this.model.hasChanged("text_style")&&(this.slideshowPlayer.applyTextStyles(this.model.attributes),this.fillTextStyles(),this.trigger("selection_styles_changed",this.cur_selection_styles),this.trigger("selection_styles_all_changed",this.cur_selection_styles_all),this.initiatorControl=null);var o=this.getNewBlockHeight();o!==this.model.get("h")&&this.model.set("h",o)}}},css:function(t,e){if(l.a.prototype.css.apply(this,arguments),null!=t.height||null!=t.width){var i=this.getNewInnerElementsHeight(t.height||this.model.get("h"),e);this.slideshowPlayer.applyVisualState(O.a.clone(this.model.attributes),{w:t.width,h:t.height,images_h:i.images_h,captions_h:i.captions_h})}},onThemeParamsChange:function(){var t=this.getThemeData();this.model.set("h",this.getNewBlockHeight()),this.setSizeConstraints(),this.frame&&this.frame.setResizeBottomPlus(t.showBottomDots||t.captions)},setSizeConstraints:function(){var t,e,i=this.getThemeData(),n=(i.showBottomDots?this.slideshowPlayer.COUNTERS_HEIGHT:0)+(i.thumbnails?this.slideshowPlayer.THUMBNAILS_HEIGHT:0)+(i.captions?this.MIN_CAPTIONS_HEIGHT:0);t=i.images_h+n,e=this.MIN_IMAGES_HEIGHT+n,O.a.extend(this.frame,{minwidth:this.MIN_IMAGES_WIDTH,maxwidth:9999,minheight:0,maxheight:9999,minheight_on_south_resize:t,minheight_on_other_resize:e})},highlightDropZone:function(){this.$el.addClass("show-dropzone"),clearTimeout(this.highlightTimeout),this.highlightTimeout=setTimeout(O.a.bind((function(){this.$el.removeClass("show-dropzone")}),this),500)},destroy:function(){this.workspace.off("main-dragover",this.highlightDropZone),this.off("changeStyleSpan",this.textStyleChanged),this.off("changeStyleParagraph",this.textStyleChanged),this.model.off(),this.slideshowPlayer&&this.slideshowPlayer.destroy(),this.slideshowPlayer=null,l.a.prototype.destroy.apply(this,arguments)}},{defaults:{captions_h:76,images_h:360,current_mode:"default",transition_type:"slider",play_method:"click",theme_data:{arrows:!0,arrows_type:"default",arrows_position:"sides",arrows_view_mode:"normal",counters_type:"numbers",counters_position:"inside",slider_transition:.5,crossfade:2,autoplay_delay:4,hover_delay:.8,scroll_delay:1,start_offset:200,hover_frame_rate:.8,captions:!1,fullscreen:!1,controls_bg:!0,show_on_hover:!1,thumbnails:!1,counters:!1,fill:!0,radius:0,controls_color:"ffffff",controls_opacity:1,background_color:"000000",background_opacity:1,left_icon_noun:{},right_icon_noun:{}},text_style:{color:"000000","font-family":"Arial","font-size":8,"font-style":"normal","font-weight":"400","letter-spacing":0,"line-height":10,opacity:100,"text-align":"center","text-decoration":"none","text-transform":"none","vertical-align":"baseline","size-leading-linked":!0,"size-leading-ratio":1.25}}}),Tt=b.a.extend({applyExtraConstraints:function(t,e){return this.block.setSizeConstraints(),"s"==e?t.height<this.minheight_on_south_resize&&(t.height=this.minheight_on_south_resize):t.height<this.minheight_on_other_resize&&(t.height=this.minheight_on_other_resize),t},setResizeBottomPlus:function(t){this.$el.toggleClass("resize-bottom-plus-slideshow",t)}}),It=$t,Et=i("Vc8N"),Mt=i.n(Et),Rt=i("3eHG"),At=l.a.extend({name:"Twitter",sort_index:12,thumb:"twitter",icon_color:"#1DA1F2",initialize:function(t,e){var i=this;this.mag=e.mag,this.initBlock(t,e),this.frameClass=Dt,this.model.validate=function(t){var e=i.model.get("current_type");t[e].url&&(t[e].url=i.fixUrl(t[e].url)),t.type_hashtag&&t.type_hashtag.hash&&(t.type_hashtag.hash=t.type_hashtag.hash.replace(/\s/g,"")),t.type_follow&&t.type_follow.username&&(t.type_follow.username=t.type_follow.username.replace(/\s/g,""))},this.model.on("change:current_type",this.onParamsChange),this.model.on("change:type_timeline",this.onParamsChange),this.model.on("change:type_embed",this.onParamsChange),this.model.on("change:type_tweet",this.onParamsChange),this.model.on("change:type_follow",this.onParamsChange),this.model.on("change:type_hashtag",this.onParamsChange),this.controls=["twitter_settings","common_position","common_layer","common_lock"]},render:function(){this.create(),this.$el.addClass("twitter"),this.redraw(this.model,{skipHistory:!0,skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.onParamsChange(),this.triggerReady()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){var i=this.model.get("current_type"),n=this.model.changedAttributes(),o=O.a.isObject(n)&&0==O.a.without(O.a.keys(n),"x","y","z","pack_id").length,a=O.a.isObject(n)&&(O.a.has(n,"w")||O.a.has(n,"h"))&&!n.current_type,s=!(o||a&&("type_timeline"===i||"type_embed"===i));l.a.prototype.redraw.apply(this,arguments),"type_embed"===i&&this.adjustTweetHeight({skipHistory:e&&(e.undo||e.redo||e.skipHistory)}),s&&this.redrawTwitter(t.get("w"),t.get("h"),e)}},css:function(t){var e,i,n,o=this.$el.find("iframe");l.a.prototype.css.apply(this,arguments),"type_timeline"===this.model.get("current_type")&&1==o.length&&o.hasClass("twitter-timeline")&&(e=o.contents().find("body .timeline-header").outerHeight(),i=o.contents().find("body .timeline-footer").outerHeight(),n=o.height()-e-i,e&&i&&o.contents().find("body .stream").height(n))},onParamsChange:function(){var t=this.model.get("current_type");O.a.contains(["type_timeline","type_embed"],t)?this.validateCode(t):O.a.contains(["type_tweet","type_follow","type_hashtag"],t),this.$el.removeClass(["type_timeline","type_embed","type_tweet","type_follow","type_hashtag"].join(" ")),this.$el.addClass(t),this.setSizeConstraints()},setSizeConstraints:function(t){var e,i=this.model.get("current_type");O.a.contains(["type_tweet","type_follow","type_hashtag"],i)?(e=this.$el.find("iframe")).length>0?O.a.extend(this.frame,{minwidth:e.width()||120,maxwidth:e.width()||120,minheight:e.height()||20,maxheight:e.height()||20}):O.a.extend(this.frame,{minwidth:120,maxwidth:120,minheight:20,maxheight:20}):"type_timeline"===i?O.a.extend(this.frame,{minwidth:180,maxwidth:520,minheight:200,maxheight:9999}):"type_embed"===i&&(e=this.$el.find("twitterwidget.twitter-tweet"),O.a.extend(this.frame,{minwidth:220,maxwidth:500,minheight:e.length&&e.height()>1?e.height():163,maxheight:e.length&&e.height()>1?e.height():163})),t&&O.a.extend(this.frame,t)},doResize:function(t){t=t||{};var e=this.model.get("current_type");this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),O.a.contains(["type_tweet","type_follow","type_hashtag"],e)&&(this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.set("h",this.frame.minheight,{silent:!0})),O.a.isEmpty(O.a.pick(this.model.changed,"w","h"))||this.model.save({},{skipHistory:t.skipHistory,noSocketUpdate:t.socketUpdate}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},redrawTwitter:function(t,e,i){var n,o,a=this.model.get("current_type"),s=O.a.clone(this.model.get(a)),l=Mt.a["template-constructor-block-twitter-"+a];"mag"===s.use_own_url?s.url=this.getMagUrl():"page"!==s.use_own_url&&s.url||(s.url=this.getPageUrl()),n=l(s),this.$content.html(n),this.$overlay=this.$content.find(".overlay"),"type_timeline"===a&&this.$content.find("a").attr({width:this.model.get("w"),height:this.model.get("h")}),o=this.frame.isFrameVisible(),this.frame.hide(),Rt.a.initTwitterAPI(function(){var t=function(e){var n=e.target;Object(r.a)(n).closest(".block").attr("data-id")===this.model.get("_id")&&(window.twttr.events.unbind("rendered",t),this.waitForIframe(this.$content,20,100,function(){var t=i&&(i.undo||i.redo);"type_timeline"===a&&this.$content.find("iframe").css({width:"100%",height:"100%","max-width":"100%"}),"type_embed"===a?this.adjustTweetHeight({skipHistory:t}):(this.setSizeConstraints(),this.doResize(O.a.extend({},i,{skipHistory:"type_embed"===a||t}))),o&&this.frame.show()}.bind(this)))}.bind(this);window.twttr.events.bind("rendered",t),window.twttr&&window.twttr.widgets&&O.a.isFunction(window.twttr.widgets.load)&&window.twttr.widgets.load(this.$el[0])}.bind(this))},validateCode:function(t){var e,i;e=this.model.get(t).code.match({type_timeline:/^\<a.*\>.*\<\/a\>/i,type_embed:/^\<blockquote.*\>.*\<\/blockquote\>/i}[t]),(i=O.a.clone(this.model.get(t))).code=e?e[0]:"",this.model.set(t,i)},waitForIframe:function(t,e,i,n){var o;o=setInterval((function(){var e=t.find("iframe, twitterwidget");e.length&&(parseInt(e[0].style.width)>0||parseInt(e[0].style.height))>0&&(clearInterval(o),O.a.delay(function(){n()}.bind(this),100))}),e)},adjustTweetHeight:function(t){var e=this.$content.find("twitterwidget.twitter-tweet, iframe.twitter-tweet"),i=this.model.get("current_type");e.height();"type_embed"===i&&(e.css({margin:0,"max-width":"100%","-webkit-transform":"none",width:"100%"}),e.contents().find("body *").css({"-webkit-transition-duration":"0s","transition-duration":"0s"}),this.setSizeConstraints(),this.doResize(t))},getMagUrl:function(){return this.mag&&ot.a.readymag_host+"/"+this.mag.get("num_id")+"/"},getPageUrl:function(){return ot.a.readymag_host+"/p"+this.workspace.page.get("num_id")+"/"},fixUrl:function(t){var e=t;return t&&(e=(/^http(s?):\/\//i.test(t)?"":"http://")+t),e}},{defaults:{current_type:"type_timeline",type_timeline:{code:'<a class="twitter-timeline" href="https://twitter.com/readymag" data-widget-id="324216476359852033">Tweets by @readymag</a>',widget_id:""},type_embed:{code:'<blockquote class="twitter-tweet"><p>Here we go: <a href="http://t.co/yY6jqsSg" title="https://readymag.com/">readymag.com</a></p>&mdash; Readymag (@readymag) <a href="https://twitter.com/readymag/status/225550067766005760">July 18, 2012</a></blockquote>'},type_tweet:{url:"",use_own_url:"mag",show_count:!0,large_button:!1},type_follow:{username:"Readymag",show_name:!0,large_button:!1},type_hashtag:{hash:"Readymag",large_button:!1}}}),Dt=b.a.extend({customResizeHandler:function(t,e){return this.block.setSizeConstraints(),t}}),zt=At,Lt=i("wxrA"),Bt=i.n(Lt),Ft=l.a.extend({name:"Facebook",sort_index:11,thumb:"facebook",icon_color:"#1877F2",initialize:function(t,e){var i,n,o=this;this.mag=e.mag,this.initBlock(t,e),"type_like_button"==this.model.get("current_type")&&this.model.get("type_like_button").send_button&&((i=O.a.clone(this.model.get("type_like_button"))).share_button=i.send_button,delete i.send_button,this.model.set("type_like_button",i,{silent:!0})),O.a.isEmpty(this.model.get("type_like_box"))||((n=O.a.clone(this.model.get("type_like_box"))).small_header=!n.show_header,delete n.show_header,this.model.unset("type_like_box",{silent:!0}),this.model.set({type_page:n},{silent:!0}),"type_like_box"==this.model.get("current_type")&&this.model.set({current_type:"type_page"},{silent:!0})),this.frameClass=Nt,this.model.validate=function(t){var e=o.model.get("current_type");t[e].url&&(t[e].url=o.fixUrl(t[e].url))},this.controls=["facebook_settings","common_position","common_layer","common_lock"]},render:function(){this.create(),this.$el.addClass("facebook"),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.triggerReady()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){var i=this.model.get("current_type"),n=this.model.get(i),o=this.model.changedAttributes(),a=O.a.isObject(o)&&0==O.a.without(O.a.keys(o),"x","y","z","pack_id").length,s=!a,r=["type_like_button","type_page","type_comments"];l.a.prototype.redraw.apply(this,arguments),this.$el.removeClass(r.join(" ")),this.$el.addClass(i),"type_like_button"===i&&this.$el.removeClass("standard box_count button_count").addClass(n.layout),this.$el.toggleClass("no-v-resize","type_page"===i&&!n.show_stream&&!n.show_faces),Object(O.a)(["type_page","type_comments"]).contains(i)&&(this.setSizeConstraints(),e&&(e.undo||e.redo)||this.doResize()),s&&this.redrawFacebook(t.get("w"),t.get("h"),e)}},setSizeConstraints:function(t){var e,i,n,o,a=this.model.get("current_type"),s=this.model.get(a);if(e=this.$el.find("iframe"),"type_like_button"===a){if(1!==e.length)return;i="button_count"===s.layout||"box_count"===s.layout,O.a.extend(this.frame,{minwidth:i?e.width():285,maxwidth:i?e.width():900,minheight:e.height(),maxheight:e.height()})}else"type_page"===a?(n=63,n+=s.show_faces?122:0,n+=s.show_header&&(s.show_faces||s.show_stream)?30:0,n+=s.show_stream?300:0,o=!s.show_faces&!s.show_stream?63:9999,O.a.extend(this.frame,{minwidth:292,maxwidth:900,minheight:n,maxheight:o})):"type_comments"===a&&O.a.extend(this.frame,{minwidth:400,maxwidth:900,minheight:250,maxheight:9999});t&&O.a.extend(this.frame,t)},doResize:function(t){this.model.get("w")<this.frame.minwidth&&this.model.set("w",this.frame.minwidth,{silent:!0}),this.model.get("w")>this.frame.maxwidth&&this.model.set("w",this.frame.maxwidth,{silent:!0}),this.model.get("h")<this.frame.minheight&&this.model.set("h",this.frame.minheight,{silent:!0}),this.model.get("h")>this.frame.maxheight&&this.model.set("h",this.frame.maxheight,{silent:!0}),O.a.isEmpty(O.a.pick(this.model.changed,"w","h"))||this.model.save({},{skipHistory:!0,noSocketUpdate:t&&t.socketUpdate}),this.frame.doResize({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},redrawFacebook:function(t,e,i){var n,o,a=this.model.get("current_type"),s=O.a.clone(this.model.get(a)),l=Bt.a["template-constructor-block-facebook-"+a];s.w=this.model.get("w"),s.h=this.model.get("h"),"mag"===s.use_own_url?s.url=this.getMagUrl():"page"!==s.use_own_url&&s.url||(s.url=this.getPageUrl()),s.url=this.fixUrl(s.url),n=l({data:s}),this.$content.html(n),this.$overlay=this.$content.find(".overlay"),this.$content.toggleClass("scrollable","type_comments"===a),Rt.a.initFacebookAPI(function(){window.FB.XFBML.parse(this.$el.get(0),function(){if("type_comments"===a&&this.$(".fb-comments").append(Object(r.a)('<div class="overlay"></div>')),"type_like_button"===a){o=this.$el.find("iframe");var t=0,e=setInterval(function(){t++,(o.height()>0||t>20)&&(clearInterval(e),this.setSizeConstraints(),this.doResize(i))}.bind(this),100)}}.bind(this))}.bind(this))},getMagUrl:function(){return this.mag&&ot.a.readymag_host+"/"+this.mag.get("num_id")+"/"},getPageUrl:function(){return ot.a.readymag_host+"/p"+this.workspace.page.get("num_id")+"/"},fixUrl:function(t){var e=t;return t&&(e=(/^http(s?):\/\//i.test(t)?"":"http://")+t),e}},{defaults:{current_type:"type_like_button",x:"center",w:61,h:20,type_like_button:{url:"",use_own_url:"mag",layout:"button_count",share_button:!1,show_faces:!1,theme:"light"},type_page:{url:"https://www.facebook.com/readymag",show_stream:!0,small_header:!1,show_faces:!1,theme:"light"},type_comments:{url:"",use_own_url:"mag",num_posts:5,theme:"light"}}}),Nt=b.a.extend({}),Ut=Ft,Ht=i("z79a"),Vt=l.a.extend(Ht.a.prototype).extend({name:"Shape",sort_index:3,thumb:"shape",icon_color:"#FFCB00",dontSaveOnResize:!0,viewport_fields:g.b.viewport_fields.shape,LINE_BLOCK_HEIGH:24,initial_controls:["shape_settings","shape_color","shape_1x1","common_animation","picture_link","common_rotation","common_position","common_layer","common_lock"],initialize:function(t,e){this.mag=e.mag,this.initBlock(t,e),this.renderSVGContent.__debounced=O.a.debounce(this.renderSVGContent,0),this.iconData=null},render:function(){this.create(),this.$el.addClass("shape"),this.setControls(),this.$el.on("dblclick",this.onDoubleClick),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.model.on("change:tp",this.onTypeChange),this.model.on("change:is_full_width",this.onStrechBlockChange),this.model.on("change:is_full_height",this.onStrechBlockChange),this.onTypeChange(),this.triggerReady()},onDoubleClick:function(t){Object(r.a)(t.target).closest(".content").length&&this.showControl("shape_settings")},onStrechBlockChange:function(){this.setControls(),this.updateControls()},showControl:function(t){var e,i=this.workspace&&this.workspace.controls;i&&(e=i.findControl(t))&&!e.selected&&e.onClick()},setControls:function(){var t=this.model.get("tp");this.controls="line"==t||"icon"==t?O.a.without(this.initial_controls,"shape_1x1"):this.initial_controls},onTypeChange:function(t,e,i){var n=this.model.get("tp"),o=t&&0==O.a.without(O.a.keys(t.changedAttributes()),"tp").length;this.proportional="icon"==n,"icon"==n&&(this.isRealChangeByMe(i)&&O.a.delay(function(){this.showControl("shape_icon")}.bind(this),300),this.resetFullWidth(),this.resetFullHeight()),"line"==n&&o&&this.fixLineHeight(),this.setControls(),this.updateControls()},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t,e)){l.a.prototype.redraw.apply(this,arguments);var i,n,o,a,s=this.model.changedAttributes(),r=!1;if(O.a.isObject(s)&&(r=0==O.a.without(O.a.keys(s),"x","y","z","sticked_margin","sticked").length,a=0==O.a.without(O.a.keys(s),"rasterUrl","raster2xUrl").length,i=!!s.tp,n=!(!s.noun_id&&!s.rm_id)),!a&&(!r||this.model.isGlobal()))if("icon"==t.get("tp")){o=!!O.a.intersection(O.a.keys(s),["w","h","noun_id"]).length;var c={viewport:this.model.getViewport(),skipHistory:e.isGroupResize},d=o&&!(e.undo||e.redo),h=i||n,u=this.redrawIcon.bind(this,t,c,h,d);e.isGroupResize?O.a.delay(u):u()}else this.redrawShape(t.get("w"),t.get("h")),i&&"ellipse"==t.get("tp")&&this.makeSquare()}},redrawIcon:function(t,e,i,n){this.getIconSVG(t.get("noun_id")||t.get("rm_id"),t.get("noun_url"),function(t,e){!t&&e.$svg&&(this.destroyed||(this.updateIconSVGData(e,i),n&&this.rasterizeSVG()))}.bind(this))},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/";if(t.small&&this.icon_color&&(e["background-color"]=this.icon_color),"icon"===this.model.get("tp"))e["background-color"]=this.icon_color,t&&t.small||(e["border-radius"]="8px");else{var n=Object(X.findImagePath)("".concat(i,"shape-").concat(this.model.get("tp"),".svg"));e["background-image"]="url(".concat(n,")")}return e},getIconData:function(){return"icon"===this.model.get("tp")?this.iconData:null},updateIconSVGData:function(t,e){this.iconData=t,this.redrawShape(this.model.get("w"),this.model.get("h")),(e=e||"icon"==this.model.get("tp")&&this.model.get("w")!=this.model.get("h"))&&this.fixIconSVGSize()},css:function(t){l.a.prototype.css.apply(this,arguments),null!=t.height&&null!=t.width&&this.redrawShape(t.width,t.height)},redrawShape:function(t,e){var i=this.generateShapeSVG("constructor",this.model,t,e);this.renderSVGContent(i),Modernizr.firefox&&this.renderSVGContent.__debounced(i)},renderSVGContent:function(t){this.$content.html(t)},fixIconSVGSize:function(t){this.model.get("w"),this.model.get("h");var e,i,n,o,a,s,r,l=this.getBoxData(),c=Math.min(l.w,l.h);(e=this.$content.find("svg")).length&&(n=e.get(0).getBBox(),i=Math.round(n.width)/Math.round(n.height),s=l.w,r=l.h,n.width<n.height?(l.w=c,l.h=Math.ceil(l.w/i)):(l.h=c,l.w=Math.ceil(l.h*i)),o=Math.floor((s-l.w)/2),a=Math.floor((r-l.h)/2),l.x=l.x+o,l.y=l.y+a,this.model.set(l,O.a.extend({skipHistory:!0},t)))},rasterizeSVG:function(){var t=this,e=this.$content.find("svg");e.length&&(this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=jt.rasterize({widgets:[this.model],svg:e,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.model.get("w"),height:this.model.get("h")},onSuccess:function(e){e&&e.rasterUrl&&t.model.save(e,{skipHistory:!0,silent:!0})}}))},saveNewColor:function(){this.rasterizeSVG()},onResizeStart:function(t,e){this.rasterizeXhr&&this.rasterizeXhr.abort()},onResizeEnd:function(t,e,i){if("icon"!==this.model.get("tp"))return this.saveBox(i);this.fixIconSVGSize(i)},saveBox:function(t){l.a.prototype.saveBox.apply(this,arguments)},getDefaultIconSVG:function(){return this.prepareIconSVG(Object(r.a)('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="283.5px" height="283.5px" viewBox="0 0 283.5 283.5" enable-background="new 0 0 283.5 283.5" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#231F20" d="M258.3,114.1c-14.1,0-23.1,25-30.1,33.8 c-7,8.8-33.3,2.7-44.1,0.7c-10.7-2.1-38.7-3.9-38.7-3.9s47.4-18,47.4-65c0-47.7-54.9-75.3-73.5-78.1c-17-2.8-23.8,5.6-25.4,7.8 c-1.6,2.2-4.2,4.1-8,5.9c-3.9,1.8-1.5-0.1-15.4,9.8c-13.9,9.8-41.8-4-44.1-4.6c-2.3-0.5-6.8-1.8-8,4.6c-1.5,9.6,6.7,25.4,6.7,25.4 s-2.2,0.2-8,3.3c-5.8,3.1-2.8,7.7-1.3,9.1c1.4,1.4,27.9,16.3,32.1,18.9c10.6,5.3,20.3,31.6-7.3,51.4C-3.1,163,0.4,198.7,0.4,198.7 s-12,85.2,126.9,85.2c139,0,155.6-96.1,155.6-124.2C283,131.5,272.4,114.1,258.3,114.1z M89.5,50.2c-7.1,6.5-15.7,8-19.3,3.5 c-3.6-4.6-0.7-13.5,6.3-20c7.1-6.5,15.7-8,19.3-3.5C99.4,34.7,96.6,43.7,89.5,50.2z M76.1,38.9c-4.7,4.3-6.6,10.3-4.2,13.3 c2.4,3,8.1,2,12.9-2.3c4.7-4.3,6.6-10.3,4.2-13.3C86.6,33.6,80.9,34.6,76.1,38.9z"/></g></g></svg>'))},getIconSVG:function(t,e,i,n){var o,a;if(arguments.length<4&&(n=i,i={}),this.iconXhr&&this.iconXhr.abort(),!t)return n(null,{$svg:this.getDefaultIconSVG(),noun_url:null});if(!i.noCache&&(o=this.getSVGCacheItem(t))){var s=this.processNounIcon(o);return n(null,s)}this.iconRequestInProgress=!0;var l=function(e){e.noCache||this.cacheSVGData({id:t,svg:e.svg,noun_url:e.new_url});var i=this.processNounIcon(e);return n(null,i)}.bind(this);a={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){l(t)},error:function(t){return"abort"==!t.statusText&&console.log("icon xhr : ",t),n(t)},complete:function(){},context:this},/^rm/.test(t)&&O.a.extend(a,{method:"GET",url:e,cache:!1,success:function(t){l({svg:Object(r.a)(t).find("svg"),new_url:e,noCache:!0})},data:null,dataType:null}),this.iconXhr=r.a.ajax(a)},processNounIcon:function(t){var e=Object(r.a)("<div></div>").append(Object(r.a)(t.svg)).find("svg");if(e.length)return{$svg:e=this.prepareIconSVG(e),noun_url:t.new_url}},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(r.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var n=e.get(0).getBBox();return e.remove(),this.currenIconSVGAcpectRatio=n.width/n.height,i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",n.x+" "+n.y+" "+n.width+" "+n.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){var e=JSON.parse(window.localStorage.getItem("noun_icons"))||{};e[t.id]=O.a.omit(t,"id");try{window.localStorage.setItem("noun_icons",JSON.stringify(e))}catch(t){window.localStorage.removeItem("noun_icons")}},getSVGCacheItem:function(t){var e=(JSON.parse(window.localStorage.getItem("noun_icons"))||{})[t];if(e)return O.a.extend({id:t},e)},fixLineHeight:function(){var t=this.model.get("h"),e=this.model.get("y"),i=this.model.get("weight"),n=i>this.LINE_BLOCK_HEIGH?i:this.LINE_BLOCK_HEIGH,o=Math.floor((t-n)/2);this.model.set({h:n,y:e+o})},makeSquare:function(){var t=this.model.get("x"),e=this.model.get("w"),i=this.model.get("h"),n=Math.floor((e-i)/2);this.model.set({w:i,x:t+n})},destroy:function(){this.model.off("change:tp",this.onTypeChange),this.model.off("change:is_full_width",this.onStrechBlockChange),this.model.off("change:is_full_height",this.onStrechBlockChange),l.a.prototype.destroy.apply(this,arguments),this.stopListening(this),this.$el.off()}},{defaults:{tp:"rectangle",bg_color:"000000",bg_opacity:1,color:"ffffff",opacity:1,borders:0,radius:0,sides:3,weight:1,stroke:"solid"}}),Wt=i("60Nw"),Gt=l.a.extend({name:"Code",sort_index:15,thumb:"iframe",icon_color:"#8B228C",iframe_controls:["iframe_edit"],initialize:function(t,e){this.mag=e.mag,this.frameClass=qt,this.controls=O.a.union(this.iframe_controls,this.controls),this.initBlock(t,e)},onCreate:function(){this.showPanel()},configurePlugin:function(t){var e=Wt.a.findPlugin(this.model.toJSON());return e?new e({block:this}):null},render:function(){l.a.prototype.render.apply(this,arguments),this.$el.addClass("iframe"),this.$el.on("dblclick",this.onDoubleClick),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),this.triggerReady()},redraw:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.checkNeedRedraw(t,e)){var i,n,o=this.model.changedAttributes(),a=!0,s=!1;if(l.a.prototype.redraw.apply(this,arguments),O.a.isObject(o)&&(a=!(0===O.a.without(O.a.keys(o),"x","y","z","w","h").length),s=O.a.contains(O.a.keys(o),"code")),a){if(this.$content.empty(),this.$container=Object(r.a)('<div class="container"></div>'),this.$content.append(this.$container),this.$content.append(Object(r.a)('<div class="overlay"></div>')),this.$el.removeAttr("data-plugin"),n=t.get("code"),this.plugin=null,n){if(this.plugin=this.configurePlugin(n),!this.plugin)return;this.plugin.parse(n,function(e){(i=this.plugin.sanitize(e))&&i.length&&this.plugin.draw(i,this.$container,function(e,i){this.$el.attr("data-plugin",this.plugin.embed_type),(s||this.plugin.forceFrameSize)&&(e&&!this.isFullWidth()&&t.set("w",e),i&&!this.isFullHeight()&&t.set("h",i)),this.proportional=this.plugin.proportional,this.plugin.resizable&&this.$content.find(this.plugin.containerSelector).css({width:"100%",height:"100%","max-width":"","max-height":""})}.bind(this))}.bind(this))}this.$el.toggleClass("empty",!n)}}},showPanel:function(){this.openCodeEditor({model:this.model})},hidePanel:function(){this.closeCodeEditor()},openCodeEditor:function(t){RM.constructorRouter.openCodeEditor(t)},closeCodeEditor:function(t){RM.constructorRouter.closeCodeEditor()},onDoubleClick:function(t){RM.constructorRouter.isCodeEditorVisible||this.trigger("editCodeClick")},deselect:function(){RM.constructorRouter.closeCodeEditor(),l.a.prototype.deselect.apply(this,arguments)},destroy:function(){var t=!0;RM.constructorRouter.closeCodeEditor(t),l.a.prototype.destroy.apply(this,arguments)}},{defaults:{use_iframe:!0}}),qt=b.a.extend({customResizeHandler:function(t){return this.block.plugin&&O.a.isFunction(this.block.plugin.customResizeHandler)?this.block.plugin.customResizeHandler.apply(this,arguments):t}}),Kt=Gt,Xt=i("w4Sg"),Yt=i.n(Xt),Zt=l.a.extend({name:"Maps",sort_index:10,thumb:"gmaps",icon_color:"#8E5B12",initial_controls:["gmaps_settings","gmaps_edit","common_animation","common_position","common_layer","common_lock"],initialize:function(t,e){this.mag=e.mag,this.frameClass=Jt,this.initBlock(t,e),this.initOpts()},render:function(){l.a.prototype.render.apply(this,arguments),this.triggerReady(),this.$el.addClass("gmaps"),this.$content.html(Yt.a["template-constructor-block-gmaps"]()),this.$search=Object(r.a)(Yt.a["template-constructor-block-gmaps-search-control"]()),this.search=this.$search.get(0),this.$source=this.$search.find(".rm-search.source"),this.$destination=this.$search.find(".rm-search.destination"),this.$apiKeyBlock=this.$content.find(".rm-gmaps-key"),this.$apiKeyInput=this.$apiKeyBlock.find("input"),this.$apiKeyApply=this.$apiKeyBlock.find("button"),O.a.extend(this.frame,{minwidth:240,minheight:210}),this.setControls(),this.generateMap(this.bindLogic)},generateMap:function(t){var e=this.model.get("api_key");this.$apiKeyBlock[e?"addClass":"removeClass"]("hidden"),Rt.a.initGMapsAPI(e,function(){var e,i,n,o,a,s,r,l=this.model.get("current_type");O.a.defer(function(){this.map=new google.maps.Map(this.$(".map-container").get(0),{zoom:this.model.get("map_zoom"),center:new google.maps.LatLng(this.model.get("center_lat"),this.model.get("center_lng")),mapTypeId:this.model.get("map_type_id")||google.maps.MapTypeId.ROADMAP,streetViewControl:!1}),this.marker=new google.maps.Marker({map:this.map,draggable:!0}),this.sourceAutocomplete=new google.maps.places.Autocomplete(this.$source.get(0),{}),this.destinationAutocomplete=new google.maps.places.Autocomplete(this.$destination.get(0),{}),this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,e=this.model.get("marker_lat"),i=this.model.get("marker_lng"),e&&i&&"directions"!=l&&this.dropMarker(new google.maps.LatLng(e,i)),n=this.model.get("direction_start_lat"),o=this.model.get("direction_start_lng"),a=this.model.get("direction_end_lat"),s=this.model.get("direction_end_lng"),r=this.model.get("direction_route_type"),n&&o&&a&&s&&r&&(this.source=new google.maps.LatLng(n,o),this.destination=new google.maps.LatLng(a,s)),this.onMapTypeChange(),this.onShowControlsChange(),this.redraw(this.model,{skipTriggerRedraw:!0,doNotRedrawPacksFrames:!0,doNotRedrawBottomShiftLine:!0}),t&&t()}.bind(this))}.bind(this))},redraw:function(t,e){e=e||{},this.checkNeedRedraw(t,e)&&l.a.prototype.redraw.apply(this,arguments)},onMapTypeChange:function(t){var e=this.model.get("current_type");this.$destination.toggleClass("hidden","directions"!==e),this.marker.setVisible("directions"!==e),"directions"!==e?this.clearRoute():this.drawRoute(!t),"custom"==e&&this.model.get("custom_json")?this.applyCustomStyle():this.clearCustomStyle()},onSourceChage:function(){var t=this.sourceAutocomplete.getPlace();if(t.geometry){if(this.source=t.geometry.location,"directions"==this.model.get("current_type"))return this.drawRoute();this.marker.setVisible(!1),t.geometry.viewport?this.map.fitBounds(t.geometry.viewport):(this.map.setCenter(t.geometry.location),this.map.setZoom(17)),this.model.set("formatted_address",t.formatted_address),this.dropMarker(t.geometry.location)}},onDestinationChange:function(){var t=this.destinationAutocomplete.getPlace();t.geometry&&(this.destination=t.geometry.location,this.drawRoute())},drawRoute:function(t){var e=this.model.get("direction_route_type");this.source&&this.destination&&e&&(this.directionsDisplay.setMap(null),this.directionsService.route({origin:this.source,destination:this.destination,travelMode:google.maps.TravelMode[e.toUpperCase()]},function(e,i){var n;if(i==google.maps.DirectionsStatus.OK)this.directionsDisplay.setDirections(e),this.directionsDisplay.setOptions({preserveViewport:t||!1}),this.directionsDisplay.setMap(this.map),this.model.set({direction_start_lat:this.source.lat(),direction_start_lng:this.source.lng(),direction_end_lat:this.destination.lat(),direction_end_lng:this.destination.lng()}),google.maps.event.trigger(this.map,"resize"),O.a.defer(function(){n=this.map.getCenter(),this.model.set({center_lat:n.lat(),center_lng:n.lng(),map_zoom:this.map.getZoom()})}.bind(this));else{if(!this.model.get("api_key"))return;this.showMessage("Sorry, there's no route for selected directions.")}}.bind(this)))},clearRoute:function(){this.directionsDisplay.setMap(null)},dropMarker:function(t){this.marker.setPosition(t),this.marker.setAnimation(google.maps.Animation.DROP),this.marker.setVisible(!0),this.markerDropped=!0},setControls:function(){this.controls=this.initial_controls},bindLogic:function(){this.listenTo(this.model,"change:current_type",this.onMapTypeChange),this.listenTo(this.model,"change:custom_json",this.applyCustomStyle),this.listenTo(this.model,"change:direction_route_type",this.onRouteTypeChange),this.listenTo(this.model,"change:show_controls",this.onShowControlsChange),this.listenTo(this.model,"change:api_key",this.onApiKeyChange),this.listenTo(this.model,"change",this.hideMessage),google.maps.event.addListener(this.sourceAutocomplete,"place_changed",this.onSourceChage),google.maps.event.addListener(this.destinationAutocomplete,"place_changed",this.onDestinationChange),google.maps.event.addListener(this.marker,"dragend",this.onMarkerDragEnd),google.maps.event.addListener(this.map,"maptypeid_changed",this.onMapTypeIdChange),this.$source.on("click",this.onInputClick),this.$destination.on("click",this.onInputClick),this.$el.on("dblclick",function(){this.inEditState||this.trigger("editMapClick")}.bind(this)),A.a.on("gmaps:update_key",this.updateKey),this.$apiKeyInput.on("click",this.onApiKeyInputClick),this.$apiKeyApply.on("click",this.onApiKeyApply)},unbindLogic:function(){this.stopListening(this.model),window.google&&window.google.maps&&(google.maps.event.clearListeners(this.sourceAutocomplete,"place_changed"),google.maps.event.clearListeners(this.destinationAutocomplete,"place_changed"),google.maps.event.clearListeners(this.marker,"dragend")),this.$source.off("click",this.onInputClick),this.$destination.off("click",this.onInputClick),this.$el.off("dblclick"),A.a.off("gmaps:update_key",this.updateKey),this.$apiKeyInput.off("click",this.onApiKeyInputClick),this.$apiKeyApply.off("click",this.onApiKeyApply)},enterEditState:function(){this.inEditState=!0,this.disableDragging=!0,this.$(".map-overlay").hide(),this.$el.addClass("edit-map"),this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(this.search),O.a.delay(function(){this.$source.focus()}.bind(this),300),this.onShowControlsChange()},exitEditState:function(){var t,e,i={};this.inEditState&&(this.disableDragging=!1,this.$(".map-overlay").show(),this.$el.removeClass("edit-map"),this.map.controls[google.maps.ControlPosition.TOP_LEFT].pop(),this.inEditState=!1,this.onShowControlsChange(),t=this.map.getCenter(),O.a.extend(i,{center_lat:t.lat(),center_lng:t.lng(),map_zoom:this.map.getZoom()}),this.markerDropped&&(e=this.marker.getPosition(),O.a.extend(i,{marker_lat:e.lat(),marker_lng:e.lng()})),this.model.set(i))},onMarkerDragEnd:function(){var t=this.marker.getPosition();this.model.set({marker_lat:t.lat(),marker_lng:t.lng(),formatted_address:""})},onMapTypeIdChange:function(){var t=this.map.getMapTypeId();this.model.set({map_type_id:t})},onInputClick:function(t){var e=Object(r.a)(t.currentTarget);O.a.defer((function(){e.select()}))},applyCustomStyle:function(){var t=this.model.get("custom_json");t?this.map.setOptions({styles:JSON.parse(t)}):this.map.setOptions({styles:null})},clearCustomStyle:function(){this.map.setOptions({styles:null})},onRouteTypeChange:function(){this.drawRoute()},onShowControlsChange:function(){var t=this.inEditState||this.model.get("show_controls");t!=this.isControlsVisible&&(this.map.setOptions({panControl:t,zoomControl:t,mapTypeControl:t,scaleControl:t}),this.isControlsVisible=t)},onApiKeyChange:function(t,e){this.model.save(),A.a.trigger("gmaps:update_key",this.model.get("api_key"),this.model.get("_id")),this.regenerateMap(),this.viewOpts.saveOpts({gmaps_key:e})},updateKey:function(t,e){this.model.get("_id")!==e&&this.model.get("api_key")!==t&&(this.model.set("api_key",t,{silent:!0}),this.model.save(),this.regenerateMap())},regenerateMap:function(){Rt.a.destroyGMapsAPI(),O.a.defer(function(){this.generateMap()}.bind(this))},onApiKeyInputClick:function(t){t.stopImmediatePropagation()},onApiKeyApply:function(t){t.stopImmediatePropagation();var e=this.$apiKeyInput.val();e&&39===e.length&&(this.model.set("api_key",e),this.$apiKeyInput.val(""),this.$apiKeyApply.addClass("hidden"))},initOpts:function(){var t=this,e=Backbone.Model.extend({url:"/api/mag/opts/"+this.mag.get("num_id")});this.viewOpts=new e(this.mag.get("opts")||{}),this.viewOpts.saveOpts=function(){this.save.apply(this,arguments),t.mag.set("opts",this.toJSON())}},showMessage:function(t){this.$(".message-overlay").text(t).removeClass("invisible")},hideMessage:function(){this.$(".message-overlay").addClass("invisible")},deselect:function(){l.a.prototype.deselect.apply(this,arguments),this.exitEditState()},destroy:function(){this.unbindLogic(),l.a.prototype.destroy.apply(this,arguments)}},{defaults:{current_type:"standard",center_lat:30,center_lng:-47,map_zoom:2,show_controls:!0,scrollwheel:!0}}),Jt=b.a.extend({onResize:function(t,e){b.a.prototype.onResize.apply(this,arguments),this.block.map&&window.google&&window.google.maps&&google.maps.event.trigger(this.block.map,"resize")}}),Qt=Zt,te=i("lRGI"),ee=i("Fts9"),ie=l.a.extend({name:"Button",sort_index:7,thumb:"button",icon_color:"#c80000",viewport_fields:g.b.viewport_fields.button,initial_controls:["button_settings","button_icon","button_edit","picture_link","common_animation","common_position","common_layer","common_lock"],MIN_FONT_SIZE:8,MAX_FONT_SIZE:999,MIN_LETTER_SPACING:-99,MAX_LETTER_SPACING:999,DEFAULT_BACKGROUND_COLOR:"c80000",RASTERIZE_MULTIPLIER:2,settingsOnCreate:!1,initialize:function(t,e){this.mag=e.mag,this.initBlock(t,e),this.isEditMode=!1,this.buttonState="default",this._oldAttrs=O.a.clone(this.model.attributes),this.onTextInput.__debounced=O.a.debounce(this.onTextInput,20),this.onIconChange.__debounced=O.a.debounce(this.onIconChange,20),this.onIconColorChange.__debounced=O.a.debounce(this.onIconColorChange,20),this.recalcIconContainerSize.__debounced=O.a.debounce(this.recalcIconContainerSize,20),this.onTextContainerSizeChange.__debounced=O.a.debounce(this.onTextContainerSizeChange,20),this.rasterizeSVG.__debounced_default=O.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_hover=O.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_current=O.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_both=O.a.debounce(this.rasterizeSVG,100)},render:function(){var t,e=O.a.clone(this.model.attributes),i=e.tp;this.create(),this.$el.addClass("button"),t={model:e,$container:this.$content,environment:"constructor",mag:this.mag,block:this},this.buttonWidget=new te.a(t),this.$button=this.$(".common-button"),this.$textInput=this.$button.children(".text"),this.$buttonIcon=this.$button.children(".icon"),"icon"!==i&&"text_and_icon"!==i||this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(this.renderIcon({$svg:this.getСoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this)),this.recalcButtonSize(),this.disableTextInput(),this.handleSelectionColor(),this.bindDOMEvents(),this.bindModelEvents(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.model.created&&setTimeout(function(){this.enterEditMode({selectText:!0})}.bind(this),500),this.triggerReady()},redraw:function(t,e){return this.proportional&&t.get("w")!=t.get("h")&&this.recalcButtonSize(),l.a.prototype.redraw.apply(this,arguments)},bindDOMEvents:function(){this.$el.on("mousedown",this.onButtonMousedown),this.$button.on("dblclick",this.onButtonDoubleClick),this.$textInput.on("input",this.onTextInput)},unbindDOMEvents:function(){this.$el.off("mousedown",this.onButtonMousedown),this.$button.off("dblclick",this.onButtonDoubleClick),this.$textInput.off("input",this.onTextInput)},bindModelEvents:function(){this.model.on("change:tp",this.onTypeChange,this),this.model.on("change:form",(function(t,e,i){this.onFormChange(t,e,i)}),this),this.model.on("change:icon_enabled",this.determineButtonType,this),this.model.on("change:text",(function(t,e,i){(i.undo||i.redo||i.socketUpdate)&&this.$textInput.val(this.model.get("text"))}),this),this.model.on("change:text_w change:text_h",(function(){this.onTextContainerSizeChange()}),this);var t=this.getIndividualStyles();this.model.on(t,(function(){var t=O.a.clone(this.model.attributes);this.buttonWidget.generateIndividualStyleCSS({env:"constructor",model:t}),this.onTextInput()}),this),this.model.on("change:current-font-family change:current-font-weight change:current-font-style",(function(){this.waitOnExactWebFontLoaded()}),this),this.model.on("change:font-family change:font-weight change:font-style",(function(){this.waitOnExactWebFontLoaded()}),this),this.model.on("change:icon_enabled change:icon_noun_id change:icon_rm_id change:icon_noun_url",(function(t,e,i){this.onIconChange.__debounced(t,e,i)}),this),this.model.on("change:icon_h",(function(t,e,i){this.recalcIconContainerSize(t,e,i)}),this),this.model.on("change:icon_pos",(function(t,e,i){this.onIconPositionChange(),this.recalcButtonSize()}),this),this.model.on("change:icon_color change:icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i)}),this),this.model.on("change:hover-icon_color change:hover-icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i,"hover")}),this),this.model.on("change:current-icon_color change:current-icon_color_opacity",(function(t,e,i){this.onIconColorChange(t,e,i,"current")}),this)},getIndividualStyles:function(){var t=["background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","current-background-color","current-background-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity","current-color","current-color-opacity","current-font-family","current-font-style","current-font-weight","current-font-size","current-letter-spacing"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")},onFormChange:function(t,e,i){var n=!1;if(!i.undo&&!i.redo){this.model.get("form");n=!0}this.recalcButtonSize({onFormChange:!0,adjust_height_to_content_for_rectangle:n})},onIconPositionChange:function(){this.buttonWidget.applyIconContainerSize(O.a.clone(this.model.attributes)),this.buttonWidget.applyIconPosition(O.a.clone(this.model.attributes))},onTextContainerSizeChange:function(){this.buttonWidget.applyTextContainerSize(O.a.clone(this.model.attributes))},onIconColorChange:function(t,e,i,n){if(n=n||"default","text"!==this.model.get("tp")&&(this.renderIcon({$svg:this.getСoloredIconSVG({buttonState:n})}),!(i.onIconChange||i.undo||i.redo))){var o=this.rasterizeSVG["__debounced_"+n];if(O.a.isFunction(o)){var a={};a[n]=!0,o(a)}}},"getСoloredIconSVG":function(t){t=t||{};var e,i,n,o,a=O.a.clone(this.model.attributes),s=this.currentIconData.$svg.clone();return"hover"===(e="default"===t.buttonState?"default":"hover"===t.buttonState||"hover"===this.buttonState?"hover":"current"===t.buttonState||"current"===this.buttonState?"current":"default")?(i=a["hover-icon_color"],n=a["hover-icon_color_opacity"]/100):"current"===e?(i=a["current-icon_color"]||a.icon_color,n=(O.a.isUndefined(a["current-icon_color_opacity"])?a.icon_color_opacity:a["current-icon_color_opacity"])/100):(i=a.icon_color,n=a.icon_color_opacity/100),o=v.default.getRGBA(i,1),s.find("*:not(.fixed-color)").each((function(){var t=Object(r.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),s.get(0).setAttribute("fill",o),s.get(0).setAttribute("fill-opacity",n),s},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;this.isEditMode&&!e&&(this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.workspace.trigger("redraw"))}},onButtonMousedown:function(t){this.isEditMode&&!Object(r.a)(t.target).is(".text")&&this.leaveEditMode({deselectControl:!0,saveWidgetData:!0})},onButtonDoubleClick:function(){this.model.get("pack_id")?l.a.prototype.onDblClick.apply(this,arguments):this.selected&&!this.isEditMode&&this.enterEditMode({selectText:!0})},enterEditMode:function(t){t=t||{},this.isEditMode=!0,this.determineButtonType({enter_edit_mode:!0}),this.enableTextInput(),t.selectText?this.$textInput.select():Object(r.a)(this.$textInput).focus().setCursorPos(0);var e,i=this.workspace&&this.workspace.controls;i&&(e=i.findControl("button_edit"))&&e.master.select(e)},leaveEditMode:function(t){if(t=t||{},this.model.set("text",this.$textInput.val()),this.isEditMode=!1,this.$textInput.blur(),this.disableTextInput(),this.determineButtonType(),t.saveWidgetData&&this.saveWidgetData(),t.deselectControl){var e,i=this.workspace&&this.workspace.controls;if(!i)return;if(!(e=i.findControl("button_edit")))return;e.master.deselect()}},disableTextInput:function(){this.$textInput.attr("readonly",!0)},enableTextInput:function(){this.$textInput.removeAttr("readonly")},onTextInput:function(){this.recalcTextInputSize(),this.recalcButtonSize()},recalcTextInputSize:function(){var t,e,i,n,o=this.$button.hasClass("current")?"current-":"",a=O.a.clone(this.model.attributes),s=a["".concat(o,"font-size")],l=a["".concat(o,"letter-spacing")],c=a["".concat(o,"font-family")],d=a["".concat(o,"font-style")],h=a["".concat(o,"font-weight")];this.$textInputSizeAdjuster&&this.$textInputSizeAdjuster.length||(this.$textInputSizeAdjuster=Object(r.a)("<div/>"),this.$textInputSizeAdjuster.css({position:"absolute",left:"-9999px","white-space":"pre",width:"auto"}).appendTo(this.$textInput.parent())),this.$textInputSizeAdjuster[0].className=this.$textInput[0].className,this.$textInputSizeAdjuster.addClass("fake"),this.$textInputSizeAdjuster.text(this.$textInput.val()),this.$textInputSizeAdjuster.css({"font-family":c,"font-style":d,"font-weight":h,"font-size":s+"px","letter-spacing":l+"px"}),t=this.$textInputSizeAdjuster.width(),e=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.css("letter-spacing",0).text("M"),i=this.$textInputSizeAdjuster.width(),i=2*Math.ceil(i/2),n=this.$textInputSizeAdjuster.height(),0===this.$textInput.val().trim().length&&(t=i,e=n),t=2*Math.ceil(t/2),t+=i,e=2*Math.ceil(e/2),this.model.set({text_w:t,text_h:e,em_w:i})},recalcButtonSize:function(t){t=t||{};var e,i,n,o,a,s=O.a.clone(this.model.attributes),r=s.tp,l=s.form,c=s.w,d=s.h,h=s.x,u=s.y,p=s.text_w,g=s.text_h,m=s.em_w,f=s.icon_w,v=s.icon_h,b=s.icon_pos,_={};"text_and_icon"===r?(i=p+f,i+=2*m,i+=this.buttonWidget.calcIconMarginFromText(f),"left"!==b&&"right"!==b||(v>g?(n=v,n+=2*this.buttonWidget.calcIconTopBottomMargin(v)):(n=g,n+=2*this.buttonWidget.calcTextTopBottomMargin(s["font-size"])))):"text"===r?(i=p,i+=2*m,n=g,n+=this.buttonWidget.calcTextTopBottomMargin(s["font-size"])):"icon"===r&&(i=f+(e=this.buttonWidget.calcIconMarginFromText(f)),n=v+e),i>c&&(o=i),n>d&&(a=n);c=o||c,d=a||d;var y=Math.floor((c-d)/2);"circle"===l||"square"===l?(c>d?O.a.extend(_,{w:c,h:c,y:u-y,x:h-Math.floor((c-this.model.get("w"))/2)}):O.a.extend(_,{w:d,h:d,x:h+y,y:u-(d-this.model.get("h"))/2}),this.proportional=!0):"rectangle"===l&&(o&&O.a.extend(_,{w:o,x:h-Math.floor((o-this.model.get("w"))/2)}),a?O.a.extend(_,{h:a,y:u-(a-this.model.get("h"))/2}):t.adjust_height_to_content_for_rectangle&&O.a.extend(_,{h:n,y:u+Math.floor(((o||c)-n)/2)}),this.proportional=!1),t.onFormChange&&this.$el.addClass("resize-transition"),_.w&&"circle"===l?this.buttonWidget.applyCircleRadius():this.$button.css("border-radius",""),this.model.set(_),setTimeout(function(){window.requestAnimationFrame(function(){this.$el.removeClass("resize-transition")}.bind(this))}.bind(this),450),this.setSizeConstraints(i,n)},setSizeConstraints:function(t,e){O.a.extend(this.frame,{minwidth:t,maxwidth:9999,minheight:e,maxheight:9999})},determineButtonType:function(t){t=t||{};var e,i=this.model.get("icon_enabled"),n=!!t.enter_edit_mode||this.$textInput.val().trim().length;e=i&&n?"text_and_icon":i&&!n?"icon":"text",this.model.set("tp",e)},onTypeChange:function(){this.buttonWidget.applyIconContainerSize(O.a.clone(this.model.attributes)),this.buttonWidget.applyButtonType(this.model.get("tp")),this.recalcButtonSize()},waitOnExactWebFontLoaded:function(){var t=O.a.clone(this.model.attributes);O.a.indexOf(ot.a.systemFontsList,t["font-family"].toLowerCase())>-1||P.a.exactWaitForFontLoad(t["font-family"],t["font-weight"],t["font-style"],this.onTextInput)},saveWidgetData:function(){O.a.isEqual(this.model.toJSON(),this._oldAttrs)||(this.saveXHR&&this.saveXHR.abort(),this._oldAttrs=O.a.clone(this.model.toJSON()),this.saveXHR=this.model.save())},deselect:function(t){l.a.prototype.deselect.apply(this,arguments),t!=this&&this.isEditMode&&(this.leaveEditMode({saveWidgetData:!0}),this.workspace.trigger("redraw"))},getSaveBoxOptions:function(t){return O.a.extend({patch:!0},t)},destroy:function(){this.buttonWidget&&this.buttonWidget.destroy(),this.buttonWidget=null,this.unbindDOMEvents(),this.model.off(null,null,this),l.a.prototype.destroy.apply(this,arguments)},MAX_ICON_CACHE_SIZE:30,onIconChange:function(t,e,i){t=O.a.clone(this.model.attributes),this.getIconSVG(t.icon_noun_id||t.icon_rm_id,t.icon_noun_url,function(t,e){!t&&e.$svg&&(i.undo||i.redo||this.recalcIconContainerSize(null,null,{onIconChange:!0}),this.renderIcon({$svg:this.getСoloredIconSVG()}),i.undo||i.redo||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this))},areValuesLinked:function(t,e,i,n){var o=O.a.clone(this.model.attributes),a="default"===e?"":e+"-";return o[("default"===t?"":t+"-")+i]==o[a+(n||i)]},isTextAndIconColorLinked:function(t,e){return t=t||"default",(e=e||{}).compare_only_color?this.areValuesLinked(t,t,"color","icon_color"):this.areValuesLinked(t,t,"color","icon_color")&&this.areValuesLinked(t,t,"color-opacity","icon_color_opacity")},isTextAndIconSizeLinked:function(t){return t=t||"default",this.areValuesLinked(t,t,"font-size","icon_h")},recalcIconContainerSize:function(t,e,i){if("text"!==this.model.get("tp")){var n,o=this.model.get("icon_h");n=Math.floor(o*this.currentIconData.aspect_ratio),this.model.set({icon_w:n}),this.recalcButtonSize(),this.buttonWidget.applyIconContainerSize(O.a.clone(this.model.attributes)),i.onIconChange||i.undo||i.redo||this.rasterizeSVG.__debounced_both({default:!0,hover:!0,current:!0})}},rasterizeSVG:function(t){if((t=t||{}).default||t.hover||t.current){var e=function(e){e=e||"default";var i=this.getСoloredIconSVG({buttonState:e});if(i||i.length){var n={default:"icon",hover:"hover-icon",current:"current-icon"},o=O.a.isUndefined(n[e])?n.default:n[e],a={width:this.model.get("icon_w")*this.RASTERIZE_MULTIPLIER,height:this.model.get("icon_h")*this.RASTERIZE_MULTIPLIER},s=e+"_icon_SVG_rasterize_Xhr";this[s]&&this[s].abort();var r=t[e+"Callback"];this[s]=jt.rasterize({widgets:[this.model],svg:i,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:a,prefix:o,onSuccess:function(t){r&&r(null,t)},onError:function(t){r&&r(t)}})}}.bind(this);t.default&&e("default"),t.hover&&e("hover"),t.current&&e("current")}},renderIcon:function(t){var e;e=(t=t||{}).$svg?t.$svg:this.getСoloredIconSVG(),this.$buttonIcon.empty().html(e.clone())},getDefaultIconSVG:function(){return this.prepareIconSVG(Object(r.a)('<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="283.5px" height="283.5px" viewBox="0 0 283.5 283.5" enable-background="new 0 0 283.5 283.5" xml:space="preserve"><g><g><path fill-rule="evenodd" clip-rule="evenodd" fill="#231F20" d="M258.3,114.1c-14.1,0-23.1,25-30.1,33.8 c-7,8.8-33.3,2.7-44.1,0.7c-10.7-2.1-38.7-3.9-38.7-3.9s47.4-18,47.4-65c0-47.7-54.9-75.3-73.5-78.1c-17-2.8-23.8,5.6-25.4,7.8 c-1.6,2.2-4.2,4.1-8,5.9c-3.9,1.8-1.5-0.1-15.4,9.8c-13.9,9.8-41.8-4-44.1-4.6c-2.3-0.5-6.8-1.8-8,4.6c-1.5,9.6,6.7,25.4,6.7,25.4 s-2.2,0.2-8,3.3c-5.8,3.1-2.8,7.7-1.3,9.1c1.4,1.4,27.9,16.3,32.1,18.9c10.6,5.3,20.3,31.6-7.3,51.4C-3.1,163,0.4,198.7,0.4,198.7 s-12,85.2,126.9,85.2c139,0,155.6-96.1,155.6-124.2C283,131.5,272.4,114.1,258.3,114.1z M89.5,50.2c-7.1,6.5-15.7,8-19.3,3.5 c-3.6-4.6-0.7-13.5,6.3-20c7.1-6.5,15.7-8,19.3-3.5C99.4,34.7,96.6,43.7,89.5,50.2z M76.1,38.9c-4.7,4.3-6.6,10.3-4.2,13.3 c2.4,3,8.1,2,12.9-2.3c4.7-4.3,6.6-10.3,4.2-13.3C86.6,33.6,80.9,34.6,76.1,38.9z"/></g></g></svg>'))},getIconSVG:function(t,e,i){var n,o,a;if(this.iconXhr&&this.iconXhr.abort(),!t){var s=this.getDefaultIconSVG();return a={$svg:s,noun_url:null,aspect_ratio:s.data("aspect_ratio")},this.currentIconData=a,i(null,a)}if(n=this.getSVGCacheItem(t))return a={$svg:n.$svg,noun_url:n.noun_url,aspect_ratio:n.$svg.data("aspect_ratio")},this.currentIconData=a,i(null,a);var l=function(e){var n=Object(r.a)("<div></div>").append(Object(r.a)(e.svg)).find("svg");if(n.length)return n=this.prepareIconSVG(n),a={id:t,$svg:n,noun_url:e.new_url,aspect_ratio:n.data("aspect_ratio")},this.currentIconData=a,this.cacheSVGData(a),i(null,{$svg:n,noun_url:e.new_url})}.bind(this);o={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this.iconRequestInProgress=!1,l(t)},error:function(t){return this.iconRequestInProgress=!1,i(t)},context:this},/^rm/.test(t)&&O.a.extend(o,{method:"GET",url:e,cache:!1,success:function(t){this.iconRequestInProgress=!1,l({svg:Object(r.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this.iconRequestInProgress=!0,this.iconXhr=r.a.ajax(o)},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(r.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var n=e.get(0).getBBox();return e.remove(),i.data("aspect_ratio",n.width/n.height),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",n.x+" "+n.y+" "+n.width+" "+n.height),i.get(0).setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},cacheSVGData:function(t){window.iconSVGCache.push(t),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift()},getSVGCacheItem:function(t){return window.iconSVGCache&&O.a.findWhere(window.iconSVGCache,{id:t})},handleSelectionColor:function(t){t=t||ee.a.prototype.hex2rgb(this.model.get("background-color")).concat(1);var e=ee.a.prototype.hex2rgb(this.DEFAULT_BACKGROUND_COLOR).concat(1);this.$button.toggleClass("is-contrast-selection",ee.a.prototype.areColorsClose(t,e))}},{defaults:{tp:"text",form:"rectangle",text:"Edit",w:134,h:50,x:"center",transition:!1,text_w:48,text_h:26,em_w:16,"background-color":"c80000","background-color-opacity":100,"border-radius":5,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,color:"ffffff","color-opacity":100,"font-size":18,"letter-spacing":0,"hover-background-color":"c80000","hover-background-color-opacity":80,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-color":"ffffff","hover-color-opacity":100,"current-background-color":"c80000","current-background-color-opacity":100,"current-border-radius":5,"current-border-width":0,"current-border-color":"000000","current-border-color-opacity":100,"current-font-family":"Arial","current-font-style":"normal","current-font-weight":400,"current-color":"ffffff","current-color-opacity":100,"current-font-size":18,"current-letter-spacing":0,icon_enabled:!1,icon_h:18,icon_w:18,icon_pos:"left",icon_noun_id:null,icon_rm_id:null,icon_noun_url:null,icon_color:"ffffff",icon_color_opacity:100,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,"current-icon_color":"ffffff","current-icon_color_opacity":100,icon_rasterUrl:null,icon_raster2xUrl:null,"hover-icon_rasterUrl":null,"hover-icon_raster2xUrl":null,"current-icon_rasterUrl":null,"current-icon_raster2xUrl":null}}),ne=i("cBBe"),oe=i("U72E"),ae=i.n(oe),se=o.a.View.extend({initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.a.bindAll(this),(t.positions||t.positions.length)&&(this.positions=t.positions,this.workspace_inside_block=t.workspace_inside_block,this.render(),this.bind_events())},render:function(){this.resize_handles_fragment=window.document.createDocumentFragment(),this.positions.forEach(O.a.bind((function(t){Object(r.a)("<div/>").addClass("resize-handle").addClass(t).attr("data-pos",t).appendTo(this.resize_handles_fragment)}),this)),this.workspace_inside_block.$el.append(this.resize_handles_fragment),this.$resize_handles=this.workspace_inside_block.$el.children(".resize-handle"),this.apply_resize_handles_visual_state()},apply_resize_handles_visual_state:function(){var t=this.workspace_inside_block.block.model.get("tip_pos"),e=this.workspace_inside_block.get_visible_blocks();if(e.length){var i=O.a.find(e,(function(t){return"picture"===t.model.get("type")}));if(this.$resize_handles.removeClass("hidden"),i&&!1===i.originalLoaded)this.$resize_handles.addClass("hidden");else if(1===e.length){var n=e[0].model.get("type");"text"===n&&(this.$resize_handles.filter('[data-pos="bottom"]').addClass("hidden"),this.$resize_handles.filter('[data-pos="top"]').addClass("hidden"))}"top"===t?this.$resize_handles.filter('[data-pos="bottom"]').addClass("hidden"):"right"===t?this.$resize_handles.filter('[data-pos="left"]').addClass("hidden"):"bottom"===t?this.$resize_handles.filter('[data-pos="top"]').addClass("hidden"):"left"===t&&this.$resize_handles.filter('[data-pos="right"]').addClass("hidden")}else this.$resize_handles.addClass("hidden")},bind_events:function(){Object(r.a)(this.$resize_handles).drag("start",this.on_resize_start).drag(this.on_resize).drag("end",this.on_resize_end),this.listenTo(this.workspace_inside_block.block.model,"change:tip_pos",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block.block.model,"change:wids",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block.block.model.widgets_collection,"change:hidden",this.apply_resize_handles_visual_state),this.listenTo(this.workspace_inside_block,"loading_original_picture",this.apply_resize_handles_visual_state)},on_resize_start:function(t,e){var i=Object(r.a)(t.currentTarget),n=i.data("pos"),o=this.workspace_inside_block.get_box_data(),a=this.workspace_inside_block.min_width,s=this.workspace_inside_block.min_height,l=null,c=this.workspace_inside_block.get_visible_blocks();e.scrollTop=this.workspace_inside_block.page_workspace.$container.scrollTop();var d=O.a.find(c,(function(t){return"picture"===t.model.get("type")})),h=O.a.find(c,(function(t){return"text"===t.model.get("type")}));if(!h||!h.isEditMode){if("top"===n||"bottom"===n)if(c.length>1)(h=O.a.find(c,(function(t){return"text"===t.model.get("type")})))&&(s=h.getBoxData().h+this.workspace_inside_block.min_height);if(d){d.model.off("change",d.redraw);var u=o,p=d.model.get("scale"),g={left:u.left_abs+parseInt(d.$el.css("left"))-Math.round(d.model.get("cropX")*p),top:u.top_abs+parseInt(d.$el.css("top"))-Math.round(d.model.get("cropY")*p)};d.initialCrop=g;var m=d.model.get("originalW"),f=d.model.get("originalH");d.frame.constraints={top:g.top,left:g.left,width:Math.round(m*p),height:Math.round(f*p)},l=d.frame.constraints}this.resize_params={$handle:i,handle_pos:n,box_on_drag_start:o,box_position:this.workspace_inside_block.block.model.get("tip_pos"),min_height:s,min_width:a,max_width:9999,max_height:9999,constraints:l,visible_blocks:c,max_block_height:this.workspace_inside_block.block.model.get("tip_h"),picture_block:d,picture_initial_crop_on_drag_start:d&&O.a.clone(d.initialCrop),text_block:h}}},on_resize:function(t,e){var i,n=this.resize_params.handle_pos,o=O.a.clone(this.resize_params.box_on_drag_start),a=e.startY+e.scrollTop,s=t.pageY+this.workspace_inside_block.page_workspace.$container.scrollTop();e.deltaY=s-a,this.resize_params.constraints&&(i=this.resize_params.constraints);var l=this.resize_params.visible_blocks,c=this.resize_params.picture_block,d=this.resize_params.text_block;if(!d||!d.isEditMode){var h=0,u=this.resize_params.box_position;if("top"===n||"bottom"===n?"top"===n?(o.top_abs+=e.deltaY,o.height-="left"===u||"right"===u?2*e.deltaY:e.deltaY):"bottom"===n&&("left"===u||"right"===u?(o.top_abs-=e.deltaY,o.height+=2*e.deltaY):o.height+=e.deltaY):"left"!==n&&"right"!==n||("left"===n?"top"===u||"bottom"===u?(o.left_abs+=e.deltaX,o.width-=2*e.deltaX):(o.left_abs+=e.deltaX,o.width-=e.deltaX):"right"===n&&("top"===u||"bottom"===u?(o.left_abs-=e.deltaX,o.width+=2*e.deltaX):o.width+=e.deltaX)),o.height<this.resize_params.min_height?("left"===u||"right"===u?o.top_abs-=(this.resize_params.min_height-o.height)/2:"top"===u&&(o.top_abs-=this.resize_params.min_height-o.height),o.height=this.resize_params.min_height):o.height>this.resize_params.max_height&&(o.height=this.resize_params.max_height),o.width<this.resize_params.min_width?("top"===u||"bottom"===u?o.left_abs-=(this.resize_params.min_width-o.width)/2:"left"===u&&(o.left_abs-=this.resize_params.min_width-o.width),o.width=this.resize_params.min_width):o.width>this.resize_params.max_width&&(o.width=this.resize_params.max_width),"left"===n||"right"===n){if(l.forEach((function(t){var e=t.getBoxData();t.frame.doResize({left:e.x,top:e.y,width:o.width,height:e.h},!1)})),d){if(c){var p=d.getBoxData();o.height-=p.h,"top"===u?o.top_abs+=p.h:"left"!==u&&"right"!==u||(o.top_abs+=p.h/2)}if(d.$el.find(".text-preview").children().each((function(){h+=Object(r.a)(this).outerHeight()})),p=d.getBoxData(),d.frame.doResize({left:p.x,top:p.y,width:p.w,height:h},!1),c){o.height+=h,"top"===u?o.top_abs-=h:"left"!==u&&"right"!==u||(o.top_abs-=h/2);var g=c.getBoxData(),m=o.top_abs+g.y-Math.round(c.model.get("cropY")*c.model.get("scale"));c.$backpic&&c.$backpic.css("top",m),c.initialCrop.top=m,c.frame.constraints.top=m}else o.height=h;this.resize_params.box_on_drag_start.height=o.height,this.resize_params.box_on_drag_start.top_abs=o.top_abs}}else if(("top"===n||"bottom"===n)&&c){var f=O.a.reject(l,(function(t){return"picture"===t.model.get("type")})),v=o.height;f.forEach((function(t){var e=t.getBoxData();v-=e.h}));var b=c.getBoxData();c.frame.doResize({left:b.x,top:b.y,width:b.w,height:v},!1)}if(this.workspace_inside_block.block.workspace.set_group([{_id:this.workspace_inside_block.block.model.get("_id"),tip_w:o.width,tip_h:o.height}],{viewport:"default",forceDefaultViewport:!0}),i){var _={width:o.width,height:o.height,left_abs:o.left_abs,top_abs:o.top_abs},y=this.resize_params.picture_initial_crop_on_drag_start;if(d&&(p=d.getBoxData(),_.height-=p.h),("left"===n||"right"===n)&&_.width>=i.width){var w=(g=c.getBoxData()).x,k=g.y,S=g.h,x=_.width,C=c.model.get("originalW"),P=c.model.get("originalH"),j=C/P,$={},T=null,I={};c.model.get("ratio")>j?(T=x/C,$={cropX:0,cropY:Math.round((P-S/T)/2),cropW:C,cropH:Math.round(S/T)},I={width:x,height:Math.round(x/j),top:-Math.round($.cropY*T),left:0}):(T=S/P,$={cropX:0,cropY:0,cropW:Math.round(x/T),cropH:P},I={width:Math.max(Math.round(S*j),_.width),height:S,top:0,left:0}),c.model.set(O.a.extend({scale:T.toFixed(15),ratio:(x/S).toFixed(5)},$),{skipHistory:!0}),c.$picture&&c.$picture.css(I);var E={width:I.width,height:I.height,top:_.top_abs+k+I.top,left:_.left_abs+w+I.left};c.$backpic&&c.$backpic.css(E),c.initialCrop={top:_.top_abs+k+I.top,left:_.left_abs+w+I.left},c.frame.constraints=E}else if(("top"===n||"bottom"===n)&&_.height>=i.height)w=(g=c.getBoxData()).x,k=g.y,S=_.height,x=g.w,j=(C=c.model.get("originalW"))/(P=c.model.get("originalH")),$={},T=null,I={},c.model.get("ratio")>j?(T=x/C,$={cropX:0,cropY:0,cropW:C,cropH:Math.round(S/T)},I={width:x,height:Math.max(Math.round(x/j),_.height),top:0,left:0}):(T=S/P,$={cropX:Math.round((C-x/T)/2),cropY:0,cropW:Math.round(x/T),cropH:P},I={width:Math.round(S*j),height:S,top:0,left:-Math.round($.cropX*T)}),c.model.set(O.a.extend({scale:T.toFixed(15),ratio:(x/S).toFixed(5)},$),{skipHistory:!0}),c.$picture.css(I),E={width:I.width,height:I.height,top:_.top_abs+k+I.top,left:_.left_abs+w+I.left},c.$backpic&&c.$backpic.css(E),c.initialCrop={top:_.top_abs+k+I.top,left:_.left_abs+w+I.left},c.frame.constraints=E;else if(_.left_abs+_.width>i.left+i.width){var M=i.left+i.width-_.left_abs-_.width;c.initialCrop.left=y.left-M,c.$backpic&&c.$backpic.css("left",c.initialCrop.left),g=c.getBoxData(),c.onCropResize({width:g.w,height:g.h,left:g.x,top:g.y})}else _.left_abs<i.left?(M=i.left-_.left_abs,c.initialCrop.left=y.left-M,c.$backpic&&c.$backpic.css("left",c.initialCrop.left),g=c.getBoxData(),c.onCropResize({width:g.w,height:g.h,left:g.x,top:g.y})):_.top_abs<i.top?(M=i.top-o.top_abs,c.initialCrop.top=y.top-M,c.$backpic&&c.$backpic.css("top",c.initialCrop.top),g=c.getBoxData(),c.onCropResize({width:g.w,height:g.h,left:g.x,top:g.y})):_.top_abs+_.height>i.top+i.height?(M=i.top+i.height-(_.top_abs+_.height),c.initialCrop.top=y.top-M,c.$backpic&&c.$backpic.css("top",c.initialCrop.top),g=c.getBoxData(),c.onCropResize({width:g.w,height:g.h,left:g.x,top:g.y})):(g=c.getBoxData(),c.onCropResize({width:g.w,height:g.h,left:g.x,top:g.y}))}}},on_resize_end:function(t){var e,i=[{_id:this.workspace_inside_block.block.model.get("_id"),tip_w:this.workspace_inside_block.block.model.get("tip_w"),tip_h:this.workspace_inside_block.block.model.get("tip_h")}];this.resize_params.visible_blocks.forEach(function(t){t._justResized=!0;var n=O.a.extend({_id:t.model.get("_id")},t.getBoxData());"picture"===t.model.get("type")&&(e=t,O.a.extend(n,{cropX:t.model.get("cropX"),cropY:t.model.get("cropY"),cropW:t.model.get("cropW"),cropH:t.model.get("cropH"),ratio:t.model.get("ratio"),scale:t.model.get("scale")}),!t.isAnimated()&&!t.useLambdaUrl()&&t.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,patch:!0})),i.push(n),t.model.set(n,{skipHistory:!0,forceDefaultViewport:!0})}.bind(this)),this.workspace_inside_block.block.workspace.save_group(i,{isHotspot:!0,viewport:"default",forceDefaultViewport:!0}),e&&e.model.on("change",e.redraw)},show:function(){this.workspace_inside_block.$el.addClass("resize-handles-visible")},hide:function(){this.workspace_inside_block.$el.removeClass("resize-handles-visible")},destroy:function(){this.resize_handles_fragment&&Object(r.a)(this.resize_handles_fragment).remove(),this.stopListening()}}),re=i("1ljF"),le=i.n(re),ce=o.a.View.extend({events:{"click .widget":"on_widget_select"},initialize:function(t){O.a.bindAll(this),this.workspace=t.workspace_inside_block,this.model=this.workspace.block.model,this.$container=t.$container||this.workspace.$el,this.template=le.a["template-constructor-workspace-inside-block-widget-selector"],this.render(),this.bind_events()},render:function(){this.setElement(Object(r.a)(this.template())),this.$el.appendTo(this.$container),this.updateSelectorStateAndPos()},bind_events:function(){this.listenTo(this.model,"change:tip_pos",this.updateSelectorStateAndPos),this.listenTo(this.model,"change:wids",(function(){this.$el.data("processing",!1),this.updateSelectorStateAndPos()})),this.listenTo(this.model.widgets_collection,"change:hidden",(function(){this.$el.data("processing",!1),this.updateSelectorStateAndPos()}))},updateSelectorStateAndPos:function(t){var e=this.$(".widget"),i=this.workspace.get_visible_blocks(),n=!O.a.isEmpty(i);e.removeClass("enabled"),O.a.each(i,O.a.bind((function(t){e.filter("[data-block-type="+t.model.get("type")+"]").addClass("enabled")}),this)),this.workspace.$el.toggleClass("no-widgets",!n),this.$el.toggleClass("compact",!!n).toggleClass("right-pos",!(!n||"left"!==this.model.get("tip_pos"))),this.$el.css({left:n?"":this.model.get("tip_w")/2-this.$el.width()/2+"px"})},on_widget_select:function(t){if(this.workspace.trigger("deselect"),this.workspace.page_workspace.controls.hide(),!this.$el.data("processing")){this.$el.data("processing",!0);var e=Object(r.a)(t.currentTarget).data("block-type"),i=O.a.filter(this.workspace.blocks,(function(t){return t.model.get("type")===e}))[0];if(i)if(i.model.get("hidden")){var n=i.frame.doResize({left:i.model.get("x"),top:i.model.get("y"),width:this.workspace.get_box_data().width,height:i.model.get("h")},!1);if("picture"===i.model.get("type")){var o,a=n.width,s=i.getBoxData().h,l={},c={},d=i.model.get("originalW")/i.model.get("originalH");i.model.get("ratio")>d?(o=a/i.model.get("originalW"),l={cropX:0,cropY:Math.round((i.model.get("originalH")-s/o)/2),cropW:i.model.get("originalW"),cropH:Math.round(s/o)},c={width:a,height:Math.round(a/d),top:-Math.round(l.cropY*o),left:0}):(o=s/i.model.get("originalH"),l={cropX:Math.round((i.model.get("originalW")-a/o)/2),cropY:0,cropW:Math.round(a/o),cropH:i.model.get("originalH")},c={width:Math.round(s*d),height:s,top:0,left:-Math.round(l.cropX*o)}),i.model.set(O.a.extend({w:a,h:s,scale:o.toFixed(15),ratio:(a/s).toFixed(5)},l),{silent:!0}),i.$picture&&i.$picture.css(c)}else if("text"===i.model.get("type")){var h=0;i.$el.find(".text-preview").children().each((function(){h+=Object(r.a)(this).outerHeight()}));var u=i.getBoxData();i.frame.doResize({left:u.x,top:u.y,width:u.w,height:h},!1),i.model.set(i.getBoxData(),{silent:!0})}i.model.save({hidden:!1},{toHistory:!0}),"picture"===i.model.get("type")&&(i.in_constrained_crop_mode=!1,i.enter_constrained_crop_mode()),i.select(),this.workspace.trigger("select")}else i.model.save({hidden:!0},{toHistory:!0});else this.workspace.add_widget({type:e,w:this.model.get("tip_w"),h:"picture"===e?180:"text"===e?54:400}),"picture"===e&&this.workspace.$picture_upload_input.trigger("click")}},destroy:function(){this.remove()}});function de(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function he(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?de(Object(i),!0).forEach((function(e){ue(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):de(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function ue(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var pe={text:W,picture:St},ge=he(he({},ae.a),pt.a),me=o.a.View.extend({template:ge["template-constructor-workspace-inside-block"],initialize:function(t){O.a.bindAll(this),this.block=t.block,this.page_workspace=t.page_workspace,this.controls=this.page_workspace.controls,this.mag=this.page_workspace.mag,this.page=this.page_workspace.page,this.blocks=[],this.$container=t.$container,this.block.child_workspace=this,this.resize_handles_positions=t.resize_handles_positions,this.min_width=t.min_width||100,this.min_height=t.min_height||10,this.block.model.widgets_collection.forEach(function(t){this.block.model.get("wids").indexOf(t.get("_id"))>-1&&this.addBlock(t)}.bind(this)),this.trigger_select_on_selected_block.__debounced=O.a.debounce(this.trigger_select_on_selected_block,0),this.restoreFocusForCopyPaste.__debounced=O.a.debounce(this.restoreFocusForCopyPaste,0),this.saveDebounced=O.a.debounce(this.save,100),this.render(),this.bind_events()},render:function(){this.rendered=!0,this.setElement(Object(r.a)(this.template())),this.$blocksWrapper=this.$el.find(".blocks-wrapper"),this.$el.addClass("tip");var t=ge["template-constructor-helpers-upload-input"];this.$picture_upload_input=Object(r.a)(t()),this.$picture_upload_input.appendTo(this.$el),this.$el.appendTo(this.$container),this.block.apply_tip_container_size({width:this.block.model.get("tip_w"),height:this.block.model.get("tip_h")}),this.block.apply_tip_position(),this.block.apply_tip_bg_color(),this.block.apply_tip_box_shadow(),this.block.apply_tip_border_radius(),this.blocks.map(this.renderBlock),this.resize_handles_manager=new se({workspace_inside_block:this,positions:this.resize_handles_positions}),this.widget_selector=new ce({workspace_inside_block:this,container:this.$el})},bind_events:function(){this.listenTo(this.block.model,"change:w change:h change:tip_pos",this.block.apply_tip_position),this.listenTo(this.block.model,"change:tip_w change:tip_h",this.on_tip_size_change),this.listenTo(this.block.model,"widget:create",this.createBlock),this.listenTo(this.block.model,"widget:remove",this.removeBlock),this.listenTo(this.block.model,"change:wids",(function(t,e,i){i.socketUpdate||i.resetPage||(this.adjust_height_to_visible_content(),this.adjust_column_widgets_positioning(),this.block.apply_tip_position(),i.undo||i.redo||this.block.model.save({wids:this.block.model.get("wids"),tip_h:this.block.model.get("tip_h")},{patch:!0,forceDefaultViewport:!0}),this.blocks.forEach((function(t){t.saveBox({patch:!0,skipHistory:!0})})))})),this.listenTo(this.block.model.widgets_collection,"change:hidden",(function(t,e,i){this.adjust_height_to_visible_content(),this.adjust_column_widgets_positioning(),this.block.apply_tip_position();var n=[{_id:this.block.model.get("_id"),tip_w:this.block.model.get("tip_w"),tip_h:this.block.model.get("tip_h")}];this.blocks.forEach(function(t){var e=O.a.extend({_id:t.model.get("_id"),hidden:t.model.get("hidden")},t.getBoxData());"picture"===t.model.get("type")&&(O.a.extend(e,{cropX:t.model.get("cropX"),cropY:t.model.get("cropY"),cropW:t.model.get("cropW"),cropH:t.model.get("cropH"),ratio:t.model.get("ratio"),scale:t.model.get("scale")}),!t.isAnimated()&&!t.useLambdaUrl()&&t.getFinalImage((function(t){t&&console.log("w-picture getFinalImage error: ",t)}),{silent:!0,patch:!0})),n.push(e)}.bind(this)),this.block.workspace.save_group(n,{isHotspot:!0,skipHistory:!0,silent:!0,viewport:"default",forceDefaultViewport:!0})})),this.listenTo(this.page,"change:viewport",this.onChangeViewport),this.on("select",this.onSelect),this.on("w-text-entered-edit-mode",this.on_text_entered_edit_mode),this.on("w-text-before-leave-edit-mode",this.on_text_leaved_edit_mode),this.$el.on("click",this.onClick)},restoreFocusForCopyPaste:function(){Object(r.a)(".copyhack").selectText()},adjust_height_to_visible_content:function(t){t=t||{};var e=this.get_visible_blocks(),i=0;e.forEach((function(t){i+=t.getBoxData().h}));var n={_id:this.block.model.get("_id"),tip_h:i};t.save?(this.block.model.set(n,{skipHistory:!0}),this.saveDebounced({},{skipHistory:!0})):this.block.model.set(n,{skipHistory:!0})},adjust_column_widgets_positioning:function(){var t=O.a.sortBy(this.get_visible_blocks(),(function(t){return"picture"===t.model.get("type")?0:1})),e=0;t.forEach((function(t){t.model.set({x:0,y:e},{skipHistory:!0}),e+=t.getBoxData().h}))},on_tip_size_change:function(t,e,i){this.block.apply_tip_container_size({width:t.get("tip_w"),height:t.get("tip_h")}),this.adjust_column_widgets_positioning(),this.block.apply_tip_position()},on_text_entered_edit_mode:function(){this.resize_handles_manager.hide()},on_text_leaved_edit_mode:function(){this.resize_handles_manager.show(),this.fit_text_to_content(!0)},fit_text_to_content:function(t){var e=this.get_visible_blocks(),i=O.a.find(e,(function(t){return"text"===t.model.get("type")}));if(i){var n=i.model.get("h"),o=0;i.$iframe_body.children().each((function(){o+=Object(r.a)(this).outerHeight()})),n!==(o=O.a.max([o,10]))&&(i.model.set("h",o,{skipHistory:!0}),this.adjust_height_to_visible_content({save:!0}))}},createBlock:function(t,e){var i=this.addBlock(t);this.renderBlock(i),e.undo||e.redo||e.group||(i.select(),e.copy||this.trigger_select_on_selected_block.__debounced())},trigger_select_on_selected_block:function(){var t=this.getSelectedBlocks();t&&t.length&&this.trigger("select",t)},addBlock:function(t){var e=t.get("type"),i=new(0,pe[e])(t,this);return i.immortal=!0,"text"===t.get("type")?(i.controls=[],i.edit_controls=O.a.without(i.edit_controls,"text_columns")):"picture"===t.get("type")&&(i.initial_controls=["picture_crop","picture_link"],i.vector_controls=["picture_color","picture_link"],i.animated_controls=["picture_crop","picture_link"]),this.listenTo(i,"all",this.passChildBlockEvent),this.blocks.push(i),i},passChildBlockEvent:function(t,e){var i=Array.prototype.slice.call(arguments,1);this.trigger("childBlockEvent",t,i)},renderBlock:function(t){t.render(),t.redrawPosition(t.model,{forceRedraw:!0})},add_widget:function(t,e){var i=pe[(t=t||{}).type.toLowerCase()];O.a.defaults(t,O.a.mapObject(O.a.cloneWithObjects(i.defaults),(function(t,e){return O.a.isFunction(t)?t():t}))),this.block.model.addWidget(t,e)},removeBlock:function(t){var e=this.findBlock(t.get("_id"));this.blocks=O.a.without(this.blocks,e),this.stopListening(e),e.destroy()},onClick:function(t){t.stopPropagation(),!Object(r.a)(t.target).hasClass("workspace-inside-block")&&Object(r.a)(t.target).closest(".workspace-inside-block").length||this.page_workspace.controls&&!this.page_workspace.controls.canControlsBeClosed()||this.trigger("deselect")},onChangeViewport:function(t,e,i){},redrawPacksFrames:O.a.noop,redrawBottomShiftLine:O.a.noop,onSelect:function(){var t=this.getSelectedBlocks(),e=O.a.find(t,(function(t){return"text"===t.model.get("type")}));this.page_workspace.controls.onSelect(t),e&&!e.isEditMode&&e.enterEditMode()},getSelectedBlocks:function(){return O.a.filter(this.blocks,(function(t){return t.selected}))},getSelectableBlocks:function(){return Object(O.a)(this.blocks).filter((function(t){return!t.model.get("hidden")&&!t.outofbox}))},get_visible_blocks:function(){return O.a.filter(this.blocks,(function(t){return!t.model.get("hidden")}))},get_visible_proportional_blocks:function(){return O.a.filter(this.get_visible_blocks(),(function(t){return t.proportional}))},get_visible_nonproportional_blocks:function(){return O.a.filter(this.get_visible_blocks(),(function(t){return!t.proportional}))},getExistingWidgets:function(){return Object(O.a)(this.blocks).chain().pluck("model").value()},findBlock:function(t){return O.a.find(this.blocks,(function(e){return e.model.id===t}))},get_box_data:function(){var t,e=this.block.getBoxData({checkFixedPosition:!0}),i=(t=this.block.hotspotWidget.apply_tip_position(this.block.model.attributes)).left,n=t.top,o=e.x+i,a=e.y+n;return this.block.model.get("fixed_position")&&(a+=this.block.workspace.$container.scrollTop()),{width:this.block.model.get("tip_w"),height:this.block.model.get("tip_h"),left_rel:i,top_rel:n,left_abs:o,top_abs:a}},onDeselect:function(){this.block&&this.block.selected&&this.block.deselect(),this.block&&this.block.isEditMode&&this.block.leaveEditMode()},save:function(t,e){this.block.model.save(t,e)},destroy:function(){this.resize_handles_manager&&this.resize_handles_manager.destroy(),this.widget_selector&&this.widget_selector.destroy(),this.blocks.forEach((function(t){t.destroy()})),delete this.blocks,this.off("select w-text-entered-edit-mode w-text-before-leave-edit-mode"),this.remove()}}),fe=l.a.extend(Ht.a.prototype).extend({name:"Hotspot",sort_index:8,thumb:"hotspot",icon_color:"#ff8888",dontSaveOnResize:!0,viewport_fields:g.b.viewport_fields.hotspot,initial_controls:["hotspot_add","hotspot_pin_settings","hotspot_tip_settings","common_animation","common_position","common_layer","common_lock"],settingsOnCreate:!1,initialize:function(t,e){this.mag=e.mag,this._id=t.get("_id"),this.hotspots_group_id=t.get("hotspots_group_id"),this.current_icon_data=null,this.initBlock(t,e),this.initHotspotsCollection(),this.child_workspace=null,this.on_icon_change.__debounced=O.a.debounce(this.on_icon_change,20),this.rasterizeOnUndo.__debounced=O.a.debounce(this.rasterizeOnUndo,20)},initHotspotsCollection:function(t){var e;t=t||{},this.hotspots_group_id?e="Hotspots_"+this.hotspots_group_id:(e="Hotspots_"+this._id,this.model.save({hotspots_group_id:this._id},{skipHistory:!0,silent:!0,patch:!0})),RM.collections[e]=RM.collections[e]||new Backbone.Collection,this.hotspots_group_collection=RM.collections[e],this.hotspots_group_collection.add(this.model)},getGroupBlocks:function(){return this.workspace.blocks.filter((function(t){return this.hotspots_group_collection.contains(t.model)}),this)},render:function(){var t=this.model.attributes;this.create(),this.$el.addClass("hotspot"),this.hotspotWidget=new ne.a({model:t,$container:this.$content,environment:"constructor",mag:this.mag,block:this}),this.on_icon_change(),this.tip_workspace=new me({$container:this.$(".common-hotspot"),block:this,page_workspace:this.workspace,resize_handles_positions:["top","right","left","bottom"],min_width:40,min_height:64}),this.hotspotWidget.apply_tip_position(t),this.bind_model_events(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.listenTo(this.tip_workspace,"childBlockEvent",this.onChildBlockEvent),this.listenTo(this.tip_workspace,"w-text-entered-edit-mode",O.a.bind((function(){this.tip_workspace.$el.addClass("text-edit-mode")}),this)),this.listenTo(this.tip_workspace,"w-text-leaved-edit-mode",O.a.bind((function(){this.tip_workspace.$el.removeClass("text-edit-mode")}),this)),this.triggerReady()},onChildBlockEvent:function(t,e){if("modechanged"==t){var i=e[0];this.disableDragging=i,this.$el.toggleClass("no-resize",i)}},getNestedWidgetsJSON:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.model.widgets_collection&&this.model.widgets_collection.toJSON()||[];return(e=O.a.filter(e,function(t){return this.model.get("wids").indexOf(t._id)>-1}.bind(this))).map((function(e){return O.a.omit(e||{},"id","__v","pid","parent_wid",t?"_id":void 0)}))},getIconStyle:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.current_icon_data&&this.current_icon_data.$svg?{"background-image":"","background-color":this.icon_color}:l.a.prototype.getIconStyle.apply(this,arguments)},getIconData:function(){if(!this.current_icon_data||!this.current_icon_data.$svg)return null;var t=this.current_icon_data.$svg.clone();return t.attr("fill","#ffffff").attr("fill-opacity","1"),{$svg:t,pinType:this.model.get("pin_type")}},get_icon_SVG:function(t,e,i){if(t){var n,o,a;if(this.icon_XHR&&this.icon_XHR.abort(),n=window.iconSVGCache&&O.a.findWhere(window.iconSVGCache,{id:t}))return a={noun_url:n.noun_url,$svg:n.$svg},this.current_icon_data=a,i(null,a);var s=function(e){var n=Object(r.a)("<div></div>").append(Object(r.a)(e.svg)).find("svg");if(n.length)return n=this.prepareIconSVG(n),a={noun_url:e.new_url,$svg:n},this.current_icon_data=a,window.iconSVGCache.push(O.a.extend(a,{id:t})),window.iconSVGCache.length>this.MAX_ICON_CACHE_SIZE&&window.iconSVGCache.shift(),i(null,{$svg:n,noun_url:e.new_url})}.bind(this);o={method:"POST",url:"/api/authservice/noun/icon",data:{id:t,url:e},dataType:"json",success:function(t){this.icon_svg_request_in_progress=!1,s(t)},error:function(t){return this.icon_svg_request_in_progress=!1,console.log("icon xhr : ",t),i(t)}},/^rm/.test(t)&&O.a.extend(o,{method:"GET",url:e,cache:!1,success:function(t){this.icon_svg_request_in_progress=!1,s({svg:Object(r.a)(t).find("svg"),new_url:e})},data:null,dataType:null}),this.icon_svg_request_in_progress=!0,this.icon_XHR=r.a.ajax(o)}},prepareIconSVG:function(t){var e=t.clone().appendTo(Object(r.a)("body")),i=t.clone();e.get(0).setAttributeNS(null,"viewBox","0 0 "+e.width()+" "+e.height());var n=e.get(0).getBBox();return e.remove(),i.removeAttr("width"),i.removeAttr("height"),i.get(0).setAttributeNS(null,"viewBox",n.x+" "+n.y+" "+n.width+" "+n.height),i.get(0).setAttributeNS(null,"preserveaspect_ratio","xMidYMid meet"),i.css({width:"100%",height:"100%"}),i},render_pin_shape:function(t){t=t||{};var e=this.generateShapeSVG("constructor",this.model,t.w||this.model.get("w"),t.h||this.model.get("h"),t.pin_type);this.$content.find(".pin").html(e)},adjust_box_to_icon:function(){var t,e,i,n,o,a,s,r=this.getBoxData(),l=Math.max(r.w,r.h);if((t=this.$(".pin").find("svg")).length)return e=(i=t.get(0).getBBox()).width/i.height,a=r.w,s=r.h,i.width>i.height?(r.w=l,r.h=Math.floor(r.w/e)):(r.h=l,r.w=Math.floor(r.h*e)),n=Math.floor((a-r.w)/2),o=Math.floor((s-r.h)/2),r.x=r.x+n,r.y=r.y+o,r},rasterize_icon_SVG:function(){var t=this,e=this.$(".pin").find("svg");e.length&&(this.rasterizeXhr&&this.rasterizeXhr.abort(),this.rasterizeXhr=jt.rasterize({widgets:this.hotspots_group_collection.models,svg:e,mid:this.workspace.mag.get("_id"),viewport:this.model.getViewport(),size:{width:this.model.get("w"),height:this.model.get("h")},onSuccess:function(e){e&&e.rasterUrl&&t.model.save(e,{skipHistory:!0,silent:!0})}}))},getPeerIds:function(){return O.a.map(this.hotspots_group_collection.models,(function(t){return t.get("_id")}))},onResizeStart:function(t,e){this.rasterizeXhr&&this.rasterizeXhr.abort()},onResizeEnd:function(t,e,i){i=i||{};var n=[];this.hotspots_group_collection.models.forEach(function(t){var e=this.workspace.findBlock(t.get("_id"));e&&n.push(O.a.extend({_id:t.get("_id")},e.adjust_box_to_icon()))}.bind(this)),i.isGroupResize?this.workspace.set_group(n,i):this.workspace.save_group(n,i),"icon"===this.model.get("pin_type")&&this.rasterize_icon_SVG()},onIndexChange:function(){this.selected||l.a.prototype.onIndexChange.apply(this,arguments)},css:function(t,e){t=t||{},this.selected?t["z-index"]=this.MAX_Z_INDEX:Object(c.a)("constructor.zIndex")?t["z-index"]=RM.constructorRouter.indexController.getZIndex(this.id,this.workspace.page.id,this.workspace.page.getCurrentViewport()):t["z-index"]=this.model.get("z"),l.a.prototype.css.apply(this,[t,e]),null!=t.height&&null!=t.width&&this.render_pin_shape({w:t.width,h:t.height}),(e||t.isGroupResize)&&this.hotspots_group_collection.models.forEach(function(e){var i=e.get("_id"),n=t.groupedIds&&-1===t.groupedIds.indexOf(i);if(this.model.get("_id")!==i&&(!t.isGroupResize||n)){var o=this.workspace.findBlock(i);o&&o.css({width:t.width,height:t.height,doNotRedrawPacksFrames:t.doNotRedrawPacksFrames})}}.bind(this))},bind_model_events:function(){this.model.on("change:tip_background-color change:tip_background-color-opacity",this.apply_tip_bg_color,this),this.model.on("change:tip_border-radius",this.apply_tip_border_radius,this),this.model.on("change:tip_box-shadow",this.apply_tip_box_shadow,this),this.model.on("change:noun_id change:rm_id change:noun_url change:pin_type change:borders change:color change:opacity change:bg_color change:bg_opacity",this.on_icon_change.__debounced,this),this.model.on("change:noun_id change:rm_id change:noun_url change:pin_type change:bg_color change:bg_opacity change:w change:h",this.rasterizeOnUndo.__debounced,this)},rasterizeOnUndo:function(t,e,i){(i.undo||i.redo)&&"icon"==this.model.get("pin_type")&&this.hotspots_group_collection.at(0)==this.model&&this.rasterize_icon_SVG()},on_icon_change:function(){this.determine_is_block_proportional();var t=this.model.get("pin_type");"ellipse"!==t&&"rectangle"!==t||this.render_pin_shape(),"icon"===t&&this.get_icon_SVG(this.model.get("noun_id")||this.model.get("rm_id"),this.model.get("noun_url"),function(t,e){!t&&e.$svg&&this.render_pin_shape()}.bind(this))},apply_tip_bg_color:function(){this.hotspotWidget.apply_tip_bg_color(this.model.attributes)},apply_tip_border_radius:function(){this.hotspotWidget.apply_tip_border_radius(this.model.attributes)},apply_tip_box_shadow:function(){this.hotspotWidget.apply_tip_box_shadow(this.model.attributes)},determine_is_block_proportional:function(){var t=this.model.get("pin_type");this.proportional="ellipse"===t||"icon"===t},apply_tip_container_size:function(t){this.hotspotWidget.apply_tip_container_size(t)},apply_tip_position:function(){var t=this.model.attributes;this.hotspotWidget?this.hotspotWidget.apply_tip_position(t):console.log(this.model,this,"NO Hotspot widget")},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1==t.length&&t[0]==this;RM.constructorRouter.isPageLocked(this.model.get("pid"))||this.toggleTip(e)}},deselect:function(){l.a.prototype.deselect.apply(this,arguments),this.toggleTip(!1),this.child_workspace&&this.child_workspace.onDeselect()},toggleTip:function(t){this.$(".tip").css("visibility",t?"inherit":"hidden"),this.css(),this.tip_workspace&&this.tip_workspace.resize_handles_manager&&(t?this.tip_workspace.resize_handles_manager.show():this.tip_workspace.resize_handles_manager.hide())},destroy:function(){this.stopListening(this.tip_workspace),this.tip_workspace&&this.tip_workspace.destroy(),this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,this.rasterizeXhr&&this.rasterizeXhr.abort(),this.icon_XHR&&this.icon_XHR.abort(),this.model.off(null,null,this),this.hotspots_group_collection&&this.hotspots_group_collection.remove(this.model),l.a.prototype.destroy.apply(this,arguments)}},{defaults:{pin_type:"ellipse",w:30,h:30,bg_color:"ff8888",bg_opacity:1,borders:0,color:"000000",opacity:1,tip_show_on:"click",x:"center",tip_w:240,tip_h:120,tip_pos:"top","tip_background-color":"ffffff","tip_background-color-opacity":100,"tip_border-radius":8,"tip_box-shadow":!0,wids:[]}}),ve=i("gm8A"),be=[{tp:"name",caption:"Name",optional:!1,sort:0},{tp:"email",caption:"Email",optional:!1,sort:1}],_e=l.a.extend({name:"Form",sort_index:9,thumb:"form",icon_color:"#7232B4",DEFAULT_HORIZONTAL_SIZE:40,DEFAULT_VERTICAL_SIZE:300,MIN_FONT_SIZE:8,MAX_FONT_SIZE:999,MIN_LETTER_SPACING:-99,MAX_LETTER_SPACING:999,form_controls:["form_content","form_styles","form_endpoints"],viewport_fields:g.b.viewport_fields.form,initialize:function(t,e){this.mag=e.mag,this.controls=O.a.union(this.form_controls,this.controls),this.frameClass=ye,this.initBlock(t,e),this.saveThrottled=O.a.throttle(this.model.save.bind(this.model),700,{leading:!1})},render:function(){this.create(),this.$el.addClass("form"),this.formWidget=new ve.a({data:this.model.attributes,environment:"constructor",$container:this.$content}),this.formWidget.render(),this.minimalDimensions=this.formWidget.getMinimalDimensions(),this.triggerReady()},getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},i="./constructor/widgetbar/icons/";if(t.small&&this.icon_color)return e["background-color"]=this.icon_color,e;var n=Object(X.findImagePath)("".concat(i,"form.svg"));return e["background-image"]="url(".concat(n,")"),e["border-radius"]="0",e},onCreate:function(){this.openContentControl()},bindEvents:function(){l.a.prototype.bindEvents.apply(this,arguments),this.$el.on("dblclick",this.onDoubleClick),this.$el.on("click",".js-add-line",this.onAddLineClick),this.$el.on("click",".js-remove-line",this.onRemoveLineClick)},css:function(t,e){l.a.prototype.css.apply(this,arguments),null==t.height&&null==t.width||this.formWidget.recalcStyles({h:t.height,w:t.width})},validate:function(){var t=O.a.difference(g.b.viewport_fields.form,g.b.viewport_fields_common);this.model.fillMissingFieldsFromDefaultViewport(t)},redraw:function(t,e){if(e=e||{},this.checkNeedRedraw(t)){var i=e.undo||e.redo;this.validate();var n,o,a,s,c=this.model.get("layout"),d=this.model.get("style"),h=this.model.get("style-"+d+"-fields").gutter,u=this.model.changedAttributes(),p=this.model.previousAttributes(),g="vertical"==c?"h":"w";i||u.layout&&u.layout!==p.layout?this.formWidget.render({force:!0}):u.fields?(a=u.fields.length-p.fields.length,s=this.formWidget.getRowsCount(u.fields)-this.formWidget.getRowsCount(p.fields),n=Object(r.a)(this.formWidget.$(".input-wrapper").get(0)),o="vertical"==c?n.height():n.width(),O.a.defer(function(){var t=(o+h)*a;!a&&s&&(t=s*this.formWidget.getLineHeight().input),this.model.set(g,this.model.get(g)+t),this.formWidget.render()}.bind(this))):this.formWidget.recalcStyles(),this.minimalDimensions=this.formWidget.getMinimalDimensions(),l.a.prototype.redraw.apply(this,arguments)}},onDoubleClick:function(){this.openContentControl()},onAddLineClick:function(t){this.addOrRemoveLine(t,!0)},onRemoveLineClick:function(t){this.addOrRemoveLine(t,!1)},addOrRemoveLine:function(t,e){var i=Object(r.a)(t.target).closest(".js-input-wrapper").find(".js-input").data("sort"),n=this.model.get("fields"),o=O.a.find(n,{sort:i});if(o){var a=o.rows||1;e?a+=1:a=a>1?a-1:1,this.changeField({sort:i},{rows:a})}this.trigger("resize"),this.saveThrottled()},openContentControl:function(){var t=this.workspace&&this.workspace.controls,e=t&&t.findControl("form_content");e&&e.master.select(e)},setButtonHoverState:function(){this.formWidget.setButtonHoverState()},unsetButtonHoverState:function(){this.formWidget.unsetButtonHoverState()},toggleInputValue:function(t){t?this.formWidget.showInputPlaceholdersAsValues(!0):this.formWidget.render()},getMinimalDimensions:function(){return this.minimalDimensions},getDefaultDimensions:function(){var t=this.getMinimalDimensions(),e=this.model.attributes,i=e["style-"+e.style+"-fields"],n=e["style-"+e.style+"-button-default"],o=this.model.get("fields");return"vertical"==this.model.get("layout")?{width:this.DEFAULT_VERTICAL_SIZE,height:t.height}:{width:200*(o.length+1)+o.length*i.gutter+n.gutter,height:this.DEFAULT_HORIZONTAL_SIZE}},changeField:function(t,e){var i=O.a.clone(this.model.get("fields")),n=O.a.findIndex(i,t),o=i[n],a={};O.a.each(e,(function(t,e){a[e]=O.a.clone(o[e])})),null===(o=O.a.extend(O.a.clone(o),e)).items&&delete o.items,i[n]=o,this.model.set("fields",i),O.a.each(e,function(t,e){this.model.trigger("field:"+e+":change",o,a[e])}.bind(this)),this.model.trigger("field:change",o)}},{defaults:{layout:"vertical",style:"colored","button-caption":"Text",button_caption_after_submit:"",submit_mode:"textAfterSubmit",link_after_submit:null,fields:JSON.parse(JSON.stringify(be)),h:48*(be.length+1)+20*be.length,w:286,x:"center","style-colored-fields":{gutter:20,color:"f7f7f7",opacity:100,"border-radius":0,"border-width":0,"border-color":"000000","border-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-colored-button-default":{gutter:0,color:"4c4c4c",opacity:100,"border-radius":"inherit","border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"ffffff","text-opacity":100,"font-size":"inherit","letter-spacing":"inherit","text-align":"center"},"style-colored-button-hover":{color:"inherit",opacity:90,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":"inherit","text-align":"inherit",transition:!1},"style-outlined-fields":{gutter:20,color:"ffffff",opacity:0,"border-radius":0,"border-width":1,"border-color":"e5e5e5","border-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-outlined-button-default":{gutter:0,color:"e8e8e8",opacity:60,"border-radius":"inherit","border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"000000","text-opacity":60,"font-size":"inherit","letter-spacing":"inherit","text-align":"inherit"},"style-outlined-button-hover":{color:"inherit",opacity:90,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":80,"text-align":"inherit",transition:!1},"style-underlined-fields":{gutter:20,"underline-width":1,"underline-color":"000000","underline-opacity":100,"font-family":"Roboto","font-style":"normal","font-weight":400,"text-color":"000000","text-opacity":100,"font-size":18,"letter-spacing":0},"style-underlined-button-default":{gutter:0,color:"000000",opacity:100,"border-radius":0,"border-width":0,"border-color":"000000","border-opacity":100,"font-family":"inherit","font-style":"inherit","font-weight":"inherit","text-color":"ffffff","text-opacity":100,"font-size":"inherit","letter-spacing":"inherit","text-align":"inherit"},"style-underlined-button-hover":{color:"inherit",opacity:80,"border-width":"inherit","border-color":"inherit","border-opacity":"inherit","text-color":"inherit","text-opacity":"inherit","text-align":"inherit",transition:!1}}}),ye=b.a.extend({applyExtraConstraints:function(t,e){var i=this.block.getMinimalDimensions();return t.height<i.height&&(t.height=i.height),t.width<i.width&&(t.width=i.width),t}}),we=_e,ke=ie.extend({name:"Cart",title:"E-comm",blockName:ot.a.ecommerceCartBlockName,sort_index:13,thumb:"cart-button",getBlockCreateParams:function(t){return t.eCommerceManager.haveEcommerceCartWidget?{name:"Add to cart",title:"E-commerce",block_name:ot.a.addToCartBlockName,thumb:"addtocart-button"}:{name:"Cart",title:"E-comm",blockName:ot.a.ecommerceCartBlockName,thumb:"cart-button"}},restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_e_commerce},icon_color:"#446E00",viewport_fields:g.b.widgetViewportFields(ot.a.ecommerceCartBlockName),frameColor:"#0080FF",settingsOnCreate:!0,onCreate:function(){this.workspace.controls.selectFirst(),this.setWidgetGlobal(),this.workspace.eCommerceManager.haveEcommerceCartWidget=!0},setWidgetGlobal:function(){this.model.set("is_global",!0),this.model.save({},{silent:!0,toHistory:!1,skipHistory:!0}),this.workspace.controls.findControl("common_position").updateModel(O.a.clone(this.model.attributes))},initial_controls:["cart_connections","cart_add_product_widget","cart_settings","button_icon","button_edit","common_animation","common_position","common_layer","common_lock"],DEFAULT_BACKGROUND_COLOR:"f4f4f4",animationTriggerLine:null,getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return t.small&&this.icon_color?(e["background-color"]=this.icon_color,e):(e["background-image"]="url(".concat(Object(X.findImagePath)("./constructor/widgetbar/icons/".concat(this.thumb,".svg")),")"),e)},initialize:function(){ie.prototype.initialize.apply(this,arguments)},render:function(){var t,e=O.a.clone(this.model.attributes),i=e.tp;this.create(),this.$el.addClass("button"),t={model:e,$container:this.$content,environment:"constructor",mag:this.mag,block:this},this.buttonWidget=new te.a(t),this.$button=this.$(".common-button"),this.$textInput=this.$button.children(".text"),this.$buttonIcon=this.$button.children(".icon"),"icon"!==i&&"text_and_icon"!==i||this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(this.renderIcon({$svg:this.getСoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0,current:!0}))}.bind(this)),this.recalcButtonSize(),this.disableTextInput(),this.handleSelectionColor(),this.bindDOMEvents(),this.bindModelEvents(),this.controls=this.initial_controls,this.frame.recalcPointsDirections(),this.triggerReady()},destroy:function(){this.stopListeningForUpdateTrigger(),ie.prototype.destroy.apply(this,arguments)},getIndividualStyles:function(){var t=["background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-radius","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","hover-font-family","hover-font-size","hover-tansition-duration"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")},onDragStart:function(t,e){if(t.altKey||e.isClone)return!1;ie.prototype.onDragStart.apply(this,arguments)},startListeningForUpdateTrigger:function(t){this.animationTriggerLine=t,this.listenTo(this,"move resize",this.updateAnimationTrigger.bind(this))},stopListeningForUpdateTrigger:function(){this.updateAnimationTrigger&&(this.stopListening(this,"move resize",this.updateAnimationTrigger),this.animationTriggerLine=null)},updateAnimationTrigger:function(){window.requestAnimationFrame(this.recalcAnimationTrigger.bind(this))},recalcAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.update()}},{yOffsetOnCreate:-80,defaults:{tp:"text",form:"rectangle",text:"Cart",w:168,h:50,hidden:!1,x:"center",text_w:48,text_h:26,em_w:16,"background-color":"f4f4f4","background-color-opacity":100,"border-radius":4,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,color:"282828","color-opacity":100,"font-size":18,"letter-spacing":0,"hover-background-color":"f4f4f4","hover-background-color-opacity":80,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-border-radius":4,"hover-color":"282828","hover-color-opacity":100,"hover-tansition-duration":0,"hover-cursor":"pointer",icon_enabled:!1,icon_h:18,icon_w:18,icon_pos:"left",icon_noun_id:null,icon_rm_id:null,icon_noun_url:null,icon_color:"ffffff",icon_color_opacity:100,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,icon_rasterUrl:null,icon_raster2xUrl:null,"hover-icon_rasterUrl":null,"hover-icon_raster2xUrl":null,"bar-color":"ffffff","bar-color-opacity":100,"bar-background-color":"1a1a1a","bar-background-color-opacity":100,"bar-shadow":!1,"bar-font-family":"Arial","bar-font-style":"normal","bar-font-weight":400,"bar-letter-spacing":"inherit"}}),Se=i("zzMN"),xe=i("m41J"),Ce=function t(e){this.fromBlock=e.fromBlock,this.toBlock=e.toBlock,this.$el=e.$el,this.root=document.createElementNS(t.svgns,"svg"),this.root.setAttributeNS(null,"class",e.cssClass),this.curve=document.createElementNS(t.svgns,"path"),this.root.appendChild(this.curve),this.arrow=document.createElementNS(t.svgns,"polygon"),this.root.appendChild(this.arrow),this.$el.append(this.root),this.update()};Ce.svgns="http://www.w3.org/2000/svg",Ce.minHandleLength=65,Ce.lineEndOffset=7,Ce.prototype.update=function(){var t=xe.a.getBox(this.fromBlock),e=xe.a.getBox(this.toBlock),i=xe.a.getBestPoints(t,e),n=i.fromPoint,o=i.toPoint;o=xe.a.getPerpendicularEnd(i.toSide,o,e,Ce.lineEndOffset);var a=xe.a.getDistance(n,o),s=Math.max(a/2,Ce.minHandleLength),r=xe.a.getPerpendicularEnd(i.fromSide,n,t,s),l=xe.a.getPerpendicularEnd(i.toSide,o,e,s),c="M"+n.x+" "+n.y+" C "+r.x+" "+r.y+", "+l.x+" "+l.y+", "+o.x+" "+o.y;this.curve.setAttributeNS(null,"d",c),this.updateArrow(i.toSide,o,e)},Ce.prototype.updateArrow=function(t,e,i){var n=e.x,o=e.y;"left"===t&&(n+=1),"bottom"===t&&(o-=1),"right"===t&&(n-=1),"top"===t&&(o+=1);var a=n+" "+o+" "+(n-5.5)+" "+(o-9)+" "+(n+5.5)+" "+(o-9),s="rotate("+Math.round(180*(i.angle+xe.a.sideAngles[t])/Math.PI)+", "+n+", "+o+")";this.arrow.setAttributeNS(null,"points",a),this.arrow.setAttributeNS(null,"transform",s)},Ce.prototype.remove=function(){this.root&&this.root.parentNode.removeChild(this.root)};var Oe=Ce,Pe=i("jeLO"),je=b.a.extend({initialize:function(){b.a.prototype.initialize.apply(this,arguments),this.listenTo(this.block,"addToCartChangeSelectionState",this.changeSelectionState),this.$frameBorder=this.$el.children(".frameborder")},destroy:function(){this.stopListening(this.block,"addToCartChangeSelectionState",this.changeSelectionState),b.a.prototype.destroy.apply(this,arguments)},changeSelectionState:function(t){"button"===t?(this.$frameBorder.css({"border-color":v.default.getRGBA(this.block.frameColor.substring(1,7),.5)}),this.block.$buttonWrap.css({"box-shadow":"0px 0px 0px 1px "+this.block.frameColor+" inset"})):"selects"===t?(this.$frameBorder.css({"border-color":v.default.getRGBA(this.block.frameColor.substring(1,7),.5)}),this.block.$attributesBox.css({"box-shadow":"0px 0px 0px 1px "+this.block.frameColor+" inset"})):"both"===t&&(this.$frameBorder.css({"border-color":this.block.frameColor}),this.block.$attributesBox.css({"box-shadow":"none"}),this.block.$buttonWrap.css({"box-shadow":"none"}))}});function $e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Te(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$e(Object(i),!0).forEach((function(e){Ie(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Ie(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var Ee=["product_selector"],Me=["both","button","selects"],Re=l.a.extend({name:"Add to cart",title:"E-commerce",blockName:ot.a.addToCartBlockName,sort_index:13,thumb:"addtocart-button",excludedFromLib:!0,restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_e_commerce},icon_color:"#446E00",viewport_fields:g.b.viewport_fields[ot.a.addToCartBlockName],MAX_ICON_CACHE_SIZE:30,RASTERIZE_MULTIPLIER:2,frameColor:"#0080FF",cartBlock:null,defaultProductId:"default",textPaddingSizePercentage:12,initial_controls:["product_selector","add_to_cart_settings","button_icon","button_edit","common_animation","common_position","common_layer","common_lock"],disabledControls:Ee,getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};return t.small&&this.icon_color?(e["background-color"]=this.icon_color,e):(e["background-image"]="url(".concat(Object(X.findImagePath)("./constructor/widgetbar/icons/".concat(this.thumb,".svg")),")"),e)},controlsClasses:function(t){return{"panel-product-selector":this.getProductSelectorIconClass()}[t]},getProductSelectorIconClass:function(){return this.model&&"default"!==this.model.get("selected_product_id")?this.workspace.eCommerceManager.isProductActive(this.model.get("selected_product_id"))?"active-product-selected":"inactive-product-selected":"product-not-selected"},checkDisabledControls:function(t,e){e?this.workspace.eCommerceManager&&this.workspace.eCommerceManager.isMagConnectedToStripe()?this.disabledControls=[]:this.disabledControls=Ee:t instanceof Pe.a||(this.disabledControls=t?[]:Ee,this.trigger("disabledControls:changed",this.blockName))},initialize:function(t,e){this.mag=e.mag,this.frameClass=je,this.isEditMode=!1,this.rendered=!1,this.stylingState="default",this.selectionState="both",this.initBlock(t,e),this._oldAttrs=O.a.clone(this.model.attributes),this.onIconChange.__debounced=O.a.debounce(this.onIconChange,20),this.onTextInput.__debounced=O.a.debounce(this.onTextInput,20),this.rasterizeSVG.__debounced_both=O.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_default=O.a.debounce(this.rasterizeSVG,100),this.rasterizeSVG.__debounced_hover=O.a.debounce(this.rasterizeSVG,100),this.setMinimalDimensions.__debounced=O.a.debounce(this.setMinimalDimensions,100),this.saveWidgetData.__debounced=O.a.debounce(this.saveWidgetData,100)},render:function(){var t=this;this.create(),this.$el.addClass("add-to-cart-block"),this.controls=this.initial_controls,this.addToCartWidget=new Se.a({data:O.a.cloneWithObjects(this.model.attributes),environment:"constructor",$container:this.$content,block:this,eCommerceManager:this.workspace.eCommerceManager}),this.addToCartWidget.on("loaded",(function(){t.initIcon()})),this.addToCartWidget.render(),this.$buttonWrap=this.$content.find(".button-wrap"),this.$button=this.addToCartWidget.$button,this.$buttonText=this.addToCartWidget.$buttonText,this.$buttonIcon=this.addToCartWidget.$buttonIcon,this.$attributesBox=this.addToCartWidget.$attrsContainer,this.$sizesCalculatingBlock=this.$el.find(".sizes-calculating-block"),this.bindLinkingLineEvents(),this.bindDOMEvents(),this.bindModelEvents(),this.rendered=!0,this.triggerReady()},destroy:function(){this.unbindDOMEvents(),this.unbindLinkingLineEvents(),this.model.off(null,null,this),l.a.prototype.destroy.apply(this,arguments)},bindDOMEvents:function(){this.$el.on("mousedown",this.onBlockMousedown),this.$button.on("dblclick",this.onButtonDoubleClick),this.$attributesBox.on("dblclick",this.onAttrsDoubleClick),this.$buttonText.on("input",this.onTextInput)},unbindDOMEvents:function(){this.$el.off("mousedown",this.onBlockMousedown),this.$button.off("dblclick",this.onButtonDoubleClick),this.$attributesBox.off("dblclick",this.onAttrsDoubleClick),this.$buttonText.off("input",this.onTextInput)},bindLinkingLineEvents:function(){this.listenTo(this,"move resize",this.updateAnimationTrigger.bind(this)),this.listenTo(this.model,"change:angle change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateAnimationTrigger),this.listenTo(this.workspace,"workspace-resize",this.updateAnimationTrigger.bind(this)),Object(r.a)("#main").on("scroll",this.updateAnimationTrigger)},unbindLinkingLineEvents:function(){this.stopListening(this,"move resize",this.updateAnimationTrigger),this.stopListening(this.model,"change:angle change:sticked change:fixed_position change:is_full_width change:is_full_height",this.updateAnimationTrigger),this.stopListening(this.workspace,"workspace-resize",this.updateAnimationTrigger),Object(r.a)("#main").off("scroll",this.updateAnimationTrigger)},bindModelEvents:function(){this.model.on("change:tp",this.onTypeChange,this),this.model.on("change:icon_enabled",this.determineButtonType,this),this.model.on("change:text",(function(t,e,i){(i.undo||i.redo||i.socketUpdate)&&this.$buttonText.val(this.model.get("text"))}),this),this.model.on("change:icon_enabled change:icon_noun_id change:icon_rm_id change:icon_noun_url",(function(t,e,i){this.onIconChange.__debounced(t,e,i)}),this),this.model.on("change:icon_h",(function(t,e,i){this.recalcIconContainerSize(t,e,i)}),this),this.model.on("change:icon_pos",(function(){this.onIconPositionChange()}),this),this.model.on("change:selected_product_id",this.onProductChange,this),this.model.on("change:layout",this.onLayoutChange,this),this.model.on("change:font-size change:font-family change:font-style change:font-weight change:letter-spacing",function(){this.recalcButtonTextSize()}.bind(this),this),this.model.on("change:attrs-font-size change:attrs-font-family change:attrs-font-style change:attrs-font-weight change:attrs-letter-spacing",function(){this.recalcSelectsTextSize()}.bind(this),this),this.model.on("change:text_w change:text_h",(function(){this.onButtonTextSizeChange()}),this),this.model.on("change:attrs-icon-h change:attrs-icon-w",(function(t){this.onAttrsIconSizeChange(t)}),this),this.model.on("change:icon_color change:icon_color_opacity",function(t){var e=t.get("tp");if("icon"===e||"text_and_icon"===e){var i={default:!0};(t.hasChanged("icon_color")&&t.hasChanged("hover-icon_color")||t.hasChanged("icon_color_opacity")&&t.hasChanged("hover-icon_color_opacity"))&&(i.hover=!0),this.rasterizeSVG.__debounced_default(i)}}.bind(this),this),this.model.on("change:hover-icon_color change:hover-icon_color_opacity",function(t){var e=t.get("tp");"icon"!==e&&"text_and_icon"!==e||t.hasChanged("icon_color")||t.hasChanged("icon_color_opacity")||this.rasterizeSVG.__debounced_hover({hover:!0})}.bind(this),this);var t=this.getIndividualStyles();this.model.on(t,function(){var t=O.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(t,this.stylingState,this.selectionState)}.bind(this),this)},changeStylingState:function(t){this.stylingState=t;var e=O.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(e,this.stylingState,this.selectionState)},haveProductAttributes:function(){return!!this.addToCartWidget&&this.addToCartWidget.showSkus},setDefaultSelectionState:function(){if("both"!==this.selectionState){this.selectionState="both",this.trigger("addToCartChangeSelectionState",this.selectionState);var t=O.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(t,this.stylingState,this.selectionState)}},setSelectionState:function(t){if(-1!==Me.indexOf(t)){this.selectionState=t,this.trigger("addToCartChangeSelectionState",this.selectionState);var e=O.a.clone(this.model.attributes);this.addToCartWidget.generateIndividualStyleCSS(e,this.stylingState,this.selectionState)}},select:function(){this.selected||(this.checkDisabledControls(null,!0),this.cartBlock=this.workspace.eCommerceManager.getEcommerceCartBlock(),this.cartBlock&&(this.animationTriggerLine=new Oe({$el:this.workspace.$(".workspace"),fromBlock:this,toBlock:this.cartBlock,cssClass:"animation-trigger-line"}),this.cartBlock.startListeningForUpdateTrigger(this.animationTriggerLine)),we.prototype.select.apply(this,arguments))},deselect:function(t){t!==this&&this.selected&&(this.setDefaultSelectionState(),this.deleteAnimationTrigger(),this.isEditMode&&(this.leaveEditMode({saveWidgetData:!0}),this.workspace.trigger("redraw")),we.prototype.deselect.apply(this,arguments))},updateAnimationTrigger:function(){this.selected&&window.requestAnimationFrame(this.recalcAnimationTrigger.bind(this))},recalcAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.update()},deleteAnimationTrigger:function(){this.animationTriggerLine&&this.animationTriggerLine.remove(),delete this.animationTriggerLine,this.cartBlock&&(this.cartBlock.stopListeningForUpdateTrigger(),this.cartBlock=null)},onWorkspaceBlocksSelect:function(t){if(l.a.prototype.onWorkspaceBlocksSelect.apply(this,arguments),this.rendered){var e=t&&1===t.length&&t[0]===this;this.isEditMode&&!e&&(this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.workspace.trigger("redraw")),e||this.deleteAnimationTrigger()}},onButtonDoubleClick:function(){this.model.get("pack_id")?l.a.prototype.onDblClick.apply(this,arguments):this.selected&&(this.addToCartWidget.showSkus?"both"===this.selectionState?(this.setSelectionState("button"),this.workspace.controls.findControl("add_to_cart_settings").select()):"selects"===this.selectionState?this.setSelectionState("button"):!this.isEditMode&&this.enterEditMode():!this.isEditMode&&this.enterEditMode())},onAttrsDoubleClick:function(){this.selected&&this.addToCartWidget.showSkus&&("both"===this.selectionState?(this.setSelectionState("selects"),this.workspace.controls.findControl("add_to_cart_settings").select()):"button"===this.selectionState&&this.setSelectionState("both"))},onBlockMousedown:function(t){this.isEditMode&&!Object(r.a)(t.target).is(this.addToCartWidget.$buttonText)&&this.leaveEditMode({deselectControl:!0,saveWidgetData:!0}),this.addToCartWidget.showSkus&&("button"!==this.selectionState||Object(r.a)(t.target).is(this.addToCartWidget.$buttonText)||this.setDefaultSelectionState(),"selects"!==this.selectionState||Object(r.a)(t.target).is(this.$attributesBox)||this.setDefaultSelectionState())},enterEditMode:function(t){this.isEditMode=!0,this.addToCartWidget&&this.addToCartWidget.enterEditMode(t),this.determineButtonType({enter_edit_mode:!0})},leaveEditMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addToCartWidget&&(this.addToCartWidget.leaveEditMode(t),this.model.set("text",this.addToCartWidget.getButtonText())),t.deselectControl&&this.deselectEditControl(),this.isEditMode=!1,this.determineButtonType(),this.recalcButtonTextSize(),t.saveWidgetData&&this.saveWidgetData()},selectEditControl:function(){var t=this.workspace&&this.workspace.controls;if(t){var e=t.findControl("button_edit");e&&e.master.select(e)}},deselectEditControl:function(){var t=this.workspace&&this.workspace.controls;if(t){var e=t.findControl("button_edit");e&&e.master.deselect()}},onTextInput:function(){this.recalcButtonTextSize()},css:function(t){l.a.prototype.css.apply(this,arguments),this.addToCartWidget.recalcDimensions(t)},onResizeEnd:function(){var t=this.getSaveBoxData(),e=this.$button.outerWidth(),i=this.$button.outerHeight();this.model.get("btn_w")===e&&this.model.get("btn_h")===i||(this.model.set({w:t.w,h:t.h,btn_w:e,btn_h:i}),this.addToCartWidget.setData(O.a.clone(this.model.attributes)),this.saveWidgetData())},setSizeConstraints:function(t,e){O.a.extend(this.frame,{minwidth:t,maxwidth:9999,minheight:e,maxheight:9999})},setMinimalDimensions:function(){this.addToCartWidget&&this.addToCartWidget.setMinimalDimensions()},changeSelectedProduct:function(t){this.model.save({selected_product_id:t})},onProductChange:function(t){this.addToCartWidget.onProductChange(O.a.clone(t.attributes)),this.updateAnimationTrigger(),this.addToCartWidget.showSkus?this.recalcSelectsTextSize(!0):(this.model.set({"attrs-text_w":0,"attrs-text_h":0}),this.addToCartWidget.setData(O.a.clone(this.model.attributes)),this.setMinimalDimensions())},onLayoutChange:function(t){this.addToCartWidget.onLayoutChange(O.a.clone(t.attributes)),this.updateAnimationTrigger()},determineButtonType:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.model.get("icon_enabled"),n=!!e.enter_edit_mode||this.addToCartWidget.getButtonText().length;t=i&&n?"text_and_icon":i&&!n?"icon":"text",this.model.set("tp",t)},onTypeChange:function(){},getRealTextSize:function(t){var e,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=O.a.clone(this.model.attributes),a=o["".concat(n,"font-size")],s=o["".concat(n,"letter-spacing")],l=o["".concat(n,"font-family")],c=o["".concat(n,"font-style")],d=o["".concat(n,"font-weight")];return this.$textInputSizeAdjuster&&this.$textInputSizeAdjuster.length||(this.$textInputSizeAdjuster=Object(r.a)("<div/>"),this.$textInputSizeAdjuster.css({width:"auto","white-space":"pre"}).appendTo(this.$sizesCalculatingBlock)),this.$textInputSizeAdjuster.text(t),this.$textInputSizeAdjuster.css({"font-family":l,"font-style":c,"font-weight":d,"font-size":a+"px","letter-spacing":s+"px"}),e=this.$textInputSizeAdjuster.width(),i=this.$textInputSizeAdjuster.height(),this.$textInputSizeAdjuster.empty(),{width:e=2*Math.ceil(e/2),height:i=2*Math.ceil(i/2)}},recalcSelectsTextSize:function(t){if("selects"===this.selectionState||t){var e=this.addToCartWidget.getLongestAttribute(),i=2*this.addToCartWidget.getSelectsPadding(),n=this.getRealTextSize(e,"attrs-"),o=this.model.get("btn_w"),a=this.model.get("btn_h"),s=n.width+2*this.addToCartWidget.getHorizontalTextMargin(this.model.get("attrs-font-size")),r=n.height+2*this.addToCartWidget.getVerticalTextMargin(this.model.get("attrs-font-size")),l={"attrs-text_w":s,"attrs-text_h":r};s+i>o&&(l.btn_w=s+i),r>a&&(l.btn_h=r);var c=O.a.clone(this.model.attributes);if(this.addToCartWidget.setData(Te(Te({},c),l)),l.btn_w||l.btn_h){var d=this.addToCartWidget.recalcDimensionsOnProductChange();l.w=d.width,l.h=d.height,l.btn_w&&(l.x=c.x-Math.floor((d.width-c.w)/2)),l.btn_h&&(l.y=c.y-Math.floor((d.height-c.h)/2))}this.model.set(l),this.setMinimalDimensions.__debounced(),(l.btn_w||l.btn_h)&&this.updateAnimationTrigger()}},onAttrsIconSizeChange:function(t){var e=O.a.clone(t.attributes);this.addToCartWidget.applySelectsIconSize(e),this.setMinimalDimensions.__debounced();var i=e["attrs-icon-h"]+2*this.addToCartWidget.getVerticalIconMargin(e["attrs-icon-h"]);if(i>e.btn_h){var n={btn_h:i};this.addToCartWidget.setData(Te(Te({},e),n));var o=this.addToCartWidget.recalcDimensionsOnProductChange();n.w=o.width,n.h=o.height,n.y=e.y-Math.floor((o.height-e.h)/2),this.model.set(n),this.updateAnimationTrigger()}},recalcButtonTextSize:function(){var t,e=O.a.clone(this.model.attributes),i=this.addToCartWidget.getButtonText(),n=this.getRealTextSize(i),o=this.getRealTextSize("Out of stock"),a=n.width>o.width?n.width:o.width,s=n.height>o.height?n.height:o.height,r=this.addToCartWidget.getHorizontalTextMargin(e["font-size"]),l=a+2*r,c=s+2*this.addToCartWidget.getVerticalTextMargin(e["font-size"]),d=(Ie(t={},"text_w",l),Ie(t,"text_h",c),t);if("text"===e.tp||"text_and_icon"===e.tp){var h="text_and_icon"===e.tp&&e.icon_enabled?l+e.icon_w+r:l;if(h>e.btn_w&&(d.btn_w=h),c>e.btn_h&&(d.btn_h=c),this.addToCartWidget.setData(Te(Te({},e),d)),d.btn_w||d.btn_h){var u=this.addToCartWidget.recalcDimensionsOnProductChange();d.w=u.width,d.h=u.height,d.btn_w&&(d.x=e.x-Math.floor((u.width-e.w)/2)),d.btn_h&&(d.y=e.y-Math.floor((u.height-e.h)/2))}this.setMinimalDimensions.__debounced()}this.model.set(d),(d.btn_w||d.btn_h)&&this.updateAnimationTrigger()},onButtonTextSizeChange:function(){this.addToCartWidget.applyButtonTextSize(O.a.clone(this.model.attributes))},recalcButtonSizeOnIconChange:function(t){var e,i=2*this.addToCartWidget.getVerticalIconMargin(t.icon_h),n=2*this.addToCartWidget.getHorizontalIconMargin(t.icon_w),o=t.icon_h+i,a={};if("text_and_icon"===t.tp)e=t.text_w+t.icon_w+this.addToCartWidget.getHorizontalTextMargin(t["font-size"]);else{if("icon"!==t.tp)return;e=t.icon_w+n}if(e>t.btn_w&&(a.btn_w=e),o>t.btn_h&&(a.btn_h=o),a.btn_w||a.btn_h){this.addToCartWidget.setData(Te(Te({},t),a));var s=this.addToCartWidget.recalcDimensionsOnProductChange();a.w=s.width,a.h=s.height,a.btn_w&&(a.x=t.x-Math.floor((s.width-t.w)/2)),a.btn_h&&(a.y=t.y-Math.floor((s.height-t.h)/2)),this.model.set(a),this.updateAnimationTrigger()}},recalcButtonSize:function(){},initIcon:function(t){this.model.get("icon_enabled")&&this.getIconSVG(this.model.get("icon_noun_id")||this.model.get("icon_rm_id"),this.model.get("icon_noun_url"),function(e,i){!e&&i.$svg&&(this.renderIcon({$svg:this.getСoloredIconSVG()}),this.model.get("icon_rasterUrl")||this.rasterizeSVG({default:!0,hover:!0}),t&&"function"==typeof t&&t(null,null,{dontRasterize:!0}))}.bind(this))},renderIcon:function(){ie.prototype.renderIcon.apply(this,arguments)},recalcIconContainerSize:function(t,e,i){if("text"!==this.model.get("tp"))if(this.currentIconData){var n=this.model.get("icon_h"),o=Math.floor(n*this.currentIconData.aspect_ratio);this.model.set({icon_w:o});var a=O.a.clone(this.model.attributes);this.recalcButtonSizeOnIconChange(a),this.addToCartWidget.renderButtonIcon(a),this.addToCartWidget.setData(a),this.setMinimalDimensions.__debounced(),i&&i.dontRasterize||i&&(i.onIconChange||i.undo||i.redo)||this.rasterizeSVG.__debounced_both({default:!0,hover:!0})}else this.initIcon(this.recalcIconContainerSize.bind(this));else this.addToCartWidget.renderButtonIcon(O.a.clone(this.model.attributes))},rasterizeSVG:function(){ie.prototype.rasterizeSVG.apply(this,arguments)},onIconChange:function(t,e,i){if("boolean"==typeof e&&!1===e)return this.$buttonIcon.empty(),void this.recalcIconContainerSize(t,e,{onIconChange:!0});this.getIconSVG(t.get("icon_noun_id")||t.get("icon_rm_id"),t.get("icon_noun_url"),function(t,e){!t&&e.$svg&&(i.undo||i.redo||this.recalcIconContainerSize(null,null,{onIconChange:!0}),this.renderIcon({$svg:this.getСoloredIconSVG()}),i.undo||i.redo||this.rasterizeSVG({default:!0,hover:!0}))}.bind(this))},onIconPositionChange:function(){this.addToCartWidget.applyButtonIconPosition(O.a.clone(this.model.attributes))},onIconColorChange:function(){ie.prototype.onIconColorChange.apply(this,arguments)},"getСoloredIconSVG":function(){return ie.prototype.getСoloredIconSVG.apply(this,arguments)},getDefaultIconSVG:function(){return ie.prototype.getDefaultIconSVG.apply(this,arguments)},getIconSVG:function(){return ie.prototype.getIconSVG.apply(this,arguments)},prepareIconSVG:function(){return ie.prototype.prepareIconSVG.apply(this,arguments)},cacheSVGData:function(){ie.prototype.cacheSVGData.apply(this,arguments)},getSVGCacheItem:function(){return ie.prototype.getSVGCacheItem.apply(this,arguments)},updateBlockSizes:function(t){this.model.set({w:t.width,h:t.height})},saveWidgetData:function(){O.a.isEqual(this.model.toJSON(),this._oldAttrs)||(this.saveXHR&&this.saveXHR.abort(),this._oldAttrs=O.a.clone(this.model.toJSON()),this.saveXHR=this.model.save())},getIndividualStyles:function(){var t=["background-color","background-color-opacity","attrs-background-color","attrs-background-color-opacity","border-radius","attrs-border-radius","border-width","attrs-border-width","border-color","attrs-border-color","border-color-opacity","attrs-border-color-opacity","font-family","attrs-font-family","font-style","attrs-font-style","font-weight","attrs-font-weight","font-size","attrs-font-size","letter-spacing","attrs-letter-spacing","color","attrs-color","color-opacity","attrs-color-opacity","icon_color","icon_color_opacity","text-align","attrs-text-align","attrs-icon-size","hover-background-color","hover-background-color-opacity","attrs-hover-background-color","attrs-hover-background-color-opacity","hover-border-radius","attrs-hover-border-radius","hover-border-width","attrs-hover-border-width","hover-border-color","attrs-hover-border-color","hover-border-color-opacity","attrs-hover-border-color-opacity","hover-color","attrs-hover-color","hover-color-opacity","attrs-hover-color-opacity","hover-icon_color","hover-icon_color_opacity","hover-tansition-duration"];return t.forEach((function(t,e,i){i[e]="change:"+t})),t.join(" ")}},{defaults:{h:Se.a.DEFAULT_ROW_HEIGHT,w:Se.a.DEFAULT_ROW_WIDTH,x:"center",selected_product_id:"default",layout:"vertical",tp:"text",btn_w:168,btn_h:50,text_w:106,text_h:24,hidden:!1,select_btn_margin:10,attributes_margin:10,text:"Add to cart","background-color":"282828","background-color-opacity":100,"border-radius":30,"border-width":0,"border-color":"000000","border-color-opacity":100,"font-family":"Arial","font-style":"normal","font-weight":400,"font-size":18,"letter-spacing":0,"text-align":"center",color:"ffffff","color-opacity":100,"hover-background-color":"282828","hover-background-color-opacity":100,"hover-border-radius":30,"hover-border-width":0,"hover-border-color":"000000","hover-border-color-opacity":100,"hover-color":"ffffff","hover-color-opacity":100,"hover-tansition-duration":0,icon_color:"ffffff",icon_color_opacity:100,icon_enabled:!1,icon_h:18,icon_w:18,icon_rm_id:null,icon_noun_id:null,icon_noun_url:null,icon_pos:"left",icon_raster2xUrl:null,icon_rasterUrl:null,"hover-icon_color":"ffffff","hover-icon_color_opacity":100,"hover-icon_raster2xUrl":null,"hover-icon_rasterUrl":null,"attrs-background-color":"282828","attrs-background-color-opacity":100,"attrs-border-radius":30,"attrs-border-width":0,"attrs-border-color":"000000","attrs-border-color-opacity":100,"attrs-font-family":"Arial","attrs-font-style":"normal","attrs-font-weight":400,"attrs-font-size":18,"attrs-letter-spacing":0,"attrs-color":"ffffff","attrs-color-opacity":100,"attrs-hover-background-color":"282828","attrs-hover-background-color-opacity":100,"attrs-hover-border-radius":30,"attrs-hover-border-width":0,"attrs-hover-border-color":"000000","attrs-hover-border-color-opacity":100,"attrs-hover-color":"ffffff","attrs-hover-color-opacity":100,"attrs-icon-h":16,"attrs-icon-w":10,"attrs-text_w":0,"attrs-text_h":0}}),Ae=i("i8i4"),De=i.n(Ae),ze=i("LazK"),Le=i("3uGt"),Be=l.a.extend({name:"RM Header",thumb:"rm-header",icon_color:"#282828",initial_controls:["rmheader_settings","common_position","common_lock"],restrictions:function(){var t=window.RM.constructorRouter&&window.RM.constructorRouter.me&&window.RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e)},render:function(){var t=this;this.create(),this.$el.addClass("rm-header"),this.controls=this.initial_controls,Object(r.a)('<div id="rm-header-mobile-portal">').appendTo("body"),this.propsModel=new o.a.Model({isDesktop:"default"===this.model.getViewport()}),this.$header=this.$content.get(0);Object(d.renderReact)({component:function(){return s.a.createElement(d.CreateContextProvider,{context:Le.b,model:t.propsModel},s.a.createElement(ze.a,null))},domElement:this.$header,model:this.model}),this.bindModelEvents(),this.fixMobileViewport(),this.rendered=!0,this.triggerReady()},redraw:function(){return this.fixMobileViewport(),l.a.prototype.redraw.apply(this,arguments)},bindModelEvents:function(){this.model.on("change:activeLink",this.onActiveLinkChange,this)},unbindModelEvents:function(){this.model.off("change:activeLink",this.onActiveLinkChange,this)},onActiveLinkChange:function(){this.model.save()},destroy:function(){return this.unbindModelEvents(),De.a.unmountComponentAtNode(this.$header),l.a.prototype.destroy.apply(this,arguments)},fixMobileViewport:function(){var t="default"===this.model.getViewport();this.propsModel.set({isDesktop:t})}},{defaults:{activeLink:"none",full_width_initial_w:480,full_width_initial_x:0,full_width_margin:0,is_full_width:!0,fixed_position:"n",is_above:!0,is_global:!0,h:72,x:0,y:0,w:Object(r.a)(window).width()}}),Fe=i("1cLU"),Ne=l.a.extend({name:"RM Footer",thumb:"rm-footer",icon_color:"#282828",initial_controls:["common_position","common_lock"],restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e),this.propsModel=new Backbone.Model({isMobileViewport:!1})},render:function(){this.create(),this.$el.addClass("rm-footer"),this.controls=this.initial_controls,this.$footer=Object(r.a)("<div>").appendTo(this.$content).get(0),Object(d.renderReact)({component:Fe.a,domElement:this.$footer,model:this.propsModel}),this.fixMobileViewport(),this.rendered=!0,this.triggerReady()},redraw:function(){return this.fixMobileViewport(),l.a.prototype.redraw.apply(this,arguments)},fixMobileViewport:function(){var t="default"===this.model.getViewport();this.propsModel.set({isMobileViewport:!t})},destroy:function(){return De.a.unmountComponentAtNode(this.$footer),l.a.prototype.destroy.apply(this,arguments)}},{defaults:{full_width_initial_w:480,full_width_initial_x:0,full_width_margin:0,is_above:!1,is_full_width:!0,modelType:"widget",sticked:"bottom",sticked_margin:0,h:360,w:Object(r.a)(window).width(),y:656}}),Ue=i("Kw5r"),He=i("4rJ8"),Ve=l.a.extend({name:"RM Cookies",thumb:"rm-cookies",icon_color:"#282828",initial_controls:["common_position","common_lock"],restrictions:function(){var t=RM.constructorRouter&&RM.constructorRouter.me&&RM.constructorRouter.me.get("permissions");return t&&t.can_use_rm_widgets},initialize:function(t,e){this.initBlock(t,e)},render:function(){this.create(),this.$el.addClass("rm-cookies"),this.controls=this.initial_controls;var t=Ue.default.extend(He.a);this.vue=new t({el:this.$content.get(0)}),this.rendered=!0,this.triggerReady()},destroy:function(){return this.vue&&this.vue.$destroy(),l.a.prototype.destroy.apply(this,arguments)}},{defaults:{w:356,h:116}}),We=i("fEUr"),Ge=i("3TY3");function qe(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function Ke(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?qe(Object(i),!0).forEach((function(e){Xe(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):qe(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Xe(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Ye(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}var Ze=l.a.extend({name:"Shots",thumb:"shots",icon_color:"#A4840D",sort_index:14,initial_controls:["shots_settings","playback_settings","common_animation","common_rotation","common_position","common_layer","common_lock"],viewport_fields:g.b.viewport_fields.shots,restrictions:function(){return Object(c.a)("widget.shots")},canBeUsed:function(){return window.RM.constructorRouter.me&&window.RM.constructorRouter.me.get("permissions").can_use_shots},initialize:function(t,e){var i=this;this.controls=t.get("basePath")?this.initial_controls:this.initial_controls.filter((function(t){return"playback_settings"!==t})),this.initBlock(t,e),this.page=e.page,this.listenTo(this.page,"change:viewport",this.onViewportChange),this.stateModel=new o.a.Model({viewport:this.page.getCurrentViewport(),canBeUsed:this.canBeUsed()}),this.onViewportChange(),this.listenTo(this,"select",(function(){i.stateModel.set("isSelected",!0)})),this.listenTo(this,"deselect",(function(){i.stateModel.set("isSelected",!1)})),this.listenTo(this.model,"change:triggers",(function(){return i.resetAnimationTriggers()})),this.listenTo(this.model,"change:basePath",(function(t){t&&!i.controls.includes("playback_settings")&&(i.controls=i.initial_controls,i.updateControls())}))},render:function(){var t=function(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){Ye(a,n,o,s,r,"next",t)}function r(t){Ye(a,n,o,s,r,"throw",t)}s(void 0)}))}}(regeneratorRuntime.mark((function t(){var e,n,o,a,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.create(),this.$el.addClass("shots"),t.next=4,Promise.resolve().then(i.bind(null,"8AXF"));case 4:return e=t.sent,n=e.renderReact,t.next=8,Promise.resolve().then(i.bind(null,"3TY3"));case 8:o=t.sent,a=o.Shots,n({component:function(){return s.a.createElement(d.CreateContextProvider,{context:Ge.ShotsStateContext,model:r.stateModel},s.a.createElement(a,{mode:"constructor",useSharedState:r.useSharedState}))},domElement:this.$content[0],model:this.model}),this.rendered=!0,this.triggerReady();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),getIconStyle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.small&&this.icon_color?{"background-color":this.icon_color}:{"background-repeat":"no-repeat","background-image":"url(".concat(Object(X.findImagePath)("./constructor/widgetbar/icons/".concat(this.thumb,".svg")),")"),"border-radius":"0"}},destroy:function(){return this.stopListening(),this.stateModel.set({isDestroyed:!0}),l.a.prototype.destroy.apply(this,arguments)},onViewportChange:function(){var t=this.page.getCurrentViewport();this.stateModel.set({viewport:t}),this.nonReactSetSharedState({viewport:t})}},{getViewportDefaults:function(t,e,i){var n=t.get("hoverDirection");return Ke(Ke({},l.a.getViewportDefaults(t,e,i)),{},{hoverDirection:"default"!==e&&n===We.a.vertically?We.a.horizontally:n})},defaults:{basePath:"",numberOfImages:0,playbackType:We.b.hover,scrollSpeed:1,scrollStartPoint:We.c.bottom,scrollDelay:0,hoverDirection:We.a.horizontally,triggers:[],startPointOffset:0}});e.a={text:G,video:Y,audio:it,backgroundVideo:nt,background:ht,picture:St,slideshow:It,twitter:zt,facebook:Ut,shape:Vt,iframe:Kt,gmaps:Qt,button:ie,hotspot:fe,form:we,ecommercecart:ke,addtocart:Re,rmheader:Be,rmfooter:Ne,rmcookies:Ve,shots:Ze}},tRog:function(t,e,i){"use strict";var n=i("xi34"),o=i("rFsW"),a=i("Kw5r"),s=i("OTSC"),r={model:{event:"change"},props:{value:Number,autofocus:{type:Boolean,default:!1},autosize:{type:Boolean,default:!1},wait:{type:Number,default:null},min:{type:Number,default:Number.NEGATIVE_INFINITY},max:{type:Number,default:Number.POSITIVE_INFINITY},dir:{type:String,default:"v"},speed:{type:Number,default:3},step:{type:Number,default:1},labelSelector:{type:String,default:""},shiftStep:{type:Number,default:10},useFloat:{type:Boolean,default:!1},mouseOnly:{type:Boolean,default:!1},mouseUse:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},thousandDelimiter:{type:String,default:""},debounceKeyboard:{type:Number,default:void 0}},computed:{computedValue:{get:function(){var t,e=this;return t=this.$$el?this.$$el.data("formatValue")(this.value):this.value,this.autosize&&a.default.nextTick((function(){s.default.setInputSize(Object(n.a)(e.$el),150)})),t}}},watch:{mouseUse:function(t){var e=this;a.default.nextTick((function(){var t=e.$$el.data("destroy");o.a.isFunction(t)&&t(),Object(n.a)(e.$$el).RMNumericInput({onChange:e.onChange,labelSelector:e.labelSelector,useFloat:e.useFloat})}))},min:function(t){this.$$el.data("changeMinMax")(t)},max:function(t){this.$$el.data("changeMinMax")(void 0,t)}},mounted:function(){this.$$el=Object(n.a)(this.$el);var t=function(){Object(n.a)(this.$$el).RMNumericInput({onChange:this.onChange,labelSelector:this.labelSelector,useFloat:this.useFloat}),this.$$el.data("formatValue")(this.value),this.autosize&&s.default.setInputSize(Object(n.a)(this.$el),150,this.$$el.val())}.bind(this);this.wait?s.default.waitForTransitionEnd(this.$$el,this.wait,"opacity",function(){t()}.bind(this)):t()},methods:{onChange:function(t,e){this.disabled||this.$emit("change",e)},updateSize:function(){s.default.setInputSize(this.$$el,200)}}},l=(i("+Xeu"),i("KHd+")),c=Object(l.a)(r,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{staticClass:"param-input",attrs:{type:"text",spellcheck:"false","data-useFloat":t.useFloat,"data-step":t.step,"data-min":t.min,"data-max":t.max,"data-mouseDir":t.dir,"data-mouseSpeed":t.speed,"data-shiftStep":t.shiftStep,"data-autofocus":t.autofocus,"data-autoSize":t.autosize,wait:t.wait,"data-mouseOnly":t.mouseOnly,readonly:t.readonly||t.mouseOnly,disabled:t.disabled,"data-mouseUse":t.mouseUse+"","data-thousandDelimiter":t.thousandDelimiter,"data-debounceKeyboard":t.debounceKeyboard},domProps:{value:t.computedValue}})}),[],!1,null,null,null);e.a=c.exports},tVJf:function(module,exports){module.exports={"template-constructor-control-form_styles":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="icon noarrow" data-alt="Styles" data-alt-pos="left" data-alt-offset="9"></div>\n\n\n\t<div class="panel">\n\n\t\t<div class="common-wrapper">\n\n\t\t\t<div class="edit-wrapper" data-state="fields" data-button-state="default" data-style="" data-layout="">\n\n\t\t\t\t<div class="control-caption">Layout</div>\n\n\t\t\t\t<div class="layout-wrapper">\n\t\t\t\t\t<div class="layout-switcher layout-vertical"></div>\n\t\t\t\t\t<div class="layout-switcher layout-horizontal"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="style-wrapper">\n\t\t\t\t\t<div class="prev-style"></div>\n\t\t\t\t\t<div class="style-caption"></div>\n\t\t\t\t\t<div class="next-style"></div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="type-wrapper">\n\t\t\t\t\t<div class="type-switcher type-fields">Fields</div>\n\t\t\t\t\t<div class="type-switcher type-button">Button</div>\n\t\t\t\t</div>\n\n\n\t\t\t\t<div class="button-switcher-wrapper">\n\t\t\t\t\t<div class="button-switcher button-default">Default</div>\n\t\t\t\t\t<div class="button-switcher button-hover">Hover</div>\n\t\t\t\t</div>\n\n\n\n\t\t\t\t<div class="params-wrapper">\n\n\t\t\t\t\t\x3c!-- Fields --\x3e\n\t\t\t\t\t<div class="params-block params-fields">\n\n\t\t\t\t\t\t<div class="edit-item" data-field="gutter">\n\t\t\t\t\t\t\t<div class="caption">Spacing</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="border-radius">\n\t\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="underline-width">\n\t\t\t\t\t\t\t<div class="caption">Underline</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item underline-color color-click-area" data-field="underline-color" data-field-dop="underline-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t \x3c!-- Font Family --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-family-click-area" title="Font Family">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!-- Font Style --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-style-click-area" title="Font Style">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="font-size" title="Font Size">\n\t\t\t\t\t\t\t<div class="font-size-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="letter-spacing" title="Tracking">\n\t\t\t\t\t\t\t<div class="letter-spacing-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\n\n\n\n\t\t\t\t\t\x3c!-- Button default --\x3e\n\t\t\t\t\t<div class="params-block params-button-default">\n\n\t\t\t\t\t\t<div class="edit-item" data-field="gutter">\n\t\t\t\t\t\t\t<div class="caption"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="color" data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="border-radius">\n\t\t\t\t\t\t\t<div class="caption">Radius</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t \x3c!-- Font Family --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-family-click-area" title="Font Family">\n\t\t\t\t\t\t\t<div class="font-family"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t\x3c!-- Font Style --\x3e\n\t\t\t\t\t\t<div class="edit-item separator font-style-click-area" title="Font Style">\n\t\t\t\t\t\t\t<div class="font-style"></div>\n\t\t\t\t\t\t\t<div class="popup-arrow"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="font-size" title="Font Size">\n\t\t\t\t\t\t\t<div class="font-size-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item separator" data-field="letter-spacing" title="Tracking">\n\t\t\t\t\t\t\t<div class="letter-spacing-icon"></div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator align" data-field="align" title="Align">\n\t\t\t\t\t\t\t<div class="caption"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\n\n\n\n\n\t\t\t\t\t\x3c!-- Button hover --\x3e\n\t\t\t\t\t<div class="params-block params-button-hover">\n\n\t\t\t\t\t\t<div class="edit-item color-click-area" data-field="color"  data-field-dop="opacity">\n\t\t\t\t\t\t\t<div class="caption">Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\n\t\t\t\t\t\t<div class="edit-item combined separator" data-field="border-width">\n\t\t\t\t\t\t\t<div class="caption">Border</div>\n\t\t\t\t\t\t\t<input spellcheck="false" type="text" value=""/>\n\n\t\t\t\t\t\t\t<div class="edit-item border-color color-click-area" data-field="border-color" data-field-dop="border-opacity">\n\t\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator color-click-area" data-field="text-color" data-field-dop="text-opacity">\n\t\t\t\t\t\t\t<div class="caption">Text Color</div>\n\t\t\t\t\t\t\t<div class="opacity-grid"></div>\n\t\t\t\t\t\t\t<div class="color-circle"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="edit-item separator clearfix" data-field="transition">\n\t\t\t\t\t\t\t<div class="caption" title="For Color, Border Color & Width, Text Color">Transition</div>\n\t\t\t\t\t\t\t<div class="switcher transition-switcher"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</div>\n\n\t\t\t</div>\n\n\t\t</div>\n\n\n\t\t<div class="colorbox_container"></div>\n\n\t\t<div class="fontselector_container"></div>\n\n\t\t<div class="fontstyle_container">\n\t\t\t<div class="font-style-wrapper"></div>\n\t\t</div>\n\n\t</div>\n\n';return __p}}},tcT1:function(t,e,i){"use strict";i.r(e);var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("5ta/"),l=i("avvt"),c=i("OTSC"),d=i("tZHv"),h=i("Kf/z"),u=i("JW7n");function p(t,e,i,n,o,a,s){try{var r=t[a](s),l=r.value}catch(t){return void i(t)}r.done?e(l):Promise.resolve(l).then(n,o)}function g(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var a=t.apply(e,i);function s(t){p(a,n,o,s,r,"next",t)}function r(t){p(a,n,o,s,r,"throw",t)}s(void 0)}))}}var m,f,v,b=a.a.Router.extend({routes:Object(h.a)("constructor.newProjectSettings")?{":user(/)(:mag)(/)(*pageUri)(/)":"start"}:{":user(/)(:mag)(/)(:pageUri)(/)":"start"},mags:{},initialize:function(){var t=this;if(Modernizr.addTest("chrome",(function(){return s.a.isObject(window.navigator)&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Object(h.a)("constructor.newProjectSettings")?RM.common.isDomainViewer&&(RM.common.customDomainProfile?this.route(":mag(/)(*pageUri)(/)","start"):this.route("(*pageUri)(/)","start")):RM.common.isDomainViewer&&this.route("(:mag)(/)(*pageUri)(/)","start"),RM.common.isDownloadedSource&&(this.route("(*pageUri)(/)","start"),/msie [6-9]/i.test(navigator.userAgent)&&(location.href="sorry.html")),Object(n.a)("html").toggleClass("viewer-embed-mode",!!RM.common.embedMode),s.a.bindAll(this),Object(h.a)("constructor.textv3")&&Object(u.c)("viewer"),this.environment=d.a.environment.viewer,this.started=!1,!RM.common.isDownloadedSource&&window.RM.data.usersLoader.me&&(this.me=window.RM.data.usersLoader.me),this.$mags_container=Object(n.a)("#mags"),this.magsData=window.ServerData&&window.ServerData.mags,this.userPermissions=window.ServerData&&window.ServerData.userPermissions,this.internalHistory=[],this.magsData){if(this.cachedMag=this.magsData.mag,!this.cachedMag||!this.cachedMag.user||!this.cachedMag.user._id)return;RM.common.isDownloadedSource||(this.cachedMag.user.isMe=this.me&&this.me.get("_id")==this.cachedMag.user._id),RM.common.isDomainViewer&&(this.magUri=this.cachedMag.uri,this.userUri=this.cachedMag.user&&this.cachedMag.user.uri)}RM.screenshot||i.e(17).then(i.bind(null,"hXNS")).then((function(e){var i=e.default;RM.analytics=RM.analytics||new i({router:t}),t.analytics=RM.analytics,RM.common.isDomainViewer||c.default.processCustomTrackingEventCookies()})),this.isPreview||Modernizr.sessionstorage&&window.sessionStorage.removeItem("constructorViewport")},start:function(t,e,o){var r=this;if(RM.common.isDomainViewer&&(this.magsData.magNotFound||this.magsData.domainNotFound||this.magsData.magNotPublished||this.magsData.subscriptionExpired))i.e(4).then(i.bind(null,"AnuO")).then((function(t){new(0,t.default)({type:"domain-error",$container:Object(n.a)("#service-pages"),templateData:{state:r.magsData}}).render()}));else if(Modernizr.msie||Modernizr.msie11)Promise.resolve().then(i.bind(null,"YqYG")).then((function(t){new(0,t.default)({$parent:Object(n.a)("body > .popups"),router:r,opts:{type:"type-browsers-viewer"}}).render()}));else{if(RM.common.isDomainViewer&&!RM.common.customDomainProfile)parseInt(t,10)!=t&&t&&/^p\d+\/?$/i.test(t)?(o=null,e=t,t=null):(o=t,t=this.userUri,e=this.magUri);else if(RM.common.isDownloadedSource)o=t,t=null,e=null;else if(parseInt(t,10)==t||/^p\d+\/?$/i.test(t)){var c=e;e=t,o=c,t=null}else if(RM.common.customDomainProfile){c=e;e=t,o=c,t=this.userUri}else if(!e)return this.notFound();this.latestFragment=a.a.history.getFragment(),o=o||1;var d=t+"_"+e;if(this.username=t,this.started!=d||this.loaded==d)if(this.started=d,this.loaded!=this.started){if(this.cachedMag&&!s.a.isEmpty(this.cachedMag))return this.cachedMag instanceof l.a||this.cachedMag.forbidden||this.cachedMag.is_suspended||(this.cachedMag=new l.a(this.cachedMag,this)),this.mag=this.cachedMag,void this.onLoadMag(o);this._loadingMagDataXHR&&this._loadingMagDataXHR.abort(),this._loadingMagDataXHR=this.fetchData(this.username,e,{success:s.a.bind((function(t){this.mag&&this.mag.num_id&&t&&t.num_id!=this.mag.num_id&&window.location.reload(),this.mag=new l.a(t,this),this.cachedMag=this.mag,this.onLoadMag(o)}),this),error:this.notFound})}else this.go(o,{animation:!1})}},onLoadMag:function(t){var e;if(this.loaded=this.started||!0,this.mag.forbidden)return this.requestMagPassword(this.latestFragment,s.a.clone(this.mag)),delete this.cachedMag,delete this.loaded,void delete this.started;this.mag.is_suspended?this.showSuspended():(RM.common.isDownloadedSource||(n.a.post("/api/countview/"+this.mag.num_id),RM.analytics&&(RM.analytics._triggerProjectView=!0)),this.mag._requested_page?(e=this.mag._requested_page,delete this.mag._requested_page):e=t,Modernizr.addTest("screenshot-mode",(function(){return RM.screenshot})),this.mag.render(),this.go(e,{animation:!1}),RM.common.mode="mag")},getAnalyticsDimensions:function(){return{magId:this.mag&&this.mag.model&&this.mag.model.get("num_id")||this.mag&&this.mag.num_id,magCreatorId:this.mag&&this.mag.model&&this.mag.model.user.get("_id")||this.mag&&this.mag.user._id,pageType:"viewer",userId:this.me&&this.me.get("_id")}},fetchData:function(t,e,i){return(i=i||{}).url=t?"/api/readymag/"+t+"/"+e:"/api/readymag/"+e,n.a.ajax(i)},sendReadyEvent:function(t){t=t||{},t=s.a.defaults(t,{page:{}});var e=document.createElement("MyExtensionDataElement");e.setAttribute("width",t.page.width),e.setAttribute("height",t.page.height),e.setAttribute("_id",t.page._id),document.documentElement.appendChild(e);var i=document.createEvent("Events");if(t&&t.error?i.initEvent("MyErrorEvent",!0,!1):i.initEvent("MyExtensionEvent",!0,!1),e.dispatchEvent(i),window.loadNotifier){if(t.error)return window.loadNotifier({error:t.error});window.loadNotifier({width:t.page.width,height:t.page.height})}},setTitle:function(){if(this.mag&&this.mag.currentPage){var t=s.a.extend({},this.mag.model.toJSON());t.user=this.mag.user,document.title=r.getFinalSEO(this.mag.currentPage,t,{customDomain:!!RM.common.isDomainViewer}).title}},trackPage:function(){RM.screenshot||s.a.defer(s.a.bind((function(){this.analytics&&this.analytics.trackPage()}),this))},go:function(t,e){if(t=t||1,Object(h.a)("constructor.newProjectSettings")){if(e.isPageNum)return this.mag.showPage(t,e);var i=this.mag.getPageByPath(t)||{};this.mag.showPage(i.num||1,e)}else this.mag.showPage(t,e)},goBack:function(){var t=this.internalHistory[this.internalHistory.length-2];t&&(t&&this.go(t,{skipInternalHistory:!0}),this.internalHistory.pop())},setUrlString:function(t){if(!this.noUrlRewrite&&(t=t||{},!RM.screenshot)){var e,i=this.mag.currentPage;if(e=RM.common.isDomainViewer&&!RM.common.customDomainProfile||RM.common.isDownloadedSource?"":RM.common.customDomainProfile?this.getMagUri(this.mag):this.username?this.mag.user.uri+"/"+(this.mag.uri||this.mag.num_id)+"/":this.isPreview?this.mag.num_id+"/":this.getMagUri(this.mag),this.isPreview&&(e+="preview/"),i&&"1"!=i.num&&(Object(h.a)("constructor.newProjectSettings")?e+=(i.pagePath||i.uri||i.num.toString())+"/":e+=(i.uri||i.num.toString())+"/"),t.skipInternalHistory?RM.analytics&&RM.analytics.sendEvent("Back Link",e):this.internalHistory.push(i.num.toString()),e!==a.a.history.getFragment()){var n=(parseInt(s.a.last(a.a.history.getFragment(),"/"))||1)==i.num||t.replace;RM.common.isDownloadedSource&&"/"!==s.a.last(e)&&(e+="/"),RM.common.homepageRewrite||this.navigate(e,{replace:n})}}},getPreviousFragment:function(){return this.internalHistory[this.internalHistory.length-2]},getMagUri:function(t){return RM.common.customDomainProfile?(t.uri||t.num_id)+"/":RM.common.isDomainViewer?"":s.a.isEmpty(t.user)?t.num_id+"/":t.user.uri+"/"+(t.uri||t.num_id)+"/"},getUserPermissions:function(){return this.userPermissions||[]},onError:function(){this.mag&&this.go(1,{animation:!1})},createLoginViewForIframe:function(t,e,o){var a=this;Promise.resolve().then(i.bind(null,"BVsp")).then((function(i){new(0,i.default)({useNavigate:!1,$node:Object(n.a)(t),router:a,joinCallback:e,errorMessages:o}).render()}))},createMagFromTemplate:(v=g(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(i.bind(null,"5Rpd"));case 2:new(0,t.sent.default)({router:this,me:this.me,tp:e,templateID:n});case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return v.apply(this,arguments)}),destroy:function(){this.cachedMag&&this.cachedMag.destroy(),this.magPasswordView&&this.magPasswordView.remove(),this.magSuspendedView&&this.magSuspendedView.remove()},requestMagPassword:(f=g(regeneratorRuntime.mark((function t(e,o){var a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.magPasswordView){t.next=6;break}return t.next=3,i.e(11).then(i.bind(null,"3r0x"));case 3:a=t.sent,s=a.default,this.magPasswordView=new s({router:this,$parent:Object(n.a)("#mags")});case 6:this.magPasswordView.render({mag:o,mag_url:e});case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return f.apply(this,arguments)}),showSuspended:(m=g(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.e(4).then(i.bind(null,"AnuO"));case 2:e=t.sent,new(0,e.default)({type:"mag-suspended",$container:Object(n.a)("#service-pages")}).render();case 6:case"end":return t.stop()}}),t)}))),function(){return m.apply(this,arguments)}),notFound:function(){s.a.defer(g(regeneratorRuntime.mark((function t(){var e,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.e(4).then(i.bind(null,"AnuO"));case 2:e=t.sent,o=e.default,new o({type:"404",$container:Object(n.a)("#service-pages")}).render();case 6:case"end":return t.stop()}}),t)}))))}});e.default=b},tcpm:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("gobI"),l=i("OTSC"),c=i("tZHv"),d=i("yWjQ"),h=i.n(d),u=i("QNiq"),p=i("i7aS"),g=i("roQd");function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function v(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var _=a.a.View.extend({THUMBNAILS_HEIGHT:72,COUNTERS_HEIGHT:40,COUNTERS_ADDITIONAL_SPACE:30,COUNTER_WIDTH:14,THUMBNAIL_WIDTH:56,THUMBNAIL_PADDING:8,THUMBNAILS_PADDING:16,swipeStartDistance:5,scrollStartDistance:3,swipeDistance:35,IMG_ACCELERATION_DELAY:500,AUTOPLAY_DELAY:4,SLIDER_TRANSITION:.5,events:{"click .images .prev-picture-arrow-middle":"prevImage","click .images .next-picture-arrow-middle":"nextImage","click .images .prev-picture-arrow-bottom":"prevImage","click .images .next-picture-arrow-bottom":"nextImage","click .images .fullscreen":"toggleFullscreen","click .counters-dots .counter":"counterClick","click .thumbnails .thumb":"thumbnailClick","click .images":"onImageClick","blur .captions .caption":"onCaptionBlur","mousemove .images.mouseover":"onMouseMove","mouseover .images.mouseover.viewer":"onMouseMove","mouseout  .images.mouseover.viewer":"onMouseOut","mouseenter  .images.play-on-hover.viewer":"onMouseEnter","mousemove  .images.play-on-hover.viewer":"changeSlideonHover","mouseleave  .images.play-on-hover.viewer":"stopAutoplay"},initialize:function(t,e,i,o,a){s.a.bindAll(this),this.template=h.a["template-common-slideshow-player"],this.block=o,this.model=o&&o.model,this.params=t,this.$container=e,this.environment=i,this.preloadImagesList=[],this.indexArr=[],this.mag=a,"constructor"===this.environment&&this.checkNeedUpdateWidget(),this.params.w=Math.ceil(this.params.w),this.handleCounters="constructor"===i||t.theme_data.counters&&"dots"===t.theme_data.counters_type||"theme_captions"===t.current_theme,this.handleThumbnails="constructor"===i||t.theme_data.thumbnails,this.currentPic={$el:null,num:null},this.initialRender=!0,this.lastClick=0,this.slidesDirection="",this.render(),this.applyVisualState(t),this.applyPictures(t),this.applyTextStyles(t);var r=this.params.pictures||[];if(this.handleCounters&&this.$counters_container.css("width",r.length*this.COUNTER_WIDTH),this.$counters_container.children(":first-child").addClass("active"),this.handleThumbnails&&this.$thumbnails_container.css("width",r.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.$thumbnails_container.children(":first-child").addClass("active"),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures"),"viewer"===this.environment){var l=this.preloadImagesList.length;if(!l)return s.a.defer(s.a.bind((function(){this.trigger("ready")}),this));var c=s.a.sortBy(r,"num")[0],d=p.a.getLqipUrl(c);if(p.a.flagLQIP()&&d&&this.mag&&this.mag.opts&&this.mag.opts.lqip){var g=Object(n.a)("<div>").addClass("lqip-wrapper").css({height:"".concat(this.params.images_h,"px"),"border-radius":t.theme_data.radius?"".concat(t.theme_data.radius,"px"):""});Object(n.a)("<div>").addClass("lqip").css({transform:"scale(".concat(t.theme_data.fill?1.1:.97,")"),"border-radius":t.theme_data.radius?"".concat(t.theme_data.radius,"px"):"","background-image":"url(".concat(d,")"),"background-size":this.setImageSize(t.theme_data.fill,c.width,c.height,t.w,t.images_h)}).appendTo(g),g.prependTo(this.$images),this.$images.addClass("lqip")}var m=s.a.bind((function(){--l||this.isDestroyed||(this.$images.hasClass("lqip")&&(this.$images.find(".lqip-wrapper").remove(),this.$images.removeClass("lqip")),this.loadRemainingImages(),this.trigger("ready"))}),this);s.a.each(this.preloadImagesList,(function(t){this.isDestroyed||(t.preload=new Image,Object(n.a)(t.preload).on("load",m).on("error",m),t.preload.src=t.url)}),this)}this.$container.append(this.$el),this.initialRender=!1,this.handleCounters&&u.a.isDesktop&&(this.counters_scroll=this.$counters_scroll_wrapper.RMScroll({$container:this.$counters.find(".items-wrapper"),$content:this.$counters_container,$handle:this.$counters.find(".scroll"),wheelScrollSpeed:.1,scrollStep:14,tp:"horizontal",needRecalc:!1}).data("scroll")),this.handleThumbnails&&(u.a.isDesktop?this.thumbnails_scroll=this.$thumbnails_scroll_wrapper.RMScroll({$container:this.$thumbnails.find(".items-wrapper"),$content:this.$thumbnails_container,$handle:this.$thumbnails.find(".scroll"),wheelScrollSpeed:.3,onScroll:this.preloadThumbImages,tp:"horizontal",needRecalc:!1}).data("scroll"):this.$thumbnails.find(".items-wrapper").bind("scroll",this.preloadThumbImages)),this.setSwipeAction()},render:function(){this.setElement(Object(n.a)(this.template({tp:this.environment}))),this.$el.attr("data-id",this.params._id),this.$images=this.$(".images"),this.$images_wrapper=this.$images.find(".images-wrapper"),this.$middle_arrows=this.$images.find(".arrow-middle"),this.$bottom_arrows=this.$images.find(".arrow-bottom"),this.$bottom_arrows_container=this.$images.find(".bottom-arrows"),this.$counters=this.$(".counters-dots"),this.$counters_container=this.$counters.find(".items"),this.$counters_scroll_wrapper=this.$counters.find(".scroll-wrapper"),this.$thumbnails=this.$(".thumbnails"),this.$thumbnails_container=this.$thumbnails.find(".items"),this.$thumbnails_scroll_wrapper=this.$thumbnails.find(".scroll-wrapper"),this.$captions=this.$(".captions")},checkNeedUpdateWidget:function(){(s.a.has(this.model.get("theme_data"),"arrows_position")||s.a.has(this.model.attributes,"active_arrows")||"theme_captions"===this.model.get("current_theme"))&&"bottom"!==this.model.get("active_arrows")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows_position:"bottom"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"arrows_position")||(s.a.has(this.model.attributes,"active_arrows")||"theme_captions"!==this.model.get("current_theme"))&&"middle"!==this.model.get("active_arrows")&&s.a.has(this.model.attributes,"active_arrows")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows_position:"sides"})},{silent:!0}),(s.a.has(this.model.get("theme_data"),"counters_position")||s.a.has(this.model.attributes,"active_arrows")||"theme_captions"!==this.model.get("current_theme"))&&"middle"!==this.model.get("active_arrows")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{counters_position:"outside"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"counters_position")||"bottom"!==this.model.get("active_arrows")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{counters_position:"inside"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"arrows")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows:!0})},{silent:!0}),s.a.has(this.model.get("theme_data"),"arrows_type")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows_type:"default"})},{silent:!0}),"noun"===this.model.get("theme_data").arrows_type&&this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows_type:"library"})},{silent:!0}),this.model.get("theme_data").autoplay&&!s.a.has(this.model.attributes,"play_method")&&this.model.set({play_method:"autoplay"},{silent:!0}),s.a.has(this.model.get("theme_data"),"counters_type")||"theme_captions"===this.model.get("current_theme")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{counters_type:"numbers"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"counters_type")||"theme_captions"!==this.model.get("current_theme")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{counters_type:"dots"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"captions")||"theme_captions"===this.model.get("current_theme")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{captions:!1})},{silent:!0}),s.a.has(this.model.get("theme_data"),"captions")||"theme_captions"!==this.model.get("current_theme")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{captions:!0})},{silent:!0}),s.a.has(this.model.get("theme_data"),"counters")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{counters:!1})},{silent:!0}),s.a.has(this.model.get("theme_data"),"left_icon_noun")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{left_icon_noun:{}})},{silent:!0}),s.a.has(this.model.get("theme_data"),"right_icon_noun")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{right_icon_noun:{}})},{silent:!0}),s.a.has(this.model.attributes,"current_mode")||this.model.set({current_mode:"default"},{silent:!0}),s.a.has(this.model.get("theme_data"),"arrows_view_mode")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{arrows_view_mode:"normal"})},{silent:!0}),s.a.has(this.model.get("theme_data"),"radius")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{radius:0})},{silent:!0}),s.a.has(this.model.attributes,"transition_type")||this.model.set({transition_type:"slider"},{silent:!0}),s.a.has(this.model.attributes,"play_method")&&this.model.get("play_method")||this.model.set({play_method:"click"},{silent:!0}),s.a.has(this.model.get("theme_data"),"crossfade")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{crossfade:2})},{silent:!0}),s.a.has(this.model.get("theme_data"),"scroll_delay")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{scroll_delay:1})},{silent:!0}),s.a.has(this.model.get("theme_data"),"start_offset")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{start_offset:200})},{silent:!0}),s.a.has(this.model.get("theme_data"),"slider_transition")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{slider_transition:.5})},{silent:!0}),s.a.has(this.model.get("theme_data"),"autoplay_delay")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{autoplay_delay:4})},{silent:!0}),s.a.has(this.model.get("theme_data"),"hover_delay")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{hover_delay:.8})},{silent:!0}),s.a.has(this.model.get("theme_data"),"controls_bg")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{controls_bg:!0})},{silent:!0}),s.a.has(this.model.get("theme_data"),"show_on_hover")||this.model.set({theme_data:s.a.extend(this.model.get("theme_data"),{show_on_hover:!1})},{silent:!0}),s.a.has(this.model.attributes,"current_theme")&&this.model.unset("current_theme",{silent:!0}),s.a.has(this.model.attributes,"active_arrows")&&this.model.unset("active_arrows",{silent:!0})},loadRemainingImages:function(t){var e,i;if(e=(t=t||this.$images_wrapper.children().filter((function(){return Object(n.a)(this).attr("data-src")})).toArray()).length<2?t.length:2,t&&t.length)for(i=0;i<=e;i++)this.preloadPictures(t,i,e)},preloadPictures:function(t,e,i){var o=new Image,a=this;t&&t[e]&&t[e].hasAttribute("data-src")&&(o.onload=function(){Object(n.a)(t[e]).css({"background-image":'url("'+Object(n.a)(t[e]).attr("data-src")+'")'}).removeAttr("data-src"),a.indexArr.push(e),a.indexArr.length-1===i&&(t.splice(0,i+1),a.indexArr=[],a.loadRemainingImages(t))},o.src=Object(n.a)(t[e]).attr("data-src"))},applyVisualState:function(t,e){if(t.theme_data){var i={w:e?e.w:t.w,h:e?e.h:t.h,images_h:e?e.images_h:t.images_h,captions_h:e?e.captions_h:t.captions_h,thumbnails_h:this.THUMBNAILS_HEIGHT,counters_h:this.COUNTERS_HEIGHT,left_arrow_noun:t.left_arrow_noun,right_arrow_noun:t.right_arrow_noun,theme:t.current_theme,play_method:t.play_method,current_mode:t.current_mode,thumbnails:t.theme_data.thumbnails,arrows_type:t.theme_data.arrows_type,arrows_position:t.theme_data.arrows_position,arrows_view_mode:t.theme_data.arrows_view_mode,active_arrows:t.active_arrows,captions:t.theme_data.captions,counters:t.theme_data.counters,counters_type:t.theme_data.counters_type,counters_position:t.theme_data.counters_position,controls_bg:t.theme_data.controls_bg,show_on_hover:t.theme_data.show_on_hover,pictures:t.pictures,radius:t.theme_data.radius,transition_type:t.transition_type};i.showThumbnails=i.thumbnails,i.showCounters=i.counters,i.showCaptions=i.captions,i.showFullscreen=t.theme_data.fullscreen,i.showArrows=t.theme_data.arrows,void 0!==i.showArrows?(i.showBtmArrows=i.showArrows&&(i.arrows_position?"bottom"===i.arrows_position:i.active_arrows?"bottom"===i.active_arrows:"theme_classic"===i.theme)&&"normal"===i.arrows_view_mode,i.showMdlArrows=i.showArrows&&(i.arrows_position?"sides"===i.arrows_position:i.active_arrows?"middle"===i.active_arrows:"theme_captions"===i.theme)&&"normal"===i.arrows_view_mode):(i.showBtmArrows="theme_classic"===i.theme,i.showMdlArrows="theme_captions"===i.theme),this.$images.css("height",i.images_h),this.$thumbnails.css({display:i.showThumbnails?"block":"none",height:i.thumbnails_h}),this.$counters.css({display:i.showCounters&&(i.counters_type?"dots"===i.counters_type:"theme_captions"===i.theme)?"block":"none",height:i.counters_h}),this.$captions.css({display:i.showCaptions||"theme_captions"===i.theme?"block":"none",height:i.captions_h}),this.$images.find(".fullscreen").toggle(i.showFullscreen),!i.theme||"theme_captions"!==i.theme||i.active_arrows||i.counters_type&&"dots"!==i.counters_type||this.setDotsPosition("middle"),void 0!==i.arrows_type&&this.$images.toggleClass("noun",i.showArrows&&("library"===i.arrows_type||"noun"===i.arrows_type)),void 0!==i.arrows_view_mode&&this.$images.toggleClass("mouseover",i.showArrows&&"mouseover"===i.arrows_view_mode),void 0!==i.show_on_hover&&(this.$images.toggleClass("show-on-hover",i.show_on_hover),this.$counters.toggleClass("show-on-hover",i.show_on_hover)),void 0!==i.controls_bg&&this.$images.toggleClass("controls-without-bg",!i.controls_bg),void 0!==i.play_method&&this.$images.toggleClass("play-on-hover","hover"===i.play_method),this.$images.toggleClass("viewer","viewer"===this.environment),"mouseover"!==i.arrows_view_mode&&this.$images.css("cursor","default"),this.$bottom_arrows.toggle(i.showBtmArrows),this.$middle_arrows.toggle(i.showMdlArrows),this.$bottom_arrows_container.toggleClass("only-counters","sides"===i.arrows_position||"middle"===i.active_arrows||!1===i.showArrows||"mouseover"===i.arrows_view_mode),this.$images.find(".counters-numbers").toggle(i.showCounters&&(i.counters_type?"numbers"===i.counters_type:"theme_classic"===i.theme)),"dots"===i.counters_type&&this.setDotsPosition(i.counters_position?i.counters_position:i.active_arrows);var o=t.theme_data,a=this.getRGBA(o.controls_color,o.controls_opacity),r=this.getRGBA(o.background_color,o.background_opacity);if(this.colorArrows(o.controls_color,o.controls_opacity),this.$("svg #full-screen").css("fill",a),this.$(".counters-numbers").css("color",a),"dots"===i.counters_type&&"inside"===i.counters_position&&s.a.defer(function(){this.$counters.find(".counter").css({background:a,"border-color":a})}.bind(this)),this.$images.css("background",r),this.$thumbnails.css("background",r),this.setPicsTransitions(),this.setNewPicsWidths(i.w),this.$images_wrapper.toggleClass("crossfade","crossfade"===i.transition_type),this.$images_wrapper.css({"border-radius":i.radius}),this.$images_wrapper.children(".image").each(s.a.bind((function(t,e){var a=Object(n.a)(e);a.css({"background-size":this.setImageSize(o.fill,a.attr("data-width"),a.attr("data-height"),i.w,i.images_h),"border-radius":i.radius})}),this)),!this.initialRender){var l=t.pictures||[];this.handleCounters&&this.$counters_container.css("width",l.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",l.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t,e),this.recalcThumbnails(t,e),this.moveToImage(this.currentImageID,!1,"change-visual-style")}}},onMouseMove:function(t){var e,i=this.$images,o=r.a.getBox(i.get(0)),a=Object(n.a)(t.currentTarget).offset(),s=this.getIconUrl().leftArrUrl,l=this.getIconUrl().rightArrUrl,c=this.isLeftSideOfWidget(t)?s:l,d=this.$el.find(".cursor"),h=this.getFirefoxCorrection();"constructor"===this.environment?Object(n.a)(t.currentTarget).css({cursor:"url('".concat(c,"') 18 18, auto")}):(e=this.isFullscreenMode?1:this.mag.getScale(this.pageViewport),Object(n.a)(t.target).hasClass("image")||Object(n.a)(t.target).hasClass("images-wrapper")||Object(n.a)(t.target).hasClass("bottom-arrows")?(d.show().css({left:t.clientX/e-o.left/h-.5*d.width()/h,top:(Modernizr.safari?t.pageY/e-a.top:t.clientY/e-o.top/h)-.5*d.height()/h,cursor:"none","background-image":"url('".concat(c,"')")}),Object(n.a)(t.currentTarget).css({cursor:"none"})):d.css({"background-image":"none"}))},onMouseOut:function(){this.$el.find(".cursor").hide()},getIconUrl:function(){var t,e,i,n=this.getModelData("theme_data").arrows_type;return"constructor"===this.environment||"viewer"===this.environment&&"default"===n?(t=this.sanitizeSVG(this.$bottom_arrows.find("svg").first()),e=this.sanitizeSVG(this.$bottom_arrows.find("svg").last())):(t=("bottom"===(i=this.params.theme_data.arrows_position)?this.$el.find(".prev-picture-arrow-bottom img"):this.$el.find(".prev-picture-arrow-middle img")).attr("src"),e=("bottom"===i?this.$el.find(".next-picture-arrow-bottom img"):this.$el.find(".next-picture-arrow-middle img")).attr("src")),{leftArrUrl:t,rightArrUrl:e}},sanitizeSVG:function(t){var e=("constructor"===this.environment?this.model.get("theme_data"):this.params.theme_data).arrows_type,i="data:image/svg+xml;charset=utf-8,";return"library"!==e&&"noun"!==e||t.attr({height:"36",width:"36"}),i+=t[0].outerHTML.replace(/#/g,"%23").replace(/(\r\n|\n|\r)/gm,"")},colorArrows:function(t,e){var i=this.getRGBA(t,e);this.$("svg path").css("stroke",i),this.$("svg").css("fill",i)},setDotsPosition:function(t){var e,i;"middle"!==t&&"outside"!==t||(this.$counters.remove(),this.$thumbnails.after(this.$counters),this.$counters.addClass("down-position"),this.$counters.find(".counter").css("background","#fff")),this.$thumbnails.next(".counters-dots").length&&this.$thumbnails.next(".counters-dots").length>0&&("bottom"===t||"inside"===t)&&(this.$counters.remove(),this.$images.find(".counters-numbers").after(this.$counters),this.$counters.removeClass("down-position"),"constructor"===this.environment&&(e=this.model.get("theme_data"),i=this.getRGBA(e.controls_color,e.controls_opacity),this.$counters.find(".counter").css("background",i)))},getRGBA:function(t,e){var i=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?"rgb("+i[0]+","+i[1]+","+i[2]+")":"rgba("+i[0]+","+i[1]+","+i[2]+", "+e+")"},getThumbUrl:function(t){if(!p.a.useLambdaUrl(t))return t.thumbUrl;var e={width:c.a.THUMB_SIZE_SLIDESHOW,height:c.a.THUMB_SIZE_SLIDESHOW,originalW:t.width,originalH:t.height};return"constructor"!==this.environment&&(e.scale=this.mag.getScale(this.pageViewport)),p.a.getThumbnailUrl(t,e)},getOriginalUrl:function(t){return t.rasterUrl||t.url},getModelData:function(t){return"constructor"===this.environment?this.model.get(t):this.params[t]},getScaledUrl:function(t){var e=this.getModelData("theme_data");if(p.a.useLambdaUrl(t)||p.a.useLambdaUrlOldProjects(t,"slideshow")){var i=this.getModelData("images_h"),n=g.a.normalizeAnimations(this.getModelData("animation")).reduce((function(t,e){return Math.max(t,g.a.maxScaleAnimation(e))}),0),o={originalW:t.width,originalH:t.height};return e.fullscreen||(o.height=i,o.scale="constructor"===this.environment?RM.constructorRouter.zoom.getZoom():this.mag.getScale(this.pageViewport),o.animationScale=n&&n/100),p.a.getLambdaUrl(t,o)}return r.a.isOn()||e.fullscreen?t.unscaledOptimizedUrl||t.rasterUrl||t.url:Modernizr.retina?t.scaled2xUrl||t.unscaledOptimizedUrl||t.rasterUrl||t.url:t.scaledUrl||t.unscaledOptimizedUrl||t.rasterUrl||t.url},applyPictures:function(t){if(t.theme_data){var e,i,o=t.pictures||[];this.$el.toggleClass("no-images",!o.length),this.$bottom_arrows_container.toggleClass("no-images",o.length<=1),this.$middle_arrows.toggleClass("no-images",o.length<=1),this.$images.find(".bottom-arrows .counters-text-total").text(o.length),this.$images_wrapper.empty(),this.handleCounters&&this.$counters_container.empty(),this.handleThumbnails&&this.$thumbnails_container.empty(),(o=s.a.sortBy(o,"num")).length>1&&o.length<4&&(i=v(o).map((function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){f(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},t);return e.fakedId=l.default.generateUUID(),e.faked=!0,e})),e=n.a.merge(o,i));for(var a=0;a<(e?e.length:o.length);a++){var r,c=o[a];if(r=Object(n.a)("<div>").addClass("image").attr("data-id",c.fakedId?c.fakedId:c.id).toggleClass("error",!!c.error).css({"background-size":this.setImageSize(t.theme_data.fill,c.width,c.height,t.w,t.images_h)}).appendTo(this.$images_wrapper),c.fakedId&&r.attr("data-original-id",c.id),"constructor"===this.environment&&r.css({"background-image":c.url?'url("'+this.getScaledUrl(c)+'")':"none"}),"viewer"===this.environment&&c.url&&(r.attr("data-src",this.getScaledUrl(c)),c.scaledUrl&&r.data("orig-src",this.getOriginalUrl(c))),c.url&&c.width&&c.height&&r.attr("data-width",c.width).attr("data-height",c.height),this.handleThumbnails&&!c.faked){r=Object(n.a)("<div>").addClass("thumb").attr("data-id",c.id).toggleClass("error",!!c.error).css({left:(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)*a-this.THUMBNAIL_PADDING/2}).appendTo(this.$thumbnails_container);var d=this.getThumbUrl(c);"constructor"===this.environment&&r.css({"background-image":d?'url("'.concat(d,'")'):"none"}),"viewer"===this.environment&&d&&r.attr("data-src",d)}if(this.handleCounters&&!c.faked&&Object(n.a)("<div>").addClass("counter").attr("data-id",c.id).css({left:this.COUNTER_WIDTH*a}).appendTo(this.$counters_container),(this.params.theme_data.captions||"theme_captions"===this.params.current_theme)&&"viewer"===this.environment&&!c.faked){var h=Object(n.a)("<div>").addClass("caption-wrapper").attr("data-id",c.id);Object(n.a)("<div>").addClass("caption").html(l.default.plainTextToHtml(c.text,{detectLinks:!0})).appendTo(h),h.appendTo(this.$captions)}}this.$images_wrapper.children(":first-child").data("first-child",!0),this.$images_wrapper.children(":last-child").data("last-child",!0),this.updateCurrentImageID(t),this.initialRender||(this.handleCounters&&this.$counters_container.css("width",o.length*this.COUNTER_WIDTH),this.handleThumbnails&&this.$thumbnails_container.css("width",o.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING),this.recalcCounters(t),this.recalcThumbnails(t),this.moveToImage(this.currentImageID,!1,"change-pictures")),o.length||this.$images.find(".bottom-arrows .counters-text .counters-text-current").html(0),this.$images_wrapper.children(".image").each(s.a.bind((function(t,e){var i=Object(n.a)(e),o="viewer"===this.environment?this.params.theme_data.radius:this.model.get("theme_data").radius;i.css({"border-radius":o})}),this))}},applyTextStyles:function(t){var e=s.a.omit(t.text_style,"size-leading-linked","size-leading-ratio");/px/i.test(e["font-size"])||(e["font-size"]+="px"),/px/i.test(e["letter-spacing"])||(e["letter-spacing"]+="px"),/px/i.test(e["line-height"])||(e["line-height"]+="px"),/#/i.test(e.color)||(e.color="#"+e.color),e.opacity/=100,this.$captions.find(".caption").css(e)},setNewPicsWidths:function(t){var e,i=this.$el.find("#slideshow-images-position-style-"+this.params._id),o=u.a.isDesktop?"":"translateZ(0)",a=r.a.isAllowed()?r.a.getRatio():1;e=this.isSlider()?'          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.prev-image {\n            -webkit-transform: translateX('+-t+"px)"+o+";\n            transform: translateX("+-t+"px)"+o+';\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n            -webkit-transform: translateX(0) '+o+";\n            transform: translateX(0) "+o+';\n          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.next-image {\n            -webkit-transform: translateX('+t+"px)"+o+";\n            transform: translateX("+t+"px)"+o+';\n          }\n                    .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n            left: 0px;\n            width: '+t+'px;\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.prev-image {\n            -webkit-transform: translateX('+Math.ceil(-t*a)+"px) "+o+";\n            transform: translateX("+Math.ceil(-t*a)+"px) "+o+';\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n            -webkit-transform: translateX(0) '+o+";\n            transform: translateX(0) "+o+';\n          }\n          .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.next-image {\n            -webkit-transform: translateX('+Math.ceil(t*a)+"px) "+o+";\n            transform: translateX("+Math.ceil(t*a)+"px) "+o+";\n        }\n      ":'      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n        left: 0px;\n        width: '+t+'px;\n      }\n      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n        left: 0px;\n        opacity: 0;        width: '+t+'px;\n      }\n      .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image.center-image {\n        opacity: 1;        }\n      .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper {\n        left: 0px;\n        width: '+t+'px;\n      }\n      .edge .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper .image {\n        left: 0px;\n        width: '+t+"px;\n      }\n      ",i.length||(i=Object(n.a)('<style id="slideshow-images-position-style-'+this.params._id+'" type="text/css">')).appendTo(this.$el),i.text(e)},getPlayMethod:function(){return"viewer"===this.environment?this.params.play_method:this.model.get("play_method")},getCrossfadeTransitionTime:function(){return("viewer"===this.environment?this.params.theme_data:this.model.get("theme_data")).crossfade},isSlider:function(){var t;return t="viewer"===this.environment&&this.params.transition_type?"slider"===this.params.transition_type:"constructor"!==this.environment||!this.model.get("transition_type")||"slider"===this.model.get("transition_type"),t},getTransitionsTime:function(){return this.isSlider()?this.getSliderTransitionTime():this.getCrossfadeTransitionTime()},getTransitionsDelay:function(){var t,e;return"viewer"===this.environment?(t=this.params.play_method,e=this.params.theme_data):(t=this.model.get("play_method"),e=this.model.get("theme_data")),1e3*("hover"===t?e.hover_delay:"autoplay"===t||e.autoplay?e.autoplay_delay:0)||this.AUTOPLAY_DELAY},setPicsTransitions:function(t,e){var i,o=this.$el.find("#slideshow-images-transition-style-"+this.params._id),a="cubic-bezier(0.40, 0.24, 0.40, 1)",s=this.isSlider()||"scroll"!==this.getPlayMethod()?"ease-in-out":"ease-out",r="prev"===e?"next":"prev",l=this.isSlider()&&"scroll"===this.getPlayMethod()?0:this.getTransitionsTime();t=t||l,i=this.isSlider()?'          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image {\n            -webkit-transition:\ttransform '+t+"s "+a+";            transition: transform "+t+"s "+a+';          }\n          .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.center-image {\n            -webkit-transition:\ttransform '+(t-.05)+"s "+a+";            transition: transform "+(t-.05)+"s "+a+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+e+"-image {\n            -webkit-transition:\ttransform 0s "+a+";        transition: transform 0s "+a+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.'+r+"-image {\n            -webkit-transition:\ttransform "+t+"s "+a+";        transition: transform "+t+"s "+a+";        }\n        ":'        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image {\n        -webkit-transition:\topacity '+t+"s "+s+";        transition: opacity "+t+"s "+s+';        }\n        .common-slideshow[data-id="'+this.params._id+'"] .images .images-wrapper.enable-transitions .image.center-image {\n        -webkit-transition:\topacity '+t+"s "+s+";        transition: opacity "+t+"s "+s+";        }\n        ",o.length||(o=Object(n.a)('<style id="slideshow-images-transition-style-'+this.params._id+'" type="text/css">')).appendTo(this.$el),o.text(i)},getSliderTransitionTime:function(){if(!RM.screenshot)return("viewer"===this.environment?this.params.theme_data.slider_transition:this.model.get("theme_data").slider_transition)||this.SLIDER_TRANSITION},setImageSize:function(t,e,i,n,o){return e&&i?t?(n/o>e/i?(a=n+2,s=Math.round(a*i/e)):(s=o+2,a=Math.round(s*e/i)),a+"px "+s+"px"):e<n&&i<o?e+"px "+i+"px":(n/o>e/i?(s=o+2,a=Math.round(s*e/i)):(a=n+2,s=Math.round(a*i/e)),a+"px "+s+"px"):t?"cover":"contain";var a,s},onCaptionBlur:function(){if("viewer"!==this.environment&&this.model){var t=this.$captions.find(".caption").val(),e=s.a.clone(this.model.get("pictures")),i=s.a.findWhere(e,{id:this.$captions.find(".caption").attr("data-id")});if(i&&i.text!==t){var n=e.indexOf(i);e[n]=s.a.extend({},i,{text:t}),this.model.save({pictures:e},{toHistory:!0}),this.block.workspace.trigger("redraw")}}},recalcCounters:function(t,e){if("dots"===t.theme_data.counters_type||"theme_captions"===t.current_theme){var i=t.pictures||[],n=e?e.w:t.w,o=this.COUNTER_WIDTH*i.length,a=Math.floor(n/this.COUNTER_WIDTH)*this.COUNTER_WIDTH,s=this.$bottom_arrows_container.hasClass("only-counters")&&i.length>2?this.COUNTERS_ADDITIONAL_SPACE:0,r=Math.min(o,a)+s,l=(t.theme_data.counters_position?"outside"===t.theme_data.counters_position:t.active_arrows?"middle"===t.active_arrows:"theme_captions"===t.current_theme)?Math.floor((n-r)/2):0;this.$counters_scroll_wrapper.css({left:l,width:r}),this.$counters_container.css({width:o})}},recalcThumbnails:function(t,e){if(t.theme_data.thumbnails){var i=t.pictures||[],n=e?e.w:t.w,o=i.length*(this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING)-this.THUMBNAIL_PADDING,a=Math.min(o,n-this.THUMBNAILS_PADDING),s=Math.floor((n-a)/2);this.thumbsWidth=a,this.$thumbnails_scroll_wrapper.css({left:s,width:a}),this.$thumbnails_container.css({width:o})}},onImageClick:function(t){var e;this.isNormalArrowsMode()||this.block&&!this.block.selected||(t&&t.stopPropagation(),"hover"===this.getPlayMethod()&&(e="switch-to-image-autoplay"),this.isLeftSideOfWidget(t)?this.prevImage(t,e):this.nextImage(t,e))},isLeftSideOfWidget:function(t){var e=this.$images,i=this.isFullscreenMode||"constructor"===this.environment?1:this.mag.getScale(this.pageViewport),o=this.getFirefoxCorrection(),a=r.a.getBox(e.get(0));return t.clientX/i<(a.left+(this.isFullscreenMode?Object(n.a)(window).width():a.width)/2)/o},isNormalArrowsMode:function(){return"constructor"===this.environment&&this.model.get("theme_data")&&"normal"===this.model.get("theme_data").arrows_view_mode},getFirefoxCorrection:function(){return Modernizr.firefox&&r.a.isOn()&&!this.isFullscreenMode?this.mag.getScale(this.pageViewport):1},prevImage:function(t,e){this.imagePrevNext(t,"prev",e||"switch-to-image")},checkNeedUpdateTransition:function(t,e){var i,n=this.getTransitionsTime(),o=this.$images_wrapper.children(":first").css("transition-duration")?parseFloat(this.$images_wrapper.children(":first").css("transition-duration")):n;t&&t.timeStamp?((i=(t.timeStamp-this.lastClick)/1e3)<n?this.setPicsTransitions(i.toFixed(1),e):o<n&&this.setPicsTransitions(n,e),this.lastClick=t.timeStamp):this.setPicsTransitions(n,e),this.slidesDirection!==e&&(this.setPicsTransitions(n,e),this.slidesDirection=e)},nextImage:function(t,e){this.imagePrevNext(t,"next",e||"switch-to-image")},imagePrevNext:function(t,e,i){if(this.currentImageID){var o="next"==e?this.currentPic.$el.next():this.currentPic.$el.prev();o.length||(o=this.$images_wrapper.children(":"+("next"==e?"first":"last"))),this.checkNeedUpdateTransition(t,e),this.$images_wrapper.children(".changed-opacity").each(s.a.bind((function(t,e){var i=Object(n.a)(e);i.css({opacity:""}),i.removeClass("changed-opacity")}),this)),this.moveToImage(o.attr("data-id"),!0,i),t&&t.stopPropagation()}},changeSlideonHover:function(t){var e=this.isLeftSideOfWidget(t)?"prev":"next";this.slidesDirection!==e&&this.stopAutoplay(),this.startAutoplay(e),this.slidesDirection=e},onMouseEnter:function(t){this.onImageClick(t),this.changeSlideonHover(t)},thumbnailClick:function(t){this.moveToImage(Object(n.a)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},counterClick:function(t){this.moveToImage(Object(n.a)(t.currentTarget).attr("data-id"),!1,"switch-to-image"),t.stopPropagation()},moveToImage:function(t,e,i){var o=this;if(t){var a=this.$images_wrapper.children(".image"),r=a.filter('[data-id="'+t+'"]'),l=r.attr("data-original-id"),c=a.index(r),d=s.a.clone(this.currentPic),h=c,u=this,p="viewer"===this.environment?this.params.pictures.length:this.model.get("pictures").length,g=this.getTransitionsDelay(),m=1e3*this.getTransitionsTime();t=l||t,r.length&&-1!==c&&(this.currentImageID=t,this.currentPic.$el=r,this.currentPic.num=c,"switch-to-image"===i&&"viewer"===this.environment&&(this.params.theme_data.autoplay&&void 0===this.params.play_method||"autoplay"===this.params.play_method||"hover"===this.params.play_method)&&(this.stopAutoplay(),setTimeout((function(){return o.startAutoplay()}),g)),this.$images_wrapper.toggleClass("enable-transitions",e),this.resetWaitForAnimationEnd(),e&&d.$el&&this.waitForAnimationEnd(d.$el,f),this.direction=!d.$el||!d.$el.length||d.num<h?"forward":"backward",r.data("first-child")&&d.$el&&d.$el.length&&d.$el.data("last-child")?this.direction="forward":r.data("last-child")&&d.$el&&d.$el.length&&d.$el.data("first-child")&&(this.direction="backward"),a.each((function(t){var e=Object(n.a)(this),i=a.length-1;1!==a.length?t+1===h||0===h&&t===i?u.setPicPosition(e,"prev",!0):t-1===h||h===i&&0===t?u.setPicPosition(e,"next",!0):t===h?u.setPicPosition(e,"center",t===h):u.setPicPosition(e,"",!1):u.setPicPosition(e,"center",t===h)})),p>1&&p<4&&(c=c>=p?c-p:c),u.$images.find(".counters-text-current").html(c+1),!e&&f())}function f(){if(e||u.initialRender||window.requestAnimationFrame((function(){u.$images_wrapper.addClass("enable-transitions")})),u.trigger("currentImageChanged",t,e,i),u.handleCounters&&!u.initialRender){var n=u.$counters_container.children('[data-id="'+t+'"]');u.$counters_container.children(".active").removeClass("active"),n.addClass("active");var o=n.get(0).offsetLeft,a=u.$counters.find(".items-wrapper").width(),r=void 0;o+2*u.COUNTER_WIDTH-u.$counters.find(".items-wrapper").scrollLeft()>a?r=o+2*u.COUNTER_WIDTH-a:o-u.COUNTER_WIDTH-u.$counters.find(".items-wrapper").scrollLeft()<0&&(r=o-u.COUNTER_WIDTH),null!=r&&(e?u.$counters.find(".items-wrapper").stop().animate({scrollLeft:r},m):u.$counters.find(".items-wrapper").scrollLeft(r))}if(u.handleThumbnails&&!u.initialRender){var l=u.$thumbnails_container.children('[data-id="'+t+'"]');u.$thumbnails_container.children(".active").removeClass("active"),l.addClass("active");o=l.position().left,a=u.$thumbnails.find(".items-wrapper").width(),r=void 0;o+2*(u.THUMBNAIL_WIDTH+u.THUMBNAIL_PADDING)-u.THUMBNAIL_PADDING/2-u.$thumbnails.find(".items-wrapper").scrollLeft()>a?r=o+2*(u.THUMBNAIL_WIDTH+u.THUMBNAIL_PADDING)-u.THUMBNAIL_PADDING/2-a:a>2*(u.THUMBNAIL_WIDTH+u.THUMBNAIL_PADDING)&&o-u.THUMBNAIL_WIDTH-u.THUMBNAIL_PADDING/2-u.$thumbnails.find(".items-wrapper").scrollLeft()<0&&(r=o-u.THUMBNAIL_WIDTH-u.THUMBNAIL_PADDING/2)}if(null!=r&&(e?u.$thumbnails.find(".items-wrapper").stop().animate({scrollLeft:r},m):u.$thumbnails.find(".items-wrapper").scrollLeft(r)),u.model&&"constructor"===u.environment){var c=u.model.get("pictures"),d=s.a.findWhere(c,{id:u.currentImageID});d?u.$captions.find(".caption").val(d.text).attr("data-id",u.currentImageID):u.$captions.find(".caption").val("").attr("data-id","")}else!u.params.theme_data.captions&&"theme_captions"!==u.params.current_theme||"viewer"!==u.environment||(e?u.$captions.find('.caption-wrapper[data-id="'+u.currentImageID+'"]').stop().fadeIn(200).siblings().stop().fadeOut(200):(u.$captions.find(".caption-wrapper").stop().css({display:"none"}),u.$captions.find('.caption-wrapper[data-id="'+u.currentImageID+'"]').stop().css({display:"block"})));u.preloadImages(),u.preloadThumbImages()}},waitForAnimationEnd:function(t,e){this.resetWaitHook=l.default.waitForTransitionEnd(t,this.getTransitionsTime(),"transform",e)},resetWaitForAnimationEnd:function(){this.resetWaitHook&&this.resetWaitHook()},setPicPosition:function(t,e,i){Object(n.a)(t).removeClass("center-image prev-image next-image neighbour hidden").addClass((e?e+"-image ":"hidden")+(i?"neighbour":"")),Object(n.a)(t).data("last-position",e),Object(n.a)(t).data("last-neighbour",i)},preloadImages:function(){if("viewer"===this.environment){var t=this.$images_wrapper.children('[data-id="'+this.currentImageID+'"]');if(t.length){var e=t.prev();e.length||(e=this.$images_wrapper.children(":last"));var i=t.next();i.length||(i=this.$images_wrapper.children(":first"));var n=this;o(t),RM.screenshot||(o(e),o(i))}}function o(t){if(n.isFullscreenMode){if(t.data("orig-src")){var e=new Image;e.onload=function(){t.css({"background-image":'url("'+e.src+'")'}).removeData("orig-src")},e.src=t.data("orig-src")}n.$images_wrapper.find(".image").css("border-radius",0)}t.attr("data-src")&&(n.preloadImagesList.push({url:t.attr("data-src")}),t.css({"background-image":'url("'+t.attr("data-src")+'")'}).removeAttr("data-src"))}},preloadThumbImages:function(){if("viewer"===this.environment&&this.params.theme_data.thumbnails){var t=this.initialRender?this.thumbsWidth:this.$thumbnails_scroll_wrapper.width(),e=this.initialRender?0:this.$thumbnails.find(".items-wrapper").scrollLeft();this.$thumbnails.find(".items-wrapper .thumb").each(s.a.bind((function(i,o){var a=Object(n.a)(o);if(a.attr("data-src")){var s=i*this.THUMBNAIL_WIDTH-this.THUMBNAIL_PADDING/2,r=this.THUMBNAIL_WIDTH+this.THUMBNAIL_PADDING;s-e>t+r||s+r-e<0-r||(this.preloadImagesList.push({url:a.attr("data-src")}),a.css({"background-image":'url("'+a.attr("data-src")+'")'}).removeAttr("data-src"))}}),this))}},updateCurrentImageID:function(t){if(t.pictures&&t.pictures.length)if(this.currentImageID){var e=s.a.findWhere(t.pictures,{id:this.currentImageID});this.currentImageID=e?e.id:this.getFirstPictureID(t)}else this.currentImageID=this.getFirstPictureID(t);else this.currentImageID=void 0},getFirstPictureID:function(t){return s.a.sortBy(t.pictures,"num")[0].id},toggleFullscreen:function(t){"constructor"!=this.environment&&(this.isFullscreenMode?this.leaveFullscreen():this.enterFullscreen(),t.stopPropagation())},enterFullscreen:function(){"constructor"!=this.environment&&(this.isFullscreenMode||(this.isFullscreenMode=!0,this.$parentBeforeFullscreen=this.$el.parent(),Object(n.a)(".constructor .widgetbar").addClass("hidden"),this.$el.addClass("fullscreen-mode"),this.$el.appendTo("body").css("z-index",999),Object(n.a)(window).on("resize",this.onFullscreenResize),Object(n.a)("body").on("keyup",this.onFullscreenKeyUp),s.a.defer((function(){RM.common.disableShortcuts.slideshow=!0})),this.onFullscreenResize(),l.default.getFocusBack(),this.preloadImages()))},onFullscreenKeyUp:function(t){t.keyCode==n.a.keycodes.left&&this.prevImage(),t.keyCode==n.a.keycodes.right&&this.nextImage(),t.keyCode==n.a.keycodes.esc&&this.leaveFullscreen()},onFullscreenResize:function(){var t=this.$el.width(),e=this.$el.height(),i=this.params.theme_data.counters&&(("middle"===this.params.active_arrows||"outside"===this.params.theme_data.counters_position)&&"dots"===this.params.theme_data.counters_type||"theme_captions"===this.params.current_theme),n=e-(this.params.theme_data.thumbnails?this.THUMBNAILS_HEIGHT:0)-(this.params.theme_data.captions||"theme_captions"===this.params.current_theme?this.params.captions_h:0)-(i?this.COUNTERS_HEIGHT:0);this.applyVisualState(this.params,{w:t,h:e,images_h:n,captions_h:this.params.captions_h})},leaveFullscreen:function(){"constructor"!=this.environment&&this.isFullscreenMode&&(this.isFullscreenMode=!1,this.$el.appendTo(this.$parentBeforeFullscreen).css("z-index","auto"),Object(n.a)(window).off("resize",this.onFullscreenResize),this.$el.removeClass("fullscreen-mode"),Object(n.a)(".constructor .widgetbar").removeClass("hidden"),Object(n.a)("body").off("keyup",this.onFullscreenKeyUp),s.a.defer((function(){delete RM.common.disableShortcuts.slideshow})),this.applyVisualState(this.params),this.setNewPicsWidths(this.params.w))},startAutoplay:function(t){var e;this.autoPlayInterval||(e=1e3*(t?this.params.theme_data.hover_delay:this.params.theme_data.autoplay_delay||this.AUTOPLAY_DELAY),this.autoPlayInterval=setInterval(s.a.bind((function(){this.imagePrevNext(null,t||"next","switch-to-image-autoplay")}),this),e))},stopAutoplay:function(){clearInterval(this.autoPlayInterval),this.autoPlayInterval=null},destroy:function(){this.isDestroyed=!0,this.stopAutoplay(),this.leaveFullscreen(),this.resetWaitForAnimationEnd(),this.$el&&this.$el.remove()},setSwipeAction:function(){u.a.isDesktop||(this.picsSwipe=this.$images_wrapper.RMSwipe({$scrollElements:this.mag.$mag_container,maxTransitionSpeed:1e3*this.getTransitionsTime(),rubberBandForce:1/1.47,getCurrentConstraints:function(t){var e={},i=this.isFullscreenMode?this.$images_wrapper.width():this.params.w;return e.$moveItems=this.currentPic.$el.add(this.currentPic.$el.prev()).add(this.currentPic.$el.next()),e.$referenceItem=e.$moveItems.filter(":not(.center-image)").first(),this.currentPic.$el.is(":last-child")?e.left={max:0,noTrigger:!0}:e.left={max:i},this.currentPic.$el.is(":first-child")?e.right={max:0,noTrigger:!0}:e.right={max:i},e}.bind(this),onSwipeStart:function(){var t,e,i=this,n=this.getTransitionsDelay();"viewer"===this.environment?(t=this.params.play_method,e=this.params.theme_data.autoplay&&void 0===t):(t=this.model.get("play_method"),e=this.model.get("theme_data").autoplay),("autoplay"===t||e)&&(this.stopAutoplay(),setTimeout((function(){return i.startAutoplay()}),n)),this.$images_wrapper.removeClass("enable-transitions")}.bind(this),customMoveCheck:function(t,e){return!(t.hasClass("prev-image")&&e<0)&&!(t.hasClass("next-image")&&e>0)}.bind(this),callback:function(t){var e;"right"===t&&(e=this.currentPic.$el.prev()),"left"===t&&(e=this.currentPic.$el.next()),e.length||(e=this.currentPic.$el),this.moveToImage(e.attr("data-id"),!1,"switch-to-image")}.bind(this)}).data("swipe"))}});e.a=_},tf3M:function(t,e,i){"use strict";i.r(e),i.d(e,"WidgetsCollection",(function(){return g}));var n=i("q1z7"),o=i.n(n),a=i("rFsW"),s=i("v92f"),r=i("rVpV"),l=i("Fi5S"),c=i("jeLO"),d=i("sviH"),h=i("roQd");i("Kf/z");function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var p=c.a.extend({idAttribute:"_id",urlRoot:"/api/widget/",defaults:{x:Math.round(272),y:157,w:480,h:360},name:"Widget",widgets_with_inner_widgets:["hotspot"],nonUndoKeys:["animation"],viewport_required_fields:["x","y","w","h"],onlyRootFields:["_id","modelType"].concat(s.b.viewport_list),initialize:function(t,e){if(e=e||{},this.Block=d.a[t.type],this.Block){this.hasNested=a.a.contains(this.widgets_with_inner_widgets,t.type),this.isNested=!!t.parent_wid;var i=RM.constructorRouter&&!RM.constructorRouter.previewMode;this.hasNested&&i&&this.init_inner_widgets_models(t,e),this.on("change:is_global",this.onGlobalChange)}},init_inner_widgets_models:function(t,e){var i,n;n=(i=a.a.clone(t)).widgets||i.wids||[],n=this.sanitizeWidgets(n),this.widgets_collection=new g(n,{parent_widget:this,parse:e.parse,page:this.collection.page}),i.wids=a.a.pluck(n,"_id"),this.set(i,{silent:!0}),this.on("change:wids",this.onWidsChange)},parse:function(t,e){if(!this.collection||!this.collection.page)return t;this.Block||(this.Block=d.a[t.type]);var i=this.isNested?"default":this.collection.page.getCurrentViewport();return a.a.isEmpty(t)||(a.a.each(s.b.viewport_list,(function(e){this[e]=t[e],"default"!==e&&t[e]&&("button"===t.type||"text"===t.type&&3===t.version)&&a.a.each(s.b.viewport_fields[t.type]||s.b.viewport_fields_common,function(i){this[e][i]=a.a.has(t[e],i)?t[e][i]:t[i]}.bind(this)),this[e]=a.a.omit(this[e],this.onlyRootFields),delete t[e],delete this.attributes[e]}),this),this.storeViewport("default",t),a.a.extend(t,a.a.defaults(this["viewport_"+i],this.viewport_fields_defaults))),e&&e.xhr&&(e.xhr.skipResponse=!0),a.a.has(t,"w")&&!a.a.isNumber(t.w)&&(t.w=this.defaults.w),a.a.has(t,"h")&&!a.a.isNumber(t.h)&&(t.h=this.defaults.h),c.a.prototype.parse.apply(this,arguments)},set:function(t,e,i){var n;if("object"===u(t)?(n=t,i=e):(n={})[t]=e,!this.isGlobal()||!this.collection||!this.collection.page||i&&i.noSaveUnique)return c.a.prototype.set.apply(this,arguments);var o=r.a.fillUniqueAttributeSets(n,this.attributes,this.collection.page.id);return a.a.isEmpty(o)||a.a.extend(n,o),c.a.prototype.set.apply(this,[n,i])},get:function(t){var e=c.a.prototype.get.apply(this,arguments);if(!this.attributes.is_global||this.attributes.is_above&&"z"===t||!a.a.contains(r.a.GLOBAL_UNIQUE_KEYS,t)||!this.collection||!this.collection.page)return e;var i=r.a.getUniqueValue(t,this.attributes,this.collection.page.id);return void 0===i?e:i},validate:function(t){if(!t.type)return"missing widget type"},triggerReady:function(){l.a.trigger("ready:model",this)},toJSON:function(t){if(!this.collection||!this.collection.page)return this.attributes;var e=this.collection.page.getCurrentViewport(),i=a.a.clone(this.attributes);return"default"===e||this.isNew()||this.isNested||(i["viewport_"+e]=a.a.pick(i,this.viewport_fields),i["viewport_"+e]=a.a.omit(i["viewport_"+e],this.onlyRootFields),a.a.extend(i,this.viewport_fields_defaults,this.viewport_default)),a.a.each(s.b.viewport_list,(function(t){a.a.isEmpty(this[t])||i[t]||(i[t]=this[t])}),this),i},initViewport:function(t){var e=this.collection.page.getCurrentViewport(),i=this.attributes;this["viewport_"+e]=a.a.extend(a.a.pick(i,this.Block.prototype.viewport_fields),this.Block.getViewportDefaults(this,e,t))},getViewport:function(){return this.isNested?"default":this.collection&&this.collection.page&&this.collection.page.getCurrentViewport()},changeViewport:function(t){t=t||{};var e=this.collection.page.getPreviousViewport();this.storeViewport(e),this.restoreViewport()},storeViewport:function(t,e){t=t||this.collection.page.getCurrentViewport(),e=e||this.attributes,this["viewport_"+t]=a.a.pick(e,this.viewport_fields)},restoreViewport:function(t){if(t=t||this.collection.page.getCurrentViewport(),a.a.isEmpty(this["viewport_"+t]))"default"!==t&&this.restoreViewport("default"),this.storeViewport(t),this.set(this.Block.getViewportDefaults(this,t)),this.save({},{silent:!0,skipHistory:!0});else{var e=a.a.defaults({},this["viewport_"+t],this.viewport_fields_defaults);this.get("is_global")&&(this.get("is_above")&&delete e._z,r.a.fillUniqueValues(e,this.collection.page.id)),this.set(e,{first:!0,viewportChange:!0,noSaveUnique:!0})}"default"!==t&&this.validateViewport(t)},validateViewport:function(t){if(!a.a.all(this.viewport_required_fields,(function(t){var e=this.get(t);return null!=e&&!isNaN(e)&&""!==e}),this)){var e=this.viewport_default;this.set(a.a.pick(e,this.viewport_required_fields)),this.save({},{silent:!0,first:!0})}},fillMissingFieldsFromDefaultViewport:function(t){var e={};a.a.each(t,function(t){var i=this.viewport_default&&this.viewport_default[t];void 0===this.get(t)&&i&&(e[t]=a.a.cloneWithObjects(i))}.bind(this)),a.a.isEmpty(e)||this.set(e,{silent:!0})},splitChangesToViewport:function(t,e){if(!e||"default"===e)return t;var i=this.viewport_fields,n=a.a.pick(t,i);return a.a.each(i,(function(i){t["viewport_"+e]&&t["viewport_"+e][i]&&delete n[i]})),a.a.isEmpty(n)||(t["viewport_"+e]=a.a.extend({},t["viewport_"+e],n),t=a.a.omit(t,i)),t},getPageId:function(){return this.collection&&this.collection.getPageId()},addWidget:function(t,e){if(e=e||{},t&&t.type)if(d.a[t.type]){t.parent_wid=this.get("_id"),t.pid=this.get("pid");var i=this.widgets_collection.add(t,e);i.created=!e.copy&&!e.clone,i.id?i.fetch({success:this.getAddCallback(e),error:e.error}):i.save({},{success:this.getAddCallback(e),error:e.error})}else console.error("Adding unknown widget into another widget.");else console.error("Adding widget with no type into another widget.")},onAddWidget:function(t,e){if(!t.get("type"))return!1;var i;(i=a.a.clone(this.get("wids"))).push(t.id),i=Object(a.a)(i).chain().uniq().compact().value(),this.set({wids:i},e)},getAddCallback:function(t){t=t||{};var e=this;return function(i){e.onAddWidget(i,t),t.success&&t.success(i)}},onWidsChange:function(t,e,i){if((e=this.get("wids"))&&a.a.isObject(e[0])){var n=a.a.clone(e);n=this.sanitizeWidgets(n),this.widgets_collection.set(n,{parent_widget:this,page:this.collection.page}),e=a.a.pluck(e,"_id"),this.set("wids",e,{silent:!0})}var o=this.get("wids"),s=t.previous("wids")||[];if(o){var r=a.a.difference(o,s),l=a.a.difference(s,o);a.a.each(r,function(e){var n=t.widgets_collection.get(e);n&&this.trigger("widget:create",n,i)}.bind(this)),a.a.each(l,function(e){var n=t.widgets_collection.get(e);n&&this.trigger("widget:remove",n,i)}.bind(this))}},sanitizeWidgets:function(t){return a.a.filter(t,(function(t){return!!d.a[t.type]}))},isGlobal:function(){return!!this.get("is_global")},onGlobalChange:function(){this.get("is_global")?(Object(a.a)(s.b.viewport_listall).each(function(t){a.a.isEmpty(this[t])||("viewport_"+this.getViewport()===t&&r.a.ensurePageDefRecord(this.attributes),r.a.ensurePageDefRecord(this[t]))}.bind(this)),this.triggerGlobalAppear()):this.triggerGlobalDisappear()},triggerGlobalAppear:function(){l.a.trigger("global_appear:widget",this)},triggerGlobalDisappear:function(){l.a.trigger("global_disappear:widget",this)},getAnimations:function(){return h.a.normalizeAnimations(this.get("animation"))}},{viewports:s.b.viewport_list});Object.defineProperty(p.prototype,"viewport_fields",{get:function(){return this.Block.prototype.viewport_and_unique_fields||(this.Block.prototype.viewport_and_unique_fields=a.a.union(this.Block.prototype.viewport_fields,r.a.GLOBAL_UNIQUE_KEYS.map((function(t){return r.a.GLOBAL_UNIQUE_KEY_PREFIX+t})))),this.Block.prototype.viewport_and_unique_fields}}),Object.defineProperty(p.prototype,"viewport_fields_defaults",{get:function(){return this.Block.prototype.viewport_fields_defaults||(this.Block.prototype.viewport_fields_defaults={},a.a.each(this.viewport_fields,(function(t){this.Block.prototype.viewport_fields_defaults[t]=void 0}),this)),this.Block.prototype.viewport_fields_defaults}});var g=o.a.Collection.extend({model:p,initialize:function(t,e){e&&e.page&&(this.page=e.page),this.on("remove",(function(t){this.page&&this.page.trigger("widget:remove",t,{})}),this)},getPageId:function(){return this.page.id}});e.default=p},tzyo:function(module,exports){module.exports={"template-constructor-control-form_endpoints":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n   <div class="icon noarrow" data-alt="Send Data" data-alt-pos="left" data-alt-offset="9"></div>\n\n   <div class="panel">\n   \t<div class="panel-caption">\n   \t\t<span>Send Data</span>\n   \t\t<div class="inline-help">\n   \t\t\t<div class="help-body-wrapper">\n   \t\t\t\t<div class="help-body">\n   \t\t\t\t\t<span class="help-text">Manage data storage.<br/><a href="http://help.readymag.com/hc/en-us/articles/360020793111-Form" target="_blank">Learn more</a></span>\n   \t\t\t\t\t<div class="help-popup-corner">\n   \t\t\t\t\t\t<div class="corner"></div>\n   \t\t\t\t\t</div>\n   \t\t\t\t</div>\n   \t\t\t\t<div class="hover-spacer"></div>\n   \t\t\t</div>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="panel-section email collapsed">\n   \t\t<div class="switcher-wrapper">\n   \t\t\t<div class="switcher-caption">1st email</div>\n   \t\t\t<div class="switcher email" data-provider="email"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="current-email overflow-fade">NO-VAL</div>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="separator email"></div>\n\n   \t<div class="panel-section second_email collapsed">\n\n   \t\t<div class="switcher-wrapper">\n   \t\t\t<div class="switcher-caption">2nd email</div>\n   \t\t\t<div class="switcher second_email" data-provider="second_email"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<p class="confirmation hidden">\n   \t\t\t\tCheck<span class="confirmation email-for-confirmation">NO-VAL</span>for confirmation\n   \t\t\t</p>\n   \t\t\t<div class="input-wrapper second_email">\n   \t\t\t\t<input type="email" class="reach-input input-second-email" placeholder="Add email" data-provider="second_email" spellcheck="false">\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t\t<p class="confirmation resend hidden">Resend confirmation</p>\n   \t\t\t<p class="confirmation cancel hidden">Cancel request</p>\n   \t\t\t<div class="error-block hidden">\n   \t\t\t\t<p class="error red">\n   \t\t\t\t\tEmail address <br/>\n   \t\t\t\t\t<span class="error email-for-confirmation">NO-VAL</span>seems not active.\n   \t\t\t\t</p>\n   \t\t\t\t<p class="error try-another">Try another address</p>\n   \t\t\t</div>\n   \t\t\t<p class="new-email hidden overflow-fade">NO-VAL</p>\n   \t\t\t<div class="choice-email hidden">\n   \t\t\t\t<label class="custom-select">\n   \t\t\t\t\t<select class="overflow-fade">\n\n   \t\t\t\t\t</select>\n   \t\t\t\t</label>\n   \t\t\t</div>\n   \t\t\t<p class="change-email hidden">Change email</p>\n   \t\t\t<p class="back hidden">Back</p>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="separator second_email"></div>\n\n   \t<div class="panel-section google collapsed">\n   \t\t<div class="switcher-wrapper disconnected">\n   \t\t\t<div class="switcher-caption">Google</div>\n   \t\t\t<div class="switcher google" data-provider="google"></div>\n   \t\t\t<div class="connect-button" data-provider="google"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="input-wrapper sheet-name">\n   \t\t\t\t<input type="text" class="reach-input input-sheet-name" placeholder="Create Sheet" data-provider="google">\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="separator google"></div>\n\n   \t<div class="panel-section mailchimp collapsed">\n   \t\t<div class="switcher-wrapper disconnected">\n   \t\t\t<div class="switcher-caption">MailChimp</div>\n   \t\t\t<div class="switcher mailchimp" data-provider="mailchimp"></div>\n   \t\t\t<div class="connect-button" data-provider="mailchimp"></div>\n   \t\t\t<div class="switcher-overlay">\n   \t\t\t\t<div class="help-body-wrapper">\n   \t\t\t\t\t<div class="help-body">\n   \t\t\t\t\t\t<span class="help-text">You should have an Email field<br>to send data to Mailchimp<br><a href="http://help.readymag.com/hc/en-us/articles/360020793111-Form" target="_blank">Learn more</a></span>\n   \t\t\t\t\t\t<div class="help-popup-corner">\n   \t\t\t\t\t\t\t<div class="corner"></div>\n   \t\t\t\t\t\t</div>\n   \t\t\t\t\t</div>\n   \t\t\t\t\t<div class="hover-spacer"></div>\n   \t\t\t\t</div>\n   \t\t\t</div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="input-wrapper list-name">\n   \t\t\t\t<input type="text" class="input-list-name" placeholder="Select List" disabled>\n   \t\t\t\t<select name="list-select" class="list-select"></select>\n   \t\t\t\t<div class="list-triangle"></div>\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="separator mailchimp"></div>\n\n   \t<div class="panel-section url collapsed">\n   \t\t<div class="switcher-wrapper">\n   \t\t\t<div class="switcher-caption">URL</div>\n   \t\t\t<div class="switcher url" data-provider="url"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="input-wrapper url">\n   \t\t\t\t<input type="text" class="reach-input input-custom-url" placeholder="Enter URL" data-provider="url">\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t</div>\n   </div>\n\n  ',options&&options.flagFormsAddFile&&(__p+='\n\n  <div class="separator file-data"></div>\n\n   \t<div class="panel-caption">\n   \t\t<span>File Data</span>\n   \t\t<div class="inline-help">\n   \t\t\t<div class="help-body-wrapper">\n   \t\t\t\t<div class="help-body">\n   \t\t\t\t\t<span class="help-text">Manage file storage.<br/><a href="http://help.readymag.com/hc/en-us/articles/360020793111-Form" target="_blank">Learn more</a></span>\n   \t\t\t\t\t<div class="help-popup-corner">\n   \t\t\t\t\t\t<div class="corner"></div>\n   \t\t\t\t\t</div>\n   \t\t\t\t</div>\n   \t\t\t\t<div class="hover-spacer"></div>\n   \t\t\t</div>\n   \t\t</div>\n  \t</div>\n\n  \t<div class="separator google-drive"></div>\n\n   \t<div class="panel-section google collapsed">\n   \t\t<div class="switcher-wrapper disconnected">\n   \t\t\t<div class="switcher-caption">Google Drive</div>\n   \t\t\t<div class="switcher google" data-provider="google"></div>\n   \t\t\t<div class="connect-button" data-provider="google"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="input-wrapper sheet-name">\n   \t\t\t\t<input type="text" class="reach-input input-sheet-name" placeholder="Create Sheet" data-provider="google">\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t</div>\n   \t</div>\n\n   \t<div class="separator dropbox"></div>\n\n   \t<div class="panel-section google collapsed">\n   \t\t<div class="switcher-wrapper disconnected">\n   \t\t\t<div class="switcher-caption">Dropbox</div>\n   \t\t\t<div class="switcher google" data-provider="google"></div>\n   \t\t\t<div class="connect-button" data-provider="google"></div>\n   \t\t</div>\n\n   \t\t<div class="collapsable">\n   \t\t\t<div class="input-wrapper sheet-name">\n   \t\t\t\t<input type="text" class="reach-input input-sheet-name" placeholder="Create Sheet" data-provider="google">\n   \t\t\t\t<div class="action-icon hidden"></div>\n   \t\t\t</div>\n   \t\t</div>\n   </div>\n\n  '),__p+="\n\n   </div>\n";return __p},"template-constructor-control-form_endpoints-list-selector":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n  <option value="none" disabled selected hidden></option>\n  ',_.each(lists,(function(t){__p+='\n  \t<option value="'+(null==(__t=t.id)?"":__t)+'" '+(null==(__t=t.id==selected?"selected":"")?"":__t)+">"+(null==(__t=t.name)?"":__t)+"</option>\n  "})),__p+="\n";return __p}}},"u/SR":function(module,exports){module.exports={"template-constructor-control-shape_color":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Color" data-alt-pos="left" data-alt-offset="9"><div class="opacity-grid"></div><div class="color-circle"></div></div>\n\n\t<div class="panel">\n\t</div>\n\n';return __p}}},u1Rx:function(module,exports){module.exports={"template-constructor-helpers-colorbox":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="rmcolorbox '+(null==(__t=show_opacity?"":"without-opacity")?"":__t)+'" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t<div class="rmcolorbox-color">\n\t\t\t<div class="rmcolorbox-map" style="left:'+(null==(__t=hue_width)?"":__t)+"px;width:"+(null==(__t=map_width)?"":__t)+"px;height:"+(null==(__t=map_height)?"":__t)+'px;">\n\t\t\t\t<canvas width="'+(null==(__t=map_width)?"":__t)+'" height="'+(null==(__t=map_height)?"":__t)+'"></canvas>\n\t\t\t\t<div class="rmcolorbox-map-handle"></div>\n\t\t\t</div>\n\t\t\t',"vertical"!=type&&(__p+='\n\t\t\t<div class="rmcolorbox-map-under-arrow" style="width:'+(null==(__t=hue_width)?"":__t)+"px;height:"+(null==(__t=map_height)?"":__t)+'px;">\n\t\t\t\t<canvas width="'+(null==(__t=hue_width)?"":__t)+'" height="'+(null==(__t=map_height)?"":__t)+'"></canvas>\n\t\t\t</div>\n\t\t\t'),__p+="\n\n\t\t\t","vertical"!=type&&(__p+='\n\t\t\t<div class="rmcolorbox-hue" style="height:'+(null==(__t=height)?"":__t)+"px;width:"+(null==(__t=hue_width||width)?"":__t)+'px;">\n\t\t\t\t<canvas class="rmcolorbox-hue-canvas1" width="'+(null==(__t=hue_width_opened-3)?"":__t)+'" height="'+(null==(__t=height)?"":__t)+'" style="height:'+(null==(__t=height)?"":__t)+"px;width:"+(null==(__t=hue_width-3)?"":__t)+'px;"></canvas>\n\t\t\t\t<canvas class="rmcolorbox-hue-canvas2" width="3" height="'+(null==(__t=height)?"":__t)+'"></canvas>\n\t\t\t</div>\n\t\t\t'),__p+='\n\n\t\t\t<div class="rmcolorbox-opacity">\n\t\t\t\t<div class="rmcolorbox-opacity-handle"><div class="rmcolorbox-opacity-val">&nbsp;</div></div>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="rmcolorbox-swatches hidden" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t\t<div class="rmcolorbox-swatches-placeholdes-wrapper" style="width:'+(null==(__t=placeholdes_width)?"":__t)+"px;height:"+(null==(__t=placeholdes_height)?"":__t)+'px;">\n\t\t\t\t<div class="rmcolorbox-swatches-placeholdes" style="width:'+(null==(__t=placeholdes_width)?"":__t)+'px;"></div>\n\t\t\t\t<div class="rmcolorbox-swatches-colors" style="width:'+(null==(__t=placeholdes_width)?"":__t)+'px;"></div>\n\t\t\t\t<div class="rmcolorbox-swatches-scroll-handle"></div>\n\t\t\t</div>\n\t\t</div>\n\n\n\t\t<div class="rmcolorbox-rgb-block-wrapper">\n\t\t\t<div class="rmcolorbox-rgb-block input-style-1">\n\t\t\t\t',"vertical"!=type&&(__p+=" <span>#</span> "),__p+=' <input class="rmcolorbox-rgb-block-input color-input input-style-1"  spellcheck="false" maxlength="6" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\t\t',"vertical"!=type&&(__p+='\n\t\t<div class="rmcolorbox-r-g-b-block-wrapper">\n\t\t\t<div class="rmcolorbox-r-g-b-block input-style-2">\n\t\t\t\t<span>R</span><input class="rmcolorbox-r-block-input color-input input-style-2"  spellcheck="false" data-param="r" maxlength="3" type="text"/><span>G</span><input class="rmcolorbox-g-block-input color-input input-style-2"  spellcheck="false" data-param="g" maxlength="3" type="text"/><span>B</span><input class="rmcolorbox-b-block-input color-input input-style-2"  spellcheck="false" data-param="b" maxlength="3" type="text"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t'),__p+="\n\n\t\t","vertical"==type&&(__p+='\n\t\t<div class="rmcolorbox-hue" style="height:'+(null==(__t=hue_height)?"":__t)+'px; width: 100%;">\n\t\t\t<canvas class="rmcolorbox-hue-canvas1" width="'+(null==(__t=width)?"":__t)+'" height="'+(null==(__t=hue_height)?"":__t)+'" style="height:'+(null==(__t=hue_height)?"":__t)+'px;width:100%;"></canvas>\n\t\t\t<img src="https://d1id5eheivyv24.cloudfront.net/a93b11b1/dist/img/constructor/helpers/colorbox/selector.svg" class="hue-line"/>\n\t\t</div>\n\t\t'),__p+='\n\n\t\t<div class="rmcolorbox-color-input-blocker hidden" style="height:'+(null==(__t=bottom_panel_height)?"":__t)+'px;"></div>\n\t\t<div class="rmcolorbox-swatches-button" title="Swatches"></div>\n\t\t<div class="rmcolorbox-add-to-swatches-button" title="Add Color to Swatches"></div>\n\t\t<div class="rmcolorbox-remove-from-swatches-button hidden" title="Remove from Swatches"></div>\n\t\t<div class="rmcolorbox-animation-box hidden" style="width:'+(null==(__t=width)?"":__t)+"px;height:"+(null==(__t=height)?"":__t)+'px;">\n\t\t\t<canvas width="'+(null==(__t=width)?"":__t)+'" height="'+(null==(__t=height)?"":__t)+'"></canvas>\n\t\t</div>\n\t </div>\n\n';return __p}}},uGDn:function(t,e,i){"use strict";var n=i("xeF9"),o={model:{event:"stateChange"},props:{value:{},isDisabled:{type:Boolean,default:!1},width:{type:Number,default:37},height:{type:Number,default:20},shadow:{default:"none"},colorOn:{default:"#0074FF"},colorOff:{default:"rgba(26, 26, 26, 0.4)"},textOn:{default:""},textOff:{default:""},textSizeOn:{default:12},textSizeOff:{default:12},textColorOn:{default:"#fff"},textColorOff:{default:"#fff"},handleColor:{default:"#fff"},handleShadow:{default:"none"},handleSpace:{default:1},callback:{type:Function,default:function(){}}},data:function(){return{internalState:!1,bodyColorStyle:null,panelPosStyle:null,panelBackOpacity:null}},computed:{handleSize:function(){return this.height-2*this.handleSpace},bodyStyle:function(){return{width:this.width+"px",height:this.height+"px","box-shadow":this.shadow,"border-radius":Math.floor(this.height/2)+"px",opacity:this.isDisabled?.5:1,cursor:this.isDisabled?"default":"pointer"}},fullWidth:function(){return 2*(this.width-this.handleSize-this.handleSpace)+this.handleSize},textWidth:function(){return Math.round(.75*this.width-8-8)},shiftWidth:function(){return this.width-this.fullWidth},panelStyle:function(){return{width:this.fullWidth+"px",height:this.height+"px"}},textStyle:function(){return{width:this.textWidth+"px","line-height":this.height+"px"}},textOffStyle:function(){return{"font-size":this.textSizeOn+"px",color:this.textColorOn}},textOnStyle:function(){return{"font-size":this.textSizeOff+"px",color:this.textColorOff}},handleStyle:function(){return{"margin-left":"-"+Math.floor(this.handleSize/2)+"px",width:this.handleSize+"px",height:this.handleSize+"px","border-radius":Math.floor(this.handleSize/2)+"px","box-shadow":this.handleShadow,background:this.handleColor,top:this.handleSpace+"px"}}},watch:{internalState:function(t){clearInterval(this.timer),this.timer=setInterval(function(){this.oneStepSwitcherPos(t)}.bind(this),20),this.$emit("stateChange",t)},value:function(t){this.internalState=t}},created:function(){this.internalState=this.value},mounted:function(){this.updateSwitcher()},methods:{setSwitcherPos:function(t){this.cur_state=t,this.bodyColorStyle={"background-color":this.colorTransform(this.colorOn,this.colorOff,t)},this.panelPosStyle={left:Math.round(this.shiftWidth*t)+"px"},this.panelBackOpacityStyle={opacity:(1-t).toFixed(2)}},updateSwitcher:function(){this.setSwitcherPos(this.internalState?0:void 0===this.internalState?.5:1)},colorTransform:function(t,e,i){var o=Object(n.parseCSSColor)(t),a=Object(n.parseCSSColor)(e);return"rgba(".concat(Math.max(Math.min(parseInt(i*(a[0]-o[0])+o[0],10),255),0),",").concat(Math.max(Math.min(parseInt(i*(a[1]-o[1])+o[1],10),255),0),",").concat(Math.max(Math.min(parseInt(i*(a[2]-o[2])+o[2],10),255),0),",").concat(Math.max(Math.min(parseFloat(i*(a[3]-o[3])+o[3],10),1),0),")")},oneStepSwitcherPos:function(t){if(void 0===t)return clearInterval(this.timer),this.setSwitcherPos(.5);var e=t?0:1,i=e<this.internalState?-1:1,n=Math.max(Math.min(this.cur_state+.1*i,1),0);(i>0&&n>=e||i<0&&n<=e)&&(n=e,clearInterval(this.timer)),this.setSwitcherPos(n)},clickHanlder:function(){if(this.isDisabled)return!1;this.internalState=!this.internalState,this.callback(this.internalState)},disableFromOutside:function(){this.isDisabled=!0}}},a=(i("LSan"),i("KHd+")),s=Object(a.a)(o,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rm-switcher",attrs:{"data-state":t.internalState?"on":"off"}},[i("div",{staticClass:"rmswitcher-body",style:[t.bodyStyle,t.bodyColorStyle]},[i("div",{ref:"panelBack",staticClass:"rmswitcher-panel-back"}),t._v(" "),i("div",{staticClass:"rmswitcher-panel",style:[t.panelStyle,t.panelPosStyle],on:{click:t.clickHanlder}},[i("div",{staticClass:"rmswitcher-panel-on",style:[t.textStyle,t.textOnStyle]},[t._v(t._s(t.textOff))]),t._v(" "),i("div",{staticClass:"rmswitcher-panel-off",style:[t.textStyle,t.textOffStyle]},[t._v(t._s(t.textOn))]),t._v(" "),i("div",{staticClass:"rmswitcher-panel-slider",style:t.handleStyle})])])])}),[],!1,null,null,null);e.a=s.exports},uU7u:function(t,e,i){"use strict";i.d(e,"e",(function(){return g})),i.d(e,"a",(function(){return p})),i.d(e,"b",(function(){return m})),i.d(e,"d",(function(){return f})),i.d(e,"c",(function(){return v})),i.d(e,"g",(function(){return b})),i.d(e,"f",(function(){return _}));var n=i("q1tI"),o=i.n(n),a=i("v83y"),s=i("DwEc"),r=i("8AXF"),l=i("8Tds");function c(t,e){if(null==t)return{};var i,n,o=function(t,e){if(null==t)return{};var i,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||(o[i]=t[i]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)i=a[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(o[i]=t[i])}return o}function d(){return(d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function h(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var p,g="LINK";!function(t){t.URL="URL",t.Page="Page",t.Email="Email",t.Phone="Phone",t.Anchor="Anchor",t.ScrollToTop="ScrollToTop",t.GoBack="GoBack"}(p||(p={}));var m={name:"default-link-style",label:"Default link style",style:{link:{textColor:"0080FF64",color:"0080FF64",type:l.a.Solid,size:1,padding:0},hover:{textColor:"0080FF64",color:"0080FF64",type:l.a.None,size:1,padding:0},current:{textColor:"0080FF64",color:"0080FF64",type:l.a.None,size:1,padding:0}}},f={strategy:function(t,e,i){t.findEntityRanges((function(t){var e=t.getEntity();return null!==e&&i.getEntity(e).getType()===g}),e)},component:function(t){var e=Object(n.useContext)(r.BackboneContext).model,i=Object(n.useContext)(s.b).model,a=(window.RM.viewerRouter||window.RM.constructorRouter.preview||{}).mag,l=t.contentState.getEntity(t.entityKey).getData(),c=l.url,u=l.target,g=void 0===u?"_self":u,f=l.type,v=l.linkStyle,b=l.anchorPosition,_=l.pageId,y=function(t){return[v||m.name].concat(h("string"==typeof t?[t]:t)).join(" ")},w=function(){if(window.RM.constructorRouter)return[];var t=[];return i.currentPage._id===_&&(t.push("back-to-top"),e.is_global&&t.push("current")),t};return o.a.createElement("a",d({},function(){switch(f){case p.URL:return{href:(t=c,/^http(s?):\/\//i.test(t)?t:"http://".concat(t)),target:g,rel:"noopener noreferrer",className:y("external-link")};case p.Email:return{href:"mailto:".concat(c),className:y("external-link")};case p.Phone:return{href:"tel:".concat(c),className:y("external-link")};case p.Anchor:return{href:"javascript:void(0)",className:y("anchor-link"),"data-anchor-link-pos":b,"data-page-uri":a&&_?a.getPageNum(_):""};case p.ScrollToTop:return{href:"javascript:void(0)",className:y(["maglink","back-to-top"])};case p.GoBack:return{href:"javascript:void(0)",className:y("goback-link")};case p.Page:return{href:a&&_?_?"/".concat(a.getPageUri(_)):"javascript:void(0)":"",target:g,className:y(["maglink"].concat(h(w())))};default:return{}}var t}(),{style:{pointerEvents:a?void 0:"none"}}),t.children)}},v=function(t){if(!t.getSelection().isCollapsed()){var e=t.getCurrentContent(),i=t.getSelection().getStartKey(),n=t.getSelection().getStartOffset(),o=e.getBlockForKey(i).getEntityAt(n);if(o)return e.getEntity(o).getData()||{}}return null},b=function(t){var e=t.editorState,i=c(t,["editorState"]),n=e.getCurrentContent().createEntity(g,"MUTABLE",i),o=n.getLastCreatedEntityKey(),s=a.EditorState.set(e,{currentContent:n});return a.RichUtils.toggleLink(s,s.getSelection(),o)},_=function(t){var e=t.getSelection();return e.isCollapsed()?t:a.RichUtils.toggleLink(t,e,null)}},udqo:function(t,e,i){"use strict";var n=i("q1z7"),o=i.n(n),a=i("xi34"),s=i("rFsW"),r=i("OTSC"),l=i("gobI"),c=i("LaNJ"),d=i.n(c),h=o.a.View.extend({initialize:function(t){s.a.bindAll(this),s.a.extend(this,t)},render:function(){if(this.picture){this.removing=!1,Object(a.a)("body").addClass("picture-preview-loading"),this.originalRect=this.getRect(this.$el[0]),this.orientation=this.getOrientation(),this.originalStyle=this.getOriginalStyle();var t=d.a["template-picture-preview-box"];return this.$preview=Object(a.a)(t({overlayColor:this.overlayColor,previewSrc:this.getPreviewSrc(),originalStyle:this.originalStyle})),this.$container.append(this.$preview),Object(a.a)(window).on("scroll",this.onScroll),Object(a.a)("body").on("keypress keyup keydown",this.onKeyPress),setTimeout(this.setVisible,100),this.$preview}},imagePreload:function(){var t=this;if(!this.removing&&this.picture){var e=this.picture.unscaledOptimizedUrl||this.picture.unscaledUrl||this.picture.final3xUrl||this.picture.final2xUrl||this.picture.finalUrl;this.getPreviewSrc()!==e?(this.img=new Image,this.img.onload=function(){Object(a.a)("body").removeClass("picture-preview-loading"),t.$preview&&setTimeout((function(){t.removing||t.$preview.find(".picture-preview-box .picture-preview-box-image").attr("src",t.img.src).removeAttr("srcset")}),100)},this.img.src=e):Object(a.a)("body").removeClass("picture-preview-loading")}},remove:function(t){var e=this;if(this.removing=!0,Object(a.a)("body").removeClass("picture-preview-loading"),Object(a.a)("body").off("keypress keyup keydown",this.onKeyPress),Object(a.a)(window).off("scroll",this.onScroll),this.img&&(this.img.src="",delete this.img),this.$preview){var i=this.$preview.find(".picture-preview-box");i.removeClass("visible loaded").removeClass(this.orientation),r.default.waitForTransitionEnd(i.find(".picture-preview-box-overlay"),300,"opacity",(function(){e.$preview&&e.$preview.remove(),delete e.$preview})),t&&t()}},changeColor:function(t){this.$preview&&this.$preview.find(".picture-preview-box-overlay").css("background-color",t)},onScroll:function(){this.remove()},setVisible:function(){var t=this;if(!this.removing){var e=this.$preview.find(".picture-preview-box img")[0],i=function i(){e.removeEventListener("load",i),t.$preview.find(".picture-preview-box").addClass("visible").addClass(t.orientation),r.default.waitForTransitionEnd(t.$preview.find(".picture-preview-box .picture-preview-box-overlay"),300,"opacity",t.imagePreload)};setTimeout((function(){e.complete?i():e.addEventListener("load",i)}),100)}},getPreviewSrc:function(){var t=this.$el.find("img")[0];return t&&(t.currentSrc||t.src)||this.picture&&(this.picture.unscaledOptimizedUrl||this.picture.final3xUrl||this.picture.final2xUrl||this.picture.finalUrl)},getOriginalStyle:function(){if(!this.originalRect)return{};var t=this.getScale(),e={top:Number(this.originalRect.top+.5*this.originalRect.height)*t+"px",left:Number(this.originalRect.left+.5*this.originalRect.width)*t+"px"};return"portrait"===this.orientation?e.height=this.originalRect.height*t+"px":"landscape"===this.orientation&&(e.width=this.originalRect.width*t+"px"),e},getOrientation:function(){var t=this.originalRect.height/this.originalRect.width,e=Object(a.a)(window).width();return Object(a.a)(window).height()/t<e?"portrait":"landscape"},bindClick:function(){var t=this;this.$preview&&this.$preview.on("click",(function(){t.remove()}))},onKeyPress:function(t){27===t.keyCode&&this.remove()},getScale:function(){return l.a.isAllowed()&&l.a.isZoom()&&l.a.isOn()?l.a.getRatio():1},getRect:function(t){var e=s.a.extend({},t.getBoundingClientRect());if(Modernizr.safari){var i=this.getScale();e.top=e.top+(Object(a.a)(window).scrollTop()-Object(a.a)(window).scrollTop()/i)}return e}});e.a=h},uxFs:function(t,e,i){"use strict";var n,o=i("vOnD"),a=i("q1tI"),s=i.n(a),r=i("saLn"),l=i("8AXF"),c=i("v83y"),d=i("iC7s"),h=i("Jzj8"),u=i("UGKl"),p=i("9Juw"),g=i("8Tds"),m=i("a68n"),f=i("IrH7"),v=i("ePHO"),b=i("DwEc"),_=i("i0ke"),y=i("vvfI"),w=i("38uW"),k=i("A9VP"),S=i("OTSC"),x=function(t){var e=t.editorState,i=t.method,n=Object(k.d)(e,k.b.LetterSpacing),o=n&&n.length?parseFloat(n[0]):0,a="decrease"===i?-1:1;return Object(k.c)({key:k.b.LetterSpacing,value:S.default.decimals(o+.2*a,2),editorState:e})},C=i("w5C2"),O=function(t){var e=t.editorState,i=t.method,n=Object(k.d)(e,k.b.FontSize),o=n&&n.length?parseInt(n[0]):C.b.fontSize,a="decrease"===i?-1:1;return Object(k.c)({key:k.b.FontSize,value:o+a,editorState:e})};!function(t){t.InsertNbsp="InsertNbsp",t.InsertThinsp="InsertThinsp",t.InsertEnsp="InsertEnsp",t.IncreaseIndent="IncreaseIndent",t.DecreaseIndent="DecreaseIndent",t.DecreaseLineHeight="DecreaseLineHeight",t.IncreaseLineHeight="IncreaseLineHeight",t.DecreaseLetterSpacing="DecreaseLetterSpacing",t.IncreaseLetterSpacing="IncreaseLetterSpacing",t.ToggleTypographyPanel="ToggleTypographyPanel",t.ToggleLinkPanel="ToggleLinkPanel",t.IncreaseFontSize="IncreaseFontSize",t.DecreaseFontSize="DecreaseFontSize",t.AlignLeft="AlignLeft",t.AlignRight="AlignRight",t.AlignCenter="AlignCenter",t.SelectParagraph="SelectParagraph",t.ToggleBold="ToggleBold",t.ToggleUnderline="ToggleUnderline",t.ToggleItalic="ToggleItalic"}(n||(n={}));var P=function(t){return 32!==t.keyCode||!t.altKey||t.shiftKey||t.ctrlKey||t.metaKey?32===t.keyCode&&t.altKey&&(t.ctrlKey||t.metaKey)&&!t.shiftKey?n.InsertNbsp:32===t.keyCode&&t.altKey&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.InsertThinsp:32===t.keyCode&&t.altKey&&t.shiftKey&&!t.ctrlKey&&!t.metaKey?n.InsertEnsp:"Tab"!==t.key||t.shiftKey?"Tab"===t.key&&t.shiftKey?n.DecreaseIndent:"ArrowUp"===t.key&&t.altKey?n.DecreaseLineHeight:"ArrowDown"===t.key&&t.altKey?n.IncreaseLineHeight:"ArrowLeft"===t.key&&t.altKey?n.DecreaseLetterSpacing:"ArrowRight"===t.key&&t.altKey?n.IncreaseLetterSpacing:84===t.keyCode&&t.altKey&&(t.ctrlKey||t.metaKey)?n.ToggleTypographyPanel:75===t.keyCode&&(t.ctrlKey||t.metaKey)?n.ToggleLinkPanel:190===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.IncreaseFontSize:188===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.DecreaseFontSize:76===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.AlignLeft:82===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.AlignRight:67===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.AlignCenter:65===t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?n.SelectParagraph:66===t.keyCode&&(t.ctrlKey||t.metaKey)?n.ToggleBold:73===t.keyCode&&(t.ctrlKey||t.metaKey)?n.ToggleItalic:85===t.keyCode&&(t.ctrlKey||t.metaKey)?n.ToggleUnderline:Object(c.getDefaultKeyBinding)(t):n.IncreaseIndent:n.InsertNbsp},j=i("JW7n");function $(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function T(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?$(Object(i),!0).forEach((function(e){I(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):$(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],n=!0,o=!1,a=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return M(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return M(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}i.d(e,"a",(function(){return R}));var R=s.a.createContext({}),A=function(){var t=Object(a.useContext)(l.BackboneContext),e=t.model,i=t.modelSet,o=t.modelSave,S=Object(a.useContext)(b.a).model,j=S.isEditMode,$=S.newStyles,T=S.isResizing,I=S.resizingDimensions,M=S.workspace,R=Object(a.useContext)(v.a).isPaddingsEnabled,A=E(Object(a.useMemo)((function(){return Object(h.a)(e._id,e&&e.blocks&&Object(c.convertFromRaw)(Object(p.o)(e)))}),[])(),2),D=A[0],z=A[1],L=function(){o()},B=E(Object(r.a)(L,400),1)[0],F=E(Object(r.a)((function(t){var e=Object(c.convertToRaw)(t.getCurrentContent());i(Object(p.e)(e)),L()}),400),1)[0];Object(a.useEffect)((function(){F(D)}),[D]),Object(a.useEffect)((function(){if($){var t=Object(c.convertFromRaw)(Object(p.o)(e)),i=c.EditorState.createWithContent(t,_.a);z(i)}}),[$]);var N=Object(a.useMemo)((function(){return D.getSelection().getHasFocus()}),[D]),U=Object(a.useMemo)((function(){return j&&!N}),[j,N]),H=Object(a.useMemo)((function(){return j}),[j,N]),V=Object(a.useRef)(null),W=Object(d.Vb)(V).height;return Object(a.useEffect)((function(){e.columns&&e.columns.count>1||e.overflow!==g.b.Visible||(i(T&&I?{h:W,width:I.width}:{h:W}),B())}),[W,e.overflow,e.columns]),Object(a.useEffect)((function(){j||D.getSelection().isCollapsed()||z(Object(p.a)(D))}),[j]),s.a.createElement(u.a,{ref:V,isEditMode:j,bgColor:e.bgColor,textDirection:e.textDirection||g.c.LTR,overflow:e.overflow,columns:e.columns,height:e.h,width:e.w,shouldShowHighlight:U,shouldShowSelectionBorder:H,editorState:D,blockStyleFn:function(t){return[t.getType(),Object(m.b)({block:t}),Object(f.c)({block:t})].join(" ")},onChange:function(t){z(c.EditorState.forceSelection(t,Object(p.s)(t.getSelection())))},onBlur:L,readOnly:R,keyBindingFn:P,handleKeyCommand:function(t){var e=function(t){var e=t.action,i=t.editorState,o=t.workspace;if(e===n.InsertNbsp)return{status:"handled",editorState:Object(p.p)(i,String.fromCharCode(160))};if(e===n.InsertEnsp)return{status:"handled",editorState:Object(p.p)(i,String.fromCharCode(8194))};if(e===n.InsertThinsp)return{status:"handled",editorState:Object(p.p)(i,String.fromCharCode(8201))};if(e===n.IncreaseIndent){var a=Object(y.b)({editorState:i,method:"increase"});if(a)return{status:"handled",editorState:a}}if("backspace"===e||e===n.DecreaseIndent){var s=Object(y.b)({editorState:i,method:"decrease"});if(s)return{status:"handled",editorState:s}}if(e===n.DecreaseLineHeight){var r=Object(w.b)({editorState:i,method:"decrease"});if(r)return{status:"handled",editorState:r}}if(e===n.IncreaseLineHeight){var l=Object(w.b)({editorState:i,method:"increase"});if(l)return{status:"handled",editorState:l}}if(e===n.IncreaseLetterSpacing)return{status:"handled",editorState:x({editorState:i,method:"increase"})};if(e===n.DecreaseLetterSpacing)return{status:"handled",editorState:x({editorState:i,method:"decrease"})};if(e===n.ToggleTypographyPanel){var c=o.controls.findControl("text_typography_new");return c&&c.onClick.apply(c),{status:"handled",editorState:i}}if(e===n.ToggleLinkPanel){var d=o.controls.findControl("text_link_new");return d&&d.onClick.apply(d),{status:"handled",editorState:i}}if(e===n.IncreaseFontSize)return{status:"handled",editorState:O({editorState:i,method:"increase"})};if(e===n.DecreaseFontSize)return{status:"handled",editorState:O({editorState:i,method:"decrease"})};if(e===n.AlignLeft||e===n.AlignRight||e===n.AlignCenter){var h=e===n.AlignLeft?f.a.AlignLeft:e===n.AlignRight?f.a.AlignRight:f.a.AlignCenter;return{status:"handled",editorState:Object(f.d)({editorState:i,align:h})}}if(e===n.SelectParagraph)return{status:"handled",editorState:Object(p.t)(i)};if(e===n.ToggleBold){var u=Object(k.d)(i,k.b.FontWeight);return{status:"handled",editorState:Object(k.c)({editorState:i,key:k.b.FontWeight,value:u&&"700"===u[0]?C.b.fontWeight:"700"})}}if(e===n.ToggleItalic){var g=Object(k.d)(i,k.b.FontStyle);return{status:"handled",editorState:Object(k.c)({editorState:i,key:k.b.FontStyle,value:g&&"italic"===g[0]?C.b.fontStyle:"italic"})}}if(e===n.ToggleUnderline){var m=Object(k.d)(i,k.b.Decoration);return{status:"handled",editorState:Object(k.c)({editorState:i,key:k.b.Decoration,value:m&&"underline"===m[0]?"none":"underline"})}}return{status:"not-handled",editorState:i}}({action:t,editorState:D,workspace:M}),i=e.editorState,o=e.status;return z(i),o}})},D=Object(o.e)(d.m).withConfig({displayName:"TextConstructor___StyledBox"})(["user-select:none;"]),z=Object(o.e)(d.m).withConfig({displayName:"TextConstructor___StyledBox2"})(["user-select:none;"]),L=Object(o.e)(d.m).withConfig({displayName:"TextConstructor___StyledBox3"})(["user-select:none;"]),B=Object(o.e)(d.m).withConfig({displayName:"TextConstructor___StyledBox4"})(["user-select:none;"]),F=function(t){var e=t.size,i=t.height,n=t.width,o=t.onClick;return(s.a.createElement(s.a.Fragment,null,s.a.createElement(D,{position:"absolute",top:0,left:0,width:n+2*e,height:e,onClick:o}),s.a.createElement(z,{position:"absolute",bottom:0,left:0,width:n+2*e,height:e,onClick:o}),s.a.createElement(L,{position:"absolute",top:0,left:0,width:e,height:i+2*e,onClick:o}),s.a.createElement(B,{position:"absolute",top:0,right:0,width:e,height:i+2*e,onClick:o})))},N=Object(o.e)(d.m).withConfig({displayName:"TextConstructor___StyledBox5"})(["width:calc(var(--workspace-inverse-zoom) * 100%);height:calc(var(--workspace-inverse-zoom) * 100%);zoom:var(--workspace-inverse-zoom);transform:scale(var(--workspace-zoom));transform-origin:left top;"]);e.b=function(){var t=Object(a.useContext)(b.a).model,e=t.fontStyles,i=t.isResizing,n=t.leaveEditMode,o=t.isEditMode,r=Object(a.useContext)(l.BackboneContext).model,c=r.overflow,h=r.w,u=r.h,p=r.columns,m=E(Object(a.useState)(!1),2),f=m[0],_=m[1];Object(a.useEffect)((function(){(f||i)&&S.default.getFocusBack()}),[f,i]);var y=Object(a.useRef)(null),w=c===g.b.Visible&&(!p||p&&p.count<=1),k=w?500:0,x=w?{position:"absolute",top:-1*k,left:-1*k,width:"calc(100% + ".concat(2*k,"px)"),height:"calc(100% + ".concat(2*k,"px)")}:{};return s.a.createElement(R.Provider,{value:{ref:y}},s.a.createElement(v.a.Provider,{value:{isPaddingsEnabled:f,setIsPaddingsEnabled:_}},s.a.createElement(N,{height:"100%",width:"100%",position:"relative"},s.a.createElement(d.qb,{ref:y,style:T({pointerEvents:!o||f||i?"none":void 0},x),head:s.a.createElement(s.a.Fragment,null,s.a.createElement("style",null,"\n                  body {\n                    margin: 0;\n                    height: 100vh;\n                    width: 100vw;\n                    overflow: hidden;\n                    box-sizing: border-box;\n                    padding: ".concat(k,"px;\n                  }\n\n                  .frame-root, .frame-content {\n                    height: 100%;\n                    width: 100%;\n                  }\n                ")),e.map((function(t,e){return"style"===t.tag?s.a.createElement("style",{key:e},"".concat(t.style)):"link"===t.tag?s.a.createElement("link",{key:e,rel:"stylesheet",type:t.type,href:t.href}):void 0})))},s.a.createElement(j.a,{mode:"constructor"}),w&&o&&s.a.createElement(F,{size:k,height:u,width:h,onClick:function(){n()}}),s.a.createElement(A,null)))))}},v92f:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n,o,a=i("rFsW"),s=i("tZHv"),r=i("Kf/z");function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}!function(t){t.Default="default",t.TabletPortrait="tablet_portrait",t.PhonePortrait="phone_portrait"}(o||(o={}));var c=[{name:o.Default,width:1024,min_height:400,max_height:201600,caption:"Laptop & Tablet Landscape",shortcut:"1"},{name:o.TabletPortrait,width:768,min_height:926,max_height:201600,caption:"Tablet Portrait",shortcut:"2",deprecated:!0},{name:o.PhonePortrait,width:320,min_height:568,max_height:201600,caption:"Phone Portrait",shortcut:"3"}],d=["x","y","w","h","z","hidden","angle","flip_h","flip_v","pack_id","fixed_position","is_full_width","is_full_height","sticked","sticked_margin","animation","triggers"],h=(l(n={background:a.a.union(["color","opacity","selectedType","picture","slideshow"],d),picture:a.a.union(["picture","cropW","cropH","cropX","cropY","originalW","originalH","ratio","scale","pic_opacity","pic_color","border_size","border_color","border_radius","border_radius_max","border_radius_tl","border_radius_tr","border_radius_bl","border_radius_br","border_radius_independent","opacity","anchor_link_pos","preview_overlay_color"],d),slideshow:a.a.union(["images_h","captions_h","play_method"],d),text:Object(r.a)("constructor.textv3")?a.a.union(["styles","verticalAlign","bgColor","columns","blocks","entityMap"],d):a.a.union(["column_count","column_gap","bg_color","bg_opacity"],d),shape:a.a.union(["rasterUrl","raster2xUrl","borders","weight","anchor_link_pos","bg_color"],d),button:a.a.union(["text_w","text_h","em_w","anchor_link_pos","font-size","font-style","font-weight","font-family","color","color-opacity","letter-spacing","hover-color","hover-color-opacity","current-font-size","current-font-style","current-font-weight","current-font-family","current-color","current-color-opacity","current-letter-spacing","background-color","background-color-opacity","hover-background-color","hover-background-color-opacity","current-background-color","current-background-color-opacity","border-radius","border-width","border-color","border-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","current-border-radius","current-border-width","current-border-color","current-border-color-opacity"],d),hotspot:a.a.union(["borders","weight","anchor_link_pos"],d),form:a.a.union(["layout","style","style-colored-button-default","style-colored-button-hover","style-colored-fields","style-outlined-button-default","style-outlined-button-hover","style-outlined-fields","style-underlined-button-default","style-underlined-button-hover","style-underlined-fields"],d)},s.a.ecommerceCartBlockName,a.a.union(["text_w","text_h","em_w","background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","color","color-opacity","font-size","letter-spacing","hover-background-color","hover-background-color-opacity","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","hover-border-radius","hover-tansition-duration"],d)),l(n,s.a.addToCartBlockName,a.a.union(["layout","btn_w","btn_h","text_w","text_h","select_btn_margin","attributes_margin","background-color","background-color-opacity","border-radius","border-width","border-color","border-color-opacity","font-family","font-style","font-weight","font-size","color","color-opacity","letter-spacing","text-align","hover-tansition-duration","hover-background-color","hover-background-color-opacity","hover-border-radius","hover-border-width","hover-border-color","hover-border-color-opacity","hover-color","hover-color-opacity","attrs-background-color","attrs-background-color-opacity","attrs-border-radius","attrs-border-width","attrs-border-color","attrs-border-color-opacity","attrs-font-family","attrs-font-style","attrs-font-weight","attrs-font-size","attrs-color","attrs-color-opacity","attrs-letter-spacing","attrs-text-align","attrs-hover-background-color","attrs-hover-background-color-opacity","attrs-hover-border-radius","attrs-hover-border-width","attrs-hover-border-color","attrs-hover-border-color-opacity","attrs-hover-color","attrs-hover-color-opacity","attrs-icon-h","attrs-icon-w","attrs-text_w","attrs-text_h"],d)),l(n,"shots",a.a.union(["playbackType","scrollSpeed","scrollStartPoint","startPointOffset","scrollDelay","hoverDirection"],d)),n),u=a.a.map(c,(function(t){return"viewport_"+t.name})),p=a.a.without(u,"viewport_default");e.b={viewports:c,viewport_fields_common:d,viewport_fields:h,viewport_listall:u,viewport_list:p,widgetViewportFields:function(t){return h[t]||d}}},vIxw:function(t,e,i){"use strict";var n=i("rFsW"),o=i("OTSC"),a=i("WoDZ"),s={model:{event:"change:url",prop:"url"},props:{url:String,highlightOnError:Boolean,showSocial:!0,isVideoProcessed:!1,placeholder:{type:String,default:"Type or paste URL"}},data:function(){return{isError:!1}},computed:{searchUrl:{get:function(){return this.url},set:function(t){this.$emit("change:url",t)}},showIcon:function(){return Boolean(this.url)},isRemove:function(){return this.isVideoProcessed||this.isError},isUpload:function(){return this.isURL(this.url)&&!this.isVideoProcessed},highlightInput:function(){return this.highlightOnError&&this.isError}},methods:{onIconClick:function(t){this.isRemove?(this.$emit("change:url",null),this.$emit("remove")):this.processInputVideo()},onEnter:function(){this.processInputVideo()},processInputVideo:function(){this.url&&(this.isURL(this.url)?this.getVideoFromUrl(this.url):RM.views.searchYouTube&&RM.views.searchYouTube.show(this.url,{choose:this.uploadVideoFromSearch}))},parseStartTime:function(t){var e,i,a=0;return(e=o.default.queryUrlGetParam("t",t))?(i=e.match(/(\d+)(m?)(\d*)(s?)/),n.a.isEmpty(i)||!parseInt(i[1],10)?null:("m"===i[2].toLowerCase()?a+=60*parseInt(i[1],10):a+=parseInt(i[1],10),parseInt(i[3],10)&&(a+=parseInt(i[3],10)),a)):null},getVideoFromUrl:function(t){var e,i,o,s=t;if(i=a.a.isVimeo(s),!(e=a.a.isYoutube(s))&&!i)return this.$emit("wrongUrl"),this.isError=!0,void(this.highlightremovalTimeout=setTimeout(function(){this.isError=!1}.bind(this),200));o=this.parseStartTime(s);var r={url:s=s.replace(/\/?#?$/,""),provider_name:a.a.getVideoProvider(s)};o&&(r.start_time=o),e&&(r.video_id=a.a.getYoutubeIdFromUrl(s)),this.videoEmbedXHR&&this.videoEmbedXHR.abort(),this.videoEmbedXHR=a.a.getEmbedData(s,n.a.bind((function(t){this.url=t.url?t.url:this.url,a.a.getHighResVideoThumbnail({provider:r.provider_name,thumbnail_url:t.thumbnail_url}).then(n.a.bind((function(e){t.thumbnail_url=e,this.$emit("loaded",n.a.extend(t,r))}),this))}),this),n.a.bind((function(t,e,i){this.$emit("error",t,e,i)}),this)),this.$emit("dataObtained",r)},isURL:function(t){return/^http(s?):\/\//i.test(t)},onYoutubeClick:function(){RM.views.searchYouTube&&RM.views.searchYouTube.show("",{choose:this.uploadVideoFromSearch})},onVimeoClick:function(){RM.views.searchVimeo&&RM.views.searchVimeo.show("",{choose:this.uploadVideoFromSearch})},uploadVideoFromSearch:function(t){this.getVideoFromUrl(t)}}},r=(i("oR3H"),i("KHd+")),l=Object(r.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"video-panel-search"},[i("div",{staticClass:"video-panel-input-wrapper"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.searchUrl,expression:"searchUrl"}],class:{"video-panel-input":!0,"has-icon":t.showIcon},attrs:{type:"text",spellcheck:"false",placeholder:t.placeholder},domProps:{value:t.searchUrl},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onEnter(e)},input:function(e){e.target.composing||(t.searchUrl=e.target.value)}}}),t._v(" "),t.showIcon?i("div",{staticClass:"video-panel-icon input-icon",class:{"is-remove":t.isRemove,"is-upload":t.isUpload},on:{click:t.onIconClick}}):t._e(),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.highlightInput?i("div",{staticClass:"video-panel-error"}):t._e()])],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.showSocial?i("div",{staticClass:"video-panel-social"},[i("div",{staticClass:"video-panel-social-icon video-panel-social-youtube",attrs:{title:"Youtube"},on:{click:t.onYoutubeClick}}),t._v(" "),i("div",{staticClass:"video-panel-social-icon video-panel-social-vimeo",attrs:{title:"Vimeo"},on:{click:t.onVimeoClick}})]):t._e()])],1)}),[],!1,null,null,null);e.a=l.exports},vetb:function(module,exports){module.exports={"template-constructor-control-anchor_picker":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="anchor-picker-wrapper">\n\t\t<div class="anchor-picker">\n\t\t\t<div class="popup">\n\t\t\t\t<span>Click</span>\n\t\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p}}},voD7:function(module,exports){module.exports={"template-constructor-control-shape_icon":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Icon" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="panel">\n\t\t<div class="search-block">\n\t\t\t<input class="search" type="text" placeholder="Search">\n\t\t\t<div class="loupe">\n\t\t\t\t<div class="rmpreloader hidden"><div class="arc"></div></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="separator"></div>\n\n\t\t<div class="common-wrapper">\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content">\n\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\n\t\t</div>\n\n\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\t</div>\n';return __p},"template-constructor-control-shape_icon-item":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon-item">\n\t\t<div class="noun-icon" style="background-image: url('+(null==(__t=icon.preview_url_42)?"":__t)+');" '+(null==(__t=icon.id?'data-id="'+icon.id+'"':'data-rm_id="'+icon.rm_id+'"')?"":__t)+' data-url="'+(null==(__t=icon.icon_url)?"":__t)+'">\n\t</div>\n';return __p}}},vvfI:function(t,e,i){"use strict";i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a})),i.d(e,"b",(function(){return r}));var n=i("9Juw"),o="textIndent",a=function(t){var e=t.editorState,i=t.block,a=Object(n.h)({editorState:e,block:i,key:o});return"number"==typeof a?a:void 0},s=function(t){var e=t.editorState,i=t.value,a=t.block;return Object(n.u)({editorState:e,block:a,key:o,value:i})},r=function(t){var e=t.editorState,i=t.method,n=a({editorState:e})||0,o=e.getSelection().toJS(),r=o.focusOffset,l=0===o.anchorOffset&&0===r;return"increase"===i&&l?s({editorState:e,value:n+28}):"decrease"===i&&l?s({editorState:e,value:Math.max(0,n+-28)}):void 0}},"w+s/":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return s})),i.d(e,"c",(function(){return r}));var n=i("9Juw");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a="paddings",s=function(t){var e=t.editorState,i=t.block,s=Object(n.h)({editorState:e,block:i,key:a});return"object"===o(s)?s:void 0},r=function(t){var e=t.block,i=t.editorState,o=t.paddings;return Object(n.u)({editorState:i,block:e,key:a,value:o})}},w4Sg:function(module,exports){module.exports={"template-constructor-block-gmaps":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <div class="map-container"></div>\n        <div class="map-overlay"></div>\n        <div class="message-overlay invisible"></div>\n    </div>\n    <div class="rm-gmaps-key hidden">\n        <div class="key-wrapper">\n            <div>\n                <div class="key-legend">To use Google Maps widget you need a Google Maps API key. Learn how to get an API key <a href="http://help.readymag.com/hc/en-us/articles/360020526932-Google-Maps" rel="noreferrer noopener" target="_blank">here</a>.</div>\n                <div class="key-input-wrap">\n                    <input type="text" class="key-input" placeholder="Paste Google Maps API Key here" required minlength="39" maxlength="39">\n                    <button>Apply</button>\n                </div>\n            </div>\n        </div>\n    </div>\n';return __p},"template-constructor-block-gmaps-search-control":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n    <div class="rm-search-block">\n        <input type="text" class="rm-search source">\n        <input type="text" class="rm-search destination">;\n    </div>\n';return __p}}},w5C2:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return s})),i.d(e,"d",(function(){return l})),i.d(e,"c",(function(){return c}));var n=i("sn3M");function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s,r={fontSize:18,lineHeight:26,fontFamily:"Roboto",fontWeight:400,fontStyle:"normal",fontWeights:["n1","i1","n3","i3","n4","i4","n5","i5","n7","i7","n9","i9"]};!function(t){t.Unstyled="unstyled"}(s||(s={}));var l=a({},s.Unstyled,{element:"p"}),c=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},Object(n.a)({selector:'[data-block="true"], .widget-text-v3 p:not([class]), .widget-text-v3 p[class=""]',label:"Unstyled",styles:"\n      // // Дефолтные стили текста\n      // font-family: ".concat(r.fontFamily,";\n      // font-weight: ").concat(r.fontWeight,";\n      // font-size: ").concat(r.fontSize,"px;\n      // line-height: ").concat(r.lineHeight,"px;\n\n      // // Сбрасываем, чтобы пользователь сам управлял кернингом (автокернинг)\n      // font-kerning: none;\n    ")}))},wAEK:function(module,exports){module.exports={"template-export-pdf-typekit-substitution-news-gothic":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Bold Italic/c6f4e54e-1d69-4559-b813-e2fc4ff29160-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Bold Italic/c6f4e54e-1d69-4559-b813-e2fc4ff29160-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Bold/9aab62b7-bc6f-405a-ad75-227bcf89d9dc-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Bold/9aab62b7-bc6f-405a-ad75-227bcf89d9dc-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic Italic/6327ba72-bfd5-4038-9658-e3a4a95a5c98-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic Italic/6327ba72-bfd5-4038-9658-e3a4a95a5c98-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 400;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/News Gothic/915b0ec4-cd16-40de-883e-1d77c3d07840-3.woff") format("woff"),\n\t\t url("/fonts/webtype/News Gothic/915b0ec4-cd16-40de-883e-1d77c3d07840-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 400;\n}\n</style>\n';return __p},"template-export-pdf-typekit-substitution-georgia-pro":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Black/4ec59c91-f66b-4751-8456-e114e9e14673-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Black/4ec59c91-f66b-4751-8456-e114e9e14673-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 900;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Bold Italic/6f283590-c3c2-416a-95c2-ca67d04aa929-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Bold Italic/6f283590-c3c2-416a-95c2-ca67d04aa929-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Bold/6f633c58-c751-4d08-9cea-2b27f74f37de-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Bold/6f633c58-c751-4d08-9cea-2b27f74f37de-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 700;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro Italic/e3bc0ad4-bdaa-4467-82a0-d90f697b7266-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro Italic/e3bc0ad4-bdaa-4467-82a0-d90f697b7266-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 400;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro SemiBold Italic/0e025df5-ba54-4bbb-84b4-c5b337a5b55b-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro SemiBold Italic/0e025df5-ba54-4bbb-84b4-c5b337a5b55b-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 600;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro SemiBold/60fe12ce-0223-4a9a-8e5c-b3e7bd381bc4-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro SemiBold/60fe12ce-0223-4a9a-8e5c-b3e7bd381bc4-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 600;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Georgia Pro/b97bef32-c0cb-4ad3-b724-1204d229731c-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Georgia Pro/b97bef32-c0cb-4ad3-b724-1204d229731c-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 400;\n}\n</style>\n';return __p},"template-export-pdf-typekit-substitution-nitti":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n<style id="export-pdf-typekit-substitution">\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Light Italic/15aba0ec-4ceb-49e2-985c-a95134a60aed-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Light Italic/15aba0ec-4ceb-49e2-985c-a95134a60aed-4.svg#web") format("svg");\n\tfont-style: italic;\n\tfont-weight: 300;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Light/6fd7c5e9-3131-4cb6-a99e-da74343b1253-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Light/6fd7c5e9-3131-4cb6-a99e-da74343b1253-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 300;\n}\n@font-face {\n\tfont-family: "'+(null==(__t=id)?"":__t)+'";\n\tsrc: url("/fonts/webtype/Nitti Medium/9054f262-2d2d-480f-9360-4560f110243b-3.woff") format("woff"),\n\t\t url("/fonts/webtype/Nitti Medium/9054f262-2d2d-480f-9360-4560f110243b-4.svg#web") format("svg");\n\tfont-style: normal;\n\tfont-weight: 500;\n}\n</style>\n';return __p}}},wHgl:function(module,exports){module.exports={"template-constructor-helpers-animation_steps_add_button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="add-button skip-rotate" title="Add Step">\n\t\t<div class="rhomb"></div>\n\n\t\t<div class="effect-popup js-steps-popup">\n\t\t\t<div class="effect-popup-caption">Add Step</div>\n\t\t\t<div class="effect-popup-item" data-value="use_move">Move</div>\n\t\t\t<div class="effect-popup-item" data-value="use_opacity">Opacity</div>\n\t\t\t<div class="effect-popup-item" data-value="use_rotate">Rotate</div>\n\t\t\t<div class="effect-popup-item" data-value="use_scale">Scale</div>\n\t\t\t<div class="corner-wrapper"><div class="corner"></div></div>\n\t\t</div>\n\t</div>\n\n';return __p}}},wrlV:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return a}));var n=function(t){if(t){return{"image/jpeg":"jpg","image/png":"png","image/bmp":"bmp","image/gif":"gif","image/svg+xml":"svg"}[t.toLowerCase()]}},o=function(t){return new Promise((function(e,i){var n=new Image;n.onload=function(){n.width&&n.height||i("Unable to get image dimensions");var t={width:n.width,height:n.height};n.remove(),e(t)},n.onerror=function(t){return i(t)},n.src=t}))},a=function(t){return new Promise((function(e,i){(function(t){return t?new Promise((function(e,i){try{var n=new FileReader;n.onloadend=function(){return e(n.result)},n.onerror=function(t){return i(t)},n.readAsDataURL(t)}catch(t){i(t)}})):Promise.reject("No file data")})(t).then((function(a){o(a).then((function(i){var o={width:i.width,height:i.height,type:t.type,size:t.size,ext:n(t.type),content:a};e(o)})).catch((function(t){return i(t)}))}))}))}},wxrA:function(module,exports){module.exports={"template-constructor-block-facebook-type_like_button":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-like fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" '+(null==(__t=data.share_button||data.send_button?'data-share="true"':"")?"":__t)+' data-width="'+(null==(__t=data.w)?"":__t)+'" data-show-faces="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-layout="'+(null==(__t=data.layout)?"":__t)+'" data-type="data.type_like_button"></div>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-facebook-type_page":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-page fb" data-href="'+(null==(__t=data.url?data.url:"https://www.facebook.com/readymag")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-height="'+(null==(__t=data.h)?"":__t)+'" data-show-facepile="'+(null==(__t=data.show_faces)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'" data-tabs="'+(null==(__t=data.show_stream?"timeline, events, messages":"")?"":__t)+'" data-show-border="true" data-small-header="'+(null==(__t=data.small_header)?"":__t)+'" data-adapt-container-width="true"></div>\n\t<div class="overlay"></div>\n';return __p},"template-constructor-block-facebook-type_comments":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="fb-comments fb" data-href="'+(null==(__t=data.url?data.url:"http://readymag.com")?"":_.escape(__t))+'" data-width="'+(null==(__t=data.w)?"":__t)+'" data-num-posts="'+(null==(__t=data.num_posts)?"":__t)+'" data-colorscheme="'+(null==(__t=data.theme)?"":__t)+'"></div>\n\t<div class="overlay"></div>\n';return __p}}},xka6:function(module,exports){module.exports={"template-constructor-control-form_content":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="icon noarrow" data-alt="Fields" data-alt-pos="left" data-alt-offset="9"></div>\n\n\t<div class="form-fields-panel panel js-panel">\n\t\t<div class="form-fields-header">Fields</div>\n\n\t\t<div class="form-fields-wrapper">\n\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t<div class="resizable-content js-fields-container"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t</div>\n\t\t\t<div class="js-settings-popup-container"></div>\n\t\t</div>\n\n\t\t<div class="form-fields-footer js-add-block">\n\t\t\t<div class="js-new-settings-container"></div>\n\t\t\t<div class="form-fields-add js-add" title="Add field"></div>\n\t\t</div>\n\n\t\t<div class="js-dropdown-panel-container"></div>\n\n\t\t<div class="resize-handle-top"></div>\n\t\t<div class="resize-handle-bottom"></div>\n\t</div>\n';return __p},"template-constructor-control-form_content-field":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="form-fields-item js-field form-fields-item-'+(null==(__t=tp)?"":__t)+" "+(null==(__t=isSortable?"js-sortable":"js-not-sortable")?"":__t)+'"\n\t     data-id="'+(null==(__t=id)?"":__t)+'" data-type="'+(null==(__t=tp)?"":__t)+'">\n\t\t',"dropdown"===tp?__p+='\n\t\t\t<div class="form-fields-caption-dropdown-helper">\n\t\t\t\t<div class="form-fields-caption-dropdown-mask js-dropdown-trigger"></div>\n\t\t\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off" readonly="readonly"\n\t\t\t\t       class="form-fields-caption form-fields-caption-'+(null==(__t=tp)?"":__t)+" js-field-caption js-field-caption-"+(null==(__t=tp)?"":__t)+'"/>\n\t\t\t</div>\n\t\t':__p+='\n\t\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off"\n\t\t\t\t       class="form-fields-caption form-fields-caption-'+(null==(__t=tp)?"":__t)+" "+(null==(__t=mode)?"":__t)+" js-field-caption js-field-caption-"+(null==(__t=tp)?"":__t)+'"/>\n\t\t',__p+="\n\t\t",showSettings&&(__p+='\n\t\t\t<div class="form-fields-type-token js-settings-trigger">'+(null==(__t=typeLetter)?"":__t)+"</div>\n\t\t"),__p+="\n\t\t",showDelete&&(__p+='\n\t\t\t<div class="form-fields-delete js-delete-field"></div>\n\t\t'),__p+="\n\t\t",showSubmitAfterArrow&&(__p+='\n\t\t\t<div class="form-fields-placeholder-selector '+(null==(__t=showRemoveArrow?"action-icon remove-icon":"js-submit-dropdown-trigger")?"":__t)+'">\n\t\t\t\t<div class="form-fields-placeholder-arrow"></div>\n\t\t\t</div>\n\t\t'),__p+="\n\t</div>\n";return __p},"template-constructor-control-form_content-settings":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="settings-popup transition-enable js-settings-popup '+(null==(__t=edit?"settings-popup-edit js-edit-settings":"settings-popup-add js-add-settings")?"":__t)+'" data-id="'+(null==(__t=id)?"":__t)+'">\n\t\t<div class="settings-popup-types">\n\t\t\t',_.each(types,(function(t,e){__p+='\n\t\t\t\t<div class="settings-popup-type js-field-type'+(null==(__t=e===selectedType?" selected":"")?"":__t)+(null==(__t=e!==selectedType&&disabledTypes&&disabledTypes.length&&disabledTypes.includes(e)?" disabled":"")?"":__t)+'" data-value="'+(null==(__t=e)?"":__t)+'" data-action="'+(null==(__t=edit?"edit":"add")?"":__t)+'">\n\t\t\t\t\t'+(null==(__t=t)?"":__t)+"\n\t\t\t\t</div>\n\t\t\t"})),__p+="\n\t\t</div>\n\t\t",showOptionalSwitcher&&(__p+='\n\t\t\t<div class="settings-popup-optional">\n\t\t\t\t<div class="switcher-wrapper settings-popup-optional-switcher">\n\t\t\t\t\t<div class="switcher-caption settings-popup-optional-caption">Optional Field</div>\n\t\t\t\t\t<div class="switcher settings-popup-optional-value" data-type="optional"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'),__p+='\n\t\t<div class="corner-wrapper">\n\t\t\t<div class="corner"></div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-after-submit":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n\t<div class="submit-wrapper settings-popup js-settings-popup">\n\t\t<div class="settings-popup-types">\n\t\t\t',_.each(types,(function(t,e){__p+='\n\t\t\t\t<div class="settings-popup-type js-submit-field-type '+(null==(__t=e===selectedType?"selected":"")?"":__t)+'" data-value="'+(null==(__t=e)?"":__t)+'" >\n\t\t\t\t\t'+(null==(__t=t)?"":__t)+"\n\t\t\t\t</div>\n\t\t\t"})),__p+='\n\t\t</div>\n\n\t\t<div class="resizable-scroll-wrapper">\n\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t<div class="resizable-content">\n\t\t\t\t\t<div class="styles-wrapper"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="resizable-scroll"></div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-dropdown":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="dropdown-panel js-dropdown-panel">\n\t\t<div class="dropdown-content">\n\t\t\t<div class="dropdown-header form-fields-header js-dropdown-caption-container"></div>\n\n\t\t\t<div class="dropdown-wrapper">\n\t\t\t\t<div class="resizable-scroll-wrapper">\n\t\t\t\t\t<div class="resizable-content-wrapper">\n\t\t\t\t\t\t<div class="resizable-content js-dropdown-content">\n\t\t\t\t\t\t\t<div class="dropdown-options js-dropdown-options-container"></div>\n\t\t\t\t\t\t\t<div class="dropdown-add dropdown-option form-fields-item js-add-option">+ Add</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="resizable-scroll"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="dropdown-footer form-fields-footer">\n\t\t\t\t<div class="dropdown-save js-save-dropdown">Save</div>\n\t\t\t\t<div class="dropdown-cancel js-cancel-dropdown"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n';return __p},"template-constructor-control-form_content-dropdown-caption":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off"\n\t\t\t\t\t\t       class="dropdown-caption-value form-fields-caption js-dropdown-caption"/>\n';return __p},"template-constructor-control-form_content-dropdown-option":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="form-fields-item dropdown-option js-dropdown-option js-sortable" data-value="'+(null==(__t=text)?"":__t)+'" data-number="'+(null==(__t=number)?"":__t)+'">\n\t\t<input type="text" name="" value="'+(null==(__t=text)?"":__t)+'" placeholder="'+(null==(__t=placeholder)?"":__t)+'" autocomplete="off" data-number="'+(null==(__t=number)?"":__t)+'"\n\t\t       class="dropdown-option-value form-fields-caption js-dropdown-option-value"/>\n\t\t<div class="dropdown-number form-fields-type-token">'+(null==(__t=number)?"":__t)+"</div>\n\t\t",showDelete&&(__p+='\n\t\t\t<div class="dropdown-option-delete form-fields-delete js-delete-option"></div>\n\t\t'),__p+="\n\t</div>\n";return __p}}},yWjQ:function(module,exports){module.exports={"template-common-slideshow-player":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\t<div class="common-slideshow environment-'+(null==(__t=tp)?"":_.escape(__t))+'">\n\t\t<div class="images no-rmswipe">\n\t\t\t<div class="images-wrapper">\n\t\t\t</div>\n\t\t\t<div class="fullscreen">\n\t\t\t\t<svg class="fullscreen-off" width="17px" height="17px" viewBox="0 0 17 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<g id="full-screen" transform="translate(-12.000000, -12.000000)" fill="#F4F4F4" fill-rule="nonzero">\n\t\t\t\t\t\t\t<g id="Arrows" transform="translate(12.000000, 12.000000)">\n\t\t\t\t\t\t\t\t<path d="M12.7571068,4.74264069 L10.2571068,7.24264069 C9.86658249,7.63316498 9.23341751,7.63316498 8.84289322,7.24264069 C8.45236893,6.8521164 8.45236893,6.21895142 8.84289322,5.82842712 L11.3428932,3.32842712 L9.72157288,1.70710678 C9.33104858,1.31658249 9.33104858,0.683417511 9.72157288,0.292893219 C9.90910925,0.10535684 10.1634632,-2.93098879e-14 10.4286797,-2.93098879e-14 L15.0144661,-2.93098879e-14 C15.5667508,-2.93098879e-14 16.0144661,0.44771525 16.0144661,1 L16.0144661,5.58578644 C16.0144661,6.13807119 15.5667508,6.58578644 15.0144661,6.58578644 C14.7492496,6.58578644 14.4948957,6.4804296 14.3073593,6.29289322 L12.7571068,4.74264069 Z" id="Combined-Shape"></path>\n\t\t\t\t\t\t\t\t<path d="M4.20710669,13.2426408 L1.70710669,15.7426408 C1.3165824,16.1331651 0.683417421,16.1331651 0.292893129,15.7426408 C-0.097631163,15.3521165 -0.097631163,14.7189515 0.292893129,14.3284272 L2.79289313,11.8284272 L1.17157279,10.2071069 C0.781048494,9.81658256 0.781048494,9.18341758 1.17157279,8.79289329 C1.35910916,8.60535691 1.61346308,8.50000007 1.87867957,8.50000007 L6.464466,8.50000007 C7.01675075,8.50000007 7.464466,8.94771532 7.464466,9.50000007 L7.464466,14.0857865 C7.464466,14.6380713 7.01675075,15.0857865 6.464466,15.0857865 C6.19924951,15.0857865 5.9448956,14.9804297 5.75735922,14.7928933 L4.20710669,13.2426408 Z" id="Combined-Shape" transform="translate(3.732233, 12.267767) rotate(180.000000) translate(-3.732233, -12.267767) "></path>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t\t<svg class="fullscreen-on" width="18px" height="18px" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n\t\t\t\t\t<g id="Page-1" stroke="none" stroke-width="0.1" fill="none" fill-rule="evenodd">\n\t\t\t\t\t\t<g id="full-screen" transform="translate(-11.000000, -11.000000)" fill="#F4F4F4" fill-rule="nonzero">\n\t\t\t\t\t\t\t<g id="Arrows" transform="translate(11.000000, 11.000000)">\n\t\t\t\t\t\t\t\t<path d="M14.2071067,5.24264078 L11.7071067,7.74264078 C11.3165824,8.13316507 10.6834174,8.13316507 10.2928931,7.74264078 C9.90236883,7.35211649 9.90236883,6.71895151 10.2928931,6.32842721 L12.7928931,3.82842721 L11.1715728,2.20710687 C10.7810485,1.81658258 10.7810485,1.1834176 11.1715728,0.792893312 C11.3591092,0.605356933 11.6134631,0.500000093 11.8786796,0.500000093 L16.464466,0.500000093 C17.0167507,0.500000093 17.464466,0.947715343 17.464466,1.50000009 L17.464466,6.08578653 C17.464466,6.63807128 17.0167507,7.08578653 16.464466,7.08578653 C16.1992495,7.08578653 15.9448956,6.98042969 15.7573592,6.79289331 L14.2071067,5.24264078 Z" id="Combined-Shape" transform="translate(13.732233, 4.267767) rotate(180.000000) translate(-13.732233, -4.267767) "></path>\n\t\t\t\t\t\t\t\t<path d="M4.70710678,14.7426407 L2.20710678,17.2426407 C1.81658249,17.633165 1.18341751,17.633165 0.792893219,17.2426407 C0.402368927,16.8521164 0.402368927,16.2189514 0.792893219,15.8284271 L3.29289322,13.3284271 L1.67157288,11.7071068 C1.28104858,11.3165825 1.28104858,10.6834175 1.67157288,10.2928932 C1.85910925,10.1053568 2.11346317,10 2.37867966,10 L6.96446609,10 C7.51675084,10 7.96446609,10.4477153 7.96446609,11 L7.96446609,15.5857864 C7.96446609,16.1380712 7.51675084,16.5857864 6.96446609,16.5857864 C6.6992496,16.5857864 6.44489569,16.4804296 6.25735931,16.2928932 L4.70710678,14.7426407 Z" id="Combined-Shape"></path>\n\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t</g>\n\t\t\t\t\t</g>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\t\t\t<div class="bottom-arrows">\n\t\t\t\t\t<div class="prev-picture-arrow-bottom arrow-bottom">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="counters-container">\n\t\t\t\t\t\t<div class="counters-numbers">\n\t\t\t\t\t\t\t<span class="counters-text-current">1</span>/<span class="counters-text-total">2</span>\n\t\t\t\t\t\t</div>\n\t\t\n\t\t\t\t\t\t<div class="counters-dots no-rmswipe">\n\t\t\t\t\t\t\t<div class="scroll-wrapper">\n\t\t\t\t\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t\t\t\t\t<div class="items">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="scroll"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="next-picture-arrow-bottom arrow-bottom">\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="cursor"></div>\n\n\t\t\t<div class="prev-picture-arrow-middle arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M23.5 11.5 L15.5 19.5 L23.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\n\n\t\t\t<div class="next-picture-arrow-middle arrow-middle">\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="40" height="40">\n\t\t\t\t\t<path d="M16.5 11.5 L24.5 19.5 L16.5 27.5" stroke-linejoin="round" stroke-linecap="round" style="fill:none; stroke:#ffffff; stroke-width:3px"></path>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="thumbnails no-rmswipe">\n\t\t\t<div class="scroll-wrapper">\n\t\t\t\t<div class="items-wrapper has-horizontal-scroll">\n\t\t\t\t\t<div class="items">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="scroll"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="captions">\n\t\t\t',"constructor"==tp&&(__p+='\n\t\t\t\t<textarea class="caption" maxlength="9999" placeholder="Type image caption here"></textarea>\n\t\t\t'),__p+="\n\t\t</div>\n\t</div>\n\n";return __p}}},z79a:function(t,e,i){"use strict";var n=i("xi34");window.iconSVGCache=[];var o=function(){};o.prototype={MAX_ICON_CACHE_SIZE:30,generateShapeSVG:function(t,e,i,o,a){var s,r=e.get("bg_color")||e.viewport_default&&e.viewport_default.bg_color,l=this.getRGBA(r||"ffffff",e.get("bg_opacity")),c=this.getRGBA(e.get("color"),e.get("opacity"));if("ellipse"==(a="hotspot"===e.get("type")?a||e.get("pin_type"):a||e.get("tp"))){var d=i/2,h=o/2,u=e.get("borders");s=x("ellipse",{cx:d,cy:h,rx:d,ry:h},l,c,u=Math.min(u,d,h),e.id+"_"+t,e.get("opacity"))}if("rectangle"==a||"polygon"==a){"hotspot"===e.get("type")&&(c=l="rgba(0, 0, 0, 0)");var p="rectangle"==a?4:e.get("sides"),g=(u=e.get("borders"),e.get("radius")||0),m=function(t,e,i,n){for(var o,a,s,r=2*Math.PI/t,l=Math.PI/2-(t%2==1?0:r/2),c=[],d=999999,h=-999999,u=999999,p=-999999,g=0;g<t;g++)o=l+g*r,a=.5+.5*Math.cos(o),s=.5-.5*Math.sin(o),c.push({x:a,y:s}),a<d&&(d=a),a>h&&(h=a),s<u&&(u=s),s>p&&(p=s);for(g=0;g<t;g++)c[g].x=(c[g].x-d)*(e/(h-d)),c[g].y=(c[g].y-u)*(i/(p-u)),c[g].x=Math.round(1e5*c[g].x)/1e5,c[g].y=Math.round(1e5*c[g].y)/1e5;return c}(p,i,o),f=function(t){if(!t)return 99999;for(var e,i=99999,n=t.length,o=0;o<n;o++){var a=t[o].x-t[(o+1)%n].x,s=t[o].y-t[(o+1)%n].y;(e=Math.sqrt(a*a+s*s))<i&&(i=e),t[o].side=e}return i}(m),v=function(t,e,i,n,o,a){if(!t)return{};if(e<=1e-4)return{};var s=[],r=t.length;e=Math.min(e,i/2);for(var l=0;l<r;l++){var c,d,h,u,p=t[l],g=t[(l+1)%r],m=t[l].side,f=(g.x-p.x)/m,v=(g.y-p.y)/m;c=p.x+f*e,d=p.y+v*e,h=g.x-f*e,u=g.y-v*e,c=Math.round(1e5*c)/1e5,d=Math.round(1e5*d)/1e5,h=Math.round(1e5*h)/1e5,u=Math.round(1e5*u)/1e5,s.push({x:c,y:d}),s.push({x:h,y:u})}return{points:s,radius:e}}(m,g,f);s=x("path",{path:b=function(t,e,i){if(!t)return"";for(var n=t.length,o="",a=0;a<n;a++){var s=2*a+1,r=(2*a+2)%(2*n);if(o+=0==a?"M":"L",e){o+=e[s].x+" "+e[s].y+" ";var l=e[s].x-e[r].x,c=e[s].y-e[r].y,d=1/((l*l+c*c)/4)-1/(i*i),h=Math.sqrt(1/d);o+="A"+h+" "+h+" 0 0 0 "+e[r].x+" "+e[r].y+" "}else o+=t[a].x+" "+t[a].y+" "}return o+" Z "}(m,v.points,v.radius)},l,c,u,e.id+"_"+t,e.get("opacity"))}if("line"==a){u=e.get("weight"),h=Math.round(o/2)+(u%2==1?.5:0);var b="",_=[13*u/3,2*u/3].join(" "),y=u>1?[.001,5*u/3].join(" "):[1,2].join(" "),w="dotted"==e.get("stroke")?u/2:0;if(b="M"+w+" "+h+" L"+i+" "+h,"solid"==e.get("stroke")&&(s='<path d="'+b+'" style="fill:none; stroke:'+l+";stroke-width:"+u+'"/>'),"double"==e.get("stroke"))s='<path d="'+("M"+w+" "+(h-u)+" L"+i+" "+(h-u))+'" style="fill:none; stroke:'+l+";stroke-width:"+u+'"/>',s+='<path d="'+("M"+w+" "+(h+u)+" L"+i+" "+(h+u))+'" style="fill:none; stroke:'+l+";stroke-width:"+u+'"/>';"dotted"==e.get("stroke")&&(s='<path d="'+b+'" stroke-linecap="round" stroke-dasharray="'+y+'" style=" fill:none; stroke:'+l+";stroke-width:"+u+'"/>'),"dashed"==e.get("stroke")&&(s='<path d="'+b+'" stroke-dasharray="'+_+'" style=" fill:none; stroke:'+l+";stroke-width:"+u+'"/>')}if("icon"==a){var k=this.iconData||this.current_icon_data;if(!k)return null;var S=k.$svg.clone();return S.css({width:"100%",height:"100%"}),l=this.getRGBA(r,1),S.find("*:not(.fixed-color)").each((function(){var t=Object(n.a)(this);t.css({fill:"","fill-opacity":""}),t.get(0).removeAttribute("fill"),t.get(0).removeAttribute("fill-opacity")})),S.get(0).setAttribute("fill",l),S.get(0).setAttribute("fill-opacity",e.get("bg_opacity")),S}return'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+i+'px" height="'+o+'px">'+s+"</svg>";function x(t,e,i,n,o,a,s){var r="mask_"+a,l="clip_"+a,c="",d=2;return o>0&&s>.99&&(d=1),c="<defs>",o>0&&(c+='<mask id="'+r+'">',"path"==t&&(c+='<path d="'+e.path+'" style="fill:white; stroke:black; stroke-width:'+o*d+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:white; stroke:black; stroke-width:'+o*d+'"/>'),c+="</mask>"),c+='<clippath id="'+l+'">',"path"==t&&(c+='<path d="'+e.path+'"/>'),"ellipse"==t&&(c+='<ellipse cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'"/>'),c+="</clippath>",c+="</defs>","path"==t&&(c+='<path mask="url(#'+r+')" d="'+e.path+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse mask="url(#'+r+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:'+i+'; stroke:none; stroke-width:0; pointer-events: visiblePainted;"/>'),0==o||("path"==t&&(c+='<path clip-path="url(#'+l+')" d="'+e.path+'" style="fill:none; stroke:'+n+"; stroke-width:"+2*o+'; pointer-events: visiblePainted;"/>'),"ellipse"==t&&(c+='<ellipse clip-path="url(#'+l+')" cx="'+e.cx+'" cy="'+e.cy+'" rx="'+e.rx+'" ry="'+e.ry+'" style="fill:none; stroke:'+n+"; stroke-width:"+2*o+'; pointer-events: visiblePainted;"/>')),c}},getRGBA:function(t,e){if(0==e)return"none";var i=[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)];return e>.99?"rgb("+i[0]+","+i[1]+","+i[2]+")":"rgba("+i[0]+","+i[1]+","+i[2]+", "+e+")"}},e.a=o},zMlX:function(t,e,i){"use strict";var n,o;function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return s})),function(t){t.Smallcaps="smcp",t.StandardLigatures="liga",t.DiscretionaryLigatures="dlig",t.RequiredLigatures="rlig",t.HistoricalLigatures="hlig",t.Fractions="frac",t.Alternates="salt",t.StylisticSet01="ss01",t.StylisticSet02="ss02",t.StylisticSet03="ss03",t.StylisticSet04="ss04",t.StylisticSet05="ss05",t.StylisticSet06="ss06",t.StylisticSet07="ss07",t.StylisticSet08="ss08",t.StylisticSet09="ss09",t.StylisticSet10="ss10",t.StylisticSet11="ss11",t.StylisticSet12="ss12",t.StylisticSet13="ss13",t.StylisticSet14="ss14",t.StylisticSet15="ss15",t.StylisticSet16="ss16",t.StylisticSet17="ss17",t.StylisticSet18="ss18",t.StylisticSet19="ss19",t.StylisticSet20="ss20",t.LiningFigures="lnum",t.OldstyleFigures="onum",t.ProportionalFigures="pnum",t.TabularFigures="tnum"}(o||(o={}));var s=(a(n={},o.LiningFigures,"Lining Figures"),a(n,o.OldstyleFigures,"Oldstyle Figures"),a(n,o.ProportionalFigures,"Proportional Figures"),a(n,o.TabularFigures,"Tabular Figures"),n)},zZDe:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return s}));var n=i("q1tI"),o=i.n(n),a="BR_ENTITY",s={strategy:function(t,e,i){t.findEntityRanges((function(t){var e=t.getEntity();return null!==e&&i.getEntity(e).getType()===a}),e)},component:function(){return o.a.createElement("br",null)}}},zjto:function(t,e,i){"use strict";i.r(e);var n=i("uxFs"),o=i("q1tI"),a=i.n(o),s=i("v83y"),r=i("8AXF"),l=i("8Tds"),c=i("9Juw"),d=i("UGKl"),h=i("HjzJ"),u=i("a68n"),p=i("IrH7"),g=i("i0ke"),m=function(){var t=Object(o.useContext)(r.BackboneContext).model,e=Object(s.convertFromRaw)(Object(c.o)(t)),i=Object(c.r)(s.EditorState.createWithContent(e,g.a)),n=i.editorState,m=i.blockRenderMap;return a.a.createElement(d.a,{bgColor:t.bgColor,height:t.h,width:t.w,textDirection:t.textDirection||l.c.LTR,overflow:t.overflow,columns:t.columns,editorState:n,blockStyleFn:function(t){var e=t.getType();return Object(h.c)(e)?[e,Object(u.b)({block:t}),Object(p.c)({block:t})].join(" "):e},blockRenderMap:m,onChange:function(){},readOnly:!0})},f=i("Jzj8"),v=i("mIwl");i.d(e,"version",(function(){return b})),i.d(e,"TextConstructor",(function(){return n.b})),i.d(e,"TextViewer",(function(){return m})),i.d(e,"createTextStore",(function(){return f.a})),i.d(e,"useTextWidgetStore",(function(){return f.d})),i.d(e,"useTextStylesStore",(function(){return f.c})),i.d(e,"useLinkStylesStore",(function(){return f.b})),i.d(e,"getRandomText",(function(){return v.a}));var b=3},zn5y:function(t,e,i){t.exports=i.p+"dbfc99e33316020287472aea32c61222.svg"},zw1n:function(module,exports){module.exports={"template-common-button-widget":function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='\n\n    <div class="common-button" data-id="'+(null==(__t=data._id)?"":_.escape(__t))+'">\n\n        <div class="icon"></div>\n\n    </div>\n\n';return __p}}},zzMN:function(t,e,i){"use strict";var n=i("xi34"),o=i("q1z7"),a=i.n(o),s=i("rFsW"),r=i("OTSC"),l=i("tZHv"),c=i("DiDd"),d=i.n(c),h=i("phNm");function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){g(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var m=a.a.View.extend({selectIconRight:18,selectIconTextMargin:2,initialize:function(t){s.a.bindAll(this),this.data=t.data,this.$container=t.$container,this.environment=t.environment,this.block=t.block,this.eCommerceManager=t.eCommerceManager,this.template=d.a["template-common-add-to-cart-wrap"],this.product=null,this.selects=[],this.selectsMap={},this.attributes=[],this.selectsValues={},this.restrictions={},this.constraints={width:0,height:0},this.showSkus=!1,this.longestAttribute="",this.selectPadding=0,this.setData_debounced=s.a.debounce(this.setData,100),this.setModel_debounced=s.a.debounce(this.setModel,200),this.$container.html(this.template),this.setElement(this.$container.find(".add-to-cart-wrap")),this.$button=this.$el.find(".add-to-cart-button"),this.$buttonIcon=this.$button.find(".button-icon"),this.$errorBlock=this.$button.find(".add-to-cart-error-block"),this.$buttonText=this.$button.find(".button-text"),this.$attrsContainer=this.$el.find(".add-to-cart-attributes"),this.$sizesCalculatingBlock=this.$el.find(".sizes-calculating-block")},render:function(){if(!this.rendered)return this.eCommerceManager.isMagConnectedToStripe()&&"default"!==this.data.selected_product_id?void this.getProduct():(this.rendered=!1,this.showSkus=!1,this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),void this.setMinimalDimensions())},destroy:function(){this.unbindDOMEvents()},rerender:function(t){t&&(this.data=t),this.rendered=!1,this.render()},getProduct:function(){this.product=this.eCommerceManager.getProductById(this.data.selected_product_id),this.product?(this.showSkus=this.checkSkus(null,this.product),this.renderAttributes(this.data),this.renderButton(this.data),this.renderMargins(),"horizontal"===this.data.layout&&this.setHorizontalLayoutClass(),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),this.setMinimalDimensions(),this.bindDOMEvents()):this.eCommerceManager.productsLoading?this.eCommerceManager.events.once("ecommerce:loadproducts:complete",this.getProduct.bind(this)):(this.eCommerceManager.productsLoaded||this.eCommerceManager.productsLoadingError)&&(this.showSkus=!1,this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.recalcDimensions({width:this.data.w,height:this.data.h}),this.trigger("loaded"),this.setMinimalDimensions())},checkSkus:function(t,e){return!!this.eCommerceManager.isMagConnectedToStripe()&&(e?i=e:t?i=this.eCommerceManager.getProductById(t):this.data.selected_product_id&&"default"!==this.data.selected_product_id&&(i=this.eCommerceManager.getProductById(this.data.selected_product_id)),!!i&&(this.product=i,this.haveProductAnyAttrForRendering(i)));var i},haveProductAnyAttrForRendering:function(t){return!!(t.attributes&&Array.isArray(t.attributes)&&t.attributes.length)&&t.articles.length>1},renderButton:function(t){this.showSkus||(this.$attrsContainer.empty().css({"margin-bottom":0,"margin-right":0}),this.selects=[],this.selectsMap={},this.attributes=[]),this.$buttonText.val(t.text),"constructor"!==this.environment&&this.$button.addClass("viewer-button"),this.renderButtonIcon(t),this.checkOutOfStock()},renderButtonIcon:function(t){if(t.icon_enabled){var e="left"===t.icon_pos?"row":"row-reverse";this.$button.css("flex-direction",e),this.$buttonIcon.css({display:"inline-block",height:t.icon_h,width:t.icon_w})}else this.$buttonIcon.css({display:"none"})},renderAttributes:function(t){if(this.$attrsContainer.empty().css({"margin-bottom":0,"margin-right":0}),this.selects=[],this.selectsMap={},this.attributes=[],this.showSkus){var e=this.product?this.product:this.eCommerceManager.getProductById(t.selected_product_id);e&&(this.product||(this.product=e),(e.active||"constructor"===this.environment)&&("constructor"!==this.environment&&this.calculateSelectRestrictions(),e.attributes.forEach(function(e){e.length>this.longestAttribute.length&&(this.longestAttribute=e);var i=this.renderAttrSelect(e,t,this.$attrsContainer);this.selects.push(i),this.selectsMap[e]=i,this.attributes.push(e)}.bind(this))))}},renderAttrSelect:function(t,e,i){var o;if("constructor"===this.environment){o=Object(n.a)("<select>",{class:"attributes-input",value:t}).attr("name",t);var a=Object(n.a)("<option>").attr("value",t).addClass("attributes-option default-option").text(t);o.append(a)}else o=Object(n.a)("<select>").attr("name",t).addClass("attributes-input"),this.renderSelectOptions(t,o,!0),o.on("change",this.onSelectChange.bind(this));var s=Object(n.a)("<div>",{class:"select-container"});s.append('<div class="add-to-cart-error-block"></div>');var r=Object(n.a)("<input>",{type:"text",class:"fake-select",readonly:!0,tabindex:-1,value:t}),l=Object(n.a)('<svg class="select-dropdown-triangle" width="10px" height="16px" viewBox="0 0 10 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="dev" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="E-comm-W-01.4" transform="translate(-632.000000, -263.000000)" fill="#FFFFFF"><g transform="translate(494.500000, 247.000000)"><g><g transform="translate(136.000000, 15.500000)"><path d="M3.88579937,12.2407434 L8.34920863,8.41496403 C8.76853447,8.05554188 9.39983445,8.10410342 9.7592566,8.52342926 C9.91460784,8.70467237 10,8.93550936 10,9.17422064 L10,16.8257794 C10,17.3780641 9.55228475,17.8257794 9,17.8257794 C8.76128873,17.8257794 8.53045174,17.7403872 8.34920863,17.585036 L3.88579937,13.7592566 C3.46647353,13.3998345 3.41791199,12.7685345 3.77733414,12.3492086 C3.81065883,12.3103298 3.84692056,12.2740681 3.88579937,12.2407434 Z" id="arrow-copy" transform="translate(6.500000, 13.000000) scale(-1, -1) rotate(-270.000000) translate(-6.500000, -13.000000) "></path><path d="M3.88579937,3.2407434 L8.34920863,-0.585035966 C8.76853447,-0.944458116 9.39983445,-0.895896579 9.7592566,-0.476570737 C9.91460784,-0.295327627 10,-0.0644906353 10,0.174220637 L10,7.82577936 C10,8.37806411 9.55228475,8.82577936 9,8.82577936 C8.76128873,8.82577936 8.53045174,8.7403872 8.34920863,8.58503597 L3.88579937,4.7592566 C3.46647353,4.39983445 3.41791199,3.76853447 3.77733414,3.34920863 C3.81065883,3.31032982 3.84692056,3.27406809 3.88579937,3.2407434 Z" id="arrow-copy" transform="translate(6.500000, 4.000000) scale(-1, 1) rotate(-270.000000) translate(-6.500000, -4.000000) "></path></g></g></g></g></g></svg>');return i.append(s),s.append(r,l,o),"constructor"===this.environment&&s.append(Object(n.a)("<div>",{class:"select-overlay"})),o},renderSelectOptions:function(t,e,i){var o=this,a=this.getAllSelectOptions();e.empty();var s=Object(n.a)("<option>").attr("value","default").addClass("attributes-option default-option").text(t);e.append(s),a[t]&&a[t].forEach((function(i){var a=Object(n.a)("<option>").attr("value",i).addClass("attributes-option").text(i);o.restrictions[t]&&!o.restrictions[t].includes(i)&&a.attr("disabled",!0),e.append(a)})),i?this.selectsValues[t]="default":e.val(this.selectsValues[t])},getAllSelectOptions:function(){var t={};return this.product.articles.forEach((function(e){Object.keys(e.attributes).forEach((function(i){t[i]=t[i]||[],t[i].includes(e.attributes[i])||t[i].push(e.attributes[i])}))})),t},calculateSelectRestrictions:function(){this.restrictions={};var t,e={},i=0;for(var n in this.selectsValues)"default"!==this.selectsValues[n]&&(e[n]=this.selectsValues[n],t=n,i+=1);this.product.articles.forEach(function(n){if(s.a.isMatch(n.attributes,e))for(var o in n.attributes)this.restrictions[o]?-1===this.restrictions[o].indexOf(n.attributes[o])&&this.restrictions[o].push(n.attributes[o]):this.restrictions[o]=[n.attributes[o]];1===i&&(this.restrictions[t]?-1===this.restrictions[t].indexOf(n.attributes[t])&&this.restrictions[t].push(n.attributes[t]):this.restrictions[t]=[n.attributes[t]])}.bind(this))},renderMargins:function(t){var e=t||this.data.layout;if(this.$attrsContainer.css({"margin-bottom":0,"margin-right":0}),this.showSkus&&this.selects.length){var i=this.selects.length-1;"horizontal"===e?(this.$attrsContainer.css({"margin-right":this.data.select_btn_margin}),this.selects.forEach(function(t,e){t.parent().css({"margin-bottom":0,"margin-right":e<i?this.data.attributes_margin:0})}.bind(this))):(this.$attrsContainer.css({"margin-bottom":this.data.select_btn_margin}),this.selects.forEach(function(t,e){t.parent().css({"margin-bottom":e<i?this.data.attributes_margin:0,"margin-right":0})}.bind(this)))}},generateIndividualStyleCSS:function(t,e,i){var n=e||"default",o=i||"both";"constructor"===this.environment?this.generateStyleCSS(t,n,o):(this.generateStyleCSS(t,n,o),this.generateHoverStyleCSS(t))},bindDOMEvents:function(){this.eCommerceManager.events.on("ecommerce:cartdata:changed",this.checkOutOfStock),"constructor"!==this.environment&&this.$button.on("click",this.onAddToCartClick)},unbindDOMEvents:function(){"constructor"!==this.environment&&this.$button.off("click",this.onAddToCartClick)},getSimpleMinimalDimensions:function(){return this.showSkus?"vertical"===this.data.layout?{width:50,height:100}:{width:190,height:30}:{width:42,height:16}},getHorizontalTextMargin:function(t){return Math.ceil(t/4)},getVerticalTextMargin:function(t){return Math.ceil(t/6)},getHorizontalIconMargin:function(t){return Math.ceil(t/4)},getVerticalIconMargin:function(t){return Math.ceil(t/6)},getMinimalDimensions:function(){var t=0,e=0,i=this.data.icon_h+2*this.getVerticalIconMargin(this.data.icon_h);if("text"===this.data.tp?(t=this.data.text_w,e=this.data.text_h):"icon"===this.data.tp?(t=this.data.icon_w+2*this.getHorizontalIconMargin(this.data.icon_w),e=i):(t=this.data.text_w+this.data.icon_w+this.getHorizontalTextMargin(this.data["font-size"]),e=this.data.text_h>i?this.data.text_h:i),this.showSkus){var n=this.data["attrs-icon-h"]+2*this.getVerticalIconMargin(this.data["attrs-icon-h"]),o=this.data["attrs-text_w"]+2*this.getSelectsPadding(),a=this.data["attrs-text_h"]>n?this.data["attrs-text_h"]:n,s=t>o?t:o,r=e>a?e:a,l=(this.selects.length-1)*this.data.attributes_margin,c=0,d=0;return"vertical"===this.data.layout?(c=s,d=r*(this.selects.length+1)+l+this.data.select_btn_margin):(c=s*(this.selects.length+1)+l+this.data.select_btn_margin,d=r),{width:c,height:d}}return{width:t,height:e}},setMinimalDimensions:function(t,e){if(!s.a.isUndefined(t)&&!s.a.isUndefined(e))return this.constraints={width:t,height:e},void(this.block&&this.block.setSizeConstraints(t,e));if("constructor"===this.environment){var i=this.getMinimalDimensions();this.constraints=i,this.block.setSizeConstraints(i.width,i.height)}},recalcDimensions:function(t){if(this.rendered){var e=this.showSkus?this.data.select_btn_margin:0,i=this.showSkus?this.selects.length+1:1,n=this.showSkus?(this.selects.length-1)*this.data.attributes_margin:0;if("vertical"===this.data.layout){if(!t.height)return;var o=t.height-e-n,a=Math.round(o/i);this.$button.css({height:a+"px",width:"100%"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({height:a+"px",width:"100%"})}))}else{if(!t.width)return;var s=t.width-e-n,r=Math.round(s/i);this.$button.css({width:r+"px",height:"100%"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({width:r+"px",height:"100%"})}))}}},updateRecalcDimensionsOnProductChange:function(){var t=this.recalcDimensionsOnProductChange();this.block.updateBlockSizes(t)},recalcDimensionsOnProductChange:function(){var t,e,i=this.showSkus?this.data.select_btn_margin:0,n=this.showSkus?this.selects.length+1:1,o=this.showSkus?(this.selects.length-1)*this.data.attributes_margin:0,a=this.data.btn_h,s=this.data.btn_w;return"vertical"===this.data.layout?(t=a*n+o+i,e=s):(t=a,e=s*n+o+i),this.$button.css({height:a+"px",width:s+"px"}),this.showSkus&&this.selects.forEach((function(t){t.parent().css({height:a+"px",width:s+"px"})})),{width:e,height:t}},recalcWidgetSizesAfterChangeLayout:function(t){var e=t||this.data.layout,i=this.data.btn_h,n=this.data.btn_w,o=i,a=n;return this.showSkus&&("horizontal"===e?a=n+n*this.selects.length+this.data.select_btn_margin+this.data.attributes_margin*(this.selects.length-1):o=i+i*this.selects.length+this.data.select_btn_margin+this.data.attributes_margin*(this.selects.length-1)),this.block.updateBlockSizes({width:a,height:o}),{width:a,height:o}},isAllSelectsNotDefault:function(){var t=!0;for(var e in this.selectsValues)if("default"===this.selectsValues[e]){t=!1;break}return t},getArticleBySelectsValues:function(){return this.product?1===this.product.articles.length?this.product.articles[0]:this.product.articles.find(function(t){return s.a.isMatch(t.attributes,this.selectsValues)}.bind(this)):null},getProductPrice:function(){return this.product&&this.product.prices&&this.product.prices.length?this.product.prices.find((function(t){return t.active&&"per_unit"===t.billing_scheme})):null},onSelectChange:function(t){this.hideError();var e=Object(n.a)(t.target),i=e.attr("name");this.selectsValues[i]=e.val(),e.parent().find(".fake-select").attr("value","default"===e.val()?i:e.val()),this.calculateSelectRestrictions(),this.product.attributes.forEach(function(t){this.renderSelectOptions(t,this.selectsMap[t])}.bind(this))},onAddToCartClick:function(){var t=this;if(this.hideError(),this.product||this.showError(),this.isAllSelectsNotDefault()){var e=this.getProductPrice();if(e)return e.productObject=p(p({},this.product),{},{articles:null,prices:null}),this.eCommerceManager.addPriceToCart(e)instanceof h.a?void this.showError():void(this.environment===l.a.environment.viewer&&RM.analytics&&RM.analytics.sendEvent("Item added to cart",e.id));var i=this.getArticleBySelectsValues();if(i){i.productObject=p(p({},this.product),{},{articles:null});var n=this.eCommerceManager.addToCart(i);n instanceof h.a?n.type===h.c.outOfStock?this.showOutOfStockError():this.showError():(this.environment===l.a.environment.viewer&&RM.analytics&&RM.analytics.sendEvent("Item added to cart",i.id),Object.keys(this.selectsMap).forEach((function(e){var i=t.selectsMap[e];t.selectsValues[e]="default",i.parent().find(".fake-select").attr("value",e),t.calculateSelectRestrictions()})),Object.keys(this.selectsMap).length&&this.product.attributes.forEach((function(e){return t.renderSelectOptions(e,t.selectsMap[e])})))}else this.showError("select")}else this.showError("select")},showError:function(t){"select"!==t?this.$button.addClass("add-to-cart-error"):this.selects.map((function(t){t.parents(".select-container").toggleClass("add-to-cart-error","default"===t.val())}))},showOutOfStockError:function(){this.showError(),this.$buttonText.val("Out of stock")},checkOutOfStock:function(){var t=this.getArticleBySelectsValues();if(t&&!this.eCommerceManager.checkItemQuantity(t))return this.showOutOfStockError();this.$buttonText.val(this.data.text),this.hideError()},hideError:function(){this.$button.removeClass("add-to-cart-error"),this.selects.map((function(t){return t.parents(".select-container").removeClass("add-to-cart-error")})),this.$buttonText.val(this.data.text)},onProductChange:function(t){t&&(this.data=t),this.rendered=!1,this.showSkus=this.checkSkus(this.data.selected_product_id),this.showSkus?this.product&&(this.renderAttributes(this.data),this.renderButton(this.data),this.renderMargins(),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.updateRecalcDimensionsOnProductChange()):(this.renderButton(this.data),this.generateIndividualStyleCSS(this.data),this.rendered=!0,this.updateRecalcDimensionsOnProductChange())},setHorizontalLayoutClass:function(){this.$el.hasClass("horizontal-layout")||this.$el.addClass("horizontal-layout")},removeHorizontalLayoutClass:function(){this.$el.hasClass("horizontal-layout")&&this.$el.removeClass("horizontal-layout")},onLayoutChange:function(t){if(this.rendered){this.data=t;var e=t.layout,i=this.recalcWidgetSizesAfterChangeLayout(e);this.renderMargins(e),"horizontal"===e?this.setHorizontalLayoutClass():this.removeHorizontalLayoutClass(),this.recalcDimensions(i),this.setMinimalDimensions()}},applyButtonTextSize:function(t){this.data=t,this.$buttonText.css({height:t.text_h+"px",width:t.text_w+"px"})},applyButtonIconSize:function(t){this.data=t,this.$buttonIcon.css({height:t.icon_h+"px",width:t.icon_w+"px"})},applyButtonIconPosition:function(t){this.data=t;var e="left"===t.icon_pos?"row":"row-reverse";this.$button.css("flex-direction",e)},applySelectsIconSize:function(t){var e=this;this.data=t,this.showSkus&&(this.selectPadding=t["attrs-icon-w"]+this.selectIconRight+this.selectIconTextMargin,this.selects.forEach((function(i){var n=i.parent();n.find(".fake-select").css({padding:"0 ".concat(e.selectPadding,"px")}),n.find(".select-dropdown-triangle").css({width:t["attrs-icon-w"]+"px",height:t["attrs-icon-h"]+"px"})})))},getButtonText:function(){return this.$buttonText.val().trim()},enterEditMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.$buttonText.removeAttr("readonly").addClass("editing"),t.selectText?this.$buttonText.select():this.$buttonText.focus().setCursorPos(0),this.block.selectEditControl()},leaveEditMode:function(){this.$buttonText.blur().attr("readonly",!0).removeClass("editing")},setData:function(t){this.data=t},setModel:function(t,e){this.block.model.set(t),e&&this.block.model.save()},getColorForErrorBorder:function(t){return t.isBorderSet?r.default.getRGBA(t.border,t.borderOpacity/100):r.default.getRGBA(t.bg,t.bgOpacity/100)},getDropdownTriangleSizeFromFontSize:function(t){return{h:16*t/18,w:10*t/18}},getSelectsPadding:function(){return this.selectPadding},getLongestAttribute:function(){return this.longestAttribute},generateStyleCSS:function(t,e,i){function n(t){return(!e||"default"===e||"both"!==i&&"button"!==i?"":"hover-")+t}function o(t){return(!e||"default"===e||"both"!==i&&"selects"!==i?"attrs-":"attrs-hover-")+t}var a=this.getColorForErrorBorder({bg:t[n("background-color")],bgOpacity:t[n("background-color-opacity")],border:t[n("border-color")],borderOpacity:t[n("border-color-opacity")],isBorderSet:!!t[n("border-width")]});if(this.$errorBlock.css({borderColor:a}),this.$button.css({color:r.default.getRGBA(t[n("color")],t[n("color-opacity")]/100),"background-color":r.default.getRGBA(t[n("background-color")],t[n("background-color-opacity")]/100),"border-radius":t[n("border-radius")]+"px","box-shadow":r.default.getRGBA(t[n("border-color")],t[n("border-color-opacity")]/100)+"0px 0px 0px "+t[n("border-width")]+"px inset"}),"constructor"===this.environment)this.$button.find(".button-icon svg path").css({fill:r.default.getRGBA(t[n("icon_color")],t[n("icon_color_opacity")]/100)});else{var s=t[n("icon_raster2xUrl")]?t[n("icon_raster2xUrl")]:t[n("icon_rasterUrl")];s&&this.$buttonIcon.css({"background-image":"url("+s+")"})}this.$buttonText.css({width:t.text_w+"px",height:t.text_h+"px","line-height":t.text_h+"px","font-family":t[n("font-family")],"font-size":t[n("font-size")]+"px","font-weight":t[n("font-weight")],"font-style":t[n("font-style")],"letter-spacing":t[n("letter-spacing")],"text-align":t[n("text-align")]}),this.showSkus&&(this.selectPadding=t["attrs-icon-w"]+this.selectIconRight+this.selectIconTextMargin,this.selects.forEach(function(e){var i=e.parent();i.find(".add-to-cart-error-block").css({borderColor:a}),i.css({"background-color":r.default.getRGBA(t[o("background-color")],t[o("background-color-opacity")]/100),"border-radius":t[o("border-radius")]+"px","box-shadow":r.default.getRGBA(t[o("border-color")],t[o("border-color-opacity")]/100)+"0px 0px 0px "+t[o("border-width")]+"px inset"}),i.find(".fake-select").css({padding:"0 ".concat(this.selectPadding,"px"),"border-radius":t[o("border-radius")]+"px",color:r.default.getRGBA(t[o("color")],t[o("color-opacity")]/100),"font-family":t[o("font-family")],"font-size":t[o("font-size")]+"px","font-weight":t[o("font-weight")],"font-style":t[o("font-style")],"letter-spacing":t[o("letter-spacing")],"text-align":t[o("text-align")],"text-align-last":t[o("text-align")]}),i.find(".select-dropdown-triangle path").css({fill:r.default.getRGBA(t[o("color")],t[o("color-opacity")]/100)}),i.find(".select-dropdown-triangle").css({width:t["attrs-icon-w"],height:t["attrs-icon-h"]})}.bind(this)))},generateHoverStyleCSS:function(t){var e=this.$buttonText,i=this.$buttonIcon;this.$button.hover((function(){if(Object(n.a)(this).css({color:r.default.getRGBA(t["hover-color"],t["hover-color-opacity"]/100),"background-color":r.default.getRGBA(t["hover-background-color"],t["hover-background-color-opacity"]/100),"border-radius":t["hover-border-radius"]+"px","box-shadow":r.default.getRGBA(t["hover-border-color"],t["hover-border-color-opacity"]/100)+"0px 0px 0px "+t["hover-border-width"]+"px inset"}),"constructor"!==this.environment){var o=t["hover-icon_raster2xUrl"]?t["hover-icon_raster2xUrl"]:t["hover-icon_rasterUrl"];o&&i.css({"background-image":"url("+o+")"})}else Object(n.a)(this).find(".button-icon svg path").css({fill:r.default.getRGBA(t["hover-icon_color"],t["hover-icon_color_opacity"]/100)});e.css({"font-family":t["hover-font-family"],"font-size":t["hover-font-size"]+"px","font-weight":t["hover-font-weight"],"font-style":t["hover-font-style"],"letter-spacing":t["hover-letter-spacing"],"text-align":t["hover-text-align"]})}),(function(){if(Object(n.a)(this).css({color:r.default.getRGBA(t.color,t["color-opacity"]/100),"background-color":r.default.getRGBA(t["background-color"],t["background-color-opacity"]/100),"border-radius":t["border-radius"]+"px","box-shadow":r.default.getRGBA(t["border-color"],t["border-color-opacity"]/100)+"0px 0px 0px "+t["border-width"]+"px inset"}),"constructor"!==this.environment){var o=t.icon_raster2xUrl?t.icon_raster2xUrl:t.icon_rasterUrl;o&&i.css({"background-image":"url("+o+")"})}else Object(n.a)(this).find(".button-icon svg path").css({fill:r.default.getRGBA(t.color,t["color-opacity"]/100)});e.css({"font-family":t["font-family"],"font-size":t["font-size"]+"px","font-weight":t["font-weight"],"font-style":t["font-style"],"letter-spacing":t["letter-spacing"],"text-align":t["text-align"]})})),this.showSkus&&this.selects.forEach(function(e){e.hover((function(){Object(n.a)(this).parent().css({"background-color":r.default.getRGBA(t["attrs-hover-background-color"],t["attrs-hover-background-color-opacity"]/100),"border-radius":t["attrs-hover-border-radius"]+"px","box-shadow":r.default.getRGBA(t["attrs-hover-border-color"],t["attrs-hover-border-color-opacity"]/100)+"0px 0px 0px "+t["attrs-hover-border-width"]+"px inset"}),Object(n.a)(this).parent().find(".fake-select").css({"border-radius":t["attrs-hover-border-radius"]+"px",color:r.default.getRGBA(t["attrs-hover-color"],t["attrs-hover-color-opacity"]/100),"font-family":t["attrs-hover-font-family"],"font-size":t["attrs-hover-font-size"]+"px","font-weight":t["attrs-hover-font-weight"],"font-style":t["attrs-hover-font-style"],"letter-spacing":t["attrs-hover-letter-spacing"],"text-align":t["attrs-hover-text-align"],"text-align-last":t["attrs-hover-text-align"]}),Object(n.a)(this).parent().find(".select-dropdown-triangle path").css({fill:r.default.getRGBA(t["attrs-hover-color"],t["attrs-hover-color-opacity"]/100)})}),(function(){Object(n.a)(this).parent().css({"background-color":r.default.getRGBA(t["attrs-background-color"],t["attrs-background-color-opacity"]/100),"border-radius":t["attrs-border-radius"]+"px","box-shadow":r.default.getRGBA(t["attrs-border-color"],t["attrs-border-color-opacity"]/100)+"0px 0px 0px "+t["attrs-border-width"]+"px inset"}),Object(n.a)(this).parent().find(".fake-select").css({"border-radius":t["attrs-border-radius"]+"px",color:r.default.getRGBA(t["attrs-color"],t["attrs-color-opacity"]/100),"font-family":t["attrs-font-family"],"font-size":t["attrs-font-size"]+"px","font-weight":t["attrs-font-weight"],"font-style":t["attrs-font-style"],"letter-spacing":t["attrs-letter-spacing"],"text-align":t["attrs-text-align"],"text-align-last":t["attrs-text-align"]}),Object(n.a)(this).parent().find(".select-dropdown-triangle path").css({fill:r.default.getRGBA(t["attrs-color"],t["attrs-color-opacity"]/100)})})),setTimeout(function(){e.parent().css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),e.parent().find(".fake-select").css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this),100),e.parent().find(".select-dropdown-triangle path").css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this)),setTimeout(function(){this.$button.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),e.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"}),i.css({transition:"all "+t["hover-tansition-duration"]+"s ease-out"})}.bind(this),100)}},{DEFAULT_ROW_HEIGHT:50,DEFAULT_ROW_WIDTH:168});e.a=m}}]);